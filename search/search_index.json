{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"\u95a2\u6570\u578b\u30c7\u30b6\u30a4\u30f3 - \u539f\u5247\u3001\u30d1\u30bf\u30fc\u30f3\u3001\u5b9f\u8df5","text":"<p>\u672c\u8a18\u4e8b\u30b7\u30ea\u30fc\u30ba\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u304a\u3051\u308b\u8a2d\u8a08\u539f\u5247\u3068\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u3092\u5b9f\u8df5\u7684\u306b\u5b66\u3076\u305f\u3081\u306e\u30ac\u30a4\u30c9\u3067\u3059\u3002</p>"},{"location":"#_1","title":"\u8a00\u8a9e\u5225\u89e3\u8aac","text":""},{"location":"#clojure","title":"Clojure \u7248","text":"<p>Clojure \u3092\u4f7f\u3063\u305f\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u5b9f\u88c5\u4f8b\u3067\u3059\u3002\u5f93\u6765\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u3092\u95a2\u6570\u578b\u30d1\u30e9\u30c0\u30a4\u30e0\u3067\u3069\u306e\u3088\u3046\u306b\u8868\u73fe\u3057\u3001\u6d3b\u7528\u3067\u304d\u308b\u304b\u3092\u63a2\u6c42\u3057\u307e\u3059\u3002</p> <ul> <li>Clojure \u89e3\u8aac</li> </ul>"},{"location":"#clojure_1","title":"\u7ae0\u69cb\u6210\uff08Clojure\uff09","text":""},{"location":"#1","title":"\u7b2c1\u90e8: \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u57fa\u790e\u539f\u5247","text":"\u7ae0 \u5185\u5bb9 1 \u4e0d\u5909\u6027\u3068\u30c7\u30fc\u30bf\u5909\u63db 2 \u95a2\u6570\u5408\u6210\u3068\u9ad8\u968e\u95a2\u6570 3 \u591a\u614b\u6027\u306e\u5b9f\u73fe\u65b9\u6cd5"},{"location":"#2","title":"\u7b2c2\u90e8: \u4ed5\u69d8\u3068\u30c6\u30b9\u30c8","text":"\u7ae0 \u5185\u5bb9 4 Clojure Spec \u306b\u3088\u308b\u4ed5\u69d8\u5b9a\u7fa9 5 \u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8 6 \u30c6\u30b9\u30c8\u99c6\u52d5\u958b\u767a\u3068\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0"},{"location":"#3-","title":"\u7b2c3\u90e8: \u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3 - \u69cb\u9020\u30d1\u30bf\u30fc\u30f3","text":"\u7ae0 \u5185\u5bb9 7 Composite \u30d1\u30bf\u30fc\u30f3 8 Decorator \u30d1\u30bf\u30fc\u30f3 9 Adapter \u30d1\u30bf\u30fc\u30f3"},{"location":"#4-","title":"\u7b2c4\u90e8: \u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3 - \u632f\u308b\u821e\u3044\u30d1\u30bf\u30fc\u30f3","text":"\u7ae0 \u5185\u5bb9 10 Strategy \u30d1\u30bf\u30fc\u30f3 11 Command \u30d1\u30bf\u30fc\u30f3 12 Visitor \u30d1\u30bf\u30fc\u30f3"},{"location":"#5-","title":"\u7b2c5\u90e8: \u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3 - \u751f\u6210\u30d1\u30bf\u30fc\u30f3","text":"\u7ae0 \u5185\u5bb9 13 Abstract Factory \u30d1\u30bf\u30fc\u30f3 14 Abstract Server \u30d1\u30bf\u30fc\u30f3"},{"location":"#6","title":"\u7b2c6\u90e8: \u5b9f\u8df5\u7684\u306a\u30b1\u30fc\u30b9\u30b9\u30bf\u30c7\u30a3","text":"\u7ae0 \u5185\u5bb9 15 \u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b 16 \u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0 17 \u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0 18 \u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0 19 Wa-Tor \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3"},{"location":"#7","title":"\u7b2c7\u90e8: \u307e\u3068\u3081\u3068\u5fdc\u7528","text":"\u7ae0 \u5185\u5bb9 20 \u30d1\u30bf\u30fc\u30f3\u9593\u306e\u76f8\u4e92\u4f5c\u7528 21 \u95a2\u6570\u578b\u30c7\u30b6\u30a4\u30f3\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9 22 \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u304b\u3089\u95a2\u6570\u578b\u3078\u306e\u79fb\u884c"},{"location":"#_2","title":"\u53c2\u7167","text":"<ul> <li>\u300cFunctional Design: Principles, Patterns, and Practices\u300dRobert C. Martin</li> <li>\u300cClean Code\u300dRobert C. Martin</li> <li>\u300cClojure Applied\u300dBen Vandgrift, Alex Miller</li> <li>\u300cProgramming Clojure\u300dAlex Miller, Stuart Halloway, Aaron Bedra</li> <li>Clojure \u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8</li> </ul>"},{"location":"clojure/","title":"\u95a2\u6570\u578b\u30c7\u30b6\u30a4\u30f3 - \u539f\u5247\u3001\u30d1\u30bf\u30fc\u30f3\u3001\u5b9f\u8df5","text":""},{"location":"clojure/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u8a18\u4e8b\u30b7\u30ea\u30fc\u30ba\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u304a\u3051\u308b\u8a2d\u8a08\u539f\u5247\u3068\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u3092\u5b9f\u8df5\u7684\u306b\u5b66\u3076\u305f\u3081\u306e\u30ac\u30a4\u30c9\u3067\u3059\u3002Clojure \u3092\u4e3b\u306a\u5b9f\u88c5\u8a00\u8a9e\u3068\u3057\u3066\u3001\u5f93\u6765\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u3092\u95a2\u6570\u578b\u30d1\u30e9\u30c0\u30a4\u30e0\u3067\u3069\u306e\u3088\u3046\u306b\u8868\u73fe\u3057\u3001\u6d3b\u7528\u3067\u304d\u308b\u304b\u3092\u63a2\u6c42\u3057\u307e\u3059\u3002</p>"},{"location":"clojure/#_2","title":"\u8a18\u4e8b\u69cb\u6210","text":""},{"location":"clojure/#1","title":"\u7b2c1\u90e8: \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u57fa\u790e\u539f\u5247","text":"<ol> <li>\u4e0d\u5909\u6027\u3068\u30c7\u30fc\u30bf\u5909\u63db</li> <li>\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u91cd\u8981\u6027</li> <li>\u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3</li> <li> <p>\u526f\u4f5c\u7528\u306e\u5206\u96e2</p> </li> <li> <p>\u95a2\u6570\u5408\u6210\u3068\u9ad8\u968e\u95a2\u6570</p> </li> <li>\u95a2\u6570\u5408\u6210\u306e\u57fa\u672c</li> <li>\u90e8\u5206\u9069\u7528\u3068\u30ab\u30ea\u30fc\u5316</li> <li> <p>\u9ad8\u968e\u95a2\u6570\u306e\u6d3b\u7528</p> </li> <li> <p>\u591a\u614b\u6027\u306e\u5b9f\u73fe\u65b9\u6cd5</p> </li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1</li> <li>\u30d7\u30ed\u30c8\u30b3\u30eb\u3068\u30ec\u30b3\u30fc\u30c9</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9 vs \u30d7\u30ed\u30c8\u30b3\u30eb\u306e\u4f7f\u3044\u5206\u3051</li> </ol>"},{"location":"clojure/#2","title":"\u7b2c2\u90e8: \u4ed5\u69d8\u3068\u30c6\u30b9\u30c8","text":"<ol> <li>Clojure Spec \u306b\u3088\u308b\u4ed5\u69d8\u5b9a\u7fa9</li> <li>\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u4ed5\u69d8\u5b9a\u7fa9</li> <li>\u95a2\u6570\u4ed5\u69d8\u306e\u5b9a\u7fa9\uff08fdef\uff09</li> <li> <p>\u5b9f\u884c\u6642\u691c\u8a3c\u3068\u81ea\u52d5\u30c6\u30b9\u30c8\u751f\u6210</p> </li> <li> <p>\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8</p> </li> <li>test.check \u306e\u57fa\u672c</li> <li>\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u306e\u4f5c\u6210</li> <li> <p>\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u5b9a\u7fa9\u3068\u691c\u8a3c</p> </li> <li> <p>\u30c6\u30b9\u30c8\u99c6\u52d5\u958b\u767a\u3068\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0</p> </li> <li>Red-Green-Refactor \u30b5\u30a4\u30af\u30eb</li> <li>\u30c6\u30b9\u30c8\u30d5\u30a1\u30fc\u30b9\u30c8\u306e\u95a2\u6570\u8a2d\u8a08</li> <li>\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u3068\u4e0d\u5909\u6027</li> </ol>"},{"location":"clojure/#3-","title":"\u7b2c3\u90e8: \u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3 - \u69cb\u9020\u30d1\u30bf\u30fc\u30f3","text":"<ol> <li>Composite \u30d1\u30bf\u30fc\u30f3</li> <li>\u500b\u5225\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u8907\u5408\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u7d71\u4e00\u7684\u306a\u6271\u3044</li> <li>Shape\uff08\u56f3\u5f62\uff09\u306e\u79fb\u52d5\u30fb\u62e1\u5927\u3092\u7d71\u4e00\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u64cd\u4f5c</li> <li>Switchable\uff08\u30b9\u30a4\u30c3\u30c1\uff09\u306e\u30b0\u30eb\u30fc\u30d7\u5316\u3068\u4e00\u62ec\u64cd\u4f5c</li> <li> <p>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u591a\u614b\u6027\u306e\u5b9f\u73fe</p> </li> <li> <p>Decorator \u30d1\u30bf\u30fc\u30f3</p> </li> <li>\u6a5f\u80fd\u306e\u52d5\u7684\u306a\u8ffd\u52a0</li> <li>JournaledShape: \u64cd\u4f5c\u5c65\u6b74\u306e\u8a18\u9332\uff08\u30b8\u30e3\u30fc\u30ca\u30ea\u30f3\u30b0\uff09</li> <li>\u95a2\u6570\u30c7\u30b3\u30ec\u30fc\u30bf: \u30ed\u30b0\u3001\u30ea\u30c8\u30e9\u30a4\u3001\u30ad\u30e3\u30c3\u30b7\u30e5</li> <li> <p>\u30c7\u30b3\u30ec\u30fc\u30bf\u306e\u7d44\u307f\u5408\u308f\u305b</p> </li> <li> <p>Adapter \u30d1\u30bf\u30fc\u30f3</p> </li> <li>\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306e\u5909\u63db</li> <li>VariableLightAdapter: \u53ef\u5909\u5f37\u5ea6\u30e9\u30a4\u30c8\u3092\u30aa\u30f3/\u30aa\u30d5\u306b\u9069\u5fdc</li> <li>\u30c7\u30fc\u30bf\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u30a2\u30c0\u30d7\u30bf\u30fc: \u65b0\u65e7\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u5909\u63db</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u9069\u5fdc</li> </ol>"},{"location":"clojure/#4-","title":"\u7b2c4\u90e8: \u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3 - \u632f\u308b\u821e\u3044\u30d1\u30bf\u30fc\u30f3","text":"<ol> <li> <p>Strategy \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u30ab\u30d7\u30bb\u30eb\u5316\u3057\u4ea4\u63db\u53ef\u80fd\u306b\u3059\u308b</li> <li>\u6599\u91d1\u8a08\u7b97: \u901a\u5e38\u30fb\u5272\u5f15\u30fb\u4f1a\u54e1\u30fb\u6570\u91cf\u5272\u5f15\u306e\u5404\u6226\u7565</li> <li>\u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1: \u9ad8\u968e\u95a2\u6570\u306b\u3088\u308b\u6226\u7565\u306e\u5408\u6210</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u591a\u614b\u6027\u306e\u5b9f\u73fe</li> </ul> </li> <li> <p>Command \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>\u64cd\u4f5c\u3092\u30c7\u30fc\u30bf\u3068\u3057\u3066\u30ab\u30d7\u30bb\u30eb\u5316</li> <li>\u30c6\u30ad\u30b9\u30c8\u30b3\u30de\u30f3\u30c9: \u633f\u5165\u30fb\u524a\u9664\u30fb\u7f6e\u63db</li> <li>\u30ad\u30e3\u30f3\u30d0\u30b9\u30b3\u30de\u30f3\u30c9: \u56f3\u5f62\u306e\u8ffd\u52a0\u30fb\u524a\u9664\u30fb\u79fb\u52d5</li> <li>Undo/Redo \u6a5f\u80fd\u3068 MacroCommand</li> </ul> </li> <li> <p>Visitor \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>\u30c7\u30fc\u30bf\u69cb\u9020\u3068\u64cd\u4f5c\u306e\u5206\u96e2</li> <li>JSON/XML \u5909\u63db Visitor \u306e\u5b9f\u88c5</li> <li>\u9762\u7a4d\u30fb\u5468\u56f2\u9577\u8a08\u7b97 Visitor</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u30c0\u30d6\u30eb\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1</li> </ul> </li> </ol>"},{"location":"clojure/#5-","title":"\u7b2c5\u90e8: \u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3 - \u751f\u6210\u30d1\u30bf\u30fc\u30f3","text":"<ol> <li> <p>Abstract Factory \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>\u95a2\u9023\u3059\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30d5\u30a1\u30df\u30ea\u30fc\u3092\u4e00\u8cab\u3057\u3066\u751f\u6210</li> <li>ShapeFactory: Standard/Outlined/Filled \u306e\u5404\u5b9f\u88c5</li> <li>UIFactory: \u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u5225 UI \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u751f\u6210</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u88fd\u54c1\u751f\u6210\u306e\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1</li> </ul> </li> <li> <p>Abstract Server \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>\u4f9d\u5b58\u95a2\u4fc2\u9006\u8ee2\u306e\u539f\u5247\uff08DIP\uff09\u306e\u5b9f\u73fe</li> <li>Switchable: Light/Fan/Motor \u306e\u7d71\u4e00\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>Repository: \u30c7\u30fc\u30bf\u30a2\u30af\u30bb\u30b9\u306e\u62bd\u8c61\u5316</li> <li>\u30d7\u30ed\u30c8\u30b3\u30eb\u3068\u30ec\u30b3\u30fc\u30c9\u306b\u3088\u308b\u758e\u7d50\u5408</li> </ul> </li> </ol>"},{"location":"clojure/#6","title":"\u7b2c6\u90e8: \u5b9f\u8df5\u7684\u306a\u30b1\u30fc\u30b9\u30b9\u30bf\u30c7\u30a3","text":"<ol> <li> <p>\u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b</p> <ul> <li>\u30d0\u30b9\u904b\u8ee2\u624b\u304c\u505c\u7559\u6240\u3067\u5642\u3092\u5171\u6709\u3059\u308b\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3</li> <li>\u7121\u9650\u30b7\u30fc\u30b1\u30f3\u30b9\uff08cycle\uff09\u306b\u3088\u308b\u5faa\u74b0\u30eb\u30fc\u30c8\u8868\u73fe</li> <li>\u96c6\u5408\u6f14\u7b97\u306b\u3088\u308b\u5642\u306e\u4f1d\u64ad</li> <li>\u72b6\u614b\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u5b9f\u88c5</li> </ul> </li> <li> <p>\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0</p> <ul> <li>\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30ea\u30f3\u30b0</li> <li>\u652f\u6255\u3044\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3068\u7d66\u4e0e\u30bf\u30a4\u30d7</li> <li>Clojure Spec \u306b\u3088\u308b\u30c7\u30fc\u30bf\u691c\u8a3c</li> </ul> </li> <li> <p>\u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0</p> <ul> <li>\u6599\u91d1\u8a08\u7b97\u30ed\u30b8\u30c3\u30af\u306e\u8a2d\u8a08</li> <li>\u30dd\u30ea\u30b7\u30fc\u30d1\u30bf\u30fc\u30f3\u306e\u9069\u7528</li> <li>\u30c6\u30ad\u30b9\u30c8/HTML \u30d5\u30a9\u30fc\u30de\u30c3\u30bf\u30fc\u306e\u5b9f\u88c5</li> </ul> </li> <li> <p>\u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0</p> <ul> <li>Clojure \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306b\u3088\u308b\u975e\u540c\u671f\u51e6\u7406</li> <li>\u72b6\u614b\u6a5f\u68b0\u30d1\u30bf\u30fc\u30f3</li> <li>\u30a4\u30d9\u30f3\u30c8\u99c6\u52d5\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3</li> </ul> </li> <li> <p>Wa-Tor \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3</p> <ul> <li>\u6355\u98df\u8005-\u88ab\u98df\u8005\u30e2\u30c7\u30eb\u306e\u5b9f\u88c5</li> <li>\u30bb\u30eb\u30aa\u30fc\u30c8\u30de\u30c8\u30f3\u3068\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9</li> <li>GUI \u3068\u306e\u7d71\u5408\uff08Quil\uff09</li> <li>\u9032\u5316\u3068\u7e41\u6b96\u306e\u30eb\u30fc\u30eb\u5b9f\u88c5</li> </ul> </li> </ol>"},{"location":"clojure/#7","title":"\u7b2c7\u90e8: \u307e\u3068\u3081\u3068\u5fdc\u7528","text":"<ol> <li> <p>\u30d1\u30bf\u30fc\u30f3\u9593\u306e\u76f8\u4e92\u4f5c\u7528</p> <ul> <li>Composite \u3068 Decorator \u306e\u7d44\u307f\u5408\u308f\u305b</li> <li>Command \u3068 Observer \u306e\u9023\u643a</li> <li>\u8907\u5408\u7684\u306a\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08</li> </ul> </li> <li> <p>\u95a2\u6570\u578b\u30c7\u30b6\u30a4\u30f3\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9</p> <ul> <li>\u30c7\u30fc\u30bf\u4e2d\u5fc3\u8a2d\u8a08</li> <li>\u7d14\u7c8b\u95a2\u6570\u3068\u526f\u4f5c\u7528\u306e\u5206\u96e2</li> <li>\u30c6\u30b9\u30c8\u53ef\u80fd\u306a\u8a2d\u8a08</li> </ul> </li> <li> <p>\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u304b\u3089\u95a2\u6570\u578b\u3078\u306e\u79fb\u884c</p> <ul> <li>\u65e2\u5b58\u30b3\u30fc\u30c9\u306e\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u6226\u7565</li> <li>\u6bb5\u968e\u7684\u306a\u79fb\u884c\u30a2\u30d7\u30ed\u30fc\u30c1</li> <li>\u5171\u5b58\u3068\u7d71\u5408</li> </ul> </li> </ol>"},{"location":"clojure/#_3","title":"\u4ed8\u9332","text":"<ul> <li>\u7528\u8a9e\u96c6</li> <li>\u53c2\u8003\u6587\u732e</li> <li>Clojure \u958b\u767a\u74b0\u5883\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7</li> </ul>"},{"location":"clojure/#_4","title":"\u672c\u30b7\u30ea\u30fc\u30ba\u306e\u7279\u5fb4","text":""},{"location":"clojure/#_5","title":"\u5b9f\u8df5\u91cd\u8996","text":"<p>\u3059\u3079\u3066\u306e\u30d1\u30bf\u30fc\u30f3\u306f\u5b9f\u969b\u306b\u52d5\u4f5c\u3059\u308b\u30b3\u30fc\u30c9\u4f8b\u3092\u542b\u307f\u307e\u3059\u3002\u7406\u8ad6\u3060\u3051\u3067\u306a\u304f\u3001\u5b9f\u88c5\u3092\u901a\u3058\u3066\u7406\u89e3\u3092\u6df1\u3081\u308b\u3053\u3068\u3092\u91cd\u8996\u3057\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"clojure/#_6","title":"\u30c6\u30b9\u30c8\u99c6\u52d5","text":"<p>\u5404\u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u306b\u306f\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u304c\u4ed8\u5c5e\u3057\u3066\u3044\u307e\u3059\u3002TDD \u306e\u30a2\u30d7\u30ed\u30fc\u30c1\u306b\u5f93\u3044\u3001\u30c6\u30b9\u30c8\u30d5\u30a1\u30fc\u30b9\u30c8\u3067\u30d1\u30bf\u30fc\u30f3\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/#_7","title":"\u6bb5\u968e\u7684\u306a\u5b66\u7fd2","text":"<p>\u57fa\u790e\u304b\u3089\u5fdc\u7528\u3078\u3068\u6bb5\u968e\u7684\u306b\u5185\u5bb9\u304c\u9032\u884c\u3057\u307e\u3059\u3002\u5404\u7ae0\u306f\u72ec\u7acb\u3057\u3066\u8aad\u3080\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u304c\u3001\u9806\u756a\u306b\u8aad\u3080\u3053\u3068\u3067\u3088\u308a\u6df1\u3044\u7406\u89e3\u304c\u5f97\u3089\u308c\u307e\u3059\u3002</p>"},{"location":"clojure/#_8","title":"\u65e5\u672c\u8a9e\u3067\u306e\u89e3\u8aac","text":"<p>\u6280\u8853\u7528\u8a9e\u306f\u82f1\u8a9e\u3092\u4f75\u8a18\u3057\u3064\u3064\u3001\u89e3\u8aac\u306f\u65e5\u672c\u8a9e\u3067\u884c\u3044\u307e\u3059\u3002\u65e5\u672c\u8a9e\u3067\u306e\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u5b66\u7fd2\u30ea\u30bd\u30fc\u30b9\u3068\u3057\u3066\u6d3b\u7528\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"clojure/#_9","title":"\u5bfe\u8c61\u8aad\u8005","text":"<ul> <li>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u8208\u5473\u304c\u3042\u308b\u958b\u767a\u8005</li> <li>Clojure \u3092\u5b66\u7fd2\u4e2d\u307e\u305f\u306f\u6d3b\u7528\u3057\u3066\u3044\u308b\u958b\u767a\u8005</li> <li>\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u306e\u77e5\u8b58\u304c\u3042\u308a\u3001\u95a2\u6570\u578b\u3067\u306e\u8868\u73fe\u3092\u5b66\u3073\u305f\u3044\u958b\u767a\u8005</li> <li>\u30c6\u30b9\u30c8\u99c6\u52d5\u958b\u767a\u3084\u30af\u30ea\u30fc\u30f3\u30b3\u30fc\u30c9\u306b\u95a2\u5fc3\u304c\u3042\u308b\u958b\u767a\u8005</li> </ul>"},{"location":"clojure/#_10","title":"\u524d\u63d0\u77e5\u8b58","text":"<ul> <li>\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u57fa\u790e\u77e5\u8b58</li> <li>Clojure \u306e\u57fa\u672c\u7684\u306a\u6587\u6cd5\uff08\u30ea\u30b9\u30c8\u3001\u30de\u30c3\u30d7\u3001\u95a2\u6570\u5b9a\u7fa9\u306a\u3069\uff09</li> <li>\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u306e\u57fa\u672c\u6982\u5ff5\uff08\u63a8\u5968\uff09</li> </ul>"},{"location":"clojure/#_11","title":"\u53c2\u8003\u66f8\u7c4d","text":"<p>\u672c\u30b7\u30ea\u30fc\u30ba\u306f\u4ee5\u4e0b\u306e\u66f8\u7c4d\u306e\u5185\u5bb9\u3092\u53c2\u8003\u306b\u3057\u3066\u3044\u307e\u3059\uff1a</p> <ul> <li>\u300cFunctional Design: Principles, Patterns, and Practices\u300dRobert C. Martin</li> <li>\u300cClean Code\u300dRobert C. Martin</li> <li>\u300cClojure Applied\u300dBen Vandgrift, Alex Miller</li> <li>\u300cProgramming Clojure\u300dAlex Miller, Stuart Halloway, Aaron Bedra</li> </ul>"},{"location":"clojure/01-immutability-and-data-transformation/","title":"\u7b2c1\u7ae0: \u4e0d\u5909\u6027\u3068\u30c7\u30fc\u30bf\u5909\u63db","text":""},{"location":"clojure/01-immutability-and-data-transformation/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u6700\u3082\u91cd\u8981\u306a\u6982\u5ff5\u306e\u4e00\u3064\u304c\u4e0d\u5909\u6027\uff08Immutability\uff09\u3067\u3059\u3002\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u4e88\u6e2c\u53ef\u80fd\u6027\u304c\u5411\u4e0a\u3057\u3001\u4e26\u884c\u51e6\u7406\u3067\u306e\u30d0\u30b0\u3092\u9632\u304e\u3001\u30b3\u30fc\u30c9\u306e\u7406\u89e3\u3068\u4fdd\u5b88\u304c\u5bb9\u6613\u306b\u306a\u308a\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001Clojure \u306b\u304a\u3051\u308b\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u57fa\u672c\u304b\u3089\u3001\u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3001\u526f\u4f5c\u7528\u306e\u5206\u96e2\u307e\u3067\u3001\u5b9f\u8df5\u7684\u306a\u4f8b\u3092\u901a\u3058\u3066\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/01-immutability-and-data-transformation/#1_1","title":"1. \u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u57fa\u672c","text":""},{"location":"clojure/01-immutability-and-data-transformation/#_2","title":"\u306a\u305c\u4e0d\u5909\u6027\u304c\u91cd\u8981\u306a\u306e\u304b","text":"<p>\u5f93\u6765\u306e\u547d\u4ee4\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u5909\u6570\u3084\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u72b6\u614b\u3092\u76f4\u63a5\u5909\u66f4\u3057\u307e\u3059\uff1a</p> <pre><code>// Java\uff08\u53ef\u5909\uff09\nperson.setAge(31);  // \u5143\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u5909\u66f4\u3055\u308c\u308b\n</code></pre> <p>\u3053\u308c\u306b\u5bfe\u3057\u3001Clojure \u306e\u30c7\u30fc\u30bf\u69cb\u9020\u306f\u4e0d\u5909\u3067\u3059\u3002\u30c7\u30fc\u30bf\u3092\u300c\u5909\u66f4\u300d\u3059\u308b\u3068\u3001\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u69cb\u9020\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\uff1a</p> <pre><code>(def original-person {:name \"\u7530\u4e2d\" :age 30})\n\n(defn update-age [person new-age]\n  (assoc person :age new-age))\n\n;; \u4f7f\u7528\u4f8b\n(def updated-person (update-age original-person 31))\n\noriginal-person   ;; =&gt; {:name \"\u7530\u4e2d\" :age 30}  \u2190 \u5143\u306e\u30c7\u30fc\u30bf\u306f\u5909\u308f\u3089\u306a\u3044\nupdated-person    ;; =&gt; {:name \"\u7530\u4e2d\" :age 31}  \u2190 \u65b0\u3057\u3044\u30c7\u30fc\u30bf\n</code></pre>"},{"location":"clojure/01-immutability-and-data-transformation/#_3","title":"\u4e0d\u5909\u6027\u306e\u5229\u70b9","text":"<ol> <li>\u4e88\u6e2c\u53ef\u80fd\u6027: \u30c7\u30fc\u30bf\u304c\u5909\u66f4\u3055\u308c\u306a\u3044\u305f\u3081\u3001\u95a2\u6570\u306e\u52d5\u4f5c\u3092\u4e88\u6e2c\u3057\u3084\u3059\u3044</li> <li>\u30b9\u30ec\u30c3\u30c9\u30bb\u30fc\u30d5: \u8907\u6570\u306e\u30b9\u30ec\u30c3\u30c9\u304b\u3089\u5b89\u5168\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b</li> <li>\u5c65\u6b74\u306e\u4fdd\u6301: \u5909\u66f4\u524d\u306e\u30c7\u30fc\u30bf\u3092\u4fdd\u6301\u3067\u304d\u308b\uff08Undo/Redo \u306e\u5b9f\u88c5\u304c\u5bb9\u6613\uff09</li> <li>\u30c7\u30d0\u30c3\u30b0\u306e\u5bb9\u6613\u3055: \u30c7\u30fc\u30bf\u306e\u5909\u66f4\u5c65\u6b74\u3092\u8ffd\u8de1\u3057\u3084\u3059\u3044</li> </ol>"},{"location":"clojure/01-immutability-and-data-transformation/#2-structural-sharing","title":"2. \u69cb\u9020\u5171\u6709\uff08Structural Sharing\uff09","text":"<p>\u300c\u6bce\u56de\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u4f5c\u6210\u3059\u308b\u3068\u975e\u52b9\u7387\u3067\u306f\uff1f\u300d\u3068\u601d\u3046\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002Clojure \u306f\u69cb\u9020\u5171\u6709\u306b\u3088\u308a\u3001\u52b9\u7387\u7684\u306b\u30e1\u30e2\u30ea\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002</p> <pre><code>(def team {:name \"\u958b\u767a\u30c1\u30fc\u30e0\"\n           :members [{:name \"\u7530\u4e2d\" :role :developer}\n                     {:name \"\u9234\u6728\" :role :designer}\n                     {:name \"\u4f50\u85e4\" :role :manager}]})\n\n(defn add-member [team member]\n  (update team :members conj member))\n\n(def new-team (add-member team {:name \"\u5c71\u7530\" :role :developer}))\n</code></pre> <p><code>new-team</code> \u306f\u65b0\u3057\u3044\u30de\u30c3\u30d7\u3067\u3059\u304c\u3001<code>:name</code> \u306e\u5024\u3084\u65e2\u5b58\u306e\u30e1\u30f3\u30d0\u30fc\u30c7\u30fc\u30bf\u306f <code>team</code> \u3068\u5171\u6709\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u5909\u66f4\u3055\u308c\u3066\u3044\u306a\u3044\u90e8\u5206\u306f\u30b3\u30d4\u30fc\u3055\u308c\u305a\u3001\u53c2\u7167\u304c\u5171\u6709\u3055\u308c\u307e\u3059\u3002</p> <pre><code>team:     {:name \"\u958b\u767a\u30c1\u30fc\u30e0\", :members [\u7530\u4e2d, \u9234\u6728, \u4f50\u85e4]}\n                \u2193                    \u2193\nnew-team: {:name (\u5171\u6709), :members [\u7530\u4e2d, \u9234\u6728, \u4f50\u85e4, \u5c71\u7530]}\n                                  \u2191 \u65e2\u5b58\u30c7\u30fc\u30bf\u306f\u5171\u6709\n</code></pre>"},{"location":"clojure/01-immutability-and-data-transformation/#3","title":"3. \u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u30c7\u30fc\u30bf\u3092\u5909\u63db\u3059\u308b\u4e00\u9023\u306e\u51e6\u7406\u3092\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3068\u3057\u3066\u8868\u73fe\u3057\u307e\u3059\u3002Clojure \u3067\u306f\u30b9\u30ec\u30c3\u30c9\u30de\u30af\u30ed\uff08<code>-&gt;</code> \u3068 <code>-&gt;&gt;</code>\uff09\u3092\u4f7f\u7528\u3057\u3066\u3001\u8aad\u307f\u3084\u3059\u3044\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u69cb\u7bc9\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"clojure/01-immutability-and-data-transformation/#_4","title":"\u5b9f\u8df5\u4f8b\uff1a\u6ce8\u6587\u51e6\u7406\u30b7\u30b9\u30c6\u30e0","text":"<pre><code>(def order {:items [{:name \"\u5546\u54c1A\" :price 1000 :quantity 2}\n                    {:name \"\u5546\u54c1B\" :price 500 :quantity 3}\n                    {:name \"\u5546\u54c1C\" :price 2000 :quantity 1}]\n            :customer {:name \"\u5c71\u7530\" :membership :gold}})\n\n;; \u5404\u30a2\u30a4\u30c6\u30e0\u306e\u5c0f\u8a08\u3092\u8a08\u7b97\n(defn calculate-subtotal [item]\n  (* (:price item) (:quantity item)))\n\n;; \u4f1a\u54e1\u7a2e\u5225\u306b\u5fdc\u3058\u305f\u5272\u5f15\u7387\u3092\u53d6\u5f97\n(defn membership-discount [membership]\n  (case membership\n    :gold 0.1\n    :silver 0.05\n    :bronze 0.02\n    0))\n\n;; \u6ce8\u6587\u306e\u5408\u8a08\u91d1\u984d\u3092\u8a08\u7b97\n(defn calculate-total [order]\n  (-&gt;&gt; (:items order)\n       (map calculate-subtotal)\n       (reduce +)))\n\n;; \u5272\u5f15\u5f8c\u306e\u91d1\u984d\u3092\u8a08\u7b97\n(defn apply-discount [order total]\n  (let [discount-rate (-&gt; order :customer :membership membership-discount)]\n    (* total (- 1 discount-rate))))\n</code></pre>"},{"location":"clojure/01-immutability-and-data-transformation/#_5","title":"\u30b9\u30ec\u30c3\u30c9\u30de\u30af\u30ed\u306e\u4f7f\u3044\u5206\u3051","text":"<ul> <li><code>-&gt;</code>\uff08thread-first\uff09: \u7d50\u679c\u3092\u6b21\u306e\u95a2\u6570\u306e\u6700\u521d\u306e\u5f15\u6570\u3068\u3057\u3066\u6e21\u3059</li> <li><code>-&gt;&gt;</code>\uff08thread-last\uff09: \u7d50\u679c\u3092\u6b21\u306e\u95a2\u6570\u306e\u6700\u5f8c\u306e\u5f15\u6570\u3068\u3057\u3066\u6e21\u3059</li> </ul> <pre><code>;; -&gt; \u306e\u4f8b\uff08\u30de\u30c3\u30d7\u306e\u64cd\u4f5c\u306b\u4fbf\u5229\uff09\n(-&gt; order :customer :membership membership-discount)\n;; \u5c55\u958b: (membership-discount (:membership (:customer order)))\n\n;; -&gt;&gt; \u306e\u4f8b\uff08\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u64cd\u4f5c\u306b\u4fbf\u5229\uff09\n(-&gt;&gt; (:items order)\n     (map calculate-subtotal)\n     (reduce +))\n;; \u5c55\u958b: (reduce + (map calculate-subtotal (:items order)))\n</code></pre>"},{"location":"clojure/01-immutability-and-data-transformation/#4","title":"4. \u526f\u4f5c\u7528\u306e\u5206\u96e2","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u7d14\u7c8b\u95a2\u6570\u3068\u526f\u4f5c\u7528\u3092\u6301\u3064\u95a2\u6570\u3092\u660e\u78ba\u306b\u5206\u96e2\u3059\u308b\u3053\u3068\u304c\u91cd\u8981\u3067\u3059\u3002</p>"},{"location":"clojure/01-immutability-and-data-transformation/#_6","title":"\u7d14\u7c8b\u95a2\u6570\u3068\u306f","text":"<ul> <li>\u540c\u3058\u5165\u529b\u306b\u5bfe\u3057\u3066\u5e38\u306b\u540c\u3058\u51fa\u529b\u3092\u8fd4\u3059</li> <li>\u5916\u90e8\u306e\u72b6\u614b\u3092\u5909\u66f4\u3057\u306a\u3044\uff08\u526f\u4f5c\u7528\u304c\u306a\u3044\uff09</li> </ul> <pre><code>;; \u7d14\u7c8b\u95a2\u6570\n(defn pure-calculate-tax [amount tax-rate]\n  (* amount tax-rate))\n\n;; \u4f55\u5ea6\u547c\u3093\u3067\u3082\u540c\u3058\u7d50\u679c\n(pure-calculate-tax 1000 0.1)  ;; =&gt; 100.0\n(pure-calculate-tax 1000 0.1)  ;; =&gt; 100.0\n</code></pre>"},{"location":"clojure/01-immutability-and-data-transformation/#_7","title":"\u526f\u4f5c\u7528\u306e\u5206\u96e2\u30d1\u30bf\u30fc\u30f3","text":"<p>\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\uff08\u7d14\u7c8b\u95a2\u6570\uff09\u3068\u526f\u4f5c\u7528\uff08I/O\uff09\u3092\u5206\u96e2\u3057\u307e\u3059\uff1a</p> <pre><code>;; \u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\uff08\u7d14\u7c8b\u95a2\u6570\uff09\n(defn calculate-invoice [items tax-rate]\n  (let [subtotal (reduce + (map calculate-subtotal items))\n        tax (pure-calculate-tax subtotal tax-rate)\n        total (+ subtotal tax)]\n    {:subtotal subtotal\n     :tax tax\n     :total total}))\n\n;; \u526f\u4f5c\u7528\u3092\u542b\u3080\u51e6\u7406\uff08\u5206\u96e2\uff09\n(defn save-invoice! [invoice]\n  ;; \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u306e\u4fdd\u5b58\uff08\u526f\u4f5c\u7528\uff09\n  (println \"Saving invoice:\" invoice)\n  invoice)\n\n(defn send-notification! [invoice customer-email]\n  ;; \u30e1\u30fc\u30eb\u9001\u4fe1\uff08\u526f\u4f5c\u7528\uff09\n  (println \"Sending notification to:\" customer-email)\n  invoice)\n\n;; \u51e6\u7406\u5168\u4f53\u306e\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\n(defn process-and-save-invoice! [items tax-rate customer-email]\n  (-&gt; (calculate-invoice items tax-rate)\n      save-invoice!\n      (send-notification! customer-email)))\n</code></pre> <p>\u526f\u4f5c\u7528\u3092\u6301\u3064\u95a2\u6570\u306b\u306f <code>!</code> \u30b5\u30d5\u30a3\u30c3\u30af\u30b9\u3092\u4ed8\u3051\u308b\u6163\u4f8b\u304c\u3042\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/01-immutability-and-data-transformation/#5-undoredo","title":"5. \u6c38\u7d9a\u7684\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u6d3b\u7528\uff1aUndo/Redo \u306e\u5b9f\u88c5","text":"<p>\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u6d3b\u7528\u3059\u308b\u3068\u3001\u5c65\u6b74\u7ba1\u7406\u304c\u975e\u5e38\u306b\u7c21\u5358\u306b\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p> <pre><code>;; \u5c65\u6b74\u3092\u4fdd\u6301\u3059\u308b\u30c7\u30fc\u30bf\u69cb\u9020\n(defn create-history []\n  {:current nil\n   :past []\n   :future []})\n\n(defn push-state [history new-state]\n  (-&gt; history\n      (update :past conj (:current history))\n      (assoc :current new-state)\n      (assoc :future [])))\n\n(defn undo [history]\n  (if (empty? (:past history))\n    history\n    (let [previous (peek (:past history))]\n      (-&gt; history\n          (update :future conj (:current history))\n          (assoc :current previous)\n          (update :past pop)))))\n\n(defn redo [history]\n  (if (empty? (:future history))\n    history\n    (let [next-state (peek (:future history))]\n      (-&gt; history\n          (update :past conj (:current history))\n          (assoc :current next-state)\n          (update :future pop)))))\n</code></pre>"},{"location":"clojure/01-immutability-and-data-transformation/#_8","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>(def history\n  (-&gt; (create-history)\n      (push-state {:text \"Hello\"})\n      (push-state {:text \"Hello World\"})\n      (push-state {:text \"Hello World!\"})))\n\n(:current history)  ;; =&gt; {:text \"Hello World!\"}\n\n(def after-undo (undo history))\n(:current after-undo)  ;; =&gt; {:text \"Hello World\"}\n\n(def after-redo (redo after-undo))\n(:current after-redo)  ;; =&gt; {:text \"Hello World!\"}\n</code></pre>"},{"location":"clojure/01-immutability-and-data-transformation/#6","title":"6. \u30c8\u30e9\u30f3\u30b9\u30c7\u30e5\u30fc\u30b5\u30fc\u306b\u3088\u308b\u52b9\u7387\u7684\u306a\u5909\u63db","text":"<p>\u8907\u6570\u306e\u5909\u63db\u3092\u884c\u3046\u5834\u5408\u3001\u901a\u5e38\u306f\u4e2d\u9593\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\u30c8\u30e9\u30f3\u30b9\u30c7\u30e5\u30fc\u30b5\u30fc\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u8907\u6570\u306e\u5909\u63db\u30921\u56de\u306e\u30d1\u30b9\u3067\u51e6\u7406\u3067\u304d\u307e\u3059\u3002</p> <pre><code>;; \u8907\u6570\u306e\u5909\u63db\u3092\u5408\u6210\n(def xf-process-items\n  (comp\n   (filter #(&gt; (:quantity %) 0))           ;; \u6570\u91cf\u304c0\u3088\u308a\u5927\u304d\u3044\u3082\u306e\u3092\u30d5\u30a3\u30eb\u30bf\n   (map #(assoc % :subtotal (calculate-subtotal %)))  ;; \u5c0f\u8a08\u3092\u8ffd\u52a0\n   (filter #(&gt; (:subtotal %) 100))))       ;; \u5c0f\u8a08\u304c100\u3088\u308a\u5927\u304d\u3044\u3082\u306e\u3092\u30d5\u30a3\u30eb\u30bf\n\n;; \u30c8\u30e9\u30f3\u30b9\u30c7\u30e5\u30fc\u30b5\u30fc\u3092\u4f7f\u7528\u3057\u305f\u52b9\u7387\u7684\u306a\u51e6\u7406\n(defn process-items-efficiently [items]\n  (into [] xf-process-items items))\n</code></pre> <p>\u30c8\u30e9\u30f3\u30b9\u30c7\u30e5\u30fc\u30b5\u30fc\u306e\u5229\u70b9\uff1a - \u4e2d\u9593\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3057\u306a\u3044 - \u9045\u5ef6\u8a55\u4fa1\u3068\u306e\u7d44\u307f\u5408\u308f\u305b\u304c\u53ef\u80fd - \u69d8\u3005\u306a\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\uff08\u30d9\u30af\u30bf\u30fc\u3001\u30c1\u30e3\u30cd\u30eb\u306a\u3069\uff09\u3067\u518d\u5229\u7528\u53ef\u80fd</p>"},{"location":"clojure/01-immutability-and-data-transformation/#_9","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u57fa\u790e\u3067\u3042\u308b\u4e0d\u5909\u6027\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020: \u30c7\u30fc\u30bf\u306f\u5909\u66f4\u3055\u308c\u305a\u3001\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u304c\u4f5c\u6210\u3055\u308c\u308b</li> <li>\u69cb\u9020\u5171\u6709: \u52b9\u7387\u7684\u306a\u30e1\u30e2\u30ea\u4f7f\u7528\u3092\u5b9f\u73fe</li> <li>\u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3: \u30b9\u30ec\u30c3\u30c9\u30de\u30af\u30ed\u306b\u3088\u308b\u8aad\u307f\u3084\u3059\u3044\u5909\u63db\u51e6\u7406</li> <li>\u526f\u4f5c\u7528\u306e\u5206\u96e2: \u7d14\u7c8b\u95a2\u6570\u3068I/O\u51e6\u7406\u306e\u660e\u78ba\u306a\u5206\u96e2</li> <li>\u5c65\u6b74\u7ba1\u7406: \u4e0d\u5909\u6027\u3092\u6d3b\u7528\u3057\u305fUndo/Redo\u306e\u7c21\u6f54\u306a\u5b9f\u88c5</li> <li>\u30c8\u30e9\u30f3\u30b9\u30c7\u30e5\u30fc\u30b5\u30fc: \u52b9\u7387\u7684\u306a\u8907\u5408\u5909\u63db</li> </ol> <p>\u3053\u308c\u3089\u306e\u6982\u5ff5\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u4ed6\u306e\u3059\u3079\u3066\u306e\u30d1\u30bf\u30fc\u30f3\u306e\u57fa\u76e4\u3068\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/01-immutability-and-data-transformation/#_10","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part1/src/immutability.clj</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part1/spec/immutability_spec.clj</code></li> </ul>"},{"location":"clojure/01-immutability-and-data-transformation/#_11","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001\u95a2\u6570\u5408\u6210\u3068\u9ad8\u968e\u95a2\u6570\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u5c0f\u3055\u306a\u95a2\u6570\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u8907\u96d1\u306a\u51e6\u7406\u3092\u69cb\u7bc9\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/02-function-composition/","title":"\u7b2c2\u7ae0: \u95a2\u6570\u5408\u6210\u3068\u9ad8\u968e\u95a2\u6570","text":""},{"location":"clojure/02-function-composition/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u771f\u9ac4\u306f\u3001\u5c0f\u3055\u306a\u95a2\u6570\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u8907\u96d1\u306a\u51e6\u7406\u3092\u69cb\u7bc9\u3059\u308b\u3053\u3068\u306b\u3042\u308a\u307e\u3059\u3002\u672c\u7ae0\u3067\u306f\u3001Clojure \u306b\u304a\u3051\u308b\u95a2\u6570\u5408\u6210\u306e\u30c6\u30af\u30cb\u30c3\u30af\u3068\u9ad8\u968e\u95a2\u6570\u306e\u6d3b\u7528\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/02-function-composition/#1-comp","title":"1. \u95a2\u6570\u5408\u6210\u306e\u57fa\u672c (comp)","text":""},{"location":"clojure/02-function-composition/#comp","title":"comp \u306b\u3088\u308b\u95a2\u6570\u306e\u9023\u7d50","text":"<p><code>comp</code> \u306f\u8907\u6570\u306e\u95a2\u6570\u3092\u5408\u6210\u3057\u3066\u3001\u65b0\u3057\u3044\u95a2\u6570\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u5408\u6210\u3055\u308c\u305f\u95a2\u6570\u306f\u53f3\u304b\u3089\u5de6\u3078\u9806\u756a\u306b\u9069\u7528\u3055\u308c\u307e\u3059\u3002</p> <pre><code>(defn add-tax\n  \"\u7a0e\u91d1\u3092\u8ffd\u52a0\u3059\u308b\"\n  [rate amount]\n  (* amount (+ 1 rate)))\n\n(defn apply-discount-rate\n  \"\u5272\u5f15\u3092\u9069\u7528\u3059\u308b\"\n  [rate amount]\n  (* amount (- 1 rate)))\n\n(defn round-to-yen\n  \"\u5186\u5358\u4f4d\u306b\u4e38\u3081\u308b\"\n  [amount]\n  (Math/round (double amount)))\n\n;; comp \u306b\u3088\u308b\u95a2\u6570\u5408\u6210\n(def calculate-final-price\n  \"\u6700\u7d42\u4fa1\u683c\u3092\u8a08\u7b97\u3059\u308b\u5408\u6210\u95a2\u6570\"\n  (comp round-to-yen\n        (partial add-tax 0.1)\n        (partial apply-discount-rate 0.2)))\n\n;; \u4f7f\u7528\u4f8b\n(calculate-final-price 1000)\n;; =&gt; 880\n;; \u51e6\u7406\u9806\u5e8f: 1000 \u2192 20%\u5272\u5f15(800) \u2192 10%\u7a0e\u8fbc(880) \u2192 \u4e38\u3081(880)\n</code></pre>"},{"location":"clojure/02-function-composition/#comp_1","title":"comp \u306e\u5229\u70b9","text":"<ol> <li>\u5ba3\u8a00\u7684\u306a\u8a18\u8ff0: \u51e6\u7406\u306e\u6d41\u308c\u3092\u95a2\u6570\u306e\u30ea\u30b9\u30c8\u3068\u3057\u3066\u8868\u73fe</li> <li>\u518d\u5229\u7528\u6027: \u5408\u6210\u3057\u305f\u95a2\u6570\u3092\u5225\u306e\u5834\u6240\u3067\u518d\u5229\u7528\u53ef\u80fd</li> <li>\u30c6\u30b9\u30c8\u5bb9\u6613\u6027: \u5404\u95a2\u6570\u3092\u500b\u5225\u306b\u30c6\u30b9\u30c8\u53ef\u80fd</li> </ol>"},{"location":"clojure/02-function-composition/#2-partial","title":"2. \u90e8\u5206\u9069\u7528 (partial)","text":""},{"location":"clojure/02-function-composition/#partial","title":"partial \u306b\u3088\u308b\u5f15\u6570\u306e\u56fa\u5b9a","text":"<p><code>partial</code> \u306f\u95a2\u6570\u306e\u4e00\u90e8\u306e\u5f15\u6570\u3092\u56fa\u5b9a\u3057\u3066\u3001\u65b0\u3057\u3044\u95a2\u6570\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002</p> <pre><code>(defn greet\n  \"\u6328\u62f6\u3059\u308b\"\n  [greeting name]\n  (str greeting \", \" name \"!\"))\n\n(def say-hello (partial greet \"Hello\"))\n(def say-goodbye (partial greet \"Goodbye\"))\n\n(say-hello \"\u7530\u4e2d\")    ;; =&gt; \"Hello, \u7530\u4e2d!\"\n(say-goodbye \"\u9234\u6728\")  ;; =&gt; \"Goodbye, \u9234\u6728!\"\n</code></pre>"},{"location":"clojure/02-function-composition/#_2","title":"\u8907\u6570\u5f15\u6570\u306e\u90e8\u5206\u9069\u7528","text":"<pre><code>(defn send-email\n  \"\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b\"\n  [from to subject body]\n  {:from from :to to :subject subject :body body})\n\n(def send-from-system (partial send-email \"system@example.com\"))\n(def send-notification (partial send-from-system \"user@example.com\" \"\u901a\u77e5\"))\n\n(send-notification \"\u30e1\u30c3\u30bb\u30fc\u30b8\u672c\u6587\")\n;; =&gt; {:from \"system@example.com\"\n;;     :to \"user@example.com\"\n;;     :subject \"\u901a\u77e5\"\n;;     :body \"\u30e1\u30c3\u30bb\u30fc\u30b8\u672c\u6587\"}\n</code></pre>"},{"location":"clojure/02-function-composition/#3-juxt-","title":"3. juxt - \u8907\u6570\u306e\u95a2\u6570\u3092\u4e26\u5217\u9069\u7528","text":"<p><code>juxt</code> \u306f\u8907\u6570\u306e\u95a2\u6570\u3092\u53d7\u3051\u53d6\u308a\u3001\u305d\u308c\u3089\u3092\u540c\u3058\u5f15\u6570\u306b\u9069\u7528\u3057\u3066\u30d9\u30af\u30bf\u30fc\u3067\u7d50\u679c\u3092\u8fd4\u3059\u95a2\u6570\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002</p> <pre><code>(defn get-stats\n  \"\u6570\u5024\u30ea\u30b9\u30c8\u306e\u7d71\u8a08\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\"\n  [numbers]\n  ((juxt first last count #(apply min %) #(apply max %)) numbers))\n\n(get-stats [3 1 4 1 5 9 2 6])\n;; =&gt; [3 6 8 1 9]\n;; [\u6700\u521d\u306e\u5024, \u6700\u5f8c\u306e\u5024, \u8981\u7d20\u6570, \u6700\u5c0f\u5024, \u6700\u5927\u5024]\n</code></pre>"},{"location":"clojure/02-function-composition/#_3","title":"\u5b9f\u7528\u4f8b\uff1a\u30c7\u30fc\u30bf\u5206\u6790","text":"<pre><code>(defn analyze-person\n  \"\u4eba\u7269\u60c5\u5831\u3092\u5206\u6790\u3059\u308b\"\n  [person]\n  ((juxt :name :age #(if (&gt;= (:age %) 18) :adult :minor)) person))\n\n(analyze-person {:name \"\u7530\u4e2d\" :age 25})\n;; =&gt; [\"\u7530\u4e2d\" 25 :adult]\n\n(analyze-person {:name \"\u9234\u6728\" :age 15})\n;; =&gt; [\"\u9234\u6728\" 15 :minor]\n</code></pre>"},{"location":"clojure/02-function-composition/#4","title":"4. \u9ad8\u968e\u95a2\u6570\u306b\u3088\u308b\u30c7\u30fc\u30bf\u51e6\u7406","text":"<p>\u9ad8\u968e\u95a2\u6570\u3068\u306f\u3001\u95a2\u6570\u3092\u5f15\u6570\u3068\u3057\u3066\u53d7\u3051\u53d6\u308b\u304b\u3001\u95a2\u6570\u3092\u8fd4\u3059\u95a2\u6570\u306e\u3053\u3068\u3067\u3059\u3002</p>"},{"location":"clojure/02-function-composition/#_4","title":"\u30ed\u30b0\u51fa\u529b\u306e\u30e9\u30c3\u30d1\u30fc","text":"<pre><code>(defn process-with-logging\n  \"\u51e6\u7406\u3092\u30e9\u30c3\u30d7\u3057\u3066\u30ed\u30b0\u3092\u51fa\u529b\u3059\u308b\u9ad8\u968e\u95a2\u6570\"\n  [f]\n  (fn [&amp; args]\n    (println \"\u5165\u529b:\" args)\n    (let [result (apply f args)]\n      (println \"\u51fa\u529b:\" result)\n      result)))\n\n(def add-with-log (process-with-logging +))\n(add-with-log 2 3)\n;; \u5165\u529b: (2 3)\n;; \u51fa\u529b: 5\n;; =&gt; 5\n</code></pre>"},{"location":"clojure/02-function-composition/#_5","title":"\u30ea\u30c8\u30e9\u30a4\u6a5f\u80fd\u306e\u8ffd\u52a0","text":"<pre><code>(defn retry\n  \"\u5931\u6557\u6642\u306b\u30ea\u30c8\u30e9\u30a4\u3059\u308b\u9ad8\u968e\u95a2\u6570\"\n  [f max-retries]\n  (fn [&amp; args]\n    (loop [attempts 0]\n      (let [result (try\n                     {:success true :value (apply f args)}\n                     (catch Exception e\n                       {:success false :error e}))]\n        (if (:success result)\n          (:value result)\n          (if (&lt; attempts max-retries)\n            (recur (inc attempts))\n            (throw (:error result))))))))\n\n;; \u4e0d\u5b89\u5b9a\u306aAPI\u547c\u3073\u51fa\u3057\u3092\u30ea\u30c8\u30e9\u30a4\u4ed8\u304d\u3067\u30e9\u30c3\u30d7\n(def fetch-with-retry (retry fetch-data 3))\n</code></pre>"},{"location":"clojure/02-function-composition/#ttl","title":"TTL \u4ed8\u304d\u30e1\u30e2\u5316","text":"<pre><code>(defn memoize-with-ttl\n  \"TTL\u4ed8\u304d\u30e1\u30e2\u5316\u3092\u884c\u3046\u9ad8\u968e\u95a2\u6570\"\n  [f ttl-ms]\n  (let [cache (atom {})]\n    (fn [&amp; args]\n      (let [now (System/currentTimeMillis)\n            cached (get @cache args)]\n        (if (and cached (&lt; (- now (:time cached)) ttl-ms))\n          (:value cached)\n          (let [result (apply f args)]\n            (swap! cache assoc args {:value result :time now})\n            result))))))\n</code></pre>"},{"location":"clojure/02-function-composition/#5","title":"5. \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u51e6\u7406","text":"<p>\u8907\u6570\u306e\u95a2\u6570\u3092\u9806\u6b21\u9069\u7528\u3059\u308b\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002</p> <pre><code>(defn pipeline\n  \"\u95a2\u6570\u306e\u30ea\u30b9\u30c8\u3092\u9806\u6b21\u9069\u7528\u3059\u308b\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u4f5c\u6210\u3059\u308b\"\n  [&amp; fns]\n  (fn [input]\n    (reduce (fn [acc f] (f acc)) input fns)))\n</code></pre>"},{"location":"clojure/02-function-composition/#_6","title":"\u6ce8\u6587\u51e6\u7406\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u5b9f\u88c5","text":"<pre><code>(defn validate-order\n  \"\u6ce8\u6587\u3092\u691c\u8a3c\u3059\u308b\"\n  [order]\n  (if (empty? (:items order))\n    (throw (ex-info \"\u6ce8\u6587\u306b\u30a2\u30a4\u30c6\u30e0\u304c\u3042\u308a\u307e\u305b\u3093\" {:order order}))\n    order))\n\n(defn calculate-order-total\n  \"\u6ce8\u6587\u5408\u8a08\u3092\u8a08\u7b97\u3059\u308b\"\n  [order]\n  (let [total (-&gt;&gt; (:items order)\n                   (map #(* (:price %) (:quantity %)))\n                   (reduce +))]\n    (assoc order :total total)))\n\n(defn apply-order-discount\n  \"\u6ce8\u6587\u5272\u5f15\u3092\u9069\u7528\u3059\u308b\"\n  [order]\n  (let [discount-rate (get {:gold 0.1 :silver 0.05 :bronze 0.02}\n                           (get-in order [:customer :membership])\n                           0)]\n    (update order :total #(* % (- 1 discount-rate)))))\n\n(defn add-shipping\n  \"\u9001\u6599\u3092\u8ffd\u52a0\u3059\u308b\"\n  [order]\n  (let [shipping (if (&gt;= (:total order) 5000) 0 500)]\n    (-&gt; order\n        (assoc :shipping shipping)\n        (update :total + shipping))))\n\n(def process-order-pipeline\n  \"\u6ce8\u6587\u51e6\u7406\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\"\n  (pipeline validate-order\n            calculate-order-total\n            apply-order-discount\n            add-shipping))\n\n;; \u4f7f\u7528\u4f8b\n(process-order-pipeline\n  {:items [{:price 1000 :quantity 2}\n           {:price 500 :quantity 3}]\n   :customer {:membership :gold}})\n;; =&gt; {:items [...] :customer {...} :total 3650.0 :shipping 500}\n</code></pre>"},{"location":"clojure/02-function-composition/#6","title":"6. \u95a2\u6570\u5408\u6210\u306b\u3088\u308b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3","text":"<p>\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30ed\u30b8\u30c3\u30af\u3092\u95a2\u6570\u5408\u6210\u3067\u8868\u73fe\u3057\u307e\u3059\u3002</p> <pre><code>(defn validator\n  \"\u30d0\u30ea\u30c7\u30fc\u30bf\u3092\u4f5c\u6210\u3059\u308b\u9ad8\u968e\u95a2\u6570\"\n  [pred error-msg]\n  (fn [value]\n    (if (pred value)\n      {:valid true :value value}\n      {:valid false :error error-msg :value value})))\n\n(defn combine-validators\n  \"\u8907\u6570\u306e\u30d0\u30ea\u30c7\u30fc\u30bf\u3092\u5408\u6210\u3059\u308b\"\n  [&amp; validators]\n  (fn [value]\n    (reduce (fn [result v]\n              (if (:valid result)\n                (v (:value result))\n                result))\n            {:valid true :value value}\n            validators)))\n\n;; \u500b\u5225\u306e\u30d0\u30ea\u30c7\u30fc\u30bf\n(def validate-positive (validator pos? \"\u5024\u306f\u6b63\u306e\u6570\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"))\n(def validate-under-100 (validator #(&lt; % 100) \"\u5024\u306f100\u672a\u6e80\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"))\n(def validate-integer (validator integer? \"\u5024\u306f\u6574\u6570\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"))\n\n;; \u30d0\u30ea\u30c7\u30fc\u30bf\u306e\u5408\u6210\n(def validate-quantity\n  \"\u6570\u91cf\u30d0\u30ea\u30c7\u30fc\u30bf\"\n  (combine-validators validate-integer\n                      validate-positive\n                      validate-under-100))\n\n;; \u4f7f\u7528\u4f8b\n(validate-quantity 50)   ;; =&gt; {:valid true, :value 50}\n(validate-quantity -1)   ;; =&gt; {:valid false, :error \"\u5024\u306f\u6b63\u306e\u6570\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\", :value -1}\n(validate-quantity 100)  ;; =&gt; {:valid false, :error \"\u5024\u306f100\u672a\u6e80\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\", :value 100}\n</code></pre>"},{"location":"clojure/02-function-composition/#7","title":"7. \u95a2\u6570\u306e\u5909\u63db","text":"<p>\u95a2\u6570\u81ea\u4f53\u3092\u5909\u63db\u3059\u308b\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u95a2\u6570\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002</p>"},{"location":"clojure/02-function-composition/#_7","title":"\u5f15\u6570\u306e\u9806\u5e8f\u3092\u53cd\u8ee2","text":"<pre><code>(defn flip\n  \"\u5f15\u6570\u306e\u9806\u5e8f\u3092\u53cd\u8ee2\u3059\u308b\"\n  [f]\n  (fn [a b]\n    (f b a)))\n\n((flip -) 3 5)  ;; =&gt; 2  (5 - 3)\n</code></pre>"},{"location":"clojure/02-function-composition/#_8","title":"\u30ab\u30ea\u30fc\u5316","text":"<pre><code>(defn curry\n  \"2\u5f15\u6570\u95a2\u6570\u3092\u30ab\u30ea\u30fc\u5316\u3059\u308b\"\n  [f]\n  (fn [a]\n    (fn [b]\n      (f a b))))\n\n(defn uncurry\n  \"\u30ab\u30ea\u30fc\u5316\u3055\u308c\u305f\u95a2\u6570\u3092\u5143\u306b\u623b\u3059\"\n  [f]\n  (fn [a b]\n    ((f a) b)))\n\n(def curried-add (curry +))\n(def add5 (curried-add 5))\n(add5 3)  ;; =&gt; 8\n</code></pre>"},{"location":"clojure/02-function-composition/#8","title":"8. \u95a2\u6570\u5408\u6210\u306e\u30d1\u30bf\u30fc\u30f3","text":""},{"location":"clojure/02-function-composition/#_9","title":"\u8ff0\u8a9e\u306e\u5408\u6210","text":"<pre><code>(defn compose-predicates\n  \"\u8907\u6570\u306e\u8ff0\u8a9e\u3092 AND \u3067\u5408\u6210\u3059\u308b\"\n  [&amp; preds]\n  (fn [x]\n    (every? #(% x) preds)))\n\n(defn compose-predicates-or\n  \"\u8907\u6570\u306e\u8ff0\u8a9e\u3092 OR \u3067\u5408\u6210\u3059\u308b\"\n  [&amp; preds]\n  (fn [x]\n    (some #(% x) preds)))\n\n;; \u6709\u52b9\u306a\u5e74\u9f62\u30c1\u30a7\u30c3\u30af\n(def valid-age?\n  (compose-predicates integer?\n                      pos?\n                      #(&lt;= % 150)))\n\n(valid-age? 25)   ;; =&gt; true\n(valid-age? -1)   ;; =&gt; false\n(valid-age? 200)  ;; =&gt; false\n\n;; \u30d7\u30ec\u30df\u30a2\u30e0\u9867\u5ba2\u30c1\u30a7\u30c3\u30af\n(def premium-customer?\n  (compose-predicates-or\n   #(= (:membership %) :gold)\n   #(&gt;= (:purchase-count %) 100)\n   #(&gt;= (:total-spent %) 100000)))\n\n(premium-customer? {:membership :gold})           ;; =&gt; true\n(premium-customer? {:purchase-count 150})         ;; =&gt; true\n(premium-customer? {:membership :bronze\n                    :purchase-count 10})          ;; =&gt; false\n</code></pre>"},{"location":"clojure/02-function-composition/#_10","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u95a2\u6570\u5408\u6210\u3068\u9ad8\u968e\u95a2\u6570\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>comp: \u8907\u6570\u306e\u95a2\u6570\u3092\u5408\u6210\u3057\u3066\u65b0\u3057\u3044\u95a2\u6570\u3092\u4f5c\u6210</li> <li>partial: \u5f15\u6570\u3092\u90e8\u5206\u9069\u7528\u3057\u3066\u7279\u5316\u3057\u305f\u95a2\u6570\u3092\u4f5c\u6210</li> <li>juxt: \u8907\u6570\u306e\u95a2\u6570\u3092\u4e26\u5217\u9069\u7528\u3057\u3066\u30d9\u30af\u30bf\u30fc\u3067\u7d50\u679c\u3092\u53d6\u5f97</li> <li>\u9ad8\u968e\u95a2\u6570: \u30ed\u30b0\u3001\u30ea\u30c8\u30e9\u30a4\u3001\u30e1\u30e2\u5316\u306a\u3069\u306e\u6a2a\u65ad\u7684\u95a2\u5fc3\u4e8b\u3092\u62bd\u8c61\u5316</li> <li>\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3: \u51e6\u7406\u306e\u6d41\u308c\u3092\u95a2\u6570\u306e\u30c1\u30a7\u30fc\u30f3\u3068\u3057\u3066\u8868\u73fe</li> <li>\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3: \u95a2\u6570\u5408\u6210\u306b\u3088\u308b\u67d4\u8edf\u306a\u691c\u8a3c\u30ed\u30b8\u30c3\u30af</li> <li>\u8ff0\u8a9e\u5408\u6210: AND/OR \u3067\u8907\u6570\u306e\u6761\u4ef6\u3092\u7d44\u307f\u5408\u308f\u305b</li> </ol> <p>\u3053\u308c\u3089\u306e\u30c6\u30af\u30cb\u30c3\u30af\u306b\u3088\u308a\u3001\u5c0f\u3055\u304f\u518d\u5229\u7528\u53ef\u80fd\u306a\u95a2\u6570\u304b\u3089\u8907\u96d1\u306a\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u3092\u69cb\u7bc9\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"clojure/02-function-composition/#_11","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part1/src/composition.clj</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part1/spec/composition_spec.clj</code></li> </ul>"},{"location":"clojure/02-function-composition/#_12","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001\u591a\u614b\u6027\u3068\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u3001\u30d7\u30ed\u30c8\u30b3\u30eb\u3001\u30ec\u30b3\u30fc\u30c9\u3092\u6d3b\u7528\u3057\u305f\u67d4\u8edf\u306a\u8a2d\u8a08\u30d1\u30bf\u30fc\u30f3\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/03-polymorphism/","title":"\u7b2c3\u7ae0: \u591a\u614b\u6027\u3068\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1","text":""},{"location":"clojure/03-polymorphism/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u591a\u614b\u6027\uff08\u30dd\u30ea\u30e2\u30fc\u30d5\u30a3\u30ba\u30e0\uff09\u306f\u3001\u540c\u3058\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u7570\u306a\u308b\u632f\u308b\u821e\u3044\u3092\u5b9f\u73fe\u3059\u308b\u5f37\u529b\u306a\u6982\u5ff5\u3067\u3059\u3002Clojure \u3067\u306f\u3001\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u3001\u30d7\u30ed\u30c8\u30b3\u30eb\u3001\u30ec\u30b3\u30fc\u30c9\u3068\u3044\u30463\u3064\u306e\u4e3b\u8981\u306a\u30e1\u30ab\u30cb\u30ba\u30e0\u3067\u591a\u614b\u6027\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u3053\u308c\u3089\u306e\u30e1\u30ab\u30cb\u30ba\u30e0\u3092\u4f7f\u3044\u5206\u3051\u3066\u3001\u67d4\u8edf\u3067\u62e1\u5f35\u6027\u306e\u9ad8\u3044\u30b3\u30fc\u30c9\u3092\u66f8\u304f\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/03-polymorphism/#1-multimethods","title":"1. \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\uff08Multimethods\uff09","text":"<p>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306f\u3001\u4efb\u610f\u306e\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u95a2\u6570\u306b\u57fa\u3065\u3044\u3066\u7570\u306a\u308b\u5b9f\u88c5\u3092\u9078\u629e\u3067\u304d\u308b\u3001\u6700\u3082\u67d4\u8edf\u306a\u591a\u614b\u6027\u30e1\u30ab\u30cb\u30ba\u30e0\u3067\u3059\u3002</p>"},{"location":"clojure/03-polymorphism/#_2","title":"\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9","text":"<pre><code>;; \u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u95a2\u6570\u3092\u5b9a\u7fa9\n(defmulti calculate-area\n  \"\u56f3\u5f62\u306e\u9762\u7a4d\u3092\u8a08\u7b97\u3059\u308b\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\"\n  :shape)\n\n;; \u5404\u56f3\u5f62\u30bf\u30a4\u30d7\u306b\u5bfe\u3059\u308b\u5b9f\u88c5\n(defmethod calculate-area :rectangle\n  [{:keys [width height]}]\n  (* width height))\n\n(defmethod calculate-area :circle\n  [{:keys [radius]}]\n  (* Math/PI radius radius))\n\n(defmethod calculate-area :triangle\n  [{:keys [base height]}]\n  (/ (* base height) 2))\n\n(defmethod calculate-area :default\n  [shape]\n  (throw (ex-info \"\u672a\u77e5\u306e\u56f3\u5f62\u30bf\u30a4\u30d7\" {:shape shape})))\n\n;; \u4f7f\u7528\u4f8b\n(calculate-area {:shape :rectangle :width 4 :height 5})  ;; =&gt; 20\n(calculate-area {:shape :circle :radius 3})              ;; =&gt; 28.27...\n(calculate-area {:shape :triangle :base 6 :height 5})    ;; =&gt; 15\n</code></pre>"},{"location":"clojure/03-polymorphism/#_3","title":"\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306e\u5229\u70b9","text":"<ol> <li>\u30aa\u30fc\u30d7\u30f3\u306a\u62e1\u5f35\u6027: \u65b0\u3057\u3044\u578b\u3092\u8ffd\u52a0\u3057\u3066\u3082\u65e2\u5b58\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u4e0d\u8981</li> <li>\u4efb\u610f\u306e\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1: \u578b\u3060\u3051\u3067\u306a\u304f\u4efb\u610f\u306e\u5024\u306b\u57fa\u3065\u3044\u3066\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u53ef\u80fd</li> <li>\u30c7\u30fc\u30bf\u99c6\u52d5: \u30c7\u30fc\u30bf\u306e\u5c5e\u6027\u306b\u57fa\u3065\u3044\u3066\u632f\u308b\u821e\u3044\u3092\u6c7a\u5b9a</li> </ol>"},{"location":"clojure/03-polymorphism/#2","title":"2. \u8907\u5408\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1","text":"<p>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306f\u8907\u6570\u306e\u5024\u306b\u57fa\u3065\u3044\u3066\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u3067\u304d\u307e\u3059\u3002</p> <pre><code>(defmulti process-payment\n  \"\u652f\u6255\u3044\u3092\u51e6\u7406\u3059\u308b\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\uff08\u652f\u6255\u3044\u65b9\u6cd5\u3068\u901a\u8ca8\u3067\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\uff09\"\n  (fn [payment] [(:method payment) (:currency payment)]))\n\n(defmethod process-payment [:credit-card :jpy]\n  [payment]\n  {:status :processed\n   :message \"\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\uff08\u5186\uff09\u3067\u51e6\u7406\u3057\u307e\u3057\u305f\"\n   :amount (:amount payment)})\n\n(defmethod process-payment [:credit-card :usd]\n  [payment]\n  {:status :processed\n   :message \"Credit card (USD) processed\"\n   :amount (:amount payment)\n   :converted (* (:amount payment) 150)})\n\n(defmethod process-payment [:bank-transfer :jpy]\n  [payment]\n  {:status :pending\n   :message \"\u9280\u884c\u632f\u8fbc\u3092\u53d7\u3051\u4ed8\u3051\u307e\u3057\u305f\"\n   :amount (:amount payment)})\n\n(defmethod process-payment :default\n  [payment]\n  {:status :error\n   :message \"\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u652f\u6255\u3044\u65b9\u6cd5\u3067\u3059\"})\n\n;; \u4f7f\u7528\u4f8b\n(process-payment {:method :credit-card :currency :jpy :amount 1000})\n;; =&gt; {:status :processed, :message \"\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\uff08\u5186\uff09\u3067\u51e6\u7406\u3057\u307e\u3057\u305f\", :amount 1000}\n</code></pre>"},{"location":"clojure/03-polymorphism/#3_1","title":"3. \u968e\u5c64\u7684\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1","text":"<p>Clojure \u3067\u306f\u578b\u306e\u968e\u5c64\u3092\u5b9a\u7fa9\u3057\u3066\u3001\u7d99\u627f\u7684\u306a\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u3092\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002</p> <pre><code>;; \u578b\u968e\u5c64\u3092\u5b9a\u7fa9\n(derive ::savings ::account)\n(derive ::checking ::account)\n(derive ::premium-savings ::savings)\n\n(defmulti calculate-interest\n  \"\u5229\u606f\u3092\u8a08\u7b97\u3059\u308b\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\uff08\u53e3\u5ea7\u30bf\u30a4\u30d7\u3067\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\uff09\"\n  :account-type)\n\n(defmethod calculate-interest ::savings\n  [{:keys [balance]}]\n  (* balance 0.02))\n\n(defmethod calculate-interest ::premium-savings\n  [{:keys [balance]}]\n  (* balance 0.05))\n\n(defmethod calculate-interest ::checking\n  [{:keys [balance]}]\n  (* balance 0.001))\n\n(defmethod calculate-interest ::account\n  [{:keys [balance]}]\n  (* balance 0.01))\n\n;; \u4f7f\u7528\u4f8b\n(calculate-interest {:account-type ::savings :balance 10000})\n;; =&gt; 200.0\n\n(calculate-interest {:account-type ::premium-savings :balance 10000})\n;; =&gt; 500.0\uff08\u6d3e\u751f\u578b\u306e\u5b9f\u88c5\u304c\u512a\u5148\u3055\u308c\u308b\uff09\n</code></pre>"},{"location":"clojure/03-polymorphism/#4-protocols","title":"4. \u30d7\u30ed\u30c8\u30b3\u30eb\uff08Protocols\uff09","text":"<p>\u30d7\u30ed\u30c8\u30b3\u30eb\u306f\u3001\u7279\u5b9a\u306e\u64cd\u4f5c\u30bb\u30c3\u30c8\u3092\u5b9a\u7fa9\u3059\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u3059\u3002Java \u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306b\u4f3c\u3066\u3044\u307e\u3059\u304c\u3001\u65e2\u5b58\u306e\u578b\u306b\u5f8c\u304b\u3089\u5b9f\u88c5\u3092\u8ffd\u52a0\u3067\u304d\u308b\u70b9\u304c\u7570\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/03-polymorphism/#_4","title":"\u30d7\u30ed\u30c8\u30b3\u30eb\u306e\u5b9a\u7fa9","text":"<pre><code>(defprotocol Drawable\n  \"\u63cf\u753b\u53ef\u80fd\u306a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\"\n  (draw [this] \"\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u63cf\u753b\u3059\u308b\")\n  (bounding-box [this] \"\u30d0\u30a6\u30f3\u30c7\u30a3\u30f3\u30b0\u30dc\u30c3\u30af\u30b9\u3092\u53d6\u5f97\u3059\u308b\"))\n\n(defprotocol Transformable\n  \"\u5909\u63db\u53ef\u80fd\u306a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\"\n  (translate [this dx dy] \"\u79fb\u52d5\u3059\u308b\")\n  (scale [this factor] \"\u62e1\u5927\u30fb\u7e2e\u5c0f\u3059\u308b\")\n  (rotate [this angle] \"\u56de\u8ee2\u3059\u308b\"))\n</code></pre>"},{"location":"clojure/03-polymorphism/#_5","title":"\u30d7\u30ed\u30c8\u30b3\u30eb\u306e\u5229\u70b9","text":"<ol> <li>\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9: \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u3088\u308a\u9ad8\u901f\uff08\u578b\u30d9\u30fc\u30b9\u306e\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u306b\u7279\u5316\uff09</li> <li>\u660e\u78ba\u306a\u30b3\u30f3\u30c8\u30e9\u30af\u30c8: \u5b9f\u88c5\u3059\u3079\u304d\u30e1\u30bd\u30c3\u30c9\u304c\u660e\u793a\u7684</li> <li>\u65e2\u5b58\u578b\u3078\u306e\u62e1\u5f35: \u5f8c\u304b\u3089\u4efb\u610f\u306e\u578b\u306b\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u5b9f\u88c5\u53ef\u80fd</li> </ol>"},{"location":"clojure/03-polymorphism/#5-records","title":"5. \u30ec\u30b3\u30fc\u30c9\uff08Records\uff09","text":"<p>\u30ec\u30b3\u30fc\u30c9\u306f\u30de\u30c3\u30d7\u306b\u4f3c\u305f\u30c7\u30fc\u30bf\u69cb\u9020\u3067\u3001\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p> <pre><code>(defrecord Rectangle [x y width height]\n  Drawable\n  (draw [this]\n    (str \"Rectangle at (\" x \",\" y \") with size \" width \"x\" height))\n  (bounding-box [this]\n    {:x x :y y :width width :height height})\n\n  Transformable\n  (translate [this dx dy]\n    (-&gt;Rectangle (+ x dx) (+ y dy) width height))\n  (scale [this factor]\n    (-&gt;Rectangle x y (* width factor) (* height factor)))\n  (rotate [this angle]\n    this))\n\n(defrecord Circle [x y radius]\n  Drawable\n  (draw [this]\n    (str \"Circle at (\" x \",\" y \") with radius \" radius))\n  (bounding-box [this]\n    {:x (- x radius) :y (- y radius)\n     :width (* 2 radius) :height (* 2 radius)})\n\n  Transformable\n  (translate [this dx dy]\n    (-&gt;Circle (+ x dx) (+ y dy) radius))\n  (scale [this factor]\n    (-&gt;Circle x y (* radius factor)))\n  (rotate [this angle]\n    this))\n\n;; \u4f7f\u7528\u4f8b\n(def rect (-&gt;Rectangle 10 20 100 50))\n(draw rect)           ;; =&gt; \"Rectangle at (10,20) with size 100x50\"\n(translate rect 5 10) ;; =&gt; #Rectangle{:x 15, :y 30, :width 100, :height 50}\n\n(def circle (-&gt;Circle 50 50 25))\n(bounding-box circle) ;; =&gt; {:x 25, :y 25, :width 50, :height 50}\n</code></pre>"},{"location":"clojure/03-polymorphism/#6","title":"6. \u65e2\u5b58\u306e\u578b\u306b\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u62e1\u5f35","text":"<p><code>extend-protocol</code> \u3092\u4f7f\u3063\u3066\u3001\u65e2\u5b58\u306e\u578b\u306b\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p> <pre><code>(defprotocol Stringable\n  \"\u6587\u5b57\u5217\u306b\u5909\u63db\u53ef\u80fd\u306a\u30d7\u30ed\u30c8\u30b3\u30eb\"\n  (to-string [this] \"\u6587\u5b57\u5217\u8868\u73fe\u3092\u8fd4\u3059\"))\n\n(extend-protocol Stringable\n  clojure.lang.IPersistentMap\n  (to-string [this]\n    (str \"{\" (clojure.string/join \", \"\n                                   (map (fn [[k v]] (str (name k) \": \" v)) this)) \"}\"))\n\n  clojure.lang.IPersistentVector\n  (to-string [this]\n    (str \"[\" (clojure.string/join \", \" this) \"]\"))\n\n  java.lang.String\n  (to-string [this] this)\n\n  java.lang.Number\n  (to-string [this] (str this))\n\n  nil\n  (to-string [this] \"nil\"))\n\n;; \u4f7f\u7528\u4f8b\n(to-string {:name \"\u7530\u4e2d\" :age 30})  ;; =&gt; \"{name: \u7530\u4e2d, age: 30}\"\n(to-string [1 2 3])                  ;; =&gt; \"[1, 2, 3]\"\n(to-string nil)                      ;; =&gt; \"nil\"\n</code></pre>"},{"location":"clojure/03-polymorphism/#7","title":"7. \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u30d1\u30bf\u30fc\u30f3","text":"<p>\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u4f7f\u3063\u3066\u3001\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u7ba1\u7406\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p> <pre><code>(defprotocol Lifecycle\n  \"\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u7ba1\u7406\u30d7\u30ed\u30c8\u30b3\u30eb\"\n  (start [this] \"\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u958b\u59cb\u3059\u308b\")\n  (stop [this] \"\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u505c\u6b62\u3059\u308b\"))\n\n(defrecord DatabaseConnection [host port connected?]\n  Lifecycle\n  (start [this]\n    (println \"\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u63a5\u7d9a\u4e2d:\" host \":\" port)\n    (assoc this :connected? true))\n  (stop [this]\n    (println \"\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\u3092\u5207\u65ad\u4e2d\")\n    (assoc this :connected? false)))\n\n(defrecord WebServer [port db running?]\n  Lifecycle\n  (start [this]\n    (println \"Web\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u4e2d \u30dd\u30fc\u30c8:\" port)\n    (let [started-db (start db)]\n      (assoc this :db started-db :running? true)))\n  (stop [this]\n    (println \"Web\u30b5\u30fc\u30d0\u30fc\u3092\u505c\u6b62\u4e2d\")\n    (let [stopped-db (stop db)]\n      (assoc this :db stopped-db :running? false))))\n\n;; \u4f7f\u7528\u4f8b\n(def db (-&gt;DatabaseConnection \"localhost\" 5432 false))\n(def server (-&gt;WebServer 8080 db false))\n\n(def started-server (start server))\n;; \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u63a5\u7d9a\u4e2d: localhost : 5432\n;; Web\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u4e2d \u30dd\u30fc\u30c8: 8080\n\n(def stopped-server (stop started-server))\n;; Web\u30b5\u30fc\u30d0\u30fc\u3092\u505c\u6b62\u4e2d\n;; \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\u3092\u5207\u65ad\u4e2d\n</code></pre>"},{"location":"clojure/03-polymorphism/#8","title":"8. \u6761\u4ef6\u5206\u5c90\u306e\u7f6e\u304d\u63db\u3048","text":"<p>\u591a\u614b\u6027\u3092\u4f7f\u3063\u3066\u3001switch/case \u6587\u306b\u3088\u308b\u578b\u5224\u5b9a\u3092\u6392\u9664\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"clojure/03-polymorphism/#before","title":"Before\uff08\u6761\u4ef6\u5206\u5c90\uff09","text":"<pre><code>;; \u60aa\u3044\u4f8b\uff1a\u578b\u306b\u3088\u308b\u6761\u4ef6\u5206\u5c90\n(defn send-notification-bad [type message opts]\n  (case type\n    :email {:type :email :to (:to opts) :body message}\n    :sms {:type :sms :to (:phone opts) :body (subs message 0 (min 160 (count message)))}\n    :push {:type :push :device (:device opts) :body message}\n    (throw (ex-info \"\u672a\u77e5\u306e\u901a\u77e5\u30bf\u30a4\u30d7\" {:type type}))))\n</code></pre>"},{"location":"clojure/03-polymorphism/#after","title":"After\uff08\u591a\u614b\u6027\uff09","text":"<pre><code>(defprotocol NotificationSender\n  \"\u901a\u77e5\u9001\u4fe1\u30d7\u30ed\u30c8\u30b3\u30eb\"\n  (send-notification [this message] \"\u901a\u77e5\u3092\u9001\u4fe1\u3059\u308b\")\n  (get-delivery-time [this] \"\u914d\u4fe1\u6642\u9593\u3092\u53d6\u5f97\u3059\u308b\"))\n\n(defrecord EmailNotification [to subject]\n  NotificationSender\n  (send-notification [this message]\n    {:type :email\n     :to to\n     :subject subject\n     :body message\n     :status :sent})\n  (get-delivery-time [this]\n    \"1-2\u5206\"))\n\n(defrecord SMSNotification [phone-number]\n  NotificationSender\n  (send-notification [this message]\n    {:type :sms\n     :to phone-number\n     :body (if (&gt; (count message) 160)\n             (subs message 0 157)\n             message)\n     :status :sent})\n  (get-delivery-time [this]\n    \"\u6570\u79d2\"))\n\n(defrecord PushNotification [device-token]\n  NotificationSender\n  (send-notification [this message]\n    {:type :push\n     :device device-token\n     :body message\n     :status :sent})\n  (get-delivery-time [this]\n    \"\u5373\u6642\"))\n\n;; \u30d5\u30a1\u30af\u30c8\u30ea\u95a2\u6570\n(defn create-notification\n  \"\u901a\u77e5\u30bf\u30a4\u30d7\u306b\u5fdc\u3058\u305f\u901a\u77e5\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3059\u308b\"\n  [type &amp; {:as opts}]\n  (case type\n    :email (-&gt;EmailNotification (:to opts) (:subject opts \"\u901a\u77e5\"))\n    :sms (-&gt;SMSNotification (:phone opts))\n    :push (-&gt;PushNotification (:device opts))\n    (throw (ex-info \"\u672a\u77e5\u306e\u901a\u77e5\u30bf\u30a4\u30d7\" {:type type}))))\n\n;; \u4f7f\u7528\u4f8b\n(def email (create-notification :email :to \"user@example.com\"))\n(send-notification email \"\u91cd\u8981\u306a\u304a\u77e5\u3089\u305b\")\n;; =&gt; {:type :email, :to \"user@example.com\", :subject \"\u901a\u77e5\", :body \"\u91cd\u8981\u306a\u304a\u77e5\u3089\u305b\", :status :sent}\n</code></pre>"},{"location":"clojure/03-polymorphism/#9","title":"9. \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u3068\u30d7\u30ed\u30c8\u30b3\u30eb\u306e\u4f7f\u3044\u5206\u3051","text":"\u7279\u5fb4 \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9 \u30d7\u30ed\u30c8\u30b3\u30eb \u30c7\u30a3\u30b9\u30d1\u30c3\u30c1 \u4efb\u610f\u306e\u95a2\u6570 \u7b2c\u4e00\u5f15\u6570\u306e\u578b \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9 \u9045\u3044 \u901f\u3044 \u62e1\u5f35\u6027 \u975e\u5e38\u306b\u9ad8\u3044 \u9ad8\u3044 \u7528\u9014 \u8907\u96d1\u306a\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1 \u578b\u30d9\u30fc\u30b9\u306e\u591a\u614b\u6027"},{"location":"clojure/03-polymorphism/#_6","title":"\u4f7f\u3044\u5206\u3051\u306e\u6307\u91dd","text":"<ul> <li>\u30d7\u30ed\u30c8\u30b3\u30eb: \u578b\u306b\u57fa\u3065\u304f\u5358\u7d14\u306a\u591a\u614b\u6027\u3067\u5341\u5206\u306a\u5834\u5408</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: \u8907\u6570\u306e\u5024\u3084\u8907\u96d1\u306a\u6761\u4ef6\u3067\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u304c\u5fc5\u8981\u306a\u5834\u5408</li> </ul>"},{"location":"clojure/03-polymorphism/#_7","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Clojure \u306b\u304a\u3051\u308b\u591a\u614b\u6027\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: \u4efb\u610f\u306e\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u95a2\u6570\u306b\u3088\u308b\u67d4\u8edf\u306a\u591a\u614b\u6027</li> <li>\u8907\u5408\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1: \u8907\u6570\u306e\u5024\u306b\u57fa\u3065\u304f\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1</li> <li>\u968e\u5c64\u7684\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1: \u578b\u968e\u5c64\u3092\u4f7f\u3063\u305f\u7d99\u627f\u7684\u306a\u632f\u308b\u821e\u3044</li> <li>\u30d7\u30ed\u30c8\u30b3\u30eb: \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u826f\u3044\u578b\u30d9\u30fc\u30b9\u306e\u591a\u614b\u6027</li> <li>\u30ec\u30b3\u30fc\u30c9: \u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u5b9f\u88c5\u3059\u308b\u30c7\u30fc\u30bf\u69cb\u9020</li> <li>\u65e2\u5b58\u578b\u3078\u306e\u62e1\u5f35: \u5f8c\u304b\u3089\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u5b9f\u88c5</li> <li>\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u30d1\u30bf\u30fc\u30f3: \u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u7ba1\u7406</li> <li>\u6761\u4ef6\u5206\u5c90\u306e\u7f6e\u304d\u63db\u3048: switch \u6587\u3092\u591a\u614b\u6027\u3067\u4ee3\u66ff</li> </ol> <p>\u3053\u308c\u3089\u306e\u30e1\u30ab\u30cb\u30ba\u30e0\u3092\u9069\u5207\u306b\u4f7f\u3044\u5206\u3051\u308b\u3053\u3068\u3067\u3001\u62e1\u5f35\u6027\u304c\u9ad8\u304f\u4fdd\u5b88\u3057\u3084\u3059\u3044\u30b3\u30fc\u30c9\u3092\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"clojure/03-polymorphism/#_8","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part1/src/polymorphism.clj</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part1/spec/polymorphism_spec.clj</code></li> </ul>"},{"location":"clojure/03-polymorphism/#_9","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u304b\u3089\u7b2c2\u90e8\u300c\u4ed5\u69d8\u3068\u30c6\u30b9\u30c8\u300d\u306b\u5165\u308a\u307e\u3059\u3002Clojure Spec \u3092\u4f7f\u3063\u305f\u30c7\u30fc\u30bf\u306e\u4ed5\u69d8\u5b9a\u7fa9\u3068\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/04-clojure-spec/","title":"\u7b2c4\u7ae0: Clojure Spec \u306b\u3088\u308b\u4ed5\u69d8\u5b9a\u7fa9","text":""},{"location":"clojure/04-clojure-spec/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Clojure Spec \u306f\u3001\u30c7\u30fc\u30bf\u69cb\u9020\u3068\u95a2\u6570\u306e\u4ed5\u69d8\u3092\u5b9a\u7fa9\u3059\u308b\u305f\u3081\u306e\u5f37\u529b\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059\u3002\u578b\u30b7\u30b9\u30c6\u30e0\u3068\u306f\u7570\u306a\u308a\u3001Spec \u306f\u5b9f\u884c\u6642\u306b\u30c7\u30fc\u30bf\u3092\u691c\u8a3c\u3057\u3001\u81ea\u52d5\u30c6\u30b9\u30c8\u3092\u751f\u6210\u3057\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3068\u3057\u3066\u3082\u6a5f\u80fd\u3057\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001Spec \u3092\u4f7f\u3063\u3066\u30c7\u30fc\u30bf\u306e\u4ed5\u69d8\u3092\u5b9a\u7fa9\u3057\u3001\u95a2\u6570\u306e\u5951\u7d04\u3092\u8868\u73fe\u3057\u3001\u81ea\u52d5\u30c6\u30b9\u30c8\u751f\u6210\u3092\u6d3b\u7528\u3059\u308b\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/04-clojure-spec/#1","title":"1. \u57fa\u672c\u7684\u306a\u30b9\u30da\u30c3\u30af\u5b9a\u7fa9","text":""},{"location":"clojure/04-clojure-spec/#_2","title":"\u30b9\u30da\u30c3\u30af\u3068\u306f","text":"<p>\u30b9\u30da\u30c3\u30af\u306f\u3001\u30c7\u30fc\u30bf\u304c\u6e80\u305f\u3059\u3079\u304d\u6761\u4ef6\u3092\u5ba3\u8a00\u7684\u306b\u5b9a\u7fa9\u3057\u307e\u3059\u3002</p> <pre><code>(require '[clojure.spec.alpha :as s])\n\n;; \u30b7\u30f3\u30d7\u30eb\u306a\u30b9\u30da\u30c3\u30af\n(s/def ::name (s/and string? #(&lt; 0 (count %) 100)))\n(s/def ::age (s/and int? #(&lt;= 0 % 150)))\n(s/def ::email (s/and string? #(re-matches #\".+@.+\\..+\" %)))\n\n;; \u5217\u6319\u578b\u306e\u30b9\u30da\u30c3\u30af\n(s/def ::membership #{:bronze :silver :gold :platinum})\n(s/def ::status #{:active :inactive :suspended})\n</code></pre>"},{"location":"clojure/04-clojure-spec/#_3","title":"\u30b9\u30da\u30c3\u30af\u306e\u691c\u8a3c","text":"<pre><code>;; valid? \u3067\u691c\u8a3c\n(s/valid? ::name \"\u7530\u4e2d\u592a\u90ce\")  ;; =&gt; true\n(s/valid? ::name \"\")          ;; =&gt; false\uff08\u7a7a\u6587\u5b57\u5217\uff09\n(s/valid? ::age 25)           ;; =&gt; true\n(s/valid? ::age -1)           ;; =&gt; false\uff08\u8ca0\u306e\u6570\uff09\n\n;; explain \u3067\u30a8\u30e9\u30fc\u8a73\u7d30\u3092\u8868\u793a\n(s/explain ::age -1)\n;; val: -1 fails spec: :user/age predicate: (&lt;= 0 % 150)\n</code></pre>"},{"location":"clojure/04-clojure-spec/#2","title":"2. \u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u306e\u30b9\u30da\u30c3\u30af","text":""},{"location":"clojure/04-clojure-spec/#_4","title":"\u30d9\u30af\u30bf\u30fc\u3068\u30ea\u30b9\u30c8","text":"<pre><code>;; \u30d9\u30af\u30bf\u30fc\u306e\u30b9\u30da\u30c3\u30af\n(s/def ::tags (s/coll-of string? :kind vector? :min-count 0 :max-count 10))\n\n(s/valid? ::tags [\"tag1\" \"tag2\"])  ;; =&gt; true\n(s/valid? ::tags '(\"tag1\"))        ;; =&gt; false\uff08\u30ea\u30b9\u30c8\u306f\u4e0d\u53ef\uff09\n</code></pre>"},{"location":"clojure/04-clojure-spec/#_5","title":"\u30de\u30c3\u30d7\u306e\u30b9\u30da\u30c3\u30af","text":"<pre><code>;; \u5fc5\u9808\u30ad\u30fc\u3068\u30aa\u30d7\u30b7\u30e7\u30f3\u30ad\u30fc\n(s/def ::person\n  (s/keys :req-un [::name ::age]\n          :opt-un [::email ::membership]))\n\n(s/valid? ::person {:name \"\u7530\u4e2d\" :age 30})  ;; =&gt; true\n(s/valid? ::person {:name \"\u7530\u4e2d\" :age 30 :email \"tanaka@example.com\"})  ;; =&gt; true\n(s/valid? ::person {:name \"\u7530\u4e2d\"})  ;; =&gt; false\uff08age \u304c\u6b20\u843d\uff09\n</code></pre>"},{"location":"clojure/04-clojure-spec/#_6","title":"\u5165\u308c\u5b50\u306e\u30de\u30c3\u30d7","text":"<pre><code>(s/def ::street string?)\n(s/def ::city string?)\n(s/def ::postal-code (s/and string? #(re-matches #\"\\d{3}-\\d{4}\" %)))\n\n(s/def ::address\n  (s/keys :req-un [::street ::city ::postal-code]))\n\n(s/def ::person-with-address\n  (s/keys :req-un [::name ::age ::address]))\n\n(s/valid? ::person-with-address\n          {:name \"\u7530\u4e2d\"\n           :age 30\n           :address {:street \"\u6771\u4eac\u90fd\u6e0b\u8c37\u533a1-1-1\"\n                     :city \"\u6e0b\u8c37\u533a\"\n                     :postal-code \"150-0001\"}})\n;; =&gt; true\n</code></pre>"},{"location":"clojure/04-clojure-spec/#3","title":"3. \u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30eb\u306e\u5b9a\u7fa9","text":""},{"location":"clojure/04-clojure-spec/#_7","title":"\u5546\u54c1\u3068\u6ce8\u6587","text":"<pre><code>;; \u5546\u54c1\n(s/def ::product-id (s/and string? #(re-matches #\"PROD-\\d{5}\" %)))\n(s/def ::product-name (s/and string? #(&lt; 0 (count %) 200)))\n(s/def ::price (s/and number? pos?))\n(s/def ::quantity (s/and int? pos?))\n\n(s/def ::product\n  (s/keys :req-un [::product-id ::product-name ::price]\n          :opt-un [::description ::category]))\n\n;; \u6ce8\u6587\u30a2\u30a4\u30c6\u30e0\n(s/def ::order-item\n  (s/keys :req-un [::product-id ::quantity ::price]))\n\n;; \u6ce8\u6587\n(s/def ::order-id (s/and string? #(re-matches #\"ORD-\\d{8}\" %)))\n(s/def ::customer-id (s/and string? #(re-matches #\"CUST-\\d{6}\" %)))\n(s/def ::items (s/coll-of ::order-item :min-count 1))\n\n(s/def ::order\n  (s/keys :req-un [::order-id ::customer-id ::items ::order-date]\n          :opt-un [::total ::status]))\n</code></pre>"},{"location":"clojure/04-clojure-spec/#4-fdef","title":"4. \u95a2\u6570\u4ed5\u69d8\u306e\u5b9a\u7fa9\uff08fdef\uff09","text":""},{"location":"clojure/04-clojure-spec/#fdef","title":"\u57fa\u672c\u7684\u306a fdef","text":"<p><code>s/fdef</code> \u3092\u4f7f\u3063\u3066\u95a2\u6570\u306e\u5f15\u6570\u3001\u623b\u308a\u5024\u3001\u304a\u3088\u3073\u5f15\u6570\u3068\u623b\u308a\u5024\u306e\u95a2\u4fc2\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002</p> <pre><code>(defn calculate-item-total\n  \"\u6ce8\u6587\u30a2\u30a4\u30c6\u30e0\u306e\u5408\u8a08\u3092\u8a08\u7b97\u3059\u308b\"\n  [{:keys [price quantity]}]\n  (* price quantity))\n\n(s/fdef calculate-item-total\n  :args (s/cat :item ::order-item)\n  :ret number?\n  :fn (s/and #(pos? (:ret %))\n             #(= (:ret %)\n                 (* (get-in % [:args :item :price])\n                    (get-in % [:args :item :quantity])))))\n</code></pre>"},{"location":"clojure/04-clojure-spec/#fdef_1","title":"fdef \u306e\u69cb\u6210\u8981\u7d20","text":"<ul> <li>:args: \u5f15\u6570\u306e\u30b9\u30da\u30c3\u30af\uff08<code>s/cat</code> \u3067\u540d\u524d\u4ed8\u304d\u5f15\u6570\u3092\u5b9a\u7fa9\uff09</li> <li>:ret: \u623b\u308a\u5024\u306e\u30b9\u30da\u30c3\u30af</li> <li>:fn: \u5f15\u6570\u3068\u623b\u308a\u5024\u306e\u95a2\u4fc2\u3092\u5b9a\u7fa9\u3059\u308b\u8ff0\u8a9e</li> </ul> <pre><code>(defn apply-discount\n  \"\u5272\u5f15\u3092\u9069\u7528\u3059\u308b\"\n  [total discount-rate]\n  (* total (- 1 discount-rate)))\n\n(s/fdef apply-discount\n  :args (s/cat :total ::total :discount-rate (s/and number? #(&lt;= 0 % 1)))\n  :ret number?\n  :fn #(&lt;= (:ret %) (get-in % [:args :total])))  ;; \u623b\u308a\u5024\u306f\u5143\u306e\u5024\u4ee5\u4e0b\n</code></pre>"},{"location":"clojure/04-clojure-spec/#5","title":"5. \u591a\u5f15\u6570\u3068\u53ef\u5909\u9577\u5f15\u6570","text":""},{"location":"clojure/04-clojure-spec/#_8","title":"\u30aa\u30fc\u30d0\u30fc\u30ed\u30fc\u30c9\u3055\u308c\u305f\u95a2\u6570","text":"<pre><code>(defn create-person\n  \"\u4eba\u7269\u3092\u4f5c\u6210\u3059\u308b\"\n  ([name age]\n   {:name name :age age})\n  ([name age email]\n   {:name name :age age :email email}))\n\n(s/fdef create-person\n  :args (s/alt :two-args (s/cat :name ::name :age ::age)\n               :three-args (s/cat :name ::name :age ::age :email ::email))\n  :ret ::person)\n</code></pre>"},{"location":"clojure/04-clojure-spec/#_9","title":"\u53ef\u5909\u9577\u5f15\u6570","text":"<pre><code>(defn sum-prices\n  \"\u8907\u6570\u306e\u4fa1\u683c\u3092\u5408\u8a08\u3059\u308b\"\n  [&amp; prices]\n  (reduce + 0 prices))\n\n(s/fdef sum-prices\n  :args (s/* ::price)\n  :ret number?)\n</code></pre>"},{"location":"clojure/04-clojure-spec/#6","title":"6. \u6761\u4ef6\u4ed8\u304d\u30b9\u30da\u30c3\u30af\uff08\u30de\u30eb\u30c1\u30b9\u30da\u30c3\u30af\uff09","text":"<p>\u30c7\u30fc\u30bf\u306e\u5185\u5bb9\u306b\u5fdc\u3058\u3066\u7570\u306a\u308b\u30b9\u30da\u30c3\u30af\u3092\u9069\u7528\u3059\u308b\u5834\u5408\u306f\u3001\u30de\u30eb\u30c1\u30b9\u30da\u30c3\u30af\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002</p> <pre><code>(s/def ::notification-type #{:email :sms :push})\n\n(defmulti notification-spec :type)\n\n(defmethod notification-spec :email [_]\n  (s/keys :req-un [::type ::to ::subject ::body]))\n\n(defmethod notification-spec :sms [_]\n  (s/keys :req-un [::type ::phone-number ::body]))\n\n(defmethod notification-spec :push [_]\n  (s/keys :req-un [::type ::device-token ::body]))\n\n(s/def ::notification (s/multi-spec notification-spec :type))\n\n;; \u691c\u8a3c\n(s/valid? ::notification\n          {:type :email\n           :to \"test@example.com\"\n           :subject \"\u30c6\u30b9\u30c8\"\n           :body \"\u672c\u6587\"})\n;; =&gt; true\n\n(s/valid? ::notification\n          {:type :sms\n           :phone-number \"090-1234-5678\"\n           :body \"\u672c\u6587\"})\n;; =&gt; true\n</code></pre>"},{"location":"clojure/04-clojure-spec/#7","title":"7. \u30ab\u30b9\u30bf\u30e0\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf","text":"<p>\u30b9\u30da\u30c3\u30af\u306b\u5bfe\u5fdc\u3059\u308b\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u3092\u81ea\u52d5\u751f\u6210\u3059\u308b\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u3092\u5b9a\u7fa9\u3067\u304d\u307e\u3059\u3002</p> <pre><code>(require '[clojure.spec.gen.alpha :as gen])\n\n(defn product-id-gen\n  \"\u5546\u54c1ID\u306e\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\"\n  []\n  (gen/fmap #(str \"PROD-\" (format \"%05d\" %))\n            (gen/choose 0 99999)))\n\n(s/def ::product-id-with-gen\n  (s/with-gen\n    (s/and string? #(re-matches #\"PROD-\\d{5}\" %))\n    product-id-gen))\n\n;; \u30b5\u30f3\u30d7\u30eb\u751f\u6210\n(gen/sample (s/gen ::product-id-with-gen) 5)\n;; =&gt; (\"PROD-00042\" \"PROD-00001\" \"PROD-12345\" \"PROD-00000\" \"PROD-99999\")\n</code></pre>"},{"location":"clojure/04-clojure-spec/#_10","title":"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306e\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf","text":"<pre><code>(defn email-gen\n  \"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306e\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\"\n  []\n  (gen/fmap (fn [[user domain]]\n              (str user \"@\" domain \".com\"))\n            (gen/tuple (gen/such-that #(not (empty? %))\n                                       (gen/string-alphanumeric))\n                       (gen/such-that #(not (empty? %))\n                                       (gen/string-alphanumeric)))))\n</code></pre>"},{"location":"clojure/04-clojure-spec/#8","title":"8. \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3068\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0","text":""},{"location":"clojure/04-clojure-spec/#_11","title":"\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u95a2\u6570","text":"<pre><code>(defn validate-person\n  \"\u4eba\u7269\u30c7\u30fc\u30bf\u3092\u691c\u8a3c\u3057\u3001\u7d50\u679c\u3092\u8fd4\u3059\"\n  [person]\n  (if (s/valid? ::person person)\n    {:valid true :data person}\n    {:valid false\n     :errors (s/explain-data ::person person)}))\n\n(validate-person {:name \"\u7530\u4e2d\" :age 30})\n;; =&gt; {:valid true, :data {:name \"\u7530\u4e2d\", :age 30}}\n\n(validate-person {:name \"\" :age 30})\n;; =&gt; {:valid false, :errors {...}}\n</code></pre>"},{"location":"clojure/04-clojure-spec/#conform","title":"conform \u306b\u3088\u308b\u5024\u306e\u5909\u63db","text":"<pre><code>(defn conform-or-throw\n  \"\u30b9\u30da\u30c3\u30af\u306b\u9069\u5408\u3057\u306a\u3044\u5834\u5408\u306f\u4f8b\u5916\u3092\u30b9\u30ed\u30fc\"\n  [spec data]\n  (let [conformed (s/conform spec data)]\n    (if (= conformed ::s/invalid)\n      (throw (ex-info \"Validation failed\"\n                      {:spec spec\n                       :data data\n                       :problems (s/explain-data spec data)}))\n      conformed)))\n</code></pre>"},{"location":"clojure/04-clojure-spec/#9","title":"9. \u30a4\u30f3\u30b9\u30c8\u30eb\u30e1\u30f3\u30c6\u30fc\u30b7\u30e7\u30f3","text":"<p>\u958b\u767a\u6642\u306b\u95a2\u6570\u306e\u5f15\u6570\u3092\u81ea\u52d5\u691c\u8a3c\u3067\u304d\u307e\u3059\u3002</p> <pre><code>(require '[clojure.spec.test.alpha :as stest])\n\n;; \u30a4\u30f3\u30b9\u30c8\u30eb\u30e1\u30f3\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u6709\u52b9\u5316\n(stest/instrument)\n\n;; \u3053\u308c\u4ee5\u964d\u3001fdef \u304c\u5b9a\u7fa9\u3055\u308c\u305f\u95a2\u6570\u306f\u5f15\u6570\u304c\u81ea\u52d5\u691c\u8a3c\u3055\u308c\u308b\n(calculate-item-total {:product-id \"INVALID\" :quantity -1 :price 0})\n;; =&gt; ExceptionInfo: Call to #'user/calculate-item-total did not conform to spec\n\n;; \u7121\u52b9\u5316\n(stest/unstrument)\n</code></pre>"},{"location":"clojure/04-clojure-spec/#10","title":"10. \u30c6\u30b9\u30c8\u751f\u6210","text":"<p><code>check</code> \u95a2\u6570\u3067\u81ea\u52d5\u7684\u306b\u30c6\u30b9\u30c8\u3092\u751f\u6210\u30fb\u5b9f\u884c\u3067\u304d\u307e\u3059\u3002</p> <pre><code>(stest/check `calculate-item-total)\n;; 100\u500b\u306e\u30e9\u30f3\u30c0\u30e0\u306a\u5165\u529b\u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\n\n(stest/check `apply-discount {:clojure.spec.test.check/opts {:num-tests 1000}})\n;; 1000\u500b\u306e\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u3067\u5b9f\u884c\n</code></pre>"},{"location":"clojure/04-clojure-spec/#_12","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Clojure Spec \u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u57fa\u672c\u7684\u306a\u30b9\u30da\u30c3\u30af: \u8ff0\u8a9e\u3068\u7d44\u307f\u5408\u308f\u305b\u305f\u30c7\u30fc\u30bf\u691c\u8a3c</li> <li>\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u30b9\u30da\u30c3\u30af: \u30d9\u30af\u30bf\u30fc\u3001\u30de\u30c3\u30d7\u306e\u69cb\u9020\u5b9a\u7fa9</li> <li>\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30eb: \u30d3\u30b8\u30cd\u30b9\u30c7\u30fc\u30bf\u306e\u4ed5\u69d8\u5b9a\u7fa9</li> <li>fdef: \u95a2\u6570\u306e\u5951\u7d04\uff08\u5f15\u6570\u3001\u623b\u308a\u5024\u3001\u95a2\u4fc2\uff09</li> <li>\u30de\u30eb\u30c1\u30b9\u30da\u30c3\u30af: \u6761\u4ef6\u4ed8\u304d\u306e\u4ed5\u69d8\u5b9a\u7fa9</li> <li>\u30ab\u30b9\u30bf\u30e0\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf: \u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u306e\u81ea\u52d5\u751f\u6210</li> <li>\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3: \u5b9f\u884c\u6642\u691c\u8a3c\u3068\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0</li> <li>\u30a4\u30f3\u30b9\u30c8\u30eb\u30e1\u30f3\u30c6\u30fc\u30b7\u30e7\u30f3: \u958b\u767a\u6642\u306e\u81ea\u52d5\u691c\u8a3c</li> <li>\u30c6\u30b9\u30c8\u751f\u6210: \u81ea\u52d5\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8</li> </ol> <p>Spec \u3092\u6d3b\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u52d5\u7684\u578b\u4ed8\u3051\u8a00\u8a9e\u306e\u67d4\u8edf\u6027\u3092\u4fdd\u3061\u306a\u304c\u3089\u3001\u5805\u7262\u306a\u30c7\u30fc\u30bf\u691c\u8a3c\u3068\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u5316\u3092\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"clojure/04-clojure-spec/#_13","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part2/src/clojure_spec.clj</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part2/spec/clojure_spec_spec.clj</code></li> </ul>"},{"location":"clojure/04-clojure-spec/#_14","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002test.check \u3092\u4f7f\u3063\u305f\u751f\u6210\u7684\u30c6\u30b9\u30c8\u306e\u624b\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/05-property-based-testing/","title":"\u7b2c5\u7ae0: \u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8","text":""},{"location":"clojure/05-property-based-testing/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u5f93\u6765\u306e\u5358\u4f53\u30c6\u30b9\u30c8\u3067\u306f\u3001\u7279\u5b9a\u306e\u5165\u529b\u306b\u5bfe\u3059\u308b\u671f\u5f85\u3055\u308c\u308b\u51fa\u529b\u3092\u691c\u8a3c\u3057\u307e\u3059\u3002\u4e00\u65b9\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u3067\u306f\u3001\u3059\u3079\u3066\u306e\u5165\u529b\u306b\u5bfe\u3057\u3066\u6210\u308a\u7acb\u3064\u3079\u304d\u300c\u6027\u8cea\uff08\u30d7\u30ed\u30d1\u30c6\u30a3\uff09\u300d\u3092\u5b9a\u7fa9\u3057\u3001\u30e9\u30f3\u30c0\u30e0\u306b\u751f\u6210\u3055\u308c\u305f\u591a\u6570\u306e\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u3067\u691c\u8a3c\u3057\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001Clojure \u306e <code>test.check</code> \u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3063\u305f\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u306e\u624b\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/05-property-based-testing/#1","title":"1. \u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u3068\u306f","text":""},{"location":"clojure/05-property-based-testing/#_2","title":"\u5f93\u6765\u306e\u30c6\u30b9\u30c8\u3068\u306e\u9055\u3044","text":"<pre><code>;; \u5f93\u6765\u306e\u30c6\u30b9\u30c8\uff1a\u7279\u5b9a\u306e\u5165\u529b\u306b\u5bfe\u3059\u308b\u51fa\u529b\u3092\u691c\u8a3c\n(deftest test-reverse\n  (is (= \"olleh\" (reverse-string \"hello\")))\n  (is (= \"\" (reverse-string \"\")))\n  (is (= \"a\" (reverse-string \"a\"))))\n\n;; \u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\uff1a\u6027\u8cea\u3092\u691c\u8a3c\n(def prop-reverse-involutory\n  \"\u6587\u5b57\u5217\u30922\u56de\u53cd\u8ee2\u3059\u308b\u3068\u5143\u306b\u623b\u308b\"\n  (prop/for-all [s gen/string]\n    (= s (reverse-string (reverse-string s)))))\n</code></pre>"},{"location":"clojure/05-property-based-testing/#_3","title":"\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u306e\u5229\u70b9","text":"<ol> <li>\u7db2\u7f85\u6027: \u624b\u52d5\u3067\u306f\u601d\u3044\u3064\u304b\u306a\u3044\u30a8\u30c3\u30b8\u30b1\u30fc\u30b9\u3092\u767a\u898b</li> <li>\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u6027: \u30b3\u30fc\u30c9\u306e\u6027\u8cea\u3092\u660e\u78ba\u306b\u8868\u73fe</li> <li>\u56de\u5e30\u9632\u6b62: \u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u6642\u306e\u5b89\u5168\u7db2</li> <li>\u30b7\u30e5\u30ea\u30f3\u30ad\u30f3\u30b0: \u5931\u6557\u6642\u306b\u6700\u5c0f\u306e\u53cd\u4f8b\u3092\u63d0\u793a</li> </ol>"},{"location":"clojure/05-property-based-testing/#2","title":"2. \u57fa\u672c\u7684\u306a\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf","text":""},{"location":"clojure/05-property-based-testing/#_4","title":"\u30d7\u30ea\u30df\u30c6\u30a3\u30d6\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf","text":"<pre><code>(require '[clojure.test.check.generators :as gen])\n\n;; \u6574\u6570\ngen/small-integer  ;; -200\u301c200\u7a0b\u5ea6\u306e\u6574\u6570\ngen/nat            ;; \u81ea\u7136\u6570\uff080\u4ee5\u4e0a\uff09\ngen/pos-int        ;; \u6b63\u306e\u6574\u6570\ngen/neg-int        ;; \u8ca0\u306e\u6574\u6570\n\n;; \u6587\u5b57\u5217\ngen/string                ;; \u4efb\u610f\u306e\u6587\u5b57\u5217\ngen/string-alphanumeric   ;; \u82f1\u6570\u5b57\u306e\u307f\n\n;; \u305d\u306e\u4ed6\ngen/boolean        ;; true/false\ngen/char           ;; \u6587\u5b57\ngen/keyword        ;; \u30ad\u30fc\u30ef\u30fc\u30c9\n\n;; \u30b5\u30f3\u30d7\u30eb\u751f\u6210\n(gen/sample gen/small-integer 5)\n;; =&gt; (0 1 -2 1 4)\n</code></pre>"},{"location":"clojure/05-property-based-testing/#_5","title":"\u7bc4\u56f2\u3068\u5217\u6319","text":"<pre><code>;; \u7bc4\u56f2\u6307\u5b9a\n(def age-gen (gen/choose 0 150))\n\n;; \u6d6e\u52d5\u5c0f\u6570\u70b9\u6570\n(def percentage-gen (gen/double* {:min 0.0 :max 1.0}))\n\n;; \u5217\u6319\u578b\n(def membership-gen (gen/elements [:bronze :silver :gold :platinum]))\n</code></pre>"},{"location":"clojure/05-property-based-testing/#3","title":"3. \u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf","text":""},{"location":"clojure/05-property-based-testing/#_6","title":"\u30d9\u30af\u30bf\u30fc\u30fb\u30ea\u30b9\u30c8","text":"<pre><code>;; \u30d9\u30af\u30bf\u30fc\n(gen/vector gen/small-integer)       ;; \u4efb\u610f\u9577\n(gen/vector gen/small-integer 1 10)  ;; 1\u301c10\u8981\u7d20\n\n;; \u30ea\u30b9\u30c8\n(gen/list gen/small-integer)\n\n;; \u975e\u7a7a\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\n(gen/not-empty (gen/vector gen/small-integer))\n</code></pre>"},{"location":"clojure/05-property-based-testing/#_7","title":"\u30de\u30c3\u30d7\u3068\u30bb\u30c3\u30c8","text":"<pre><code>;; \u30de\u30c3\u30d7\n(gen/map gen/string-alphanumeric gen/small-integer)\n\n;; \u30bb\u30c3\u30c8\n(gen/set gen/small-integer)\n\n;; \u69cb\u9020\u5316\u3055\u308c\u305f\u30de\u30c3\u30d7\n(gen/hash-map\n  :name gen/string-alphanumeric\n  :age (gen/choose 0 150)\n  :active gen/boolean)\n</code></pre>"},{"location":"clojure/05-property-based-testing/#4","title":"4. \u8907\u5408\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf","text":""},{"location":"clojure/05-property-based-testing/#_8","title":"\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30eb\u306e\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf","text":"<pre><code>(def person-gen\n  \"\u4eba\u7269\u30c7\u30fc\u30bf\u306e\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\"\n  (gen/hash-map\n   :name (gen/such-that #(not (empty? %)) gen/string-alphanumeric)\n   :age (gen/choose 0 150)\n   :membership (gen/elements [:bronze :silver :gold :platinum])))\n\n(def product-gen\n  \"\u5546\u54c1\u30c7\u30fc\u30bf\u306e\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\"\n  (gen/hash-map\n   :product-id (gen/fmap #(str \"PROD-\" (format \"%05d\" (mod % 100000))) gen/nat)\n   :name (gen/such-that #(not (empty? %)) gen/string-alphanumeric)\n   :price (gen/fmap #(+ 1 (mod % 10000)) gen/nat)\n   :quantity (gen/fmap #(+ 1 (mod % 100)) gen/nat)))\n\n(gen/sample product-gen 3)\n;; =&gt; ({:product-id \"PROD-00000\", :name \"a\", :price 1, :quantity 1}\n;;     {:product-id \"PROD-00001\", :name \"Ab\", :price 2, :quantity 2}\n;;     {:product-id \"PROD-00003\", :name \"x2Y\", :price 4, :quantity 3})\n</code></pre>"},{"location":"clojure/05-property-based-testing/#5_1","title":"5. \u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u306e\u5909\u63db","text":""},{"location":"clojure/05-property-based-testing/#fmap","title":"fmap: \u5024\u306e\u5909\u63db","text":"<pre><code>;; \u751f\u6210\u3055\u308c\u305f\u5024\u3092\u5909\u63db\n(def uppercase-string-gen\n  (gen/fmap clojure.string/upper-case gen/string-alphanumeric))\n\n;; \u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3055\u308c\u305fID\n(def order-id-gen\n  (gen/fmap #(str \"ORD-\" (format \"%08d\" %))\n            (gen/choose 0 99999999)))\n</code></pre>"},{"location":"clojure/05-property-based-testing/#bind","title":"bind: \u4f9d\u5b58\u95a2\u4fc2\u306e\u3042\u308b\u751f\u6210","text":"<pre><code>;; \u751f\u6210\u3055\u308c\u305f\u5024\u306b\u57fa\u3065\u3044\u3066\u5225\u306e\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u3092\u9078\u629e\n(def non-empty-subset-gen\n  (gen/bind (gen/not-empty (gen/vector gen/small-integer))\n            (fn [v]\n              (gen/fmap #(take % v)\n                        (gen/choose 1 (count v))))))\n</code></pre>"},{"location":"clojure/05-property-based-testing/#such-that","title":"such-that: \u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0","text":"<pre><code>;; \u6761\u4ef6\u3092\u6e80\u305f\u3059\u5024\u306e\u307f\u3092\u751f\u6210\n(def positive-even-gen\n  (gen/such-that #(and (pos? %) (even? %)) gen/small-integer 100))\n</code></pre>"},{"location":"clojure/05-property-based-testing/#6","title":"6. \u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u5b9a\u7fa9","text":""},{"location":"clojure/05-property-based-testing/#_9","title":"\u57fa\u672c\u7684\u306a\u30d7\u30ed\u30d1\u30c6\u30a3","text":"<pre><code>(require '[clojure.test.check.properties :as prop])\n\n;; \u6587\u5b57\u5217\u53cd\u8ee2\u306e\u6027\u8cea\n(def prop-reverse-involutory\n  \"\u6587\u5b57\u5217\u30922\u56de\u53cd\u8ee2\u3059\u308b\u3068\u5143\u306b\u623b\u308b\"\n  (prop/for-all [s gen/string]\n    (= s (reverse-string (reverse-string s)))))\n\n(def prop-reverse-length-preserved\n  \"\u53cd\u8ee2\u3057\u3066\u3082\u9577\u3055\u306f\u5909\u308f\u3089\u306a\u3044\"\n  (prop/for-all [s gen/string]\n    (= (count s) (count (reverse-string s)))))\n</code></pre>"},{"location":"clojure/05-property-based-testing/#_10","title":"\u30bd\u30fc\u30c8\u306e\u6027\u8cea","text":"<pre><code>(def prop-sort-idempotent\n  \"\u30bd\u30fc\u30c8\u306f\u51aa\u7b49\uff082\u56de\u30bd\u30fc\u30c8\u3057\u3066\u3082\u7d50\u679c\u306f\u540c\u3058\uff09\"\n  (prop/for-all [nums (gen/vector gen/small-integer)]\n    (= (sort-numbers nums) (sort-numbers (sort-numbers nums)))))\n\n(def prop-sort-preserves-elements\n  \"\u30bd\u30fc\u30c8\u306f\u8981\u7d20\u3092\u4fdd\u5b58\u3059\u308b\uff08\u8ffd\u52a0\u3082\u524a\u9664\u3082\u3057\u306a\u3044\uff09\"\n  (prop/for-all [nums (gen/vector gen/small-integer)]\n    (= (frequencies nums) (frequencies (sort-numbers nums)))))\n\n(def prop-sort-ordered\n  \"\u30bd\u30fc\u30c8\u7d50\u679c\u306f\u6607\u9806\u306b\u4e26\u3076\"\n  (prop/for-all [nums (gen/vector gen/small-integer)]\n    (let [sorted (sort-numbers nums)]\n      (or (empty? sorted)\n          (apply &lt;= sorted)))))\n</code></pre>"},{"location":"clojure/05-property-based-testing/#_11","title":"\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u306e\u6027\u8cea","text":"<pre><code>(def prop-discount-bounds\n  \"\u5272\u5f15\u5f8c\u306e\u4fa1\u683c\u306f0\u4ee5\u4e0a\u3001\u5143\u306e\u4fa1\u683c\u4ee5\u4e0b\"\n  (prop/for-all [price (gen/fmap #(Math/abs %) gen/small-integer)\n                 rate (gen/double* {:min 0.0 :max 1.0})]\n    (let [discounted (calculate-discount price rate)]\n      (and (&gt;= discounted 0)\n           (&lt;= discounted price)))))\n</code></pre>"},{"location":"clojure/05-property-based-testing/#7","title":"7. \u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u5b9f\u884c","text":""},{"location":"clojure/05-property-based-testing/#quick-check","title":"quick-check","text":"<pre><code>(require '[clojure.test.check :as tc])\n\n;; 100\u56de\u30c6\u30b9\u30c8\n(tc/quick-check 100 prop-reverse-involutory)\n;; =&gt; {:result true, :pass? true, :num-tests 100, :time-elapsed-ms 15, ...}\n\n;; 1000\u56de\u30c6\u30b9\u30c8\n(tc/quick-check 1000 prop-sort-ordered)\n</code></pre>"},{"location":"clojure/05-property-based-testing/#_12","title":"\u5931\u6557\u6642\u306e\u51fa\u529b","text":"<pre><code>;; \u30d0\u30b0\u306e\u3042\u308b\u95a2\u6570\n(defn buggy-abs [n]\n  (if (neg? n) (- n) n))\n\n(def prop-abs-positive\n  (prop/for-all [n gen/small-integer]\n    (&gt;= (buggy-abs n) 0)))\n\n(tc/quick-check 10000 prop-abs-positive)\n;; Integer/MIN_VALUE \u3067\u5931\u6557\u3059\u308b\u5834\u5408\u3001\u30b7\u30e5\u30ea\u30f3\u30ad\u30f3\u30b0\u3067\u6700\u5c0f\u53cd\u4f8b\u3092\u63d0\u793a\n</code></pre>"},{"location":"clojure/05-property-based-testing/#8","title":"8. \u30b7\u30e5\u30ea\u30f3\u30ad\u30f3\u30b0","text":"<p>\u30c6\u30b9\u30c8\u304c\u5931\u6557\u3059\u308b\u3068\u3001test.check \u306f\u81ea\u52d5\u7684\u306b\u30b7\u30e5\u30ea\u30f3\u30ad\u30f3\u30b0\u3092\u884c\u3044\u3001\u540c\u3058\u5931\u6557\u3092\u5f15\u304d\u8d77\u3053\u3059\u6700\u5c0f\u306e\u5165\u529b\u3092\u63a2\u3057\u307e\u3059\u3002</p> <pre><code>;; \u4f8b\uff1a\u30ea\u30b9\u30c8\u306e\u9577\u3055\u304c5\u672a\u6e80\u3068\u3044\u3046\u30d0\u30b0\u306e\u3042\u308b\u30d7\u30ed\u30d1\u30c6\u30a3\n(def prop-buggy\n  (prop/for-all [v (gen/vector gen/small-integer)]\n    (&lt; (count v) 5)))\n\n(tc/quick-check 100 prop-buggy)\n;; =&gt; {:result false,\n;;     :pass? false,\n;;     :shrunk {:total-nodes-visited 7,\n;;              :smallest [[0 0 0 0 0]]},  ;; \u6700\u5c0f\u306e\u53cd\u4f8b\n;;     ...}\n</code></pre> <p>\u30b7\u30e5\u30ea\u30f3\u30ad\u30f3\u30b0\u306b\u3088\u308a\u3001\u300c\u9577\u3055100\u306e\u30ea\u30b9\u30c8\u3067\u5931\u6557\u300d\u3067\u306f\u306a\u304f\u300c\u9577\u30555\u306e\u30ea\u30b9\u30c8\u3067\u5931\u6557\u300d\u3068\u3044\u3046\u6700\u5c0f\u306e\u53cd\u4f8b\u304c\u5f97\u3089\u308c\u307e\u3059\u3002</p>"},{"location":"clojure/05-property-based-testing/#9","title":"9. \u30e9\u30a6\u30f3\u30c9\u30c8\u30ea\u30c3\u30d7\u30d7\u30ed\u30d1\u30c6\u30a3","text":"<p>\u30a8\u30f3\u30b3\u30fc\u30c9/\u30c7\u30b3\u30fc\u30c9\u306e\u53ef\u9006\u6027\u306f\u5178\u578b\u7684\u306a\u30d7\u30ed\u30d1\u30c6\u30a3\u3067\u3059\u3002</p> <pre><code>(defn encode-run-length [s]\n  (-&gt;&gt; s\n       (partition-by identity)\n       (map (fn [group] [(first group) (count group)]))\n       (into [])))\n\n(defn decode-run-length [encoded]\n  (-&gt;&gt; encoded\n       (mapcat (fn [[ch n]] (repeat n ch)))\n       (apply str)))\n\n(def prop-run-length-roundtrip\n  \"\u30e9\u30f3\u30ec\u30f3\u30b0\u30b9\u7b26\u53f7\u5316\u306f\u53ef\u9006\"\n  (prop/for-all [s (gen/fmap #(apply str %) (gen/vector gen/char-alpha))]\n    (= s (decode-run-length (encode-run-length s)))))\n</code></pre>"},{"location":"clojure/05-property-based-testing/#10","title":"10. \u5b9f\u8df5\u7684\u306a\u30d1\u30bf\u30fc\u30f3","text":""},{"location":"clojure/05-property-based-testing/#_13","title":"\u4ee3\u6570\u7684\u6027\u8cea","text":"<pre><code>;; \u7d50\u5408\u5f8b\n(def prop-addition-associative\n  (prop/for-all [a gen/small-integer\n                 b gen/small-integer\n                 c gen/small-integer]\n    (= (+ (+ a b) c) (+ a (+ b c)))))\n\n;; \u4ea4\u63db\u5f8b\n(def prop-addition-commutative\n  (prop/for-all [a gen/small-integer\n                 b gen/small-integer]\n    (= (+ a b) (+ b a))))\n</code></pre>"},{"location":"clojure/05-property-based-testing/#_14","title":"\u30aa\u30e9\u30af\u30eb\u30c6\u30b9\u30c8","text":"<p>\u65e2\u77e5\u306e\u6b63\u3057\u3044\u5b9f\u88c5\u3068\u6bd4\u8f03\u3057\u307e\u3059\u3002</p> <pre><code>(def prop-my-sort-matches-builtin\n  \"\u81ea\u4f5c\u30bd\u30fc\u30c8\u306f\u7d44\u307f\u8fbc\u307f\u30bd\u30fc\u30c8\u3068\u540c\u3058\u7d50\u679c\"\n  (prop/for-all [nums (gen/vector gen/small-integer)]\n    (= (my-sort nums) (sort nums))))\n</code></pre>"},{"location":"clojure/05-property-based-testing/#_15","title":"\u4e0d\u5909\u6761\u4ef6","text":"<pre><code>(def prop-order-total-positive\n  \"\u6ce8\u6587\u5408\u8a08\u306f\u5e38\u306b\u6b63\"\n  (prop/for-all [order order-gen]\n    (pos? (calculate-order-total order))))\n</code></pre>"},{"location":"clojure/05-property-based-testing/#_16","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf: \u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u306e\u81ea\u52d5\u751f\u6210</li> <li>\u30d7\u30ea\u30df\u30c6\u30a3\u30d6: \u6574\u6570\u3001\u6587\u5b57\u5217\u3001\u30d6\u30fc\u30eb\u5024\u306a\u3069</li> <li>\u30b3\u30ec\u30af\u30b7\u30e7\u30f3: \u30d9\u30af\u30bf\u30fc\u3001\u30de\u30c3\u30d7\u3001\u30bb\u30c3\u30c8</li> <li>\u5909\u63db: fmap, bind, such-that \u306b\u3088\u308b\u52a0\u5de5</li> <li>\u30d7\u30ed\u30d1\u30c6\u30a3: \u3059\u3079\u3066\u306e\u5165\u529b\u3067\u6210\u308a\u7acb\u3064\u3079\u304d\u6027\u8cea</li> <li>\u30b7\u30e5\u30ea\u30f3\u30ad\u30f3\u30b0: \u5931\u6557\u6642\u306e\u6700\u5c0f\u53cd\u4f8b\u63a2\u7d22</li> <li>\u30d1\u30bf\u30fc\u30f3: \u30e9\u30a6\u30f3\u30c9\u30c8\u30ea\u30c3\u30d7\u3001\u4ee3\u6570\u7684\u6027\u8cea\u3001\u30aa\u30e9\u30af\u30eb\u30c6\u30b9\u30c8</li> </ol> <p>\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u306f\u3001\u5f93\u6765\u306e\u30c6\u30b9\u30c8\u3092\u88dc\u5b8c\u3057\u3001\u3088\u308a\u5805\u7262\u306a\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p>"},{"location":"clojure/05-property-based-testing/#_17","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part2/src/property_based_testing.clj</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part2/spec/property_based_testing_spec.clj</code></li> </ul>"},{"location":"clojure/05-property-based-testing/#_18","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001\u30c6\u30b9\u30c8\u99c6\u52d5\u958b\u767a\u3068\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002Red-Green-Refactor \u30b5\u30a4\u30af\u30eb\u3092\u95a2\u6570\u578b\u30b9\u30bf\u30a4\u30eb\u3067\u5b9f\u8df5\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/06-tdd-in-functional/","title":"\u7b2c6\u7ae0: \u30c6\u30b9\u30c8\u99c6\u52d5\u958b\u767a\u3068\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0","text":""},{"location":"clojure/06-tdd-in-functional/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u30c6\u30b9\u30c8\u99c6\u52d5\u958b\u767a\uff08TDD\uff09\u306f\u3001\u30c6\u30b9\u30c8\u3092\u5148\u306b\u66f8\u3044\u3066\u304b\u3089\u5b9f\u88c5\u3092\u884c\u3046\u958b\u767a\u624b\u6cd5\u3067\u3059\u3002\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3068 TDD \u306f\u76f8\u6027\u304c\u826f\u304f\u3001\u7d14\u7c8b\u95a2\u6570\u306f\u30c6\u30b9\u30c8\u304c\u5bb9\u6613\u3067\u3001\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u306f\u4e88\u6e2c\u53ef\u80fd\u306a\u52d5\u4f5c\u3092\u4fdd\u8a3c\u3057\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001Red-Green-Refactor \u30b5\u30a4\u30af\u30eb\u3092\u95a2\u6570\u578b\u30b9\u30bf\u30a4\u30eb\u3067\u5b9f\u8df5\u3059\u308b\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/06-tdd-in-functional/#1-tdd","title":"1. TDD \u306e\u57fa\u672c\u30b5\u30a4\u30af\u30eb","text":""},{"location":"clojure/06-tdd-in-functional/#red-green-refactor","title":"Red-Green-Refactor","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                                                 \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502    \u2502  Red  \u2502 \u2500\u2500\u25ba \u2502 Green \u2502 \u2500\u2500\u25ba \u2502 Refactor  \u2502   \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502        \u25b2                              \u2502         \u2502\n\u2502        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <ol> <li>Red\uff08\u8d64\uff09: \u5931\u6557\u3059\u308b\u30c6\u30b9\u30c8\u3092\u66f8\u304f</li> <li>Green\uff08\u7dd1\uff09: \u30c6\u30b9\u30c8\u3092\u901a\u3059\u6700\u5c0f\u9650\u306e\u30b3\u30fc\u30c9\u3092\u66f8\u304f</li> <li>Refactor\uff08\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\uff09: \u30b3\u30fc\u30c9\u3092\u6539\u5584\u3059\u308b\uff08\u30c6\u30b9\u30c8\u306f\u901a\u3063\u305f\u307e\u307e\uff09</li> </ol>"},{"location":"clojure/06-tdd-in-functional/#2-fizzbuzz-tdd","title":"2. FizzBuzz - TDD \u306e\u5178\u578b\u4f8b","text":""},{"location":"clojure/06-tdd-in-functional/#step-1-red","title":"Step 1: Red\uff08\u6700\u521d\u306e\u30c6\u30b9\u30c8\uff09","text":"<pre><code>;; \u30c6\u30b9\u30c8\n(it \"1\u306f\\\"1\\\"\u3092\u8fd4\u3059\"\n  (should= \"1\" (fizzbuzz 1)))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#step-2-green","title":"Step 2: Green\uff08\u6700\u5c0f\u9650\u306e\u5b9f\u88c5\uff09","text":"<pre><code>(defn fizzbuzz [n]\n  \"1\")\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#step-3","title":"Step 3: \u6b21\u306e\u30c6\u30b9\u30c8\u3092\u8ffd\u52a0","text":"<pre><code>(it \"2\u306f\\\"2\\\"\u3092\u8fd4\u3059\"\n  (should= \"2\" (fizzbuzz 2)))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#_2","title":"\u6bb5\u968e\u7684\u306b\u5b9f\u88c5\u3092\u767a\u5c55","text":"<pre><code>;; \u5c0f\u3055\u306a\u30d8\u30eb\u30d1\u30fc\u95a2\u6570\u306b\u5206\u5272\n(defn fizz? [n] (zero? (mod n 3)))\n(defn buzz? [n] (zero? (mod n 5)))\n(defn fizzbuzz? [n] (and (fizz? n) (buzz? n)))\n\n(defn fizzbuzz [n]\n  (cond\n    (fizzbuzz? n) \"FizzBuzz\"\n    (fizz? n) \"Fizz\"\n    (buzz? n) \"Buzz\"\n    :else (str n)))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#_3","title":"\u6700\u7d42\u30c6\u30b9\u30c8\u30b9\u30a4\u30fc\u30c8","text":"<pre><code>(context \"FizzBuzz\"\n  (it \"1\u306f\\\"1\\\"\u3092\u8fd4\u3059\" (should= \"1\" (fizzbuzz 1)))\n  (it \"2\u306f\\\"2\\\"\u3092\u8fd4\u3059\" (should= \"2\" (fizzbuzz 2)))\n  (it \"3\u306f\\\"Fizz\\\"\u3092\u8fd4\u3059\" (should= \"Fizz\" (fizzbuzz 3)))\n  (it \"5\u306f\\\"Buzz\\\"\u3092\u8fd4\u3059\" (should= \"Buzz\" (fizzbuzz 5)))\n  (it \"15\u306f\\\"FizzBuzz\\\"\u3092\u8fd4\u3059\" (should= \"FizzBuzz\" (fizzbuzz 15))))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#3","title":"3. \u30ed\u30fc\u30de\u6570\u5b57\u5909\u63db","text":""},{"location":"clojure/06-tdd-in-functional/#_4","title":"\u30c6\u30b9\u30c8\u304b\u3089\u59cb\u3081\u308b","text":"<pre><code>(context \"to-roman\"\n  (it \"1\u306fI\u3092\u8fd4\u3059\" (should= \"I\" (to-roman 1)))\n  (it \"3\u306fIII\u3092\u8fd4\u3059\" (should= \"III\" (to-roman 3)))\n  (it \"4\u306fIV\u3092\u8fd4\u3059\" (should= \"IV\" (to-roman 4)))\n  (it \"5\u306fV\u3092\u8fd4\u3059\" (should= \"V\" (to-roman 5)))\n  ;; ... \u6bb5\u968e\u7684\u306b\u8ffd\u52a0\n  )\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#_5","title":"\u30c7\u30fc\u30bf\u99c6\u52d5\u306e\u5b9f\u88c5","text":"<pre><code>(def roman-numerals\n  \"\u30ed\u30fc\u30de\u6570\u5b57\u306e\u5bfe\u5fdc\u8868\uff08\u5927\u304d\u3044\u9806\uff09\"\n  [[1000 \"M\"] [900 \"CM\"] [500 \"D\"] [400 \"CD\"]\n   [100 \"C\"] [90 \"XC\"] [50 \"L\"] [40 \"XL\"]\n   [10 \"X\"] [9 \"IX\"] [5 \"V\"] [4 \"IV\"] [1 \"I\"]])\n\n(defn to-roman [n]\n  {:pre [(pos? n) (&lt;= n 3999)]}\n  (loop [n n result \"\"]\n    (if (zero? n)\n      result\n      (let [[value numeral] (first (filter #(&lt;= (first %) n) roman-numerals))]\n        (recur (- n value) (str result numeral))))))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#4","title":"4. \u30dc\u30a6\u30ea\u30f3\u30b0\u30b9\u30b3\u30a2\u8a08\u7b97","text":""},{"location":"clojure/06-tdd-in-functional/#tdd","title":"\u8907\u96d1\u306a\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u306e TDD","text":"<pre><code>;; \u6bb5\u968e\u7684\u306b\u30c6\u30b9\u30c8\u3092\u8ffd\u52a0\n(context \"\u30dc\u30a6\u30ea\u30f3\u30b0\u30b9\u30b3\u30a2\u8a08\u7b97\"\n  (it \"\u30ac\u30bf\u30fc\u30b9\u30b3\u30a2\u306f0\"\n    (should= 0 (bowling-score (repeat 20 0))))\n\n  (it \"\u3059\u3079\u30661\u30d4\u30f3\u306f20\u70b9\"\n    (should= 20 (bowling-score (repeat 20 1))))\n\n  (it \"\u30b9\u30da\u30a2\u306e\u5f8c\u306e\u6295\u7403\u306f\u30dc\u30fc\u30ca\u30b9\"\n    (should= 16 (bowling-score [5 5 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0])))\n\n  (it \"\u30b9\u30c8\u30e9\u30a4\u30af\u306e\u5f8c\u306e2\u6295\u306f\u30dc\u30fc\u30ca\u30b9\"\n    (should= 24 (bowling-score [10 3 4 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0])))\n\n  (it \"\u30d1\u30fc\u30d5\u30a7\u30af\u30c8\u30b2\u30fc\u30e0\u306f300\u70b9\"\n    (should= 300 (bowling-score (repeat 12 10)))))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#_6","title":"\u5c0f\u3055\u306a\u95a2\u6570\u306b\u5206\u5272","text":"<pre><code>(defn strike? [frame] (= 10 (first frame)))\n(defn spare? [frame] (and (not (strike? frame))\n                           (= 10 (+ (first frame) (second frame)))))\n\n(defn calculate-frame [frame remaining-rolls]\n  (cond\n    (strike? frame) (+ 10 (strike-bonus remaining-rolls))\n    (spare? frame) (+ 10 (spare-bonus remaining-rolls))\n    :else (frame-score frame)))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#5-tdd","title":"5. \u7d20\u6570 - \u30b7\u30f3\u30d7\u30eb\u306a\u95a2\u6570\u306e TDD","text":""},{"location":"clojure/06-tdd-in-functional/#_7","title":"\u30c6\u30b9\u30c8\u304b\u3089\u8a2d\u8a08\u3092\u5c0e\u304f","text":"<pre><code>(context \"\u7d20\u6570\"\n  (it \"prime? \u306f\u7d20\u6570\u3092\u6b63\u3057\u304f\u5224\u5b9a\u3059\u308b\"\n    (should-not (prime? 0))\n    (should-not (prime? 1))\n    (should (prime? 2))\n    (should (prime? 3))\n    (should-not (prime? 4))\n    (should (prime? 5)))\n\n  (it \"primes-up-to \u306f\u6b63\u3057\u3044\u7d20\u6570\u30ea\u30b9\u30c8\u3092\u8fd4\u3059\"\n    (should= [2 3 5 7 11 13 17 19] (primes-up-to 20)))\n\n  (it \"prime-factors \u306f\u7d20\u56e0\u6570\u5206\u89e3\u3092\u8fd4\u3059\"\n    (should= [2 2 2 3] (prime-factors 24))))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#_8","title":"\u5b9f\u88c5","text":"<pre><code>(defn prime? [n]\n  (cond\n    (&lt; n 2) false\n    (= n 2) true\n    (even? n) false\n    :else (not-any? #(zero? (mod n %))\n                    (range 3 (inc (Math/sqrt n)) 2))))\n\n(defn primes-up-to [n]\n  (filter prime? (range 2 (inc n))))\n\n(defn prime-factors [n]\n  (loop [n n, factor 2, factors []]\n    (cond\n      (= n 1) factors\n      (zero? (mod n factor)) (recur (/ n factor) factor (conj factors factor))\n      :else (recur n (inc factor) factors))))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#6-tdd","title":"6. \u30b9\u30bf\u30c3\u30af - \u30c7\u30fc\u30bf\u69cb\u9020\u306e TDD","text":""},{"location":"clojure/06-tdd-in-functional/#_9","title":"\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u3068\u3057\u3066\u5b9f\u88c5","text":"<pre><code>(defn create-stack [] {:items []})\n\n(defn stack-push [stack item]\n  (update stack :items conj item))\n\n(defn stack-pop [stack]\n  {:pre [(not (empty? (:items stack)))]}\n  {:value (peek (:items stack))\n   :stack {:items (pop (:items stack))}})\n\n(defn stack-peek [stack]\n  (peek (:items stack)))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#_10","title":"\u30c6\u30b9\u30c8","text":"<pre><code>(it \"LIFO\u9806\u5e8f\u3067\u52d5\u4f5c\u3059\u308b\"\n  (let [stack (-&gt; (create-stack)\n                  (stack-push \"a\")\n                  (stack-push \"b\")\n                  (stack-push \"c\"))\n        {v1 :value s1 :stack} (stack-pop stack)\n        {v2 :value s2 :stack} (stack-pop s1)\n        {v3 :value _s3 :stack} (stack-pop s2)]\n    (should= \"c\" v1)\n    (should= \"b\" v2)\n    (should= \"a\" v3)))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#7","title":"7. \u6587\u5b57\u5217\u96fb\u5353","text":""},{"location":"clojure/06-tdd-in-functional/#_11","title":"\u6bb5\u968e\u7684\u306a\u8981\u4ef6\u8ffd\u52a0","text":"<pre><code>(context \"\u6587\u5b57\u5217\u96fb\u5353\"\n  (it \"\u7a7a\u6587\u5b57\u5217\u306f0\u3092\u8fd4\u3059\"\n    (should= 0 (string-calculator \"\")))\n\n  (it \"\u5358\u4e00\u306e\u6570\u5024\u306f\u305d\u306e\u5024\u3092\u8fd4\u3059\"\n    (should= 5 (string-calculator \"5\")))\n\n  (it \"\u30ab\u30f3\u30de\u533a\u5207\u308a\u306e\u6570\u5024\u3092\u5408\u8a08\u3059\u308b\"\n    (should= 6 (string-calculator \"1,2,3\")))\n\n  (it \"\u6539\u884c\u533a\u5207\u308a\u3082\u51e6\u7406\u3059\u308b\"\n    (should= 6 (string-calculator \"1\\n2,3\")))\n\n  (it \"\u30ab\u30b9\u30bf\u30e0\u533a\u5207\u308a\u6587\u5b57\u3092\u4f7f\u7528\u3067\u304d\u308b\"\n    (should= 3 (string-calculator \"//;\\n1;2\")))\n\n  (it \"\u8ca0\u306e\u6570\u306f\u4f8b\u5916\u3092\u30b9\u30ed\u30fc\u3059\u308b\"\n    (should-throw clojure.lang.ExceptionInfo\n                  (string-calculator \"1,-2,3\")))\n\n  (it \"1000\u3088\u308a\u5927\u304d\u3044\u6570\u306f\u7121\u8996\u3059\u308b\"\n    (should= 2 (string-calculator \"2,1001\"))))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#_12","title":"\u5b9f\u88c5","text":"<pre><code>(defn string-calculator [s]\n  (if (empty? s)\n    0\n    (-&gt;&gt; (parse-numbers s)\n         (validate-numbers)\n         (filter #(&lt;= % 1000))\n         (reduce +))))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#8","title":"8. \u7d14\u7c8b\u95a2\u6570\u3068\u30c6\u30b9\u30c8\u5bb9\u6613\u6027","text":""},{"location":"clojure/06-tdd-in-functional/#_13","title":"\u7d14\u7c8b\u95a2\u6570\u306e\u5229\u70b9","text":"<pre><code>;; \u7d14\u7c8b\u95a2\u6570\uff1a\u30c6\u30b9\u30c8\u304c\u5bb9\u6613\n(defn calculate-tax [amount rate]\n  (* amount rate))\n\n(defn calculate-total-with-tax [items tax-rate]\n  (let [subtotal (reduce + (map :price items))\n        tax (calculate-tax subtotal tax-rate)]\n    {:subtotal subtotal\n     :tax tax\n     :total (+ subtotal tax)}))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#_14","title":"\u30c6\u30b9\u30c8","text":"<pre><code>(it \"calculate-total-with-tax \u306f\u7a0e\u8fbc\u307f\u7dcf\u984d\u3092\u8a08\u7b97\u3059\u308b\"\n  (let [items [{:name \"\u5546\u54c1A\" :price 1000}\n               {:name \"\u5546\u54c1B\" :price 2000}]\n        result (calculate-total-with-tax items 0.1)]\n    (should= 3000 (:subtotal result))\n    (should= 300.0 (:tax result))\n    (should= 3300.0 (:total result))))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#9","title":"9. \u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u30d1\u30bf\u30fc\u30f3","text":""},{"location":"clojure/06-tdd-in-functional/#before","title":"Before: \u8907\u96d1\u306a\u6761\u4ef6\u5206\u5c90","text":"<pre><code>(defn calculate-shipping-before [order]\n  (let [total (:total order)\n        weight (:weight order)\n        region (:region order)]\n    (cond\n      (&gt;= total 10000) 0\n      (= region :local) (if (&lt; weight 5) 300 500)\n      (= region :domestic) (if (&lt; weight 5) 500 800)\n      (= region :international) (if (&lt; weight 5) 2000 3000)\n      :else 500)))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#after","title":"After: \u30c7\u30fc\u30bf\u99c6\u52d5\u306e\u5b9f\u88c5","text":"<pre><code>(defn free-shipping? [total] (&gt;= total 10000))\n\n(def shipping-rates\n  {:local {true 300 false 500}\n   :domestic {true 500 false 800}\n   :international {true 2000 false 3000}})\n\n(defn calculate-shipping [{:keys [total weight region] :or {region :domestic}}]\n  (if (free-shipping? total)\n    0\n    (get-in shipping-rates [region (&lt; weight 5)] 500)))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#10-tdd","title":"10. TDD \u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9","text":""},{"location":"clojure/06-tdd-in-functional/#1","title":"1. \u5c0f\u3055\u306a\u30b9\u30c6\u30c3\u30d7\u3067\u9032\u3080","text":"<ul> <li>\u4e00\u5ea6\u306b1\u3064\u306e\u30c6\u30b9\u30c8\u3060\u3051\u3092\u8ffd\u52a0</li> <li>\u30c6\u30b9\u30c8\u304c\u901a\u3063\u305f\u3089\u6b21\u306e\u30c6\u30b9\u30c8\u3078</li> </ul>"},{"location":"clojure/06-tdd-in-functional/#2","title":"2. \u30c6\u30b9\u30c8\u540d\u306f\u4ed5\u69d8\u3068\u3057\u3066\u8aad\u3081\u308b","text":"<pre><code>(it \"10000\u5186\u4ee5\u4e0a\u306f\u9001\u6599\u7121\u6599\")\n(it \"\u8ca0\u306e\u6570\u306f\u4f8b\u5916\u3092\u30b9\u30ed\u30fc\u3059\u308b\")\n(it \"\u30d1\u30fc\u30d5\u30a7\u30af\u30c8\u30b2\u30fc\u30e0\u306f300\u70b9\")\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#3_1","title":"3. \u7d14\u7c8b\u95a2\u6570\u3092\u512a\u5148","text":"<ul> <li>\u526f\u4f5c\u7528\u3092\u6301\u3064\u95a2\u6570\u306f\u6700\u5c0f\u9650\u306b</li> <li>\u526f\u4f5c\u7528\u306f\u5883\u754c\u306b\u8ffd\u3044\u51fa\u3059</li> </ul>"},{"location":"clojure/06-tdd-in-functional/#4_1","title":"4. \u30a8\u30c3\u30b8\u30b1\u30fc\u30b9\u3092\u30c6\u30b9\u30c8","text":"<pre><code>(it \"\u7a7a\u6587\u5b57\u5217\u306f0\u3092\u8fd4\u3059\")\n(it \"\u7a7a\u306e\u30ea\u30b9\u30c8\u306f\u7a7a\u306e\u30ea\u30b9\u30c8\u3092\u8fd4\u3059\")\n(it \"\u5883\u754c\u5024\u3067\u6b63\u3057\u304f\u52d5\u4f5c\u3059\u308b\")\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#_15","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001TDD \u3068\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>Red-Green-Refactor: \u57fa\u672c\u30b5\u30a4\u30af\u30eb</li> <li>FizzBuzz: \u5178\u578b\u7684\u306a TDD \u4f8b</li> <li>\u30ed\u30fc\u30de\u6570\u5b57: \u30c7\u30fc\u30bf\u99c6\u52d5\u306e\u5b9f\u88c5</li> <li>\u30dc\u30a6\u30ea\u30f3\u30b0: \u8907\u96d1\u306a\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af</li> <li>\u7d20\u6570: \u30b7\u30f3\u30d7\u30eb\u306a\u95a2\u6570\u8a2d\u8a08</li> <li>\u30b9\u30bf\u30c3\u30af: \u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020</li> <li>\u6587\u5b57\u5217\u96fb\u5353: \u6bb5\u968e\u7684\u306a\u8981\u4ef6\u8ffd\u52a0</li> <li>\u7d14\u7c8b\u95a2\u6570: \u30c6\u30b9\u30c8\u5bb9\u6613\u6027</li> <li>\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0: \u6761\u4ef6\u5206\u5c90\u306e\u6574\u7406</li> </ol> <p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3068 TDD \u306e\u7d44\u307f\u5408\u308f\u305b\u306b\u3088\u308a\u3001\u4fe1\u983c\u6027\u306e\u9ad8\u3044\u30b3\u30fc\u30c9\u3092\u52b9\u7387\u7684\u306b\u958b\u767a\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"clojure/06-tdd-in-functional/#_16","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part2/src/tdd_in_functional.clj</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part2/spec/tdd_in_functional_spec.clj</code></li> </ul>"},{"location":"clojure/06-tdd-in-functional/#_17","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u304b\u3089\u7b2c3\u90e8\u300c\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3 - \u69cb\u9020\u30d1\u30bf\u30fc\u30f3\u300d\u306b\u5165\u308a\u307e\u3059\u3002Composite \u30d1\u30bf\u30fc\u30f3\u3092\u95a2\u6570\u578b\u30b9\u30bf\u30a4\u30eb\u3067\u5b9f\u88c5\u3059\u308b\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/07-composite-pattern/","title":"\u7b2c7\u7ae0: Composite \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"clojure/07-composite-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Composite \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u30c4\u30ea\u30fc\u69cb\u9020\u3067\u69cb\u6210\u3057\u3001\u500b\u3005\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u96c6\u5408\u3092\u540c\u3058\u3088\u3046\u306b\u6271\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u3053\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306f\u500b\u3005\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u305d\u306e\u7d44\u307f\u5408\u308f\u305b\u3092\u533a\u5225\u305b\u305a\u306b\u64cd\u4f5c\u3067\u304d\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u56f3\u5f62\uff08Shape\uff09\u3068\u30b9\u30a4\u30c3\u30c1\u53ef\u80fd\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\uff08Switchable\uff09\u3092\u4f8b\u306b\u3001Composite \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/07-composite-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Composite \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Component: \u5168\u3066\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u5171\u901a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>Leaf: \u5b50\u8981\u7d20\u3092\u6301\u305f\u306a\u3044\u672b\u7aef\u30aa\u30d6\u30b8\u30a7\u30af\u30c8</li> <li>Composite: \u5b50\u8981\u7d20\u3092\u6301\u3064\u30b3\u30f3\u30c6\u30ca\u30aa\u30d6\u30b8\u30a7\u30af\u30c8</li> </ul> <p></p>"},{"location":"clojure/07-composite-pattern/#2-shape","title":"2. Shape \u306e\u4f8b","text":""},{"location":"clojure/07-composite-pattern/#_2","title":"\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u5b9a\u7fa9","text":"<p>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u3001\u5f62\u72b6\u306e\u5171\u901a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002</p> <pre><code>(ns composite-pattern.shape\n  (:require [clojure.spec.alpha :as s]))\n\n(s/def ::type keyword?)\n(s/def ::shape-type (s/keys :req [::type]))\n\n(defmulti translate\n  \"\u5f62\u72b6\u3092\u79fb\u52d5\u3059\u308b\"\n  (fn [shape dx dy] (::type shape)))\n\n(defmulti scale\n  \"\u5f62\u72b6\u3092\u62e1\u5927/\u7e2e\u5c0f\u3059\u308b\"\n  (fn [shape factor] (::type shape)))\n</code></pre>"},{"location":"clojure/07-composite-pattern/#circle-leaf","title":"Circle (Leaf)","text":"<pre><code>(ns composite-pattern.circle\n  (:require [clojure.spec.alpha :as s]\n            [composite-pattern.shape :as shape]))\n\n(s/def ::center (s/tuple number? number?))\n(s/def ::radius number?)\n(s/def ::circle (s/keys :req [::shape/type ::radius ::center]))\n\n(defn make-circle [center radius]\n  {:post [(s/valid? ::circle %)]}\n  {::shape/type ::circle\n   ::center center\n   ::radius radius})\n\n(defmethod shape/translate ::circle [circle dx dy]\n  (let [[x y] (::center circle)]\n    (assoc circle ::center [(+ x dx) (+ y dy)])))\n\n(defmethod shape/scale ::circle [circle factor]\n  (let [radius (::radius circle)]\n    (assoc circle ::radius (* radius factor))))\n</code></pre>"},{"location":"clojure/07-composite-pattern/#square-leaf","title":"Square (Leaf)","text":"<pre><code>(ns composite-pattern.square\n  (:require [clojure.spec.alpha :as s]\n            [composite-pattern.shape :as shape]))\n\n(s/def ::top-left (s/tuple number? number?))\n(s/def ::side number?)\n(s/def ::square (s/keys :req [::shape/type ::side ::top-left]))\n\n(defn make-square [top-left side]\n  {:post [(s/valid? ::square %)]}\n  {::shape/type ::square\n   ::top-left top-left\n   ::side side})\n\n(defmethod shape/translate ::square [square dx dy]\n  (let [[x y] (::top-left square)]\n    (assoc square ::top-left [(+ x dx) (+ y dy)])))\n\n(defmethod shape/scale ::square [square factor]\n  (let [side (::side square)]\n    (assoc square ::side (* side factor))))\n</code></pre>"},{"location":"clojure/07-composite-pattern/#compositeshape-composite","title":"CompositeShape (Composite)","text":"<pre><code>(ns composite-pattern.composite-shape\n  (:require [clojure.spec.alpha :as s]\n            [composite-pattern.shape :as shape]))\n\n(s/def ::shapes (s/coll-of ::shape/shape-type))\n(s/def ::composite-shape (s/keys :req [::shape/type ::shapes]))\n\n(defn make []\n  {::shape/type ::composite-shape\n   ::shapes []})\n\n(defn add [cs shape]\n  (update cs ::shapes conj shape))\n\n(defmethod shape/translate ::composite-shape [cs dx dy]\n  (let [translated-shapes (mapv #(shape/translate % dx dy)\n                                (::shapes cs))]\n    (assoc cs ::shapes translated-shapes)))\n\n(defmethod shape/scale ::composite-shape [cs factor]\n  (let [scaled-shapes (mapv #(shape/scale % factor)\n                            (::shapes cs))]\n    (assoc cs ::shapes scaled-shapes)))\n</code></pre>"},{"location":"clojure/07-composite-pattern/#_3","title":"\u30af\u30e9\u30b9\u56f3","text":""},{"location":"clojure/07-composite-pattern/#_4","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>;; \u500b\u3005\u306e\u5f62\u72b6\u3092\u4f5c\u6210\n(def circle (circle/make-circle [10 10] 5))\n(def square (square/make-square [0 0] 10))\n\n;; \u8907\u5408\u5f62\u72b6\u3092\u4f5c\u6210\n(def group (-&gt; (cs/make)\n               (cs/add circle)\n               (cs/add square)))\n\n;; \u8907\u5408\u5f62\u72b6\u3092\u79fb\u52d5\uff08\u5168\u3066\u306e\u5b50\u8981\u7d20\u304c\u79fb\u52d5\u3059\u308b\uff09\n(def moved (shape/translate group 5 5))\n;; =&gt; {:shapes [{:center [15 15] :radius 5}\n;;              {:top-left [5 5] :side 10}]}\n\n;; \u8907\u5408\u5f62\u72b6\u3092\u62e1\u5927\uff08\u5168\u3066\u306e\u5b50\u8981\u7d20\u304c\u62e1\u5927\u3059\u308b\uff09\n(def scaled (shape/scale group 2))\n;; =&gt; {:shapes [{:center [10 10] :radius 10}\n;;              {:top-left [0 0] :side 20}]}\n</code></pre>"},{"location":"clojure/07-composite-pattern/#_5","title":"\u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"clojure/07-composite-pattern/#3-switchable","title":"3. Switchable \u306e\u4f8b","text":""},{"location":"clojure/07-composite-pattern/#_6","title":"\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u5b9a\u7fa9","text":"<pre><code>(ns composite-pattern.switchable)\n\n(defmulti turn-on\n  \"\u30b9\u30a4\u30c3\u30c1\u3092\u30aa\u30f3\u306b\u3059\u308b\"\n  :type)\n\n(defmulti turn-off\n  \"\u30b9\u30a4\u30c3\u30c1\u3092\u30aa\u30d5\u306b\u3059\u308b\"\n  :type)\n</code></pre>"},{"location":"clojure/07-composite-pattern/#light-leaf","title":"Light (Leaf)","text":"<pre><code>(ns composite-pattern.light\n  (:require [composite-pattern.switchable :as s]))\n\n(defn make-light []\n  {:type :light\n   :on false})\n\n(defn turn-on-light []\n  (println \"Light turned ON\"))\n\n(defn turn-off-light []\n  (println \"Light turned OFF\"))\n\n(defmethod s/turn-on :light [switchable]\n  (turn-on-light)\n  (assoc switchable :on true))\n\n(defmethod s/turn-off :light [switchable]\n  (turn-off-light)\n  (assoc switchable :on false))\n</code></pre>"},{"location":"clojure/07-composite-pattern/#variablelight-leaf","title":"VariableLight (Leaf)","text":"<pre><code>(ns composite-pattern.variable-light\n  (:require [composite-pattern.switchable :as s]))\n\n(defn make-variable-light []\n  {:type :variable-light\n   :intensity 0})\n\n(defn set-light-intensity [intensity]\n  (println (str \"Light intensity set to \" intensity)))\n\n(defmethod s/turn-on :variable-light [switchable]\n  (set-light-intensity 100)\n  (assoc switchable :intensity 100))\n\n(defmethod s/turn-off :variable-light [switchable]\n  (set-light-intensity 0)\n  (assoc switchable :intensity 0))\n</code></pre>"},{"location":"clojure/07-composite-pattern/#compositeswitchable-composite","title":"CompositeSwitchable (Composite)","text":"<pre><code>(ns composite-pattern.composite-switchable\n  (:require [composite-pattern.switchable :as s]))\n\n(defn make-composite-switchable []\n  {:type :composite-switchable\n   :switchables []})\n\n(defn add [composite-switchable switchable]\n  (update composite-switchable :switchables conj switchable))\n\n(defmethod s/turn-on :composite-switchable [c-switchable]\n  (let [turned-on (mapv s/turn-on (:switchables c-switchable))]\n    (assoc c-switchable :switchables turned-on)))\n\n(defmethod s/turn-off :composite-switchable [c-switchable]\n  (let [turned-off (mapv s/turn-off (:switchables c-switchable))]\n    (assoc c-switchable :switchables turned-off)))\n</code></pre>"},{"location":"clojure/07-composite-pattern/#_7","title":"\u30af\u30e9\u30b9\u56f3","text":""},{"location":"clojure/07-composite-pattern/#_8","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>;; \u500b\u3005\u306e\u30e9\u30a4\u30c8\u3092\u4f5c\u6210\n(def light (l/make-light))\n(def vlight (v/make-variable-light))\n\n;; \u8907\u5408\u30b9\u30a4\u30c3\u30c1\u3092\u4f5c\u6210\n(def room-lights (-&gt; (cs/make-composite-switchable)\n                     (cs/add light)\n                     (cs/add vlight)))\n\n;; \u5168\u3066\u306e\u30e9\u30a4\u30c8\u3092\u30aa\u30f3\u306b\u3059\u308b\n(s/turn-on room-lights)\n;; Light turned ON\n;; Light intensity set to 100\n\n;; \u5168\u3066\u306e\u30e9\u30a4\u30c8\u3092\u30aa\u30d5\u306b\u3059\u308b\n(s/turn-off room-lights)\n;; Light turned OFF\n;; Light intensity set to 0\n</code></pre>"},{"location":"clojure/07-composite-pattern/#_9","title":"\u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"clojure/07-composite-pattern/#4","title":"4. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u7d71\u4e00\u7684\u306a\u64cd\u4f5c: \u500b\u3005\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u30b0\u30eb\u30fc\u30d7\u3092\u540c\u3058\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u64cd\u4f5c\u53ef\u80fd</li> <li>\u968e\u5c64\u69cb\u9020: \u30cd\u30b9\u30c8\u3057\u305f\u69cb\u9020\u3092\u81ea\u7136\u306b\u8868\u73fe\u53ef\u80fd</li> <li>\u62e1\u5f35\u6027: \u65b0\u3057\u3044 Leaf \u3084 Composite \u3092\u8ffd\u52a0\u3057\u3084\u3059\u3044</li> <li>\u518d\u5e30\u7684\u306a\u69cb\u9020: Composite \u306f\u4ed6\u306e Composite \u3092\u542b\u3080\u3053\u3068\u3082\u53ef\u80fd</li> </ol>"},{"location":"clojure/07-composite-pattern/#5","title":"5. \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306e\u7279\u5fb4","text":"<p>Clojure \u3067\u306e Composite \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u306b\u306f\u4ee5\u4e0b\u306e\u7279\u5fb4\u304c\u3042\u308a\u307e\u3059\uff1a</p> <ol> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: \u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u95a2\u6570\u3067\u578b\u306b\u57fa\u3065\u3044\u305f\u591a\u614b\u6027\u3092\u5b9f\u73fe</li> <li>\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u306a\u30c7\u30fc\u30bf: \u64cd\u4f5c\u306f\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u3092\u8fd4\u3059\uff08\u5143\u306e\u30c7\u30fc\u30bf\u3092\u5909\u66f4\u3057\u306a\u3044\uff09</li> <li>Spec \u306b\u3088\u308b\u691c\u8a3c: \u30c7\u30fc\u30bf\u306e\u6574\u5408\u6027\u3092\u4fdd\u8a3c</li> <li>\u30b7\u30f3\u30d7\u30eb\u306a\u69cb\u9020: \u30af\u30e9\u30b9\u306e\u4ee3\u308f\u308a\u306b\u30de\u30c3\u30d7\u3092\u4f7f\u7528</li> </ol>"},{"location":"clojure/07-composite-pattern/#_10","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Composite \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>Shape \u306e\u4f8b: \u56f3\u5f62\u306e\u79fb\u52d5\u3068\u62e1\u5927\u3092\u7d71\u4e00\u7684\u306b\u64cd\u4f5c</li> <li>Switchable \u306e\u4f8b: \u8907\u6570\u306e\u30b9\u30a4\u30c3\u30c1\u3092\u30b0\u30eb\u30fc\u30d7\u5316\u3057\u3066\u64cd\u4f5c</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: Clojure \u3067\u306e\u591a\u614b\u6027\u306e\u5b9f\u73fe\u65b9\u6cd5</li> <li>Spec: \u30c7\u30fc\u30bf\u69cb\u9020\u306e\u691c\u8a3c</li> </ol> <p>Composite \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30c4\u30ea\u30fc\u69cb\u9020\u306e\u30c7\u30fc\u30bf\u3092\u6271\u3046\u969b\u306b\u975e\u5e38\u306b\u6709\u52b9\u306a\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002</p>"},{"location":"clojure/07-composite-pattern/#_11","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part3/src/composite_pattern/</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part3/spec/composite_pattern/</code></li> </ul>"},{"location":"clojure/07-composite-pattern/#_12","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Decorator \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u65e2\u5b58\u306e\u6a5f\u80fd\u306b\u65b0\u3057\u3044\u6a5f\u80fd\u3092\u52d5\u7684\u306b\u8ffd\u52a0\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/08-decorator-pattern/","title":"\u7b2c8\u7ae0: Decorator \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"clojure/08-decorator-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Decorator \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u65e2\u5b58\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u65b0\u3057\u3044\u6a5f\u80fd\u3092\u52d5\u7684\u306b\u8ffd\u52a0\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u3053\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u30b5\u30d6\u30af\u30e9\u30b9\u5316\u306b\u3088\u308b\u7d99\u627f\u3088\u308a\u3082\u67d4\u8edf\u306a\u65b9\u6cd5\u3067\u6a5f\u80fd\u3092\u62e1\u5f35\u3067\u304d\u307e\u3059\u3002</p> <p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u9ad8\u968e\u95a2\u6570\u3092\u4f7f\u3063\u3066\u95a2\u6570\u3092\u30e9\u30c3\u30d7\u3057\u3001\u6a2a\u65ad\u7684\u95a2\u5fc3\u4e8b\uff08\u30ed\u30b0\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u3001\u8a8d\u8a3c\u306a\u3069\uff09\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\u672c\u7ae0\u3067\u306f\u3001\u5f62\u72b6\u306e\u30b8\u30e3\u30fc\u30ca\u30ea\u30f3\u30b0\u3068\u95a2\u6570\u30c7\u30b3\u30ec\u30fc\u30bf\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/08-decorator-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Decorator \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Component: \u30c7\u30b3\u30ec\u30fc\u30c8\u5bfe\u8c61\u306e\u5171\u901a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>ConcreteComponent: \u5177\u4f53\u7684\u306a\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8</li> <li>Decorator: Component \u3092\u30e9\u30c3\u30d7\u3057\u3001\u8ffd\u52a0\u6a5f\u80fd\u3092\u63d0\u4f9b</li> </ul> <p></p>"},{"location":"clojure/08-decorator-pattern/#2-journaledshape","title":"2. JournaledShape \u306e\u4f8b","text":""},{"location":"clojure/08-decorator-pattern/#_2","title":"\u30c7\u30b3\u30ec\u30fc\u30bf\u306e\u5b9f\u88c5","text":"<p>\u5f62\u72b6\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u64cd\u4f5c\u306e\u5c65\u6b74\u3092\u8a18\u9332\u3059\u308b\u6a5f\u80fd\u3092\u8ffd\u52a0\u3059\u308b\u30c7\u30b3\u30ec\u30fc\u30bf\u3067\u3059\u3002</p> <pre><code>(ns decorator-pattern.journaled-shape\n  (:require [clojure.spec.alpha :as s]\n            [composite-pattern.shape :as shape]))\n\n(s/def ::journal-entry\n  (s/or :translate (s/tuple #{:translate} number? number?)\n        :scale (s/tuple #{:scale} number?)))\n(s/def ::journal (s/coll-of ::journal-entry))\n(s/def ::shape ::shape/shape-type)\n(s/def ::journaled-shape (s/and\n                          (s/keys :req [::shape/type ::journal ::shape])\n                          #(= ::journal-shape (::shape/type %))))\n\n(defn make\n  \"\u5f62\u72b6\u3092\u30c7\u30b3\u30ec\u30fc\u30c8\u3057\u3066\u30b8\u30e3\u30fc\u30ca\u30eb\u6a5f\u80fd\u3092\u8ffd\u52a0\u3059\u308b\"\n  [shape]\n  {:post [(s/valid? ::journaled-shape %)]}\n  {::shape/type ::journal-shape\n   ::journal []\n   ::shape shape})\n\n(defmethod shape/translate ::journal-shape [js dx dy]\n  (-&gt; js\n      (update ::journal conj [:translate dx dy])\n      (assoc ::shape (shape/translate (::shape js) dx dy))))\n\n(defmethod shape/scale ::journal-shape [js factor]\n  (-&gt; js\n      (update ::journal conj [:scale factor])\n      (assoc ::shape (shape/scale (::shape js) factor))))\n</code></pre>"},{"location":"clojure/08-decorator-pattern/#_3","title":"\u30af\u30e9\u30b9\u56f3","text":""},{"location":"clojure/08-decorator-pattern/#_4","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>(require '[composite-pattern.square :as square])\n(require '[decorator-pattern.journaled-shape :as js])\n\n;; \u5f62\u72b6\u3092\u30c7\u30b3\u30ec\u30fc\u30c8\n(def journaled-square\n  (-&gt; (js/make (square/make-square [0 0] 1))\n      (shape/translate 2 3)\n      (shape/scale 5)))\n\n;; \u30b8\u30e3\u30fc\u30ca\u30eb\u3092\u78ba\u8a8d\n(js/get-journal journaled-square)\n;; =&gt; [[:translate 2 3] [:scale 5]]\n\n;; \u5b9f\u969b\u306e\u5f62\u72b6\u3092\u78ba\u8a8d\n(js/get-shape journaled-square)\n;; =&gt; {:top-left [2 3], :side 5}\n</code></pre>"},{"location":"clojure/08-decorator-pattern/#_5","title":"\u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"clojure/08-decorator-pattern/#3","title":"3. \u95a2\u6570\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u9ad8\u968e\u95a2\u6570\u3092\u4f7f\u3063\u3066\u95a2\u6570\u3092\u30c7\u30b3\u30ec\u30fc\u30c8\u3057\u307e\u3059\u3002</p>"},{"location":"clojure/08-decorator-pattern/#_6","title":"\u30ed\u30b0\u51fa\u529b\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>(defn with-logging\n  \"\u95a2\u6570\u306b\u30ed\u30b0\u51fa\u529b\u3092\u8ffd\u52a0\u3059\u308b\u30c7\u30b3\u30ec\u30fc\u30bf\"\n  [f name]\n  (fn [&amp; args]\n    (println (str \"[LOG] \" name \" called with: \" args))\n    (let [result (apply f args)]\n      (println (str \"[LOG] \" name \" returned: \" result))\n      result)))\n\n;; \u4f7f\u7528\u4f8b\n(def add-logged (with-logging + \"add\"))\n(add-logged 2 3)\n;; [LOG] add called with: (2 3)\n;; [LOG] add returned: 5\n;; =&gt; 5\n</code></pre>"},{"location":"clojure/08-decorator-pattern/#_7","title":"\u30ea\u30c8\u30e9\u30a4\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>(defn with-retry\n  \"\u95a2\u6570\u306b\u30ea\u30c8\u30e9\u30a4\u6a5f\u80fd\u3092\u8ffd\u52a0\u3059\u308b\u30c7\u30b3\u30ec\u30fc\u30bf\"\n  [f max-retries]\n  (fn [&amp; args]\n    (loop [attempts 0]\n      (let [result (try\n                     {:success true :value (apply f args)}\n                     (catch Exception e\n                       {:success false :error e}))]\n        (if (:success result)\n          (:value result)\n          (if (&lt; attempts max-retries)\n            (do\n              (println \"[RETRY] Retrying...\")\n              (recur (inc attempts)))\n            (throw (:error result))))))))\n</code></pre>"},{"location":"clojure/08-decorator-pattern/#_8","title":"\u30ad\u30e3\u30c3\u30b7\u30e5\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>(defn with-cache\n  \"\u95a2\u6570\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u8ffd\u52a0\u3059\u308b\u30c7\u30b3\u30ec\u30fc\u30bf\"\n  [f]\n  (let [cache (atom {})]\n    (fn [&amp; args]\n      (if-let [cached (get @cache args)]\n        (do\n          (println \"[CACHE] Hit for\" args)\n          cached)\n        (let [result (apply f args)]\n          (println \"[CACHE] Miss for\" args)\n          (swap! cache assoc args result)\n          result)))))\n\n;; \u4f7f\u7528\u4f8b\n(def expensive-fn-cached (with-cache expensive-fn))\n</code></pre>"},{"location":"clojure/08-decorator-pattern/#_9","title":"\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>(defn with-validation\n  \"\u95a2\u6570\u306b\u5165\u529b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u8ffd\u52a0\u3059\u308b\u30c7\u30b3\u30ec\u30fc\u30bf\"\n  [f validator error-msg]\n  (fn [&amp; args]\n    (if (apply validator args)\n      (apply f args)\n      (throw (ex-info error-msg {:args args})))))\n\n;; \u4f7f\u7528\u4f8b\n(def positive-only\n  (with-validation\n    (fn [x] (* x 2))\n    (fn [x] (pos? x))\n    \"Input must be positive\"))\n\n(positive-only 5)   ;; =&gt; 10\n(positive-only -5)  ;; =&gt; Exception!\n</code></pre>"},{"location":"clojure/08-decorator-pattern/#4","title":"4. \u30c7\u30b3\u30ec\u30fc\u30bf\u306e\u7d44\u307f\u5408\u308f\u305b","text":"<p>\u8907\u6570\u306e\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002</p> <pre><code>(defn compose-decorators\n  \"\u8907\u6570\u306e\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\"\n  [f &amp; decorators]\n  (reduce (fn [decorated decorator]\n            (decorator decorated))\n          f\n          decorators))\n\n;; \u4f7f\u7528\u4f8b\n(def enhanced-fn\n  (compose-decorators\n    base-fn\n    with-cache\n    #(with-logging % \"my-fn\")\n    #(with-retry % 3)))\n</code></pre>"},{"location":"clojure/08-decorator-pattern/#_10","title":"\u7d44\u307f\u5408\u308f\u305b\u306e\u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"clojure/08-decorator-pattern/#5","title":"5. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u5358\u4e00\u8cac\u4efb\u306e\u539f\u5247: \u5404\u30c7\u30b3\u30ec\u30fc\u30bf\u306f\u4e00\u3064\u306e\u6a5f\u80fd\u306e\u307f\u3092\u8ffd\u52a0</li> <li>\u958b\u653e/\u9589\u9396\u306e\u539f\u5247: \u65e2\u5b58\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u305b\u305a\u306b\u6a5f\u80fd\u3092\u8ffd\u52a0</li> <li>\u67d4\u8edf\u306a\u7d44\u307f\u5408\u308f\u305b: \u5fc5\u8981\u306a\u6a5f\u80fd\u3060\u3051\u3092\u9078\u629e\u3057\u3066\u7d44\u307f\u5408\u308f\u305b\u53ef\u80fd</li> <li>\u5b9f\u884c\u6642\u306e\u6c7a\u5b9a: \u3069\u306e\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u9069\u7528\u3059\u308b\u304b\u5b9f\u884c\u6642\u306b\u6c7a\u5b9a\u53ef\u80fd</li> </ol>"},{"location":"clojure/08-decorator-pattern/#6","title":"6. \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306e\u7279\u5fb4","text":"<p>Clojure \u3067\u306e Decorator \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u306b\u306f\u4ee5\u4e0b\u306e\u7279\u5fb4\u304c\u3042\u308a\u307e\u3059\uff1a</p> <ol> <li>\u9ad8\u968e\u95a2\u6570: \u95a2\u6570\u3092\u5f15\u6570\u306b\u53d6\u308a\u3001\u65b0\u3057\u3044\u95a2\u6570\u3092\u8fd4\u3059</li> <li>\u30af\u30ed\u30fc\u30b8\u30e3: \u72b6\u614b\uff08\u30ad\u30e3\u30c3\u30b7\u30e5\u306a\u3069\uff09\u3092\u5185\u90e8\u306b\u4fdd\u6301</li> <li>\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u306a\u30c7\u30fc\u30bf: \u30c7\u30b3\u30ec\u30fc\u30c8\u5f8c\u3082\u5143\u306e\u30c7\u30fc\u30bf\u306f\u5909\u66f4\u3055\u308c\u306a\u3044</li> <li>\u5408\u6210\u306e\u3057\u3084\u3059\u3055: <code>comp</code> \u3084 <code>reduce</code> \u3067\u7c21\u5358\u306b\u7d44\u307f\u5408\u308f\u305b\u53ef\u80fd</li> </ol>"},{"location":"clojure/08-decorator-pattern/#_11","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Decorator \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>JournaledShape: \u5f62\u72b6\u64cd\u4f5c\u306e\u5c65\u6b74\u3092\u8a18\u9332\u3059\u308b\u30c7\u30b3\u30ec\u30fc\u30bf</li> <li>\u95a2\u6570\u30c7\u30b3\u30ec\u30fc\u30bf: \u30ed\u30b0\u3001\u30ea\u30c8\u30e9\u30a4\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u306a\u3069\u306e\u6a2a\u65ad\u7684\u95a2\u5fc3\u4e8b</li> <li>\u30c7\u30b3\u30ec\u30fc\u30bf\u306e\u7d44\u307f\u5408\u308f\u305b: \u8907\u6570\u306e\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u67d4\u8edf\u306b\u7d44\u307f\u5408\u308f\u305b</li> </ol> <p>Decorator \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u65e2\u5b58\u306e\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u305b\u305a\u306b\u6a5f\u80fd\u3092\u62e1\u5f35\u3059\u308b\u5f37\u529b\u306a\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002</p>"},{"location":"clojure/08-decorator-pattern/#_12","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part3/src/decorator_pattern/</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part3/spec/decorator_pattern/</code></li> </ul>"},{"location":"clojure/08-decorator-pattern/#_13","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Adapter \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u7570\u306a\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u9593\u306e\u5909\u63db\u3068\u30ec\u30ac\u30b7\u30fc\u30b7\u30b9\u30c6\u30e0\u3068\u306e\u7d71\u5408\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/09-adapter-pattern/","title":"\u7b2c9\u7ae0: Adapter \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"clojure/09-adapter-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Adapter \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u65e2\u5b58\u306e\u30af\u30e9\u30b9\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u671f\u5f85\u3059\u308b\u5225\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306b\u5909\u63db\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u3053\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u4e92\u63db\u6027\u306e\u306a\u3044\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u6301\u3064\u30af\u30e9\u30b9\u540c\u58eb\u3092\u9023\u643a\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u53ef\u5909\u5f37\u5ea6\u30e9\u30a4\u30c8\u306e\u30a2\u30c0\u30d7\u30bf\u30fc\u3068\u30c7\u30fc\u30bf\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u5909\u63db\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/09-adapter-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Adapter \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Target: \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u671f\u5f85\u3059\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>Adaptee: \u65e2\u5b58\u306e\u30af\u30e9\u30b9\uff08\u9069\u5fdc\u3055\u308c\u308b\u5074\uff09</li> <li>Adapter: Target \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u5b9f\u88c5\u3057\u3001Adaptee \u3092\u4f7f\u7528</li> </ul> <p></p>"},{"location":"clojure/09-adapter-pattern/#2-variablelight","title":"2. VariableLight \u306e\u4f8b","text":""},{"location":"clojure/09-adapter-pattern/#switchable-target","title":"Switchable \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9 (Target)","text":"<pre><code>(ns adapter-pattern.switchable)\n\n(defmulti turn-on\n  \"\u30b9\u30a4\u30c3\u30c1\u3092\u30aa\u30f3\u306b\u3059\u308b\"\n  :type)\n\n(defmulti turn-off\n  \"\u30b9\u30a4\u30c3\u30c1\u3092\u30aa\u30d5\u306b\u3059\u308b\"\n  :type)\n</code></pre>"},{"location":"clojure/09-adapter-pattern/#variablelight-adaptee","title":"VariableLight (Adaptee)","text":"<p>\u53ef\u5909\u5f37\u5ea6\u3092\u6301\u3064\u30e9\u30a4\u30c8\u306f\u3001\u5358\u7d14\u306a\u30aa\u30f3/\u30aa\u30d5\u3067\u306f\u306a\u304f\u3001\u5f37\u5ea6\u3092\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p> <pre><code>(ns adapter-pattern.variable-light)\n\n(defn turn-on-light\n  \"\u30e9\u30a4\u30c8\u3092\u6307\u5b9a\u3057\u305f\u5f37\u5ea6\u3067\u70b9\u706f\u3059\u308b\"\n  [intensity]\n  (println (str \"VariableLight: intensity set to \" intensity))\n  {:intensity intensity})\n</code></pre>"},{"location":"clojure/09-adapter-pattern/#variablelightadapter-adapter","title":"VariableLightAdapter (Adapter)","text":"<pre><code>(ns adapter-pattern.variable-light-adapter\n  (:require [adapter-pattern.switchable :as s]\n            [adapter-pattern.variable-light :as vl]))\n\n(defn make-adapter\n  \"VariableLight \u306e\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u4f5c\u6210\u3059\u308b\"\n  [min-intensity max-intensity]\n  {:type :variable-light-adapter\n   :min-intensity min-intensity\n   :max-intensity max-intensity})\n\n(defmethod s/turn-on :variable-light-adapter [adapter]\n  (vl/turn-on-light (:max-intensity adapter)))\n\n(defmethod s/turn-off :variable-light-adapter [adapter]\n  (vl/turn-on-light (:min-intensity adapter)))\n</code></pre>"},{"location":"clojure/09-adapter-pattern/#_2","title":"\u30af\u30e9\u30b9\u56f3","text":""},{"location":"clojure/09-adapter-pattern/#client","title":"Client","text":"<pre><code>(ns adapter-pattern.engage-switch\n  (:require [adapter-pattern.switchable :as s]))\n\n(defn engage-switch\n  \"\u30b9\u30a4\u30c3\u30c1\u3092\u64cd\u4f5c\u3059\u308b\"\n  [switchable]\n  (println \"Engaging switch...\")\n  (let [on-result (s/turn-on switchable)\n        off-result (s/turn-off switchable)]\n    {:on-result on-result\n     :off-result off-result}))\n</code></pre>"},{"location":"clojure/09-adapter-pattern/#_3","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>(require '[adapter-pattern.variable-light-adapter :as adapter])\n(require '[adapter-pattern.engage-switch :as client])\n\n;; \u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u4f5c\u6210\uff08\u6700\u5c0f0\u3001\u6700\u5927100\uff09\n(def vl-adapter (adapter/make-adapter 0 100))\n\n;; \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306fSwitchable\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u64cd\u4f5c\n(client/engage-switch vl-adapter)\n;; Engaging switch...\n;; VariableLight: intensity set to 100\n;; VariableLight: intensity set to 0\n;; =&gt; {:on-result {:intensity 100}, :off-result {:intensity 0}}\n</code></pre>"},{"location":"clojure/09-adapter-pattern/#_4","title":"\u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"clojure/09-adapter-pattern/#3","title":"3. \u30c7\u30fc\u30bf\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u30a2\u30c0\u30d7\u30bf\u30fc","text":""},{"location":"clojure/09-adapter-pattern/#_5","title":"\u30e6\u30fc\u30b6\u30fc\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u5909\u63db","text":"<p>\u7570\u306a\u308b\u30b7\u30b9\u30c6\u30e0\u9593\u3067\u30c7\u30fc\u30bf\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304c\u7570\u306a\u308b\u5834\u5408\u3001\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u4f7f\u3063\u3066\u5909\u63db\u3057\u307e\u3059\u3002</p> <pre><code>(ns adapter-pattern.data-format\n  (:require [clojure.string :as str]))\n\n(defn adapt-old-user-to-new\n  \"\u65e7\u30e6\u30fc\u30b6\u30fc\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u65b0\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306b\u5909\u63db\"\n  [old-user]\n  {:name (str (:lastName old-user) \" \" (:firstName old-user))\n   :email (:emailAddress old-user)\n   :phone (:phoneNumber old-user)\n   :metadata {:migrated true\n              :original-format :old}})\n\n(defn adapt-new-user-to-old\n  \"\u65b0\u30e6\u30fc\u30b6\u30fc\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u65e7\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306b\u5909\u63db\"\n  [new-user]\n  (let [name-parts (str/split (:name new-user) #\" \")\n        last-name (first name-parts)\n        first-name (if (&gt; (count name-parts) 1)\n                     (second name-parts)\n                     \"\")]\n    {:firstName first-name\n     :lastName last-name\n     :emailAddress (:email new-user)\n     :phoneNumber (:phone new-user)}))\n</code></pre>"},{"location":"clojure/09-adapter-pattern/#_6","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>;; \u65e7\u30d5\u30a9\u30fc\u30de\u30c3\u30c8 \u2192 \u65b0\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\n(def old-user {:firstName \"\u592a\u90ce\"\n               :lastName \"\u5c71\u7530\"\n               :emailAddress \"taro@example.com\"\n               :phoneNumber \"090-1234-5678\"})\n\n(adapt-old-user-to-new old-user)\n;; =&gt; {:name \"\u5c71\u7530 \u592a\u90ce\"\n;;     :email \"taro@example.com\"\n;;     :phone \"090-1234-5678\"\n;;     :metadata {:migrated true, :original-format :old}}\n\n;; \u65b0\u30d5\u30a9\u30fc\u30de\u30c3\u30c8 \u2192 \u65e7\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\n(def new-user {:name \"\u5c71\u7530 \u592a\u90ce\"\n               :email \"taro@example.com\"\n               :phone \"090-1234-5678\"})\n\n(adapt-new-user-to-old new-user)\n;; =&gt; {:firstName \"\u592a\u90ce\"\n;;     :lastName \"\u5c71\u7530\"\n;;     :emailAddress \"taro@example.com\"\n;;     :phoneNumber \"090-1234-5678\"}\n</code></pre>"},{"location":"clojure/09-adapter-pattern/#api","title":"API \u30ec\u30b9\u30dd\u30f3\u30b9\u30a2\u30c0\u30d7\u30bf\u30fc","text":"<pre><code>(defn adapt-external-api-response\n  \"\u5916\u90e8API \u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u5185\u90e8\u5f62\u5f0f\u306b\u5909\u63db\"\n  [external-response]\n  {:id (get-in external-response [\"data\" \"identifier\"])\n   :name (get-in external-response [\"data\" \"attributes\" \"name\"])\n   :created-at (get-in external-response [\"data\" \"attributes\" \"createdAt\"])\n   :metadata {:source :external-api\n              :original-id (get-in external-response [\"data\" \"id\"])}})\n\n(defn adapt-internal-to-external\n  \"\u5185\u90e8\u5f62\u5f0f\u3092\u5916\u90e8API \u306e\u5f62\u5f0f\u306b\u5909\u63db\"\n  [internal-data]\n  {\"data\" {\"type\" \"resource\"\n           \"id\" (str (:id internal-data))\n           \"attributes\" {\"name\" (:name internal-data)\n                         \"createdAt\" (:created-at internal-data)}}})\n</code></pre>"},{"location":"clojure/09-adapter-pattern/#_7","title":"\u30c7\u30fc\u30bf\u5909\u63db\u306e\u56f3","text":""},{"location":"clojure/09-adapter-pattern/#4","title":"4. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u65e2\u5b58\u30b3\u30fc\u30c9\u306e\u518d\u5229\u7528: \u65e2\u5b58\u306e\u30af\u30e9\u30b9\u3092\u5909\u66f4\u305b\u305a\u306b\u65b0\u3057\u3044\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u4f7f\u7528</li> <li>\u5358\u4e00\u8cac\u4efb\u306e\u539f\u5247: \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u5909\u63db\u306e\u30ed\u30b8\u30c3\u30af\u3092\u5206\u96e2</li> <li>\u958b\u653e/\u9589\u9396\u306e\u539f\u5247: \u65b0\u3057\u3044\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u8ffd\u52a0\u3057\u3066\u3082\u65e2\u5b58\u30b3\u30fc\u30c9\u306f\u5909\u66f4\u4e0d\u8981</li> <li>\u30ec\u30ac\u30b7\u30fc\u30b7\u30b9\u30c6\u30e0\u3068\u306e\u7d71\u5408: \u53e4\u3044\u30b7\u30b9\u30c6\u30e0\u3068\u65b0\u3057\u3044\u30b7\u30b9\u30c6\u30e0\u3092\u9023\u643a</li> </ol>"},{"location":"clojure/09-adapter-pattern/#5","title":"5. \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306e\u7279\u5fb4","text":"<p>Clojure \u3067\u306e Adapter \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u306b\u306f\u4ee5\u4e0b\u306e\u7279\u5fb4\u304c\u3042\u308a\u307e\u3059\uff1a</p> <ol> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: \u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u95a2\u6570\u3067\u578b\u306b\u57fa\u3065\u3044\u305f\u591a\u614b\u6027\u3092\u5b9f\u73fe</li> <li>\u95a2\u6570\u306b\u3088\u308b\u5909\u63db: \u5358\u7d14\u306a\u30c7\u30fc\u30bf\u5909\u63db\u306f\u95a2\u6570\u3067\u76f4\u63a5\u5b9f\u88c5</li> <li>\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u306a\u30c7\u30fc\u30bf: \u5909\u63db\u5f8c\u3082\u5143\u306e\u30c7\u30fc\u30bf\u306f\u5909\u66f4\u3055\u308c\u306a\u3044</li> <li>\u5408\u6210\u306e\u3057\u3084\u3059\u3055: \u8907\u6570\u306e\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u7d44\u307f\u5408\u308f\u305b\u53ef\u80fd</li> </ol>"},{"location":"clojure/09-adapter-pattern/#_8","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Adapter \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>VariableLightAdapter: \u53ef\u5909\u5f37\u5ea6\u30e9\u30a4\u30c8\u3092\u5358\u7d14\u306a\u30aa\u30f3/\u30aa\u30d5\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306b\u9069\u5fdc</li> <li>\u30c7\u30fc\u30bf\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u30a2\u30c0\u30d7\u30bf\u30fc: \u7570\u306a\u308b\u30c7\u30fc\u30bf\u5f62\u5f0f\u9593\u306e\u5909\u63db</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: Clojure \u3067\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u9069\u5fdc</li> </ol> <p>Adapter \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u65e2\u5b58\u306e\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u305b\u305a\u306b\u7570\u306a\u308b\u30b7\u30b9\u30c6\u30e0\u3092\u9023\u643a\u3055\u305b\u308b\u969b\u306b\u975e\u5e38\u306b\u6709\u52b9\u3067\u3059\u3002</p>"},{"location":"clojure/09-adapter-pattern/#_9","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part3/src/adapter_pattern/</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part3/spec/adapter_pattern/</code></li> </ul>"},{"location":"clojure/09-adapter-pattern/#_10","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Facade \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u8907\u96d1\u306a\u30b5\u30d6\u30b7\u30b9\u30c6\u30e0\u3078\u306e\u30b7\u30f3\u30d7\u30eb\u306a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u63d0\u4f9b\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/10-strategy-pattern/","title":"\u7b2c10\u7ae0: Strategy \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"clojure/10-strategy-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Strategy \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u30ab\u30d7\u30bb\u30eb\u5316\u3057\u3001\u305d\u308c\u3089\u3092\u4ea4\u63db\u53ef\u80fd\u306b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u3053\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u72ec\u7acb\u3057\u3066\u5909\u66f4\u3067\u304d\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u6599\u91d1\u8a08\u7b97\u3068\u914d\u9001\u6599\u91d1\u306e\u4f8b\u3092\u901a\u3058\u3066\u3001\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u3068\u9ad8\u968e\u95a2\u6570\u306b\u3088\u308b Strategy \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/10-strategy-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Strategy \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Strategy: \u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>ConcreteStrategy: \u5177\u4f53\u7684\u306a\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u5b9f\u88c5</li> <li>Context: Strategy \u3092\u4f7f\u7528\u3059\u308b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8</li> </ul> <p></p>"},{"location":"clojure/10-strategy-pattern/#2","title":"2. \u6599\u91d1\u8a08\u7b97\u306e\u4f8b","text":""},{"location":"clojure/10-strategy-pattern/#strategy","title":"Strategy \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9","text":"<pre><code>(ns strategy-pattern.pricing)\n\n(defmulti calculate-price\n  \"\u6599\u91d1\u3092\u8a08\u7b97\u3059\u308b\"\n  (fn [strategy _amount] (:type strategy)))\n</code></pre>"},{"location":"clojure/10-strategy-pattern/#concretestrategy","title":"ConcreteStrategy: \u901a\u5e38\u6599\u91d1","text":"<pre><code>(defn make-regular-pricing\n  \"\u901a\u5e38\u6599\u91d1\u6226\u7565\u3092\u4f5c\u6210\"\n  []\n  {:type :regular})\n\n(defmethod calculate-price :regular [_strategy amount]\n  amount)\n</code></pre>"},{"location":"clojure/10-strategy-pattern/#concretestrategy_1","title":"ConcreteStrategy: \u5272\u5f15\u6599\u91d1","text":"<pre><code>(defn make-discount-pricing\n  \"\u5272\u5f15\u6599\u91d1\u6226\u7565\u3092\u4f5c\u6210\"\n  [discount-rate]\n  {:type :discount\n   :discount-rate discount-rate})\n\n(defmethod calculate-price :discount [strategy amount]\n  (let [rate (:discount-rate strategy)]\n    (* amount (- 1.0 rate))))\n</code></pre>"},{"location":"clojure/10-strategy-pattern/#concretestrategy_2","title":"ConcreteStrategy: \u4f1a\u54e1\u6599\u91d1","text":"<pre><code>(defn make-member-pricing\n  \"\u4f1a\u54e1\u6599\u91d1\u6226\u7565\u3092\u4f5c\u6210\"\n  [member-level]\n  {:type :member\n   :member-level member-level})\n\n(defmethod calculate-price :member [strategy amount]\n  (let [level (:member-level strategy)\n        rate (case level\n               :gold 0.20\n               :silver 0.15\n               :bronze 0.10\n               0.0)]\n    (* amount (- 1.0 rate))))\n</code></pre>"},{"location":"clojure/10-strategy-pattern/#_2","title":"\u30af\u30e9\u30b9\u56f3","text":""},{"location":"clojure/10-strategy-pattern/#_3","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>(require '[strategy-pattern.pricing :as pricing])\n\n;; \u901a\u5e38\u6599\u91d1\n(def regular (pricing/make-regular-pricing))\n(pricing/calculate-price regular 1000)\n;; =&gt; 1000\n\n;; 10%\u5272\u5f15\n(def discount (pricing/make-discount-pricing 0.10))\n(pricing/calculate-price discount 1000)\n;; =&gt; 900.0\n\n;; \u30b4\u30fc\u30eb\u30c9\u4f1a\u54e1\u6599\u91d1\n(def gold (pricing/make-member-pricing :gold))\n(pricing/calculate-price gold 1000)\n;; =&gt; 800.0\n</code></pre>"},{"location":"clojure/10-strategy-pattern/#3-context","title":"3. Context: \u30b7\u30e7\u30c3\u30d4\u30f3\u30b0\u30ab\u30fc\u30c8","text":""},{"location":"clojure/10-strategy-pattern/#_4","title":"\u5b9f\u88c5","text":"<pre><code>(ns strategy-pattern.context\n  (:require [strategy-pattern.pricing :as pricing]))\n\n(defn make-cart\n  \"\u30b7\u30e7\u30c3\u30d4\u30f3\u30b0\u30ab\u30fc\u30c8\u3092\u4f5c\u6210\"\n  [items pricing-strategy]\n  {:items items\n   :strategy pricing-strategy})\n\n(defn cart-total\n  \"\u30ab\u30fc\u30c8\u306e\u5408\u8a08\u91d1\u984d\u3092\u8a08\u7b97\"\n  [cart]\n  (let [items (:items cart)\n        strategy (:strategy cart)\n        subtotal (reduce + (map :price items))]\n    (pricing/calculate-price strategy subtotal)))\n\n(defn change-strategy\n  \"\u6599\u91d1\u6226\u7565\u3092\u5909\u66f4\"\n  [cart new-strategy]\n  (assoc cart :strategy new-strategy))\n</code></pre>"},{"location":"clojure/10-strategy-pattern/#_5","title":"\u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"clojure/10-strategy-pattern/#_6","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>(require '[strategy-pattern.context :as ctx])\n(require '[strategy-pattern.pricing :as pricing])\n\n;; \u30ab\u30fc\u30c8\u3092\u4f5c\u6210\n(def items [{:name \"Item A\" :price 500}\n            {:name \"Item B\" :price 500}])\n\n(def cart (ctx/make-cart items (pricing/make-regular-pricing)))\n(ctx/cart-total cart)\n;; =&gt; 1000\n\n;; \u6226\u7565\u3092\u5909\u66f4\n(def discounted-cart (ctx/change-strategy cart (pricing/make-member-pricing :gold)))\n(ctx/cart-total discounted-cart)\n;; =&gt; 800.0\n</code></pre>"},{"location":"clojure/10-strategy-pattern/#4","title":"4. \u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1","text":"<p>Clojure \u3067\u306f\u3001\u95a2\u6570\u3092\u7b2c\u4e00\u7d1a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u6271\u3048\u308b\u305f\u3081\u3001\u3088\u308a\u7c21\u6f54\u306b Strategy \u30d1\u30bf\u30fc\u30f3\u3092\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"clojure/10-strategy-pattern/#strategy_1","title":"\u95a2\u6570\u306b\u3088\u308b Strategy","text":"<pre><code>(ns strategy-pattern.functional-strategy)\n\n(defn apply-pricing\n  \"\u6599\u91d1\u6226\u7565\u3092\u9069\u7528\"\n  [strategy-fn amount]\n  (strategy-fn amount))\n\n;; \u6226\u7565\u95a2\u6570\u306e\u5b9a\u7fa9\n(def regular-pricing identity)\n\n(defn discount-pricing\n  \"\u5272\u5f15\u6226\u7565\u3092\u4f5c\u6210\"\n  [rate]\n  (fn [amount]\n    (* amount (- 1.0 rate))))\n\n(defn member-pricing\n  \"\u4f1a\u54e1\u6226\u7565\u3092\u4f5c\u6210\"\n  [level]\n  (let [rate (case level\n               :gold 0.20\n               :silver 0.15\n               :bronze 0.10\n               0.0)]\n    (fn [amount]\n      (* amount (- 1.0 rate)))))\n</code></pre>"},{"location":"clojure/10-strategy-pattern/#_7","title":"\u6226\u7565\u306e\u5408\u6210","text":"<p>\u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1\u306e\u5927\u304d\u306a\u5229\u70b9\u306f\u3001\u6226\u7565\u3092\u7c21\u5358\u306b\u5408\u6210\u3067\u304d\u308b\u3053\u3068\u3067\u3059\u3002</p> <pre><code>(defn compose-strategies\n  \"\u8907\u6570\u306e\u6226\u7565\u3092\u5408\u6210\"\n  [&amp; strategies]\n  (fn [amount]\n    (reduce (fn [a strategy] (strategy a)) amount strategies)))\n\n(defn tax-strategy\n  \"\u7a0e\u91d1\u6226\u7565\u3092\u4f5c\u6210\"\n  [tax-rate]\n  (fn [amount]\n    (* amount (+ 1.0 tax-rate))))\n\n;; \u4f7f\u7528\u4f8b\uff1a\u5272\u5f15\u5f8c\u306b\u7a0e\u91d1\u3092\u9069\u7528\n(def discount (discount-pricing 0.10))\n(def tax (tax-strategy 0.08))\n(def final-price (compose-strategies discount tax))\n\n(apply-pricing final-price 1000)\n;; =&gt; 972.0  (1000 * 0.9 * 1.08)\n</code></pre>"},{"location":"clojure/10-strategy-pattern/#_8","title":"\u6761\u4ef6\u4ed8\u304d\u6226\u7565","text":"<pre><code>(defn conditional-strategy\n  \"\u6761\u4ef6\u4ed8\u304d\u6226\u7565\"\n  [pred then-strategy else-strategy]\n  (fn [amount]\n    (if (pred amount)\n      (then-strategy amount)\n      (else-strategy amount))))\n\n;; 5000\u5186\u4ee5\u4e0a\u306720%\u5272\u5f15\n(def high-value-discount\n  (conditional-strategy\n    #(&gt;= % 5000)\n    (discount-pricing 0.20)\n    regular-pricing))\n\n(apply-pricing high-value-discount 6000)\n;; =&gt; 4800.0\n\n(apply-pricing high-value-discount 3000)\n;; =&gt; 3000\n</code></pre>"},{"location":"clojure/10-strategy-pattern/#_9","title":"\u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1\u306e\u56f3","text":""},{"location":"clojure/10-strategy-pattern/#5","title":"5. \u914d\u9001\u6599\u91d1\u306e\u4f8b","text":"<p>Strategy \u30d1\u30bf\u30fc\u30f3\u306f\u914d\u9001\u6599\u91d1\u8a08\u7b97\u306b\u3082\u9069\u7528\u3067\u304d\u307e\u3059\u3002</p> <pre><code>(defmulti calculate-shipping\n  \"\u914d\u9001\u6599\u91d1\u3092\u8a08\u7b97\"\n  (fn [strategy _weight _distance] (:type strategy)))\n\n(defn make-standard-shipping []\n  {:type :standard-shipping})\n\n(defmethod calculate-shipping :standard-shipping [_strategy weight distance]\n  (+ (* weight 10) (* distance 5)))\n\n(defn make-express-shipping []\n  {:type :express-shipping})\n\n(defmethod calculate-shipping :express-shipping [_strategy weight distance]\n  (+ (* weight 20) (* distance 15)))\n\n(defn make-free-shipping [min-order-amount]\n  {:type :free-shipping\n   :min-order-amount min-order-amount})\n\n(defmethod calculate-shipping :free-shipping [_strategy _weight _distance]\n  0)\n</code></pre>"},{"location":"clojure/10-strategy-pattern/#6","title":"6. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u4ea4\u63db: \u5b9f\u884c\u6642\u306b\u6226\u7565\u3092\u5909\u66f4\u53ef\u80fd</li> <li>\u958b\u653e/\u9589\u9396\u306e\u539f\u5247: \u65b0\u3057\u3044\u6226\u7565\u3092\u8ffd\u52a0\u3057\u3066\u3082\u65e2\u5b58\u30b3\u30fc\u30c9\u306f\u5909\u66f4\u4e0d\u8981</li> <li>\u6761\u4ef6\u5206\u5c90\u306e\u6392\u9664: if/switch \u6587\u306e\u4ee3\u308f\u308a\u306b\u30dd\u30ea\u30e2\u30fc\u30d5\u30a3\u30ba\u30e0\u3092\u4f7f\u7528</li> <li>\u30c6\u30b9\u30c8\u306e\u5bb9\u6613\u3055: \u5404\u6226\u7565\u3092\u72ec\u7acb\u3057\u3066\u30c6\u30b9\u30c8\u53ef\u80fd</li> </ol>"},{"location":"clojure/10-strategy-pattern/#7","title":"7. \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306e\u7279\u5fb4","text":"<p>Clojure \u3067\u306e Strategy \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u306b\u306f\u4ee5\u4e0b\u306e\u7279\u5fb4\u304c\u3042\u308a\u307e\u3059\uff1a</p> <ol> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: \u578b\u306b\u57fa\u3065\u3044\u305f\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u3067\u591a\u614b\u6027\u3092\u5b9f\u73fe</li> <li>\u9ad8\u968e\u95a2\u6570: \u95a2\u6570\u3092\u6226\u7565\u3068\u3057\u3066\u76f4\u63a5\u6e21\u3059\u3053\u3068\u304c\u3067\u304d\u308b</li> <li>\u95a2\u6570\u5408\u6210: \u8907\u6570\u306e\u6226\u7565\u3092\u7c21\u5358\u306b\u7d44\u307f\u5408\u308f\u305b\u53ef\u80fd</li> <li>\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb: \u6226\u7565\u306e\u5909\u66f4\u306f\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u8fd4\u3059</li> </ol>"},{"location":"clojure/10-strategy-pattern/#_10","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Strategy \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u7248: \u578b\u30d9\u30fc\u30b9\u306e\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u306b\u3088\u308b\u5b9f\u88c5</li> <li>\u95a2\u6570\u578b\u7248: \u9ad8\u968e\u95a2\u6570\u306b\u3088\u308b\u7c21\u6f54\u306a\u5b9f\u88c5</li> <li>\u6226\u7565\u306e\u5408\u6210: \u8907\u6570\u306e\u6226\u7565\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u65b9\u6cd5</li> <li>Context: \u6226\u7565\u3092\u4f7f\u7528\u3059\u308b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u5b9f\u88c5</li> </ol> <p>Strategy \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u67d4\u8edf\u306b\u4ea4\u63db\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u5834\u9762\u3067\u975e\u5e38\u306b\u6709\u52b9\u3067\u3059\u3002</p>"},{"location":"clojure/10-strategy-pattern/#_11","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part4/src/strategy_pattern/</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part4/spec/strategy_pattern/</code></li> </ul>"},{"location":"clojure/10-strategy-pattern/#_12","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Command \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u30b3\u30de\u30f3\u30c9\u3092\u30c7\u30fc\u30bf\u3068\u3057\u3066\u8868\u73fe\u3057\u3001\u30d0\u30c3\u30c1\u51e6\u7406\u3084 Undo \u6a5f\u80fd\u3092\u5b9f\u88c5\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/11-command-pattern/","title":"\u7b2c11\u7ae0: Command \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"clojure/11-command-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Command \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u30ab\u30d7\u30bb\u30eb\u5316\u3057\u3001\u7570\u306a\u308b\u30ea\u30af\u30a8\u30b9\u30c8\u3067\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u30d1\u30e9\u30e1\u30fc\u30bf\u5316\u3057\u305f\u308a\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u30ad\u30e5\u30fc\u306b\u5165\u308c\u305f\u308a\u3001\u64cd\u4f5c\u306e\u5c65\u6b74\u3092\u8a18\u9332\u3057\u305f\u308a\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u30c6\u30ad\u30b9\u30c8\u7de8\u96c6\u3068\u30ad\u30e3\u30f3\u30d0\u30b9\u64cd\u4f5c\u306e\u4f8b\u3092\u901a\u3058\u3066\u3001\u30b3\u30de\u30f3\u30c9\u306e\u30c7\u30fc\u30bf\u5316\u3001Undo/Redo \u6a5f\u80fd\u3001\u30d0\u30c3\u30c1\u51e6\u7406\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/11-command-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Command \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Command: \u30b3\u30de\u30f3\u30c9\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\uff08execute \u30e1\u30bd\u30c3\u30c9\uff09</li> <li>ConcreteCommand: \u5177\u4f53\u7684\u306a\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u88c5</li> <li>Receiver: \u30b3\u30de\u30f3\u30c9\u3092\u53d7\u3051\u53d6\u308a\u3001\u5b9f\u969b\u306e\u51e6\u7406\u3092\u884c\u3046\u30aa\u30d6\u30b8\u30a7\u30af\u30c8</li> <li>Invoker: \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8</li> </ul> <p></p>"},{"location":"clojure/11-command-pattern/#2-command","title":"2. Command \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9","text":""},{"location":"clojure/11-command-pattern/#_2","title":"\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u5b9a\u7fa9","text":"<pre><code>(ns command-pattern.command)\n\n(defmulti execute\n  \"\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\"\n  :type)\n\n(defmulti undo\n  \"\u30b3\u30de\u30f3\u30c9\u3092\u53d6\u308a\u6d88\u3059\"\n  :type)\n</code></pre>"},{"location":"clojure/11-command-pattern/#3","title":"3. \u30c6\u30ad\u30b9\u30c8\u64cd\u4f5c\u30b3\u30de\u30f3\u30c9","text":""},{"location":"clojure/11-command-pattern/#insertcommand","title":"InsertCommand: \u30c6\u30ad\u30b9\u30c8\u633f\u5165","text":"<pre><code>(ns command-pattern.text-commands\n  (:require [command-pattern.command :as cmd]))\n\n(defn make-insert-command\n  \"\u633f\u5165\u30b3\u30de\u30f3\u30c9\u3092\u4f5c\u6210\"\n  [position text]\n  {:type :insert-command\n   :position position\n   :text text})\n\n(defmethod cmd/execute :insert-command [command]\n  (fn [document]\n    (let [pos (:position command)\n          text (:text command)\n          before (subs document 0 pos)\n          after (subs document pos)]\n      (str before text after))))\n\n(defmethod cmd/undo :insert-command [command]\n  (fn [document]\n    (let [pos (:position command)\n          len (count (:text command))\n          before (subs document 0 pos)\n          after (subs document (+ pos len))]\n      (str before after))))\n</code></pre>"},{"location":"clojure/11-command-pattern/#deletecommand","title":"DeleteCommand: \u30c6\u30ad\u30b9\u30c8\u524a\u9664","text":"<pre><code>(defn make-delete-command\n  \"\u524a\u9664\u30b3\u30de\u30f3\u30c9\u3092\u4f5c\u6210\"\n  [start-position end-position deleted-text]\n  {:type :delete-command\n   :start-position start-position\n   :end-position end-position\n   :deleted-text deleted-text})\n\n(defmethod cmd/execute :delete-command [command]\n  (fn [document]\n    (let [start (:start-position command)\n          end (:end-position command)\n          before (subs document 0 start)\n          after (subs document end)]\n      (str before after))))\n\n(defmethod cmd/undo :delete-command [command]\n  (fn [document]\n    (let [start (:start-position command)\n          text (:deleted-text command)\n          before (subs document 0 start)\n          after (subs document start)]\n      (str before text after))))\n</code></pre>"},{"location":"clojure/11-command-pattern/#replacecommand","title":"ReplaceCommand: \u30c6\u30ad\u30b9\u30c8\u7f6e\u63db","text":"<pre><code>(defn make-replace-command\n  \"\u7f6e\u63db\u30b3\u30de\u30f3\u30c9\u3092\u4f5c\u6210\"\n  [start-position old-text new-text]\n  {:type :replace-command\n   :start-position start-position\n   :old-text old-text\n   :new-text new-text})\n\n(defmethod cmd/execute :replace-command [command]\n  (fn [document]\n    (let [start (:start-position command)\n          old-len (count (:old-text command))\n          new-text (:new-text command)\n          before (subs document 0 start)\n          after (subs document (+ start old-len))]\n      (str before new-text after))))\n\n(defmethod cmd/undo :replace-command [command]\n  (fn [document]\n    (let [start (:start-position command)\n          new-len (count (:new-text command))\n          old-text (:old-text command)\n          before (subs document 0 start)\n          after (subs document (+ start new-len))]\n      (str before old-text after))))\n</code></pre>"},{"location":"clojure/11-command-pattern/#_3","title":"\u30af\u30e9\u30b9\u56f3","text":""},{"location":"clojure/11-command-pattern/#_4","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>(require '[command-pattern.command :as cmd])\n(require '[command-pattern.text-commands :as tc])\n\n;; \u633f\u5165\u30b3\u30de\u30f3\u30c9\n(def insert-cmd (tc/make-insert-command 5 \" World\"))\n(def execute-fn (cmd/execute insert-cmd))\n(execute-fn \"Hello\")\n;; =&gt; \"Hello World\"\n\n;; Undo\n(def undo-fn (cmd/undo insert-cmd))\n(undo-fn \"Hello World\")\n;; =&gt; \"Hello\"\n</code></pre>"},{"location":"clojure/11-command-pattern/#4","title":"4. \u30ad\u30e3\u30f3\u30d0\u30b9\u64cd\u4f5c\u30b3\u30de\u30f3\u30c9","text":""},{"location":"clojure/11-command-pattern/#addshapecommand","title":"AddShapeCommand: \u56f3\u5f62\u8ffd\u52a0","text":"<pre><code>(ns command-pattern.canvas-commands\n  (:require [command-pattern.command :as cmd]))\n\n(defn make-add-shape-command\n  \"\u56f3\u5f62\u8ffd\u52a0\u30b3\u30de\u30f3\u30c9\u3092\u4f5c\u6210\"\n  [shape]\n  {:type :add-shape-command\n   :shape shape})\n\n(defmethod cmd/execute :add-shape-command [command]\n  (fn [canvas]\n    (update canvas :shapes conj (:shape command))))\n\n(defmethod cmd/undo :add-shape-command [command]\n  (fn [canvas]\n    (update canvas :shapes\n            (fn [shapes]\n              (filterv #(not= (:id %) (get-in command [:shape :id])) shapes)))))\n</code></pre>"},{"location":"clojure/11-command-pattern/#moveshapecommand","title":"MoveShapeCommand: \u56f3\u5f62\u79fb\u52d5","text":"<pre><code>(defn make-move-shape-command\n  \"\u56f3\u5f62\u79fb\u52d5\u30b3\u30de\u30f3\u30c9\u3092\u4f5c\u6210\"\n  [shape-id dx dy]\n  {:type :move-shape-command\n   :shape-id shape-id\n   :dx dx\n   :dy dy})\n\n(defmethod cmd/execute :move-shape-command [command]\n  (fn [canvas]\n    (update canvas :shapes\n            (fn [shapes]\n              (mapv (fn [shape]\n                      (if (= (:id shape) (:shape-id command))\n                        (-&gt; shape\n                            (update :x + (:dx command))\n                            (update :y + (:dy command)))\n                        shape))\n                    shapes)))))\n\n(defmethod cmd/undo :move-shape-command [command]\n  (fn [canvas]\n    (update canvas :shapes\n            (fn [shapes]\n              (mapv (fn [shape]\n                      (if (= (:id shape) (:shape-id command))\n                        (-&gt; shape\n                            (update :x - (:dx command))\n                            (update :y - (:dy command)))\n                        shape))\n                    shapes)))))\n</code></pre>"},{"location":"clojure/11-command-pattern/#5","title":"5. \u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u5668","text":""},{"location":"clojure/11-command-pattern/#commandexecutor","title":"CommandExecutor \u306e\u5b9f\u88c5","text":"<pre><code>(ns command-pattern.command-executor\n  (:require [command-pattern.command :as cmd]))\n\n(defn make-executor\n  \"\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u5668\u3092\u4f5c\u6210\"\n  [initial-state]\n  {:state initial-state\n   :undo-stack []\n   :redo-stack []})\n\n(defn execute-command\n  \"\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3001\u5c65\u6b74\u306b\u8ffd\u52a0\"\n  [executor command]\n  (let [state (:state executor)\n        execute-fn (cmd/execute command)\n        new-state (execute-fn state)]\n    (-&gt; executor\n        (assoc :state new-state)\n        (update :undo-stack conj command)\n        (assoc :redo-stack []))))\n\n(defn undo-command\n  \"\u6700\u5f8c\u306e\u30b3\u30de\u30f3\u30c9\u3092\u53d6\u308a\u6d88\u3059\"\n  [executor]\n  (if (seq (:undo-stack executor))\n    (let [command (peek (:undo-stack executor))\n          state (:state executor)\n          undo-fn (cmd/undo command)\n          new-state (undo-fn state)]\n      (-&gt; executor\n          (assoc :state new-state)\n          (update :undo-stack pop)\n          (update :redo-stack conj command)))\n    executor))\n\n(defn redo-command\n  \"\u6700\u5f8c\u306b\u53d6\u308a\u6d88\u3057\u305f\u30b3\u30de\u30f3\u30c9\u3092\u518d\u5b9f\u884c\"\n  [executor]\n  (if (seq (:redo-stack executor))\n    (let [command (peek (:redo-stack executor))\n          state (:state executor)\n          execute-fn (cmd/execute command)\n          new-state (execute-fn state)]\n      (-&gt; executor\n          (assoc :state new-state)\n          (update :redo-stack pop)\n          (update :undo-stack conj command)))\n    executor))\n</code></pre>"},{"location":"clojure/11-command-pattern/#_5","title":"\u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"clojure/11-command-pattern/#_6","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>(require '[command-pattern.command-executor :as exec])\n(require '[command-pattern.text-commands :as tc])\n\n;; \u5b9f\u884c\u5668\u3092\u4f5c\u6210\n(def executor (exec/make-executor \"Hello\"))\n\n;; \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\n(def executor (exec/execute-command executor (tc/make-insert-command 5 \" World\")))\n(exec/get-state executor)\n;; =&gt; \"Hello World\"\n\n;; Undo\n(def executor (exec/undo-command executor))\n(exec/get-state executor)\n;; =&gt; \"Hello\"\n\n;; Redo\n(def executor (exec/redo-command executor))\n(exec/get-state executor)\n;; =&gt; \"Hello World\"\n</code></pre>"},{"location":"clojure/11-command-pattern/#6","title":"6. \u30d0\u30c3\u30c1\u51e6\u7406\u3068\u30de\u30af\u30ed\u30b3\u30de\u30f3\u30c9","text":""},{"location":"clojure/11-command-pattern/#_7","title":"\u30d0\u30c3\u30c1\u51e6\u7406","text":"<pre><code>(defn execute-batch\n  \"\u8907\u6570\u306e\u30b3\u30de\u30f3\u30c9\u3092\u307e\u3068\u3081\u3066\u5b9f\u884c\"\n  [executor commands]\n  (reduce execute-command executor commands))\n\n(defn undo-all\n  \"\u3059\u3079\u3066\u306e\u30b3\u30de\u30f3\u30c9\u3092\u53d6\u308a\u6d88\u3059\"\n  [executor]\n  (if (can-undo? executor)\n    (recur (undo-command executor))\n    executor))\n</code></pre>"},{"location":"clojure/11-command-pattern/#macrocommand","title":"MacroCommand","text":"<pre><code>(defn make-macro-command\n  \"\u8907\u5408\u30b3\u30de\u30f3\u30c9\u3092\u4f5c\u6210\"\n  [commands]\n  {:type :macro-command\n   :commands commands})\n\n(defmethod cmd/execute :macro-command [macro]\n  (fn [state]\n    (reduce (fn [s command]\n              ((cmd/execute command) s))\n            state\n            (:commands macro))))\n\n(defmethod cmd/undo :macro-command [macro]\n  (fn [state]\n    (reduce (fn [s command]\n              ((cmd/undo command) s))\n            state\n            (reverse (:commands macro)))))\n</code></pre>"},{"location":"clojure/11-command-pattern/#macrocommand_1","title":"MacroCommand \u306e\u56f3","text":""},{"location":"clojure/11-command-pattern/#_8","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>;; MacroCommand \u3092\u4f7f\u3063\u305f\u8907\u5408\u64cd\u4f5c\n(def commands [(tc/make-insert-command 5 \" World\")\n               (tc/make-insert-command 11 \"!\")])\n(def macro (exec/make-macro-command commands))\n\n(def executor (exec/execute-command (exec/make-executor \"Hello\") macro))\n(exec/get-state executor)\n;; =&gt; \"Hello World!\"\n\n;; \u4e00\u5ea6\u306eUndo\u3067\u5168\u4f53\u3092\u53d6\u308a\u6d88\u3059\n(def executor (exec/undo-command executor))\n(exec/get-state executor)\n;; =&gt; \"Hello\"\n</code></pre>"},{"location":"clojure/11-command-pattern/#7","title":"7. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u64cd\u4f5c\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u5316: \u64cd\u4f5c\u3092\u30c7\u30fc\u30bf\u3068\u3057\u3066\u8868\u73fe\u3067\u304d\u308b</li> <li>Undo/Redo: \u64cd\u4f5c\u5c65\u6b74\u306e\u7ba1\u7406\u304c\u5bb9\u6613</li> <li>\u30d0\u30c3\u30c1\u51e6\u7406: \u8907\u6570\u306e\u64cd\u4f5c\u3092\u307e\u3068\u3081\u3066\u51e6\u7406</li> <li>\u9045\u5ef6\u5b9f\u884c: \u30b3\u30de\u30f3\u30c9\u3092\u30ad\u30e5\u30fc\u306b\u5165\u308c\u3066\u5f8c\u3067\u5b9f\u884c</li> <li>\u30ed\u30b0\u8a18\u9332: \u64cd\u4f5c\u306e\u5c65\u6b74\u3092\u30ed\u30b0\u3068\u3057\u3066\u4fdd\u5b58</li> </ol>"},{"location":"clojure/11-command-pattern/#8","title":"8. \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306e\u7279\u5fb4","text":"<p>Clojure \u3067\u306e Command \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u306b\u306f\u4ee5\u4e0b\u306e\u7279\u5fb4\u304c\u3042\u308a\u307e\u3059\uff1a</p> <ol> <li>\u30b3\u30de\u30f3\u30c9\u306f\u30c7\u30fc\u30bf: \u30b3\u30de\u30f3\u30c9\u306f\u5358\u306a\u308b\u30de\u30c3\u30d7\u3068\u3057\u3066\u8868\u73fe</li> <li>\u7d14\u7c8b\u95a2\u6570: execute/undo \u306f\u72b6\u614b\u5909\u66f4\u95a2\u6570\u3092\u8fd4\u3059\u7d14\u7c8b\u95a2\u6570</li> <li>\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb: \u72b6\u614b\u306f\u5909\u66f4\u3055\u308c\u305a\u3001\u65b0\u3057\u3044\u72b6\u614b\u304c\u8fd4\u3055\u308c\u308b</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: \u578b\u306b\u57fa\u3065\u3044\u305f\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u3067\u591a\u614b\u6027\u3092\u5b9f\u73fe</li> </ol>"},{"location":"clojure/11-command-pattern/#_9","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Command \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30b3\u30de\u30f3\u30c9\u306e\u30c7\u30fc\u30bf\u5316: \u64cd\u4f5c\u3092\u30de\u30c3\u30d7\u3068\u3057\u3066\u8868\u73fe</li> <li>Undo/Redo: \u30b3\u30de\u30f3\u30c9\u5c65\u6b74\u306b\u3088\u308b\u53d6\u308a\u6d88\u3057\u3068\u518d\u5b9f\u884c</li> <li>\u30d0\u30c3\u30c1\u51e6\u7406: \u8907\u6570\u30b3\u30de\u30f3\u30c9\u306e\u4e00\u62ec\u5b9f\u884c</li> <li>MacroCommand: \u8907\u5408\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u88c5</li> </ol> <p>Command \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u64cd\u4f5c\u306e\u5c65\u6b74\u7ba1\u7406\u3084\u53d6\u308a\u6d88\u3057\u6a5f\u80fd\u304c\u5fc5\u8981\u306a\u5834\u9762\u3067\u975e\u5e38\u306b\u6709\u52b9\u3067\u3059\u3002</p>"},{"location":"clojure/11-command-pattern/#_10","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part4/src/command_pattern/</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part4/spec/command_pattern/</code></li> </ul>"},{"location":"clojure/11-command-pattern/#_11","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Visitor \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u30c7\u30fc\u30bf\u69cb\u9020\u3068\u64cd\u4f5c\u3092\u5206\u96e2\u3057\u3001\u65b0\u3057\u3044\u64cd\u4f5c\u3092\u8ffd\u52a0\u3057\u3084\u3059\u304f\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/12-visitor-pattern/","title":"\u7b2c12\u7ae0: Visitor \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"clojure/12-visitor-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Visitor \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30c7\u30fc\u30bf\u69cb\u9020\u3068\u64cd\u4f5c\u3092\u5206\u96e2\u3057\u3001\u65e2\u5b58\u306e\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u5909\u66f4\u3059\u308b\u3053\u3068\u306a\u304f\u65b0\u3057\u3044\u64cd\u4f5c\u3092\u8ffd\u52a0\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u56f3\u5f62\uff08Shape\uff09\u306b\u5bfe\u3059\u308b\u69d8\u3005\u306a\u64cd\u4f5c\uff08JSON \u5909\u63db\u3001XML \u5909\u63db\u3001\u9762\u7a4d\u8a08\u7b97\u3001\u5468\u56f2\u9577\u8a08\u7b97\uff09\u3092\u901a\u3058\u3066\u3001\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b Visitor \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/12-visitor-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Visitor \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Visitor: \u64cd\u4f5c\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>ConcreteVisitor: \u5177\u4f53\u7684\u306a\u64cd\u4f5c\u306e\u5b9f\u88c5</li> <li>Element: \u8a2a\u554f\u3055\u308c\u308b\u8981\u7d20\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>ConcreteElement: \u5177\u4f53\u7684\u306a\u8981\u7d20</li> </ul> <p></p>"},{"location":"clojure/12-visitor-pattern/#2-element","title":"2. Element: \u56f3\u5f62\u306e\u5b9a\u7fa9","text":""},{"location":"clojure/12-visitor-pattern/#shape","title":"Shape \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9","text":"<pre><code>(ns visitor-pattern.shape)\n\n(defmulti translate\n  \"\u56f3\u5f62\u3092\u79fb\u52d5\u3059\u308b\"\n  (fn [shape _dx _dy] (::type shape)))\n\n(defmulti scale\n  \"\u56f3\u5f62\u3092\u62e1\u5927/\u7e2e\u5c0f\u3059\u308b\"\n  (fn [shape _factor] (::type shape)))\n</code></pre>"},{"location":"clojure/12-visitor-pattern/#circle","title":"Circle","text":"<pre><code>(ns visitor-pattern.circle\n  (:require [visitor-pattern.shape :as shape]))\n\n(defn make\n  \"\u5186\u3092\u4f5c\u6210\"\n  [center radius]\n  {::shape/type ::circle\n   ::center center\n   ::radius radius})\n\n(defmethod shape/translate ::circle [circle dx dy]\n  (let [[x y] (::center circle)]\n    (assoc circle ::center [(+ x dx) (+ y dy)])))\n\n(defmethod shape/scale ::circle [circle factor]\n  (let [radius (::radius circle)]\n    (assoc circle ::radius (* radius factor))))\n</code></pre>"},{"location":"clojure/12-visitor-pattern/#square","title":"Square","text":"<pre><code>(ns visitor-pattern.square\n  (:require [visitor-pattern.shape :as shape]))\n\n(defn make\n  \"\u6b63\u65b9\u5f62\u3092\u4f5c\u6210\"\n  [top-left side]\n  {::shape/type ::square\n   ::top-left top-left\n   ::side side})\n\n(defmethod shape/translate ::square [square dx dy]\n  (let [[x y] (::top-left square)]\n    (assoc square ::top-left [(+ x dx) (+ y dy)])))\n\n(defmethod shape/scale ::square [square factor]\n  (let [side (::side square)]\n    (assoc square ::side (* side factor))))\n</code></pre>"},{"location":"clojure/12-visitor-pattern/#rectangle","title":"Rectangle","text":"<pre><code>(ns visitor-pattern.rectangle\n  (:require [visitor-pattern.shape :as shape]))\n\n(defn make\n  \"\u9577\u65b9\u5f62\u3092\u4f5c\u6210\"\n  [top-left width height]\n  {::shape/type ::rectangle\n   ::top-left top-left\n   ::width width\n   ::height height})\n\n(defmethod shape/translate ::rectangle [rect dx dy]\n  (let [[x y] (::top-left rect)]\n    (assoc rect ::top-left [(+ x dx) (+ y dy)])))\n\n(defmethod shape/scale ::rectangle [rect factor]\n  (-&gt; rect\n      (update ::width * factor)\n      (update ::height * factor)))\n</code></pre>"},{"location":"clojure/12-visitor-pattern/#_2","title":"\u30af\u30e9\u30b9\u56f3","text":""},{"location":"clojure/12-visitor-pattern/#3-visitor-json","title":"3. Visitor: JSON \u5909\u63db","text":""},{"location":"clojure/12-visitor-pattern/#json-visitor","title":"JSON Visitor \u306e\u5b9f\u88c5","text":"<pre><code>(ns visitor-pattern.json-visitor\n  (:require [visitor-pattern.shape :as shape]\n            [visitor-pattern.circle :as circle]\n            [visitor-pattern.square :as square]\n            [visitor-pattern.rectangle :as rectangle]))\n\n(defmulti to-json\n  \"\u56f3\u5f62\u3092 JSON \u6587\u5b57\u5217\u306b\u5909\u63db\"\n  ::shape/type)\n\n(defmethod to-json ::circle/circle [circle]\n  (let [{:keys [::circle/center ::circle/radius]} circle\n        [x y] center]\n    (format \"{\\\"type\\\":\\\"circle\\\",\\\"center\\\":[%s,%s],\\\"radius\\\":%s}\"\n            x y radius)))\n\n(defmethod to-json ::square/square [square]\n  (let [{:keys [::square/top-left ::square/side]} square\n        [x y] top-left]\n    (format \"{\\\"type\\\":\\\"square\\\",\\\"topLeft\\\":[%s,%s],\\\"side\\\":%s}\"\n            x y side)))\n\n(defmethod to-json ::rectangle/rectangle [rect]\n  (let [{:keys [::rectangle/top-left ::rectangle/width ::rectangle/height]} rect\n        [x y] top-left]\n    (format \"{\\\"type\\\":\\\"rectangle\\\",\\\"topLeft\\\":[%s,%s],\\\"width\\\":%s,\\\"height\\\":%s}\"\n            x y width height)))\n</code></pre>"},{"location":"clojure/12-visitor-pattern/#_3","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>(require '[visitor-pattern.json-visitor :as json])\n(require '[visitor-pattern.circle :as circle])\n\n(def c (circle/make [10 20] 5))\n(json/to-json c)\n;; =&gt; \"{\\\"type\\\":\\\"circle\\\",\\\"center\\\":[10,20],\\\"radius\\\":5}\"\n</code></pre>"},{"location":"clojure/12-visitor-pattern/#4-visitor-xml","title":"4. Visitor: XML \u5909\u63db","text":""},{"location":"clojure/12-visitor-pattern/#xml-visitor","title":"XML Visitor \u306e\u5b9f\u88c5","text":"<pre><code>(ns visitor-pattern.xml-visitor\n  (:require [visitor-pattern.shape :as shape]\n            [visitor-pattern.circle :as circle]\n            [visitor-pattern.square :as square]\n            [visitor-pattern.rectangle :as rectangle]))\n\n(defmulti to-xml\n  \"\u56f3\u5f62\u3092 XML \u6587\u5b57\u5217\u306b\u5909\u63db\"\n  ::shape/type)\n\n(defmethod to-xml ::circle/circle [circle]\n  (let [{:keys [::circle/center ::circle/radius]} circle\n        [x y] center]\n    (format \"&lt;circle&gt;&lt;center x=\\\"%s\\\" y=\\\"%s\\\"/&gt;&lt;radius&gt;%s&lt;/radius&gt;&lt;/circle&gt;\"\n            x y radius)))\n\n(defmethod to-xml ::square/square [square]\n  (let [{:keys [::square/top-left ::square/side]} square\n        [x y] top-left]\n    (format \"&lt;square&gt;&lt;topLeft x=\\\"%s\\\" y=\\\"%s\\\"/&gt;&lt;side&gt;%s&lt;/side&gt;&lt;/square&gt;\"\n            x y side)))\n\n(defmethod to-xml ::rectangle/rectangle [rect]\n  (let [{:keys [::rectangle/top-left ::rectangle/width ::rectangle/height]} rect\n        [x y] top-left]\n    (format \"&lt;rectangle&gt;&lt;topLeft x=\\\"%s\\\" y=\\\"%s\\\"/&gt;&lt;width&gt;%s&lt;/width&gt;&lt;height&gt;%s&lt;/height&gt;&lt;/rectangle&gt;\"\n            x y width height)))\n</code></pre>"},{"location":"clojure/12-visitor-pattern/#5-visitor","title":"5. Visitor: \u9762\u7a4d\u8a08\u7b97","text":""},{"location":"clojure/12-visitor-pattern/#area-visitor","title":"Area Visitor \u306e\u5b9f\u88c5","text":"<pre><code>(ns visitor-pattern.area-visitor\n  (:require [visitor-pattern.shape :as shape]\n            [visitor-pattern.circle :as circle]\n            [visitor-pattern.square :as square]\n            [visitor-pattern.rectangle :as rectangle]))\n\n(defmulti calculate-area\n  \"\u56f3\u5f62\u306e\u9762\u7a4d\u3092\u8a08\u7b97\"\n  ::shape/type)\n\n(defmethod calculate-area ::circle/circle [circle]\n  (let [radius (::circle/radius circle)]\n    (* Math/PI radius radius)))\n\n(defmethod calculate-area ::square/square [square]\n  (let [side (::square/side square)]\n    (* side side)))\n\n(defmethod calculate-area ::rectangle/rectangle [rect]\n  (let [width (::rectangle/width rect)\n        height (::rectangle/height rect)]\n    (* width height)))\n\n(defn total-area\n  \"\u8907\u6570\u306e\u56f3\u5f62\u306e\u5408\u8a08\u9762\u7a4d\u3092\u8a08\u7b97\"\n  [shapes]\n  (reduce + (map calculate-area shapes)))\n</code></pre>"},{"location":"clojure/12-visitor-pattern/#6-visitor","title":"6. Visitor: \u5468\u56f2\u9577\u8a08\u7b97","text":""},{"location":"clojure/12-visitor-pattern/#perimeter-visitor","title":"Perimeter Visitor \u306e\u5b9f\u88c5","text":"<pre><code>(ns visitor-pattern.perimeter-visitor\n  (:require [visitor-pattern.shape :as shape]\n            [visitor-pattern.circle :as circle]\n            [visitor-pattern.square :as square]\n            [visitor-pattern.rectangle :as rectangle]))\n\n(defmulti calculate-perimeter\n  \"\u56f3\u5f62\u306e\u5468\u56f2\u9577\u3092\u8a08\u7b97\"\n  ::shape/type)\n\n(defmethod calculate-perimeter ::circle/circle [circle]\n  (let [radius (::circle/radius circle)]\n    (* 2 Math/PI radius)))\n\n(defmethod calculate-perimeter ::square/square [square]\n  (let [side (::square/side square)]\n    (* 4 side)))\n\n(defmethod calculate-perimeter ::rectangle/rectangle [rect]\n  (let [width (::rectangle/width rect)\n        height (::rectangle/height rect)]\n    (* 2 (+ width height))))\n</code></pre>"},{"location":"clojure/12-visitor-pattern/#7-visitor","title":"7. Visitor \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":""},{"location":"clojure/12-visitor-pattern/#8","title":"8. \u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"clojure/12-visitor-pattern/#9-visitor","title":"9. \u65b0\u3057\u3044 Visitor \u306e\u8ffd\u52a0","text":"<p>Visitor \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9\u306f\u3001\u65b0\u3057\u3044\u64cd\u4f5c\u3092\u8ffd\u52a0\u3057\u3084\u3059\u3044\u3053\u3068\u3067\u3059\u3002</p>"},{"location":"clojure/12-visitor-pattern/#visitor","title":"\u4f8b: \u63cf\u753b Visitor","text":"<pre><code>(ns visitor-pattern.draw-visitor\n  (:require [visitor-pattern.shape :as shape]\n            [visitor-pattern.circle :as circle]\n            [visitor-pattern.square :as square]))\n\n(defmulti draw\n  \"\u56f3\u5f62\u3092\u63cf\u753b\u30b3\u30de\u30f3\u30c9\u306b\u5909\u63db\"\n  ::shape/type)\n\n(defmethod draw ::circle/circle [circle]\n  (let [{:keys [::circle/center ::circle/radius]} circle\n        [x y] center]\n    {:command :draw-circle\n     :center [x y]\n     :radius radius}))\n\n(defmethod draw ::square/square [square]\n  (let [{:keys [::square/top-left ::square/side]} square\n        [x y] top-left]\n    {:command :draw-rect\n     :position [x y]\n     :width side\n     :height side}))\n</code></pre>"},{"location":"clojure/12-visitor-pattern/#10","title":"10. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9\u3068\u6b20\u70b9","text":""},{"location":"clojure/12-visitor-pattern/#_4","title":"\u5229\u70b9","text":"<ol> <li>\u64cd\u4f5c\u306e\u8ffd\u52a0\u304c\u5bb9\u6613: \u65b0\u3057\u3044 Visitor \u3092\u8ffd\u52a0\u3059\u308b\u3060\u3051\u3067\u65b0\u3057\u3044\u64cd\u4f5c\u3092\u5b9f\u88c5\u53ef\u80fd</li> <li>\u95a2\u9023\u64cd\u4f5c\u306e\u96c6\u7d04: \u540c\u3058\u64cd\u4f5c\u306b\u95a2\u3059\u308b\u30b3\u30fc\u30c9\u304c\u4e00\u7b87\u6240\u306b\u307e\u3068\u307e\u308b</li> <li>\u8981\u7d20\u306e\u72ec\u7acb\u6027: \u8981\u7d20\u30af\u30e9\u30b9\u306b\u64cd\u4f5c\u306e\u30b3\u30fc\u30c9\u3092\u542b\u3081\u306a\u304f\u3066\u3088\u3044</li> </ol>"},{"location":"clojure/12-visitor-pattern/#_5","title":"\u6b20\u70b9","text":"<ol> <li>\u8981\u7d20\u306e\u8ffd\u52a0\u304c\u56f0\u96e3: \u65b0\u3057\u3044\u8981\u7d20\u30bf\u30a4\u30d7\u3092\u8ffd\u52a0\u3059\u308b\u3068\u3001\u3059\u3079\u3066\u306e Visitor \u3092\u66f4\u65b0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b</li> <li>\u30ab\u30d7\u30bb\u30eb\u5316\u306e\u7834\u58ca: Visitor \u306f\u8981\u7d20\u306e\u5185\u90e8\u72b6\u614b\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b</li> </ol>"},{"location":"clojure/12-visitor-pattern/#11","title":"11. \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306e\u7279\u5fb4","text":"<p>Clojure \u3067\u306e Visitor \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u306b\u306f\u4ee5\u4e0b\u306e\u7279\u5fb4\u304c\u3042\u308a\u307e\u3059\uff1a</p> <ol> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: \u578b\u306b\u57fa\u3065\u3044\u305f\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u3067\u591a\u614b\u6027\u3092\u5b9f\u73fe</li> <li>\u30aa\u30fc\u30d7\u30f3\u30b7\u30b9\u30c6\u30e0: \u65b0\u3057\u3044\u30e1\u30bd\u30c3\u30c9\u3092\u5f8c\u304b\u3089\u8ffd\u52a0\u53ef\u80fd</li> <li>\u30c7\u30fc\u30bf\u3068\u3057\u3066\u306e\u8981\u7d20: \u8981\u7d20\u306f\u5358\u306a\u308b\u30de\u30c3\u30d7\u3068\u3057\u3066\u8868\u73fe</li> <li>\u7d14\u7c8b\u95a2\u6570: Visitor \u306f\u526f\u4f5c\u7528\u306e\u306a\u3044\u7d14\u7c8b\u95a2\u6570\u3068\u3057\u3066\u5b9f\u88c5</li> </ol> <p></p>"},{"location":"clojure/12-visitor-pattern/#_6","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Visitor \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30c7\u30fc\u30bf\u69cb\u9020\u3068\u64cd\u4f5c\u306e\u5206\u96e2: \u56f3\u5f62\u30c7\u30fc\u30bf\u3068\u64cd\u4f5c\u3092\u72ec\u7acb\u3057\u3066\u5b9a\u7fa9</li> <li>\u8907\u6570\u306e Visitor: JSON\u3001XML\u3001\u9762\u7a4d\u3001\u5468\u56f2\u9577\u306e\u5404\u5909\u63db</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u5b9f\u88c5: \u578b\u306b\u57fa\u3065\u3044\u305f\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1</li> <li>\u62e1\u5f35\u6027: \u65b0\u3057\u3044\u64cd\u4f5c\u306e\u8ffd\u52a0\u304c\u5bb9\u6613</li> </ol> <p>Visitor \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30c7\u30fc\u30bf\u69cb\u9020\u304c\u5b89\u5b9a\u3057\u3066\u3044\u3066\u3001\u64cd\u4f5c\u3092\u983b\u7e41\u306b\u8ffd\u52a0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u5834\u9762\u3067\u6709\u52b9\u3067\u3059\u3002</p>"},{"location":"clojure/12-visitor-pattern/#_7","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part4/src/visitor_pattern/</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part4/spec/visitor_pattern/</code></li> </ul>"},{"location":"clojure/12-visitor-pattern/#4","title":"\u7b2c4\u90e8\u306e\u307e\u3068\u3081","text":"<p>\u7b2c4\u90e8\u3067\u306f\u3001\u632f\u308b\u821e\u3044\u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ul> <li>Strategy \u30d1\u30bf\u30fc\u30f3: \u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u30ab\u30d7\u30bb\u30eb\u5316\u3057\u4ea4\u63db\u53ef\u80fd\u306b\u3059\u308b</li> <li>Command \u30d1\u30bf\u30fc\u30f3: \u64cd\u4f5c\u3092\u30c7\u30fc\u30bf\u5316\u3057\u3001Undo/Redo \u3092\u5b9f\u73fe</li> <li>Visitor \u30d1\u30bf\u30fc\u30f3: \u30c7\u30fc\u30bf\u69cb\u9020\u3068\u64cd\u4f5c\u3092\u5206\u96e2\u3057\u3001\u65b0\u3057\u3044\u64cd\u4f5c\u3092\u8ffd\u52a0\u3057\u3084\u3059\u304f\u3059\u308b</li> </ul> <p>\u3053\u308c\u3089\u306e\u30d1\u30bf\u30fc\u30f3\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u7279\u6027\u3092\u6d3b\u304b\u3057\u3066\u7c21\u6f54\u306b\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"clojure/13-abstract-factory-pattern/","title":"\u7b2c13\u7ae0: Abstract Factory \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"clojure/13-abstract-factory-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u95a2\u9023\u3059\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30d5\u30a1\u30df\u30ea\u30fc\u3092\u3001\u305d\u306e\u5177\u4f53\u7684\u306a\u30af\u30e9\u30b9\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u306a\u304f\u751f\u6210\u3059\u308b\u305f\u3081\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u63d0\u4f9b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u56f3\u5f62\u30d5\u30a1\u30af\u30c8\u30ea\u3068 UI \u30d5\u30a1\u30af\u30c8\u30ea\u306e\u4f8b\u3092\u901a\u3058\u3066\u3001\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/13-abstract-factory-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>AbstractFactory: \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u751f\u6210\u306e\u62bd\u8c61\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>ConcreteFactory: \u5177\u4f53\u7684\u306a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u751f\u6210\u3059\u308b\u30d5\u30a1\u30af\u30c8\u30ea</li> <li>AbstractProduct: \u751f\u6210\u3055\u308c\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u62bd\u8c61\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>ConcreteProduct: \u5177\u4f53\u7684\u306a\u88fd\u54c1</li> </ul> <p></p>"},{"location":"clojure/13-abstract-factory-pattern/#2-shape","title":"2. Shape \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9","text":""},{"location":"clojure/13-abstract-factory-pattern/#_2","title":"\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u5b9a\u7fa9","text":"<pre><code>(ns abstract-factory.shape)\n\n(defmulti translate\n  \"\u56f3\u5f62\u3092\u79fb\u52d5\u3059\u308b\"\n  (fn [shape _dx _dy] (::type shape)))\n\n(defmulti scale\n  \"\u56f3\u5f62\u3092\u62e1\u5927/\u7e2e\u5c0f\u3059\u308b\"\n  (fn [shape _factor] (::type shape)))\n\n(defmulti to-string\n  \"\u56f3\u5f62\u3092\u6587\u5b57\u5217\u306b\u5909\u63db\u3059\u308b\"\n  (fn [shape] (::type shape)))\n</code></pre>"},{"location":"clojure/13-abstract-factory-pattern/#circle","title":"Circle \u306e\u5b9f\u88c5","text":"<pre><code>(ns abstract-factory.circle\n  (:require [abstract-factory.shape :as shape]))\n\n(defn make\n  \"\u5186\u3092\u4f5c\u6210\"\n  [center radius]\n  {::shape/type ::circle\n   ::center center\n   ::radius radius})\n\n(defmethod shape/translate ::circle [circle dx dy]\n  (let [[x y] (::center circle)]\n    (assoc circle ::center [(+ x dx) (+ y dy)])))\n\n(defmethod shape/scale ::circle [circle factor]\n  (let [radius (::radius circle)]\n    (assoc circle ::radius (* radius factor))))\n\n(defmethod shape/to-string ::circle [circle]\n  (let [[x y] (::center circle)\n        radius (::radius circle)]\n    (str \"Circle center: [\" x \", \" y \"] radius: \" radius)))\n</code></pre>"},{"location":"clojure/13-abstract-factory-pattern/#3-shapefactory","title":"3. ShapeFactory \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9","text":""},{"location":"clojure/13-abstract-factory-pattern/#abstract-factory","title":"Abstract Factory \u306e\u5b9a\u7fa9","text":"<pre><code>(ns abstract-factory.shape-factory)\n\n(defmulti make-shape\n  \"\u56f3\u5f62\u3092\u751f\u6210\u3059\u308b\"\n  (fn [factory _type &amp; _args] (::type factory)))\n</code></pre>"},{"location":"clojure/13-abstract-factory-pattern/#4-concretefactory-standardshapefactory","title":"4. ConcreteFactory: StandardShapeFactory","text":""},{"location":"clojure/13-abstract-factory-pattern/#_3","title":"\u5b9f\u88c5","text":"<pre><code>(ns abstract-factory.standard-shape-factory\n  (:require [abstract-factory.shape-factory :as factory]\n            [abstract-factory.circle :as circle]\n            [abstract-factory.square :as square]\n            [abstract-factory.rectangle :as rectangle]))\n\n(defn make\n  \"\u6a19\u6e96\u56f3\u5f62\u30d5\u30a1\u30af\u30c8\u30ea\u3092\u4f5c\u6210\"\n  []\n  {::factory/type ::standard-factory})\n\n(defmethod factory/make-shape ::standard-factory\n  [_factory type &amp; args]\n  (case type\n    :circle (apply circle/make args)\n    :square (apply square/make args)\n    :rectangle (apply rectangle/make args)\n    (throw (ex-info (str \"Unknown shape type: \" type) {:type type}))))\n</code></pre>"},{"location":"clojure/13-abstract-factory-pattern/#_4","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>(require '[abstract-factory.standard-shape-factory :as standard])\n(require '[abstract-factory.shape-factory :as factory])\n\n(def factory (standard/make))\n\n(def circle (factory/make-shape factory :circle [10 20] 5))\n;; =&gt; {:abstract-factory.shape/type :abstract-factory.circle/circle,\n;;     :abstract-factory.circle/center [10 20],\n;;     :abstract-factory.circle/radius 5}\n\n(def square (factory/make-shape factory :square [0 0] 10))\n;; =&gt; {:abstract-factory.shape/type :abstract-factory.square/square,\n;;     :abstract-factory.square/top-left [0 0],\n;;     :abstract-factory.square/side 10}\n</code></pre>"},{"location":"clojure/13-abstract-factory-pattern/#5-concretefactory-outlinedshapefactory","title":"5. ConcreteFactory: OutlinedShapeFactory","text":""},{"location":"clojure/13-abstract-factory-pattern/#_5","title":"\u5b9f\u88c5","text":"<pre><code>(ns abstract-factory.outlined-shape-factory\n  (:require [abstract-factory.shape-factory :as factory]\n            [abstract-factory.circle :as circle]\n            [abstract-factory.square :as square]\n            [abstract-factory.rectangle :as rectangle]))\n\n(defn make\n  \"\u8f2a\u90ed\u7dda\u4ed8\u304d\u56f3\u5f62\u30d5\u30a1\u30af\u30c8\u30ea\u3092\u4f5c\u6210\"\n  [outline-color outline-width]\n  {::factory/type ::outlined-factory\n   ::outline-color outline-color\n   ::outline-width outline-width})\n\n(defn- add-outline\n  \"\u56f3\u5f62\u306b\u8f2a\u90ed\u7dda\u60c5\u5831\u3092\u8ffd\u52a0\"\n  [shape outline-color outline-width]\n  (assoc shape\n         ::outline-color outline-color\n         ::outline-width outline-width))\n\n(defmethod factory/make-shape ::outlined-factory\n  [factory type &amp; args]\n  (let [outline-color (::outline-color factory)\n        outline-width (::outline-width factory)\n        base-shape (case type\n                     :circle (apply circle/make args)\n                     :square (apply square/make args)\n                     :rectangle (apply rectangle/make args))]\n    (add-outline base-shape outline-color outline-width)))\n</code></pre>"},{"location":"clojure/13-abstract-factory-pattern/#_6","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>(require '[abstract-factory.outlined-shape-factory :as outlined])\n\n(def factory (outlined/make \"black\" 2))\n\n(def circle (factory/make-shape factory :circle [10 20] 5))\n;; \u8f2a\u90ed\u7dda\u60c5\u5831\u304c\u8ffd\u52a0\u3055\u308c\u305f\u5186\u304c\u751f\u6210\u3055\u308c\u308b\n</code></pre>"},{"location":"clojure/13-abstract-factory-pattern/#6-concretefactory-filledshapefactory","title":"6. ConcreteFactory: FilledShapeFactory","text":""},{"location":"clojure/13-abstract-factory-pattern/#_7","title":"\u5b9f\u88c5","text":"<pre><code>(ns abstract-factory.filled-shape-factory\n  (:require [abstract-factory.shape-factory :as factory]\n            [abstract-factory.circle :as circle]\n            [abstract-factory.square :as square]\n            [abstract-factory.rectangle :as rectangle]))\n\n(defn make\n  \"\u5857\u308a\u3064\u3076\u3057\u4ed8\u304d\u56f3\u5f62\u30d5\u30a1\u30af\u30c8\u30ea\u3092\u4f5c\u6210\"\n  [fill-color]\n  {::factory/type ::filled-factory\n   ::fill-color fill-color})\n\n(defmethod factory/make-shape ::filled-factory\n  [factory type &amp; args]\n  (let [fill-color (::fill-color factory)\n        base-shape (case type\n                     :circle (apply circle/make args)\n                     :square (apply square/make args)\n                     :rectangle (apply rectangle/make args))]\n    (assoc base-shape ::fill-color fill-color)))\n</code></pre>"},{"location":"clojure/13-abstract-factory-pattern/#7","title":"7. \u30af\u30e9\u30b9\u56f3","text":""},{"location":"clojure/13-abstract-factory-pattern/#8-ui","title":"8. UI \u30d5\u30a1\u30af\u30c8\u30ea\u306e\u4f8b","text":""},{"location":"clojure/13-abstract-factory-pattern/#ui","title":"\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u5225 UI \u751f\u6210","text":"<pre><code>(ns abstract-factory.ui-factory)\n\n;; Abstract Factory \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\n(defmulti create-button\n  (fn [factory _label] (::factory-type factory)))\n\n(defmulti create-text-field\n  (fn [factory _placeholder] (::factory-type factory)))\n\n(defmulti create-checkbox\n  (fn [factory _label _checked?] (::factory-type factory)))\n\n;; WindowsUIFactory\n(defn make-windows-factory []\n  {::factory-type ::windows})\n\n(defmethod create-button ::windows [_factory label]\n  (make-button label :windows))\n\n;; MacOSUIFactory\n(defn make-macos-factory []\n  {::factory-type ::macos})\n\n(defmethod create-button ::macos [_factory label]\n  (make-button label :macos))\n</code></pre>"},{"location":"clojure/13-abstract-factory-pattern/#_8","title":"\u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"clojure/13-abstract-factory-pattern/#_9","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>(require '[abstract-factory.ui-factory :as ui])\n\n;; \u30d5\u30a1\u30af\u30c8\u30ea\u306e\u4ea4\u63db\u3067\u7570\u306a\u308bUI\u3092\u751f\u6210\n(defn create-form [factory]\n  {:button (ui/create-button factory \"Submit\")\n   :field (ui/create-text-field factory \"Email\")\n   :checkbox (ui/create-checkbox factory \"Subscribe\" false)})\n\n(def windows-form (create-form (ui/make-windows-factory)))\n(def macos-form (create-form (ui/make-macos-factory)))\n\n(ui/render (:button windows-form))\n;; =&gt; \"[Submit]\"\n\n(ui/render (:button macos-form))\n;; =&gt; \"(Submit)\"\n</code></pre>"},{"location":"clojure/13-abstract-factory-pattern/#9","title":"9. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u88fd\u54c1\u306e\u30d5\u30a1\u30df\u30ea\u30fc\u4e00\u8cab\u6027: \u95a2\u9023\u3059\u308b\u88fd\u54c1\u304c\u4e00\u8cab\u3057\u3066\u751f\u6210\u3055\u308c\u308b</li> <li>\u5177\u4f53\u30af\u30e9\u30b9\u306e\u5206\u96e2: \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306f\u5177\u4f53\u7684\u306a\u88fd\u54c1\u30af\u30e9\u30b9\u3092\u77e5\u3089\u306a\u3044</li> <li>\u88fd\u54c1\u30d5\u30a1\u30df\u30ea\u30fc\u306e\u4ea4\u63db: \u30d5\u30a1\u30af\u30c8\u30ea\u3092\u4ea4\u63db\u3059\u308b\u3060\u3051\u3067\u88fd\u54c1\u7fa4\u5168\u4f53\u3092\u5909\u66f4\u53ef\u80fd</li> <li>\u65b0\u3057\u3044\u88fd\u54c1\u30d5\u30a1\u30df\u30ea\u30fc\u306e\u8ffd\u52a0\u304c\u5bb9\u6613: \u65b0\u3057\u3044 ConcreteFactory \u3092\u8ffd\u52a0\u3059\u308b\u3060\u3051</li> </ol>"},{"location":"clojure/13-abstract-factory-pattern/#10","title":"10. \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306e\u7279\u5fb4","text":"<p>Clojure \u3067\u306e Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u306b\u306f\u4ee5\u4e0b\u306e\u7279\u5fb4\u304c\u3042\u308a\u307e\u3059\uff1a</p> <ol> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: \u30d5\u30a1\u30af\u30c8\u30ea\u306e\u578b\u306b\u57fa\u3065\u3044\u305f\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1</li> <li>\u30de\u30c3\u30d7\u30d9\u30fc\u30b9\u306e\u30d5\u30a1\u30af\u30c8\u30ea: \u30d5\u30a1\u30af\u30c8\u30ea\u306f\u8a2d\u5b9a\u3092\u542b\u3080\u30de\u30c3\u30d7\u3068\u3057\u3066\u8868\u73fe</li> <li>\u7d14\u7c8b\u95a2\u6570: \u30d5\u30a1\u30af\u30c8\u30ea\u30e1\u30bd\u30c3\u30c9\u306f\u526f\u4f5c\u7528\u306e\u306a\u3044\u7d14\u7c8b\u95a2\u6570</li> <li>\u30c7\u30fc\u30bf\u3068\u3057\u3066\u306e\u88fd\u54c1: \u88fd\u54c1\u306f\u5358\u306a\u308b\u30de\u30c3\u30d7\u30c7\u30fc\u30bf</li> </ol> <p></p>"},{"location":"clojure/13-abstract-factory-pattern/#_10","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30d5\u30a1\u30af\u30c8\u30ea\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9: \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u62bd\u8c61\u5316</li> <li>\u8907\u6570\u306e\u30d5\u30a1\u30af\u30c8\u30ea\u5b9f\u88c5: Standard\u3001Outlined\u3001Filled</li> <li>UI \u30d5\u30a1\u30af\u30c8\u30ea: \u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u5225\u306e UI \u751f\u6210</li> <li>\u30d5\u30a1\u30af\u30c8\u30ea\u306e\u4ea4\u63db: \u540c\u3058\u30b3\u30fc\u30c9\u3067\u7570\u306a\u308b\u88fd\u54c1\u7fa4\u3092\u751f\u6210</li> </ol> <p>Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u95a2\u9023\u3059\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30d5\u30a1\u30df\u30ea\u30fc\u3092\u4e00\u8cab\u3057\u3066\u751f\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u5834\u9762\u3067\u6709\u52b9\u3067\u3059\u3002</p>"},{"location":"clojure/13-abstract-factory-pattern/#_11","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part5/src/abstract_factory/</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part5/spec/abstract_factory/</code></li> </ul>"},{"location":"clojure/13-abstract-factory-pattern/#_12","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Abstract Server \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u4f9d\u5b58\u95a2\u4fc2\u306e\u9006\u8ee2\u3092\u5b9f\u73fe\u3057\u3001\u30e2\u30b8\u30e5\u30fc\u30eb\u9593\u306e\u758e\u7d50\u5408\u3092\u9054\u6210\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/14-abstract-server-pattern/","title":"\u7b2c14\u7ae0: Abstract Server \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"clojure/14-abstract-server-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Abstract Server \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u4f9d\u5b58\u95a2\u4fc2\u9006\u8ee2\u306e\u539f\u5247\uff08DIP\uff09\u3092\u5b9f\u73fe\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u9ad8\u30ec\u30d9\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u4f4e\u30ec\u30d9\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u8a73\u7d30\u306b\u4f9d\u5b58\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u4e21\u8005\u304c\u62bd\u8c61\u306b\u4f9d\u5b58\u3059\u308b\u3053\u3068\u3067\u758e\u7d50\u5408\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u30b9\u30a4\u30c3\u30c1\u3068\u30c7\u30d0\u30a4\u30b9\u3001\u30ea\u30dd\u30b8\u30c8\u30ea\u3068\u30b5\u30fc\u30d3\u30b9\u306e\u4f8b\u3092\u901a\u3058\u3066\u3001\u30d7\u30ed\u30c8\u30b3\u30eb\u306b\u3088\u308b Abstract Server \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/14-abstract-server-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Abstract Server \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Client: \u30b5\u30fc\u30d3\u30b9\u3092\u5229\u7528\u3059\u308b\u30e2\u30b8\u30e5\u30fc\u30eb</li> <li>Abstract Server: \u30b5\u30fc\u30d3\u30b9\u306e\u62bd\u8c61\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>Concrete Server: \u5177\u4f53\u7684\u306a\u30b5\u30fc\u30d3\u30b9\u306e\u5b9f\u88c5</li> </ul> <p></p>"},{"location":"clojure/14-abstract-server-pattern/#2-switchable","title":"2. Switchable \u30d7\u30ed\u30c8\u30b3\u30eb","text":""},{"location":"clojure/14-abstract-server-pattern/#abstract-server","title":"Abstract Server \u306e\u5b9a\u7fa9","text":"<pre><code>(ns abstract-server.switchable)\n\n(defprotocol Switchable\n  \"\u30b9\u30a4\u30c3\u30c1\u53ef\u80fd\u306a\u30c7\u30d0\u30a4\u30b9\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\"\n  (turn-on [this] \"\u30c7\u30d0\u30a4\u30b9\u3092\u30aa\u30f3\u306b\u3059\u308b\")\n  (turn-off [this] \"\u30c7\u30d0\u30a4\u30b9\u3092\u30aa\u30d5\u306b\u3059\u308b\")\n  (is-on? [this] \"\u30c7\u30d0\u30a4\u30b9\u304c\u30aa\u30f3\u304b\u3069\u3046\u304b\u3092\u78ba\u8a8d\u3059\u308b\"))\n</code></pre>"},{"location":"clojure/14-abstract-server-pattern/#3-concrete-server-light","title":"3. Concrete Server: Light","text":""},{"location":"clojure/14-abstract-server-pattern/#_2","title":"\u5b9f\u88c5","text":"<pre><code>(ns abstract-server.light\n  (:require [abstract-server.switchable :as switchable]))\n\n(defrecord Light [state]\n  switchable/Switchable\n  (turn-on [this]\n    (assoc this :state :on))\n  (turn-off [this]\n    (assoc this :state :off))\n  (is-on? [this]\n    (= (:state this) :on)))\n\n(defn make\n  \"\u7167\u660e\u3092\u4f5c\u6210\uff08\u521d\u671f\u72b6\u614b: \u30aa\u30d5\uff09\"\n  []\n  (-&gt;Light :off))\n\n(defn make-on\n  \"\u30aa\u30f3\u72b6\u614b\u306e\u7167\u660e\u3092\u4f5c\u6210\"\n  []\n  (-&gt;Light :on))\n</code></pre>"},{"location":"clojure/14-abstract-server-pattern/#4-concrete-server-fan","title":"4. Concrete Server: Fan","text":""},{"location":"clojure/14-abstract-server-pattern/#_3","title":"\u5b9f\u88c5","text":"<pre><code>(ns abstract-server.fan\n  (:require [abstract-server.switchable :as switchable]))\n\n(defrecord Fan [state speed]\n  switchable/Switchable\n  (turn-on [this]\n    (assoc this :state :on :speed (or speed :low)))\n  (turn-off [this]\n    (assoc this :state :off :speed nil))\n  (is-on? [this]\n    (= (:state this) :on)))\n\n(defn make []\n  (-&gt;Fan :off nil))\n\n(defn set-speed [fan speed]\n  (if (switchable/is-on? fan)\n    (assoc fan :speed speed)\n    fan))\n</code></pre>"},{"location":"clojure/14-abstract-server-pattern/#5-concrete-server-motor","title":"5. Concrete Server: Motor","text":""},{"location":"clojure/14-abstract-server-pattern/#_4","title":"\u5b9f\u88c5","text":"<pre><code>(ns abstract-server.motor\n  (:require [abstract-server.switchable :as switchable]))\n\n(defrecord Motor [state direction]\n  switchable/Switchable\n  (turn-on [this]\n    (assoc this :state :on :direction (or direction :forward)))\n  (turn-off [this]\n    (assoc this :state :off))\n  (is-on? [this]\n    (= (:state this) :on)))\n\n(defn make []\n  (-&gt;Motor :off nil))\n\n(defn reverse-direction [motor]\n  (if (switchable/is-on? motor)\n    (let [current (:direction motor)]\n      (assoc motor :direction (if (= current :forward) :reverse :forward)))\n    motor))\n</code></pre>"},{"location":"clojure/14-abstract-server-pattern/#6-client-switch","title":"6. Client: Switch","text":""},{"location":"clojure/14-abstract-server-pattern/#_5","title":"\u5b9f\u88c5","text":"<pre><code>(ns abstract-server.switch\n  (:require [abstract-server.switchable :as switchable]))\n\n(defn engage\n  \"\u30b9\u30a4\u30c3\u30c1\u3092\u5165\u308c\u308b\uff08\u30c7\u30d0\u30a4\u30b9\u3092\u30aa\u30f3\u306b\u3059\u308b\uff09\"\n  [device]\n  (switchable/turn-on device))\n\n(defn disengage\n  \"\u30b9\u30a4\u30c3\u30c1\u3092\u5207\u308b\uff08\u30c7\u30d0\u30a4\u30b9\u3092\u30aa\u30d5\u306b\u3059\u308b\uff09\"\n  [device]\n  (switchable/turn-off device))\n\n(defn toggle\n  \"\u30b9\u30a4\u30c3\u30c1\u3092\u5207\u308a\u66ff\u3048\u308b\"\n  [device]\n  (if (switchable/is-on? device)\n    (switchable/turn-off device)\n    (switchable/turn-on device)))\n\n(defn status\n  \"\u30c7\u30d0\u30a4\u30b9\u306e\u72b6\u614b\u3092\u53d6\u5f97\"\n  [device]\n  (if (switchable/is-on? device)\n    :on\n    :off))\n</code></pre>"},{"location":"clojure/14-abstract-server-pattern/#_6","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>(require '[abstract-server.switch :as sw])\n(require '[abstract-server.light :as light])\n(require '[abstract-server.fan :as fan])\n(require '[abstract-server.motor :as motor])\n\n;; \u540c\u3058Switch\u30b3\u30fc\u30c9\u3067\u7570\u306a\u308b\u30c7\u30d0\u30a4\u30b9\u3092\u64cd\u4f5c\n(def l (sw/engage (light/make)))\n(sw/status l) ;; =&gt; :on\n\n(def f (sw/engage (fan/make)))\n(sw/status f) ;; =&gt; :on\n\n(def m (sw/engage (motor/make)))\n(sw/status m) ;; =&gt; :on\n</code></pre>"},{"location":"clojure/14-abstract-server-pattern/#7","title":"7. \u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"clojure/14-abstract-server-pattern/#8-repository","title":"8. Repository \u306e\u4f8b","text":""},{"location":"clojure/14-abstract-server-pattern/#abstract-server-repository","title":"Abstract Server: Repository \u30d7\u30ed\u30c8\u30b3\u30eb","text":"<pre><code>(ns abstract-server.repository)\n\n(defprotocol Repository\n  \"\u30c7\u30fc\u30bf\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\"\n  (find-by-id [this id] \"ID\u3067\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u3092\u53d6\u5f97\")\n  (find-all [this] \"\u5168\u3066\u306e\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u3092\u53d6\u5f97\")\n  (save [this entity] \"\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u3092\u4fdd\u5b58\")\n  (delete [this id] \"\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u3092\u524a\u9664\"))\n</code></pre>"},{"location":"clojure/14-abstract-server-pattern/#concrete-server-memoryrepository","title":"Concrete Server: MemoryRepository","text":"<pre><code>(ns abstract-server.memory-repository\n  (:require [abstract-server.repository :as repo]))\n\n(defrecord MemoryRepository [data]\n  repo/Repository\n  (find-by-id [this id]\n    (get @(:data this) id))\n  (find-all [this]\n    (vals @(:data this)))\n  (save [this entity]\n    (let [id (or (:id entity) (str (java.util.UUID/randomUUID)))\n          entity-with-id (assoc entity :id id)]\n      (swap! (:data this) assoc id entity-with-id)\n      entity-with-id))\n  (delete [this id]\n    (let [entity (get @(:data this) id)]\n      (swap! (:data this) dissoc id)\n      entity)))\n\n(defn make []\n  (-&gt;MemoryRepository (atom {})))\n</code></pre>"},{"location":"clojure/14-abstract-server-pattern/#client-userservice","title":"Client: UserService","text":"<pre><code>(ns abstract-server.user-service\n  (:require [abstract-server.repository :as repo]))\n\n(defn create-user [repository name email]\n  (let [user {:name name\n              :email email\n              :created-at (java.util.Date.)}]\n    (repo/save repository user)))\n\n(defn get-user [repository id]\n  (repo/find-by-id repository id))\n\n(defn get-all-users [repository]\n  (repo/find-all repository))\n</code></pre>"},{"location":"clojure/14-abstract-server-pattern/#9","title":"9. \u4f9d\u5b58\u95a2\u4fc2\u306e\u56f3","text":""},{"location":"clojure/14-abstract-server-pattern/#10","title":"10. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u758e\u7d50\u5408: \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306f\u5177\u4f53\u7684\u306a\u5b9f\u88c5\u3092\u77e5\u3089\u306a\u3044</li> <li>\u30c6\u30b9\u30c8\u5bb9\u6613\u6027: \u30e2\u30c3\u30af/\u30b9\u30bf\u30d6\u3092\u7c21\u5358\u306b\u6ce8\u5165\u53ef\u80fd</li> <li>\u67d4\u8edf\u6027: \u5b9f\u88c5\u306e\u4ea4\u63db\u304c\u5bb9\u6613</li> <li>\u4f9d\u5b58\u95a2\u4fc2\u9006\u8ee2: \u9ad8\u30ec\u30d9\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u4f4e\u30ec\u30d9\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u4f9d\u5b58\u3057\u306a\u3044</li> </ol>"},{"location":"clojure/14-abstract-server-pattern/#11","title":"11. \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306e\u7279\u5fb4","text":"<p>Clojure \u3067\u306e Abstract Server \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u306b\u306f\u4ee5\u4e0b\u306e\u7279\u5fb4\u304c\u3042\u308a\u307e\u3059\uff1a</p> <ol> <li>\u30d7\u30ed\u30c8\u30b3\u30eb: \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u5b9a\u7fa9</li> <li>\u30ec\u30b3\u30fc\u30c9: \u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u5b9f\u88c5\u3059\u308b\u30c7\u30fc\u30bf\u578b</li> <li>\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb: \u72b6\u614b\u5909\u66f4\u306f\u65b0\u3057\u3044\u30ec\u30b3\u30fc\u30c9\u3092\u8fd4\u3059</li> <li>\u4f9d\u5b58\u6027\u6ce8\u5165: \u95a2\u6570\u306e\u5f15\u6570\u3068\u3057\u3066\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u6e21\u3059</li> </ol> <p></p>"},{"location":"clojure/14-abstract-server-pattern/#_7","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Abstract Server \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30d7\u30ed\u30c8\u30b3\u30eb\u306b\u3088\u308b\u62bd\u8c61\u5316: Switchable\u3001Repository</li> <li>\u30ec\u30b3\u30fc\u30c9\u306b\u3088\u308b\u5b9f\u88c5: Light\u3001Fan\u3001Motor\u3001MemoryRepository</li> <li>\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u72ec\u7acb\u6027: Switch\u3001UserService</li> <li>\u4f9d\u5b58\u95a2\u4fc2\u9006\u8ee2: \u9ad8\u30ec\u30d9\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u62bd\u8c61\u306b\u4f9d\u5b58</li> </ol> <p>Abstract Server \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30e2\u30b8\u30e5\u30fc\u30eb\u9593\u306e\u758e\u7d50\u5408\u3092\u5b9f\u73fe\u3057\u3001\u30c6\u30b9\u30c8\u5bb9\u6613\u6027\u3068\u67d4\u8edf\u6027\u3092\u5411\u4e0a\u3055\u305b\u307e\u3059\u3002</p>"},{"location":"clojure/14-abstract-server-pattern/#_8","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part5/src/abstract_server/</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part5/spec/abstract_server/</code></li> </ul>"},{"location":"clojure/14-abstract-server-pattern/#5","title":"\u7b2c5\u90e8\u306e\u307e\u3068\u3081","text":"<p>\u7b2c5\u90e8\u3067\u306f\u3001\u751f\u6210\u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ul> <li>Abstract Factory \u30d1\u30bf\u30fc\u30f3: \u95a2\u9023\u3059\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30d5\u30a1\u30df\u30ea\u30fc\u3092\u4e00\u8cab\u3057\u3066\u751f\u6210</li> <li>Abstract Server \u30d1\u30bf\u30fc\u30f3: \u4f9d\u5b58\u95a2\u4fc2\u9006\u8ee2\u306b\u3088\u308b\u758e\u7d50\u5408\u306e\u5b9f\u73fe</li> </ul> <p>\u3053\u308c\u3089\u306e\u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u72ec\u7acb\u6027\u3092\u9ad8\u3081\u3001\u30c6\u30b9\u30c8\u5bb9\u6613\u6027\u3068\u4fdd\u5b88\u6027\u3092\u5411\u4e0a\u3055\u305b\u307e\u3059\u3002</p>"},{"location":"clojure/15-gossiping-bus-drivers/","title":"\u7b2c15\u7ae0: \u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b","text":""},{"location":"clojure/15-gossiping-bus-drivers/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u300c\u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b\u300d\u3068\u3044\u3046\u554f\u984c\u3092\u901a\u3058\u3066\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u5b9f\u8df5\u7684\u306a\u30a2\u30d7\u30ed\u30fc\u30c1\u3092\u5b66\u3073\u307e\u3059\u3002\u3053\u306e\u554f\u984c\u306f\u3001\u30d0\u30b9\u904b\u8ee2\u624b\u304c\u505c\u7559\u6240\u3067\u51fa\u4f1a\u3063\u305f\u3068\u304d\u306b\u5642\u3092\u5171\u6709\u3059\u308b\u3068\u3044\u3046\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3067\u3059\u3002</p> <p>\u3053\u306e\u554f\u984c\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u306e\u6982\u5ff5\u3092\u5b66\u3073\u307e\u3059\uff1a</p> <ul> <li>\u7121\u9650\u30b7\u30fc\u30b1\u30f3\u30b9\uff08<code>cycle</code>\uff09\u306b\u3088\u308b\u5faa\u74b0\u30c7\u30fc\u30bf\u306e\u8868\u73fe</li> <li>\u96c6\u5408\u6f14\u7b97\u306b\u3088\u308b\u72b6\u614b\u306e\u4f1d\u64ad</li> <li>\u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u8a2d\u8a08</li> </ul>"},{"location":"clojure/15-gossiping-bus-drivers/#1","title":"1. \u554f\u984c\u306e\u8aac\u660e","text":"<p>\u8907\u6570\u306e\u30d0\u30b9\u904b\u8ee2\u624b\u304c\u305d\u308c\u305e\u308c\u306e\u30eb\u30fc\u30c8\u3092\u5de1\u56de\u3057\u3066\u3044\u307e\u3059\u3002\u5404\u904b\u8ee2\u624b\u306f\u6700\u521d\u306b1\u3064\u4ee5\u4e0a\u306e\u5642\u3092\u77e5\u3063\u3066\u3044\u307e\u3059\u3002\u540c\u3058\u505c\u7559\u6240\u306b\u8907\u6570\u306e\u904b\u8ee2\u624b\u304c\u3044\u308b\u3068\u3001\u5f7c\u3089\u306f\u77e5\u3063\u3066\u3044\u308b\u5642\u3092\u3059\u3079\u3066\u5171\u6709\u3057\u307e\u3059\u3002</p> <p>\u30b4\u30fc\u30eb: \u5168\u3066\u306e\u904b\u8ee2\u624b\u304c\u5168\u3066\u306e\u5642\u3092\u77e5\u308b\u307e\u3067\u306b\u4f55\u5206\u304b\u304b\u308b\u304b\uff1f</p> <p></p>"},{"location":"clojure/15-gossiping-bus-drivers/#2","title":"2. \u30c7\u30fc\u30bf\u30e2\u30c7\u30eb","text":""},{"location":"clojure/15-gossiping-bus-drivers/#_2","title":"\u30c9\u30e9\u30a4\u30d0\u30fc\u306e\u8868\u73fe","text":"<pre><code>(defn make-driver\n  \"\u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u4f5c\u6210\u3059\u308b\n   name - \u30c9\u30e9\u30a4\u30d0\u30fc\u306e\u540d\u524d\n   route - \u505c\u7559\u6240\u306e\u30b7\u30fc\u30b1\u30f3\u30b9\n   rumors - \u77e5\u3063\u3066\u3044\u308b\u5642\u306e\u96c6\u5408\"\n  [name route rumors]\n  {:name name\n   :route (cycle route)  ; \u7121\u9650\u30b7\u30fc\u30b1\u30f3\u30b9\u3067\u5faa\u74b0\u30eb\u30fc\u30c8\n   :rumors rumors})\n</code></pre> <p>\u30dd\u30a4\u30f3\u30c8: - <code>cycle</code> \u95a2\u6570\u3067\u6709\u9650\u306e\u30eb\u30fc\u30c8\u3092\u7121\u9650\u306e\u5faa\u74b0\u30b7\u30fc\u30b1\u30f3\u30b9\u306b\u5909\u63db - \u5642\u306f\u96c6\u5408\uff08set\uff09\u3068\u3057\u3066\u7ba1\u7406</p>"},{"location":"clojure/15-gossiping-bus-drivers/#_3","title":"\u7121\u9650\u30b7\u30fc\u30b1\u30f3\u30b9\u306e\u6d3b\u7528","text":"<pre><code>;; \u30eb\u30fc\u30c8 [1 2 3] \u306f\u7121\u9650\u306b\u7e70\u308a\u8fd4\u3055\u308c\u308b\n(take 10 (cycle [1 2 3]))\n;; =&gt; (1 2 3 1 2 3 1 2 3 1)\n</code></pre>"},{"location":"clojure/15-gossiping-bus-drivers/#3","title":"3. \u79fb\u52d5\u3068\u5642\u306e\u4f1d\u64ad","text":""},{"location":"clojure/15-gossiping-bus-drivers/#_4","title":"\u30c9\u30e9\u30a4\u30d0\u30fc\u306e\u79fb\u52d5","text":"<pre><code>(defn current-stop\n  \"\u30c9\u30e9\u30a4\u30d0\u30fc\u306e\u73fe\u5728\u306e\u505c\u7559\u6240\u3092\u53d6\u5f97\"\n  [driver]\n  (first (:route driver)))\n\n(defn move-driver\n  \"\u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u6b21\u306e\u505c\u7559\u6240\u306b\u79fb\u52d5\"\n  [driver]\n  (update driver :route rest))\n\n(defn move-drivers\n  \"\u5168\u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u6b21\u306e\u505c\u7559\u6240\u306b\u79fb\u52d5\"\n  [world]\n  (map move-driver world))\n</code></pre>"},{"location":"clojure/15-gossiping-bus-drivers/#_5","title":"\u505c\u7559\u6240\u3054\u3068\u306e\u30c9\u30e9\u30a4\u30d0\u30fc\u96c6\u8a08","text":"<pre><code>(defn get-stops\n  \"\u5404\u505c\u7559\u6240\u306b\u3044\u308b\u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u30de\u30c3\u30d7\u3068\u3057\u3066\u53d6\u5f97\n   {\u505c\u7559\u6240\u756a\u53f7 =&gt; [\u30c9\u30e9\u30a4\u30d0\u30fc1, \u30c9\u30e9\u30a4\u30d0\u30fc2, ...]}\"\n  [world]\n  (loop [world world\n         stops {}]\n    (if (empty? world)\n      stops\n      (let [driver (first world)\n            stop (current-stop driver)\n            stops (update stops stop conj driver)]\n        (recur (rest world) stops)))))\n</code></pre>"},{"location":"clojure/15-gossiping-bus-drivers/#_6","title":"\u5642\u306e\u5171\u6709","text":"<pre><code>(defn merge-rumors\n  \"\u540c\u3058\u505c\u7559\u6240\u306b\u3044\u308b\u30c9\u30e9\u30a4\u30d0\u30fc\u9593\u3067\u5642\u3092\u5171\u6709\n   \u5168\u54e1\u306e\u5642\u3092\u7d71\u5408\u3057\u3001\u5404\u30c9\u30e9\u30a4\u30d0\u30fc\u306b\u8a2d\u5b9a\"\n  [drivers]\n  (let [rumors (map :rumors drivers)\n        all-rumors (apply set/union rumors)]\n    (map #(assoc % :rumors all-rumors) drivers)))\n\n(defn spread-rumors\n  \"\u5168\u505c\u7559\u6240\u3067\u5642\u3092\u4f1d\u64ad\"\n  [world]\n  (let [stops-with-drivers (get-stops world)\n        drivers-by-stop (vals stops-with-drivers)]\n    (flatten (map merge-rumors drivers-by-stop))))\n</code></pre>"},{"location":"clojure/15-gossiping-bus-drivers/#4","title":"4. \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3","text":""},{"location":"clojure/15-gossiping-bus-drivers/#1_1","title":"1\u30b9\u30c6\u30c3\u30d7\u306e\u51e6\u7406","text":"<pre><code>(defn drive\n  \"1\u30b9\u30c6\u30c3\u30d7\u5206\u306e\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\n   1. \u5168\u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u79fb\u52d5\n   2. \u540c\u3058\u505c\u7559\u6240\u306b\u3044\u308b\u30c9\u30e9\u30a4\u30d0\u30fc\u9593\u3067\u5642\u3092\u5171\u6709\"\n  [world]\n  (-&gt; world\n      move-drivers\n      spread-rumors))\n</code></pre>"},{"location":"clojure/15-gossiping-bus-drivers/#_7","title":"\u5b8c\u4e86\u5224\u5b9a","text":"<pre><code>(defn all-rumors-shared?\n  \"\u5168\u30c9\u30e9\u30a4\u30d0\u30fc\u304c\u540c\u3058\u5642\u3092\u6301\u3063\u3066\u3044\u308b\u304b\u78ba\u8a8d\"\n  [world]\n  (apply = (map :rumors world)))\n\n(defn drive-till-all-rumors-spread\n  \"\u5168\u3066\u306e\u5642\u304c\u5171\u6709\u3055\u308c\u308b\u307e\u3067\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\n   480\u5206\uff088\u6642\u9593\uff09\u4ee5\u5185\u306b\u5171\u6709\u3055\u308c\u306a\u3051\u308c\u3070 :never \u3092\u8fd4\u3059\"\n  [world]\n  (loop [world (drive world)\n         time 1]\n    (cond\n      (&gt; time 480) :never\n      (all-rumors-shared? world) time\n      :else (recur (drive world) (inc time)))))\n</code></pre>"},{"location":"clojure/15-gossiping-bus-drivers/#5","title":"5. \u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"clojure/15-gossiping-bus-drivers/#6","title":"6. \u4f7f\u7528\u4f8b","text":"<pre><code>(require '[gossiping-bus-drivers.core :as gbd])\n\n;; 3\u4eba\u306e\u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u4f5c\u6210\n(def world\n  [(gbd/make-driver \"D1\" [3 1 2 3] #{:rumor-a})\n   (gbd/make-driver \"D2\" [3 2 3 1] #{:rumor-b})\n   (gbd/make-driver \"D3\" [4 2 3 4 5] #{:rumor-c})])\n\n;; \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u5b9f\u884c\n(gbd/drive-till-all-rumors-spread world)\n;; =&gt; 5 (5\u5206\u3067\u5168\u5642\u304c\u5171\u6709\u3055\u308c\u308b)\n\n;; \u7d76\u5bfe\u306b\u51fa\u4f1a\u308f\u306a\u3044\u30eb\u30fc\u30c8\u306e\u5834\u5408\n(def never-meet\n  [(gbd/make-driver \"D1\" [1] #{:rumor-a})\n   (gbd/make-driver \"D2\" [2] #{:rumor-b})])\n\n(gbd/drive-till-all-rumors-spread never-meet)\n;; =&gt; :never\n</code></pre>"},{"location":"clojure/15-gossiping-bus-drivers/#7","title":"7. \u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1\u306e\u7279\u5fb4","text":""},{"location":"clojure/15-gossiping-bus-drivers/#_8","title":"\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020","text":"<p>\u3059\u3079\u3066\u306e\u72b6\u614b\u5909\u66f4\u306f\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u8fd4\u3057\u307e\u3059\u3002\u5143\u306e\u30c7\u30fc\u30bf\u306f\u5909\u66f4\u3055\u308c\u307e\u305b\u3093\u3002</p> <pre><code>;; \u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u79fb\u52d5\u3057\u3066\u3082\u5143\u306e\u30c9\u30e9\u30a4\u30d0\u30fc\u306f\u5909\u66f4\u3055\u308c\u306a\u3044\n(def original (gbd/make-driver \"Test\" [1 2 3] #{:a}))\n(def moved (gbd/move-driver original))\n\n(gbd/current-stop original) ;; =&gt; 1 (\u5909\u66f4\u306a\u3057)\n(gbd/current-stop moved)    ;; =&gt; 2\n</code></pre>"},{"location":"clojure/15-gossiping-bus-drivers/#_9","title":"\u9045\u5ef6\u8a55\u4fa1","text":"<p><code>cycle</code> \u306b\u3088\u308b\u7121\u9650\u30b7\u30fc\u30b1\u30f3\u30b9\u306f\u9045\u5ef6\u8a55\u4fa1\u3055\u308c\u308b\u305f\u3081\u3001\u30e1\u30e2\u30ea\u3092\u52b9\u7387\u7684\u306b\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"clojure/15-gossiping-bus-drivers/#_10","title":"\u7d14\u7c8b\u95a2\u6570","text":"<p>\u3059\u3079\u3066\u306e\u95a2\u6570\u306f\u526f\u4f5c\u7528\u304c\u306a\u304f\u3001\u540c\u3058\u5165\u529b\u306b\u5bfe\u3057\u3066\u5e38\u306b\u540c\u3058\u51fa\u529b\u3092\u8fd4\u3057\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u30c6\u30b9\u30c8\u304c\u5bb9\u6613\u306b\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/15-gossiping-bus-drivers/#8","title":"8. \u30d1\u30bf\u30fc\u30f3\u306e\u5fdc\u7528","text":"<p>\u3053\u306e\u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5834\u9762\u3067\u5fdc\u7528\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4f1d\u64ad: \u30a6\u30a4\u30eb\u30b9\u3084\u60c5\u5831\u306e\u62e1\u6563\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3</li> <li>\u30b0\u30e9\u30d5\u63a2\u7d22: \u5de1\u56de\u30bb\u30fc\u30eb\u30b9\u30de\u30f3\u554f\u984c\u306e\u5909\u5f62</li> <li>\u72b6\u614b\u540c\u671f: \u5206\u6563\u30b7\u30b9\u30c6\u30e0\u3067\u306e\u72b6\u614b\u5171\u6709</li> </ul>"},{"location":"clojure/15-gossiping-bus-drivers/#_11","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b\u554f\u984c\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u3092\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u7121\u9650\u30b7\u30fc\u30b1\u30f3\u30b9: <code>cycle</code> \u306b\u3088\u308b\u5faa\u74b0\u30c7\u30fc\u30bf\u306e\u8868\u73fe</li> <li>\u96c6\u5408\u6f14\u7b97: <code>set/union</code> \u306b\u3088\u308b\u72b6\u614b\u306e\u7d71\u5408</li> <li>\u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3: <code>-&gt;</code> \u30de\u30af\u30ed\u306b\u3088\u308b\u51e6\u7406\u306e\u9023\u9396</li> <li>\u7d42\u4e86\u6761\u4ef6\u306e\u8a2d\u8a08: \u30eb\u30fc\u30d7\u3068\u6761\u4ef6\u5206\u5c90\u306e\u7d44\u307f\u5408\u308f\u305b</li> </ol>"},{"location":"clojure/15-gossiping-bus-drivers/#_12","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part6/src/gossiping_bus_drivers/</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part6/spec/gossiping_bus_drivers/</code></li> </ul>"},{"location":"clojure/16-payroll-system/","title":"\u7b2c16\u7ae0: \u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0","text":""},{"location":"clojure/16-payroll-system/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0\u3092\u984c\u6750\u306b\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u304a\u3051\u308b\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30ea\u30f3\u30b0\u3068\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u591a\u614b\u6027\u306e\u5b9f\u73fe\u3092\u5b66\u3073\u307e\u3059\u3002</p> <p>\u3053\u306e\u554f\u984c\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u306e\u6982\u5ff5\u3092\u5b66\u3073\u307e\u3059\uff1a</p> <ul> <li>Clojure Spec \u306b\u3088\u308b\u30c7\u30fc\u30bf\u4ed5\u69d8\u5b9a\u7fa9</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u7d66\u4e0e\u30bf\u30a4\u30d7\u5225\u306e\u8a08\u7b97</li> <li>\u652f\u6255\u3044\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u306e\u30e2\u30c7\u30ea\u30f3\u30b0</li> </ul>"},{"location":"clojure/16-payroll-system/#1","title":"1. \u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30eb","text":""},{"location":"clojure/16-payroll-system/#_2","title":"\u5f93\u696d\u54e1\u306e\u7d66\u4e0e\u30bf\u30a4\u30d7","text":"<p>\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0\u3067\u306f\u3001\u4ee5\u4e0b\u306e3\u7a2e\u985e\u306e\u7d66\u4e0e\u30bf\u30a4\u30d7\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u307e\u3059\uff1a</p> <ul> <li>\u6708\u7d66\u5236\uff08Salaried\uff09: \u56fa\u5b9a\u6708\u7d66</li> <li>\u6642\u7d66\u5236\uff08Hourly\uff09: \u52b4\u50cd\u6642\u9593\u306b\u57fa\u3065\u304f\u7d66\u4e0e</li> <li>\u6b69\u5408\u5236\uff08Commissioned\uff09: \u57fa\u672c\u7d66 + \u58f2\u4e0a\u306b\u5fdc\u3058\u305f\u30b3\u30df\u30c3\u30b7\u30e7\u30f3</li> </ul> <p></p>"},{"location":"clojure/16-payroll-system/#2-clojure-spec","title":"2. Clojure Spec \u306b\u3088\u308b\u4ed5\u69d8\u5b9a\u7fa9","text":""},{"location":"clojure/16-payroll-system/#_3","title":"\u5f93\u696d\u54e1\u306e\u4ed5\u69d8","text":"<pre><code>(ns payroll.employee\n  (:require [clojure.spec.alpha :as s]))\n\n;; \u57fa\u672c\u5c5e\u6027\n(s/def ::id string?)\n(s/def ::name string?)\n(s/def ::address string?)\n\n;; \u7d66\u4e0e\u5206\u985e\n(s/def ::salary number?)\n(s/def ::hourly-rate number?)\n(s/def ::base-pay number?)\n(s/def ::commission-rate number?)\n\n(s/def ::pay-class\n  (s/or :salaried (s/tuple #{:salaried} ::salary)\n        :hourly (s/tuple #{:hourly} ::hourly-rate)\n        :commissioned (s/tuple #{:commissioned} ::base-pay ::commission-rate)))\n\n;; \u652f\u6255\u3044\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\n(s/def ::schedule #{:monthly :weekly :biweekly})\n\n;; \u652f\u6255\u3044\u65b9\u6cd5\n(s/def ::payment-method #{:hold :direct-deposit :mail})\n\n;; \u5f93\u696d\u54e1\n(s/def ::employee\n  (s/keys :req [::id ::name ::pay-class ::schedule ::payment-method]\n          :opt [::address]))\n</code></pre>"},{"location":"clojure/16-payroll-system/#_4","title":"\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf","text":"<pre><code>(defn make-salaried-employee\n  \"\u6708\u7d66\u5236\u5f93\u696d\u54e1\u3092\u4f5c\u6210\"\n  [id name salary]\n  {::id id\n   ::name name\n   ::pay-class [:salaried salary]\n   ::schedule :monthly\n   ::payment-method :hold})\n\n(defn make-hourly-employee\n  \"\u6642\u7d66\u5236\u5f93\u696d\u54e1\u3092\u4f5c\u6210\"\n  [id name hourly-rate]\n  {::id id\n   ::name name\n   ::pay-class [:hourly hourly-rate]\n   ::schedule :weekly\n   ::payment-method :hold})\n\n(defn make-commissioned-employee\n  \"\u6b69\u5408\u5236\u5f93\u696d\u54e1\u3092\u4f5c\u6210\"\n  [id name base-pay commission-rate]\n  {::id id\n   ::name name\n   ::pay-class [:commissioned base-pay commission-rate]\n   ::schedule :biweekly\n   ::payment-method :hold})\n</code></pre>"},{"location":"clojure/16-payroll-system/#3","title":"3. \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u7d66\u4e0e\u8a08\u7b97","text":""},{"location":"clojure/16-payroll-system/#_5","title":"\u7d66\u4e0e\u8a08\u7b97\u306e\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1","text":"<pre><code>(ns payroll.classification\n  (:require [payroll.employee :as emp]))\n\n(defmulti calc-pay\n  \"\u7d66\u4e0e\u3092\u8a08\u7b97\u3059\u308b\n   \u7d66\u4e0e\u30bf\u30a4\u30d7\u306b\u5fdc\u3058\u3066\u7570\u306a\u308b\u8a08\u7b97\u30ed\u30b8\u30c3\u30af\u3092\u9069\u7528\"\n  (fn [employee _context] (emp/get-pay-type employee)))\n</code></pre>"},{"location":"clojure/16-payroll-system/#_6","title":"\u6708\u7d66\u5236","text":"<pre><code>(defmethod calc-pay :salaried\n  [employee _context]\n  (let [[_ salary] (emp/get-pay-class employee)]\n    salary))\n</code></pre>"},{"location":"clojure/16-payroll-system/#_7","title":"\u6642\u7d66\u5236","text":"<pre><code>(defmethod calc-pay :hourly\n  [employee context]\n  (let [[_ hourly-rate] (emp/get-pay-class employee)\n        time-cards (get-in context [:time-cards (emp/get-id employee)] [])\n        hours (map second time-cards)\n        total-hours (reduce + 0 hours)\n        ;; \u903140\u6642\u9593\u3092\u8d85\u3048\u308b\u5206\u306f1.5\u500d\n        regular-hours (min total-hours 40)\n        overtime-hours (max 0 (- total-hours 40))]\n    (+ (* regular-hours hourly-rate)\n       (* overtime-hours hourly-rate 1.5))))\n</code></pre>"},{"location":"clojure/16-payroll-system/#_8","title":"\u6b69\u5408\u5236","text":"<pre><code>(defmethod calc-pay :commissioned\n  [employee context]\n  (let [[_ base-pay commission-rate] (emp/get-pay-class employee)\n        sales-receipts (get-in context [:sales-receipts (emp/get-id employee)] [])\n        total-sales (reduce + 0 (map second sales-receipts))]\n    (+ base-pay (* total-sales commission-rate))))\n</code></pre>"},{"location":"clojure/16-payroll-system/#4","title":"4. \u652f\u6255\u3044\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb","text":""},{"location":"clojure/16-payroll-system/#_9","title":"\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u5224\u5b9a","text":"<pre><code>(ns payroll.schedule\n  (:require [payroll.employee :as emp]))\n\n(defmulti is-pay-day?\n  \"\u6307\u5b9a\u65e5\u304c\u652f\u6255\u65e5\u304b\u3069\u3046\u304b\u3092\u5224\u5b9a\"\n  (fn [employee _date] (emp/get-schedule employee)))\n\n;; \u6708\u6b21\uff08\u6708\u672b\uff09\n(defmethod is-pay-day? :monthly\n  [_employee date]\n  (= (:day date) (last-day-of-month date)))\n\n;; \u9031\u6b21\uff08\u91d1\u66dc\u65e5\uff09\n(defmethod is-pay-day? :weekly\n  [_employee date]\n  (= (:day-of-week date) :friday))\n\n;; \u9694\u9031\uff08\u9694\u9031\u306e\u91d1\u66dc\u65e5\uff09\n(defmethod is-pay-day? :biweekly\n  [_employee date]\n  (and (= (:day-of-week date) :friday)\n       (:is-pay-week date)))\n</code></pre>"},{"location":"clojure/16-payroll-system/#5","title":"5. \u652f\u6255\u3044\u51e6\u7406","text":""},{"location":"clojure/16-payroll-system/#_10","title":"\u652f\u6255\u3044\u65b9\u6cd5\u306b\u3088\u308b\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1","text":"<pre><code>(ns payroll.payroll\n  (:require [payroll.employee :as emp]\n            [payroll.classification :as class]\n            [payroll.schedule :as sched]))\n\n(defmulti process-payment\n  \"\u652f\u6255\u3044\u3092\u51e6\u7406\"\n  (fn [employee _amount] (emp/get-payment-method employee)))\n\n(defmethod process-payment :hold\n  [employee amount]\n  {:type :hold\n   :employee-id (emp/get-id employee)\n   :amount amount\n   :message \"\u652f\u6255\u3044\u3092\u4fdd\u7559\"})\n\n(defmethod process-payment :direct-deposit\n  [employee amount]\n  {:type :direct-deposit\n   :employee-id (emp/get-id employee)\n   :amount amount\n   :message \"\u53e3\u5ea7\u306b\u632f\u308a\u8fbc\u307f\"})\n\n(defmethod process-payment :mail\n  [employee amount]\n  {:type :mail\n   :employee-id (emp/get-id employee)\n   :amount amount\n   :message \"\u5c0f\u5207\u624b\u3092\u90f5\u9001\"})\n</code></pre>"},{"location":"clojure/16-payroll-system/#6","title":"6. \u7d66\u4e0e\u652f\u6255\u3044\u306e\u5b9f\u884c","text":"<pre><code>(defn run-payroll\n  \"\u7d66\u4e0e\u652f\u6255\u3044\u3092\u5b9f\u884c\n   \u652f\u6255\u65e5\u306b\u8a72\u5f53\u3059\u308b\u5f93\u696d\u54e1\u306b\u306e\u307f\u652f\u6255\u3044\u3092\u884c\u3046\"\n  [employees context date]\n  (let [payable-employees (filter #(sched/is-pay-day? % date) employees)]\n    (for [emp payable-employees\n          :let [pay (class/calc-pay emp context)]]\n      (process-payment emp pay))))\n</code></pre>"},{"location":"clojure/16-payroll-system/#7","title":"7. \u4f7f\u7528\u4f8b","text":"<pre><code>(require '[payroll.employee :as emp])\n(require '[payroll.classification :as class])\n(require '[payroll.schedule :as sched])\n(require '[payroll.payroll :as payroll])\n\n;; \u5f93\u696d\u54e1\u306e\u4f5c\u6210\n(def salaried-emp\n  (emp/make-salaried-employee \"E001\" \"\u7530\u4e2d\u592a\u90ce\" 500000))\n\n(def hourly-emp\n  (emp/make-hourly-employee \"E002\" \"\u4f50\u85e4\u82b1\u5b50\" 1500))\n\n(def commissioned-emp\n  (emp/make-commissioned-employee \"E003\" \"\u9234\u6728\u4e00\u90ce\" 200000 0.1))\n\n;; \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u4f5c\u6210\uff08\u30bf\u30a4\u30e0\u30ab\u30fc\u30c9\u3001\u58f2\u4e0a\u30c7\u30fc\u30bf\uff09\n(def ctx\n  (-&gt; (class/make-context)\n      (class/add-time-card \"E002\" \"2024-01-15\" 8)\n      (class/add-time-card \"E002\" \"2024-01-16\" 10)\n      (class/add-sales-receipt \"E003\" \"2024-01-15\" 100000)\n      (class/add-sales-receipt \"E003\" \"2024-01-16\" 50000)))\n\n;; \u7d66\u4e0e\u8a08\u7b97\n(class/calc-pay salaried-emp ctx)     ;; =&gt; 500000\n(class/calc-pay hourly-emp ctx)       ;; =&gt; 27000.0 (18\u6642\u9593 * 1500)\n(class/calc-pay commissioned-emp ctx) ;; =&gt; 215000.0 (200000 + 15000)\n</code></pre>"},{"location":"clojure/16-payroll-system/#8","title":"8. \u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1\u306e\u5229\u70b9","text":""},{"location":"clojure/16-payroll-system/#1_1","title":"1. \u30c6\u30b9\u30c8\u5bb9\u6613\u6027","text":"<p>\u7d14\u7c8b\u95a2\u6570\u3067\u3042\u308b\u305f\u3081\u3001\u30c6\u30b9\u30c8\u304c\u7c21\u5358\u3067\u3059\u3002</p> <pre><code>(describe \"\u7d66\u4e0e\u8a08\u7b97 - \u6642\u7d66\u5236\"\n  (it \"\u6b8b\u696d\u6642\u9593\u306f1.5\u500d\u3067\u8a08\u7b97\"\n    (let [e (emp/make-hourly-employee \"E002\" \"\u4f50\u85e4\" 1000)\n          ctx (class/add-time-card {} \"E002\" \"2024-01-15\" 45)]\n      ;; 40 * 1000 + 5 * 1000 * 1.5 = 47500\n      (should= 47500.0 (class/calc-pay e ctx)))))\n</code></pre>"},{"location":"clojure/16-payroll-system/#2","title":"2. \u62e1\u5f35\u5bb9\u6613\u6027","text":"<p>\u65b0\u3057\u3044\u7d66\u4e0e\u30bf\u30a4\u30d7\u306e\u8ffd\u52a0\u306f\u3001\u65b0\u3057\u3044\u30e1\u30bd\u30c3\u30c9\u3092\u5b9a\u7fa9\u3059\u308b\u3060\u3051\u3067\u3059\u3002</p> <pre><code>;; \u65b0\u3057\u3044\u7d66\u4e0e\u30bf\u30a4\u30d7: \u5951\u7d04\u5236\n(defmethod calc-pay :contract\n  [employee context]\n  (let [[_ contract-amount] (emp/get-pay-class employee)]\n    contract-amount))\n</code></pre>"},{"location":"clojure/16-payroll-system/#3_1","title":"3. \u95a2\u5fc3\u306e\u5206\u96e2","text":"<ul> <li>employee: \u30c7\u30fc\u30bf\u69cb\u9020\u3068\u30a2\u30af\u30bb\u30b5</li> <li>classification: \u7d66\u4e0e\u8a08\u7b97\u30ed\u30b8\u30c3\u30af</li> <li>schedule: \u652f\u6255\u65e5\u5224\u5b9a</li> <li>payroll: \u7d71\u5408\u51e6\u7406</li> </ul>"},{"location":"clojure/16-payroll-system/#_11","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u3092\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>Clojure Spec: \u30c7\u30fc\u30bf\u4ed5\u69d8\u306e\u5b9a\u7fa9</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: \u7d66\u4e0e\u30bf\u30a4\u30d7\u306b\u3088\u308b\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1</li> <li>\u95a2\u5fc3\u306e\u5206\u96e2: \u30e2\u30b8\u30e5\u30fc\u30eb\u5316\u3055\u308c\u305f\u8a2d\u8a08</li> <li>\u7d14\u7c8b\u95a2\u6570: \u30c6\u30b9\u30c8\u5bb9\u6613\u306a\u5b9f\u88c5</li> </ol>"},{"location":"clojure/16-payroll-system/#_12","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part6/src/payroll/</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part6/spec/payroll/</code></li> </ul>"},{"location":"clojure/17-video-rental-system/","title":"\u7b2c17\u7ae0: \u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0","text":""},{"location":"clojure/17-video-rental-system/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Martin Fowler \u306e\u300c\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u300d\u3067\u6709\u540d\u306a\u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0\u3092\u984c\u6750\u306b\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u3088\u308b\u6599\u91d1\u8a08\u7b97\u30ed\u30b8\u30c3\u30af\u306e\u8a2d\u8a08\u3092\u5b66\u3073\u307e\u3059\u3002</p> <p>\u3053\u306e\u554f\u984c\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u306e\u6982\u5ff5\u3092\u5b66\u3073\u307e\u3059\uff1a</p> <ul> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u30dd\u30ea\u30b7\u30fc\u30d1\u30bf\u30fc\u30f3</li> <li>\u660e\u7d30\u66f8\u30d5\u30a9\u30fc\u30de\u30c3\u30bf\u30fc\u306e\u5b9f\u88c5</li> <li>\u30c7\u30fc\u30bf\u3068\u51e6\u7406\u306e\u5206\u96e2</li> </ul>"},{"location":"clojure/17-video-rental-system/#1","title":"1. \u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30eb","text":""},{"location":"clojure/17-video-rental-system/#_2","title":"\u6620\u753b\u306e\u30ab\u30c6\u30b4\u30ea","text":"<p>\u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0\u3067\u306f\u3001\u4ee5\u4e0b\u306e3\u7a2e\u985e\u306e\u6620\u753b\u30ab\u30c6\u30b4\u30ea\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u307e\u3059\uff1a</p> <ul> <li>\u901a\u5e38\uff08Regular\uff09: 2\u65e5\u307e\u30672.0\u3001\u4ee5\u964d1\u65e5\u3054\u3068\u306b1.5\u8ffd\u52a0</li> <li>\u65b0\u4f5c\uff08New Release\uff09: 1\u65e5\u3054\u3068\u306b3.0</li> <li>\u5b50\u4f9b\u5411\u3051\uff08Children's\uff09: 3\u65e5\u307e\u30671.5\u3001\u4ee5\u964d1\u65e5\u3054\u3068\u306b1.5\u8ffd\u52a0</li> </ul> <p></p>"},{"location":"clojure/17-video-rental-system/#2","title":"2. \u6620\u753b\u3068\u30ec\u30f3\u30bf\u30eb\u306e\u30e2\u30c7\u30eb","text":""},{"location":"clojure/17-video-rental-system/#_3","title":"\u6620\u753b","text":"<pre><code>(ns video-rental.movie)\n\n(def categories\n  #{:regular :new-release :childrens})\n\n(defn make-movie\n  \"\u6620\u753b\u3092\u4f5c\u6210\"\n  [title category]\n  {:title title\n   :category category})\n\n(defn make-regular [title]\n  (make-movie title :regular))\n\n(defn make-new-release [title]\n  (make-movie title :new-release))\n\n(defn make-childrens [title]\n  (make-movie title :childrens))\n</code></pre>"},{"location":"clojure/17-video-rental-system/#_4","title":"\u30ec\u30f3\u30bf\u30eb","text":"<pre><code>(ns video-rental.rental\n  (:require [video-rental.movie :as movie]))\n\n(defn make-rental\n  \"\u30ec\u30f3\u30bf\u30eb\u3092\u4f5c\u6210\"\n  [movie days]\n  {:movie movie\n   :days days})\n\n(defn get-movie [rental]\n  (:movie rental))\n\n(defn get-days [rental]\n  (:days rental))\n\n(defn get-movie-category [rental]\n  (movie/get-category (:movie rental)))\n</code></pre>"},{"location":"clojure/17-video-rental-system/#3","title":"3. \u6599\u91d1\u8a08\u7b97\u306e\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9","text":""},{"location":"clojure/17-video-rental-system/#_5","title":"\u6599\u91d1\u8a08\u7b97","text":"<pre><code>(ns video-rental.pricing\n  (:require [video-rental.rental :as rental]))\n\n(defmulti determine-amount\n  \"\u30ec\u30f3\u30bf\u30eb\u6599\u91d1\u3092\u8a08\u7b97\"\n  (fn [r] (rental/get-movie-category r)))\n\n;; \u901a\u5e38\u6620\u753b: 2\u65e5\u307e\u30672.0\u3001\u4ee5\u964d1\u65e5\u3054\u3068\u306b1.5\u8ffd\u52a0\n(defmethod determine-amount :regular\n  [r]\n  (let [days (rental/get-days r)]\n    (if (&gt; days 2)\n      (+ 2.0 (* (- days 2) 1.5))\n      2.0)))\n\n;; \u65b0\u4f5c: 1\u65e5\u3054\u3068\u306b3.0\n(defmethod determine-amount :new-release\n  [r]\n  (* (rental/get-days r) 3.0))\n\n;; \u5b50\u4f9b\u5411\u3051: 3\u65e5\u307e\u30671.5\u3001\u4ee5\u964d1\u65e5\u3054\u3068\u306b1.5\u8ffd\u52a0\n(defmethod determine-amount :childrens\n  [r]\n  (let [days (rental/get-days r)]\n    (if (&gt; days 3)\n      (+ 1.5 (* (- days 3) 1.5))\n      1.5)))\n</code></pre>"},{"location":"clojure/17-video-rental-system/#_6","title":"\u30dd\u30a4\u30f3\u30c8\u8a08\u7b97","text":"<pre><code>(defmulti determine-points\n  \"\u30ec\u30f3\u30bf\u30eb\u30dd\u30a4\u30f3\u30c8\u3092\u8a08\u7b97\"\n  (fn [r] (rental/get-movie-category r)))\n\n;; \u901a\u5e38\u6620\u753b: 1\u30dd\u30a4\u30f3\u30c8\n(defmethod determine-points :regular\n  [_r]\n  1)\n\n;; \u65b0\u4f5c: 2\u65e5\u4ee5\u4e0a\u30672\u30dd\u30a4\u30f3\u30c8\u3001\u305d\u308c\u4ee5\u5916\u306f1\u30dd\u30a4\u30f3\u30c8\n(defmethod determine-points :new-release\n  [r]\n  (if (&gt; (rental/get-days r) 1)\n    2\n    1))\n\n;; \u5b50\u4f9b\u5411\u3051: 1\u30dd\u30a4\u30f3\u30c8\n(defmethod determine-points :childrens\n  [_r]\n  1)\n</code></pre>"},{"location":"clojure/17-video-rental-system/#4","title":"4. \u660e\u7d30\u66f8\u30d5\u30a9\u30fc\u30de\u30c3\u30bf\u30fc","text":""},{"location":"clojure/17-video-rental-system/#_7","title":"\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u30d5\u30a9\u30fc\u30de\u30c3\u30c8","text":"<pre><code>(ns video-rental.statement\n  (:require [video-rental.rental :as rental]\n            [video-rental.pricing :as pricing]))\n\n(defmulti format-statement\n  \"\u660e\u7d30\u66f8\u3092\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\"\n  (fn [format _customer _rentals] format))\n\n;; \u30c6\u30ad\u30b9\u30c8\u5f62\u5f0f\n(defmethod format-statement :text\n  [_ customer rentals]\n  (let [header (str \"Rental Record for \" customer \"\\n\")\n        lines (map (fn [r]\n                     (str \"\\t\" (rental/get-movie-title r)\n                          \"\\t\" (pricing/determine-amount r) \"\\n\"))\n                   rentals)\n        total (pricing/total-amount rentals)\n        points (pricing/total-points rentals)\n        footer (str \"Amount owed is \" total \"\\n\"\n                    \"You earned \" points \" frequent renter points\")]\n    (str header (apply str lines) footer)))\n\n;; HTML\u5f62\u5f0f\n(defmethod format-statement :html\n  [_ customer rentals]\n  (let [header (str \"&lt;h1&gt;Rental Record for &lt;em&gt;\" customer \"&lt;/em&gt;&lt;/h1&gt;\\n&lt;ul&gt;\\n\")\n        lines (map (fn [r]\n                     (str \"  &lt;li&gt;\" (rental/get-movie-title r)\n                          \" - \" (pricing/determine-amount r) \"&lt;/li&gt;\\n\"))\n                   rentals)\n        total (pricing/total-amount rentals)\n        points (pricing/total-points rentals)\n        footer (str \"&lt;/ul&gt;\\n\"\n                    \"&lt;p&gt;Amount owed is &lt;strong&gt;\" total \"&lt;/strong&gt;&lt;/p&gt;\\n\"\n                    \"&lt;p&gt;You earned &lt;strong&gt;\" points \"&lt;/strong&gt; frequent renter points&lt;/p&gt;\")]\n    (str header (apply str lines) footer)))\n</code></pre>"},{"location":"clojure/17-video-rental-system/#5","title":"5. \u660e\u7d30\u30c7\u30fc\u30bf\u306e\u751f\u6210","text":"<p>\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306b\u4f9d\u5b58\u3057\u306a\u3044\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u751f\u6210\u3059\u308b\u3053\u3068\u3067\u3001\u30c6\u30b9\u30c8\u3084\u4ed6\u306e\u7528\u9014\u306b\u6d3b\u7528\u3067\u304d\u307e\u3059\u3002</p> <pre><code>(defn statement-data\n  \"\u660e\u7d30\u30c7\u30fc\u30bf\u3092\u751f\u6210\uff08\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u975e\u4f9d\u5b58\uff09\"\n  [customer rentals]\n  {:customer customer\n   :rentals (map (fn [r]\n                   {:title (rental/get-movie-title r)\n                    :days (rental/get-days r)\n                    :amount (pricing/determine-amount r)\n                    :points (pricing/determine-points r)})\n                 rentals)\n   :total-amount (pricing/total-amount rentals)\n   :total-points (pricing/total-points rentals)})\n</code></pre>"},{"location":"clojure/17-video-rental-system/#6","title":"6. \u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"clojure/17-video-rental-system/#7","title":"7. \u4f7f\u7528\u4f8b","text":"<pre><code>(require '[video-rental.movie :as movie])\n(require '[video-rental.rental :as rental])\n(require '[video-rental.pricing :as pricing])\n(require '[video-rental.statement :as stmt])\n\n;; \u6620\u753b\u306e\u4f5c\u6210\n(def inception (movie/make-regular \"Inception\"))\n(def frozen (movie/make-childrens \"Frozen\"))\n(def new-movie (movie/make-new-release \"New Movie\"))\n\n;; \u30ec\u30f3\u30bf\u30eb\u306e\u4f5c\u6210\n(def rentals\n  [(rental/make-rental inception 3)\n   (rental/make-rental frozen 4)\n   (rental/make-rental new-movie 2)])\n\n;; \u6599\u91d1\u8a08\u7b97\n(pricing/determine-amount (first rentals)) ;; =&gt; 3.5\n(pricing/total-amount rentals)              ;; =&gt; 12.5\n(pricing/total-points rentals)              ;; =&gt; 4\n\n;; \u30c6\u30ad\u30b9\u30c8\u660e\u7d30\u66f8\n(println (stmt/make-statement \"John\" rentals))\n;; Rental Record for John\n;;   Inception  3.5\n;;   Frozen     3.0\n;;   New Movie  6.0\n;; Amount owed is 12.5\n;; You earned 4 frequent renter points\n\n;; HTML\u660e\u7d30\u66f8\n(println (stmt/make-statement :html \"John\" rentals))\n;; &lt;h1&gt;Rental Record for &lt;em&gt;John&lt;/em&gt;&lt;/h1&gt;\n;; &lt;ul&gt;\n;;   &lt;li&gt;Inception - 3.5&lt;/li&gt;\n;;   &lt;li&gt;Frozen - 3.0&lt;/li&gt;\n;;   &lt;li&gt;New Movie - 6.0&lt;/li&gt;\n;; &lt;/ul&gt;\n;; &lt;p&gt;Amount owed is &lt;strong&gt;12.5&lt;/strong&gt;&lt;/p&gt;\n;; &lt;p&gt;You earned &lt;strong&gt;4&lt;/strong&gt; frequent renter points&lt;/p&gt;\n</code></pre>"},{"location":"clojure/17-video-rental-system/#8","title":"8. \u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u306e\u30dd\u30a4\u30f3\u30c8","text":""},{"location":"clojure/17-video-rental-system/#_8","title":"\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u7248\u3068\u306e\u6bd4\u8f03","text":"<p>\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u7248\u3067\u306f\u3001<code>Movie</code> \u30af\u30e9\u30b9\u306b <code>getCharge()</code> \u30e1\u30bd\u30c3\u30c9\u3092\u6301\u305f\u305b\u308b\u3053\u3068\u304c\u591a\u3044\u3067\u3059\u304c\u3001\u95a2\u6570\u578b\u3067\u306f\uff1a</p> <ol> <li>\u30c7\u30fc\u30bf\u3068\u51e6\u7406\u306e\u5206\u96e2: \u6620\u753b\u306f\u30c7\u30fc\u30bf\u306e\u307f\u3001\u6599\u91d1\u8a08\u7b97\u306f\u5225\u306e\u95a2\u6570</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: \u30ab\u30c6\u30b4\u30ea\u306b\u5fdc\u3058\u305f\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1</li> <li>\u30aa\u30fc\u30d7\u30f3\u30fb\u30af\u30ed\u30fc\u30ba\u30c9\u539f\u5247: \u65b0\u3057\u3044\u30ab\u30c6\u30b4\u30ea\u8ffd\u52a0\u6642\u3082\u65e2\u5b58\u30b3\u30fc\u30c9\u5909\u66f4\u4e0d\u8981</li> </ol> <p></p>"},{"location":"clojure/17-video-rental-system/#9","title":"9. \u62e1\u5f35\u6027","text":""},{"location":"clojure/17-video-rental-system/#_9","title":"\u65b0\u3057\u3044\u30ab\u30c6\u30b4\u30ea\u306e\u8ffd\u52a0","text":"<pre><code>;; \u65b0\u3057\u3044\u30ab\u30c6\u30b4\u30ea: \u30d7\u30ec\u30df\u30a2\u30e0\n(defmethod pricing/determine-amount :premium\n  [r]\n  (* (rental/get-days r) 5.0))\n\n(defmethod pricing/determine-points :premium\n  [r]\n  (rental/get-days r))  ; \u65e5\u6570\u5206\u306e\u30dd\u30a4\u30f3\u30c8\n</code></pre>"},{"location":"clojure/17-video-rental-system/#_10","title":"\u65b0\u3057\u3044\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306e\u8ffd\u52a0","text":"<pre><code>;; JSON\u5f62\u5f0f\n(defmethod stmt/format-statement :json\n  [_ customer rentals]\n  (json/write-str (stmt/statement-data customer rentals)))\n</code></pre>"},{"location":"clojure/17-video-rental-system/#_11","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u3092\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: \u30ab\u30c6\u30b4\u30ea\u306b\u3088\u308b\u6599\u91d1\u8a08\u7b97\u306e\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1</li> <li>\u30c7\u30fc\u30bf\u3068\u51e6\u7406\u306e\u5206\u96e2: \u6620\u753b\u30c7\u30fc\u30bf\u3068\u8a08\u7b97\u30ed\u30b8\u30c3\u30af\u306e\u5206\u96e2</li> <li>\u30d5\u30a9\u30fc\u30de\u30c3\u30bf\u30fc\u30d1\u30bf\u30fc\u30f3: \u8907\u6570\u306e\u51fa\u529b\u5f62\u5f0f\u3078\u306e\u5bfe\u5fdc</li> <li>\u62e1\u5f35\u6027: \u65b0\u3057\u3044\u30ab\u30c6\u30b4\u30ea\u3084\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306e\u8ffd\u52a0\u304c\u5bb9\u6613</li> </ol>"},{"location":"clojure/17-video-rental-system/#_12","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part6/src/video_rental/</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part6/spec/video_rental/</code></li> </ul>"},{"location":"clojure/18-concurrency-system/","title":"\u7b2c18\u7ae0: \u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0","text":""},{"location":"clojure/18-concurrency-system/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Clojure \u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u4f7f\u3063\u305f\u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0\u3092\u5b66\u3073\u307e\u3059\u3002\u96fb\u8a71\u901a\u8a71\u30b7\u30b9\u30c6\u30e0\u3092\u72b6\u614b\u6a5f\u68b0\u30d1\u30bf\u30fc\u30f3\u3067\u5b9f\u88c5\u3057\u3001\u30a4\u30d9\u30f3\u30c8\u99c6\u52d5\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306e\u57fa\u790e\u3092\u7406\u89e3\u3057\u307e\u3059\u3002</p> <p>\u3053\u306e\u554f\u984c\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u306e\u6982\u5ff5\u3092\u5b66\u3073\u307e\u3059\uff1a</p> <ul> <li>Clojure \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306b\u3088\u308b\u975e\u540c\u671f\u72b6\u614b\u7ba1\u7406</li> <li>\u72b6\u614b\u6a5f\u68b0\u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5</li> <li>\u30a4\u30d9\u30f3\u30c8\u99c6\u52d5\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3</li> </ul>"},{"location":"clojure/18-concurrency-system/#1-clojure","title":"1. Clojure \u306e\u4e26\u884c\u51e6\u7406\u30e2\u30c7\u30eb","text":"<p>Clojure \u306f\u8907\u6570\u306e\u4e26\u884c\u51e6\u7406\u30d7\u30ea\u30df\u30c6\u30a3\u30d6\u3092\u63d0\u4f9b\u3057\u307e\u3059\uff1a</p> \u30d7\u30ea\u30df\u30c6\u30a3\u30d6 \u7279\u5fb4 \u7528\u9014 Atom \u540c\u671f\u7684\u3001\u5358\u4e00\u5024 \u7c21\u5358\u306a\u72b6\u614b\u7ba1\u7406 Ref \u540c\u671f\u7684\u3001\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3 \u5354\u8abf\u7684\u306a\u5909\u66f4 Agent \u975e\u540c\u671f\u7684 \u72ec\u7acb\u3057\u305f\u72b6\u614b\u5909\u66f4 <p></p>"},{"location":"clojure/18-concurrency-system/#2","title":"2. \u72b6\u614b\u6a5f\u68b0\u30d1\u30bf\u30fc\u30f3","text":""},{"location":"clojure/18-concurrency-system/#_2","title":"\u96fb\u8a71\u901a\u8a71\u306e\u72b6\u614b\u9077\u79fb","text":""},{"location":"clojure/18-concurrency-system/#_3","title":"\u72b6\u614b\u6a5f\u68b0\u306e\u5b9a\u7fa9","text":"<pre><code>(ns concurrency.state-machine)\n\n(def user-sm\n  \"\u30e6\u30fc\u30b6\u30fc\u72b6\u614b\u6a5f\u68b0\u306e\u5b9a\u7fa9\n   {\u73fe\u5728\u306e\u72b6\u614b {\u30a4\u30d9\u30f3\u30c8 [\u6b21\u306e\u72b6\u614b \u30a2\u30af\u30b7\u30e7\u30f3]}}\"\n  {:idle {:call [:calling :caller-off-hook]\n          :ring [:waiting-for-connection :callee-off-hook]\n          :disconnect [:idle nil]}\n   :calling {:dialtone [:dialing :dial]}\n   :dialing {:ringback [:waiting-for-connection nil]}\n   :waiting-for-connection {:connected [:talking :talk]}\n   :talking {:disconnect [:idle nil]}})\n</code></pre>"},{"location":"clojure/18-concurrency-system/#3","title":"3. \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306b\u3088\u308b\u5b9f\u88c5","text":""},{"location":"clojure/18-concurrency-system/#_4","title":"\u30e6\u30fc\u30b6\u30fc\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u4f5c\u6210","text":"<pre><code>(defn make-user-agent\n  \"\u30e6\u30fc\u30b6\u30fc\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u4f5c\u6210\"\n  [user-id]\n  (agent {:user-id user-id\n          :state :idle\n          :machine user-sm\n          :peer nil}))\n\n(defn get-state\n  \"\u73fe\u5728\u306e\u72b6\u614b\u3092\u53d6\u5f97\"\n  [user-agent]\n  (:state @user-agent))\n\n(defn get-user-id\n  \"\u30e6\u30fc\u30b6\u30fcID\u3092\u53d6\u5f97\"\n  [user-agent]\n  (:user-id @user-agent))\n</code></pre>"},{"location":"clojure/18-concurrency-system/#_5","title":"\u72b6\u614b\u9077\u79fb\u306e\u5b9f\u884c","text":"<pre><code>(defn transition\n  \"\u72b6\u614b\u9077\u79fb\u3092\u5b9f\u884c\"\n  [agent-state event event-data]\n  (let [{:keys [state machine user-id peer]} agent-state\n        result (get-in machine [state event])]\n    (if result\n      (let [[next-state action-key] result\n            action (get actions action-key)]\n        (when action\n          (action user-id (or (:peer event-data) peer \"unknown\")))\n        (assoc agent-state\n               :state next-state\n               :peer (or (:peer event-data) peer)))\n      (do\n        (println (str \"Invalid transition: \" state \" -&gt; \" event))\n        agent-state))))\n\n(defn send-event\n  \"\u30a4\u30d9\u30f3\u30c8\u3092\u9001\u4fe1\"\n  ([user-agent event]\n   (send-event user-agent event {}))\n  ([user-agent event event-data]\n   (send user-agent transition event event-data)))\n</code></pre>"},{"location":"clojure/18-concurrency-system/#4","title":"4. \u30a2\u30af\u30b7\u30e7\u30f3\u95a2\u6570","text":"<pre><code>(defn caller-off-hook\n  \"\u767a\u4fe1\u8005\u304c\u30aa\u30d5\u30d5\u30c3\u30af\uff08\u53d7\u8a71\u5668\u3092\u4e0a\u3052\u308b\uff09\"\n  [from-user to-user]\n  (println (str from-user \" picked up the phone to call \" to-user)))\n\n(defn callee-off-hook\n  \"\u7740\u4fe1\u8005\u304c\u30aa\u30d5\u30d5\u30c3\u30af\uff08\u96fb\u8a71\u306b\u51fa\u308b\uff09\"\n  [from-user to-user]\n  (println (str from-user \" answered the call from \" to-user)))\n\n(defn dial\n  \"\u30c0\u30a4\u30e4\u30eb\"\n  [from-user to-user]\n  (println (str from-user \" is dialing \" to-user)))\n\n(defn talk\n  \"\u901a\u8a71\u958b\u59cb\"\n  [from-user to-user]\n  (println (str from-user \" is now talking with \" to-user)))\n\n(def actions\n  {:caller-off-hook caller-off-hook\n   :callee-off-hook callee-off-hook\n   :dial dial\n   :talk talk})\n</code></pre>"},{"location":"clojure/18-concurrency-system/#5-api","title":"5. \u96fb\u8a71\u64cd\u4f5c\u306e\u9ad8\u30ec\u30d9\u30ebAPI","text":"<pre><code>(defn make-call\n  \"\u96fb\u8a71\u3092\u304b\u3051\u308b\"\n  [caller callee]\n  (let [callee-id (get-user-id callee)]\n    (send-event caller :call {:peer callee-id})\n    (send-event callee :ring {:peer (get-user-id caller)})))\n\n(defn answer-call\n  \"\u96fb\u8a71\u306b\u51fa\u308b\"\n  [caller callee]\n  (send-event caller :dialtone {})\n  (send-event caller :ringback {})\n  (send-event caller :connected {})\n  (send-event callee :connected {}))\n\n(defn hang-up\n  \"\u96fb\u8a71\u3092\u5207\u308b\"\n  [caller callee]\n  (send-event caller :disconnect {})\n  (send-event callee :disconnect {}))\n</code></pre>"},{"location":"clojure/18-concurrency-system/#6","title":"6. \u30a4\u30d9\u30f3\u30c8\u99c6\u52d5\u30b7\u30b9\u30c6\u30e0","text":""},{"location":"clojure/18-concurrency-system/#_6","title":"\u30a4\u30d9\u30f3\u30c8\u30d0\u30b9\u306e\u5b9f\u88c5","text":"<pre><code>(ns concurrency.event-system)\n\n(defn make-event-bus\n  \"\u30a4\u30d9\u30f3\u30c8\u30d0\u30b9\u3092\u4f5c\u6210\"\n  []\n  (agent {:subscribers {}\n          :event-log []}))\n\n(defn subscribe\n  \"\u30a4\u30d9\u30f3\u30c8\u3092\u8cfc\u8aad\"\n  [bus event-type handler]\n  (send bus\n        (fn [state]\n          (update-in state [:subscribers event-type]\n                     (fnil conj []) handler))))\n\n(defn publish\n  \"\u30a4\u30d9\u30f3\u30c8\u3092\u767a\u884c\"\n  [bus event-type data]\n  (send bus\n        (fn [state]\n          (let [handlers (get-in state [:subscribers event-type] [])\n                event {:type event-type\n                       :data data\n                       :timestamp (System/currentTimeMillis)}]\n            ;; \u30cf\u30f3\u30c9\u30e9\u3092\u5b9f\u884c\n            (doseq [handler handlers]\n              (try\n                (handler event)\n                (catch Exception e\n                  (println \"Handler error:\" (.getMessage e)))))\n            ;; \u30a4\u30d9\u30f3\u30c8\u30ed\u30b0\u306b\u8ffd\u52a0\n            (update state :event-log conj event)))))\n</code></pre>"},{"location":"clojure/18-concurrency-system/#7","title":"7. \u4f7f\u7528\u4f8b","text":""},{"location":"clojure/18-concurrency-system/#_7","title":"\u96fb\u8a71\u901a\u8a71\u306e\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3","text":"<pre><code>(require '[concurrency.state-machine :as sm])\n\n;; \u30e6\u30fc\u30b6\u30fc\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u4f5c\u6210\n(def alice (sm/make-user-agent \"Alice\"))\n(def bob (sm/make-user-agent \"Bob\"))\n\n;; \u521d\u671f\u72b6\u614b\u306e\u78ba\u8a8d\n(sm/get-state alice) ;; =&gt; :idle\n(sm/get-state bob)   ;; =&gt; :idle\n\n;; Alice \u304c Bob \u306b\u96fb\u8a71\u3092\u304b\u3051\u308b\n(sm/make-call alice bob)\n(await alice bob)\n;; Alice picked up the phone to call Bob\n;; Bob answered the call from Alice\n\n(sm/get-state alice) ;; =&gt; :calling\n(sm/get-state bob)   ;; =&gt; :waiting-for-connection\n\n;; Bob \u304c\u96fb\u8a71\u306b\u51fa\u308b\n(sm/answer-call alice bob)\n(await alice bob)\n;; Alice is dialing Bob\n;; Alice is now talking with Bob\n;; Bob is now talking with Alice\n\n(sm/get-state alice) ;; =&gt; :talking\n(sm/get-state bob)   ;; =&gt; :talking\n\n;; \u96fb\u8a71\u3092\u5207\u308b\n(sm/hang-up alice bob)\n(await alice bob)\n\n(sm/get-state alice) ;; =&gt; :idle\n(sm/get-state bob)   ;; =&gt; :idle\n</code></pre>"},{"location":"clojure/18-concurrency-system/#_8","title":"\u30a4\u30d9\u30f3\u30c8\u30b7\u30b9\u30c6\u30e0\u306e\u4f7f\u7528","text":"<pre><code>(require '[concurrency.event-system :as es])\n\n;; \u30a4\u30d9\u30f3\u30c8\u30d0\u30b9\u3092\u4f5c\u6210\n(def bus (es/make-event-bus))\n\n;; \u30cf\u30f3\u30c9\u30e9\u3092\u767b\u9332\n(es/subscribe bus :user-logged-in\n              (fn [event]\n                (println \"User logged in:\" (:data event))))\n\n(es/subscribe bus :user-logged-in\n              (fn [event]\n                (println \"Sending welcome email to:\" (:data event))))\n\n;; \u30a4\u30d9\u30f3\u30c8\u3092\u767a\u884c\n(es/publish bus :user-logged-in {:user-id \"U001\" :name \"Alice\"})\n(await bus)\n;; User logged in: {:user-id \"U001\", :name \"Alice\"}\n;; Sending welcome email to: {:user-id \"U001\", :name \"Alice\"}\n\n;; \u30a4\u30d9\u30f3\u30c8\u30ed\u30b0\u306e\u78ba\u8a8d\n(es/get-event-log bus)\n;; [{:type :user-logged-in, :data {...}, :timestamp 1234567890}]\n</code></pre>"},{"location":"clojure/18-concurrency-system/#8","title":"8. \u4e26\u884c\u51e6\u7406\u306e\u7279\u5fb4","text":""},{"location":"clojure/18-concurrency-system/#_9","title":"\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u5229\u70b9","text":"<ol> <li>\u975e\u540c\u671f\u51e6\u7406: <code>send</code> \u306f\u5373\u5ea7\u306b\u623b\u308a\u3001\u51e6\u7406\u306f\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u5b9f\u884c</li> <li>\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba: \u540c\u4e00\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3078\u306e\u66f4\u65b0\u306f\u9806\u5e8f\u4fdd\u8a3c</li> <li>\u30a8\u30e9\u30fc\u51e6\u7406: \u30a8\u30e9\u30fc\u306f\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u5185\u306b\u9589\u3058\u8fbc\u3081\u3089\u308c\u308b</li> </ol>"},{"location":"clojure/18-concurrency-system/#_10","title":"\u6ce8\u610f\u70b9","text":"<pre><code>;; \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u51e6\u7406\u5b8c\u4e86\u3092\u5f85\u3064\u5834\u5408\n(await agent1 agent2)\n\n;; \u307e\u305f\u306f\n(Thread/sleep 50)\n\n;; \u30a8\u30e9\u30fc\u72b6\u614b\u306e\u78ba\u8a8d\n(agent-error user-agent)\n\n;; \u30a8\u30e9\u30fc\u72b6\u614b\u306e\u30ea\u30bb\u30c3\u30c8\n(restart-agent user-agent initial-state)\n</code></pre>"},{"location":"clojure/18-concurrency-system/#9","title":"9. \u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"clojure/18-concurrency-system/#_11","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u3092\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>Clojure \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8: \u975e\u540c\u671f\u72b6\u614b\u7ba1\u7406</li> <li>\u72b6\u614b\u6a5f\u68b0\u30d1\u30bf\u30fc\u30f3: \u5ba3\u8a00\u7684\u306a\u72b6\u614b\u9077\u79fb\u5b9a\u7fa9</li> <li>\u30a4\u30d9\u30f3\u30c8\u99c6\u52d5\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3: \u758e\u7d50\u5408\u306a\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u9593\u901a\u4fe1</li> <li>\u4e26\u884c\u51e6\u7406\u306e\u5b89\u5168\u6027: \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306b\u3088\u308b\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba</li> </ol>"},{"location":"clojure/18-concurrency-system/#_12","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part6/src/concurrency/</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part6/spec/concurrency/</code></li> </ul>"},{"location":"clojure/19-wator-simulation/","title":"\u7b2c19\u7ae0: Wa-Tor \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3","text":""},{"location":"clojure/19-wator-simulation/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Wa-Tor\uff08Water Torus\uff09\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u901a\u3058\u3066\u3001\u30bb\u30eb\u30aa\u30fc\u30c8\u30de\u30c8\u30f3\u3068\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3063\u305f\u6355\u98df\u8005-\u88ab\u98df\u8005\u30e2\u30c7\u30eb\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p> <p>Wa-Tor \u306f1984\u5e74\u306b A.K. Dewdney \u304c Scientific American \u3067\u7d39\u4ecb\u3057\u305f\u53e4\u5178\u7684\u306a\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3067\u3001\u9b5a\uff08\u88ab\u98df\u8005\uff09\u3068\u30b5\u30e1\uff08\u6355\u98df\u8005\uff09\u306e\u751f\u614b\u7cfb\u3092\u30e2\u30c7\u30eb\u5316\u3057\u307e\u3059\u3002</p> <p>\u3053\u306e\u554f\u984c\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u306e\u6982\u5ff5\u3092\u5b66\u3073\u307e\u3059\uff1a</p> <ul> <li>\u30bb\u30eb\u30aa\u30fc\u30c8\u30de\u30c8\u30f3\u306e\u5b9f\u88c5</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u591a\u614b\u7684\u306a\u632f\u308b\u821e\u3044</li> <li>\u30c8\u30fc\u30e9\u30b9\u578b\u30ef\u30fc\u30eb\u30c9\u306e\u5ea7\u6a19\u8a08\u7b97</li> <li>\u7e41\u6b96\u3068\u6355\u98df\u306e\u30eb\u30fc\u30eb\u5b9f\u88c5</li> </ul>"},{"location":"clojure/19-wator-simulation/#1-wa-tor","title":"1. Wa-Tor \u306e\u4e16\u754c","text":""},{"location":"clojure/19-wator-simulation/#_2","title":"\u30c8\u30fc\u30e9\u30b9\u578b\u30ef\u30fc\u30eb\u30c9","text":"<p>Wa-Tor \u306e\u4e16\u754c\u306f\u30c8\u30fc\u30e9\u30b9\uff08\u30c9\u30fc\u30ca\u30c4\u578b\uff09\u3067\u3059\u3002\u7aef\u306b\u5230\u9054\u3059\u308b\u3068\u53cd\u5bfe\u5074\u306b\u51fa\u73fe\u3057\u307e\u3059\u3002</p> <p></p>"},{"location":"clojure/19-wator-simulation/#_3","title":"\u30bb\u30eb\u306e\u7a2e\u985e","text":"<ul> <li>\u6c34\uff08Water\uff09: \u7a7a\u306e\u30bb\u30eb</li> <li>\u9b5a\uff08Fish\uff09: \u88ab\u98df\u8005\u3001\u79fb\u52d5\u3068\u7e41\u6b96\u306e\u307f</li> <li>\u30b5\u30e1\uff08Shark\uff09: \u6355\u98df\u8005\u3001\u79fb\u52d5\u3001\u7e41\u6b96\u3001\u6355\u98df</li> </ul>"},{"location":"clojure/19-wator-simulation/#2","title":"2. \u6bb5\u968e\u7684\u306a\u5b9f\u88c5","text":""},{"location":"clojure/19-wator-simulation/#phase-1","title":"Phase 1: \u57fa\u672c\u69cb\u9020","text":"<p>\u307e\u305a\u3001\u30bb\u30eb\u3068\u30ef\u30fc\u30eb\u30c9\u306e\u57fa\u672c\u69cb\u9020\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002</p> <pre><code>(ns wator.cell)\n\n(defmulti tick\n  \"\u30bb\u30eb\u306e1\u30b9\u30c6\u30c3\u30d7\u3092\u5b9f\u884c\"\n  (fn [cell &amp; _args] (::type cell)))\n\n(defmulti display\n  \"\u30bb\u30eb\u306e\u8868\u793a\u6587\u5b57\u3092\u53d6\u5f97\"\n  ::type)\n</code></pre>"},{"location":"clojure/19-wator-simulation/#phase-2","title":"Phase 2: \u6c34\u30bb\u30eb","text":"<p>\u6700\u3082\u30b7\u30f3\u30d7\u30eb\u306a\u30bb\u30eb\u3067\u3042\u308b\u6c34\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002</p> <pre><code>(ns wator.water\n  (:require [wator.cell :as cell]))\n\n(defn make\n  \"\u6c34\u30bb\u30eb\u3092\u4f5c\u6210\"\n  []\n  {::cell/type ::water})\n\n(defn is?\n  \"\u6c34\u30bb\u30eb\u304b\u3069\u3046\u304b\u5224\u5b9a\"\n  [cell]\n  (= ::water (::cell/type cell)))\n\n(defmethod cell/tick ::water\n  [_water _loc _world]\n  nil)\n\n(defmethod cell/display ::water\n  [_water]\n  \".\")\n</code></pre>"},{"location":"clojure/19-wator-simulation/#phase-3","title":"Phase 3: \u30ef\u30fc\u30eb\u30c9\u69cb\u9020","text":"<pre><code>(ns wator.world\n  (:require [wator.cell :as cell]\n            [wator.water :as water]))\n\n(declare neighbors get-cell)\n\n(defn make\n  \"\u30ef\u30fc\u30eb\u30c9\u3092\u4f5c\u6210\"\n  [width height]\n  (let [locs (for [x (range width) y (range height)] [x y])\n        cells (into {} (map (fn [loc] [loc (water/make)]) locs))]\n    {:type ::world\n     :width width\n     :height height\n     :cells cells\n     :neighbors-fn neighbors\n     :get-cell-fn get-cell}))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#phase-4","title":"Phase 4: \u5ea7\u6a19\u306e\u30e9\u30c3\u30d7","text":"<pre><code>(defn wrap\n  \"\u5ea7\u6a19\u3092\u30c8\u30fc\u30e9\u30b9\u4e0a\u3067\u30e9\u30c3\u30d7\"\n  [world [x y]]\n  (let [{:keys [width height]} world]\n    [(mod x width) (mod y height)]))\n\n(defn neighbors\n  \"\u96a3\u63a5\u30bb\u30eb\u306e\u5ea7\u6a19\u3092\u53d6\u5f97\uff088\u65b9\u5411\uff09\"\n  [world [x y]]\n  (let [deltas (for [dx [-1 0 1] dy [-1 0 1]\n                     :when (not (and (= dx 0) (= dy 0)))]\n                 [dx dy])]\n    (map (fn [[dx dy]]\n           (wrap world [(+ x dx) (+ y dy)]))\n         deltas)))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#3","title":"3. \u52d5\u7269\u306e\u57fa\u672c\u6a5f\u80fd","text":""},{"location":"clojure/19-wator-simulation/#phase-5","title":"Phase 5: \u52d5\u7269\u306e\u5171\u901a\u6a5f\u80fd","text":"<pre><code>(ns wator.animal\n  (:require [wator.cell :as cell]\n            [wator.water :as water]))\n\n(defmulti move (fn [animal &amp; _args] (::cell/type animal)))\n(defmulti reproduce (fn [animal &amp; _args] (::cell/type animal)))\n(defmulti make-child ::cell/type)\n(defmulti get-reproduction-age ::cell/type)\n\n(defn make\n  \"\u52d5\u7269\u306e\u57fa\u672c\u5c5e\u6027\u3092\u4f5c\u6210\"\n  []\n  {::age 0})\n\n(defn age [animal]\n  (::age animal))\n\n(defn increment-age [animal]\n  (update animal ::age inc))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#phase-6","title":"Phase 6: \u79fb\u52d5\u30ed\u30b8\u30c3\u30af","text":"<pre><code>(defn find-empty-neighbors\n  \"\u96a3\u63a5\u3059\u308b\u7a7a\u306e\u30bb\u30eb\u3092\u691c\u7d22\"\n  [world loc]\n  (let [neighbors ((:neighbors-fn world) world loc)]\n    (filter #(water/is? ((:get-cell-fn world) world %)) neighbors)))\n\n(defn do-move\n  \"\u52d5\u7269\u3092\u7a7a\u306e\u30bb\u30eb\u306b\u79fb\u52d5\"\n  [animal loc world]\n  (let [destinations (find-empty-neighbors world loc)]\n    (if (empty? destinations)\n      [nil {loc animal}]\n      (let [new-loc (rand-nth destinations)]\n        [{loc (water/make)} {new-loc animal}]))))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#phase-7","title":"Phase 7: \u7e41\u6b96\u30ed\u30b8\u30c3\u30af","text":"<pre><code>(defn do-reproduce\n  \"\u52d5\u7269\u304c\u7e41\u6b96\u3092\u8a66\u307f\u308b\"\n  [animal loc world]\n  (if (&gt;= (age animal) (get-reproduction-age animal))\n    (let [birth-places (find-empty-neighbors world loc)]\n      (if (empty? birth-places)\n        nil\n        (let [new-loc (rand-nth birth-places)]\n          [{loc (set-age animal 0)}\n           {new-loc (make-child animal)}])))\n    nil))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#4","title":"4. \u9b5a\u306e\u5b9f\u88c5","text":""},{"location":"clojure/19-wator-simulation/#phase-8","title":"Phase 8: \u9b5a\u30af\u30e9\u30b9","text":"<pre><code>(ns wator.fish\n  (:require [wator.cell :as cell]\n            [wator.animal :as animal]\n            [wator.config :as config]))\n\n(defn is? [cell]\n  (= ::fish (::cell/type cell)))\n\n(defn make []\n  (merge {::cell/type ::fish}\n         (animal/make)))\n\n(defmethod animal/make-child ::fish [_fish]\n  (make))\n\n(defmethod animal/get-reproduction-age ::fish [_fish]\n  config/fish-reproduction-age)\n\n(defmethod animal/move ::fish [fish loc world]\n  (animal/do-move fish loc world))\n\n(defmethod animal/reproduce ::fish [fish loc world]\n  (animal/do-reproduce fish loc world))\n\n(defmethod cell/tick ::fish [fish loc world]\n  (animal/tick fish loc world))\n\n(defmethod cell/display ::fish [_fish]\n  \"f\")\n</code></pre>"},{"location":"clojure/19-wator-simulation/#5","title":"5. \u30b5\u30e1\u306e\u5b9f\u88c5","text":""},{"location":"clojure/19-wator-simulation/#phase-9","title":"Phase 9: \u30b5\u30e1\u306e\u57fa\u672c\u69cb\u9020","text":"<pre><code>(ns wator.shark\n  (:require [wator.cell :as cell]\n            [wator.animal :as animal]\n            [wator.water :as water]\n            [wator.fish :as fish]\n            [wator.config :as config]))\n\n(defn is? [cell]\n  (= ::shark (::cell/type cell)))\n\n(defn make []\n  (merge {::cell/type ::shark\n          ::health config/shark-starting-health}\n         (animal/make)))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#phase-10","title":"Phase 10: \u30b5\u30e1\u306e\u4f53\u529b\u7ba1\u7406","text":"<pre><code>(defn health [shark]\n  (::health shark))\n\n(defn set-health [shark new-health]\n  (assoc shark ::health new-health))\n\n(defn decrement-health [shark]\n  (update shark ::health dec))\n\n(defn feed [shark]\n  (let [new-health (min config/shark-max-health\n                        (+ (health shark) config/shark-eating-health))]\n    (set-health shark new-health)))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#phase-11","title":"Phase 11: \u30b5\u30e1\u306e\u6355\u98df","text":"<pre><code>(defn find-fish-neighbors\n  \"\u96a3\u63a5\u3059\u308b\u9b5a\u3092\u691c\u7d22\"\n  [world loc]\n  (let [neighbors ((:neighbors-fn world) world loc)]\n    (filter #(fish/is? ((:get-cell-fn world) world %)) neighbors)))\n\n(defn eat\n  \"\u9b5a\u3092\u98df\u3079\u308b\"\n  [shark loc world]\n  (let [fishy-neighbors (find-fish-neighbors world loc)]\n    (if (empty? fishy-neighbors)\n      nil\n      (let [target (rand-nth fishy-neighbors)]\n        [{loc (water/make)}\n         {target (feed shark)}]))))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#phase-12","title":"Phase 12: \u30b5\u30e1\u306e\u30c6\u30a3\u30c3\u30af\u51e6\u7406","text":"<pre><code>(defmethod cell/tick ::shark [shark loc world]\n  (if (&lt;= (health shark) 1)\n    ;; \u4f53\u529b\u304c\u5c3d\u304d\u305f\u3089\u6b7b\u4ea1\n    [nil {loc (water/make)}]\n    (let [aged-shark (-&gt; shark\n                         animal/increment-age\n                         decrement-health)]\n      ;; \u512a\u5148\u9806\u4f4d: \u7e41\u6b96 &gt; \u6355\u98df &gt; \u79fb\u52d5\n      (or (animal/reproduce aged-shark loc world)\n          (eat aged-shark loc world)\n          (animal/move aged-shark loc world)))))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#6","title":"6. \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u306e\u5b9f\u884c","text":""},{"location":"clojure/19-wator-simulation/#phase-13","title":"Phase 13: \u30ef\u30fc\u30eb\u30c9\u306e\u66f4\u65b0","text":"<pre><code>(defn tick-cell\n  \"1\u3064\u306e\u30bb\u30eb\u3092\u66f4\u65b0\"\n  [world loc]\n  (let [cell (get-cell world loc)]\n    (cell/tick cell loc world)))\n\n(defn tick\n  \"\u30ef\u30fc\u30eb\u30c9\u306e1\u30b9\u30c6\u30c3\u30d7\u3092\u5b9f\u884c\"\n  [world]\n  (let [locs (shuffle (keys (:cells world)))\n        changes (map #(tick-cell world %) locs)]\n    (apply-changes world (flatten (remove nil? changes)))))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#7","title":"7. \u8a2d\u5b9a\u30d1\u30e9\u30e1\u30fc\u30bf","text":"<pre><code>(ns wator.config)\n\n;; \u9b5a\u306e\u8a2d\u5b9a\n(def fish-reproduction-age 6)\n\n;; \u30b5\u30e1\u306e\u8a2d\u5b9a\n(def shark-reproduction-age 5)\n(def shark-reproduction-health 8)\n(def shark-starting-health 5)\n(def shark-eating-health 5)\n(def shark-max-health 10)\n</code></pre> \u30d1\u30e9\u30e1\u30fc\u30bf \u8aac\u660e \u30c7\u30d5\u30a9\u30eb\u30c8\u5024 fish-reproduction-age \u9b5a\u306e\u7e41\u6b96\u53ef\u80fd\u5e74\u9f62 6 shark-reproduction-age \u30b5\u30e1\u306e\u7e41\u6b96\u53ef\u80fd\u5e74\u9f62 5 shark-starting-health \u30b5\u30e1\u306e\u521d\u671f\u4f53\u529b 5 shark-eating-health \u6355\u98df\u6642\u306e\u4f53\u529b\u56de\u5fa9\u91cf 5 shark-max-health \u30b5\u30e1\u306e\u6700\u5927\u4f53\u529b 10 shark-reproduction-health \u7e41\u6b96\u306b\u5fc5\u8981\u306a\u4f53\u529b 8"},{"location":"clojure/19-wator-simulation/#8","title":"8. \u4f7f\u7528\u4f8b","text":"<pre><code>(require '[wator.world :as world])\n(require '[wator.fish :as fish])\n(require '[wator.shark :as shark])\n\n;; 10x10 \u306e\u30ef\u30fc\u30eb\u30c9\u3092\u4f5c\u6210\n(def w (world/make 10 10))\n\n;; \u9b5a20\u5339\u3001\u30b5\u30e15\u5339\u3092\u30e9\u30f3\u30c0\u30e0\u914d\u7f6e\n(def w (world/populate-random w 20 5))\n\n;; \u7d71\u8a08\u60c5\u5831\n(world/statistics w)\n;; =&gt; {:fish 20, :sharks 5, :water 75, :total 100}\n\n;; \u30ef\u30fc\u30eb\u30c9\u3092\u8868\u793a\n(println (world/display w))\n;; ..f.......\n;; .S....f...\n;; ..f.......\n;; ...f..f...\n;; ....S.....\n;; .f........\n;; ......f...\n;; ..f...S...\n;; ....f.....\n;; .......f..\n\n;; 1\u30b9\u30c6\u30c3\u30d7\u5b9f\u884c\n(def w' (world/tick w))\n\n;; 100\u30b9\u30c6\u30c3\u30d7\u5b9f\u884c\n(def w-100 (nth (iterate world/tick w) 100))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#9","title":"9. \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u306e\u30c0\u30a4\u30ca\u30df\u30af\u30b9","text":""},{"location":"clojure/19-wator-simulation/#10-gui-quil","title":"10. GUI \u3068\u306e\u7d71\u5408\uff08Quil\uff09","text":""},{"location":"clojure/19-wator-simulation/#quil","title":"Quil \u30e9\u30a4\u30d6\u30e9\u30ea","text":"<p>Quil \u306f Processing \u3092 Clojure \u304b\u3089\u5229\u7528\u3059\u308b\u305f\u3081\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059\u3002\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u8996\u899a\u5316\u3067\u304d\u307e\u3059\u3002</p> <pre><code>(ns wator-gui.main\n  (:require [quil.core :as q]\n            [quil.middleware :as m]\n            [wator.world :as world]\n            [wator.fish :as fish]\n            [wator.shark :as shark]\n            [wator.water :as water]))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#_4","title":"\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u95a2\u6570","text":"<pre><code>(def cell-size 10)\n(def world-width 60)\n(def world-height 40)\n\n(defn setup []\n  (q/frame-rate 10)\n  (q/color-mode :rgb)\n  ;; \u521d\u671f\u30ef\u30fc\u30eb\u30c9\u3092\u4f5c\u6210\n  (-&gt; (world/make world-width world-height)\n      (world/populate-random 200 30)))\n\n(defn draw-state [world]\n  (q/background 0 100 200)  ; \u9752\u3044\u6d77\n  (doseq [[[x y] cell] (:cells world)]\n    (cond\n      (fish/is? cell)\n      (do\n        (q/fill 0 255 0)  ; \u7dd1: \u9b5a\n        (q/rect (* x cell-size) (* y cell-size) cell-size cell-size))\n\n      (shark/is? cell)\n      (do\n        (q/fill 255 0 0)  ; \u8d64: \u30b5\u30e1\n        (q/rect (* x cell-size) (* y cell-size) cell-size cell-size)))))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#_5","title":"\u66f4\u65b0\u95a2\u6570","text":"<pre><code>(defn update-state [world]\n  (world/tick world))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#_6","title":"\u30e1\u30a4\u30f3\u95a2\u6570","text":"<pre><code>(defn -main []\n  (q/defsketch wator-simulation\n    :title \"Wa-Tor Simulation\"\n    :size [(* world-width cell-size) (* world-height cell-size)]\n    :setup setup\n    :update update-state\n    :draw draw-state\n    :middleware [m/fun-mode]))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#_7","title":"\u7d71\u8a08\u60c5\u5831\u306e\u8868\u793a","text":"<pre><code>(defn draw-stats [world]\n  (let [stats (world/statistics world)]\n    (q/fill 255)\n    (q/text-size 14)\n    (q/text (str \"Fish: \" (:fish stats)) 10 20)\n    (q/text (str \"Sharks: \" (:sharks stats)) 10 40)\n    (q/text (str \"Generation: \" (:generation world 0)) 10 60)))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#_8","title":"\u30ad\u30fc\u30dc\u30fc\u30c9\u30a4\u30f3\u30bf\u30e9\u30af\u30b7\u30e7\u30f3","text":"<pre><code>(defn key-pressed [world event]\n  (case (:key event)\n    :r (-&gt; (world/make world-width world-height)\n           (world/populate-random 200 30))  ; \u30ea\u30bb\u30c3\u30c8\n    :p (assoc world :paused (not (:paused world)))  ; \u4e00\u6642\u505c\u6b62\n    :+ (update world :speed inc)  ; \u901f\u5ea6\u30a2\u30c3\u30d7\n    :- (update world :speed dec)  ; \u901f\u5ea6\u30c0\u30a6\u30f3\n    world))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#gui","title":"\u95a2\u6570\u578b GUI \u306e\u7279\u5fb4","text":"<p>Quil \u306e <code>fun-mode</code> \u306f\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u539f\u5247\u306b\u5f93\u3044\u307e\u3059\uff1a</p> <ol> <li>\u72b6\u614b\u306e\u4e0d\u5909\u6027: \u5404\u30d5\u30ec\u30fc\u30e0\u3067\u65b0\u3057\u3044\u72b6\u614b\u3092\u8fd4\u3059</li> <li>\u7d14\u7c8b\u306a\u66f4\u65b0\u95a2\u6570: \u526f\u4f5c\u7528\u306a\u3057\u3067\u72b6\u614b\u3092\u5909\u63db</li> <li>\u63cf\u753b\u3068\u72b6\u614b\u306e\u5206\u96e2: <code>update</code> \u3068 <code>draw</code> \u306f\u72ec\u7acb</li> </ol> <pre><code>;; \u72b6\u614b\u306f\u5e38\u306b\u65b0\u3057\u3044\u30de\u30c3\u30d7\u3068\u3057\u3066\u8fd4\u3055\u308c\u308b\n(defn update-state [state]\n  (if (:paused state)\n    state\n    (-&gt; state\n        (update :world world/tick)\n        (update :generation inc))))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#11","title":"11. \u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1\u306e\u7279\u5fb4","text":""},{"location":"clojure/19-wator-simulation/#_9","title":"\u4e0d\u5909\u6027","text":"<p>\u3059\u3079\u3066\u306e\u72b6\u614b\u66f4\u65b0\u306f\u65b0\u3057\u3044\u30ef\u30fc\u30eb\u30c9\u3092\u8fd4\u3057\u307e\u3059\u3002</p> <pre><code>;; \u5143\u306e\u30ef\u30fc\u30eb\u30c9\u306f\u5909\u66f4\u3055\u308c\u306a\u3044\n(def w1 (world/make 5 5))\n(def w2 (world/tick w1))\n\n;; w1 \u3068 w2 \u306f\u72ec\u7acb\n(= w1 w2) ;; =&gt; false\n</code></pre>"},{"location":"clojure/19-wator-simulation/#_10","title":"\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u62e1\u5f35\u6027","text":"<p>\u65b0\u3057\u3044\u30bb\u30eb\u30bf\u30a4\u30d7\u306e\u8ffd\u52a0\u304c\u5bb9\u6613\u3067\u3059\u3002</p> <pre><code>;; \u65b0\u3057\u3044\u30bb\u30eb\u30bf\u30a4\u30d7: \u6d77\u85fb\n(defmethod cell/tick ::seaweed\n  [seaweed loc world]\n  ;; \u6d77\u85fb\u306e\u30c6\u30a3\u30c3\u30af\u51e6\u7406\n  ...)\n\n(defmethod cell/display ::seaweed\n  [_seaweed]\n  \"~\")\n</code></pre>"},{"location":"clojure/19-wator-simulation/#_11","title":"\u30c6\u30b9\u30c8\u5bb9\u6613\u6027","text":"<p>\u7d14\u7c8b\u95a2\u6570\u3067\u3042\u308b\u305f\u3081\u3001\u30c6\u30b9\u30c8\u304c\u7c21\u5358\u3067\u3059\u3002</p> <pre><code>(describe \"\u9b5a\"\n  (it \"\u7e41\u6b96\u53ef\u80fd\u5e74\u9f62\u306b\u9054\u3057\u305f\u3089\u7e41\u6b96\u3059\u308b\"\n    (let [old-fish (-&gt; (fish/make)\n                       (animal/set-age 6))\n          world (-&gt; (world/make 3 3)\n                    (world/set-cell [1 1] old-fish))]\n      ;; \u30c6\u30b9\u30c8\u30ed\u30b8\u30c3\u30af\n      )))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#_12","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Wa-Tor \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u3092\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30bb\u30eb\u30aa\u30fc\u30c8\u30de\u30c8\u30f3: \u30b0\u30ea\u30c3\u30c9\u30d9\u30fc\u30b9\u306e\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: \u30bb\u30eb\u30bf\u30a4\u30d7\u306b\u3088\u308b\u591a\u614b\u7684\u306a\u632f\u308b\u821e\u3044</li> <li>\u30c8\u30fc\u30e9\u30b9\u578b\u30ef\u30fc\u30eb\u30c9: \u7aef\u306e\u30e9\u30c3\u30d7\u51e6\u7406</li> <li>\u6355\u98df\u8005-\u88ab\u98df\u8005\u30e2\u30c7\u30eb: \u7e41\u6b96\u3001\u6355\u98df\u3001\u9913\u6b7b\u306e\u30eb\u30fc\u30eb</li> <li>\u6bb5\u968e\u7684\u306a\u5b9f\u88c5: Phase 1-13 \u3067\u306e\u6f38\u9032\u7684\u306a\u958b\u767a</li> <li>GUI \u3068\u306e\u7d71\u5408: Quil \u306b\u3088\u308b\u8996\u899a\u5316\u3068\u95a2\u6570\u578b GUI \u30d1\u30bf\u30fc\u30f3</li> </ol>"},{"location":"clojure/19-wator-simulation/#_13","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part6/src/wator/</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part6/spec/wator/</code></li> </ul>"},{"location":"clojure/19-wator-simulation/#6_1","title":"\u7b2c6\u90e8\u306e\u307e\u3068\u3081","text":"<p>\u7b2c6\u90e8\u3067\u306f\u30015\u3064\u306e\u30b1\u30fc\u30b9\u30b9\u30bf\u30c7\u30a3\u3092\u901a\u3058\u3066\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u5b9f\u8df5\u7684\u306a\u5fdc\u7528\u3092\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ul> <li>\u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b: \u7121\u9650\u30b7\u30fc\u30b1\u30f3\u30b9\u3068\u96c6\u5408\u6f14\u7b97</li> <li>\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0: \u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30ea\u30f3\u30b0\u3068\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9</li> <li>\u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0: \u30dd\u30ea\u30b7\u30fc\u30d1\u30bf\u30fc\u30f3\u3068\u30d5\u30a9\u30fc\u30de\u30c3\u30bf\u30fc</li> <li>\u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0: \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3068\u30a4\u30d9\u30f3\u30c8\u99c6\u52d5</li> <li>Wa-Tor \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3: \u30bb\u30eb\u30aa\u30fc\u30c8\u30de\u30c8\u30f3\u3068\u591a\u614b\u6027</li> </ul> <p>\u3053\u308c\u3089\u306e\u30b1\u30fc\u30b9\u30b9\u30bf\u30c7\u30a3\u3092\u901a\u3058\u3066\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u304c\u5b9f\u4e16\u754c\u306e\u554f\u984c\u306b\u5bfe\u3057\u3066\u3069\u306e\u3088\u3046\u306b\u9069\u7528\u3067\u304d\u308b\u304b\u3092\u7406\u89e3\u3057\u307e\u3057\u305f\u3002</p>"},{"location":"clojure/20-pattern-interactions/","title":"\u7b2c20\u7ae0: \u30d1\u30bf\u30fc\u30f3\u9593\u306e\u76f8\u4e92\u4f5c\u7528","text":""},{"location":"clojure/20-pattern-interactions/#1","title":"1. \u306f\u3058\u3081\u306b","text":"<p>\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u306f\u5358\u72ec\u3067\u4f7f\u7528\u3055\u308c\u308b\u3053\u3068\u3082\u3042\u308a\u307e\u3059\u304c\u3001\u5b9f\u969b\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u306f\u8907\u6570\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u4e00\u822c\u7684\u3067\u3059\u3002\u672c\u7ae0\u3067\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u304a\u3051\u308b\u30d1\u30bf\u30fc\u30f3\u306e\u7d44\u307f\u5408\u308f\u305b\u65b9\u3068\u3001\u305d\u306e\u76f8\u4e57\u52b9\u679c\u306b\u3064\u3044\u3066\u89e3\u8aac\u3057\u307e\u3059\u3002</p>"},{"location":"clojure/20-pattern-interactions/#_1","title":"\u5b66\u7fd2\u76ee\u6a19","text":"<ul> <li>Composite \u3068 Decorator \u30d1\u30bf\u30fc\u30f3\u306e\u7d44\u307f\u5408\u308f\u305b\u3092\u7406\u89e3\u3059\u308b</li> <li>Command \u3068 Observer \u30d1\u30bf\u30fc\u30f3\u306e\u9023\u643a\u3092\u5b9f\u88c5\u3059\u308b</li> <li>\u8907\u5408\u7684\u306a\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08\u306e\u30a2\u30d7\u30ed\u30fc\u30c1\u3092\u5b66\u3076</li> </ul>"},{"location":"clojure/20-pattern-interactions/#2-composite-decorator","title":"2. Composite + Decorator \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"clojure/20-pattern-interactions/#21","title":"2.1 \u57fa\u672c\u6982\u5ff5","text":"<p>Composite \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u6728\u69cb\u9020\u3067\u8868\u73fe\u3057\u3001\u500b\u5225\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u8907\u5408\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u540c\u4e00\u8996\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002</p> <p>Decorator \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u52d5\u7684\u306b\u6a5f\u80fd\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002</p> <p>\u3053\u308c\u3089\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u3053\u3068\u3067\u3001\u8907\u5408\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u5bfe\u3057\u3066\u3082\u88c5\u98fe\u3092\u9069\u7528\u3067\u304d\u307e\u3059\u3002</p> <p></p>"},{"location":"clojure/20-pattern-interactions/#22","title":"2.2 \u57fa\u672c\u56f3\u5f62\u306e\u5b9f\u88c5","text":"<pre><code>(ns pattern-interactions.shape\n  \"\u56f3\u5f62\u306e\u57fa\u672c\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9 - Composite \u30d1\u30bf\u30fc\u30f3\u306e\u57fa\u76e4\")\n\n;; \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u56f3\u5f62\u64cd\u4f5c\n(defmulti move \"\u56f3\u5f62\u3092\u79fb\u52d5\" :type)\n(defmulti scale \"\u56f3\u5f62\u3092\u62e1\u5927/\u7e2e\u5c0f\" :type)\n(defmulti draw \"\u56f3\u5f62\u3092\u63cf\u753b\" :type)\n(defmulti area \"\u56f3\u5f62\u306e\u9762\u7a4d\u3092\u8a08\u7b97\" :type)\n\n;; \u5186\n(defn make-circle [x y radius]\n  {:type :circle :x x :y y :radius radius})\n\n(defmethod move :circle [shape dx dy]\n  (-&gt; shape\n      (update :x + dx)\n      (update :y + dy)))\n\n(defmethod scale :circle [shape factor]\n  (update shape :radius * factor))\n\n(defmethod area :circle [shape]\n  (* Math/PI (:radius shape) (:radius shape)))\n\n;; \u77e9\u5f62\n(defn make-rectangle [x y width height]\n  {:type :rectangle :x x :y y :width width :height height})\n\n(defmethod move :rectangle [shape dx dy]\n  (-&gt; shape\n      (update :x + dx)\n      (update :y + dy)))\n\n(defmethod scale :rectangle [shape factor]\n  (-&gt; shape\n      (update :width * factor)\n      (update :height * factor)))\n\n(defmethod area :rectangle [shape]\n  (* (:width shape) (:height shape)))\n</code></pre>"},{"location":"clojure/20-pattern-interactions/#23-composite","title":"2.3 Composite \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5","text":"<pre><code>(ns pattern-interactions.composite-shape\n  \"\u8907\u5408\u56f3\u5f62 - Composite \u30d1\u30bf\u30fc\u30f3\"\n  (:require [pattern-interactions.shape :as shape]))\n\n(defn make-composite\n  \"\u8907\u5408\u56f3\u5f62\u3092\u4f5c\u6210\"\n  ([] (make-composite []))\n  ([shapes] {:type :composite :shapes shapes}))\n\n(defn add-shape [composite s]\n  (update composite :shapes conj s))\n\n(defn remove-shape [composite s]\n  (update composite :shapes (fn [shapes] (remove #(= % s) shapes))))\n\n(defmethod shape/move :composite [composite dx dy]\n  (update composite :shapes\n          (fn [shapes] (mapv #(shape/move % dx dy) shapes))))\n\n(defmethod shape/scale :composite [composite factor]\n  (update composite :shapes\n          (fn [shapes] (mapv #(shape/scale % factor) shapes))))\n\n(defmethod shape/area :composite [composite]\n  (reduce + 0 (map shape/area (:shapes composite))))\n</code></pre> <p>\u30dd\u30a4\u30f3\u30c8: - <code>mapv</code> \u3092\u4f7f\u7528\u3057\u3066\u30d9\u30af\u30bf\u30fc\u3092\u8fd4\u3059\uff08\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\uff09 - \u5404\u5b50\u8981\u7d20\u306b\u5bfe\u3057\u3066\u540c\u3058\u64cd\u4f5c\u3092\u9069\u7528</p>"},{"location":"clojure/20-pattern-interactions/#24-decorator","title":"2.4 Decorator \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5","text":"<pre><code>(ns pattern-interactions.decorated-shape\n  \"\u88c5\u98fe\u4ed8\u304d\u56f3\u5f62 - Decorator \u30d1\u30bf\u30fc\u30f3\"\n  (:require [pattern-interactions.shape :as shape]))\n\n;; \u30b8\u30e3\u30fc\u30ca\u30eb\u4ed8\u304d\u56f3\u5f62\uff08\u64cd\u4f5c\u5c65\u6b74\u3092\u8a18\u9332\uff09\n(defn make-journaled [s]\n  {:type :journaled :shape s :journal []})\n\n(defn get-journal [decorated]\n  (:journal decorated))\n\n(defn- add-journal-entry [decorated operation]\n  (update decorated :journal conj\n          {:operation operation\n           :timestamp (System/currentTimeMillis)}))\n\n(defmethod shape/move :journaled [decorated dx dy]\n  (-&gt; decorated\n      (update :shape shape/move dx dy)\n      (add-journal-entry (str \"move(\" dx \", \" dy \")\"))))\n\n(defmethod shape/scale :journaled [decorated factor]\n  (-&gt; decorated\n      (update :shape shape/scale factor)\n      (add-journal-entry (str \"scale(\" factor \")\"))))\n\n;; \u8272\u4ed8\u304d\u56f3\u5f62\n(defn make-colored [s color]\n  {:type :colored :shape s :color color})\n\n(defmethod shape/move :colored [decorated dx dy]\n  (update decorated :shape shape/move dx dy))\n\n(defmethod shape/draw :colored [decorated]\n  (str \"[\" (:color decorated) \"] \" (shape/draw (:shape decorated))))\n</code></pre>"},{"location":"clojure/20-pattern-interactions/#25","title":"2.5 \u7d44\u307f\u5408\u308f\u305b\u306e\u4f8b","text":"<pre><code>;; Composite \u306b Decorator \u3092\u9069\u7528\n(let [circle (shape/make-circle 0 0 10)\n      rect (shape/make-rectangle 0 0 10 20)\n      comp (-&gt; (composite/make-composite)\n               (composite/add-shape circle)\n               (composite/add-shape rect))\n      journaled (decorated/make-journaled comp)\n      after-move (shape/move journaled 5 3)]\n  (decorated/get-journal after-move))\n;; =&gt; [{:operation \"move(5, 3)\" :timestamp ...}]\n\n;; Decorated \u306a\u56f3\u5f62\u3092 Composite \u306b\u542b\u3081\u308b\n(let [colored-circle (-&gt; (shape/make-circle 0 0 10)\n                         (decorated/make-colored \"red\"))\n      bordered-rect (-&gt; (shape/make-rectangle 0 0 10 20)\n                        (decorated/make-bordered 2))\n      comp (-&gt; (composite/make-composite)\n               (composite/add-shape colored-circle)\n               (composite/add-shape bordered-rect))]\n  (shape/draw comp))\n;; =&gt; \"Composite[\\n  [red] Circle...\\n  [Border: 2px] Rectangle...\\n]\"\n\n;; \u591a\u91cd\u30c7\u30b3\u30ec\u30fc\u30bf\n(let [circle (-&gt; (shape/make-circle 0 0 10)\n                 (decorated/make-colored \"blue\")\n                 (decorated/make-bordered 3)\n                 (decorated/make-journaled))]\n  (shape/draw circle))\n;; =&gt; \"[Journaled: 0 ops] [Border: 3px] [blue] Circle...\"\n</code></pre>"},{"location":"clojure/20-pattern-interactions/#3-command-observer","title":"3. Command + Observer \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"clojure/20-pattern-interactions/#31","title":"3.1 \u57fa\u672c\u6982\u5ff5","text":"<p>Command \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u64cd\u4f5c\u3092\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u30ab\u30d7\u30bb\u30eb\u5316\u3057\u3001Undo/Redo \u3092\u53ef\u80fd\u306b\u3057\u307e\u3059\u3002</p> <p>Observer \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u72b6\u614b\u306e\u5909\u66f4\u3092\u76e3\u8996\u8005\u306b\u901a\u77e5\u3057\u307e\u3059\u3002</p> <p>\u3053\u308c\u3089\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u3053\u3068\u3067\u3001\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u6642\u306b\u81ea\u52d5\u7684\u306b\u901a\u77e5\u3092\u884c\u3046\u30b7\u30b9\u30c6\u30e0\u3092\u69cb\u7bc9\u3067\u304d\u307e\u3059\u3002</p> <p></p>"},{"location":"clojure/20-pattern-interactions/#32-observer","title":"3.2 Observer \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5","text":"<pre><code>(ns pattern-interactions.observer\n  \"Observer \u30d1\u30bf\u30fc\u30f3 - \u30a4\u30d9\u30f3\u30c8\u901a\u77e5\u30b7\u30b9\u30c6\u30e0\")\n\n(defn make-subject []\n  (atom {:observers [] :state nil}))\n\n(defn add-observer [subject observer-fn]\n  (swap! subject update :observers conj observer-fn))\n\n(defn notify-observers [subject event]\n  (doseq [observer (:observers @subject)]\n    (observer event)))\n\n(defn set-state! [subject new-state]\n  (swap! subject assoc :state new-state)\n  (notify-observers subject {:type :state-changed\n                             :new-state new-state}))\n</code></pre>"},{"location":"clojure/20-pattern-interactions/#33-command","title":"3.3 Command \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5","text":"<pre><code>(ns pattern-interactions.command\n  \"Command \u30d1\u30bf\u30fc\u30f3 - \u64cd\u4f5c\u306e\u30ab\u30d7\u30bb\u30eb\u5316\")\n\n(defmulti execute \"\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\" :command-type)\n(defmulti undo \"\u30b3\u30de\u30f3\u30c9\u3092\u53d6\u308a\u6d88\u3057\" :command-type)\n(defmulti describe \"\u30b3\u30de\u30f3\u30c9\u306e\u8aac\u660e\" :command-type)\n\n;; \u56f3\u5f62\u8ffd\u52a0\u30b3\u30de\u30f3\u30c9\n(defn make-add-shape-command [shape]\n  {:command-type :add-shape :shape shape})\n\n(defmethod execute :add-shape [cmd]\n  (fn [canvas]\n    (update canvas :shapes conj (:shape cmd))))\n\n(defmethod undo :add-shape [cmd]\n  (fn [canvas]\n    (update canvas :shapes (fn [shapes] (vec (butlast shapes))))))\n\n;; \u56f3\u5f62\u79fb\u52d5\u30b3\u30de\u30f3\u30c9\n(defn make-move-shape-command [index dx dy]\n  {:command-type :move-shape :index index :dx dx :dy dy})\n\n(defmethod execute :move-shape [cmd]\n  (fn [canvas]\n    (update-in canvas [:shapes (:index cmd)] shape/move (:dx cmd) (:dy cmd))))\n\n(defmethod undo :move-shape [cmd]\n  (fn [canvas]\n    (update-in canvas [:shapes (:index cmd)] shape/move (- (:dx cmd)) (- (:dy cmd)))))\n\n;; \u30de\u30af\u30ed\u30b3\u30de\u30f3\u30c9\n(defn make-macro-command [commands]\n  {:command-type :macro :commands commands})\n\n(defmethod execute :macro [cmd]\n  (fn [canvas]\n    (reduce (fn [c sub-cmd] ((execute sub-cmd) c))\n            canvas\n            (:commands cmd))))\n\n(defmethod undo :macro [cmd]\n  (fn [canvas]\n    (reduce (fn [c sub-cmd] ((undo sub-cmd) c))\n            canvas\n            (reverse (:commands cmd)))))\n</code></pre>"},{"location":"clojure/20-pattern-interactions/#34-command-observer","title":"3.4 Command + Observer \u306e\u7d71\u5408","text":"<pre><code>(ns pattern-interactions.command-observer\n  \"Command + Observer \u30d1\u30bf\u30fc\u30f3\u306e\u7d71\u5408\"\n  (:require [pattern-interactions.command :as cmd]\n            [pattern-interactions.observer :as obs]))\n\n(defn make-observable-canvas []\n  {:shapes []\n   :subject (obs/make-subject)\n   :history []\n   :redo-stack []})\n\n(defn execute-command [canvas command]\n  (let [executor (cmd/execute command)\n        new-canvas (-&gt; canvas\n                       executor\n                       (update :history conj command)\n                       (assoc :redo-stack []))]\n    ;; \u30aa\u30d6\u30b6\u30fc\u30d0\u30fc\u306b\u901a\u77e5\n    (obs/notify-observers (:subject canvas)\n                          {:type :command-executed\n                           :command command\n                           :description (cmd/describe command)})\n    new-canvas))\n\n(defn undo-last [canvas]\n  (if (empty? (:history canvas))\n    canvas\n    (let [last-cmd (peek (:history canvas))\n          undoer (cmd/undo last-cmd)\n          new-canvas (-&gt; canvas\n                         undoer\n                         (update :history pop)\n                         (update :redo-stack conj last-cmd))]\n      (obs/notify-observers (:subject canvas)\n                            {:type :command-undone\n                             :command last-cmd})\n      new-canvas)))\n\n(defn redo-last [canvas]\n  (if (empty? (:redo-stack canvas))\n    canvas\n    (let [cmd-to-redo (peek (:redo-stack canvas))\n          executor (cmd/execute cmd-to-redo)\n          new-canvas (-&gt; canvas\n                         executor\n                         (update :history conj cmd-to-redo)\n                         (update :redo-stack pop))]\n      (obs/notify-observers (:subject canvas)\n                            {:type :command-redone\n                             :command cmd-to-redo})\n      new-canvas)))\n</code></pre>"},{"location":"clojure/20-pattern-interactions/#35","title":"3.5 \u4f7f\u7528\u4f8b","text":"<pre><code>;; \u30ad\u30e3\u30f3\u30d0\u30b9\u3092\u4f5c\u6210\n(def canvas (cmd-obs/make-observable-canvas))\n\n;; \u30aa\u30d6\u30b6\u30fc\u30d0\u30fc\u3092\u767b\u9332\n(def log (atom []))\n(cmd-obs/add-observer canvas\n  (fn [event]\n    (swap! log conj (str (:type event) \": \" (:description event)))))\n\n;; \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\n(def canvas1\n  (-&gt; canvas\n      (cmd-obs/execute-command\n        (cmd/make-add-shape-command (shape/make-circle 0 0 10)))\n      (cmd-obs/execute-command\n        (cmd/make-move-shape-command 0 5 3))))\n\n@log\n;; =&gt; [\":command-executed: Add shape: :circle\"\n;;     \":command-executed: Move shape[0] by (5, 3)\"]\n\n;; Undo\n(def canvas2 (cmd-obs/undo-last canvas1))\n@log\n;; =&gt; [..., \":command-undone: ...\"]\n\n;; Redo\n(def canvas3 (cmd-obs/redo-last canvas2))\n</code></pre>"},{"location":"clojure/20-pattern-interactions/#4","title":"4. \u8907\u5408\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306e\u8a2d\u8a08","text":""},{"location":"clojure/20-pattern-interactions/#41","title":"4.1 \u30d1\u30bf\u30fc\u30f3\u9078\u629e\u306e\u30ac\u30a4\u30c9\u30e9\u30a4\u30f3","text":""},{"location":"clojure/20-pattern-interactions/#42","title":"4.2 \u30d1\u30bf\u30fc\u30f3\u7d44\u307f\u5408\u308f\u305b\u306e\u30de\u30c8\u30ea\u30af\u30b9","text":"\u30d1\u30bf\u30fc\u30f3 A \u30d1\u30bf\u30fc\u30f3 B \u76f8\u4e57\u52b9\u679c Composite Decorator \u8907\u5408\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u5168\u4f53\u306b\u88c5\u98fe\u3092\u9069\u7528 Composite Visitor \u6728\u69cb\u9020\u3092\u8d70\u67fb\u3057\u3066\u5404\u8981\u7d20\u306b\u64cd\u4f5c\u3092\u9069\u7528 Command Observer \u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u3092\u76e3\u8996\u30fb\u30ed\u30b0 Command Composite \u30de\u30af\u30ed\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u73fe Strategy Decorator \u6226\u7565\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u30fb\u30ed\u30b0\u3092\u8ffd\u52a0 Factory Strategy \u751f\u6210\u6226\u7565\u306e\u5207\u308a\u66ff\u3048"},{"location":"clojure/20-pattern-interactions/#43","title":"4.3 \u95a2\u6570\u578b\u3067\u306e\u7d44\u307f\u5408\u308f\u305b\u306e\u5229\u70b9","text":"<ol> <li>\u30c7\u30fc\u30bf\u3068\u3057\u3066\u306e\u30d1\u30bf\u30fc\u30f3</li> <li>\u3059\u3079\u3066\u306e\u30d1\u30bf\u30fc\u30f3\u304c\u30c7\u30fc\u30bf\u69cb\u9020\u3068\u3057\u3066\u8868\u73fe\u3055\u308c\u308b</li> <li> <p>\u30d1\u30bf\u30fc\u30f3\u9593\u306e\u5883\u754c\u304c\u660e\u78ba</p> </li> <li> <p>\u5408\u6210\u53ef\u80fd\u6027</p> </li> <li>\u95a2\u6570\u5408\u6210\u306b\u3088\u308a\u81ea\u7136\u306b\u30d1\u30bf\u30fc\u30f3\u3092\u7d44\u307f\u5408\u308f\u305b\u53ef\u80fd</li> <li> <p>\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3067\u51e6\u7406\u3092\u9023\u7d50</p> </li> <li> <p>\u30c6\u30b9\u30c8\u5bb9\u6613\u6027</p> </li> <li>\u5404\u30d1\u30bf\u30fc\u30f3\u304c\u7d14\u7c8b\u95a2\u6570\u3067\u5b9f\u88c5</li> <li>\u7d44\u307f\u5408\u308f\u305b\u3082\u30c6\u30b9\u30c8\u3057\u3084\u3059\u3044</li> </ol>"},{"location":"clojure/20-pattern-interactions/#5","title":"5. \u30c6\u30b9\u30c8\u30b3\u30fc\u30c9","text":"<pre><code>(describe \"Composite + Decorator \u306e\u7d44\u307f\u5408\u308f\u305b\"\n  (it \"\u8907\u5408\u56f3\u5f62\u306b\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u9069\u7528\u3067\u304d\u308b\"\n    (let [circle (shape/make-circle 0 0 10)\n          rect (shape/make-rectangle 0 0 10 20)\n          comp (-&gt; (composite/make-composite)\n                   (composite/add-shape circle)\n                   (composite/add-shape rect))\n          journaled (decorated/make-journaled comp)\n          after-move (shape/move journaled 5 3)]\n      (should= 1 (count (decorated/get-journal after-move)))))\n\n  (it \"\u591a\u91cd\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u9069\u7528\u3067\u304d\u308b\"\n    (let [circle (-&gt; (shape/make-circle 0 0 10)\n                     (decorated/make-colored \"blue\")\n                     (decorated/make-bordered 3)\n                     (decorated/make-journaled))]\n      (should-contain \"[Journaled:\" (shape/draw circle))\n      (should-contain \"[Border: 3px]\" (shape/draw circle))\n      (should-contain \"[blue]\" (shape/draw circle)))))\n\n(describe \"Command + Observer \u306e\u7d71\u5408\"\n  (it \"\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u6642\u306b\u30aa\u30d6\u30b6\u30fc\u30d0\u30fc\u306b\u901a\u77e5\u3055\u308c\u308b\"\n    (let [canvas (cmd-obs/make-observable-canvas)\n          notifications (atom [])\n          observer (fn [event] (swap! notifications conj event))\n          _ (cmd-obs/add-observer canvas observer)\n          circle (shape/make-circle 0 0 10)\n          cmd (cmd/make-add-shape-command circle)\n          new-canvas (cmd-obs/execute-command canvas cmd)]\n      (should= 1 (count @notifications))\n      (should= :command-executed (:type (first @notifications)))))\n\n  (it \"Undo/Redo \u304c\u6a5f\u80fd\u3059\u308b\"\n    (let [canvas (cmd-obs/make-observable-canvas)\n          circle (shape/make-circle 0 0 10)\n          cmd (cmd/make-add-shape-command circle)\n          after-add (cmd-obs/execute-command canvas cmd)\n          after-undo (cmd-obs/undo-last after-add)\n          after-redo (cmd-obs/redo-last after-undo)]\n      (should= 1 (count (cmd-obs/get-shapes after-add)))\n      (should= 0 (count (cmd-obs/get-shapes after-undo)))\n      (should= 1 (count (cmd-obs/get-shapes after-redo))))))\n</code></pre>"},{"location":"clojure/20-pattern-interactions/#6","title":"6. \u307e\u3068\u3081","text":""},{"location":"clojure/20-pattern-interactions/#_2","title":"\u30d1\u30bf\u30fc\u30f3\u7d44\u307f\u5408\u308f\u305b\u306e\u539f\u5247","text":"<ol> <li>\u5358\u4e00\u8cac\u4efb\u3092\u7dad\u6301: \u5404\u30d1\u30bf\u30fc\u30f3\u306f\u72ec\u81ea\u306e\u8cac\u4efb\u3092\u6301\u3064</li> <li>\u758e\u7d50\u5408\u3092\u4fdd\u3064: \u30d1\u30bf\u30fc\u30f3\u9593\u306f\u660e\u78ba\u306a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u9023\u643a</li> <li>\u30c7\u30fc\u30bf\u4e2d\u5fc3: \u30d1\u30bf\u30fc\u30f3\u9593\u306e\u3084\u308a\u53d6\u308a\u306f\u30c7\u30fc\u30bf\u3067\u884c\u3046</li> <li>\u30c6\u30b9\u30c8\u53ef\u80fd\u6027: \u7d44\u307f\u5408\u308f\u305b\u3066\u3082\u500b\u5225\u306b\u30c6\u30b9\u30c8\u53ef\u80fd</li> </ol>"},{"location":"clojure/20-pattern-interactions/#_3","title":"\u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1\u306e\u5f37\u307f","text":"<ul> <li>\u900f\u904e\u7684\u306a\u5408\u6210: \u95a2\u6570\u3068\u30c7\u30fc\u30bf\u306e\u5408\u6210\u304c\u81ea\u7136</li> <li>\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb: \u72b6\u614b\u306e\u8ffd\u8de1\u304c\u5bb9\u6613</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: \u67d4\u8edf\u306a\u591a\u614b\u6027\u306e\u5b9f\u73fe</li> </ul>"},{"location":"clojure/20-pattern-interactions/#_4","title":"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7","text":"<ul> <li>\u7b2c21\u7ae0: \u95a2\u6570\u578b\u30c7\u30b6\u30a4\u30f3\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9</li> <li>\u7b2c22\u7ae0: \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u304b\u3089\u95a2\u6570\u578b\u3078\u306e\u79fb\u884c</li> </ul>"},{"location":"clojure/21-best-practices/","title":"\u7b2c21\u7ae0: \u95a2\u6570\u578b\u30c7\u30b6\u30a4\u30f3\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9","text":""},{"location":"clojure/21-best-practices/#1","title":"1. \u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u304a\u3051\u308b\u8a2d\u8a08\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3092\u4f53\u7cfb\u7684\u306b\u89e3\u8aac\u3057\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u539f\u5247\u306f\u3001\u4fdd\u5b88\u6027\u304c\u9ad8\u304f\u3001\u30c6\u30b9\u30c8\u3057\u3084\u3059\u3044\u3001\u5805\u7262\u306a\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u69cb\u7bc9\u3059\u308b\u305f\u3081\u306e\u6307\u91dd\u3068\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/21-best-practices/#_1","title":"\u5b66\u7fd2\u76ee\u6a19","text":"<ul> <li>\u30c7\u30fc\u30bf\u4e2d\u5fc3\u8a2d\u8a08\u306e\u539f\u5247\u3092\u7406\u89e3\u3059\u308b</li> <li>\u7d14\u7c8b\u95a2\u6570\u3068\u526f\u4f5c\u7528\u306e\u5206\u96e2\u65b9\u6cd5\u3092\u5b66\u3076</li> <li>\u30c6\u30b9\u30c8\u53ef\u80fd\u306a\u8a2d\u8a08\u30d1\u30bf\u30fc\u30f3\u3092\u7fd2\u5f97\u3059\u308b</li> </ul>"},{"location":"clojure/21-best-practices/#2","title":"2. \u30c7\u30fc\u30bf\u4e2d\u5fc3\u8a2d\u8a08","text":""},{"location":"clojure/21-best-practices/#21_1","title":"2.1 \u57fa\u672c\u539f\u5247","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u30c7\u30fc\u30bf\u304c\u4e3b\u5f79\u3067\u3059\u3002\u307e\u305a\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u8a2d\u8a08\u3057\u3001\u305d\u306e\u30c7\u30fc\u30bf\u3092\u5909\u63db\u3059\u308b\u95a2\u6570\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002</p> <p></p>"},{"location":"clojure/21-best-practices/#22","title":"2.2 \u30c7\u30fc\u30bf\u69cb\u9020\u306e\u5b9a\u7fa9","text":"<pre><code>(ns best-practices.data-centric)\n\n;; \u30b7\u30f3\u30d7\u30eb\u306a\u30de\u30c3\u30d7\u3067\u30c7\u30fc\u30bf\u3092\u8868\u73fe\n(defn make-user [id name email]\n  {:id id\n   :name name\n   :email email\n   :created-at (System/currentTimeMillis)})\n\n(defn make-order [id user-id items]\n  {:id id\n   :user-id user-id\n   :items items\n   :status :pending\n   :created-at (System/currentTimeMillis)})\n\n(defn make-order-item [product-id quantity price]\n  {:product-id product-id\n   :quantity quantity\n   :price price})\n</code></pre> <p>\u30dd\u30a4\u30f3\u30c8: - \u30d7\u30ec\u30fc\u30f3\u306a\u30de\u30c3\u30d7\u3092\u4f7f\u7528\uff08\u30af\u30e9\u30b9\u3067\u306f\u306a\u304f\uff09 - \u5fc5\u8981\u6700\u5c0f\u9650\u306e\u30d5\u30a3\u30fc\u30eb\u30c9 - \u660e\u78ba\u306a\u547d\u540d</p>"},{"location":"clojure/21-best-practices/#23","title":"2.3 \u5c0f\u3055\u306a\u7d14\u7c8b\u95a2\u6570","text":"<pre><code>;; \u5404\u95a2\u6570\u306f\u5358\u4e00\u306e\u8cac\u4efb\u3092\u6301\u3064\n(defn calculate-item-total [item]\n  (* (:quantity item) (:price item)))\n\n(defn calculate-order-total [order]\n  (reduce + 0 (map calculate-item-total (:items order))))\n\n(defn apply-discount [total discount-rate]\n  (* total (- 1.0 discount-rate)))\n</code></pre> <p>\u539f\u5247: - 1\u3064\u306e\u95a2\u6570\u306f1\u3064\u306e\u3053\u3068\u3092\u884c\u3046 - \u5165\u529b\u304b\u3089\u51fa\u529b\u3078\u306e\u7d14\u7c8b\u306a\u5909\u63db - \u526f\u4f5c\u7528\u306a\u3057</p>"},{"location":"clojure/21-best-practices/#24","title":"2.4 \u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3","text":"<pre><code>(defn enrich-order [order]\n  (assoc order :total (calculate-order-total order)))\n\n(defn apply-tax [order tax-rate]\n  (let [total (:total order)\n        tax (* total tax-rate)]\n    (assoc order\n           :tax tax\n           :grand-total (+ total tax))))\n\n(defn process-order [order discount-rate tax-rate]\n  (-&gt; order\n      enrich-order\n      (update :total apply-discount discount-rate)\n      (apply-tax tax-rate)\n      (assoc :status :processed)))\n</code></pre> <p>\u30b9\u30ec\u30c3\u30c9\u30de\u30af\u30ed <code>-&gt;</code> \u306e\u6d3b\u7528: - \u30c7\u30fc\u30bf\u306e\u6d41\u308c\u304c\u660e\u78ba - \u5404\u30b9\u30c6\u30c3\u30d7\u304c\u72ec\u7acb - \u30c7\u30d0\u30c3\u30b0\u3057\u3084\u3059\u3044</p>"},{"location":"clojure/21-best-practices/#25","title":"2.5 \u30c7\u30fc\u30bf\u691c\u8a3c","text":"<pre><code>(defn valid-email? [email]\n  (and (string? email)\n       (re-matches #\"^[^@]+@[^@]+\\.[^@]+$\" email)))\n\n(defn valid-user? [user]\n  (and (map? user)\n       (string? (:name user))\n       (not (empty? (:name user)))\n       (valid-email? (:email user))))\n\n(defn valid-order? [order]\n  (and (map? order)\n       (not (empty? (:items order)))\n       (every? valid-order-item? (:items order))))\n</code></pre> <p>\u691c\u8a3c\u95a2\u6570\u306e\u30d1\u30bf\u30fc\u30f3: - \u8ff0\u8a9e\u95a2\u6570\uff08<code>?</code> \u3067\u7d42\u308f\u308b\uff09\u3092\u4f7f\u7528 - \u5408\u6210\u53ef\u80fd\u306a\u5c0f\u3055\u306a\u691c\u8a3c - \u660e\u78ba\u306a\u30a8\u30e9\u30fc\u6761\u4ef6</p>"},{"location":"clojure/21-best-practices/#26","title":"2.6 \u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u306a\u66f4\u65b0","text":"<pre><code>(defn update-user-email [user new-email]\n  (if (valid-email? new-email)\n    (assoc user :email new-email :updated-at (System/currentTimeMillis))\n    user))  ;; \u7121\u52b9\u306a\u5834\u5408\u306f\u5143\u306e\u30c7\u30fc\u30bf\u3092\u8fd4\u3059\n\n(defn add-order-item [order item]\n  (if (valid-order-item? item)\n    (update order :items conj item)\n    order))\n\n(defn cancel-order [order]\n  (if (= :pending (:status order))\n    (assoc order :status :cancelled :cancelled-at (System/currentTimeMillis))\n    order))\n</code></pre> <p>\u30a4\u30df\u30e5\u30fc\u30bf\u30d3\u30ea\u30c6\u30a3\u306e\u5229\u70b9: - \u5143\u306e\u30c7\u30fc\u30bf\u306f\u5909\u66f4\u3055\u308c\u306a\u3044 - \u5c65\u6b74\u306e\u8ffd\u8de1\u304c\u5bb9\u6613 - \u4e26\u884c\u51e6\u7406\u304c\u5b89\u5168</p>"},{"location":"clojure/21-best-practices/#3","title":"3. \u7d14\u7c8b\u95a2\u6570\u3068\u526f\u4f5c\u7528\u306e\u5206\u96e2","text":""},{"location":"clojure/21-best-practices/#31","title":"3.1 \u7d14\u7c8b\u95a2\u6570\u306e\u7279\u6027","text":"<pre><code>;; \u7d14\u7c8b\u95a2\u6570\u306e\u4f8b\n(defn add [a b]\n  (+ a b))  ;; \u540c\u3058\u5165\u529b \u2192 \u540c\u3058\u51fa\u529b\n\n(defn multiply [a b]\n  (* a b))  ;; \u526f\u4f5c\u7528\u306a\u3057\n\n(defn square [x]\n  (* x x))  ;; \u53c2\u7167\u900f\u904e\u6027\n</code></pre> <p>\u7d14\u7c8b\u95a2\u6570\u306e\u6761\u4ef6: 1. \u540c\u3058\u5165\u529b\u306b\u5bfe\u3057\u3066\u5e38\u306b\u540c\u3058\u51fa\u529b 2. \u526f\u4f5c\u7528\u304c\u306a\u3044 3. \u5916\u90e8\u72b6\u614b\u306b\u4f9d\u5b58\u3057\u306a\u3044</p>"},{"location":"clojure/21-best-practices/#32","title":"3.2 \u526f\u4f5c\u7528\u306e\u5206\u96e2","text":"<pre><code>;; \u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\uff08\u7d14\u7c8b\uff09\n(defn validate-amount [amount]\n  (cond\n    (nil? amount) {:valid false :error \"Amount is required\"}\n    (&lt;= amount 0) {:valid false :error \"Amount must be positive\"}\n    :else {:valid true :amount amount}))\n\n(defn calculate-fee [amount fee-rate]\n  (* amount fee-rate))\n\n(defn calculate-total [amount fee]\n  (+ amount fee))\n\n;; \u526f\u4f5c\u7528\u3092\u542b\u3080\u51e6\u7406\uff08\u5883\u754c\uff09\n(defn process-payment! [amount fee-rate side-effect-fn]\n  (let [validation (validate-amount amount)]\n    (if (:valid validation)\n      (let [fee (calculate-fee amount fee-rate)\n            total (calculate-total amount fee)\n            result {:amount amount :fee fee :total total :status :success}]\n        ;; \u526f\u4f5c\u7528\u306f\u6700\u5f8c\u306b\u5b9f\u884c\n        (side-effect-fn result)\n        result)\n      {:status :error :error (:error validation)})))\n</code></pre>"},{"location":"clojure/21-best-practices/#33","title":"3.3 \u9ad8\u968e\u95a2\u6570\u306b\u3088\u308b\u30c7\u30b3\u30ec\u30fc\u30b7\u30e7\u30f3","text":"<pre><code>(defn with-logging [f logger]\n  \"\u30ed\u30ae\u30f3\u30b0\u6a5f\u80fd\u3092\u8ffd\u52a0\u3059\u308b\u30c7\u30b3\u30ec\u30fc\u30bf\"\n  (fn [&amp; args]\n    (logger (str \"Calling with args: \" args))\n    (let [result (apply f args)]\n      (logger (str \"Result: \" result))\n      result)))\n\n;; \u4f7f\u7528\u4f8b\n(def logged-add (with-logging add println))\n(logged-add 2 3)\n;; Calling with args: (2 3)\n;; Result: 5\n;; =&gt; 5\n</code></pre>"},{"location":"clojure/21-best-practices/#34","title":"3.4 \u95a2\u6570\u5408\u6210","text":"<pre><code>(defn pipeline [&amp; fns]\n  \"\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u5f62\u5f0f\u306e\u95a2\u6570\u5408\u6210\"\n  (fn [x]\n    (reduce (fn [acc f] (f acc)) x fns)))\n\n(def process-number\n  (pipeline\n   #(+ % 1)      ;; 1\u3092\u52a0\u7b97\n   #(* % 2)      ;; 2\u500d\n   #(- % 3)))    ;; 3\u3092\u6e1b\u7b97\n\n(process-number 5)  ;; =&gt; (5+1)*2-3 = 9\n</code></pre>"},{"location":"clojure/21-best-practices/#35","title":"3.5 \u30e1\u30e2\u5316","text":"<pre><code>(defn memoize-fn [f]\n  \"\u53c2\u7167\u900f\u904e\u6027\u3092\u6d3b\u7528\u3057\u305f\u30ad\u30e3\u30c3\u30b7\u30f3\u30b0\"\n  (let [cache (atom {})]\n    (fn [&amp; args]\n      (if-let [cached (get @cache args)]\n        cached\n        (let [result (apply f args)]\n          (swap! cache assoc args result)\n          result)))))\n\n;; \u30d5\u30a3\u30dc\u30ca\u30c3\u30c1\uff08\u30e1\u30e2\u5316\u7248\uff09\n(def fib-memo\n  (memoize-fn\n   (fn [n]\n     (if (&lt;= n 1)\n       n\n       (+ (fib-memo (- n 1))\n          (fib-memo (- n 2)))))))\n</code></pre>"},{"location":"clojure/21-best-practices/#4","title":"4. \u30c6\u30b9\u30c8\u53ef\u80fd\u306a\u8a2d\u8a08","text":""},{"location":"clojure/21-best-practices/#41","title":"4.1 \u4f9d\u5b58\u6027\u6ce8\u5165","text":"<pre><code>;; \u4f9d\u5b58\u6027\u3092\u95a2\u6570\u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u3057\u3066\u6ce8\u5165\n(defn get-user [repository id]\n  ((:find-by-id repository) id))\n\n(defn save-user [repository user]\n  ((:save repository) user))\n\n;; \u30c6\u30b9\u30c8\u7528\u30e2\u30c3\u30af\u30ea\u30dd\u30b8\u30c8\u30ea\n(defn make-mock-repository [initial-data]\n  (let [data (atom initial-data)]\n    {:find-by-id (fn [id]\n                   (first (filter #(= (:id %) id) @data)))\n     :find-all (fn [] @data)\n     :save (fn [entity]\n             (swap! data conj entity)\n             entity)\n     :delete (fn [id]\n               (swap! data (fn [d] (remove #(= (:id %) id) d))))}))\n</code></pre>"},{"location":"clojure/21-best-practices/#42","title":"4.2 \u6642\u9593\u306e\u62bd\u8c61\u5316","text":"<pre><code>;; \u6642\u9593\u3092\u6ce8\u5165\u53ef\u80fd\u306b\u3059\u308b\n(defn create-order [items now-fn]\n  {:items items :created-at (now-fn)})\n\n(defn is-expired? [order now-fn expiry-duration-ms]\n  (let [age (- (now-fn) (:created-at order))]\n    (&gt; age expiry-duration-ms)))\n\n;; \u30c6\u30b9\u30c8\u7528\u306e\u56fa\u5b9a\u6642\u523b\u95a2\u6570\n(defn make-fixed-clock [fixed-time]\n  (fn [] fixed-time))\n\n;; \u30c6\u30b9\u30c8\n(let [clock (make-fixed-clock 1000)\n      order (create-order [{:item \"A\"}] clock)\n      later-clock (make-fixed-clock 2000)]\n  (is-expired? order later-clock 500))  ;; =&gt; true\n</code></pre>"},{"location":"clojure/21-best-practices/#43","title":"4.3 \u30e9\u30f3\u30c0\u30e0\u6027\u306e\u62bd\u8c61\u5316","text":"<pre><code>(defn create-entity [data id-gen-fn now-fn]\n  (assoc data\n         :id (id-gen-fn)\n         :created-at (now-fn)))\n\n;; \u30c6\u30b9\u30c8\u7528\u30b7\u30fc\u30b1\u30f3\u30b7\u30e3\u30ebID\u751f\u6210\u5668\n(defn make-sequential-id-gen []\n  (let [counter (atom 0)]\n    (fn []\n      (swap! counter inc)\n      (str \"id-\" @counter))))\n\n;; \u30c6\u30b9\u30c8\n(let [id-gen (make-sequential-id-gen)\n      clock (make-fixed-clock 1000)]\n  (create-entity {:name \"Test\"} id-gen clock))\n;; =&gt; {:name \"Test\" :id \"id-1\" :created-at 1000}\n</code></pre>"},{"location":"clojure/21-best-practices/#44","title":"4.4 \u8a2d\u5b9a\u306e\u5206\u96e2","text":"<pre><code>(defn make-config [&amp; {:keys [tax-rate discount-rate currency]\n                      :or {tax-rate 0.1 discount-rate 0.0 currency \"JPY\"}}]\n  {:tax-rate tax-rate\n   :discount-rate discount-rate\n   :currency currency})\n\n(defn calculate-price [config base-price]\n  (let [discounted (* base-price (- 1.0 (:discount-rate config)))\n        with-tax (* discounted (+ 1.0 (:tax-rate config)))]\n    {:base-price base-price\n     :discounted discounted\n     :tax (* discounted (:tax-rate config))\n     :total with-tax\n     :currency (:currency config)}))\n\n;; \u30c6\u30b9\u30c8\n(let [config (make-config :tax-rate 0.08 :discount-rate 0.1)]\n  (calculate-price config 1000))\n;; =&gt; {:base-price 1000, :discounted 900.0, :tax 72.0, :total 972.0, ...}\n</code></pre>"},{"location":"clojure/21-best-practices/#45","title":"4.5 \u691c\u8a3c\u306e\u5206\u96e2","text":"<pre><code>(defn validate-input [input validations]\n  (let [errors (keep (fn [[field validation]]\n                       (let [value (get input field)]\n                         (when-not (validation value)\n                           field)))\n                     validations)]\n    (if (empty? errors)\n      {:valid true :data input}\n      {:valid false :errors errors})))\n\n(def user-validations\n  {:name (fn [v] (and (string? v) (not (empty? v))))\n   :email (fn [v] (and (string? v) (re-matches #\"^[^@]+@[^@]+\\.[^@]+$\" v)))\n   :age (fn [v] (and (number? v) (&gt;= v 0)))})\n\n;; \u4f7f\u7528\u4f8b\n(validate-input {:name \"John\" :email \"john@example.com\" :age 30}\n                user-validations)\n;; =&gt; {:valid true :data {...}}\n\n(validate-input {:name \"\" :email \"invalid\" :age -1}\n                user-validations)\n;; =&gt; {:valid false :errors (:name :email :age)}\n</code></pre>"},{"location":"clojure/21-best-practices/#46","title":"4.6 \u30d7\u30ed\u30c8\u30b3\u30eb\u306b\u3088\u308b\u30e2\u30c3\u30af","text":"<pre><code>(defprotocol Notifier\n  (send-notification [this recipient message]))\n\n;; \u672c\u756a\u7528\u5b9f\u88c5\n(defrecord EmailNotifier [smtp-config]\n  Notifier\n  (send-notification [_ recipient message]\n    ;; \u5b9f\u969b\u306e\u30e1\u30fc\u30eb\u9001\u4fe1\n    {:sent true :recipient recipient}))\n\n;; \u30c6\u30b9\u30c8\u7528\u5b9f\u88c5\n(defrecord MockNotifier [sent-messages]\n  Notifier\n  (send-notification [_ recipient message]\n    (swap! sent-messages conj {:recipient recipient :message message})\n    {:sent true :recipient recipient}))\n\n(defn make-mock-notifier []\n  (-&gt;MockNotifier (atom [])))\n\n(defn get-sent-messages [mock-notifier]\n  @(:sent-messages mock-notifier))\n</code></pre>"},{"location":"clojure/21-best-practices/#5","title":"5. \u30c6\u30b9\u30c8\u30b3\u30fc\u30c9","text":"<pre><code>(describe \"\u30c7\u30fc\u30bf\u4e2d\u5fc3\u8a2d\u8a08\"\n  (it \"\u6ce8\u6587\u306e\u5408\u8a08\u3092\u8a08\u7b97\u3067\u304d\u308b\"\n    (let [items [(make-order-item \"p1\" 2 100)\n                 (make-order-item \"p2\" 1 200)]\n          order (make-order \"o1\" \"u1\" items)]\n      (should= 400 (calculate-order-total order))))\n\n  (it \"\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u306a\u66f4\u65b0\u304c\u3067\u304d\u308b\"\n    (let [user (make-user \"u1\" \"John\" \"john@example.com\")\n          updated (update-user-email user \"new@example.com\")]\n      (should= \"new@example.com\" (:email updated))\n      (should= \"john@example.com\" (:email user)))))\n\n(describe \"\u30c6\u30b9\u30c8\u53ef\u80fd\u306a\u8a2d\u8a08\"\n  (it \"\u30e2\u30c3\u30af\u30ea\u30dd\u30b8\u30c8\u30ea\u3067\u30c6\u30b9\u30c8\u3067\u304d\u308b\"\n    (let [repo (make-mock-repository [{:id \"u1\" :name \"John\"}])\n          user (get-user repo \"u1\")]\n      (should= \"John\" (:name user))))\n\n  (it \"\u56fa\u5b9a\u6642\u523b\u3067\u30c6\u30b9\u30c8\u3067\u304d\u308b\"\n    (let [clock (make-fixed-clock 1000)\n          order (create-order [{:item \"A\"}] clock)]\n      (should= 1000 (:created-at order)))))\n</code></pre>"},{"location":"clojure/21-best-practices/#6","title":"6. \u307e\u3068\u3081","text":""},{"location":"clojure/21-best-practices/#_2","title":"\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u306e\u8981\u7d04","text":"\u30ab\u30c6\u30b4\u30ea \u30d7\u30e9\u30af\u30c6\u30a3\u30b9 \u52b9\u679c \u30c7\u30fc\u30bf\u8a2d\u8a08 \u30b7\u30f3\u30d7\u30eb\u306a\u30de\u30c3\u30d7\u3092\u4f7f\u7528 \u67d4\u8edf\u6027\u3001\u6c4e\u7528\u6027 \u95a2\u6570\u8a2d\u8a08 \u5c0f\u3055\u306a\u7d14\u7c8b\u95a2\u6570 \u30c6\u30b9\u30c8\u5bb9\u6613\u6027\u3001\u518d\u5229\u7528\u6027 \u526f\u4f5c\u7528 \u5883\u754c\u306b\u62bc\u3057\u51fa\u3059 \u4e88\u6e2c\u53ef\u80fd\u6027\u3001\u4fdd\u5b88\u6027 \u4f9d\u5b58\u6027 \u6ce8\u5165\u30d1\u30bf\u30fc\u30f3 \u30c6\u30b9\u30c8\u5bb9\u6613\u6027\u3001\u758e\u7d50\u5408 \u691c\u8a3c \u5ba3\u8a00\u7684\u306a\u691c\u8a3c\u30eb\u30fc\u30eb \u660e\u78ba\u6027\u3001\u62e1\u5f35\u6027"},{"location":"clojure/21-best-practices/#_3","title":"\u5b9f\u8df5\u306e\u30dd\u30a4\u30f3\u30c8","text":"<ol> <li>\u30c7\u30fc\u30bf\u30d5\u30a1\u30fc\u30b9\u30c8: \u307e\u305a\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u8a2d\u8a08</li> <li>\u5c0f\u3055\u306a\u95a2\u6570: 1\u95a2\u65701\u8cac\u4efb</li> <li>\u7d14\u7c8b\u6027\u3092\u512a\u5148: \u526f\u4f5c\u7528\u306f\u6700\u5f8c\u306b</li> <li>\u30c6\u30b9\u30c8\u3092\u8003\u616e: \u4f9d\u5b58\u6027\u306f\u6ce8\u5165\u53ef\u80fd\u306b</li> <li>\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3: \u30c7\u30fc\u30bf\u306e\u6d41\u308c\u3092\u660e\u78ba\u306b</li> </ol>"},{"location":"clojure/21-best-practices/#_4","title":"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7","text":"<ul> <li>\u7b2c22\u7ae0: \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u304b\u3089\u95a2\u6570\u578b\u3078\u306e\u79fb\u884c</li> </ul>"},{"location":"clojure/22-oo-to-fp-migration/","title":"\u7b2c22\u7ae0: \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u304b\u3089\u95a2\u6570\u578b\u3078\u306e\u79fb\u884c","text":""},{"location":"clojure/22-oo-to-fp-migration/#1","title":"1. \u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\uff08OO\uff09\u30b9\u30bf\u30a4\u30eb\u306e\u30b3\u30fc\u30c9\u3092\u95a2\u6570\u578b\uff08FP\uff09\u30b9\u30bf\u30a4\u30eb\u306b\u79fb\u884c\u3059\u308b\u305f\u3081\u306e\u6226\u7565\u3068\u30c6\u30af\u30cb\u30c3\u30af\u3092\u89e3\u8aac\u3057\u307e\u3059\u3002\u6bb5\u968e\u7684\u306a\u30a2\u30d7\u30ed\u30fc\u30c1\u306b\u3088\u308a\u3001\u65e2\u5b58\u306e\u30b3\u30fc\u30c9\u30d9\u30fc\u30b9\u3092\u5b89\u5168\u306b\u95a2\u6570\u578b\u306b\u79fb\u884c\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"clojure/22-oo-to-fp-migration/#_1","title":"\u5b66\u7fd2\u76ee\u6a19","text":"<ul> <li>OO \u3068 FP \u306e\u6839\u672c\u7684\u306a\u9055\u3044\u3092\u7406\u89e3\u3059\u308b</li> <li>\u6bb5\u968e\u7684\u306a\u79fb\u884c\u6226\u7565\u3092\u5b66\u3076</li> <li>\u5b9f\u8df5\u7684\u306a\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u30d1\u30bf\u30fc\u30f3\u3092\u7fd2\u5f97\u3059\u308b</li> </ul>"},{"location":"clojure/22-oo-to-fp-migration/#2-oo-fp","title":"2. OO \u3068 FP \u306e\u5bfe\u6bd4","text":""},{"location":"clojure/22-oo-to-fp-migration/#21","title":"2.1 \u30d1\u30e9\u30c0\u30a4\u30e0\u306e\u9055\u3044","text":"\u6982\u5ff5 \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411 \u95a2\u6570\u578b \u57fa\u672c\u5358\u4f4d \u30aa\u30d6\u30b8\u30a7\u30af\u30c8 \u30c7\u30fc\u30bf + \u95a2\u6570 \u72b6\u614b\u7ba1\u7406 \u53ef\u5909\uff08mutable\uff09 \u4e0d\u5909\uff08immutable\uff09 \u591a\u614b\u6027 \u7d99\u627f\u30fb\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9 \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u30fb\u30d7\u30ed\u30c8\u30b3\u30eb \u30b3\u30fc\u30c9\u518d\u5229\u7528 \u7d99\u627f \u95a2\u6570\u5408\u6210 \u526f\u4f5c\u7528 \u3069\u3053\u3067\u3082\u53ef\u80fd \u5883\u754c\u306b\u5206\u96e2"},{"location":"clojure/22-oo-to-fp-migration/#22-oo","title":"2.2 OO \u30b9\u30bf\u30a4\u30eb\u306e\u4f8b","text":"<pre><code>(ns oo-to-fp.oo-style)\n\n;; OO\u30b9\u30bf\u30a4\u30eb: \u5185\u90e8\u72b6\u614b\u3092\u6301\u3064\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\n(defn make-account-oo [id initial-balance]\n  (let [state (atom {:id id\n                     :balance initial-balance\n                     :transactions []})]\n    {:get-id (fn [] (:id @state))\n     :get-balance (fn [] (:balance @state))\n     :deposit (fn [amount]\n                (when (pos? amount)\n                  (swap! state update :balance + amount)\n                  (swap! state update :transactions conj\n                         {:type :deposit :amount amount})\n                  (:balance @state)))\n     :withdraw (fn [amount]\n                 (when (and (pos? amount)\n                            (&gt;= (:balance @state) amount))\n                   (swap! state update :balance - amount)\n                   (swap! state update :transactions conj\n                          {:type :withdrawal :amount amount})\n                   (:balance @state)))}))\n\n;; \u4f7f\u7528\u4f8b\n;; (def acc (make-account-oo \"A001\" 1000))\n;; ((:deposit acc) 500)   ;; =&gt; 1500\n;; ((:withdraw acc) 200)  ;; =&gt; 1300\n</code></pre> <p>\u554f\u984c\u70b9: - \u5185\u90e8\u72b6\u614b\u304c\u53ef\u5909 - \u30c6\u30b9\u30c8\u304c\u56f0\u96e3\uff08\u72b6\u614b\u306b\u4f9d\u5b58\uff09 - \u5c65\u6b74\u306e\u8ffd\u8de1\u304c\u96e3\u3057\u3044</p>"},{"location":"clojure/22-oo-to-fp-migration/#23-fp","title":"2.3 FP \u30b9\u30bf\u30a4\u30eb\u3078\u306e\u5909\u63db","text":"<pre><code>(ns oo-to-fp.fp-style)\n\n;; FP\u30b9\u30bf\u30a4\u30eb: \u30d7\u30ec\u30fc\u30f3\u306a\u30c7\u30fc\u30bf + \u7d14\u7c8b\u95a2\u6570\n(defn make-account [id initial-balance]\n  {:id id\n   :balance initial-balance\n   :transactions []})\n\n(defn get-balance [account]\n  (:balance account))\n\n(defn deposit [account amount]\n  (if (pos? amount)\n    (-&gt; account\n        (update :balance + amount)\n        (update :transactions conj {:type :deposit :amount amount}))\n    account))\n\n(defn withdraw [account amount]\n  (if (and (pos? amount)\n           (&gt;= (:balance account) amount))\n    (-&gt; account\n        (update :balance - amount)\n        (update :transactions conj {:type :withdrawal :amount amount}))\n    account))\n\n;; \u4f7f\u7528\u4f8b\n;; (def acc (make-account \"A001\" 1000))\n;; (def acc2 (deposit acc 500))   ;; acc \u306f\u5909\u66f4\u3055\u308c\u306a\u3044\n;; (def acc3 (withdraw acc2 200)) ;; acc2 \u3082\u5909\u66f4\u3055\u308c\u306a\u3044\n</code></pre> <p>\u5229\u70b9: - \u5143\u306e\u30c7\u30fc\u30bf\u306f\u4e0d\u5909 - \u30c6\u30b9\u30c8\u304c\u5bb9\u6613\uff08\u5165\u529b \u2192 \u51fa\u529b\uff09 - \u5b8c\u5168\u306a\u5c65\u6b74\u3092\u4fdd\u6301</p>"},{"location":"clojure/22-oo-to-fp-migration/#3","title":"3. \u79fb\u884c\u6226\u7565","text":""},{"location":"clojure/22-oo-to-fp-migration/#31-strangler-fig","title":"3.1 Strangler Fig \u30d1\u30bf\u30fc\u30f3","text":"<p>\u53e4\u3044\u30b3\u30fc\u30c9\u3092\u5f90\u3005\u306b\u65b0\u3057\u3044\u30b3\u30fc\u30c9\u3067\u300c\u7d5e\u3081\u6bba\u3059\u300d\u30d1\u30bf\u30fc\u30f3\u3002</p> <p></p> <pre><code>(defn create-account-strangler [id initial-balance use-fp?]\n  (if use-fp?\n    ;; \u65b0\u3057\u3044FP\u30b9\u30bf\u30a4\u30eb\n    {:style :fp\n     :data (fp/make-account id initial-balance)}\n    ;; \u53e4\u3044OO\u30b9\u30bf\u30a4\u30eb\uff08\u4e92\u63db\u6027\u306e\u305f\u3081\uff09\n    {:style :oo\n     :data {:id id :balance initial-balance :transactions []}}))\n\n(defn account-deposit [account amount]\n  (if (= :fp (:style account))\n    (update account :data fp/deposit amount)\n    ;; OO\u30b9\u30bf\u30a4\u30eb\u3082\u540c\u3058\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u51e6\u7406\n    (update account :data\n            (fn [data]\n              (-&gt; data\n                  (update :balance + amount)\n                  (update :transactions conj {:type :deposit :amount amount}))))))\n</code></pre>"},{"location":"clojure/22-oo-to-fp-migration/#32","title":"3.2 \u30a2\u30c0\u30d7\u30bf\u30fc\u30d1\u30bf\u30fc\u30f3","text":"<p>\u53e4\u3044\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u7dad\u6301\u3057\u306a\u304c\u3089\u3001\u5185\u90e8\u5b9f\u88c5\u3092 FP \u306b\u79fb\u884c\u3002</p> <pre><code>(defprotocol AccountOperations\n  (get-account-balance [this])\n  (deposit-to-account [this amount])\n  (withdraw-from-account [this amount]))\n\n;; FP\u30b9\u30bf\u30a4\u30eb\u306e\u30a2\u30c0\u30d7\u30bf\u30fc\n(defrecord FPAccountAdapter [account-atom]\n  AccountOperations\n  (get-account-balance [_]\n    (:balance @account-atom))\n  (deposit-to-account [_ amount]\n    (swap! account-atom fp/deposit amount)\n    (:balance @account-atom))\n  (withdraw-from-account [_ amount]\n    (swap! account-atom fp/withdraw amount)\n    (:balance @account-atom)))\n\n(defn make-fp-account-adapter [id initial-balance]\n  (-&gt;FPAccountAdapter (atom (fp/make-account id initial-balance))))\n</code></pre> <p>\u4f7f\u7528\u4f8b: <pre><code>(let [adapter (make-fp-account-adapter \"A001\" 1000)]\n  (deposit-to-account adapter 500)\n  (get-account-balance adapter))  ;; =&gt; 1500\n</code></pre></p>"},{"location":"clojure/22-oo-to-fp-migration/#33","title":"3.3 \u30a4\u30d9\u30f3\u30c8\u30bd\u30fc\u30b7\u30f3\u30b0\u79fb\u884c","text":"<p>\u72b6\u614b\u3092\u30a4\u30d9\u30f3\u30c8\u306e\u5c65\u6b74\u3068\u3057\u3066\u8868\u73fe\u3002</p> <pre><code>(defn account-event [event-type data]\n  {:event-type event-type\n   :data data\n   :timestamp (System/currentTimeMillis)})\n\n(defn apply-event [account event]\n  (case (:event-type event)\n    :created (merge account (:data event))\n    :deposited (fp/deposit account (:amount (:data event)))\n    :withdrawn (fp/withdraw account (:amount (:data event)))\n    account))\n\n(defn replay-events [events]\n  (reduce apply-event {} events))\n\n;; \u65e2\u5b58\u30c7\u30fc\u30bf\u304b\u3089\u30a4\u30d9\u30f3\u30c8\u3078\u306e\u5909\u63db\n(defn migrate-to-event-sourcing [account]\n  (let [creation-event (account-event :created\n                                      {:id (:id account)\n                                       :balance 0\n                                       :transactions []})\n        transaction-events (map (fn [tx]\n                                  (account-event\n                                   (if (= :deposit (:type tx))\n                                     :deposited\n                                     :withdrawn)\n                                   tx))\n                                (:transactions account))]\n    (cons creation-event transaction-events)))\n</code></pre> <p>\u5229\u70b9: - \u5b8c\u5168\u306a\u76e3\u67fb\u8a3c\u8de1 - \u4efb\u610f\u306e\u6642\u70b9\u306e\u72b6\u614b\u3092\u518d\u69cb\u7bc9\u53ef\u80fd - \u30c7\u30d0\u30c3\u30b0\u304c\u5bb9\u6613</p>"},{"location":"clojure/22-oo-to-fp-migration/#34","title":"3.4 \u6bb5\u968e\u7684\u306a\u95a2\u6570\u62bd\u51fa","text":"<p>\u526f\u4f5c\u7528\u3092\u542b\u3080\u30b3\u30fc\u30c9\u304b\u3089\u7d14\u7c8b\u30ed\u30b8\u30c3\u30af\u3092\u6bb5\u968e\u7684\u306b\u62bd\u51fa\u3002</p> <p></p> <pre><code>;; Step 1: \u8a08\u7b97\u30ed\u30b8\u30c3\u30af\u3092\u7d14\u7c8b\u95a2\u6570\u306b\u62bd\u51fa\n(defn calculate-interest [balance rate days]\n  (* balance rate (/ days 365.0)))\n\n(defn calculate-fee [balance fee-structure]\n  (cond\n    (&lt; balance (:minimum-balance fee-structure))\n    (:low-balance-fee fee-structure)\n\n    (&gt; balance (:premium-threshold fee-structure))\n    0\n\n    :else\n    (:standard-fee fee-structure)))\n\n;; Step 2: \u696d\u52d9\u30eb\u30fc\u30eb\u3092\u7d14\u7c8b\u95a2\u6570\u3068\u3057\u3066\u8868\u73fe\n(defn can-withdraw? [account amount overdraft-limit]\n  (&gt;= (+ (:balance account) overdraft-limit) amount))\n\n(defn calculate-new-balance [current-balance operation amount]\n  (case operation\n    :deposit (+ current-balance amount)\n    :withdraw (- current-balance amount)\n    current-balance))\n\n;; Step 3: \u526f\u4f5c\u7528\u3092\u5883\u754c\u306b\u62bc\u3057\u51fa\u3059\n(defn process-transaction [account operation amount rules]\n  (let [{:keys [overdraft-limit]} rules\n        can-process? (case operation\n                       :deposit true\n                       :withdraw (can-withdraw? account amount overdraft-limit))]\n    (if can-process?\n      {:success true\n       :account (-&gt; account\n                    (update :balance calculate-new-balance operation amount)\n                    (update :transactions conj {:type operation :amount amount}))}\n      {:success false\n       :account account\n       :error \"Insufficient funds\"})))\n</code></pre>"},{"location":"clojure/22-oo-to-fp-migration/#4","title":"4. \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u591a\u614b\u6027","text":""},{"location":"clojure/22-oo-to-fp-migration/#41","title":"4.1 \u7d99\u627f\u304b\u3089\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u3078","text":"<pre><code>;; FP\u30b9\u30bf\u30a4\u30eb: \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u3067\u591a\u614b\u6027\u3092\u5b9f\u73fe\n(defn make-circle [x y radius]\n  {:type :circle :x x :y y :radius radius})\n\n(defn make-rectangle [x y width height]\n  {:type :rectangle :x x :y y :width width :height height})\n\n(defmulti area :type)\n\n(defmethod area :circle [shape]\n  (* Math/PI (:radius shape) (:radius shape)))\n\n(defmethod area :rectangle [shape]\n  (* (:width shape) (:height shape)))\n\n(defmulti scale :type)\n\n(defmethod scale :circle [shape factor]\n  (update shape :radius * factor))\n\n(defmethod scale :rectangle [shape factor]\n  (-&gt; shape\n      (update :width * factor)\n      (update :height * factor)))\n</code></pre>"},{"location":"clojure/22-oo-to-fp-migration/#42","title":"4.2 \u5171\u901a\u64cd\u4f5c\u306e\u5b9f\u88c5","text":"<pre><code>;; \u578b\u306b\u4f9d\u5b58\u3057\u306a\u3044\u5171\u901a\u64cd\u4f5c\n(defn move [shape dx dy]\n  (-&gt; shape\n      (update :x + dx)\n      (update :y + dy)))\n\n;; \u3059\u3079\u3066\u306e\u56f3\u5f62\u3067\u4f7f\u7528\u53ef\u80fd\n(move (make-circle 0 0 10) 5 3)\n;; =&gt; {:type :circle :x 5 :y 3 :radius 10}\n\n(move (make-rectangle 0 0 10 20) 5 3)\n;; =&gt; {:type :rectangle :x 5 :y 3 :width 10 :height 20}\n</code></pre>"},{"location":"clojure/22-oo-to-fp-migration/#5","title":"5. \u30a4\u30d9\u30f3\u30c8\u99c6\u52d5\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3","text":""},{"location":"clojure/22-oo-to-fp-migration/#51-fp","title":"5.1 FP \u30b9\u30bf\u30a4\u30eb\u306e\u30a4\u30d9\u30f3\u30c8\u30b7\u30b9\u30c6\u30e0","text":"<pre><code>(defn make-event-system []\n  {:handlers {}\n   :event-log []})\n\n(defn subscribe [system event-type handler]\n  (update-in system [:handlers event-type]\n             (fnil conj []) handler))\n\n(defn publish [system event-type data]\n  (let [handlers (get-in system [:handlers event-type] [])\n        event {:type event-type :data data}\n        results (mapv #(% event) handlers)]\n    {:system (update system :event-log conj event)\n     :results results}))\n\n(defn get-event-log [system]\n  (:event-log system))\n</code></pre> <p>\u4f7f\u7528\u4f8b: <pre><code>(let [system (-&gt; (make-event-system)\n                 (subscribe :user-created\n                            (fn [e] (println \"User created:\" (:data e))))\n                 (subscribe :user-created\n                            (fn [e] (str \"Welcome, \" (:name (:data e))))))]\n  (publish system :user-created {:name \"John\" :email \"john@example.com\"}))\n</code></pre></p>"},{"location":"clojure/22-oo-to-fp-migration/#6","title":"6. \u79fb\u884c\u306e\u30c1\u30a7\u30c3\u30af\u30ea\u30b9\u30c8","text":""},{"location":"clojure/22-oo-to-fp-migration/#61","title":"6.1 \u6e96\u5099\u30d5\u30a7\u30fc\u30ba","text":"<ul> <li> \u73fe\u5728\u306e\u30b3\u30fc\u30c9\u306e\u72b6\u614b\u3092\u628a\u63e1</li> <li> \u30c6\u30b9\u30c8\u30ab\u30d0\u30ec\u30c3\u30b8\u3092\u78ba\u8a8d</li> <li> \u79fb\u884c\u306e\u512a\u5148\u9806\u4f4d\u3092\u6c7a\u5b9a</li> <li> \u30c1\u30fc\u30e0\u3078\u306e\u6559\u80b2</li> </ul>"},{"location":"clojure/22-oo-to-fp-migration/#62","title":"6.2 \u5b9f\u884c\u30d5\u30a7\u30fc\u30ba","text":"<ul> <li> \u7d14\u7c8b\u95a2\u6570\u3092\u62bd\u51fa</li> <li> \u526f\u4f5c\u7528\u3092\u5206\u96e2</li> <li> \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u79fb\u884c</li> <li> \u30c6\u30b9\u30c8\u3092\u8ffd\u52a0</li> </ul>"},{"location":"clojure/22-oo-to-fp-migration/#63","title":"6.3 \u5b8c\u4e86\u30d5\u30a7\u30fc\u30ba","text":"<ul> <li> \u53e4\u3044\u30b3\u30fc\u30c9\u3092\u524a\u9664</li> <li> \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u66f4\u65b0</li> <li> \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3092\u78ba\u8a8d</li> <li> \u30c1\u30fc\u30e0\u30ec\u30d3\u30e5\u30fc</li> </ul>"},{"location":"clojure/22-oo-to-fp-migration/#7","title":"7. \u30c6\u30b9\u30c8\u30b3\u30fc\u30c9","text":"<pre><code>(describe \"OO \u304b\u3089 FP \u3078\u306e\u79fb\u884c\"\n\n  (describe \"FP \u30b9\u30bf\u30a4\u30eb\"\n    (it \"\u5165\u91d1\u304c\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\"\n      (let [acc (fp/make-account \"A001\" 1000)\n            new-acc (fp/deposit acc 500)]\n        (should= 1000 (fp/get-balance acc))\n        (should= 1500 (fp/get-balance new-acc))))\n\n    (it \"\u9001\u91d1\u304c\u6b63\u3057\u304f\u52d5\u4f5c\u3059\u308b\"\n      (let [from (fp/make-account \"A001\" 1000)\n            to (fp/make-account \"A002\" 500)\n            result (fp/transfer from to 300)]\n        (should (:success result))\n        (should= 700 (fp/get-balance (:from result)))\n        (should= 800 (fp/get-balance (:to result))))))\n\n  (describe \"\u79fb\u884c\u6226\u7565\"\n    (it \"\u30a2\u30c0\u30d7\u30bf\u30fc\u3067\u65e2\u5b58\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u7dad\u6301\"\n      (let [adapter (ms/make-fp-account-adapter \"A001\" 1000)]\n        (ms/deposit-to-account adapter 500)\n        (should= 1500 (ms/get-account-balance adapter))))\n\n    (it \"\u30a4\u30d9\u30f3\u30c8\u3092\u30ea\u30d7\u30ec\u30a4\u3067\u304d\u308b\"\n      (let [events [(ms/account-event :created {:id \"A001\" :balance 0 :transactions []})\n                    (ms/account-event :deposited {:amount 1000})\n                    (ms/account-event :withdrawn {:amount 300})]\n            account (ms/replay-events events)]\n        (should= 700 (:balance account))))))\n</code></pre>"},{"location":"clojure/22-oo-to-fp-migration/#8","title":"8. \u307e\u3068\u3081","text":""},{"location":"clojure/22-oo-to-fp-migration/#_2","title":"\u79fb\u884c\u306e\u30dd\u30a4\u30f3\u30c8","text":"<ol> <li>\u6bb5\u968e\u7684\u306b\u9032\u3081\u308b: \u4e00\u5ea6\u306b\u3059\u3079\u3066\u3092\u5909\u66f4\u3057\u306a\u3044</li> <li>\u30c6\u30b9\u30c8\u3092\u66f8\u304f: \u79fb\u884c\u524d\u5f8c\u306e\u52d5\u4f5c\u3092\u4fdd\u8a3c</li> <li>\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u6d3b\u7528: \u65e2\u5b58\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u7dad\u6301</li> <li>\u7d14\u7c8b\u95a2\u6570\u304b\u3089\u59cb\u3081\u308b: \u8a08\u7b97\u30ed\u30b8\u30c3\u30af\u3092\u5148\u306b\u62bd\u51fa</li> </ol>"},{"location":"clojure/22-oo-to-fp-migration/#_3","title":"\u95a2\u6570\u578b\u306e\u5229\u70b9","text":"\u5074\u9762 OO FP \u30c6\u30b9\u30c8 \u30e2\u30c3\u30af\u304c\u5fc5\u8981 \u5165\u529b \u2192 \u51fa\u529b\u306e\u307f \u30c7\u30d0\u30c3\u30b0 \u72b6\u614b\u306e\u8ffd\u8de1\u304c\u56f0\u96e3 \u5024\u304c\u4e0d\u5909\u3067\u8ffd\u8de1\u5bb9\u6613 \u4e26\u884c\u51e6\u7406 \u30ed\u30c3\u30af\u304c\u5fc5\u8981 \u4e0d\u5909\u30c7\u30fc\u30bf\u3067\u5b89\u5168 \u518d\u5229\u7528 \u7d99\u627f\u306e\u5236\u7d04 \u95a2\u6570\u5408\u6210\u3067\u81ea\u7531"},{"location":"clojure/22-oo-to-fp-migration/#_4","title":"\u6700\u7d42\u7684\u306a\u30b4\u30fc\u30eb","text":""},{"location":"clojure/22-oo-to-fp-migration/#_5","title":"\u30b7\u30ea\u30fc\u30ba\u306e\u307e\u3068\u3081","text":"<p>\u672c\u30b7\u30ea\u30fc\u30ba\u3092\u901a\u3058\u3066\u3001\u4ee5\u4e0b\u3092\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u57fa\u790e\u539f\u5247: \u4e0d\u5909\u6027\u3001\u95a2\u6570\u5408\u6210\u3001\u591a\u614b\u6027</li> <li>\u4ed5\u69d8\u3068\u30c6\u30b9\u30c8: Spec\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u3001TDD</li> <li>\u69cb\u9020\u30d1\u30bf\u30fc\u30f3: Composite\u3001Decorator\u3001Adapter</li> <li>\u632f\u308b\u821e\u3044\u30d1\u30bf\u30fc\u30f3: Strategy\u3001Command\u3001Visitor</li> <li>\u751f\u6210\u30d1\u30bf\u30fc\u30f3: Abstract Factory\u3001Abstract Server</li> <li>\u30b1\u30fc\u30b9\u30b9\u30bf\u30c7\u30a3: \u5b9f\u8df5\u7684\u306a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3</li> <li>\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9: \u30c7\u30fc\u30bf\u4e2d\u5fc3\u8a2d\u8a08\u3001\u30c6\u30b9\u30c8\u53ef\u80fd\u306a\u8a2d\u8a08</li> </ol> <p>\u95a2\u6570\u578b\u30c7\u30b6\u30a4\u30f3\u306f\u3001\u30b7\u30f3\u30d7\u30eb\u3067\u4fdd\u5b88\u3057\u3084\u3059\u304f\u3001\u30c6\u30b9\u30c8\u3057\u3084\u3059\u3044\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u69cb\u7bc9\u3059\u308b\u305f\u3081\u306e\u5f37\u529b\u306a\u30a2\u30d7\u30ed\u30fc\u30c1\u3067\u3059\u3002\u3053\u308c\u3089\u306e\u539f\u5247\u3068\u30d1\u30bf\u30fc\u30f3\u3092\u6d3b\u7528\u3057\u3066\u3001\u3088\u308a\u826f\u3044\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u4f5c\u6210\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p> <p>Simple made easy.</p>"}]}