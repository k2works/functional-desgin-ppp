{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"\u95a2\u6570\u578b\u30c7\u30b6\u30a4\u30f3 - \u539f\u5247\u3001\u30d1\u30bf\u30fc\u30f3\u3001\u5b9f\u8df5","text":"<p>\u672c\u8a18\u4e8b\u30b7\u30ea\u30fc\u30ba\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u304a\u3051\u308b\u8a2d\u8a08\u539f\u5247\u3068\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u3092\u5b9f\u8df5\u7684\u306b\u5b66\u3076\u305f\u3081\u306e\u30ac\u30a4\u30c9\u3067\u3059\u3002</p>"},{"location":"#_1","title":"\u8a00\u8a9e\u5225\u89e3\u8aac","text":""},{"location":"#clojure","title":"Clojure \u7248","text":"<p>Clojure \u3092\u4f7f\u3063\u305f\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u5b9f\u88c5\u4f8b\u3067\u3059\u3002\u5f93\u6765\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u3092\u95a2\u6570\u578b\u30d1\u30e9\u30c0\u30a4\u30e0\u3067\u3069\u306e\u3088\u3046\u306b\u8868\u73fe\u3057\u3001\u6d3b\u7528\u3067\u304d\u308b\u304b\u3092\u63a2\u6c42\u3057\u307e\u3059\u3002</p> <ul> <li>Clojure \u89e3\u8aac</li> </ul>"},{"location":"#scala","title":"Scala \u7248","text":"<p>Scala \u3092\u4f7f\u3063\u305f\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u5b9f\u88c5\u4f8b\u3067\u3059\u3002\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u3068\u95a2\u6570\u578b\u306e\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u306a\u7279\u6027\u3092\u6d3b\u304b\u3057\u305f\u5b9f\u88c5\u30d1\u30bf\u30fc\u30f3\u3092\u5b66\u3073\u307e\u3059\u3002</p> <ul> <li>Scala \u89e3\u8aac</li> </ul>"},{"location":"#clojure_1","title":"\u7ae0\u69cb\u6210\uff08Clojure\uff09","text":""},{"location":"#1","title":"\u7b2c1\u90e8: \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u57fa\u790e\u539f\u5247","text":"\u7ae0 \u5185\u5bb9 1 \u4e0d\u5909\u6027\u3068\u30c7\u30fc\u30bf\u5909\u63db 2 \u95a2\u6570\u5408\u6210\u3068\u9ad8\u968e\u95a2\u6570 3 \u591a\u614b\u6027\u306e\u5b9f\u73fe\u65b9\u6cd5"},{"location":"#2","title":"\u7b2c2\u90e8: \u4ed5\u69d8\u3068\u30c6\u30b9\u30c8","text":"\u7ae0 \u5185\u5bb9 4 Clojure Spec \u306b\u3088\u308b\u4ed5\u69d8\u5b9a\u7fa9 5 \u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8 6 \u30c6\u30b9\u30c8\u99c6\u52d5\u958b\u767a\u3068\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0"},{"location":"#3-","title":"\u7b2c3\u90e8: \u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3 - \u69cb\u9020\u30d1\u30bf\u30fc\u30f3","text":"\u7ae0 \u5185\u5bb9 7 Composite \u30d1\u30bf\u30fc\u30f3 8 Decorator \u30d1\u30bf\u30fc\u30f3 9 Adapter \u30d1\u30bf\u30fc\u30f3"},{"location":"#4-","title":"\u7b2c4\u90e8: \u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3 - \u632f\u308b\u821e\u3044\u30d1\u30bf\u30fc\u30f3","text":"\u7ae0 \u5185\u5bb9 10 Strategy \u30d1\u30bf\u30fc\u30f3 11 Command \u30d1\u30bf\u30fc\u30f3 12 Visitor \u30d1\u30bf\u30fc\u30f3"},{"location":"#5-","title":"\u7b2c5\u90e8: \u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3 - \u751f\u6210\u30d1\u30bf\u30fc\u30f3","text":"\u7ae0 \u5185\u5bb9 13 Abstract Factory \u30d1\u30bf\u30fc\u30f3 14 Abstract Server \u30d1\u30bf\u30fc\u30f3"},{"location":"#6","title":"\u7b2c6\u90e8: \u5b9f\u8df5\u7684\u306a\u30b1\u30fc\u30b9\u30b9\u30bf\u30c7\u30a3","text":"\u7ae0 \u5185\u5bb9 15 \u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b 16 \u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0 17 \u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0 18 \u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0 19 Wa-Tor \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3"},{"location":"#7","title":"\u7b2c7\u90e8: \u307e\u3068\u3081\u3068\u5fdc\u7528","text":"\u7ae0 \u5185\u5bb9 20 \u30d1\u30bf\u30fc\u30f3\u9593\u306e\u76f8\u4e92\u4f5c\u7528 21 \u95a2\u6570\u578b\u30c7\u30b6\u30a4\u30f3\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9 22 \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u304b\u3089\u95a2\u6570\u578b\u3078\u306e\u79fb\u884c"},{"location":"#_2","title":"\u53c2\u7167","text":"<ul> <li>\u300cFunctional Design: Principles, Patterns, and Practices\u300dRobert C. Martin</li> <li>\u300cClean Code\u300dRobert C. Martin</li> <li>\u300cClojure Applied\u300dBen Vandgrift, Alex Miller</li> <li>\u300cProgramming Clojure\u300dAlex Miller, Stuart Halloway, Aaron Bedra</li> <li>\u300cFunctional Programming in Scala\u300dPaul Chiusano, R\u00fanar Bjarnason</li> <li>Clojure \u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8</li> <li>Scala \u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8</li> </ul>"},{"location":"clojure/","title":"\u95a2\u6570\u578b\u30c7\u30b6\u30a4\u30f3 - \u539f\u5247\u3001\u30d1\u30bf\u30fc\u30f3\u3001\u5b9f\u8df5","text":""},{"location":"clojure/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u8a18\u4e8b\u30b7\u30ea\u30fc\u30ba\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u304a\u3051\u308b\u8a2d\u8a08\u539f\u5247\u3068\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u3092\u5b9f\u8df5\u7684\u306b\u5b66\u3076\u305f\u3081\u306e\u30ac\u30a4\u30c9\u3067\u3059\u3002Clojure \u3092\u4e3b\u306a\u5b9f\u88c5\u8a00\u8a9e\u3068\u3057\u3066\u3001\u5f93\u6765\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u3092\u95a2\u6570\u578b\u30d1\u30e9\u30c0\u30a4\u30e0\u3067\u3069\u306e\u3088\u3046\u306b\u8868\u73fe\u3057\u3001\u6d3b\u7528\u3067\u304d\u308b\u304b\u3092\u63a2\u6c42\u3057\u307e\u3059\u3002</p>"},{"location":"clojure/#_2","title":"\u8a18\u4e8b\u69cb\u6210","text":""},{"location":"clojure/#1","title":"\u7b2c1\u90e8: \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u57fa\u790e\u539f\u5247","text":"<ol> <li>\u4e0d\u5909\u6027\u3068\u30c7\u30fc\u30bf\u5909\u63db</li> <li>\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u91cd\u8981\u6027</li> <li>\u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3</li> <li> <p>\u526f\u4f5c\u7528\u306e\u5206\u96e2</p> </li> <li> <p>\u95a2\u6570\u5408\u6210\u3068\u9ad8\u968e\u95a2\u6570</p> </li> <li>\u95a2\u6570\u5408\u6210\u306e\u57fa\u672c</li> <li>\u90e8\u5206\u9069\u7528\u3068\u30ab\u30ea\u30fc\u5316</li> <li> <p>\u9ad8\u968e\u95a2\u6570\u306e\u6d3b\u7528</p> </li> <li> <p>\u591a\u614b\u6027\u306e\u5b9f\u73fe\u65b9\u6cd5</p> </li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1</li> <li>\u30d7\u30ed\u30c8\u30b3\u30eb\u3068\u30ec\u30b3\u30fc\u30c9</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9 vs \u30d7\u30ed\u30c8\u30b3\u30eb\u306e\u4f7f\u3044\u5206\u3051</li> </ol>"},{"location":"clojure/#2","title":"\u7b2c2\u90e8: \u4ed5\u69d8\u3068\u30c6\u30b9\u30c8","text":"<ol> <li>Clojure Spec \u306b\u3088\u308b\u4ed5\u69d8\u5b9a\u7fa9</li> <li>\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u4ed5\u69d8\u5b9a\u7fa9</li> <li>\u95a2\u6570\u4ed5\u69d8\u306e\u5b9a\u7fa9\uff08fdef\uff09</li> <li> <p>\u5b9f\u884c\u6642\u691c\u8a3c\u3068\u81ea\u52d5\u30c6\u30b9\u30c8\u751f\u6210</p> </li> <li> <p>\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8</p> </li> <li>test.check \u306e\u57fa\u672c</li> <li>\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u306e\u4f5c\u6210</li> <li> <p>\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u5b9a\u7fa9\u3068\u691c\u8a3c</p> </li> <li> <p>\u30c6\u30b9\u30c8\u99c6\u52d5\u958b\u767a\u3068\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0</p> </li> <li>Red-Green-Refactor \u30b5\u30a4\u30af\u30eb</li> <li>\u30c6\u30b9\u30c8\u30d5\u30a1\u30fc\u30b9\u30c8\u306e\u95a2\u6570\u8a2d\u8a08</li> <li>\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u3068\u4e0d\u5909\u6027</li> </ol>"},{"location":"clojure/#3-","title":"\u7b2c3\u90e8: \u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3 - \u69cb\u9020\u30d1\u30bf\u30fc\u30f3","text":"<ol> <li>Composite \u30d1\u30bf\u30fc\u30f3</li> <li>\u500b\u5225\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u8907\u5408\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u7d71\u4e00\u7684\u306a\u6271\u3044</li> <li>Shape\uff08\u56f3\u5f62\uff09\u306e\u79fb\u52d5\u30fb\u62e1\u5927\u3092\u7d71\u4e00\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u64cd\u4f5c</li> <li>Switchable\uff08\u30b9\u30a4\u30c3\u30c1\uff09\u306e\u30b0\u30eb\u30fc\u30d7\u5316\u3068\u4e00\u62ec\u64cd\u4f5c</li> <li> <p>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u591a\u614b\u6027\u306e\u5b9f\u73fe</p> </li> <li> <p>Decorator \u30d1\u30bf\u30fc\u30f3</p> </li> <li>\u6a5f\u80fd\u306e\u52d5\u7684\u306a\u8ffd\u52a0</li> <li>JournaledShape: \u64cd\u4f5c\u5c65\u6b74\u306e\u8a18\u9332\uff08\u30b8\u30e3\u30fc\u30ca\u30ea\u30f3\u30b0\uff09</li> <li>\u95a2\u6570\u30c7\u30b3\u30ec\u30fc\u30bf: \u30ed\u30b0\u3001\u30ea\u30c8\u30e9\u30a4\u3001\u30ad\u30e3\u30c3\u30b7\u30e5</li> <li> <p>\u30c7\u30b3\u30ec\u30fc\u30bf\u306e\u7d44\u307f\u5408\u308f\u305b</p> </li> <li> <p>Adapter \u30d1\u30bf\u30fc\u30f3</p> </li> <li>\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306e\u5909\u63db</li> <li>VariableLightAdapter: \u53ef\u5909\u5f37\u5ea6\u30e9\u30a4\u30c8\u3092\u30aa\u30f3/\u30aa\u30d5\u306b\u9069\u5fdc</li> <li>\u30c7\u30fc\u30bf\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u30a2\u30c0\u30d7\u30bf\u30fc: \u65b0\u65e7\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u5909\u63db</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u9069\u5fdc</li> </ol>"},{"location":"clojure/#4-","title":"\u7b2c4\u90e8: \u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3 - \u632f\u308b\u821e\u3044\u30d1\u30bf\u30fc\u30f3","text":"<ol> <li> <p>Strategy \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u30ab\u30d7\u30bb\u30eb\u5316\u3057\u4ea4\u63db\u53ef\u80fd\u306b\u3059\u308b</li> <li>\u6599\u91d1\u8a08\u7b97: \u901a\u5e38\u30fb\u5272\u5f15\u30fb\u4f1a\u54e1\u30fb\u6570\u91cf\u5272\u5f15\u306e\u5404\u6226\u7565</li> <li>\u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1: \u9ad8\u968e\u95a2\u6570\u306b\u3088\u308b\u6226\u7565\u306e\u5408\u6210</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u591a\u614b\u6027\u306e\u5b9f\u73fe</li> </ul> </li> <li> <p>Command \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>\u64cd\u4f5c\u3092\u30c7\u30fc\u30bf\u3068\u3057\u3066\u30ab\u30d7\u30bb\u30eb\u5316</li> <li>\u30c6\u30ad\u30b9\u30c8\u30b3\u30de\u30f3\u30c9: \u633f\u5165\u30fb\u524a\u9664\u30fb\u7f6e\u63db</li> <li>\u30ad\u30e3\u30f3\u30d0\u30b9\u30b3\u30de\u30f3\u30c9: \u56f3\u5f62\u306e\u8ffd\u52a0\u30fb\u524a\u9664\u30fb\u79fb\u52d5</li> <li>Undo/Redo \u6a5f\u80fd\u3068 MacroCommand</li> </ul> </li> <li> <p>Visitor \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>\u30c7\u30fc\u30bf\u69cb\u9020\u3068\u64cd\u4f5c\u306e\u5206\u96e2</li> <li>JSON/XML \u5909\u63db Visitor \u306e\u5b9f\u88c5</li> <li>\u9762\u7a4d\u30fb\u5468\u56f2\u9577\u8a08\u7b97 Visitor</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u30c0\u30d6\u30eb\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1</li> </ul> </li> </ol>"},{"location":"clojure/#5-","title":"\u7b2c5\u90e8: \u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3 - \u751f\u6210\u30d1\u30bf\u30fc\u30f3","text":"<ol> <li> <p>Abstract Factory \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>\u95a2\u9023\u3059\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30d5\u30a1\u30df\u30ea\u30fc\u3092\u4e00\u8cab\u3057\u3066\u751f\u6210</li> <li>ShapeFactory: Standard/Outlined/Filled \u306e\u5404\u5b9f\u88c5</li> <li>UIFactory: \u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u5225 UI \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u751f\u6210</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u88fd\u54c1\u751f\u6210\u306e\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1</li> </ul> </li> <li> <p>Abstract Server \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>\u4f9d\u5b58\u95a2\u4fc2\u9006\u8ee2\u306e\u539f\u5247\uff08DIP\uff09\u306e\u5b9f\u73fe</li> <li>Switchable: Light/Fan/Motor \u306e\u7d71\u4e00\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>Repository: \u30c7\u30fc\u30bf\u30a2\u30af\u30bb\u30b9\u306e\u62bd\u8c61\u5316</li> <li>\u30d7\u30ed\u30c8\u30b3\u30eb\u3068\u30ec\u30b3\u30fc\u30c9\u306b\u3088\u308b\u758e\u7d50\u5408</li> </ul> </li> </ol>"},{"location":"clojure/#6","title":"\u7b2c6\u90e8: \u5b9f\u8df5\u7684\u306a\u30b1\u30fc\u30b9\u30b9\u30bf\u30c7\u30a3","text":"<ol> <li> <p>\u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b</p> <ul> <li>\u30d0\u30b9\u904b\u8ee2\u624b\u304c\u505c\u7559\u6240\u3067\u5642\u3092\u5171\u6709\u3059\u308b\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3</li> <li>\u7121\u9650\u30b7\u30fc\u30b1\u30f3\u30b9\uff08cycle\uff09\u306b\u3088\u308b\u5faa\u74b0\u30eb\u30fc\u30c8\u8868\u73fe</li> <li>\u96c6\u5408\u6f14\u7b97\u306b\u3088\u308b\u5642\u306e\u4f1d\u64ad</li> <li>\u72b6\u614b\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u5b9f\u88c5</li> </ul> </li> <li> <p>\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0</p> <ul> <li>\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30ea\u30f3\u30b0</li> <li>\u652f\u6255\u3044\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3068\u7d66\u4e0e\u30bf\u30a4\u30d7</li> <li>Clojure Spec \u306b\u3088\u308b\u30c7\u30fc\u30bf\u691c\u8a3c</li> </ul> </li> <li> <p>\u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0</p> <ul> <li>\u6599\u91d1\u8a08\u7b97\u30ed\u30b8\u30c3\u30af\u306e\u8a2d\u8a08</li> <li>\u30dd\u30ea\u30b7\u30fc\u30d1\u30bf\u30fc\u30f3\u306e\u9069\u7528</li> <li>\u30c6\u30ad\u30b9\u30c8/HTML \u30d5\u30a9\u30fc\u30de\u30c3\u30bf\u30fc\u306e\u5b9f\u88c5</li> </ul> </li> <li> <p>\u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0</p> <ul> <li>Clojure \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306b\u3088\u308b\u975e\u540c\u671f\u51e6\u7406</li> <li>\u72b6\u614b\u6a5f\u68b0\u30d1\u30bf\u30fc\u30f3</li> <li>\u30a4\u30d9\u30f3\u30c8\u99c6\u52d5\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3</li> </ul> </li> <li> <p>Wa-Tor \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3</p> <ul> <li>\u6355\u98df\u8005-\u88ab\u98df\u8005\u30e2\u30c7\u30eb\u306e\u5b9f\u88c5</li> <li>\u30bb\u30eb\u30aa\u30fc\u30c8\u30de\u30c8\u30f3\u3068\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9</li> <li>GUI \u3068\u306e\u7d71\u5408\uff08Quil\uff09</li> <li>\u9032\u5316\u3068\u7e41\u6b96\u306e\u30eb\u30fc\u30eb\u5b9f\u88c5</li> </ul> </li> </ol>"},{"location":"clojure/#7","title":"\u7b2c7\u90e8: \u307e\u3068\u3081\u3068\u5fdc\u7528","text":"<ol> <li> <p>\u30d1\u30bf\u30fc\u30f3\u9593\u306e\u76f8\u4e92\u4f5c\u7528</p> <ul> <li>Composite \u3068 Decorator \u306e\u7d44\u307f\u5408\u308f\u305b</li> <li>Command \u3068 Observer \u306e\u9023\u643a</li> <li>\u8907\u5408\u7684\u306a\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08</li> </ul> </li> <li> <p>\u95a2\u6570\u578b\u30c7\u30b6\u30a4\u30f3\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9</p> <ul> <li>\u30c7\u30fc\u30bf\u4e2d\u5fc3\u8a2d\u8a08</li> <li>\u7d14\u7c8b\u95a2\u6570\u3068\u526f\u4f5c\u7528\u306e\u5206\u96e2</li> <li>\u30c6\u30b9\u30c8\u53ef\u80fd\u306a\u8a2d\u8a08</li> </ul> </li> <li> <p>\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u304b\u3089\u95a2\u6570\u578b\u3078\u306e\u79fb\u884c</p> <ul> <li>\u65e2\u5b58\u30b3\u30fc\u30c9\u306e\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u6226\u7565</li> <li>\u6bb5\u968e\u7684\u306a\u79fb\u884c\u30a2\u30d7\u30ed\u30fc\u30c1</li> <li>\u5171\u5b58\u3068\u7d71\u5408</li> </ul> </li> </ol>"},{"location":"clojure/#_3","title":"\u4ed8\u9332","text":"<ul> <li>\u7528\u8a9e\u96c6</li> <li>\u53c2\u8003\u6587\u732e</li> <li>Clojure \u958b\u767a\u74b0\u5883\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7</li> </ul>"},{"location":"clojure/#_4","title":"\u672c\u30b7\u30ea\u30fc\u30ba\u306e\u7279\u5fb4","text":""},{"location":"clojure/#_5","title":"\u5b9f\u8df5\u91cd\u8996","text":"<p>\u3059\u3079\u3066\u306e\u30d1\u30bf\u30fc\u30f3\u306f\u5b9f\u969b\u306b\u52d5\u4f5c\u3059\u308b\u30b3\u30fc\u30c9\u4f8b\u3092\u542b\u307f\u307e\u3059\u3002\u7406\u8ad6\u3060\u3051\u3067\u306a\u304f\u3001\u5b9f\u88c5\u3092\u901a\u3058\u3066\u7406\u89e3\u3092\u6df1\u3081\u308b\u3053\u3068\u3092\u91cd\u8996\u3057\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"clojure/#_6","title":"\u30c6\u30b9\u30c8\u99c6\u52d5","text":"<p>\u5404\u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u306b\u306f\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u304c\u4ed8\u5c5e\u3057\u3066\u3044\u307e\u3059\u3002TDD \u306e\u30a2\u30d7\u30ed\u30fc\u30c1\u306b\u5f93\u3044\u3001\u30c6\u30b9\u30c8\u30d5\u30a1\u30fc\u30b9\u30c8\u3067\u30d1\u30bf\u30fc\u30f3\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/#_7","title":"\u6bb5\u968e\u7684\u306a\u5b66\u7fd2","text":"<p>\u57fa\u790e\u304b\u3089\u5fdc\u7528\u3078\u3068\u6bb5\u968e\u7684\u306b\u5185\u5bb9\u304c\u9032\u884c\u3057\u307e\u3059\u3002\u5404\u7ae0\u306f\u72ec\u7acb\u3057\u3066\u8aad\u3080\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u304c\u3001\u9806\u756a\u306b\u8aad\u3080\u3053\u3068\u3067\u3088\u308a\u6df1\u3044\u7406\u89e3\u304c\u5f97\u3089\u308c\u307e\u3059\u3002</p>"},{"location":"clojure/#_8","title":"\u65e5\u672c\u8a9e\u3067\u306e\u89e3\u8aac","text":"<p>\u6280\u8853\u7528\u8a9e\u306f\u82f1\u8a9e\u3092\u4f75\u8a18\u3057\u3064\u3064\u3001\u89e3\u8aac\u306f\u65e5\u672c\u8a9e\u3067\u884c\u3044\u307e\u3059\u3002\u65e5\u672c\u8a9e\u3067\u306e\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u5b66\u7fd2\u30ea\u30bd\u30fc\u30b9\u3068\u3057\u3066\u6d3b\u7528\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"clojure/#_9","title":"\u5bfe\u8c61\u8aad\u8005","text":"<ul> <li>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u8208\u5473\u304c\u3042\u308b\u958b\u767a\u8005</li> <li>Clojure \u3092\u5b66\u7fd2\u4e2d\u307e\u305f\u306f\u6d3b\u7528\u3057\u3066\u3044\u308b\u958b\u767a\u8005</li> <li>\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u306e\u77e5\u8b58\u304c\u3042\u308a\u3001\u95a2\u6570\u578b\u3067\u306e\u8868\u73fe\u3092\u5b66\u3073\u305f\u3044\u958b\u767a\u8005</li> <li>\u30c6\u30b9\u30c8\u99c6\u52d5\u958b\u767a\u3084\u30af\u30ea\u30fc\u30f3\u30b3\u30fc\u30c9\u306b\u95a2\u5fc3\u304c\u3042\u308b\u958b\u767a\u8005</li> </ul>"},{"location":"clojure/#_10","title":"\u524d\u63d0\u77e5\u8b58","text":"<ul> <li>\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u57fa\u790e\u77e5\u8b58</li> <li>Clojure \u306e\u57fa\u672c\u7684\u306a\u6587\u6cd5\uff08\u30ea\u30b9\u30c8\u3001\u30de\u30c3\u30d7\u3001\u95a2\u6570\u5b9a\u7fa9\u306a\u3069\uff09</li> <li>\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u306e\u57fa\u672c\u6982\u5ff5\uff08\u63a8\u5968\uff09</li> </ul>"},{"location":"clojure/#_11","title":"\u53c2\u8003\u66f8\u7c4d","text":"<p>\u672c\u30b7\u30ea\u30fc\u30ba\u306f\u4ee5\u4e0b\u306e\u66f8\u7c4d\u306e\u5185\u5bb9\u3092\u53c2\u8003\u306b\u3057\u3066\u3044\u307e\u3059\uff1a</p> <ul> <li>\u300cFunctional Design: Principles, Patterns, and Practices\u300dRobert C. Martin</li> <li>\u300cClean Code\u300dRobert C. Martin</li> <li>\u300cClojure Applied\u300dBen Vandgrift, Alex Miller</li> <li>\u300cProgramming Clojure\u300dAlex Miller, Stuart Halloway, Aaron Bedra</li> </ul>"},{"location":"clojure/01-immutability-and-data-transformation/","title":"\u7b2c1\u7ae0: \u4e0d\u5909\u6027\u3068\u30c7\u30fc\u30bf\u5909\u63db","text":""},{"location":"clojure/01-immutability-and-data-transformation/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u6700\u3082\u91cd\u8981\u306a\u6982\u5ff5\u306e\u4e00\u3064\u304c\u4e0d\u5909\u6027\uff08Immutability\uff09\u3067\u3059\u3002\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u4e88\u6e2c\u53ef\u80fd\u6027\u304c\u5411\u4e0a\u3057\u3001\u4e26\u884c\u51e6\u7406\u3067\u306e\u30d0\u30b0\u3092\u9632\u304e\u3001\u30b3\u30fc\u30c9\u306e\u7406\u89e3\u3068\u4fdd\u5b88\u304c\u5bb9\u6613\u306b\u306a\u308a\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001Clojure \u306b\u304a\u3051\u308b\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u57fa\u672c\u304b\u3089\u3001\u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3001\u526f\u4f5c\u7528\u306e\u5206\u96e2\u307e\u3067\u3001\u5b9f\u8df5\u7684\u306a\u4f8b\u3092\u901a\u3058\u3066\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/01-immutability-and-data-transformation/#1_1","title":"1. \u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u57fa\u672c","text":""},{"location":"clojure/01-immutability-and-data-transformation/#_2","title":"\u306a\u305c\u4e0d\u5909\u6027\u304c\u91cd\u8981\u306a\u306e\u304b","text":"<p>\u5f93\u6765\u306e\u547d\u4ee4\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u5909\u6570\u3084\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u72b6\u614b\u3092\u76f4\u63a5\u5909\u66f4\u3057\u307e\u3059\uff1a</p> <pre><code>// Java\uff08\u53ef\u5909\uff09\nperson.setAge(31);  // \u5143\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u5909\u66f4\u3055\u308c\u308b\n</code></pre> <p>\u3053\u308c\u306b\u5bfe\u3057\u3001Clojure \u306e\u30c7\u30fc\u30bf\u69cb\u9020\u306f\u4e0d\u5909\u3067\u3059\u3002\u30c7\u30fc\u30bf\u3092\u300c\u5909\u66f4\u300d\u3059\u308b\u3068\u3001\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u69cb\u9020\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\uff1a</p> <pre><code>(def original-person {:name \"\u7530\u4e2d\" :age 30})\n\n(defn update-age [person new-age]\n  (assoc person :age new-age))\n\n;; \u4f7f\u7528\u4f8b\n(def updated-person (update-age original-person 31))\n\noriginal-person   ;; =&gt; {:name \"\u7530\u4e2d\" :age 30}  \u2190 \u5143\u306e\u30c7\u30fc\u30bf\u306f\u5909\u308f\u3089\u306a\u3044\nupdated-person    ;; =&gt; {:name \"\u7530\u4e2d\" :age 31}  \u2190 \u65b0\u3057\u3044\u30c7\u30fc\u30bf\n</code></pre>"},{"location":"clojure/01-immutability-and-data-transformation/#_3","title":"\u4e0d\u5909\u6027\u306e\u5229\u70b9","text":"<ol> <li>\u4e88\u6e2c\u53ef\u80fd\u6027: \u30c7\u30fc\u30bf\u304c\u5909\u66f4\u3055\u308c\u306a\u3044\u305f\u3081\u3001\u95a2\u6570\u306e\u52d5\u4f5c\u3092\u4e88\u6e2c\u3057\u3084\u3059\u3044</li> <li>\u30b9\u30ec\u30c3\u30c9\u30bb\u30fc\u30d5: \u8907\u6570\u306e\u30b9\u30ec\u30c3\u30c9\u304b\u3089\u5b89\u5168\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b</li> <li>\u5c65\u6b74\u306e\u4fdd\u6301: \u5909\u66f4\u524d\u306e\u30c7\u30fc\u30bf\u3092\u4fdd\u6301\u3067\u304d\u308b\uff08Undo/Redo \u306e\u5b9f\u88c5\u304c\u5bb9\u6613\uff09</li> <li>\u30c7\u30d0\u30c3\u30b0\u306e\u5bb9\u6613\u3055: \u30c7\u30fc\u30bf\u306e\u5909\u66f4\u5c65\u6b74\u3092\u8ffd\u8de1\u3057\u3084\u3059\u3044</li> </ol>"},{"location":"clojure/01-immutability-and-data-transformation/#2-structural-sharing","title":"2. \u69cb\u9020\u5171\u6709\uff08Structural Sharing\uff09","text":"<p>\u300c\u6bce\u56de\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u4f5c\u6210\u3059\u308b\u3068\u975e\u52b9\u7387\u3067\u306f\uff1f\u300d\u3068\u601d\u3046\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002Clojure \u306f\u69cb\u9020\u5171\u6709\u306b\u3088\u308a\u3001\u52b9\u7387\u7684\u306b\u30e1\u30e2\u30ea\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002</p> <pre><code>(def team {:name \"\u958b\u767a\u30c1\u30fc\u30e0\"\n           :members [{:name \"\u7530\u4e2d\" :role :developer}\n                     {:name \"\u9234\u6728\" :role :designer}\n                     {:name \"\u4f50\u85e4\" :role :manager}]})\n\n(defn add-member [team member]\n  (update team :members conj member))\n\n(def new-team (add-member team {:name \"\u5c71\u7530\" :role :developer}))\n</code></pre> <p><code>new-team</code> \u306f\u65b0\u3057\u3044\u30de\u30c3\u30d7\u3067\u3059\u304c\u3001<code>:name</code> \u306e\u5024\u3084\u65e2\u5b58\u306e\u30e1\u30f3\u30d0\u30fc\u30c7\u30fc\u30bf\u306f <code>team</code> \u3068\u5171\u6709\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u5909\u66f4\u3055\u308c\u3066\u3044\u306a\u3044\u90e8\u5206\u306f\u30b3\u30d4\u30fc\u3055\u308c\u305a\u3001\u53c2\u7167\u304c\u5171\u6709\u3055\u308c\u307e\u3059\u3002</p> <pre><code>team:     {:name \"\u958b\u767a\u30c1\u30fc\u30e0\", :members [\u7530\u4e2d, \u9234\u6728, \u4f50\u85e4]}\n                \u2193                    \u2193\nnew-team: {:name (\u5171\u6709), :members [\u7530\u4e2d, \u9234\u6728, \u4f50\u85e4, \u5c71\u7530]}\n                                  \u2191 \u65e2\u5b58\u30c7\u30fc\u30bf\u306f\u5171\u6709\n</code></pre>"},{"location":"clojure/01-immutability-and-data-transformation/#3","title":"3. \u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u30c7\u30fc\u30bf\u3092\u5909\u63db\u3059\u308b\u4e00\u9023\u306e\u51e6\u7406\u3092\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3068\u3057\u3066\u8868\u73fe\u3057\u307e\u3059\u3002Clojure \u3067\u306f\u30b9\u30ec\u30c3\u30c9\u30de\u30af\u30ed\uff08<code>-&gt;</code> \u3068 <code>-&gt;&gt;</code>\uff09\u3092\u4f7f\u7528\u3057\u3066\u3001\u8aad\u307f\u3084\u3059\u3044\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u69cb\u7bc9\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"clojure/01-immutability-and-data-transformation/#_4","title":"\u5b9f\u8df5\u4f8b\uff1a\u6ce8\u6587\u51e6\u7406\u30b7\u30b9\u30c6\u30e0","text":"<pre><code>(def order {:items [{:name \"\u5546\u54c1A\" :price 1000 :quantity 2}\n                    {:name \"\u5546\u54c1B\" :price 500 :quantity 3}\n                    {:name \"\u5546\u54c1C\" :price 2000 :quantity 1}]\n            :customer {:name \"\u5c71\u7530\" :membership :gold}})\n\n;; \u5404\u30a2\u30a4\u30c6\u30e0\u306e\u5c0f\u8a08\u3092\u8a08\u7b97\n(defn calculate-subtotal [item]\n  (* (:price item) (:quantity item)))\n\n;; \u4f1a\u54e1\u7a2e\u5225\u306b\u5fdc\u3058\u305f\u5272\u5f15\u7387\u3092\u53d6\u5f97\n(defn membership-discount [membership]\n  (case membership\n    :gold 0.1\n    :silver 0.05\n    :bronze 0.02\n    0))\n\n;; \u6ce8\u6587\u306e\u5408\u8a08\u91d1\u984d\u3092\u8a08\u7b97\n(defn calculate-total [order]\n  (-&gt;&gt; (:items order)\n       (map calculate-subtotal)\n       (reduce +)))\n\n;; \u5272\u5f15\u5f8c\u306e\u91d1\u984d\u3092\u8a08\u7b97\n(defn apply-discount [order total]\n  (let [discount-rate (-&gt; order :customer :membership membership-discount)]\n    (* total (- 1 discount-rate))))\n</code></pre>"},{"location":"clojure/01-immutability-and-data-transformation/#_5","title":"\u30b9\u30ec\u30c3\u30c9\u30de\u30af\u30ed\u306e\u4f7f\u3044\u5206\u3051","text":"<ul> <li><code>-&gt;</code>\uff08thread-first\uff09: \u7d50\u679c\u3092\u6b21\u306e\u95a2\u6570\u306e\u6700\u521d\u306e\u5f15\u6570\u3068\u3057\u3066\u6e21\u3059</li> <li><code>-&gt;&gt;</code>\uff08thread-last\uff09: \u7d50\u679c\u3092\u6b21\u306e\u95a2\u6570\u306e\u6700\u5f8c\u306e\u5f15\u6570\u3068\u3057\u3066\u6e21\u3059</li> </ul> <pre><code>;; -&gt; \u306e\u4f8b\uff08\u30de\u30c3\u30d7\u306e\u64cd\u4f5c\u306b\u4fbf\u5229\uff09\n(-&gt; order :customer :membership membership-discount)\n;; \u5c55\u958b: (membership-discount (:membership (:customer order)))\n\n;; -&gt;&gt; \u306e\u4f8b\uff08\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u64cd\u4f5c\u306b\u4fbf\u5229\uff09\n(-&gt;&gt; (:items order)\n     (map calculate-subtotal)\n     (reduce +))\n;; \u5c55\u958b: (reduce + (map calculate-subtotal (:items order)))\n</code></pre>"},{"location":"clojure/01-immutability-and-data-transformation/#4","title":"4. \u526f\u4f5c\u7528\u306e\u5206\u96e2","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u7d14\u7c8b\u95a2\u6570\u3068\u526f\u4f5c\u7528\u3092\u6301\u3064\u95a2\u6570\u3092\u660e\u78ba\u306b\u5206\u96e2\u3059\u308b\u3053\u3068\u304c\u91cd\u8981\u3067\u3059\u3002</p>"},{"location":"clojure/01-immutability-and-data-transformation/#_6","title":"\u7d14\u7c8b\u95a2\u6570\u3068\u306f","text":"<ul> <li>\u540c\u3058\u5165\u529b\u306b\u5bfe\u3057\u3066\u5e38\u306b\u540c\u3058\u51fa\u529b\u3092\u8fd4\u3059</li> <li>\u5916\u90e8\u306e\u72b6\u614b\u3092\u5909\u66f4\u3057\u306a\u3044\uff08\u526f\u4f5c\u7528\u304c\u306a\u3044\uff09</li> </ul> <pre><code>;; \u7d14\u7c8b\u95a2\u6570\n(defn pure-calculate-tax [amount tax-rate]\n  (* amount tax-rate))\n\n;; \u4f55\u5ea6\u547c\u3093\u3067\u3082\u540c\u3058\u7d50\u679c\n(pure-calculate-tax 1000 0.1)  ;; =&gt; 100.0\n(pure-calculate-tax 1000 0.1)  ;; =&gt; 100.0\n</code></pre>"},{"location":"clojure/01-immutability-and-data-transformation/#_7","title":"\u526f\u4f5c\u7528\u306e\u5206\u96e2\u30d1\u30bf\u30fc\u30f3","text":"<p>\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\uff08\u7d14\u7c8b\u95a2\u6570\uff09\u3068\u526f\u4f5c\u7528\uff08I/O\uff09\u3092\u5206\u96e2\u3057\u307e\u3059\uff1a</p> <pre><code>;; \u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\uff08\u7d14\u7c8b\u95a2\u6570\uff09\n(defn calculate-invoice [items tax-rate]\n  (let [subtotal (reduce + (map calculate-subtotal items))\n        tax (pure-calculate-tax subtotal tax-rate)\n        total (+ subtotal tax)]\n    {:subtotal subtotal\n     :tax tax\n     :total total}))\n\n;; \u526f\u4f5c\u7528\u3092\u542b\u3080\u51e6\u7406\uff08\u5206\u96e2\uff09\n(defn save-invoice! [invoice]\n  ;; \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u306e\u4fdd\u5b58\uff08\u526f\u4f5c\u7528\uff09\n  (println \"Saving invoice:\" invoice)\n  invoice)\n\n(defn send-notification! [invoice customer-email]\n  ;; \u30e1\u30fc\u30eb\u9001\u4fe1\uff08\u526f\u4f5c\u7528\uff09\n  (println \"Sending notification to:\" customer-email)\n  invoice)\n\n;; \u51e6\u7406\u5168\u4f53\u306e\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\n(defn process-and-save-invoice! [items tax-rate customer-email]\n  (-&gt; (calculate-invoice items tax-rate)\n      save-invoice!\n      (send-notification! customer-email)))\n</code></pre> <p>\u526f\u4f5c\u7528\u3092\u6301\u3064\u95a2\u6570\u306b\u306f <code>!</code> \u30b5\u30d5\u30a3\u30c3\u30af\u30b9\u3092\u4ed8\u3051\u308b\u6163\u4f8b\u304c\u3042\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/01-immutability-and-data-transformation/#5-undoredo","title":"5. \u6c38\u7d9a\u7684\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u6d3b\u7528\uff1aUndo/Redo \u306e\u5b9f\u88c5","text":"<p>\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u6d3b\u7528\u3059\u308b\u3068\u3001\u5c65\u6b74\u7ba1\u7406\u304c\u975e\u5e38\u306b\u7c21\u5358\u306b\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p> <pre><code>;; \u5c65\u6b74\u3092\u4fdd\u6301\u3059\u308b\u30c7\u30fc\u30bf\u69cb\u9020\n(defn create-history []\n  {:current nil\n   :past []\n   :future []})\n\n(defn push-state [history new-state]\n  (-&gt; history\n      (update :past conj (:current history))\n      (assoc :current new-state)\n      (assoc :future [])))\n\n(defn undo [history]\n  (if (empty? (:past history))\n    history\n    (let [previous (peek (:past history))]\n      (-&gt; history\n          (update :future conj (:current history))\n          (assoc :current previous)\n          (update :past pop)))))\n\n(defn redo [history]\n  (if (empty? (:future history))\n    history\n    (let [next-state (peek (:future history))]\n      (-&gt; history\n          (update :past conj (:current history))\n          (assoc :current next-state)\n          (update :future pop)))))\n</code></pre>"},{"location":"clojure/01-immutability-and-data-transformation/#_8","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>(def history\n  (-&gt; (create-history)\n      (push-state {:text \"Hello\"})\n      (push-state {:text \"Hello World\"})\n      (push-state {:text \"Hello World!\"})))\n\n(:current history)  ;; =&gt; {:text \"Hello World!\"}\n\n(def after-undo (undo history))\n(:current after-undo)  ;; =&gt; {:text \"Hello World\"}\n\n(def after-redo (redo after-undo))\n(:current after-redo)  ;; =&gt; {:text \"Hello World!\"}\n</code></pre>"},{"location":"clojure/01-immutability-and-data-transformation/#6","title":"6. \u30c8\u30e9\u30f3\u30b9\u30c7\u30e5\u30fc\u30b5\u30fc\u306b\u3088\u308b\u52b9\u7387\u7684\u306a\u5909\u63db","text":"<p>\u8907\u6570\u306e\u5909\u63db\u3092\u884c\u3046\u5834\u5408\u3001\u901a\u5e38\u306f\u4e2d\u9593\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002\u30c8\u30e9\u30f3\u30b9\u30c7\u30e5\u30fc\u30b5\u30fc\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u8907\u6570\u306e\u5909\u63db\u30921\u56de\u306e\u30d1\u30b9\u3067\u51e6\u7406\u3067\u304d\u307e\u3059\u3002</p> <pre><code>;; \u8907\u6570\u306e\u5909\u63db\u3092\u5408\u6210\n(def xf-process-items\n  (comp\n   (filter #(&gt; (:quantity %) 0))           ;; \u6570\u91cf\u304c0\u3088\u308a\u5927\u304d\u3044\u3082\u306e\u3092\u30d5\u30a3\u30eb\u30bf\n   (map #(assoc % :subtotal (calculate-subtotal %)))  ;; \u5c0f\u8a08\u3092\u8ffd\u52a0\n   (filter #(&gt; (:subtotal %) 100))))       ;; \u5c0f\u8a08\u304c100\u3088\u308a\u5927\u304d\u3044\u3082\u306e\u3092\u30d5\u30a3\u30eb\u30bf\n\n;; \u30c8\u30e9\u30f3\u30b9\u30c7\u30e5\u30fc\u30b5\u30fc\u3092\u4f7f\u7528\u3057\u305f\u52b9\u7387\u7684\u306a\u51e6\u7406\n(defn process-items-efficiently [items]\n  (into [] xf-process-items items))\n</code></pre> <p>\u30c8\u30e9\u30f3\u30b9\u30c7\u30e5\u30fc\u30b5\u30fc\u306e\u5229\u70b9\uff1a - \u4e2d\u9593\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3057\u306a\u3044 - \u9045\u5ef6\u8a55\u4fa1\u3068\u306e\u7d44\u307f\u5408\u308f\u305b\u304c\u53ef\u80fd - \u69d8\u3005\u306a\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\uff08\u30d9\u30af\u30bf\u30fc\u3001\u30c1\u30e3\u30cd\u30eb\u306a\u3069\uff09\u3067\u518d\u5229\u7528\u53ef\u80fd</p>"},{"location":"clojure/01-immutability-and-data-transformation/#_9","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u57fa\u790e\u3067\u3042\u308b\u4e0d\u5909\u6027\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020: \u30c7\u30fc\u30bf\u306f\u5909\u66f4\u3055\u308c\u305a\u3001\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u304c\u4f5c\u6210\u3055\u308c\u308b</li> <li>\u69cb\u9020\u5171\u6709: \u52b9\u7387\u7684\u306a\u30e1\u30e2\u30ea\u4f7f\u7528\u3092\u5b9f\u73fe</li> <li>\u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3: \u30b9\u30ec\u30c3\u30c9\u30de\u30af\u30ed\u306b\u3088\u308b\u8aad\u307f\u3084\u3059\u3044\u5909\u63db\u51e6\u7406</li> <li>\u526f\u4f5c\u7528\u306e\u5206\u96e2: \u7d14\u7c8b\u95a2\u6570\u3068I/O\u51e6\u7406\u306e\u660e\u78ba\u306a\u5206\u96e2</li> <li>\u5c65\u6b74\u7ba1\u7406: \u4e0d\u5909\u6027\u3092\u6d3b\u7528\u3057\u305fUndo/Redo\u306e\u7c21\u6f54\u306a\u5b9f\u88c5</li> <li>\u30c8\u30e9\u30f3\u30b9\u30c7\u30e5\u30fc\u30b5\u30fc: \u52b9\u7387\u7684\u306a\u8907\u5408\u5909\u63db</li> </ol> <p>\u3053\u308c\u3089\u306e\u6982\u5ff5\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u4ed6\u306e\u3059\u3079\u3066\u306e\u30d1\u30bf\u30fc\u30f3\u306e\u57fa\u76e4\u3068\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/01-immutability-and-data-transformation/#_10","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part1/src/immutability.clj</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part1/spec/immutability_spec.clj</code></li> </ul>"},{"location":"clojure/01-immutability-and-data-transformation/#_11","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001\u95a2\u6570\u5408\u6210\u3068\u9ad8\u968e\u95a2\u6570\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u5c0f\u3055\u306a\u95a2\u6570\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u8907\u96d1\u306a\u51e6\u7406\u3092\u69cb\u7bc9\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/02-function-composition/","title":"\u7b2c2\u7ae0: \u95a2\u6570\u5408\u6210\u3068\u9ad8\u968e\u95a2\u6570","text":""},{"location":"clojure/02-function-composition/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u771f\u9ac4\u306f\u3001\u5c0f\u3055\u306a\u95a2\u6570\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u8907\u96d1\u306a\u51e6\u7406\u3092\u69cb\u7bc9\u3059\u308b\u3053\u3068\u306b\u3042\u308a\u307e\u3059\u3002\u672c\u7ae0\u3067\u306f\u3001Clojure \u306b\u304a\u3051\u308b\u95a2\u6570\u5408\u6210\u306e\u30c6\u30af\u30cb\u30c3\u30af\u3068\u9ad8\u968e\u95a2\u6570\u306e\u6d3b\u7528\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/02-function-composition/#1-comp","title":"1. \u95a2\u6570\u5408\u6210\u306e\u57fa\u672c (comp)","text":""},{"location":"clojure/02-function-composition/#comp","title":"comp \u306b\u3088\u308b\u95a2\u6570\u306e\u9023\u7d50","text":"<p><code>comp</code> \u306f\u8907\u6570\u306e\u95a2\u6570\u3092\u5408\u6210\u3057\u3066\u3001\u65b0\u3057\u3044\u95a2\u6570\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u5408\u6210\u3055\u308c\u305f\u95a2\u6570\u306f\u53f3\u304b\u3089\u5de6\u3078\u9806\u756a\u306b\u9069\u7528\u3055\u308c\u307e\u3059\u3002</p> <pre><code>(defn add-tax\n  \"\u7a0e\u91d1\u3092\u8ffd\u52a0\u3059\u308b\"\n  [rate amount]\n  (* amount (+ 1 rate)))\n\n(defn apply-discount-rate\n  \"\u5272\u5f15\u3092\u9069\u7528\u3059\u308b\"\n  [rate amount]\n  (* amount (- 1 rate)))\n\n(defn round-to-yen\n  \"\u5186\u5358\u4f4d\u306b\u4e38\u3081\u308b\"\n  [amount]\n  (Math/round (double amount)))\n\n;; comp \u306b\u3088\u308b\u95a2\u6570\u5408\u6210\n(def calculate-final-price\n  \"\u6700\u7d42\u4fa1\u683c\u3092\u8a08\u7b97\u3059\u308b\u5408\u6210\u95a2\u6570\"\n  (comp round-to-yen\n        (partial add-tax 0.1)\n        (partial apply-discount-rate 0.2)))\n\n;; \u4f7f\u7528\u4f8b\n(calculate-final-price 1000)\n;; =&gt; 880\n;; \u51e6\u7406\u9806\u5e8f: 1000 \u2192 20%\u5272\u5f15(800) \u2192 10%\u7a0e\u8fbc(880) \u2192 \u4e38\u3081(880)\n</code></pre>"},{"location":"clojure/02-function-composition/#comp_1","title":"comp \u306e\u5229\u70b9","text":"<ol> <li>\u5ba3\u8a00\u7684\u306a\u8a18\u8ff0: \u51e6\u7406\u306e\u6d41\u308c\u3092\u95a2\u6570\u306e\u30ea\u30b9\u30c8\u3068\u3057\u3066\u8868\u73fe</li> <li>\u518d\u5229\u7528\u6027: \u5408\u6210\u3057\u305f\u95a2\u6570\u3092\u5225\u306e\u5834\u6240\u3067\u518d\u5229\u7528\u53ef\u80fd</li> <li>\u30c6\u30b9\u30c8\u5bb9\u6613\u6027: \u5404\u95a2\u6570\u3092\u500b\u5225\u306b\u30c6\u30b9\u30c8\u53ef\u80fd</li> </ol>"},{"location":"clojure/02-function-composition/#2-partial","title":"2. \u90e8\u5206\u9069\u7528 (partial)","text":""},{"location":"clojure/02-function-composition/#partial","title":"partial \u306b\u3088\u308b\u5f15\u6570\u306e\u56fa\u5b9a","text":"<p><code>partial</code> \u306f\u95a2\u6570\u306e\u4e00\u90e8\u306e\u5f15\u6570\u3092\u56fa\u5b9a\u3057\u3066\u3001\u65b0\u3057\u3044\u95a2\u6570\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002</p> <pre><code>(defn greet\n  \"\u6328\u62f6\u3059\u308b\"\n  [greeting name]\n  (str greeting \", \" name \"!\"))\n\n(def say-hello (partial greet \"Hello\"))\n(def say-goodbye (partial greet \"Goodbye\"))\n\n(say-hello \"\u7530\u4e2d\")    ;; =&gt; \"Hello, \u7530\u4e2d!\"\n(say-goodbye \"\u9234\u6728\")  ;; =&gt; \"Goodbye, \u9234\u6728!\"\n</code></pre>"},{"location":"clojure/02-function-composition/#_2","title":"\u8907\u6570\u5f15\u6570\u306e\u90e8\u5206\u9069\u7528","text":"<pre><code>(defn send-email\n  \"\u30e1\u30fc\u30eb\u3092\u9001\u4fe1\u3059\u308b\"\n  [from to subject body]\n  {:from from :to to :subject subject :body body})\n\n(def send-from-system (partial send-email \"system@example.com\"))\n(def send-notification (partial send-from-system \"user@example.com\" \"\u901a\u77e5\"))\n\n(send-notification \"\u30e1\u30c3\u30bb\u30fc\u30b8\u672c\u6587\")\n;; =&gt; {:from \"system@example.com\"\n;;     :to \"user@example.com\"\n;;     :subject \"\u901a\u77e5\"\n;;     :body \"\u30e1\u30c3\u30bb\u30fc\u30b8\u672c\u6587\"}\n</code></pre>"},{"location":"clojure/02-function-composition/#3-juxt-","title":"3. juxt - \u8907\u6570\u306e\u95a2\u6570\u3092\u4e26\u5217\u9069\u7528","text":"<p><code>juxt</code> \u306f\u8907\u6570\u306e\u95a2\u6570\u3092\u53d7\u3051\u53d6\u308a\u3001\u305d\u308c\u3089\u3092\u540c\u3058\u5f15\u6570\u306b\u9069\u7528\u3057\u3066\u30d9\u30af\u30bf\u30fc\u3067\u7d50\u679c\u3092\u8fd4\u3059\u95a2\u6570\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002</p> <pre><code>(defn get-stats\n  \"\u6570\u5024\u30ea\u30b9\u30c8\u306e\u7d71\u8a08\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\"\n  [numbers]\n  ((juxt first last count #(apply min %) #(apply max %)) numbers))\n\n(get-stats [3 1 4 1 5 9 2 6])\n;; =&gt; [3 6 8 1 9]\n;; [\u6700\u521d\u306e\u5024, \u6700\u5f8c\u306e\u5024, \u8981\u7d20\u6570, \u6700\u5c0f\u5024, \u6700\u5927\u5024]\n</code></pre>"},{"location":"clojure/02-function-composition/#_3","title":"\u5b9f\u7528\u4f8b\uff1a\u30c7\u30fc\u30bf\u5206\u6790","text":"<pre><code>(defn analyze-person\n  \"\u4eba\u7269\u60c5\u5831\u3092\u5206\u6790\u3059\u308b\"\n  [person]\n  ((juxt :name :age #(if (&gt;= (:age %) 18) :adult :minor)) person))\n\n(analyze-person {:name \"\u7530\u4e2d\" :age 25})\n;; =&gt; [\"\u7530\u4e2d\" 25 :adult]\n\n(analyze-person {:name \"\u9234\u6728\" :age 15})\n;; =&gt; [\"\u9234\u6728\" 15 :minor]\n</code></pre>"},{"location":"clojure/02-function-composition/#4","title":"4. \u9ad8\u968e\u95a2\u6570\u306b\u3088\u308b\u30c7\u30fc\u30bf\u51e6\u7406","text":"<p>\u9ad8\u968e\u95a2\u6570\u3068\u306f\u3001\u95a2\u6570\u3092\u5f15\u6570\u3068\u3057\u3066\u53d7\u3051\u53d6\u308b\u304b\u3001\u95a2\u6570\u3092\u8fd4\u3059\u95a2\u6570\u306e\u3053\u3068\u3067\u3059\u3002</p>"},{"location":"clojure/02-function-composition/#_4","title":"\u30ed\u30b0\u51fa\u529b\u306e\u30e9\u30c3\u30d1\u30fc","text":"<pre><code>(defn process-with-logging\n  \"\u51e6\u7406\u3092\u30e9\u30c3\u30d7\u3057\u3066\u30ed\u30b0\u3092\u51fa\u529b\u3059\u308b\u9ad8\u968e\u95a2\u6570\"\n  [f]\n  (fn [&amp; args]\n    (println \"\u5165\u529b:\" args)\n    (let [result (apply f args)]\n      (println \"\u51fa\u529b:\" result)\n      result)))\n\n(def add-with-log (process-with-logging +))\n(add-with-log 2 3)\n;; \u5165\u529b: (2 3)\n;; \u51fa\u529b: 5\n;; =&gt; 5\n</code></pre>"},{"location":"clojure/02-function-composition/#_5","title":"\u30ea\u30c8\u30e9\u30a4\u6a5f\u80fd\u306e\u8ffd\u52a0","text":"<pre><code>(defn retry\n  \"\u5931\u6557\u6642\u306b\u30ea\u30c8\u30e9\u30a4\u3059\u308b\u9ad8\u968e\u95a2\u6570\"\n  [f max-retries]\n  (fn [&amp; args]\n    (loop [attempts 0]\n      (let [result (try\n                     {:success true :value (apply f args)}\n                     (catch Exception e\n                       {:success false :error e}))]\n        (if (:success result)\n          (:value result)\n          (if (&lt; attempts max-retries)\n            (recur (inc attempts))\n            (throw (:error result))))))))\n\n;; \u4e0d\u5b89\u5b9a\u306aAPI\u547c\u3073\u51fa\u3057\u3092\u30ea\u30c8\u30e9\u30a4\u4ed8\u304d\u3067\u30e9\u30c3\u30d7\n(def fetch-with-retry (retry fetch-data 3))\n</code></pre>"},{"location":"clojure/02-function-composition/#ttl","title":"TTL \u4ed8\u304d\u30e1\u30e2\u5316","text":"<pre><code>(defn memoize-with-ttl\n  \"TTL\u4ed8\u304d\u30e1\u30e2\u5316\u3092\u884c\u3046\u9ad8\u968e\u95a2\u6570\"\n  [f ttl-ms]\n  (let [cache (atom {})]\n    (fn [&amp; args]\n      (let [now (System/currentTimeMillis)\n            cached (get @cache args)]\n        (if (and cached (&lt; (- now (:time cached)) ttl-ms))\n          (:value cached)\n          (let [result (apply f args)]\n            (swap! cache assoc args {:value result :time now})\n            result))))))\n</code></pre>"},{"location":"clojure/02-function-composition/#5","title":"5. \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u51e6\u7406","text":"<p>\u8907\u6570\u306e\u95a2\u6570\u3092\u9806\u6b21\u9069\u7528\u3059\u308b\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002</p> <pre><code>(defn pipeline\n  \"\u95a2\u6570\u306e\u30ea\u30b9\u30c8\u3092\u9806\u6b21\u9069\u7528\u3059\u308b\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u4f5c\u6210\u3059\u308b\"\n  [&amp; fns]\n  (fn [input]\n    (reduce (fn [acc f] (f acc)) input fns)))\n</code></pre>"},{"location":"clojure/02-function-composition/#_6","title":"\u6ce8\u6587\u51e6\u7406\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u5b9f\u88c5","text":"<pre><code>(defn validate-order\n  \"\u6ce8\u6587\u3092\u691c\u8a3c\u3059\u308b\"\n  [order]\n  (if (empty? (:items order))\n    (throw (ex-info \"\u6ce8\u6587\u306b\u30a2\u30a4\u30c6\u30e0\u304c\u3042\u308a\u307e\u305b\u3093\" {:order order}))\n    order))\n\n(defn calculate-order-total\n  \"\u6ce8\u6587\u5408\u8a08\u3092\u8a08\u7b97\u3059\u308b\"\n  [order]\n  (let [total (-&gt;&gt; (:items order)\n                   (map #(* (:price %) (:quantity %)))\n                   (reduce +))]\n    (assoc order :total total)))\n\n(defn apply-order-discount\n  \"\u6ce8\u6587\u5272\u5f15\u3092\u9069\u7528\u3059\u308b\"\n  [order]\n  (let [discount-rate (get {:gold 0.1 :silver 0.05 :bronze 0.02}\n                           (get-in order [:customer :membership])\n                           0)]\n    (update order :total #(* % (- 1 discount-rate)))))\n\n(defn add-shipping\n  \"\u9001\u6599\u3092\u8ffd\u52a0\u3059\u308b\"\n  [order]\n  (let [shipping (if (&gt;= (:total order) 5000) 0 500)]\n    (-&gt; order\n        (assoc :shipping shipping)\n        (update :total + shipping))))\n\n(def process-order-pipeline\n  \"\u6ce8\u6587\u51e6\u7406\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\"\n  (pipeline validate-order\n            calculate-order-total\n            apply-order-discount\n            add-shipping))\n\n;; \u4f7f\u7528\u4f8b\n(process-order-pipeline\n  {:items [{:price 1000 :quantity 2}\n           {:price 500 :quantity 3}]\n   :customer {:membership :gold}})\n;; =&gt; {:items [...] :customer {...} :total 3650.0 :shipping 500}\n</code></pre>"},{"location":"clojure/02-function-composition/#6","title":"6. \u95a2\u6570\u5408\u6210\u306b\u3088\u308b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3","text":"<p>\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30ed\u30b8\u30c3\u30af\u3092\u95a2\u6570\u5408\u6210\u3067\u8868\u73fe\u3057\u307e\u3059\u3002</p> <pre><code>(defn validator\n  \"\u30d0\u30ea\u30c7\u30fc\u30bf\u3092\u4f5c\u6210\u3059\u308b\u9ad8\u968e\u95a2\u6570\"\n  [pred error-msg]\n  (fn [value]\n    (if (pred value)\n      {:valid true :value value}\n      {:valid false :error error-msg :value value})))\n\n(defn combine-validators\n  \"\u8907\u6570\u306e\u30d0\u30ea\u30c7\u30fc\u30bf\u3092\u5408\u6210\u3059\u308b\"\n  [&amp; validators]\n  (fn [value]\n    (reduce (fn [result v]\n              (if (:valid result)\n                (v (:value result))\n                result))\n            {:valid true :value value}\n            validators)))\n\n;; \u500b\u5225\u306e\u30d0\u30ea\u30c7\u30fc\u30bf\n(def validate-positive (validator pos? \"\u5024\u306f\u6b63\u306e\u6570\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"))\n(def validate-under-100 (validator #(&lt; % 100) \"\u5024\u306f100\u672a\u6e80\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"))\n(def validate-integer (validator integer? \"\u5024\u306f\u6574\u6570\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"))\n\n;; \u30d0\u30ea\u30c7\u30fc\u30bf\u306e\u5408\u6210\n(def validate-quantity\n  \"\u6570\u91cf\u30d0\u30ea\u30c7\u30fc\u30bf\"\n  (combine-validators validate-integer\n                      validate-positive\n                      validate-under-100))\n\n;; \u4f7f\u7528\u4f8b\n(validate-quantity 50)   ;; =&gt; {:valid true, :value 50}\n(validate-quantity -1)   ;; =&gt; {:valid false, :error \"\u5024\u306f\u6b63\u306e\u6570\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\", :value -1}\n(validate-quantity 100)  ;; =&gt; {:valid false, :error \"\u5024\u306f100\u672a\u6e80\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\", :value 100}\n</code></pre>"},{"location":"clojure/02-function-composition/#7","title":"7. \u95a2\u6570\u306e\u5909\u63db","text":"<p>\u95a2\u6570\u81ea\u4f53\u3092\u5909\u63db\u3059\u308b\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u95a2\u6570\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002</p>"},{"location":"clojure/02-function-composition/#_7","title":"\u5f15\u6570\u306e\u9806\u5e8f\u3092\u53cd\u8ee2","text":"<pre><code>(defn flip\n  \"\u5f15\u6570\u306e\u9806\u5e8f\u3092\u53cd\u8ee2\u3059\u308b\"\n  [f]\n  (fn [a b]\n    (f b a)))\n\n((flip -) 3 5)  ;; =&gt; 2  (5 - 3)\n</code></pre>"},{"location":"clojure/02-function-composition/#_8","title":"\u30ab\u30ea\u30fc\u5316","text":"<pre><code>(defn curry\n  \"2\u5f15\u6570\u95a2\u6570\u3092\u30ab\u30ea\u30fc\u5316\u3059\u308b\"\n  [f]\n  (fn [a]\n    (fn [b]\n      (f a b))))\n\n(defn uncurry\n  \"\u30ab\u30ea\u30fc\u5316\u3055\u308c\u305f\u95a2\u6570\u3092\u5143\u306b\u623b\u3059\"\n  [f]\n  (fn [a b]\n    ((f a) b)))\n\n(def curried-add (curry +))\n(def add5 (curried-add 5))\n(add5 3)  ;; =&gt; 8\n</code></pre>"},{"location":"clojure/02-function-composition/#8","title":"8. \u95a2\u6570\u5408\u6210\u306e\u30d1\u30bf\u30fc\u30f3","text":""},{"location":"clojure/02-function-composition/#_9","title":"\u8ff0\u8a9e\u306e\u5408\u6210","text":"<pre><code>(defn compose-predicates\n  \"\u8907\u6570\u306e\u8ff0\u8a9e\u3092 AND \u3067\u5408\u6210\u3059\u308b\"\n  [&amp; preds]\n  (fn [x]\n    (every? #(% x) preds)))\n\n(defn compose-predicates-or\n  \"\u8907\u6570\u306e\u8ff0\u8a9e\u3092 OR \u3067\u5408\u6210\u3059\u308b\"\n  [&amp; preds]\n  (fn [x]\n    (some #(% x) preds)))\n\n;; \u6709\u52b9\u306a\u5e74\u9f62\u30c1\u30a7\u30c3\u30af\n(def valid-age?\n  (compose-predicates integer?\n                      pos?\n                      #(&lt;= % 150)))\n\n(valid-age? 25)   ;; =&gt; true\n(valid-age? -1)   ;; =&gt; false\n(valid-age? 200)  ;; =&gt; false\n\n;; \u30d7\u30ec\u30df\u30a2\u30e0\u9867\u5ba2\u30c1\u30a7\u30c3\u30af\n(def premium-customer?\n  (compose-predicates-or\n   #(= (:membership %) :gold)\n   #(&gt;= (:purchase-count %) 100)\n   #(&gt;= (:total-spent %) 100000)))\n\n(premium-customer? {:membership :gold})           ;; =&gt; true\n(premium-customer? {:purchase-count 150})         ;; =&gt; true\n(premium-customer? {:membership :bronze\n                    :purchase-count 10})          ;; =&gt; false\n</code></pre>"},{"location":"clojure/02-function-composition/#_10","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u95a2\u6570\u5408\u6210\u3068\u9ad8\u968e\u95a2\u6570\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>comp: \u8907\u6570\u306e\u95a2\u6570\u3092\u5408\u6210\u3057\u3066\u65b0\u3057\u3044\u95a2\u6570\u3092\u4f5c\u6210</li> <li>partial: \u5f15\u6570\u3092\u90e8\u5206\u9069\u7528\u3057\u3066\u7279\u5316\u3057\u305f\u95a2\u6570\u3092\u4f5c\u6210</li> <li>juxt: \u8907\u6570\u306e\u95a2\u6570\u3092\u4e26\u5217\u9069\u7528\u3057\u3066\u30d9\u30af\u30bf\u30fc\u3067\u7d50\u679c\u3092\u53d6\u5f97</li> <li>\u9ad8\u968e\u95a2\u6570: \u30ed\u30b0\u3001\u30ea\u30c8\u30e9\u30a4\u3001\u30e1\u30e2\u5316\u306a\u3069\u306e\u6a2a\u65ad\u7684\u95a2\u5fc3\u4e8b\u3092\u62bd\u8c61\u5316</li> <li>\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3: \u51e6\u7406\u306e\u6d41\u308c\u3092\u95a2\u6570\u306e\u30c1\u30a7\u30fc\u30f3\u3068\u3057\u3066\u8868\u73fe</li> <li>\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3: \u95a2\u6570\u5408\u6210\u306b\u3088\u308b\u67d4\u8edf\u306a\u691c\u8a3c\u30ed\u30b8\u30c3\u30af</li> <li>\u8ff0\u8a9e\u5408\u6210: AND/OR \u3067\u8907\u6570\u306e\u6761\u4ef6\u3092\u7d44\u307f\u5408\u308f\u305b</li> </ol> <p>\u3053\u308c\u3089\u306e\u30c6\u30af\u30cb\u30c3\u30af\u306b\u3088\u308a\u3001\u5c0f\u3055\u304f\u518d\u5229\u7528\u53ef\u80fd\u306a\u95a2\u6570\u304b\u3089\u8907\u96d1\u306a\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u3092\u69cb\u7bc9\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"clojure/02-function-composition/#_11","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part1/src/composition.clj</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part1/spec/composition_spec.clj</code></li> </ul>"},{"location":"clojure/02-function-composition/#_12","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001\u591a\u614b\u6027\u3068\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u3001\u30d7\u30ed\u30c8\u30b3\u30eb\u3001\u30ec\u30b3\u30fc\u30c9\u3092\u6d3b\u7528\u3057\u305f\u67d4\u8edf\u306a\u8a2d\u8a08\u30d1\u30bf\u30fc\u30f3\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/03-polymorphism/","title":"\u7b2c3\u7ae0: \u591a\u614b\u6027\u3068\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1","text":""},{"location":"clojure/03-polymorphism/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u591a\u614b\u6027\uff08\u30dd\u30ea\u30e2\u30fc\u30d5\u30a3\u30ba\u30e0\uff09\u306f\u3001\u540c\u3058\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u7570\u306a\u308b\u632f\u308b\u821e\u3044\u3092\u5b9f\u73fe\u3059\u308b\u5f37\u529b\u306a\u6982\u5ff5\u3067\u3059\u3002Clojure \u3067\u306f\u3001\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u3001\u30d7\u30ed\u30c8\u30b3\u30eb\u3001\u30ec\u30b3\u30fc\u30c9\u3068\u3044\u30463\u3064\u306e\u4e3b\u8981\u306a\u30e1\u30ab\u30cb\u30ba\u30e0\u3067\u591a\u614b\u6027\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u3053\u308c\u3089\u306e\u30e1\u30ab\u30cb\u30ba\u30e0\u3092\u4f7f\u3044\u5206\u3051\u3066\u3001\u67d4\u8edf\u3067\u62e1\u5f35\u6027\u306e\u9ad8\u3044\u30b3\u30fc\u30c9\u3092\u66f8\u304f\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/03-polymorphism/#1-multimethods","title":"1. \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\uff08Multimethods\uff09","text":"<p>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306f\u3001\u4efb\u610f\u306e\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u95a2\u6570\u306b\u57fa\u3065\u3044\u3066\u7570\u306a\u308b\u5b9f\u88c5\u3092\u9078\u629e\u3067\u304d\u308b\u3001\u6700\u3082\u67d4\u8edf\u306a\u591a\u614b\u6027\u30e1\u30ab\u30cb\u30ba\u30e0\u3067\u3059\u3002</p>"},{"location":"clojure/03-polymorphism/#_2","title":"\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9","text":"<pre><code>;; \u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u95a2\u6570\u3092\u5b9a\u7fa9\n(defmulti calculate-area\n  \"\u56f3\u5f62\u306e\u9762\u7a4d\u3092\u8a08\u7b97\u3059\u308b\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\"\n  :shape)\n\n;; \u5404\u56f3\u5f62\u30bf\u30a4\u30d7\u306b\u5bfe\u3059\u308b\u5b9f\u88c5\n(defmethod calculate-area :rectangle\n  [{:keys [width height]}]\n  (* width height))\n\n(defmethod calculate-area :circle\n  [{:keys [radius]}]\n  (* Math/PI radius radius))\n\n(defmethod calculate-area :triangle\n  [{:keys [base height]}]\n  (/ (* base height) 2))\n\n(defmethod calculate-area :default\n  [shape]\n  (throw (ex-info \"\u672a\u77e5\u306e\u56f3\u5f62\u30bf\u30a4\u30d7\" {:shape shape})))\n\n;; \u4f7f\u7528\u4f8b\n(calculate-area {:shape :rectangle :width 4 :height 5})  ;; =&gt; 20\n(calculate-area {:shape :circle :radius 3})              ;; =&gt; 28.27...\n(calculate-area {:shape :triangle :base 6 :height 5})    ;; =&gt; 15\n</code></pre>"},{"location":"clojure/03-polymorphism/#_3","title":"\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306e\u5229\u70b9","text":"<ol> <li>\u30aa\u30fc\u30d7\u30f3\u306a\u62e1\u5f35\u6027: \u65b0\u3057\u3044\u578b\u3092\u8ffd\u52a0\u3057\u3066\u3082\u65e2\u5b58\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u4e0d\u8981</li> <li>\u4efb\u610f\u306e\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1: \u578b\u3060\u3051\u3067\u306a\u304f\u4efb\u610f\u306e\u5024\u306b\u57fa\u3065\u3044\u3066\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u53ef\u80fd</li> <li>\u30c7\u30fc\u30bf\u99c6\u52d5: \u30c7\u30fc\u30bf\u306e\u5c5e\u6027\u306b\u57fa\u3065\u3044\u3066\u632f\u308b\u821e\u3044\u3092\u6c7a\u5b9a</li> </ol>"},{"location":"clojure/03-polymorphism/#2","title":"2. \u8907\u5408\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1","text":"<p>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306f\u8907\u6570\u306e\u5024\u306b\u57fa\u3065\u3044\u3066\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u3067\u304d\u307e\u3059\u3002</p> <pre><code>(defmulti process-payment\n  \"\u652f\u6255\u3044\u3092\u51e6\u7406\u3059\u308b\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\uff08\u652f\u6255\u3044\u65b9\u6cd5\u3068\u901a\u8ca8\u3067\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\uff09\"\n  (fn [payment] [(:method payment) (:currency payment)]))\n\n(defmethod process-payment [:credit-card :jpy]\n  [payment]\n  {:status :processed\n   :message \"\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\uff08\u5186\uff09\u3067\u51e6\u7406\u3057\u307e\u3057\u305f\"\n   :amount (:amount payment)})\n\n(defmethod process-payment [:credit-card :usd]\n  [payment]\n  {:status :processed\n   :message \"Credit card (USD) processed\"\n   :amount (:amount payment)\n   :converted (* (:amount payment) 150)})\n\n(defmethod process-payment [:bank-transfer :jpy]\n  [payment]\n  {:status :pending\n   :message \"\u9280\u884c\u632f\u8fbc\u3092\u53d7\u3051\u4ed8\u3051\u307e\u3057\u305f\"\n   :amount (:amount payment)})\n\n(defmethod process-payment :default\n  [payment]\n  {:status :error\n   :message \"\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u652f\u6255\u3044\u65b9\u6cd5\u3067\u3059\"})\n\n;; \u4f7f\u7528\u4f8b\n(process-payment {:method :credit-card :currency :jpy :amount 1000})\n;; =&gt; {:status :processed, :message \"\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\uff08\u5186\uff09\u3067\u51e6\u7406\u3057\u307e\u3057\u305f\", :amount 1000}\n</code></pre>"},{"location":"clojure/03-polymorphism/#3_1","title":"3. \u968e\u5c64\u7684\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1","text":"<p>Clojure \u3067\u306f\u578b\u306e\u968e\u5c64\u3092\u5b9a\u7fa9\u3057\u3066\u3001\u7d99\u627f\u7684\u306a\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u3092\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002</p> <pre><code>;; \u578b\u968e\u5c64\u3092\u5b9a\u7fa9\n(derive ::savings ::account)\n(derive ::checking ::account)\n(derive ::premium-savings ::savings)\n\n(defmulti calculate-interest\n  \"\u5229\u606f\u3092\u8a08\u7b97\u3059\u308b\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\uff08\u53e3\u5ea7\u30bf\u30a4\u30d7\u3067\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\uff09\"\n  :account-type)\n\n(defmethod calculate-interest ::savings\n  [{:keys [balance]}]\n  (* balance 0.02))\n\n(defmethod calculate-interest ::premium-savings\n  [{:keys [balance]}]\n  (* balance 0.05))\n\n(defmethod calculate-interest ::checking\n  [{:keys [balance]}]\n  (* balance 0.001))\n\n(defmethod calculate-interest ::account\n  [{:keys [balance]}]\n  (* balance 0.01))\n\n;; \u4f7f\u7528\u4f8b\n(calculate-interest {:account-type ::savings :balance 10000})\n;; =&gt; 200.0\n\n(calculate-interest {:account-type ::premium-savings :balance 10000})\n;; =&gt; 500.0\uff08\u6d3e\u751f\u578b\u306e\u5b9f\u88c5\u304c\u512a\u5148\u3055\u308c\u308b\uff09\n</code></pre>"},{"location":"clojure/03-polymorphism/#4-protocols","title":"4. \u30d7\u30ed\u30c8\u30b3\u30eb\uff08Protocols\uff09","text":"<p>\u30d7\u30ed\u30c8\u30b3\u30eb\u306f\u3001\u7279\u5b9a\u306e\u64cd\u4f5c\u30bb\u30c3\u30c8\u3092\u5b9a\u7fa9\u3059\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u3059\u3002Java \u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306b\u4f3c\u3066\u3044\u307e\u3059\u304c\u3001\u65e2\u5b58\u306e\u578b\u306b\u5f8c\u304b\u3089\u5b9f\u88c5\u3092\u8ffd\u52a0\u3067\u304d\u308b\u70b9\u304c\u7570\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/03-polymorphism/#_4","title":"\u30d7\u30ed\u30c8\u30b3\u30eb\u306e\u5b9a\u7fa9","text":"<pre><code>(defprotocol Drawable\n  \"\u63cf\u753b\u53ef\u80fd\u306a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\"\n  (draw [this] \"\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u63cf\u753b\u3059\u308b\")\n  (bounding-box [this] \"\u30d0\u30a6\u30f3\u30c7\u30a3\u30f3\u30b0\u30dc\u30c3\u30af\u30b9\u3092\u53d6\u5f97\u3059\u308b\"))\n\n(defprotocol Transformable\n  \"\u5909\u63db\u53ef\u80fd\u306a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\"\n  (translate [this dx dy] \"\u79fb\u52d5\u3059\u308b\")\n  (scale [this factor] \"\u62e1\u5927\u30fb\u7e2e\u5c0f\u3059\u308b\")\n  (rotate [this angle] \"\u56de\u8ee2\u3059\u308b\"))\n</code></pre>"},{"location":"clojure/03-polymorphism/#_5","title":"\u30d7\u30ed\u30c8\u30b3\u30eb\u306e\u5229\u70b9","text":"<ol> <li>\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9: \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u3088\u308a\u9ad8\u901f\uff08\u578b\u30d9\u30fc\u30b9\u306e\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u306b\u7279\u5316\uff09</li> <li>\u660e\u78ba\u306a\u30b3\u30f3\u30c8\u30e9\u30af\u30c8: \u5b9f\u88c5\u3059\u3079\u304d\u30e1\u30bd\u30c3\u30c9\u304c\u660e\u793a\u7684</li> <li>\u65e2\u5b58\u578b\u3078\u306e\u62e1\u5f35: \u5f8c\u304b\u3089\u4efb\u610f\u306e\u578b\u306b\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u5b9f\u88c5\u53ef\u80fd</li> </ol>"},{"location":"clojure/03-polymorphism/#5-records","title":"5. \u30ec\u30b3\u30fc\u30c9\uff08Records\uff09","text":"<p>\u30ec\u30b3\u30fc\u30c9\u306f\u30de\u30c3\u30d7\u306b\u4f3c\u305f\u30c7\u30fc\u30bf\u69cb\u9020\u3067\u3001\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p> <pre><code>(defrecord Rectangle [x y width height]\n  Drawable\n  (draw [this]\n    (str \"Rectangle at (\" x \",\" y \") with size \" width \"x\" height))\n  (bounding-box [this]\n    {:x x :y y :width width :height height})\n\n  Transformable\n  (translate [this dx dy]\n    (-&gt;Rectangle (+ x dx) (+ y dy) width height))\n  (scale [this factor]\n    (-&gt;Rectangle x y (* width factor) (* height factor)))\n  (rotate [this angle]\n    this))\n\n(defrecord Circle [x y radius]\n  Drawable\n  (draw [this]\n    (str \"Circle at (\" x \",\" y \") with radius \" radius))\n  (bounding-box [this]\n    {:x (- x radius) :y (- y radius)\n     :width (* 2 radius) :height (* 2 radius)})\n\n  Transformable\n  (translate [this dx dy]\n    (-&gt;Circle (+ x dx) (+ y dy) radius))\n  (scale [this factor]\n    (-&gt;Circle x y (* radius factor)))\n  (rotate [this angle]\n    this))\n\n;; \u4f7f\u7528\u4f8b\n(def rect (-&gt;Rectangle 10 20 100 50))\n(draw rect)           ;; =&gt; \"Rectangle at (10,20) with size 100x50\"\n(translate rect 5 10) ;; =&gt; #Rectangle{:x 15, :y 30, :width 100, :height 50}\n\n(def circle (-&gt;Circle 50 50 25))\n(bounding-box circle) ;; =&gt; {:x 25, :y 25, :width 50, :height 50}\n</code></pre>"},{"location":"clojure/03-polymorphism/#6","title":"6. \u65e2\u5b58\u306e\u578b\u306b\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u62e1\u5f35","text":"<p><code>extend-protocol</code> \u3092\u4f7f\u3063\u3066\u3001\u65e2\u5b58\u306e\u578b\u306b\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p> <pre><code>(defprotocol Stringable\n  \"\u6587\u5b57\u5217\u306b\u5909\u63db\u53ef\u80fd\u306a\u30d7\u30ed\u30c8\u30b3\u30eb\"\n  (to-string [this] \"\u6587\u5b57\u5217\u8868\u73fe\u3092\u8fd4\u3059\"))\n\n(extend-protocol Stringable\n  clojure.lang.IPersistentMap\n  (to-string [this]\n    (str \"{\" (clojure.string/join \", \"\n                                   (map (fn [[k v]] (str (name k) \": \" v)) this)) \"}\"))\n\n  clojure.lang.IPersistentVector\n  (to-string [this]\n    (str \"[\" (clojure.string/join \", \" this) \"]\"))\n\n  java.lang.String\n  (to-string [this] this)\n\n  java.lang.Number\n  (to-string [this] (str this))\n\n  nil\n  (to-string [this] \"nil\"))\n\n;; \u4f7f\u7528\u4f8b\n(to-string {:name \"\u7530\u4e2d\" :age 30})  ;; =&gt; \"{name: \u7530\u4e2d, age: 30}\"\n(to-string [1 2 3])                  ;; =&gt; \"[1, 2, 3]\"\n(to-string nil)                      ;; =&gt; \"nil\"\n</code></pre>"},{"location":"clojure/03-polymorphism/#7","title":"7. \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u30d1\u30bf\u30fc\u30f3","text":"<p>\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u4f7f\u3063\u3066\u3001\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u7ba1\u7406\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p> <pre><code>(defprotocol Lifecycle\n  \"\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u7ba1\u7406\u30d7\u30ed\u30c8\u30b3\u30eb\"\n  (start [this] \"\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u958b\u59cb\u3059\u308b\")\n  (stop [this] \"\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u505c\u6b62\u3059\u308b\"))\n\n(defrecord DatabaseConnection [host port connected?]\n  Lifecycle\n  (start [this]\n    (println \"\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u63a5\u7d9a\u4e2d:\" host \":\" port)\n    (assoc this :connected? true))\n  (stop [this]\n    (println \"\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\u3092\u5207\u65ad\u4e2d\")\n    (assoc this :connected? false)))\n\n(defrecord WebServer [port db running?]\n  Lifecycle\n  (start [this]\n    (println \"Web\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u4e2d \u30dd\u30fc\u30c8:\" port)\n    (let [started-db (start db)]\n      (assoc this :db started-db :running? true)))\n  (stop [this]\n    (println \"Web\u30b5\u30fc\u30d0\u30fc\u3092\u505c\u6b62\u4e2d\")\n    (let [stopped-db (stop db)]\n      (assoc this :db stopped-db :running? false))))\n\n;; \u4f7f\u7528\u4f8b\n(def db (-&gt;DatabaseConnection \"localhost\" 5432 false))\n(def server (-&gt;WebServer 8080 db false))\n\n(def started-server (start server))\n;; \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u63a5\u7d9a\u4e2d: localhost : 5432\n;; Web\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u4e2d \u30dd\u30fc\u30c8: 8080\n\n(def stopped-server (stop started-server))\n;; Web\u30b5\u30fc\u30d0\u30fc\u3092\u505c\u6b62\u4e2d\n;; \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\u3092\u5207\u65ad\u4e2d\n</code></pre>"},{"location":"clojure/03-polymorphism/#8","title":"8. \u6761\u4ef6\u5206\u5c90\u306e\u7f6e\u304d\u63db\u3048","text":"<p>\u591a\u614b\u6027\u3092\u4f7f\u3063\u3066\u3001switch/case \u6587\u306b\u3088\u308b\u578b\u5224\u5b9a\u3092\u6392\u9664\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"clojure/03-polymorphism/#before","title":"Before\uff08\u6761\u4ef6\u5206\u5c90\uff09","text":"<pre><code>;; \u60aa\u3044\u4f8b\uff1a\u578b\u306b\u3088\u308b\u6761\u4ef6\u5206\u5c90\n(defn send-notification-bad [type message opts]\n  (case type\n    :email {:type :email :to (:to opts) :body message}\n    :sms {:type :sms :to (:phone opts) :body (subs message 0 (min 160 (count message)))}\n    :push {:type :push :device (:device opts) :body message}\n    (throw (ex-info \"\u672a\u77e5\u306e\u901a\u77e5\u30bf\u30a4\u30d7\" {:type type}))))\n</code></pre>"},{"location":"clojure/03-polymorphism/#after","title":"After\uff08\u591a\u614b\u6027\uff09","text":"<pre><code>(defprotocol NotificationSender\n  \"\u901a\u77e5\u9001\u4fe1\u30d7\u30ed\u30c8\u30b3\u30eb\"\n  (send-notification [this message] \"\u901a\u77e5\u3092\u9001\u4fe1\u3059\u308b\")\n  (get-delivery-time [this] \"\u914d\u4fe1\u6642\u9593\u3092\u53d6\u5f97\u3059\u308b\"))\n\n(defrecord EmailNotification [to subject]\n  NotificationSender\n  (send-notification [this message]\n    {:type :email\n     :to to\n     :subject subject\n     :body message\n     :status :sent})\n  (get-delivery-time [this]\n    \"1-2\u5206\"))\n\n(defrecord SMSNotification [phone-number]\n  NotificationSender\n  (send-notification [this message]\n    {:type :sms\n     :to phone-number\n     :body (if (&gt; (count message) 160)\n             (subs message 0 157)\n             message)\n     :status :sent})\n  (get-delivery-time [this]\n    \"\u6570\u79d2\"))\n\n(defrecord PushNotification [device-token]\n  NotificationSender\n  (send-notification [this message]\n    {:type :push\n     :device device-token\n     :body message\n     :status :sent})\n  (get-delivery-time [this]\n    \"\u5373\u6642\"))\n\n;; \u30d5\u30a1\u30af\u30c8\u30ea\u95a2\u6570\n(defn create-notification\n  \"\u901a\u77e5\u30bf\u30a4\u30d7\u306b\u5fdc\u3058\u305f\u901a\u77e5\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u4f5c\u6210\u3059\u308b\"\n  [type &amp; {:as opts}]\n  (case type\n    :email (-&gt;EmailNotification (:to opts) (:subject opts \"\u901a\u77e5\"))\n    :sms (-&gt;SMSNotification (:phone opts))\n    :push (-&gt;PushNotification (:device opts))\n    (throw (ex-info \"\u672a\u77e5\u306e\u901a\u77e5\u30bf\u30a4\u30d7\" {:type type}))))\n\n;; \u4f7f\u7528\u4f8b\n(def email (create-notification :email :to \"user@example.com\"))\n(send-notification email \"\u91cd\u8981\u306a\u304a\u77e5\u3089\u305b\")\n;; =&gt; {:type :email, :to \"user@example.com\", :subject \"\u901a\u77e5\", :body \"\u91cd\u8981\u306a\u304a\u77e5\u3089\u305b\", :status :sent}\n</code></pre>"},{"location":"clojure/03-polymorphism/#9","title":"9. \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u3068\u30d7\u30ed\u30c8\u30b3\u30eb\u306e\u4f7f\u3044\u5206\u3051","text":"\u7279\u5fb4 \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9 \u30d7\u30ed\u30c8\u30b3\u30eb \u30c7\u30a3\u30b9\u30d1\u30c3\u30c1 \u4efb\u610f\u306e\u95a2\u6570 \u7b2c\u4e00\u5f15\u6570\u306e\u578b \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9 \u9045\u3044 \u901f\u3044 \u62e1\u5f35\u6027 \u975e\u5e38\u306b\u9ad8\u3044 \u9ad8\u3044 \u7528\u9014 \u8907\u96d1\u306a\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1 \u578b\u30d9\u30fc\u30b9\u306e\u591a\u614b\u6027"},{"location":"clojure/03-polymorphism/#_6","title":"\u4f7f\u3044\u5206\u3051\u306e\u6307\u91dd","text":"<ul> <li>\u30d7\u30ed\u30c8\u30b3\u30eb: \u578b\u306b\u57fa\u3065\u304f\u5358\u7d14\u306a\u591a\u614b\u6027\u3067\u5341\u5206\u306a\u5834\u5408</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: \u8907\u6570\u306e\u5024\u3084\u8907\u96d1\u306a\u6761\u4ef6\u3067\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u304c\u5fc5\u8981\u306a\u5834\u5408</li> </ul>"},{"location":"clojure/03-polymorphism/#_7","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Clojure \u306b\u304a\u3051\u308b\u591a\u614b\u6027\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: \u4efb\u610f\u306e\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u95a2\u6570\u306b\u3088\u308b\u67d4\u8edf\u306a\u591a\u614b\u6027</li> <li>\u8907\u5408\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1: \u8907\u6570\u306e\u5024\u306b\u57fa\u3065\u304f\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1</li> <li>\u968e\u5c64\u7684\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1: \u578b\u968e\u5c64\u3092\u4f7f\u3063\u305f\u7d99\u627f\u7684\u306a\u632f\u308b\u821e\u3044</li> <li>\u30d7\u30ed\u30c8\u30b3\u30eb: \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u826f\u3044\u578b\u30d9\u30fc\u30b9\u306e\u591a\u614b\u6027</li> <li>\u30ec\u30b3\u30fc\u30c9: \u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u5b9f\u88c5\u3059\u308b\u30c7\u30fc\u30bf\u69cb\u9020</li> <li>\u65e2\u5b58\u578b\u3078\u306e\u62e1\u5f35: \u5f8c\u304b\u3089\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u5b9f\u88c5</li> <li>\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u30d1\u30bf\u30fc\u30f3: \u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u7ba1\u7406</li> <li>\u6761\u4ef6\u5206\u5c90\u306e\u7f6e\u304d\u63db\u3048: switch \u6587\u3092\u591a\u614b\u6027\u3067\u4ee3\u66ff</li> </ol> <p>\u3053\u308c\u3089\u306e\u30e1\u30ab\u30cb\u30ba\u30e0\u3092\u9069\u5207\u306b\u4f7f\u3044\u5206\u3051\u308b\u3053\u3068\u3067\u3001\u62e1\u5f35\u6027\u304c\u9ad8\u304f\u4fdd\u5b88\u3057\u3084\u3059\u3044\u30b3\u30fc\u30c9\u3092\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"clojure/03-polymorphism/#_8","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part1/src/polymorphism.clj</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part1/spec/polymorphism_spec.clj</code></li> </ul>"},{"location":"clojure/03-polymorphism/#_9","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u304b\u3089\u7b2c2\u90e8\u300c\u4ed5\u69d8\u3068\u30c6\u30b9\u30c8\u300d\u306b\u5165\u308a\u307e\u3059\u3002Clojure Spec \u3092\u4f7f\u3063\u305f\u30c7\u30fc\u30bf\u306e\u4ed5\u69d8\u5b9a\u7fa9\u3068\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/04-clojure-spec/","title":"\u7b2c4\u7ae0: Clojure Spec \u306b\u3088\u308b\u4ed5\u69d8\u5b9a\u7fa9","text":""},{"location":"clojure/04-clojure-spec/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Clojure Spec \u306f\u3001\u30c7\u30fc\u30bf\u69cb\u9020\u3068\u95a2\u6570\u306e\u4ed5\u69d8\u3092\u5b9a\u7fa9\u3059\u308b\u305f\u3081\u306e\u5f37\u529b\u306a\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059\u3002\u578b\u30b7\u30b9\u30c6\u30e0\u3068\u306f\u7570\u306a\u308a\u3001Spec \u306f\u5b9f\u884c\u6642\u306b\u30c7\u30fc\u30bf\u3092\u691c\u8a3c\u3057\u3001\u81ea\u52d5\u30c6\u30b9\u30c8\u3092\u751f\u6210\u3057\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3068\u3057\u3066\u3082\u6a5f\u80fd\u3057\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001Spec \u3092\u4f7f\u3063\u3066\u30c7\u30fc\u30bf\u306e\u4ed5\u69d8\u3092\u5b9a\u7fa9\u3057\u3001\u95a2\u6570\u306e\u5951\u7d04\u3092\u8868\u73fe\u3057\u3001\u81ea\u52d5\u30c6\u30b9\u30c8\u751f\u6210\u3092\u6d3b\u7528\u3059\u308b\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/04-clojure-spec/#1","title":"1. \u57fa\u672c\u7684\u306a\u30b9\u30da\u30c3\u30af\u5b9a\u7fa9","text":""},{"location":"clojure/04-clojure-spec/#_2","title":"\u30b9\u30da\u30c3\u30af\u3068\u306f","text":"<p>\u30b9\u30da\u30c3\u30af\u306f\u3001\u30c7\u30fc\u30bf\u304c\u6e80\u305f\u3059\u3079\u304d\u6761\u4ef6\u3092\u5ba3\u8a00\u7684\u306b\u5b9a\u7fa9\u3057\u307e\u3059\u3002</p> <pre><code>(require '[clojure.spec.alpha :as s])\n\n;; \u30b7\u30f3\u30d7\u30eb\u306a\u30b9\u30da\u30c3\u30af\n(s/def ::name (s/and string? #(&lt; 0 (count %) 100)))\n(s/def ::age (s/and int? #(&lt;= 0 % 150)))\n(s/def ::email (s/and string? #(re-matches #\".+@.+\\..+\" %)))\n\n;; \u5217\u6319\u578b\u306e\u30b9\u30da\u30c3\u30af\n(s/def ::membership #{:bronze :silver :gold :platinum})\n(s/def ::status #{:active :inactive :suspended})\n</code></pre>"},{"location":"clojure/04-clojure-spec/#_3","title":"\u30b9\u30da\u30c3\u30af\u306e\u691c\u8a3c","text":"<pre><code>;; valid? \u3067\u691c\u8a3c\n(s/valid? ::name \"\u7530\u4e2d\u592a\u90ce\")  ;; =&gt; true\n(s/valid? ::name \"\")          ;; =&gt; false\uff08\u7a7a\u6587\u5b57\u5217\uff09\n(s/valid? ::age 25)           ;; =&gt; true\n(s/valid? ::age -1)           ;; =&gt; false\uff08\u8ca0\u306e\u6570\uff09\n\n;; explain \u3067\u30a8\u30e9\u30fc\u8a73\u7d30\u3092\u8868\u793a\n(s/explain ::age -1)\n;; val: -1 fails spec: :user/age predicate: (&lt;= 0 % 150)\n</code></pre>"},{"location":"clojure/04-clojure-spec/#2","title":"2. \u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u306e\u30b9\u30da\u30c3\u30af","text":""},{"location":"clojure/04-clojure-spec/#_4","title":"\u30d9\u30af\u30bf\u30fc\u3068\u30ea\u30b9\u30c8","text":"<pre><code>;; \u30d9\u30af\u30bf\u30fc\u306e\u30b9\u30da\u30c3\u30af\n(s/def ::tags (s/coll-of string? :kind vector? :min-count 0 :max-count 10))\n\n(s/valid? ::tags [\"tag1\" \"tag2\"])  ;; =&gt; true\n(s/valid? ::tags '(\"tag1\"))        ;; =&gt; false\uff08\u30ea\u30b9\u30c8\u306f\u4e0d\u53ef\uff09\n</code></pre>"},{"location":"clojure/04-clojure-spec/#_5","title":"\u30de\u30c3\u30d7\u306e\u30b9\u30da\u30c3\u30af","text":"<pre><code>;; \u5fc5\u9808\u30ad\u30fc\u3068\u30aa\u30d7\u30b7\u30e7\u30f3\u30ad\u30fc\n(s/def ::person\n  (s/keys :req-un [::name ::age]\n          :opt-un [::email ::membership]))\n\n(s/valid? ::person {:name \"\u7530\u4e2d\" :age 30})  ;; =&gt; true\n(s/valid? ::person {:name \"\u7530\u4e2d\" :age 30 :email \"tanaka@example.com\"})  ;; =&gt; true\n(s/valid? ::person {:name \"\u7530\u4e2d\"})  ;; =&gt; false\uff08age \u304c\u6b20\u843d\uff09\n</code></pre>"},{"location":"clojure/04-clojure-spec/#_6","title":"\u5165\u308c\u5b50\u306e\u30de\u30c3\u30d7","text":"<pre><code>(s/def ::street string?)\n(s/def ::city string?)\n(s/def ::postal-code (s/and string? #(re-matches #\"\\d{3}-\\d{4}\" %)))\n\n(s/def ::address\n  (s/keys :req-un [::street ::city ::postal-code]))\n\n(s/def ::person-with-address\n  (s/keys :req-un [::name ::age ::address]))\n\n(s/valid? ::person-with-address\n          {:name \"\u7530\u4e2d\"\n           :age 30\n           :address {:street \"\u6771\u4eac\u90fd\u6e0b\u8c37\u533a1-1-1\"\n                     :city \"\u6e0b\u8c37\u533a\"\n                     :postal-code \"150-0001\"}})\n;; =&gt; true\n</code></pre>"},{"location":"clojure/04-clojure-spec/#3","title":"3. \u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30eb\u306e\u5b9a\u7fa9","text":""},{"location":"clojure/04-clojure-spec/#_7","title":"\u5546\u54c1\u3068\u6ce8\u6587","text":"<pre><code>;; \u5546\u54c1\n(s/def ::product-id (s/and string? #(re-matches #\"PROD-\\d{5}\" %)))\n(s/def ::product-name (s/and string? #(&lt; 0 (count %) 200)))\n(s/def ::price (s/and number? pos?))\n(s/def ::quantity (s/and int? pos?))\n\n(s/def ::product\n  (s/keys :req-un [::product-id ::product-name ::price]\n          :opt-un [::description ::category]))\n\n;; \u6ce8\u6587\u30a2\u30a4\u30c6\u30e0\n(s/def ::order-item\n  (s/keys :req-un [::product-id ::quantity ::price]))\n\n;; \u6ce8\u6587\n(s/def ::order-id (s/and string? #(re-matches #\"ORD-\\d{8}\" %)))\n(s/def ::customer-id (s/and string? #(re-matches #\"CUST-\\d{6}\" %)))\n(s/def ::items (s/coll-of ::order-item :min-count 1))\n\n(s/def ::order\n  (s/keys :req-un [::order-id ::customer-id ::items ::order-date]\n          :opt-un [::total ::status]))\n</code></pre>"},{"location":"clojure/04-clojure-spec/#4-fdef","title":"4. \u95a2\u6570\u4ed5\u69d8\u306e\u5b9a\u7fa9\uff08fdef\uff09","text":""},{"location":"clojure/04-clojure-spec/#fdef","title":"\u57fa\u672c\u7684\u306a fdef","text":"<p><code>s/fdef</code> \u3092\u4f7f\u3063\u3066\u95a2\u6570\u306e\u5f15\u6570\u3001\u623b\u308a\u5024\u3001\u304a\u3088\u3073\u5f15\u6570\u3068\u623b\u308a\u5024\u306e\u95a2\u4fc2\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002</p> <pre><code>(defn calculate-item-total\n  \"\u6ce8\u6587\u30a2\u30a4\u30c6\u30e0\u306e\u5408\u8a08\u3092\u8a08\u7b97\u3059\u308b\"\n  [{:keys [price quantity]}]\n  (* price quantity))\n\n(s/fdef calculate-item-total\n  :args (s/cat :item ::order-item)\n  :ret number?\n  :fn (s/and #(pos? (:ret %))\n             #(= (:ret %)\n                 (* (get-in % [:args :item :price])\n                    (get-in % [:args :item :quantity])))))\n</code></pre>"},{"location":"clojure/04-clojure-spec/#fdef_1","title":"fdef \u306e\u69cb\u6210\u8981\u7d20","text":"<ul> <li>:args: \u5f15\u6570\u306e\u30b9\u30da\u30c3\u30af\uff08<code>s/cat</code> \u3067\u540d\u524d\u4ed8\u304d\u5f15\u6570\u3092\u5b9a\u7fa9\uff09</li> <li>:ret: \u623b\u308a\u5024\u306e\u30b9\u30da\u30c3\u30af</li> <li>:fn: \u5f15\u6570\u3068\u623b\u308a\u5024\u306e\u95a2\u4fc2\u3092\u5b9a\u7fa9\u3059\u308b\u8ff0\u8a9e</li> </ul> <pre><code>(defn apply-discount\n  \"\u5272\u5f15\u3092\u9069\u7528\u3059\u308b\"\n  [total discount-rate]\n  (* total (- 1 discount-rate)))\n\n(s/fdef apply-discount\n  :args (s/cat :total ::total :discount-rate (s/and number? #(&lt;= 0 % 1)))\n  :ret number?\n  :fn #(&lt;= (:ret %) (get-in % [:args :total])))  ;; \u623b\u308a\u5024\u306f\u5143\u306e\u5024\u4ee5\u4e0b\n</code></pre>"},{"location":"clojure/04-clojure-spec/#5","title":"5. \u591a\u5f15\u6570\u3068\u53ef\u5909\u9577\u5f15\u6570","text":""},{"location":"clojure/04-clojure-spec/#_8","title":"\u30aa\u30fc\u30d0\u30fc\u30ed\u30fc\u30c9\u3055\u308c\u305f\u95a2\u6570","text":"<pre><code>(defn create-person\n  \"\u4eba\u7269\u3092\u4f5c\u6210\u3059\u308b\"\n  ([name age]\n   {:name name :age age})\n  ([name age email]\n   {:name name :age age :email email}))\n\n(s/fdef create-person\n  :args (s/alt :two-args (s/cat :name ::name :age ::age)\n               :three-args (s/cat :name ::name :age ::age :email ::email))\n  :ret ::person)\n</code></pre>"},{"location":"clojure/04-clojure-spec/#_9","title":"\u53ef\u5909\u9577\u5f15\u6570","text":"<pre><code>(defn sum-prices\n  \"\u8907\u6570\u306e\u4fa1\u683c\u3092\u5408\u8a08\u3059\u308b\"\n  [&amp; prices]\n  (reduce + 0 prices))\n\n(s/fdef sum-prices\n  :args (s/* ::price)\n  :ret number?)\n</code></pre>"},{"location":"clojure/04-clojure-spec/#6","title":"6. \u6761\u4ef6\u4ed8\u304d\u30b9\u30da\u30c3\u30af\uff08\u30de\u30eb\u30c1\u30b9\u30da\u30c3\u30af\uff09","text":"<p>\u30c7\u30fc\u30bf\u306e\u5185\u5bb9\u306b\u5fdc\u3058\u3066\u7570\u306a\u308b\u30b9\u30da\u30c3\u30af\u3092\u9069\u7528\u3059\u308b\u5834\u5408\u306f\u3001\u30de\u30eb\u30c1\u30b9\u30da\u30c3\u30af\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002</p> <pre><code>(s/def ::notification-type #{:email :sms :push})\n\n(defmulti notification-spec :type)\n\n(defmethod notification-spec :email [_]\n  (s/keys :req-un [::type ::to ::subject ::body]))\n\n(defmethod notification-spec :sms [_]\n  (s/keys :req-un [::type ::phone-number ::body]))\n\n(defmethod notification-spec :push [_]\n  (s/keys :req-un [::type ::device-token ::body]))\n\n(s/def ::notification (s/multi-spec notification-spec :type))\n\n;; \u691c\u8a3c\n(s/valid? ::notification\n          {:type :email\n           :to \"test@example.com\"\n           :subject \"\u30c6\u30b9\u30c8\"\n           :body \"\u672c\u6587\"})\n;; =&gt; true\n\n(s/valid? ::notification\n          {:type :sms\n           :phone-number \"090-1234-5678\"\n           :body \"\u672c\u6587\"})\n;; =&gt; true\n</code></pre>"},{"location":"clojure/04-clojure-spec/#7","title":"7. \u30ab\u30b9\u30bf\u30e0\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf","text":"<p>\u30b9\u30da\u30c3\u30af\u306b\u5bfe\u5fdc\u3059\u308b\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u3092\u81ea\u52d5\u751f\u6210\u3059\u308b\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u3092\u5b9a\u7fa9\u3067\u304d\u307e\u3059\u3002</p> <pre><code>(require '[clojure.spec.gen.alpha :as gen])\n\n(defn product-id-gen\n  \"\u5546\u54c1ID\u306e\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\"\n  []\n  (gen/fmap #(str \"PROD-\" (format \"%05d\" %))\n            (gen/choose 0 99999)))\n\n(s/def ::product-id-with-gen\n  (s/with-gen\n    (s/and string? #(re-matches #\"PROD-\\d{5}\" %))\n    product-id-gen))\n\n;; \u30b5\u30f3\u30d7\u30eb\u751f\u6210\n(gen/sample (s/gen ::product-id-with-gen) 5)\n;; =&gt; (\"PROD-00042\" \"PROD-00001\" \"PROD-12345\" \"PROD-00000\" \"PROD-99999\")\n</code></pre>"},{"location":"clojure/04-clojure-spec/#_10","title":"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306e\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf","text":"<pre><code>(defn email-gen\n  \"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306e\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\"\n  []\n  (gen/fmap (fn [[user domain]]\n              (str user \"@\" domain \".com\"))\n            (gen/tuple (gen/such-that #(not (empty? %))\n                                       (gen/string-alphanumeric))\n                       (gen/such-that #(not (empty? %))\n                                       (gen/string-alphanumeric)))))\n</code></pre>"},{"location":"clojure/04-clojure-spec/#8","title":"8. \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3068\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0","text":""},{"location":"clojure/04-clojure-spec/#_11","title":"\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u95a2\u6570","text":"<pre><code>(defn validate-person\n  \"\u4eba\u7269\u30c7\u30fc\u30bf\u3092\u691c\u8a3c\u3057\u3001\u7d50\u679c\u3092\u8fd4\u3059\"\n  [person]\n  (if (s/valid? ::person person)\n    {:valid true :data person}\n    {:valid false\n     :errors (s/explain-data ::person person)}))\n\n(validate-person {:name \"\u7530\u4e2d\" :age 30})\n;; =&gt; {:valid true, :data {:name \"\u7530\u4e2d\", :age 30}}\n\n(validate-person {:name \"\" :age 30})\n;; =&gt; {:valid false, :errors {...}}\n</code></pre>"},{"location":"clojure/04-clojure-spec/#conform","title":"conform \u306b\u3088\u308b\u5024\u306e\u5909\u63db","text":"<pre><code>(defn conform-or-throw\n  \"\u30b9\u30da\u30c3\u30af\u306b\u9069\u5408\u3057\u306a\u3044\u5834\u5408\u306f\u4f8b\u5916\u3092\u30b9\u30ed\u30fc\"\n  [spec data]\n  (let [conformed (s/conform spec data)]\n    (if (= conformed ::s/invalid)\n      (throw (ex-info \"Validation failed\"\n                      {:spec spec\n                       :data data\n                       :problems (s/explain-data spec data)}))\n      conformed)))\n</code></pre>"},{"location":"clojure/04-clojure-spec/#9","title":"9. \u30a4\u30f3\u30b9\u30c8\u30eb\u30e1\u30f3\u30c6\u30fc\u30b7\u30e7\u30f3","text":"<p>\u958b\u767a\u6642\u306b\u95a2\u6570\u306e\u5f15\u6570\u3092\u81ea\u52d5\u691c\u8a3c\u3067\u304d\u307e\u3059\u3002</p> <pre><code>(require '[clojure.spec.test.alpha :as stest])\n\n;; \u30a4\u30f3\u30b9\u30c8\u30eb\u30e1\u30f3\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u6709\u52b9\u5316\n(stest/instrument)\n\n;; \u3053\u308c\u4ee5\u964d\u3001fdef \u304c\u5b9a\u7fa9\u3055\u308c\u305f\u95a2\u6570\u306f\u5f15\u6570\u304c\u81ea\u52d5\u691c\u8a3c\u3055\u308c\u308b\n(calculate-item-total {:product-id \"INVALID\" :quantity -1 :price 0})\n;; =&gt; ExceptionInfo: Call to #'user/calculate-item-total did not conform to spec\n\n;; \u7121\u52b9\u5316\n(stest/unstrument)\n</code></pre>"},{"location":"clojure/04-clojure-spec/#10","title":"10. \u30c6\u30b9\u30c8\u751f\u6210","text":"<p><code>check</code> \u95a2\u6570\u3067\u81ea\u52d5\u7684\u306b\u30c6\u30b9\u30c8\u3092\u751f\u6210\u30fb\u5b9f\u884c\u3067\u304d\u307e\u3059\u3002</p> <pre><code>(stest/check `calculate-item-total)\n;; 100\u500b\u306e\u30e9\u30f3\u30c0\u30e0\u306a\u5165\u529b\u3067\u30c6\u30b9\u30c8\u3092\u5b9f\u884c\n\n(stest/check `apply-discount {:clojure.spec.test.check/opts {:num-tests 1000}})\n;; 1000\u500b\u306e\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u3067\u5b9f\u884c\n</code></pre>"},{"location":"clojure/04-clojure-spec/#_12","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Clojure Spec \u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u57fa\u672c\u7684\u306a\u30b9\u30da\u30c3\u30af: \u8ff0\u8a9e\u3068\u7d44\u307f\u5408\u308f\u305b\u305f\u30c7\u30fc\u30bf\u691c\u8a3c</li> <li>\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u30b9\u30da\u30c3\u30af: \u30d9\u30af\u30bf\u30fc\u3001\u30de\u30c3\u30d7\u306e\u69cb\u9020\u5b9a\u7fa9</li> <li>\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30eb: \u30d3\u30b8\u30cd\u30b9\u30c7\u30fc\u30bf\u306e\u4ed5\u69d8\u5b9a\u7fa9</li> <li>fdef: \u95a2\u6570\u306e\u5951\u7d04\uff08\u5f15\u6570\u3001\u623b\u308a\u5024\u3001\u95a2\u4fc2\uff09</li> <li>\u30de\u30eb\u30c1\u30b9\u30da\u30c3\u30af: \u6761\u4ef6\u4ed8\u304d\u306e\u4ed5\u69d8\u5b9a\u7fa9</li> <li>\u30ab\u30b9\u30bf\u30e0\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf: \u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u306e\u81ea\u52d5\u751f\u6210</li> <li>\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3: \u5b9f\u884c\u6642\u691c\u8a3c\u3068\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0</li> <li>\u30a4\u30f3\u30b9\u30c8\u30eb\u30e1\u30f3\u30c6\u30fc\u30b7\u30e7\u30f3: \u958b\u767a\u6642\u306e\u81ea\u52d5\u691c\u8a3c</li> <li>\u30c6\u30b9\u30c8\u751f\u6210: \u81ea\u52d5\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8</li> </ol> <p>Spec \u3092\u6d3b\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u52d5\u7684\u578b\u4ed8\u3051\u8a00\u8a9e\u306e\u67d4\u8edf\u6027\u3092\u4fdd\u3061\u306a\u304c\u3089\u3001\u5805\u7262\u306a\u30c7\u30fc\u30bf\u691c\u8a3c\u3068\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u5316\u3092\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"clojure/04-clojure-spec/#_13","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part2/src/clojure_spec.clj</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part2/spec/clojure_spec_spec.clj</code></li> </ul>"},{"location":"clojure/04-clojure-spec/#_14","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002test.check \u3092\u4f7f\u3063\u305f\u751f\u6210\u7684\u30c6\u30b9\u30c8\u306e\u624b\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/05-property-based-testing/","title":"\u7b2c5\u7ae0: \u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8","text":""},{"location":"clojure/05-property-based-testing/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u5f93\u6765\u306e\u5358\u4f53\u30c6\u30b9\u30c8\u3067\u306f\u3001\u7279\u5b9a\u306e\u5165\u529b\u306b\u5bfe\u3059\u308b\u671f\u5f85\u3055\u308c\u308b\u51fa\u529b\u3092\u691c\u8a3c\u3057\u307e\u3059\u3002\u4e00\u65b9\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u3067\u306f\u3001\u3059\u3079\u3066\u306e\u5165\u529b\u306b\u5bfe\u3057\u3066\u6210\u308a\u7acb\u3064\u3079\u304d\u300c\u6027\u8cea\uff08\u30d7\u30ed\u30d1\u30c6\u30a3\uff09\u300d\u3092\u5b9a\u7fa9\u3057\u3001\u30e9\u30f3\u30c0\u30e0\u306b\u751f\u6210\u3055\u308c\u305f\u591a\u6570\u306e\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u3067\u691c\u8a3c\u3057\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001Clojure \u306e <code>test.check</code> \u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3063\u305f\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u306e\u624b\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/05-property-based-testing/#1","title":"1. \u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u3068\u306f","text":""},{"location":"clojure/05-property-based-testing/#_2","title":"\u5f93\u6765\u306e\u30c6\u30b9\u30c8\u3068\u306e\u9055\u3044","text":"<pre><code>;; \u5f93\u6765\u306e\u30c6\u30b9\u30c8\uff1a\u7279\u5b9a\u306e\u5165\u529b\u306b\u5bfe\u3059\u308b\u51fa\u529b\u3092\u691c\u8a3c\n(deftest test-reverse\n  (is (= \"olleh\" (reverse-string \"hello\")))\n  (is (= \"\" (reverse-string \"\")))\n  (is (= \"a\" (reverse-string \"a\"))))\n\n;; \u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\uff1a\u6027\u8cea\u3092\u691c\u8a3c\n(def prop-reverse-involutory\n  \"\u6587\u5b57\u5217\u30922\u56de\u53cd\u8ee2\u3059\u308b\u3068\u5143\u306b\u623b\u308b\"\n  (prop/for-all [s gen/string]\n    (= s (reverse-string (reverse-string s)))))\n</code></pre>"},{"location":"clojure/05-property-based-testing/#_3","title":"\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u306e\u5229\u70b9","text":"<ol> <li>\u7db2\u7f85\u6027: \u624b\u52d5\u3067\u306f\u601d\u3044\u3064\u304b\u306a\u3044\u30a8\u30c3\u30b8\u30b1\u30fc\u30b9\u3092\u767a\u898b</li> <li>\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u6027: \u30b3\u30fc\u30c9\u306e\u6027\u8cea\u3092\u660e\u78ba\u306b\u8868\u73fe</li> <li>\u56de\u5e30\u9632\u6b62: \u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u6642\u306e\u5b89\u5168\u7db2</li> <li>\u30b7\u30e5\u30ea\u30f3\u30ad\u30f3\u30b0: \u5931\u6557\u6642\u306b\u6700\u5c0f\u306e\u53cd\u4f8b\u3092\u63d0\u793a</li> </ol>"},{"location":"clojure/05-property-based-testing/#2","title":"2. \u57fa\u672c\u7684\u306a\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf","text":""},{"location":"clojure/05-property-based-testing/#_4","title":"\u30d7\u30ea\u30df\u30c6\u30a3\u30d6\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf","text":"<pre><code>(require '[clojure.test.check.generators :as gen])\n\n;; \u6574\u6570\ngen/small-integer  ;; -200\u301c200\u7a0b\u5ea6\u306e\u6574\u6570\ngen/nat            ;; \u81ea\u7136\u6570\uff080\u4ee5\u4e0a\uff09\ngen/pos-int        ;; \u6b63\u306e\u6574\u6570\ngen/neg-int        ;; \u8ca0\u306e\u6574\u6570\n\n;; \u6587\u5b57\u5217\ngen/string                ;; \u4efb\u610f\u306e\u6587\u5b57\u5217\ngen/string-alphanumeric   ;; \u82f1\u6570\u5b57\u306e\u307f\n\n;; \u305d\u306e\u4ed6\ngen/boolean        ;; true/false\ngen/char           ;; \u6587\u5b57\ngen/keyword        ;; \u30ad\u30fc\u30ef\u30fc\u30c9\n\n;; \u30b5\u30f3\u30d7\u30eb\u751f\u6210\n(gen/sample gen/small-integer 5)\n;; =&gt; (0 1 -2 1 4)\n</code></pre>"},{"location":"clojure/05-property-based-testing/#_5","title":"\u7bc4\u56f2\u3068\u5217\u6319","text":"<pre><code>;; \u7bc4\u56f2\u6307\u5b9a\n(def age-gen (gen/choose 0 150))\n\n;; \u6d6e\u52d5\u5c0f\u6570\u70b9\u6570\n(def percentage-gen (gen/double* {:min 0.0 :max 1.0}))\n\n;; \u5217\u6319\u578b\n(def membership-gen (gen/elements [:bronze :silver :gold :platinum]))\n</code></pre>"},{"location":"clojure/05-property-based-testing/#3","title":"3. \u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf","text":""},{"location":"clojure/05-property-based-testing/#_6","title":"\u30d9\u30af\u30bf\u30fc\u30fb\u30ea\u30b9\u30c8","text":"<pre><code>;; \u30d9\u30af\u30bf\u30fc\n(gen/vector gen/small-integer)       ;; \u4efb\u610f\u9577\n(gen/vector gen/small-integer 1 10)  ;; 1\u301c10\u8981\u7d20\n\n;; \u30ea\u30b9\u30c8\n(gen/list gen/small-integer)\n\n;; \u975e\u7a7a\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\n(gen/not-empty (gen/vector gen/small-integer))\n</code></pre>"},{"location":"clojure/05-property-based-testing/#_7","title":"\u30de\u30c3\u30d7\u3068\u30bb\u30c3\u30c8","text":"<pre><code>;; \u30de\u30c3\u30d7\n(gen/map gen/string-alphanumeric gen/small-integer)\n\n;; \u30bb\u30c3\u30c8\n(gen/set gen/small-integer)\n\n;; \u69cb\u9020\u5316\u3055\u308c\u305f\u30de\u30c3\u30d7\n(gen/hash-map\n  :name gen/string-alphanumeric\n  :age (gen/choose 0 150)\n  :active gen/boolean)\n</code></pre>"},{"location":"clojure/05-property-based-testing/#4","title":"4. \u8907\u5408\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf","text":""},{"location":"clojure/05-property-based-testing/#_8","title":"\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30eb\u306e\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf","text":"<pre><code>(def person-gen\n  \"\u4eba\u7269\u30c7\u30fc\u30bf\u306e\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\"\n  (gen/hash-map\n   :name (gen/such-that #(not (empty? %)) gen/string-alphanumeric)\n   :age (gen/choose 0 150)\n   :membership (gen/elements [:bronze :silver :gold :platinum])))\n\n(def product-gen\n  \"\u5546\u54c1\u30c7\u30fc\u30bf\u306e\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\"\n  (gen/hash-map\n   :product-id (gen/fmap #(str \"PROD-\" (format \"%05d\" (mod % 100000))) gen/nat)\n   :name (gen/such-that #(not (empty? %)) gen/string-alphanumeric)\n   :price (gen/fmap #(+ 1 (mod % 10000)) gen/nat)\n   :quantity (gen/fmap #(+ 1 (mod % 100)) gen/nat)))\n\n(gen/sample product-gen 3)\n;; =&gt; ({:product-id \"PROD-00000\", :name \"a\", :price 1, :quantity 1}\n;;     {:product-id \"PROD-00001\", :name \"Ab\", :price 2, :quantity 2}\n;;     {:product-id \"PROD-00003\", :name \"x2Y\", :price 4, :quantity 3})\n</code></pre>"},{"location":"clojure/05-property-based-testing/#5_1","title":"5. \u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u306e\u5909\u63db","text":""},{"location":"clojure/05-property-based-testing/#fmap","title":"fmap: \u5024\u306e\u5909\u63db","text":"<pre><code>;; \u751f\u6210\u3055\u308c\u305f\u5024\u3092\u5909\u63db\n(def uppercase-string-gen\n  (gen/fmap clojure.string/upper-case gen/string-alphanumeric))\n\n;; \u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3055\u308c\u305fID\n(def order-id-gen\n  (gen/fmap #(str \"ORD-\" (format \"%08d\" %))\n            (gen/choose 0 99999999)))\n</code></pre>"},{"location":"clojure/05-property-based-testing/#bind","title":"bind: \u4f9d\u5b58\u95a2\u4fc2\u306e\u3042\u308b\u751f\u6210","text":"<pre><code>;; \u751f\u6210\u3055\u308c\u305f\u5024\u306b\u57fa\u3065\u3044\u3066\u5225\u306e\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u3092\u9078\u629e\n(def non-empty-subset-gen\n  (gen/bind (gen/not-empty (gen/vector gen/small-integer))\n            (fn [v]\n              (gen/fmap #(take % v)\n                        (gen/choose 1 (count v))))))\n</code></pre>"},{"location":"clojure/05-property-based-testing/#such-that","title":"such-that: \u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0","text":"<pre><code>;; \u6761\u4ef6\u3092\u6e80\u305f\u3059\u5024\u306e\u307f\u3092\u751f\u6210\n(def positive-even-gen\n  (gen/such-that #(and (pos? %) (even? %)) gen/small-integer 100))\n</code></pre>"},{"location":"clojure/05-property-based-testing/#6","title":"6. \u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u5b9a\u7fa9","text":""},{"location":"clojure/05-property-based-testing/#_9","title":"\u57fa\u672c\u7684\u306a\u30d7\u30ed\u30d1\u30c6\u30a3","text":"<pre><code>(require '[clojure.test.check.properties :as prop])\n\n;; \u6587\u5b57\u5217\u53cd\u8ee2\u306e\u6027\u8cea\n(def prop-reverse-involutory\n  \"\u6587\u5b57\u5217\u30922\u56de\u53cd\u8ee2\u3059\u308b\u3068\u5143\u306b\u623b\u308b\"\n  (prop/for-all [s gen/string]\n    (= s (reverse-string (reverse-string s)))))\n\n(def prop-reverse-length-preserved\n  \"\u53cd\u8ee2\u3057\u3066\u3082\u9577\u3055\u306f\u5909\u308f\u3089\u306a\u3044\"\n  (prop/for-all [s gen/string]\n    (= (count s) (count (reverse-string s)))))\n</code></pre>"},{"location":"clojure/05-property-based-testing/#_10","title":"\u30bd\u30fc\u30c8\u306e\u6027\u8cea","text":"<pre><code>(def prop-sort-idempotent\n  \"\u30bd\u30fc\u30c8\u306f\u51aa\u7b49\uff082\u56de\u30bd\u30fc\u30c8\u3057\u3066\u3082\u7d50\u679c\u306f\u540c\u3058\uff09\"\n  (prop/for-all [nums (gen/vector gen/small-integer)]\n    (= (sort-numbers nums) (sort-numbers (sort-numbers nums)))))\n\n(def prop-sort-preserves-elements\n  \"\u30bd\u30fc\u30c8\u306f\u8981\u7d20\u3092\u4fdd\u5b58\u3059\u308b\uff08\u8ffd\u52a0\u3082\u524a\u9664\u3082\u3057\u306a\u3044\uff09\"\n  (prop/for-all [nums (gen/vector gen/small-integer)]\n    (= (frequencies nums) (frequencies (sort-numbers nums)))))\n\n(def prop-sort-ordered\n  \"\u30bd\u30fc\u30c8\u7d50\u679c\u306f\u6607\u9806\u306b\u4e26\u3076\"\n  (prop/for-all [nums (gen/vector gen/small-integer)]\n    (let [sorted (sort-numbers nums)]\n      (or (empty? sorted)\n          (apply &lt;= sorted)))))\n</code></pre>"},{"location":"clojure/05-property-based-testing/#_11","title":"\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u306e\u6027\u8cea","text":"<pre><code>(def prop-discount-bounds\n  \"\u5272\u5f15\u5f8c\u306e\u4fa1\u683c\u306f0\u4ee5\u4e0a\u3001\u5143\u306e\u4fa1\u683c\u4ee5\u4e0b\"\n  (prop/for-all [price (gen/fmap #(Math/abs %) gen/small-integer)\n                 rate (gen/double* {:min 0.0 :max 1.0})]\n    (let [discounted (calculate-discount price rate)]\n      (and (&gt;= discounted 0)\n           (&lt;= discounted price)))))\n</code></pre>"},{"location":"clojure/05-property-based-testing/#7","title":"7. \u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u5b9f\u884c","text":""},{"location":"clojure/05-property-based-testing/#quick-check","title":"quick-check","text":"<pre><code>(require '[clojure.test.check :as tc])\n\n;; 100\u56de\u30c6\u30b9\u30c8\n(tc/quick-check 100 prop-reverse-involutory)\n;; =&gt; {:result true, :pass? true, :num-tests 100, :time-elapsed-ms 15, ...}\n\n;; 1000\u56de\u30c6\u30b9\u30c8\n(tc/quick-check 1000 prop-sort-ordered)\n</code></pre>"},{"location":"clojure/05-property-based-testing/#_12","title":"\u5931\u6557\u6642\u306e\u51fa\u529b","text":"<pre><code>;; \u30d0\u30b0\u306e\u3042\u308b\u95a2\u6570\n(defn buggy-abs [n]\n  (if (neg? n) (- n) n))\n\n(def prop-abs-positive\n  (prop/for-all [n gen/small-integer]\n    (&gt;= (buggy-abs n) 0)))\n\n(tc/quick-check 10000 prop-abs-positive)\n;; Integer/MIN_VALUE \u3067\u5931\u6557\u3059\u308b\u5834\u5408\u3001\u30b7\u30e5\u30ea\u30f3\u30ad\u30f3\u30b0\u3067\u6700\u5c0f\u53cd\u4f8b\u3092\u63d0\u793a\n</code></pre>"},{"location":"clojure/05-property-based-testing/#8","title":"8. \u30b7\u30e5\u30ea\u30f3\u30ad\u30f3\u30b0","text":"<p>\u30c6\u30b9\u30c8\u304c\u5931\u6557\u3059\u308b\u3068\u3001test.check \u306f\u81ea\u52d5\u7684\u306b\u30b7\u30e5\u30ea\u30f3\u30ad\u30f3\u30b0\u3092\u884c\u3044\u3001\u540c\u3058\u5931\u6557\u3092\u5f15\u304d\u8d77\u3053\u3059\u6700\u5c0f\u306e\u5165\u529b\u3092\u63a2\u3057\u307e\u3059\u3002</p> <pre><code>;; \u4f8b\uff1a\u30ea\u30b9\u30c8\u306e\u9577\u3055\u304c5\u672a\u6e80\u3068\u3044\u3046\u30d0\u30b0\u306e\u3042\u308b\u30d7\u30ed\u30d1\u30c6\u30a3\n(def prop-buggy\n  (prop/for-all [v (gen/vector gen/small-integer)]\n    (&lt; (count v) 5)))\n\n(tc/quick-check 100 prop-buggy)\n;; =&gt; {:result false,\n;;     :pass? false,\n;;     :shrunk {:total-nodes-visited 7,\n;;              :smallest [[0 0 0 0 0]]},  ;; \u6700\u5c0f\u306e\u53cd\u4f8b\n;;     ...}\n</code></pre> <p>\u30b7\u30e5\u30ea\u30f3\u30ad\u30f3\u30b0\u306b\u3088\u308a\u3001\u300c\u9577\u3055100\u306e\u30ea\u30b9\u30c8\u3067\u5931\u6557\u300d\u3067\u306f\u306a\u304f\u300c\u9577\u30555\u306e\u30ea\u30b9\u30c8\u3067\u5931\u6557\u300d\u3068\u3044\u3046\u6700\u5c0f\u306e\u53cd\u4f8b\u304c\u5f97\u3089\u308c\u307e\u3059\u3002</p>"},{"location":"clojure/05-property-based-testing/#9","title":"9. \u30e9\u30a6\u30f3\u30c9\u30c8\u30ea\u30c3\u30d7\u30d7\u30ed\u30d1\u30c6\u30a3","text":"<p>\u30a8\u30f3\u30b3\u30fc\u30c9/\u30c7\u30b3\u30fc\u30c9\u306e\u53ef\u9006\u6027\u306f\u5178\u578b\u7684\u306a\u30d7\u30ed\u30d1\u30c6\u30a3\u3067\u3059\u3002</p> <pre><code>(defn encode-run-length [s]\n  (-&gt;&gt; s\n       (partition-by identity)\n       (map (fn [group] [(first group) (count group)]))\n       (into [])))\n\n(defn decode-run-length [encoded]\n  (-&gt;&gt; encoded\n       (mapcat (fn [[ch n]] (repeat n ch)))\n       (apply str)))\n\n(def prop-run-length-roundtrip\n  \"\u30e9\u30f3\u30ec\u30f3\u30b0\u30b9\u7b26\u53f7\u5316\u306f\u53ef\u9006\"\n  (prop/for-all [s (gen/fmap #(apply str %) (gen/vector gen/char-alpha))]\n    (= s (decode-run-length (encode-run-length s)))))\n</code></pre>"},{"location":"clojure/05-property-based-testing/#10","title":"10. \u5b9f\u8df5\u7684\u306a\u30d1\u30bf\u30fc\u30f3","text":""},{"location":"clojure/05-property-based-testing/#_13","title":"\u4ee3\u6570\u7684\u6027\u8cea","text":"<pre><code>;; \u7d50\u5408\u5f8b\n(def prop-addition-associative\n  (prop/for-all [a gen/small-integer\n                 b gen/small-integer\n                 c gen/small-integer]\n    (= (+ (+ a b) c) (+ a (+ b c)))))\n\n;; \u4ea4\u63db\u5f8b\n(def prop-addition-commutative\n  (prop/for-all [a gen/small-integer\n                 b gen/small-integer]\n    (= (+ a b) (+ b a))))\n</code></pre>"},{"location":"clojure/05-property-based-testing/#_14","title":"\u30aa\u30e9\u30af\u30eb\u30c6\u30b9\u30c8","text":"<p>\u65e2\u77e5\u306e\u6b63\u3057\u3044\u5b9f\u88c5\u3068\u6bd4\u8f03\u3057\u307e\u3059\u3002</p> <pre><code>(def prop-my-sort-matches-builtin\n  \"\u81ea\u4f5c\u30bd\u30fc\u30c8\u306f\u7d44\u307f\u8fbc\u307f\u30bd\u30fc\u30c8\u3068\u540c\u3058\u7d50\u679c\"\n  (prop/for-all [nums (gen/vector gen/small-integer)]\n    (= (my-sort nums) (sort nums))))\n</code></pre>"},{"location":"clojure/05-property-based-testing/#_15","title":"\u4e0d\u5909\u6761\u4ef6","text":"<pre><code>(def prop-order-total-positive\n  \"\u6ce8\u6587\u5408\u8a08\u306f\u5e38\u306b\u6b63\"\n  (prop/for-all [order order-gen]\n    (pos? (calculate-order-total order))))\n</code></pre>"},{"location":"clojure/05-property-based-testing/#_16","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf: \u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u306e\u81ea\u52d5\u751f\u6210</li> <li>\u30d7\u30ea\u30df\u30c6\u30a3\u30d6: \u6574\u6570\u3001\u6587\u5b57\u5217\u3001\u30d6\u30fc\u30eb\u5024\u306a\u3069</li> <li>\u30b3\u30ec\u30af\u30b7\u30e7\u30f3: \u30d9\u30af\u30bf\u30fc\u3001\u30de\u30c3\u30d7\u3001\u30bb\u30c3\u30c8</li> <li>\u5909\u63db: fmap, bind, such-that \u306b\u3088\u308b\u52a0\u5de5</li> <li>\u30d7\u30ed\u30d1\u30c6\u30a3: \u3059\u3079\u3066\u306e\u5165\u529b\u3067\u6210\u308a\u7acb\u3064\u3079\u304d\u6027\u8cea</li> <li>\u30b7\u30e5\u30ea\u30f3\u30ad\u30f3\u30b0: \u5931\u6557\u6642\u306e\u6700\u5c0f\u53cd\u4f8b\u63a2\u7d22</li> <li>\u30d1\u30bf\u30fc\u30f3: \u30e9\u30a6\u30f3\u30c9\u30c8\u30ea\u30c3\u30d7\u3001\u4ee3\u6570\u7684\u6027\u8cea\u3001\u30aa\u30e9\u30af\u30eb\u30c6\u30b9\u30c8</li> </ol> <p>\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u306f\u3001\u5f93\u6765\u306e\u30c6\u30b9\u30c8\u3092\u88dc\u5b8c\u3057\u3001\u3088\u308a\u5805\u7262\u306a\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p>"},{"location":"clojure/05-property-based-testing/#_17","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part2/src/property_based_testing.clj</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part2/spec/property_based_testing_spec.clj</code></li> </ul>"},{"location":"clojure/05-property-based-testing/#_18","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001\u30c6\u30b9\u30c8\u99c6\u52d5\u958b\u767a\u3068\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002Red-Green-Refactor \u30b5\u30a4\u30af\u30eb\u3092\u95a2\u6570\u578b\u30b9\u30bf\u30a4\u30eb\u3067\u5b9f\u8df5\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/06-tdd-in-functional/","title":"\u7b2c6\u7ae0: \u30c6\u30b9\u30c8\u99c6\u52d5\u958b\u767a\u3068\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0","text":""},{"location":"clojure/06-tdd-in-functional/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u30c6\u30b9\u30c8\u99c6\u52d5\u958b\u767a\uff08TDD\uff09\u306f\u3001\u30c6\u30b9\u30c8\u3092\u5148\u306b\u66f8\u3044\u3066\u304b\u3089\u5b9f\u88c5\u3092\u884c\u3046\u958b\u767a\u624b\u6cd5\u3067\u3059\u3002\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3068 TDD \u306f\u76f8\u6027\u304c\u826f\u304f\u3001\u7d14\u7c8b\u95a2\u6570\u306f\u30c6\u30b9\u30c8\u304c\u5bb9\u6613\u3067\u3001\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u306f\u4e88\u6e2c\u53ef\u80fd\u306a\u52d5\u4f5c\u3092\u4fdd\u8a3c\u3057\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001Red-Green-Refactor \u30b5\u30a4\u30af\u30eb\u3092\u95a2\u6570\u578b\u30b9\u30bf\u30a4\u30eb\u3067\u5b9f\u8df5\u3059\u308b\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/06-tdd-in-functional/#1-tdd","title":"1. TDD \u306e\u57fa\u672c\u30b5\u30a4\u30af\u30eb","text":""},{"location":"clojure/06-tdd-in-functional/#red-green-refactor","title":"Red-Green-Refactor","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                                                 \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502    \u2502  Red  \u2502 \u2500\u2500\u25ba \u2502 Green \u2502 \u2500\u2500\u25ba \u2502 Refactor  \u2502   \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502        \u25b2                              \u2502         \u2502\n\u2502        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <ol> <li>Red\uff08\u8d64\uff09: \u5931\u6557\u3059\u308b\u30c6\u30b9\u30c8\u3092\u66f8\u304f</li> <li>Green\uff08\u7dd1\uff09: \u30c6\u30b9\u30c8\u3092\u901a\u3059\u6700\u5c0f\u9650\u306e\u30b3\u30fc\u30c9\u3092\u66f8\u304f</li> <li>Refactor\uff08\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\uff09: \u30b3\u30fc\u30c9\u3092\u6539\u5584\u3059\u308b\uff08\u30c6\u30b9\u30c8\u306f\u901a\u3063\u305f\u307e\u307e\uff09</li> </ol>"},{"location":"clojure/06-tdd-in-functional/#2-fizzbuzz-tdd","title":"2. FizzBuzz - TDD \u306e\u5178\u578b\u4f8b","text":""},{"location":"clojure/06-tdd-in-functional/#step-1-red","title":"Step 1: Red\uff08\u6700\u521d\u306e\u30c6\u30b9\u30c8\uff09","text":"<pre><code>;; \u30c6\u30b9\u30c8\n(it \"1\u306f\\\"1\\\"\u3092\u8fd4\u3059\"\n  (should= \"1\" (fizzbuzz 1)))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#step-2-green","title":"Step 2: Green\uff08\u6700\u5c0f\u9650\u306e\u5b9f\u88c5\uff09","text":"<pre><code>(defn fizzbuzz [n]\n  \"1\")\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#step-3","title":"Step 3: \u6b21\u306e\u30c6\u30b9\u30c8\u3092\u8ffd\u52a0","text":"<pre><code>(it \"2\u306f\\\"2\\\"\u3092\u8fd4\u3059\"\n  (should= \"2\" (fizzbuzz 2)))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#_2","title":"\u6bb5\u968e\u7684\u306b\u5b9f\u88c5\u3092\u767a\u5c55","text":"<pre><code>;; \u5c0f\u3055\u306a\u30d8\u30eb\u30d1\u30fc\u95a2\u6570\u306b\u5206\u5272\n(defn fizz? [n] (zero? (mod n 3)))\n(defn buzz? [n] (zero? (mod n 5)))\n(defn fizzbuzz? [n] (and (fizz? n) (buzz? n)))\n\n(defn fizzbuzz [n]\n  (cond\n    (fizzbuzz? n) \"FizzBuzz\"\n    (fizz? n) \"Fizz\"\n    (buzz? n) \"Buzz\"\n    :else (str n)))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#_3","title":"\u6700\u7d42\u30c6\u30b9\u30c8\u30b9\u30a4\u30fc\u30c8","text":"<pre><code>(context \"FizzBuzz\"\n  (it \"1\u306f\\\"1\\\"\u3092\u8fd4\u3059\" (should= \"1\" (fizzbuzz 1)))\n  (it \"2\u306f\\\"2\\\"\u3092\u8fd4\u3059\" (should= \"2\" (fizzbuzz 2)))\n  (it \"3\u306f\\\"Fizz\\\"\u3092\u8fd4\u3059\" (should= \"Fizz\" (fizzbuzz 3)))\n  (it \"5\u306f\\\"Buzz\\\"\u3092\u8fd4\u3059\" (should= \"Buzz\" (fizzbuzz 5)))\n  (it \"15\u306f\\\"FizzBuzz\\\"\u3092\u8fd4\u3059\" (should= \"FizzBuzz\" (fizzbuzz 15))))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#3","title":"3. \u30ed\u30fc\u30de\u6570\u5b57\u5909\u63db","text":""},{"location":"clojure/06-tdd-in-functional/#_4","title":"\u30c6\u30b9\u30c8\u304b\u3089\u59cb\u3081\u308b","text":"<pre><code>(context \"to-roman\"\n  (it \"1\u306fI\u3092\u8fd4\u3059\" (should= \"I\" (to-roman 1)))\n  (it \"3\u306fIII\u3092\u8fd4\u3059\" (should= \"III\" (to-roman 3)))\n  (it \"4\u306fIV\u3092\u8fd4\u3059\" (should= \"IV\" (to-roman 4)))\n  (it \"5\u306fV\u3092\u8fd4\u3059\" (should= \"V\" (to-roman 5)))\n  ;; ... \u6bb5\u968e\u7684\u306b\u8ffd\u52a0\n  )\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#_5","title":"\u30c7\u30fc\u30bf\u99c6\u52d5\u306e\u5b9f\u88c5","text":"<pre><code>(def roman-numerals\n  \"\u30ed\u30fc\u30de\u6570\u5b57\u306e\u5bfe\u5fdc\u8868\uff08\u5927\u304d\u3044\u9806\uff09\"\n  [[1000 \"M\"] [900 \"CM\"] [500 \"D\"] [400 \"CD\"]\n   [100 \"C\"] [90 \"XC\"] [50 \"L\"] [40 \"XL\"]\n   [10 \"X\"] [9 \"IX\"] [5 \"V\"] [4 \"IV\"] [1 \"I\"]])\n\n(defn to-roman [n]\n  {:pre [(pos? n) (&lt;= n 3999)]}\n  (loop [n n result \"\"]\n    (if (zero? n)\n      result\n      (let [[value numeral] (first (filter #(&lt;= (first %) n) roman-numerals))]\n        (recur (- n value) (str result numeral))))))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#4","title":"4. \u30dc\u30a6\u30ea\u30f3\u30b0\u30b9\u30b3\u30a2\u8a08\u7b97","text":""},{"location":"clojure/06-tdd-in-functional/#tdd","title":"\u8907\u96d1\u306a\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u306e TDD","text":"<pre><code>;; \u6bb5\u968e\u7684\u306b\u30c6\u30b9\u30c8\u3092\u8ffd\u52a0\n(context \"\u30dc\u30a6\u30ea\u30f3\u30b0\u30b9\u30b3\u30a2\u8a08\u7b97\"\n  (it \"\u30ac\u30bf\u30fc\u30b9\u30b3\u30a2\u306f0\"\n    (should= 0 (bowling-score (repeat 20 0))))\n\n  (it \"\u3059\u3079\u30661\u30d4\u30f3\u306f20\u70b9\"\n    (should= 20 (bowling-score (repeat 20 1))))\n\n  (it \"\u30b9\u30da\u30a2\u306e\u5f8c\u306e\u6295\u7403\u306f\u30dc\u30fc\u30ca\u30b9\"\n    (should= 16 (bowling-score [5 5 3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0])))\n\n  (it \"\u30b9\u30c8\u30e9\u30a4\u30af\u306e\u5f8c\u306e2\u6295\u306f\u30dc\u30fc\u30ca\u30b9\"\n    (should= 24 (bowling-score [10 3 4 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0])))\n\n  (it \"\u30d1\u30fc\u30d5\u30a7\u30af\u30c8\u30b2\u30fc\u30e0\u306f300\u70b9\"\n    (should= 300 (bowling-score (repeat 12 10)))))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#_6","title":"\u5c0f\u3055\u306a\u95a2\u6570\u306b\u5206\u5272","text":"<pre><code>(defn strike? [frame] (= 10 (first frame)))\n(defn spare? [frame] (and (not (strike? frame))\n                           (= 10 (+ (first frame) (second frame)))))\n\n(defn calculate-frame [frame remaining-rolls]\n  (cond\n    (strike? frame) (+ 10 (strike-bonus remaining-rolls))\n    (spare? frame) (+ 10 (spare-bonus remaining-rolls))\n    :else (frame-score frame)))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#5-tdd","title":"5. \u7d20\u6570 - \u30b7\u30f3\u30d7\u30eb\u306a\u95a2\u6570\u306e TDD","text":""},{"location":"clojure/06-tdd-in-functional/#_7","title":"\u30c6\u30b9\u30c8\u304b\u3089\u8a2d\u8a08\u3092\u5c0e\u304f","text":"<pre><code>(context \"\u7d20\u6570\"\n  (it \"prime? \u306f\u7d20\u6570\u3092\u6b63\u3057\u304f\u5224\u5b9a\u3059\u308b\"\n    (should-not (prime? 0))\n    (should-not (prime? 1))\n    (should (prime? 2))\n    (should (prime? 3))\n    (should-not (prime? 4))\n    (should (prime? 5)))\n\n  (it \"primes-up-to \u306f\u6b63\u3057\u3044\u7d20\u6570\u30ea\u30b9\u30c8\u3092\u8fd4\u3059\"\n    (should= [2 3 5 7 11 13 17 19] (primes-up-to 20)))\n\n  (it \"prime-factors \u306f\u7d20\u56e0\u6570\u5206\u89e3\u3092\u8fd4\u3059\"\n    (should= [2 2 2 3] (prime-factors 24))))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#_8","title":"\u5b9f\u88c5","text":"<pre><code>(defn prime? [n]\n  (cond\n    (&lt; n 2) false\n    (= n 2) true\n    (even? n) false\n    :else (not-any? #(zero? (mod n %))\n                    (range 3 (inc (Math/sqrt n)) 2))))\n\n(defn primes-up-to [n]\n  (filter prime? (range 2 (inc n))))\n\n(defn prime-factors [n]\n  (loop [n n, factor 2, factors []]\n    (cond\n      (= n 1) factors\n      (zero? (mod n factor)) (recur (/ n factor) factor (conj factors factor))\n      :else (recur n (inc factor) factors))))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#6-tdd","title":"6. \u30b9\u30bf\u30c3\u30af - \u30c7\u30fc\u30bf\u69cb\u9020\u306e TDD","text":""},{"location":"clojure/06-tdd-in-functional/#_9","title":"\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u3068\u3057\u3066\u5b9f\u88c5","text":"<pre><code>(defn create-stack [] {:items []})\n\n(defn stack-push [stack item]\n  (update stack :items conj item))\n\n(defn stack-pop [stack]\n  {:pre [(not (empty? (:items stack)))]}\n  {:value (peek (:items stack))\n   :stack {:items (pop (:items stack))}})\n\n(defn stack-peek [stack]\n  (peek (:items stack)))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#_10","title":"\u30c6\u30b9\u30c8","text":"<pre><code>(it \"LIFO\u9806\u5e8f\u3067\u52d5\u4f5c\u3059\u308b\"\n  (let [stack (-&gt; (create-stack)\n                  (stack-push \"a\")\n                  (stack-push \"b\")\n                  (stack-push \"c\"))\n        {v1 :value s1 :stack} (stack-pop stack)\n        {v2 :value s2 :stack} (stack-pop s1)\n        {v3 :value _s3 :stack} (stack-pop s2)]\n    (should= \"c\" v1)\n    (should= \"b\" v2)\n    (should= \"a\" v3)))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#7","title":"7. \u6587\u5b57\u5217\u96fb\u5353","text":""},{"location":"clojure/06-tdd-in-functional/#_11","title":"\u6bb5\u968e\u7684\u306a\u8981\u4ef6\u8ffd\u52a0","text":"<pre><code>(context \"\u6587\u5b57\u5217\u96fb\u5353\"\n  (it \"\u7a7a\u6587\u5b57\u5217\u306f0\u3092\u8fd4\u3059\"\n    (should= 0 (string-calculator \"\")))\n\n  (it \"\u5358\u4e00\u306e\u6570\u5024\u306f\u305d\u306e\u5024\u3092\u8fd4\u3059\"\n    (should= 5 (string-calculator \"5\")))\n\n  (it \"\u30ab\u30f3\u30de\u533a\u5207\u308a\u306e\u6570\u5024\u3092\u5408\u8a08\u3059\u308b\"\n    (should= 6 (string-calculator \"1,2,3\")))\n\n  (it \"\u6539\u884c\u533a\u5207\u308a\u3082\u51e6\u7406\u3059\u308b\"\n    (should= 6 (string-calculator \"1\\n2,3\")))\n\n  (it \"\u30ab\u30b9\u30bf\u30e0\u533a\u5207\u308a\u6587\u5b57\u3092\u4f7f\u7528\u3067\u304d\u308b\"\n    (should= 3 (string-calculator \"//;\\n1;2\")))\n\n  (it \"\u8ca0\u306e\u6570\u306f\u4f8b\u5916\u3092\u30b9\u30ed\u30fc\u3059\u308b\"\n    (should-throw clojure.lang.ExceptionInfo\n                  (string-calculator \"1,-2,3\")))\n\n  (it \"1000\u3088\u308a\u5927\u304d\u3044\u6570\u306f\u7121\u8996\u3059\u308b\"\n    (should= 2 (string-calculator \"2,1001\"))))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#_12","title":"\u5b9f\u88c5","text":"<pre><code>(defn string-calculator [s]\n  (if (empty? s)\n    0\n    (-&gt;&gt; (parse-numbers s)\n         (validate-numbers)\n         (filter #(&lt;= % 1000))\n         (reduce +))))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#8","title":"8. \u7d14\u7c8b\u95a2\u6570\u3068\u30c6\u30b9\u30c8\u5bb9\u6613\u6027","text":""},{"location":"clojure/06-tdd-in-functional/#_13","title":"\u7d14\u7c8b\u95a2\u6570\u306e\u5229\u70b9","text":"<pre><code>;; \u7d14\u7c8b\u95a2\u6570\uff1a\u30c6\u30b9\u30c8\u304c\u5bb9\u6613\n(defn calculate-tax [amount rate]\n  (* amount rate))\n\n(defn calculate-total-with-tax [items tax-rate]\n  (let [subtotal (reduce + (map :price items))\n        tax (calculate-tax subtotal tax-rate)]\n    {:subtotal subtotal\n     :tax tax\n     :total (+ subtotal tax)}))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#_14","title":"\u30c6\u30b9\u30c8","text":"<pre><code>(it \"calculate-total-with-tax \u306f\u7a0e\u8fbc\u307f\u7dcf\u984d\u3092\u8a08\u7b97\u3059\u308b\"\n  (let [items [{:name \"\u5546\u54c1A\" :price 1000}\n               {:name \"\u5546\u54c1B\" :price 2000}]\n        result (calculate-total-with-tax items 0.1)]\n    (should= 3000 (:subtotal result))\n    (should= 300.0 (:tax result))\n    (should= 3300.0 (:total result))))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#9","title":"9. \u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u30d1\u30bf\u30fc\u30f3","text":""},{"location":"clojure/06-tdd-in-functional/#before","title":"Before: \u8907\u96d1\u306a\u6761\u4ef6\u5206\u5c90","text":"<pre><code>(defn calculate-shipping-before [order]\n  (let [total (:total order)\n        weight (:weight order)\n        region (:region order)]\n    (cond\n      (&gt;= total 10000) 0\n      (= region :local) (if (&lt; weight 5) 300 500)\n      (= region :domestic) (if (&lt; weight 5) 500 800)\n      (= region :international) (if (&lt; weight 5) 2000 3000)\n      :else 500)))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#after","title":"After: \u30c7\u30fc\u30bf\u99c6\u52d5\u306e\u5b9f\u88c5","text":"<pre><code>(defn free-shipping? [total] (&gt;= total 10000))\n\n(def shipping-rates\n  {:local {true 300 false 500}\n   :domestic {true 500 false 800}\n   :international {true 2000 false 3000}})\n\n(defn calculate-shipping [{:keys [total weight region] :or {region :domestic}}]\n  (if (free-shipping? total)\n    0\n    (get-in shipping-rates [region (&lt; weight 5)] 500)))\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#10-tdd","title":"10. TDD \u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9","text":""},{"location":"clojure/06-tdd-in-functional/#1","title":"1. \u5c0f\u3055\u306a\u30b9\u30c6\u30c3\u30d7\u3067\u9032\u3080","text":"<ul> <li>\u4e00\u5ea6\u306b1\u3064\u306e\u30c6\u30b9\u30c8\u3060\u3051\u3092\u8ffd\u52a0</li> <li>\u30c6\u30b9\u30c8\u304c\u901a\u3063\u305f\u3089\u6b21\u306e\u30c6\u30b9\u30c8\u3078</li> </ul>"},{"location":"clojure/06-tdd-in-functional/#2","title":"2. \u30c6\u30b9\u30c8\u540d\u306f\u4ed5\u69d8\u3068\u3057\u3066\u8aad\u3081\u308b","text":"<pre><code>(it \"10000\u5186\u4ee5\u4e0a\u306f\u9001\u6599\u7121\u6599\")\n(it \"\u8ca0\u306e\u6570\u306f\u4f8b\u5916\u3092\u30b9\u30ed\u30fc\u3059\u308b\")\n(it \"\u30d1\u30fc\u30d5\u30a7\u30af\u30c8\u30b2\u30fc\u30e0\u306f300\u70b9\")\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#3_1","title":"3. \u7d14\u7c8b\u95a2\u6570\u3092\u512a\u5148","text":"<ul> <li>\u526f\u4f5c\u7528\u3092\u6301\u3064\u95a2\u6570\u306f\u6700\u5c0f\u9650\u306b</li> <li>\u526f\u4f5c\u7528\u306f\u5883\u754c\u306b\u8ffd\u3044\u51fa\u3059</li> </ul>"},{"location":"clojure/06-tdd-in-functional/#4_1","title":"4. \u30a8\u30c3\u30b8\u30b1\u30fc\u30b9\u3092\u30c6\u30b9\u30c8","text":"<pre><code>(it \"\u7a7a\u6587\u5b57\u5217\u306f0\u3092\u8fd4\u3059\")\n(it \"\u7a7a\u306e\u30ea\u30b9\u30c8\u306f\u7a7a\u306e\u30ea\u30b9\u30c8\u3092\u8fd4\u3059\")\n(it \"\u5883\u754c\u5024\u3067\u6b63\u3057\u304f\u52d5\u4f5c\u3059\u308b\")\n</code></pre>"},{"location":"clojure/06-tdd-in-functional/#_15","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001TDD \u3068\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>Red-Green-Refactor: \u57fa\u672c\u30b5\u30a4\u30af\u30eb</li> <li>FizzBuzz: \u5178\u578b\u7684\u306a TDD \u4f8b</li> <li>\u30ed\u30fc\u30de\u6570\u5b57: \u30c7\u30fc\u30bf\u99c6\u52d5\u306e\u5b9f\u88c5</li> <li>\u30dc\u30a6\u30ea\u30f3\u30b0: \u8907\u96d1\u306a\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af</li> <li>\u7d20\u6570: \u30b7\u30f3\u30d7\u30eb\u306a\u95a2\u6570\u8a2d\u8a08</li> <li>\u30b9\u30bf\u30c3\u30af: \u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020</li> <li>\u6587\u5b57\u5217\u96fb\u5353: \u6bb5\u968e\u7684\u306a\u8981\u4ef6\u8ffd\u52a0</li> <li>\u7d14\u7c8b\u95a2\u6570: \u30c6\u30b9\u30c8\u5bb9\u6613\u6027</li> <li>\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0: \u6761\u4ef6\u5206\u5c90\u306e\u6574\u7406</li> </ol> <p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3068 TDD \u306e\u7d44\u307f\u5408\u308f\u305b\u306b\u3088\u308a\u3001\u4fe1\u983c\u6027\u306e\u9ad8\u3044\u30b3\u30fc\u30c9\u3092\u52b9\u7387\u7684\u306b\u958b\u767a\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"clojure/06-tdd-in-functional/#_16","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part2/src/tdd_in_functional.clj</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part2/spec/tdd_in_functional_spec.clj</code></li> </ul>"},{"location":"clojure/06-tdd-in-functional/#_17","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u304b\u3089\u7b2c3\u90e8\u300c\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3 - \u69cb\u9020\u30d1\u30bf\u30fc\u30f3\u300d\u306b\u5165\u308a\u307e\u3059\u3002Composite \u30d1\u30bf\u30fc\u30f3\u3092\u95a2\u6570\u578b\u30b9\u30bf\u30a4\u30eb\u3067\u5b9f\u88c5\u3059\u308b\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/07-composite-pattern/","title":"\u7b2c7\u7ae0: Composite \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"clojure/07-composite-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Composite \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u30c4\u30ea\u30fc\u69cb\u9020\u3067\u69cb\u6210\u3057\u3001\u500b\u3005\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u96c6\u5408\u3092\u540c\u3058\u3088\u3046\u306b\u6271\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u3053\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306f\u500b\u3005\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u305d\u306e\u7d44\u307f\u5408\u308f\u305b\u3092\u533a\u5225\u305b\u305a\u306b\u64cd\u4f5c\u3067\u304d\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u56f3\u5f62\uff08Shape\uff09\u3068\u30b9\u30a4\u30c3\u30c1\u53ef\u80fd\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\uff08Switchable\uff09\u3092\u4f8b\u306b\u3001Composite \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/07-composite-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Composite \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Component: \u5168\u3066\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u5171\u901a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>Leaf: \u5b50\u8981\u7d20\u3092\u6301\u305f\u306a\u3044\u672b\u7aef\u30aa\u30d6\u30b8\u30a7\u30af\u30c8</li> <li>Composite: \u5b50\u8981\u7d20\u3092\u6301\u3064\u30b3\u30f3\u30c6\u30ca\u30aa\u30d6\u30b8\u30a7\u30af\u30c8</li> </ul> <p></p>"},{"location":"clojure/07-composite-pattern/#2-shape","title":"2. Shape \u306e\u4f8b","text":""},{"location":"clojure/07-composite-pattern/#_2","title":"\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u5b9a\u7fa9","text":"<p>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u3001\u5f62\u72b6\u306e\u5171\u901a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002</p> <pre><code>(ns composite-pattern.shape\n  (:require [clojure.spec.alpha :as s]))\n\n(s/def ::type keyword?)\n(s/def ::shape-type (s/keys :req [::type]))\n\n(defmulti translate\n  \"\u5f62\u72b6\u3092\u79fb\u52d5\u3059\u308b\"\n  (fn [shape dx dy] (::type shape)))\n\n(defmulti scale\n  \"\u5f62\u72b6\u3092\u62e1\u5927/\u7e2e\u5c0f\u3059\u308b\"\n  (fn [shape factor] (::type shape)))\n</code></pre>"},{"location":"clojure/07-composite-pattern/#circle-leaf","title":"Circle (Leaf)","text":"<pre><code>(ns composite-pattern.circle\n  (:require [clojure.spec.alpha :as s]\n            [composite-pattern.shape :as shape]))\n\n(s/def ::center (s/tuple number? number?))\n(s/def ::radius number?)\n(s/def ::circle (s/keys :req [::shape/type ::radius ::center]))\n\n(defn make-circle [center radius]\n  {:post [(s/valid? ::circle %)]}\n  {::shape/type ::circle\n   ::center center\n   ::radius radius})\n\n(defmethod shape/translate ::circle [circle dx dy]\n  (let [[x y] (::center circle)]\n    (assoc circle ::center [(+ x dx) (+ y dy)])))\n\n(defmethod shape/scale ::circle [circle factor]\n  (let [radius (::radius circle)]\n    (assoc circle ::radius (* radius factor))))\n</code></pre>"},{"location":"clojure/07-composite-pattern/#square-leaf","title":"Square (Leaf)","text":"<pre><code>(ns composite-pattern.square\n  (:require [clojure.spec.alpha :as s]\n            [composite-pattern.shape :as shape]))\n\n(s/def ::top-left (s/tuple number? number?))\n(s/def ::side number?)\n(s/def ::square (s/keys :req [::shape/type ::side ::top-left]))\n\n(defn make-square [top-left side]\n  {:post [(s/valid? ::square %)]}\n  {::shape/type ::square\n   ::top-left top-left\n   ::side side})\n\n(defmethod shape/translate ::square [square dx dy]\n  (let [[x y] (::top-left square)]\n    (assoc square ::top-left [(+ x dx) (+ y dy)])))\n\n(defmethod shape/scale ::square [square factor]\n  (let [side (::side square)]\n    (assoc square ::side (* side factor))))\n</code></pre>"},{"location":"clojure/07-composite-pattern/#compositeshape-composite","title":"CompositeShape (Composite)","text":"<pre><code>(ns composite-pattern.composite-shape\n  (:require [clojure.spec.alpha :as s]\n            [composite-pattern.shape :as shape]))\n\n(s/def ::shapes (s/coll-of ::shape/shape-type))\n(s/def ::composite-shape (s/keys :req [::shape/type ::shapes]))\n\n(defn make []\n  {::shape/type ::composite-shape\n   ::shapes []})\n\n(defn add [cs shape]\n  (update cs ::shapes conj shape))\n\n(defmethod shape/translate ::composite-shape [cs dx dy]\n  (let [translated-shapes (mapv #(shape/translate % dx dy)\n                                (::shapes cs))]\n    (assoc cs ::shapes translated-shapes)))\n\n(defmethod shape/scale ::composite-shape [cs factor]\n  (let [scaled-shapes (mapv #(shape/scale % factor)\n                            (::shapes cs))]\n    (assoc cs ::shapes scaled-shapes)))\n</code></pre>"},{"location":"clojure/07-composite-pattern/#_3","title":"\u30af\u30e9\u30b9\u56f3","text":""},{"location":"clojure/07-composite-pattern/#_4","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>;; \u500b\u3005\u306e\u5f62\u72b6\u3092\u4f5c\u6210\n(def circle (circle/make-circle [10 10] 5))\n(def square (square/make-square [0 0] 10))\n\n;; \u8907\u5408\u5f62\u72b6\u3092\u4f5c\u6210\n(def group (-&gt; (cs/make)\n               (cs/add circle)\n               (cs/add square)))\n\n;; \u8907\u5408\u5f62\u72b6\u3092\u79fb\u52d5\uff08\u5168\u3066\u306e\u5b50\u8981\u7d20\u304c\u79fb\u52d5\u3059\u308b\uff09\n(def moved (shape/translate group 5 5))\n;; =&gt; {:shapes [{:center [15 15] :radius 5}\n;;              {:top-left [5 5] :side 10}]}\n\n;; \u8907\u5408\u5f62\u72b6\u3092\u62e1\u5927\uff08\u5168\u3066\u306e\u5b50\u8981\u7d20\u304c\u62e1\u5927\u3059\u308b\uff09\n(def scaled (shape/scale group 2))\n;; =&gt; {:shapes [{:center [10 10] :radius 10}\n;;              {:top-left [0 0] :side 20}]}\n</code></pre>"},{"location":"clojure/07-composite-pattern/#_5","title":"\u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"clojure/07-composite-pattern/#3-switchable","title":"3. Switchable \u306e\u4f8b","text":""},{"location":"clojure/07-composite-pattern/#_6","title":"\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u5b9a\u7fa9","text":"<pre><code>(ns composite-pattern.switchable)\n\n(defmulti turn-on\n  \"\u30b9\u30a4\u30c3\u30c1\u3092\u30aa\u30f3\u306b\u3059\u308b\"\n  :type)\n\n(defmulti turn-off\n  \"\u30b9\u30a4\u30c3\u30c1\u3092\u30aa\u30d5\u306b\u3059\u308b\"\n  :type)\n</code></pre>"},{"location":"clojure/07-composite-pattern/#light-leaf","title":"Light (Leaf)","text":"<pre><code>(ns composite-pattern.light\n  (:require [composite-pattern.switchable :as s]))\n\n(defn make-light []\n  {:type :light\n   :on false})\n\n(defn turn-on-light []\n  (println \"Light turned ON\"))\n\n(defn turn-off-light []\n  (println \"Light turned OFF\"))\n\n(defmethod s/turn-on :light [switchable]\n  (turn-on-light)\n  (assoc switchable :on true))\n\n(defmethod s/turn-off :light [switchable]\n  (turn-off-light)\n  (assoc switchable :on false))\n</code></pre>"},{"location":"clojure/07-composite-pattern/#variablelight-leaf","title":"VariableLight (Leaf)","text":"<pre><code>(ns composite-pattern.variable-light\n  (:require [composite-pattern.switchable :as s]))\n\n(defn make-variable-light []\n  {:type :variable-light\n   :intensity 0})\n\n(defn set-light-intensity [intensity]\n  (println (str \"Light intensity set to \" intensity)))\n\n(defmethod s/turn-on :variable-light [switchable]\n  (set-light-intensity 100)\n  (assoc switchable :intensity 100))\n\n(defmethod s/turn-off :variable-light [switchable]\n  (set-light-intensity 0)\n  (assoc switchable :intensity 0))\n</code></pre>"},{"location":"clojure/07-composite-pattern/#compositeswitchable-composite","title":"CompositeSwitchable (Composite)","text":"<pre><code>(ns composite-pattern.composite-switchable\n  (:require [composite-pattern.switchable :as s]))\n\n(defn make-composite-switchable []\n  {:type :composite-switchable\n   :switchables []})\n\n(defn add [composite-switchable switchable]\n  (update composite-switchable :switchables conj switchable))\n\n(defmethod s/turn-on :composite-switchable [c-switchable]\n  (let [turned-on (mapv s/turn-on (:switchables c-switchable))]\n    (assoc c-switchable :switchables turned-on)))\n\n(defmethod s/turn-off :composite-switchable [c-switchable]\n  (let [turned-off (mapv s/turn-off (:switchables c-switchable))]\n    (assoc c-switchable :switchables turned-off)))\n</code></pre>"},{"location":"clojure/07-composite-pattern/#_7","title":"\u30af\u30e9\u30b9\u56f3","text":""},{"location":"clojure/07-composite-pattern/#_8","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>;; \u500b\u3005\u306e\u30e9\u30a4\u30c8\u3092\u4f5c\u6210\n(def light (l/make-light))\n(def vlight (v/make-variable-light))\n\n;; \u8907\u5408\u30b9\u30a4\u30c3\u30c1\u3092\u4f5c\u6210\n(def room-lights (-&gt; (cs/make-composite-switchable)\n                     (cs/add light)\n                     (cs/add vlight)))\n\n;; \u5168\u3066\u306e\u30e9\u30a4\u30c8\u3092\u30aa\u30f3\u306b\u3059\u308b\n(s/turn-on room-lights)\n;; Light turned ON\n;; Light intensity set to 100\n\n;; \u5168\u3066\u306e\u30e9\u30a4\u30c8\u3092\u30aa\u30d5\u306b\u3059\u308b\n(s/turn-off room-lights)\n;; Light turned OFF\n;; Light intensity set to 0\n</code></pre>"},{"location":"clojure/07-composite-pattern/#_9","title":"\u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"clojure/07-composite-pattern/#4","title":"4. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u7d71\u4e00\u7684\u306a\u64cd\u4f5c: \u500b\u3005\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u30b0\u30eb\u30fc\u30d7\u3092\u540c\u3058\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u64cd\u4f5c\u53ef\u80fd</li> <li>\u968e\u5c64\u69cb\u9020: \u30cd\u30b9\u30c8\u3057\u305f\u69cb\u9020\u3092\u81ea\u7136\u306b\u8868\u73fe\u53ef\u80fd</li> <li>\u62e1\u5f35\u6027: \u65b0\u3057\u3044 Leaf \u3084 Composite \u3092\u8ffd\u52a0\u3057\u3084\u3059\u3044</li> <li>\u518d\u5e30\u7684\u306a\u69cb\u9020: Composite \u306f\u4ed6\u306e Composite \u3092\u542b\u3080\u3053\u3068\u3082\u53ef\u80fd</li> </ol>"},{"location":"clojure/07-composite-pattern/#5","title":"5. \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306e\u7279\u5fb4","text":"<p>Clojure \u3067\u306e Composite \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u306b\u306f\u4ee5\u4e0b\u306e\u7279\u5fb4\u304c\u3042\u308a\u307e\u3059\uff1a</p> <ol> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: \u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u95a2\u6570\u3067\u578b\u306b\u57fa\u3065\u3044\u305f\u591a\u614b\u6027\u3092\u5b9f\u73fe</li> <li>\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u306a\u30c7\u30fc\u30bf: \u64cd\u4f5c\u306f\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u3092\u8fd4\u3059\uff08\u5143\u306e\u30c7\u30fc\u30bf\u3092\u5909\u66f4\u3057\u306a\u3044\uff09</li> <li>Spec \u306b\u3088\u308b\u691c\u8a3c: \u30c7\u30fc\u30bf\u306e\u6574\u5408\u6027\u3092\u4fdd\u8a3c</li> <li>\u30b7\u30f3\u30d7\u30eb\u306a\u69cb\u9020: \u30af\u30e9\u30b9\u306e\u4ee3\u308f\u308a\u306b\u30de\u30c3\u30d7\u3092\u4f7f\u7528</li> </ol>"},{"location":"clojure/07-composite-pattern/#_10","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Composite \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>Shape \u306e\u4f8b: \u56f3\u5f62\u306e\u79fb\u52d5\u3068\u62e1\u5927\u3092\u7d71\u4e00\u7684\u306b\u64cd\u4f5c</li> <li>Switchable \u306e\u4f8b: \u8907\u6570\u306e\u30b9\u30a4\u30c3\u30c1\u3092\u30b0\u30eb\u30fc\u30d7\u5316\u3057\u3066\u64cd\u4f5c</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: Clojure \u3067\u306e\u591a\u614b\u6027\u306e\u5b9f\u73fe\u65b9\u6cd5</li> <li>Spec: \u30c7\u30fc\u30bf\u69cb\u9020\u306e\u691c\u8a3c</li> </ol> <p>Composite \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30c4\u30ea\u30fc\u69cb\u9020\u306e\u30c7\u30fc\u30bf\u3092\u6271\u3046\u969b\u306b\u975e\u5e38\u306b\u6709\u52b9\u306a\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002</p>"},{"location":"clojure/07-composite-pattern/#_11","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part3/src/composite_pattern/</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part3/spec/composite_pattern/</code></li> </ul>"},{"location":"clojure/07-composite-pattern/#_12","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Decorator \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u65e2\u5b58\u306e\u6a5f\u80fd\u306b\u65b0\u3057\u3044\u6a5f\u80fd\u3092\u52d5\u7684\u306b\u8ffd\u52a0\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/08-decorator-pattern/","title":"\u7b2c8\u7ae0: Decorator \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"clojure/08-decorator-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Decorator \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u65e2\u5b58\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u65b0\u3057\u3044\u6a5f\u80fd\u3092\u52d5\u7684\u306b\u8ffd\u52a0\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u3053\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u30b5\u30d6\u30af\u30e9\u30b9\u5316\u306b\u3088\u308b\u7d99\u627f\u3088\u308a\u3082\u67d4\u8edf\u306a\u65b9\u6cd5\u3067\u6a5f\u80fd\u3092\u62e1\u5f35\u3067\u304d\u307e\u3059\u3002</p> <p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u9ad8\u968e\u95a2\u6570\u3092\u4f7f\u3063\u3066\u95a2\u6570\u3092\u30e9\u30c3\u30d7\u3057\u3001\u6a2a\u65ad\u7684\u95a2\u5fc3\u4e8b\uff08\u30ed\u30b0\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u3001\u8a8d\u8a3c\u306a\u3069\uff09\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\u672c\u7ae0\u3067\u306f\u3001\u5f62\u72b6\u306e\u30b8\u30e3\u30fc\u30ca\u30ea\u30f3\u30b0\u3068\u95a2\u6570\u30c7\u30b3\u30ec\u30fc\u30bf\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/08-decorator-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Decorator \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Component: \u30c7\u30b3\u30ec\u30fc\u30c8\u5bfe\u8c61\u306e\u5171\u901a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>ConcreteComponent: \u5177\u4f53\u7684\u306a\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8</li> <li>Decorator: Component \u3092\u30e9\u30c3\u30d7\u3057\u3001\u8ffd\u52a0\u6a5f\u80fd\u3092\u63d0\u4f9b</li> </ul> <p></p>"},{"location":"clojure/08-decorator-pattern/#2-journaledshape","title":"2. JournaledShape \u306e\u4f8b","text":""},{"location":"clojure/08-decorator-pattern/#_2","title":"\u30c7\u30b3\u30ec\u30fc\u30bf\u306e\u5b9f\u88c5","text":"<p>\u5f62\u72b6\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u64cd\u4f5c\u306e\u5c65\u6b74\u3092\u8a18\u9332\u3059\u308b\u6a5f\u80fd\u3092\u8ffd\u52a0\u3059\u308b\u30c7\u30b3\u30ec\u30fc\u30bf\u3067\u3059\u3002</p> <pre><code>(ns decorator-pattern.journaled-shape\n  (:require [clojure.spec.alpha :as s]\n            [composite-pattern.shape :as shape]))\n\n(s/def ::journal-entry\n  (s/or :translate (s/tuple #{:translate} number? number?)\n        :scale (s/tuple #{:scale} number?)))\n(s/def ::journal (s/coll-of ::journal-entry))\n(s/def ::shape ::shape/shape-type)\n(s/def ::journaled-shape (s/and\n                          (s/keys :req [::shape/type ::journal ::shape])\n                          #(= ::journal-shape (::shape/type %))))\n\n(defn make\n  \"\u5f62\u72b6\u3092\u30c7\u30b3\u30ec\u30fc\u30c8\u3057\u3066\u30b8\u30e3\u30fc\u30ca\u30eb\u6a5f\u80fd\u3092\u8ffd\u52a0\u3059\u308b\"\n  [shape]\n  {:post [(s/valid? ::journaled-shape %)]}\n  {::shape/type ::journal-shape\n   ::journal []\n   ::shape shape})\n\n(defmethod shape/translate ::journal-shape [js dx dy]\n  (-&gt; js\n      (update ::journal conj [:translate dx dy])\n      (assoc ::shape (shape/translate (::shape js) dx dy))))\n\n(defmethod shape/scale ::journal-shape [js factor]\n  (-&gt; js\n      (update ::journal conj [:scale factor])\n      (assoc ::shape (shape/scale (::shape js) factor))))\n</code></pre>"},{"location":"clojure/08-decorator-pattern/#_3","title":"\u30af\u30e9\u30b9\u56f3","text":""},{"location":"clojure/08-decorator-pattern/#_4","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>(require '[composite-pattern.square :as square])\n(require '[decorator-pattern.journaled-shape :as js])\n\n;; \u5f62\u72b6\u3092\u30c7\u30b3\u30ec\u30fc\u30c8\n(def journaled-square\n  (-&gt; (js/make (square/make-square [0 0] 1))\n      (shape/translate 2 3)\n      (shape/scale 5)))\n\n;; \u30b8\u30e3\u30fc\u30ca\u30eb\u3092\u78ba\u8a8d\n(js/get-journal journaled-square)\n;; =&gt; [[:translate 2 3] [:scale 5]]\n\n;; \u5b9f\u969b\u306e\u5f62\u72b6\u3092\u78ba\u8a8d\n(js/get-shape journaled-square)\n;; =&gt; {:top-left [2 3], :side 5}\n</code></pre>"},{"location":"clojure/08-decorator-pattern/#_5","title":"\u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"clojure/08-decorator-pattern/#3","title":"3. \u95a2\u6570\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u9ad8\u968e\u95a2\u6570\u3092\u4f7f\u3063\u3066\u95a2\u6570\u3092\u30c7\u30b3\u30ec\u30fc\u30c8\u3057\u307e\u3059\u3002</p>"},{"location":"clojure/08-decorator-pattern/#_6","title":"\u30ed\u30b0\u51fa\u529b\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>(defn with-logging\n  \"\u95a2\u6570\u306b\u30ed\u30b0\u51fa\u529b\u3092\u8ffd\u52a0\u3059\u308b\u30c7\u30b3\u30ec\u30fc\u30bf\"\n  [f name]\n  (fn [&amp; args]\n    (println (str \"[LOG] \" name \" called with: \" args))\n    (let [result (apply f args)]\n      (println (str \"[LOG] \" name \" returned: \" result))\n      result)))\n\n;; \u4f7f\u7528\u4f8b\n(def add-logged (with-logging + \"add\"))\n(add-logged 2 3)\n;; [LOG] add called with: (2 3)\n;; [LOG] add returned: 5\n;; =&gt; 5\n</code></pre>"},{"location":"clojure/08-decorator-pattern/#_7","title":"\u30ea\u30c8\u30e9\u30a4\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>(defn with-retry\n  \"\u95a2\u6570\u306b\u30ea\u30c8\u30e9\u30a4\u6a5f\u80fd\u3092\u8ffd\u52a0\u3059\u308b\u30c7\u30b3\u30ec\u30fc\u30bf\"\n  [f max-retries]\n  (fn [&amp; args]\n    (loop [attempts 0]\n      (let [result (try\n                     {:success true :value (apply f args)}\n                     (catch Exception e\n                       {:success false :error e}))]\n        (if (:success result)\n          (:value result)\n          (if (&lt; attempts max-retries)\n            (do\n              (println \"[RETRY] Retrying...\")\n              (recur (inc attempts)))\n            (throw (:error result))))))))\n</code></pre>"},{"location":"clojure/08-decorator-pattern/#_8","title":"\u30ad\u30e3\u30c3\u30b7\u30e5\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>(defn with-cache\n  \"\u95a2\u6570\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u3092\u8ffd\u52a0\u3059\u308b\u30c7\u30b3\u30ec\u30fc\u30bf\"\n  [f]\n  (let [cache (atom {})]\n    (fn [&amp; args]\n      (if-let [cached (get @cache args)]\n        (do\n          (println \"[CACHE] Hit for\" args)\n          cached)\n        (let [result (apply f args)]\n          (println \"[CACHE] Miss for\" args)\n          (swap! cache assoc args result)\n          result)))))\n\n;; \u4f7f\u7528\u4f8b\n(def expensive-fn-cached (with-cache expensive-fn))\n</code></pre>"},{"location":"clojure/08-decorator-pattern/#_9","title":"\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>(defn with-validation\n  \"\u95a2\u6570\u306b\u5165\u529b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u8ffd\u52a0\u3059\u308b\u30c7\u30b3\u30ec\u30fc\u30bf\"\n  [f validator error-msg]\n  (fn [&amp; args]\n    (if (apply validator args)\n      (apply f args)\n      (throw (ex-info error-msg {:args args})))))\n\n;; \u4f7f\u7528\u4f8b\n(def positive-only\n  (with-validation\n    (fn [x] (* x 2))\n    (fn [x] (pos? x))\n    \"Input must be positive\"))\n\n(positive-only 5)   ;; =&gt; 10\n(positive-only -5)  ;; =&gt; Exception!\n</code></pre>"},{"location":"clojure/08-decorator-pattern/#4","title":"4. \u30c7\u30b3\u30ec\u30fc\u30bf\u306e\u7d44\u307f\u5408\u308f\u305b","text":"<p>\u8907\u6570\u306e\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002</p> <pre><code>(defn compose-decorators\n  \"\u8907\u6570\u306e\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\"\n  [f &amp; decorators]\n  (reduce (fn [decorated decorator]\n            (decorator decorated))\n          f\n          decorators))\n\n;; \u4f7f\u7528\u4f8b\n(def enhanced-fn\n  (compose-decorators\n    base-fn\n    with-cache\n    #(with-logging % \"my-fn\")\n    #(with-retry % 3)))\n</code></pre>"},{"location":"clojure/08-decorator-pattern/#_10","title":"\u7d44\u307f\u5408\u308f\u305b\u306e\u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"clojure/08-decorator-pattern/#5","title":"5. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u5358\u4e00\u8cac\u4efb\u306e\u539f\u5247: \u5404\u30c7\u30b3\u30ec\u30fc\u30bf\u306f\u4e00\u3064\u306e\u6a5f\u80fd\u306e\u307f\u3092\u8ffd\u52a0</li> <li>\u958b\u653e/\u9589\u9396\u306e\u539f\u5247: \u65e2\u5b58\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u305b\u305a\u306b\u6a5f\u80fd\u3092\u8ffd\u52a0</li> <li>\u67d4\u8edf\u306a\u7d44\u307f\u5408\u308f\u305b: \u5fc5\u8981\u306a\u6a5f\u80fd\u3060\u3051\u3092\u9078\u629e\u3057\u3066\u7d44\u307f\u5408\u308f\u305b\u53ef\u80fd</li> <li>\u5b9f\u884c\u6642\u306e\u6c7a\u5b9a: \u3069\u306e\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u9069\u7528\u3059\u308b\u304b\u5b9f\u884c\u6642\u306b\u6c7a\u5b9a\u53ef\u80fd</li> </ol>"},{"location":"clojure/08-decorator-pattern/#6","title":"6. \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306e\u7279\u5fb4","text":"<p>Clojure \u3067\u306e Decorator \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u306b\u306f\u4ee5\u4e0b\u306e\u7279\u5fb4\u304c\u3042\u308a\u307e\u3059\uff1a</p> <ol> <li>\u9ad8\u968e\u95a2\u6570: \u95a2\u6570\u3092\u5f15\u6570\u306b\u53d6\u308a\u3001\u65b0\u3057\u3044\u95a2\u6570\u3092\u8fd4\u3059</li> <li>\u30af\u30ed\u30fc\u30b8\u30e3: \u72b6\u614b\uff08\u30ad\u30e3\u30c3\u30b7\u30e5\u306a\u3069\uff09\u3092\u5185\u90e8\u306b\u4fdd\u6301</li> <li>\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u306a\u30c7\u30fc\u30bf: \u30c7\u30b3\u30ec\u30fc\u30c8\u5f8c\u3082\u5143\u306e\u30c7\u30fc\u30bf\u306f\u5909\u66f4\u3055\u308c\u306a\u3044</li> <li>\u5408\u6210\u306e\u3057\u3084\u3059\u3055: <code>comp</code> \u3084 <code>reduce</code> \u3067\u7c21\u5358\u306b\u7d44\u307f\u5408\u308f\u305b\u53ef\u80fd</li> </ol>"},{"location":"clojure/08-decorator-pattern/#_11","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Decorator \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>JournaledShape: \u5f62\u72b6\u64cd\u4f5c\u306e\u5c65\u6b74\u3092\u8a18\u9332\u3059\u308b\u30c7\u30b3\u30ec\u30fc\u30bf</li> <li>\u95a2\u6570\u30c7\u30b3\u30ec\u30fc\u30bf: \u30ed\u30b0\u3001\u30ea\u30c8\u30e9\u30a4\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u306a\u3069\u306e\u6a2a\u65ad\u7684\u95a2\u5fc3\u4e8b</li> <li>\u30c7\u30b3\u30ec\u30fc\u30bf\u306e\u7d44\u307f\u5408\u308f\u305b: \u8907\u6570\u306e\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u67d4\u8edf\u306b\u7d44\u307f\u5408\u308f\u305b</li> </ol> <p>Decorator \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u65e2\u5b58\u306e\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u305b\u305a\u306b\u6a5f\u80fd\u3092\u62e1\u5f35\u3059\u308b\u5f37\u529b\u306a\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002</p>"},{"location":"clojure/08-decorator-pattern/#_12","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part3/src/decorator_pattern/</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part3/spec/decorator_pattern/</code></li> </ul>"},{"location":"clojure/08-decorator-pattern/#_13","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Adapter \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u7570\u306a\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u9593\u306e\u5909\u63db\u3068\u30ec\u30ac\u30b7\u30fc\u30b7\u30b9\u30c6\u30e0\u3068\u306e\u7d71\u5408\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/09-adapter-pattern/","title":"\u7b2c9\u7ae0: Adapter \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"clojure/09-adapter-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Adapter \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u65e2\u5b58\u306e\u30af\u30e9\u30b9\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u671f\u5f85\u3059\u308b\u5225\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306b\u5909\u63db\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u3053\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u4e92\u63db\u6027\u306e\u306a\u3044\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u6301\u3064\u30af\u30e9\u30b9\u540c\u58eb\u3092\u9023\u643a\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u53ef\u5909\u5f37\u5ea6\u30e9\u30a4\u30c8\u306e\u30a2\u30c0\u30d7\u30bf\u30fc\u3068\u30c7\u30fc\u30bf\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u5909\u63db\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/09-adapter-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Adapter \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Target: \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u671f\u5f85\u3059\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>Adaptee: \u65e2\u5b58\u306e\u30af\u30e9\u30b9\uff08\u9069\u5fdc\u3055\u308c\u308b\u5074\uff09</li> <li>Adapter: Target \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u5b9f\u88c5\u3057\u3001Adaptee \u3092\u4f7f\u7528</li> </ul> <p></p>"},{"location":"clojure/09-adapter-pattern/#2-variablelight","title":"2. VariableLight \u306e\u4f8b","text":""},{"location":"clojure/09-adapter-pattern/#switchable-target","title":"Switchable \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9 (Target)","text":"<pre><code>(ns adapter-pattern.switchable)\n\n(defmulti turn-on\n  \"\u30b9\u30a4\u30c3\u30c1\u3092\u30aa\u30f3\u306b\u3059\u308b\"\n  :type)\n\n(defmulti turn-off\n  \"\u30b9\u30a4\u30c3\u30c1\u3092\u30aa\u30d5\u306b\u3059\u308b\"\n  :type)\n</code></pre>"},{"location":"clojure/09-adapter-pattern/#variablelight-adaptee","title":"VariableLight (Adaptee)","text":"<p>\u53ef\u5909\u5f37\u5ea6\u3092\u6301\u3064\u30e9\u30a4\u30c8\u306f\u3001\u5358\u7d14\u306a\u30aa\u30f3/\u30aa\u30d5\u3067\u306f\u306a\u304f\u3001\u5f37\u5ea6\u3092\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p> <pre><code>(ns adapter-pattern.variable-light)\n\n(defn turn-on-light\n  \"\u30e9\u30a4\u30c8\u3092\u6307\u5b9a\u3057\u305f\u5f37\u5ea6\u3067\u70b9\u706f\u3059\u308b\"\n  [intensity]\n  (println (str \"VariableLight: intensity set to \" intensity))\n  {:intensity intensity})\n</code></pre>"},{"location":"clojure/09-adapter-pattern/#variablelightadapter-adapter","title":"VariableLightAdapter (Adapter)","text":"<pre><code>(ns adapter-pattern.variable-light-adapter\n  (:require [adapter-pattern.switchable :as s]\n            [adapter-pattern.variable-light :as vl]))\n\n(defn make-adapter\n  \"VariableLight \u306e\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u4f5c\u6210\u3059\u308b\"\n  [min-intensity max-intensity]\n  {:type :variable-light-adapter\n   :min-intensity min-intensity\n   :max-intensity max-intensity})\n\n(defmethod s/turn-on :variable-light-adapter [adapter]\n  (vl/turn-on-light (:max-intensity adapter)))\n\n(defmethod s/turn-off :variable-light-adapter [adapter]\n  (vl/turn-on-light (:min-intensity adapter)))\n</code></pre>"},{"location":"clojure/09-adapter-pattern/#_2","title":"\u30af\u30e9\u30b9\u56f3","text":""},{"location":"clojure/09-adapter-pattern/#client","title":"Client","text":"<pre><code>(ns adapter-pattern.engage-switch\n  (:require [adapter-pattern.switchable :as s]))\n\n(defn engage-switch\n  \"\u30b9\u30a4\u30c3\u30c1\u3092\u64cd\u4f5c\u3059\u308b\"\n  [switchable]\n  (println \"Engaging switch...\")\n  (let [on-result (s/turn-on switchable)\n        off-result (s/turn-off switchable)]\n    {:on-result on-result\n     :off-result off-result}))\n</code></pre>"},{"location":"clojure/09-adapter-pattern/#_3","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>(require '[adapter-pattern.variable-light-adapter :as adapter])\n(require '[adapter-pattern.engage-switch :as client])\n\n;; \u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u4f5c\u6210\uff08\u6700\u5c0f0\u3001\u6700\u5927100\uff09\n(def vl-adapter (adapter/make-adapter 0 100))\n\n;; \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306fSwitchable\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u64cd\u4f5c\n(client/engage-switch vl-adapter)\n;; Engaging switch...\n;; VariableLight: intensity set to 100\n;; VariableLight: intensity set to 0\n;; =&gt; {:on-result {:intensity 100}, :off-result {:intensity 0}}\n</code></pre>"},{"location":"clojure/09-adapter-pattern/#_4","title":"\u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"clojure/09-adapter-pattern/#3","title":"3. \u30c7\u30fc\u30bf\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u30a2\u30c0\u30d7\u30bf\u30fc","text":""},{"location":"clojure/09-adapter-pattern/#_5","title":"\u30e6\u30fc\u30b6\u30fc\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u5909\u63db","text":"<p>\u7570\u306a\u308b\u30b7\u30b9\u30c6\u30e0\u9593\u3067\u30c7\u30fc\u30bf\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304c\u7570\u306a\u308b\u5834\u5408\u3001\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u4f7f\u3063\u3066\u5909\u63db\u3057\u307e\u3059\u3002</p> <pre><code>(ns adapter-pattern.data-format\n  (:require [clojure.string :as str]))\n\n(defn adapt-old-user-to-new\n  \"\u65e7\u30e6\u30fc\u30b6\u30fc\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u65b0\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306b\u5909\u63db\"\n  [old-user]\n  {:name (str (:lastName old-user) \" \" (:firstName old-user))\n   :email (:emailAddress old-user)\n   :phone (:phoneNumber old-user)\n   :metadata {:migrated true\n              :original-format :old}})\n\n(defn adapt-new-user-to-old\n  \"\u65b0\u30e6\u30fc\u30b6\u30fc\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u65e7\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306b\u5909\u63db\"\n  [new-user]\n  (let [name-parts (str/split (:name new-user) #\" \")\n        last-name (first name-parts)\n        first-name (if (&gt; (count name-parts) 1)\n                     (second name-parts)\n                     \"\")]\n    {:firstName first-name\n     :lastName last-name\n     :emailAddress (:email new-user)\n     :phoneNumber (:phone new-user)}))\n</code></pre>"},{"location":"clojure/09-adapter-pattern/#_6","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>;; \u65e7\u30d5\u30a9\u30fc\u30de\u30c3\u30c8 \u2192 \u65b0\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\n(def old-user {:firstName \"\u592a\u90ce\"\n               :lastName \"\u5c71\u7530\"\n               :emailAddress \"taro@example.com\"\n               :phoneNumber \"090-1234-5678\"})\n\n(adapt-old-user-to-new old-user)\n;; =&gt; {:name \"\u5c71\u7530 \u592a\u90ce\"\n;;     :email \"taro@example.com\"\n;;     :phone \"090-1234-5678\"\n;;     :metadata {:migrated true, :original-format :old}}\n\n;; \u65b0\u30d5\u30a9\u30fc\u30de\u30c3\u30c8 \u2192 \u65e7\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\n(def new-user {:name \"\u5c71\u7530 \u592a\u90ce\"\n               :email \"taro@example.com\"\n               :phone \"090-1234-5678\"})\n\n(adapt-new-user-to-old new-user)\n;; =&gt; {:firstName \"\u592a\u90ce\"\n;;     :lastName \"\u5c71\u7530\"\n;;     :emailAddress \"taro@example.com\"\n;;     :phoneNumber \"090-1234-5678\"}\n</code></pre>"},{"location":"clojure/09-adapter-pattern/#api","title":"API \u30ec\u30b9\u30dd\u30f3\u30b9\u30a2\u30c0\u30d7\u30bf\u30fc","text":"<pre><code>(defn adapt-external-api-response\n  \"\u5916\u90e8API \u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u3092\u5185\u90e8\u5f62\u5f0f\u306b\u5909\u63db\"\n  [external-response]\n  {:id (get-in external-response [\"data\" \"identifier\"])\n   :name (get-in external-response [\"data\" \"attributes\" \"name\"])\n   :created-at (get-in external-response [\"data\" \"attributes\" \"createdAt\"])\n   :metadata {:source :external-api\n              :original-id (get-in external-response [\"data\" \"id\"])}})\n\n(defn adapt-internal-to-external\n  \"\u5185\u90e8\u5f62\u5f0f\u3092\u5916\u90e8API \u306e\u5f62\u5f0f\u306b\u5909\u63db\"\n  [internal-data]\n  {\"data\" {\"type\" \"resource\"\n           \"id\" (str (:id internal-data))\n           \"attributes\" {\"name\" (:name internal-data)\n                         \"createdAt\" (:created-at internal-data)}}})\n</code></pre>"},{"location":"clojure/09-adapter-pattern/#_7","title":"\u30c7\u30fc\u30bf\u5909\u63db\u306e\u56f3","text":""},{"location":"clojure/09-adapter-pattern/#4","title":"4. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u65e2\u5b58\u30b3\u30fc\u30c9\u306e\u518d\u5229\u7528: \u65e2\u5b58\u306e\u30af\u30e9\u30b9\u3092\u5909\u66f4\u305b\u305a\u306b\u65b0\u3057\u3044\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u4f7f\u7528</li> <li>\u5358\u4e00\u8cac\u4efb\u306e\u539f\u5247: \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u5909\u63db\u306e\u30ed\u30b8\u30c3\u30af\u3092\u5206\u96e2</li> <li>\u958b\u653e/\u9589\u9396\u306e\u539f\u5247: \u65b0\u3057\u3044\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u8ffd\u52a0\u3057\u3066\u3082\u65e2\u5b58\u30b3\u30fc\u30c9\u306f\u5909\u66f4\u4e0d\u8981</li> <li>\u30ec\u30ac\u30b7\u30fc\u30b7\u30b9\u30c6\u30e0\u3068\u306e\u7d71\u5408: \u53e4\u3044\u30b7\u30b9\u30c6\u30e0\u3068\u65b0\u3057\u3044\u30b7\u30b9\u30c6\u30e0\u3092\u9023\u643a</li> </ol>"},{"location":"clojure/09-adapter-pattern/#5","title":"5. \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306e\u7279\u5fb4","text":"<p>Clojure \u3067\u306e Adapter \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u306b\u306f\u4ee5\u4e0b\u306e\u7279\u5fb4\u304c\u3042\u308a\u307e\u3059\uff1a</p> <ol> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: \u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u95a2\u6570\u3067\u578b\u306b\u57fa\u3065\u3044\u305f\u591a\u614b\u6027\u3092\u5b9f\u73fe</li> <li>\u95a2\u6570\u306b\u3088\u308b\u5909\u63db: \u5358\u7d14\u306a\u30c7\u30fc\u30bf\u5909\u63db\u306f\u95a2\u6570\u3067\u76f4\u63a5\u5b9f\u88c5</li> <li>\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u306a\u30c7\u30fc\u30bf: \u5909\u63db\u5f8c\u3082\u5143\u306e\u30c7\u30fc\u30bf\u306f\u5909\u66f4\u3055\u308c\u306a\u3044</li> <li>\u5408\u6210\u306e\u3057\u3084\u3059\u3055: \u8907\u6570\u306e\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u7d44\u307f\u5408\u308f\u305b\u53ef\u80fd</li> </ol>"},{"location":"clojure/09-adapter-pattern/#_8","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Adapter \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>VariableLightAdapter: \u53ef\u5909\u5f37\u5ea6\u30e9\u30a4\u30c8\u3092\u5358\u7d14\u306a\u30aa\u30f3/\u30aa\u30d5\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306b\u9069\u5fdc</li> <li>\u30c7\u30fc\u30bf\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u30a2\u30c0\u30d7\u30bf\u30fc: \u7570\u306a\u308b\u30c7\u30fc\u30bf\u5f62\u5f0f\u9593\u306e\u5909\u63db</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: Clojure \u3067\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u9069\u5fdc</li> </ol> <p>Adapter \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u65e2\u5b58\u306e\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u305b\u305a\u306b\u7570\u306a\u308b\u30b7\u30b9\u30c6\u30e0\u3092\u9023\u643a\u3055\u305b\u308b\u969b\u306b\u975e\u5e38\u306b\u6709\u52b9\u3067\u3059\u3002</p>"},{"location":"clojure/09-adapter-pattern/#_9","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part3/src/adapter_pattern/</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part3/spec/adapter_pattern/</code></li> </ul>"},{"location":"clojure/09-adapter-pattern/#_10","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Facade \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u8907\u96d1\u306a\u30b5\u30d6\u30b7\u30b9\u30c6\u30e0\u3078\u306e\u30b7\u30f3\u30d7\u30eb\u306a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u63d0\u4f9b\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/10-strategy-pattern/","title":"\u7b2c10\u7ae0: Strategy \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"clojure/10-strategy-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Strategy \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u30ab\u30d7\u30bb\u30eb\u5316\u3057\u3001\u305d\u308c\u3089\u3092\u4ea4\u63db\u53ef\u80fd\u306b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u3053\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u72ec\u7acb\u3057\u3066\u5909\u66f4\u3067\u304d\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u6599\u91d1\u8a08\u7b97\u3068\u914d\u9001\u6599\u91d1\u306e\u4f8b\u3092\u901a\u3058\u3066\u3001\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u3068\u9ad8\u968e\u95a2\u6570\u306b\u3088\u308b Strategy \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/10-strategy-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Strategy \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Strategy: \u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>ConcreteStrategy: \u5177\u4f53\u7684\u306a\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u5b9f\u88c5</li> <li>Context: Strategy \u3092\u4f7f\u7528\u3059\u308b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8</li> </ul> <p></p>"},{"location":"clojure/10-strategy-pattern/#2","title":"2. \u6599\u91d1\u8a08\u7b97\u306e\u4f8b","text":""},{"location":"clojure/10-strategy-pattern/#strategy","title":"Strategy \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9","text":"<pre><code>(ns strategy-pattern.pricing)\n\n(defmulti calculate-price\n  \"\u6599\u91d1\u3092\u8a08\u7b97\u3059\u308b\"\n  (fn [strategy _amount] (:type strategy)))\n</code></pre>"},{"location":"clojure/10-strategy-pattern/#concretestrategy","title":"ConcreteStrategy: \u901a\u5e38\u6599\u91d1","text":"<pre><code>(defn make-regular-pricing\n  \"\u901a\u5e38\u6599\u91d1\u6226\u7565\u3092\u4f5c\u6210\"\n  []\n  {:type :regular})\n\n(defmethod calculate-price :regular [_strategy amount]\n  amount)\n</code></pre>"},{"location":"clojure/10-strategy-pattern/#concretestrategy_1","title":"ConcreteStrategy: \u5272\u5f15\u6599\u91d1","text":"<pre><code>(defn make-discount-pricing\n  \"\u5272\u5f15\u6599\u91d1\u6226\u7565\u3092\u4f5c\u6210\"\n  [discount-rate]\n  {:type :discount\n   :discount-rate discount-rate})\n\n(defmethod calculate-price :discount [strategy amount]\n  (let [rate (:discount-rate strategy)]\n    (* amount (- 1.0 rate))))\n</code></pre>"},{"location":"clojure/10-strategy-pattern/#concretestrategy_2","title":"ConcreteStrategy: \u4f1a\u54e1\u6599\u91d1","text":"<pre><code>(defn make-member-pricing\n  \"\u4f1a\u54e1\u6599\u91d1\u6226\u7565\u3092\u4f5c\u6210\"\n  [member-level]\n  {:type :member\n   :member-level member-level})\n\n(defmethod calculate-price :member [strategy amount]\n  (let [level (:member-level strategy)\n        rate (case level\n               :gold 0.20\n               :silver 0.15\n               :bronze 0.10\n               0.0)]\n    (* amount (- 1.0 rate))))\n</code></pre>"},{"location":"clojure/10-strategy-pattern/#_2","title":"\u30af\u30e9\u30b9\u56f3","text":""},{"location":"clojure/10-strategy-pattern/#_3","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>(require '[strategy-pattern.pricing :as pricing])\n\n;; \u901a\u5e38\u6599\u91d1\n(def regular (pricing/make-regular-pricing))\n(pricing/calculate-price regular 1000)\n;; =&gt; 1000\n\n;; 10%\u5272\u5f15\n(def discount (pricing/make-discount-pricing 0.10))\n(pricing/calculate-price discount 1000)\n;; =&gt; 900.0\n\n;; \u30b4\u30fc\u30eb\u30c9\u4f1a\u54e1\u6599\u91d1\n(def gold (pricing/make-member-pricing :gold))\n(pricing/calculate-price gold 1000)\n;; =&gt; 800.0\n</code></pre>"},{"location":"clojure/10-strategy-pattern/#3-context","title":"3. Context: \u30b7\u30e7\u30c3\u30d4\u30f3\u30b0\u30ab\u30fc\u30c8","text":""},{"location":"clojure/10-strategy-pattern/#_4","title":"\u5b9f\u88c5","text":"<pre><code>(ns strategy-pattern.context\n  (:require [strategy-pattern.pricing :as pricing]))\n\n(defn make-cart\n  \"\u30b7\u30e7\u30c3\u30d4\u30f3\u30b0\u30ab\u30fc\u30c8\u3092\u4f5c\u6210\"\n  [items pricing-strategy]\n  {:items items\n   :strategy pricing-strategy})\n\n(defn cart-total\n  \"\u30ab\u30fc\u30c8\u306e\u5408\u8a08\u91d1\u984d\u3092\u8a08\u7b97\"\n  [cart]\n  (let [items (:items cart)\n        strategy (:strategy cart)\n        subtotal (reduce + (map :price items))]\n    (pricing/calculate-price strategy subtotal)))\n\n(defn change-strategy\n  \"\u6599\u91d1\u6226\u7565\u3092\u5909\u66f4\"\n  [cart new-strategy]\n  (assoc cart :strategy new-strategy))\n</code></pre>"},{"location":"clojure/10-strategy-pattern/#_5","title":"\u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"clojure/10-strategy-pattern/#_6","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>(require '[strategy-pattern.context :as ctx])\n(require '[strategy-pattern.pricing :as pricing])\n\n;; \u30ab\u30fc\u30c8\u3092\u4f5c\u6210\n(def items [{:name \"Item A\" :price 500}\n            {:name \"Item B\" :price 500}])\n\n(def cart (ctx/make-cart items (pricing/make-regular-pricing)))\n(ctx/cart-total cart)\n;; =&gt; 1000\n\n;; \u6226\u7565\u3092\u5909\u66f4\n(def discounted-cart (ctx/change-strategy cart (pricing/make-member-pricing :gold)))\n(ctx/cart-total discounted-cart)\n;; =&gt; 800.0\n</code></pre>"},{"location":"clojure/10-strategy-pattern/#4","title":"4. \u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1","text":"<p>Clojure \u3067\u306f\u3001\u95a2\u6570\u3092\u7b2c\u4e00\u7d1a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u6271\u3048\u308b\u305f\u3081\u3001\u3088\u308a\u7c21\u6f54\u306b Strategy \u30d1\u30bf\u30fc\u30f3\u3092\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"clojure/10-strategy-pattern/#strategy_1","title":"\u95a2\u6570\u306b\u3088\u308b Strategy","text":"<pre><code>(ns strategy-pattern.functional-strategy)\n\n(defn apply-pricing\n  \"\u6599\u91d1\u6226\u7565\u3092\u9069\u7528\"\n  [strategy-fn amount]\n  (strategy-fn amount))\n\n;; \u6226\u7565\u95a2\u6570\u306e\u5b9a\u7fa9\n(def regular-pricing identity)\n\n(defn discount-pricing\n  \"\u5272\u5f15\u6226\u7565\u3092\u4f5c\u6210\"\n  [rate]\n  (fn [amount]\n    (* amount (- 1.0 rate))))\n\n(defn member-pricing\n  \"\u4f1a\u54e1\u6226\u7565\u3092\u4f5c\u6210\"\n  [level]\n  (let [rate (case level\n               :gold 0.20\n               :silver 0.15\n               :bronze 0.10\n               0.0)]\n    (fn [amount]\n      (* amount (- 1.0 rate)))))\n</code></pre>"},{"location":"clojure/10-strategy-pattern/#_7","title":"\u6226\u7565\u306e\u5408\u6210","text":"<p>\u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1\u306e\u5927\u304d\u306a\u5229\u70b9\u306f\u3001\u6226\u7565\u3092\u7c21\u5358\u306b\u5408\u6210\u3067\u304d\u308b\u3053\u3068\u3067\u3059\u3002</p> <pre><code>(defn compose-strategies\n  \"\u8907\u6570\u306e\u6226\u7565\u3092\u5408\u6210\"\n  [&amp; strategies]\n  (fn [amount]\n    (reduce (fn [a strategy] (strategy a)) amount strategies)))\n\n(defn tax-strategy\n  \"\u7a0e\u91d1\u6226\u7565\u3092\u4f5c\u6210\"\n  [tax-rate]\n  (fn [amount]\n    (* amount (+ 1.0 tax-rate))))\n\n;; \u4f7f\u7528\u4f8b\uff1a\u5272\u5f15\u5f8c\u306b\u7a0e\u91d1\u3092\u9069\u7528\n(def discount (discount-pricing 0.10))\n(def tax (tax-strategy 0.08))\n(def final-price (compose-strategies discount tax))\n\n(apply-pricing final-price 1000)\n;; =&gt; 972.0  (1000 * 0.9 * 1.08)\n</code></pre>"},{"location":"clojure/10-strategy-pattern/#_8","title":"\u6761\u4ef6\u4ed8\u304d\u6226\u7565","text":"<pre><code>(defn conditional-strategy\n  \"\u6761\u4ef6\u4ed8\u304d\u6226\u7565\"\n  [pred then-strategy else-strategy]\n  (fn [amount]\n    (if (pred amount)\n      (then-strategy amount)\n      (else-strategy amount))))\n\n;; 5000\u5186\u4ee5\u4e0a\u306720%\u5272\u5f15\n(def high-value-discount\n  (conditional-strategy\n    #(&gt;= % 5000)\n    (discount-pricing 0.20)\n    regular-pricing))\n\n(apply-pricing high-value-discount 6000)\n;; =&gt; 4800.0\n\n(apply-pricing high-value-discount 3000)\n;; =&gt; 3000\n</code></pre>"},{"location":"clojure/10-strategy-pattern/#_9","title":"\u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1\u306e\u56f3","text":""},{"location":"clojure/10-strategy-pattern/#5","title":"5. \u914d\u9001\u6599\u91d1\u306e\u4f8b","text":"<p>Strategy \u30d1\u30bf\u30fc\u30f3\u306f\u914d\u9001\u6599\u91d1\u8a08\u7b97\u306b\u3082\u9069\u7528\u3067\u304d\u307e\u3059\u3002</p> <pre><code>(defmulti calculate-shipping\n  \"\u914d\u9001\u6599\u91d1\u3092\u8a08\u7b97\"\n  (fn [strategy _weight _distance] (:type strategy)))\n\n(defn make-standard-shipping []\n  {:type :standard-shipping})\n\n(defmethod calculate-shipping :standard-shipping [_strategy weight distance]\n  (+ (* weight 10) (* distance 5)))\n\n(defn make-express-shipping []\n  {:type :express-shipping})\n\n(defmethod calculate-shipping :express-shipping [_strategy weight distance]\n  (+ (* weight 20) (* distance 15)))\n\n(defn make-free-shipping [min-order-amount]\n  {:type :free-shipping\n   :min-order-amount min-order-amount})\n\n(defmethod calculate-shipping :free-shipping [_strategy _weight _distance]\n  0)\n</code></pre>"},{"location":"clojure/10-strategy-pattern/#6","title":"6. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u4ea4\u63db: \u5b9f\u884c\u6642\u306b\u6226\u7565\u3092\u5909\u66f4\u53ef\u80fd</li> <li>\u958b\u653e/\u9589\u9396\u306e\u539f\u5247: \u65b0\u3057\u3044\u6226\u7565\u3092\u8ffd\u52a0\u3057\u3066\u3082\u65e2\u5b58\u30b3\u30fc\u30c9\u306f\u5909\u66f4\u4e0d\u8981</li> <li>\u6761\u4ef6\u5206\u5c90\u306e\u6392\u9664: if/switch \u6587\u306e\u4ee3\u308f\u308a\u306b\u30dd\u30ea\u30e2\u30fc\u30d5\u30a3\u30ba\u30e0\u3092\u4f7f\u7528</li> <li>\u30c6\u30b9\u30c8\u306e\u5bb9\u6613\u3055: \u5404\u6226\u7565\u3092\u72ec\u7acb\u3057\u3066\u30c6\u30b9\u30c8\u53ef\u80fd</li> </ol>"},{"location":"clojure/10-strategy-pattern/#7","title":"7. \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306e\u7279\u5fb4","text":"<p>Clojure \u3067\u306e Strategy \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u306b\u306f\u4ee5\u4e0b\u306e\u7279\u5fb4\u304c\u3042\u308a\u307e\u3059\uff1a</p> <ol> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: \u578b\u306b\u57fa\u3065\u3044\u305f\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u3067\u591a\u614b\u6027\u3092\u5b9f\u73fe</li> <li>\u9ad8\u968e\u95a2\u6570: \u95a2\u6570\u3092\u6226\u7565\u3068\u3057\u3066\u76f4\u63a5\u6e21\u3059\u3053\u3068\u304c\u3067\u304d\u308b</li> <li>\u95a2\u6570\u5408\u6210: \u8907\u6570\u306e\u6226\u7565\u3092\u7c21\u5358\u306b\u7d44\u307f\u5408\u308f\u305b\u53ef\u80fd</li> <li>\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb: \u6226\u7565\u306e\u5909\u66f4\u306f\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u8fd4\u3059</li> </ol>"},{"location":"clojure/10-strategy-pattern/#_10","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Strategy \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u7248: \u578b\u30d9\u30fc\u30b9\u306e\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u306b\u3088\u308b\u5b9f\u88c5</li> <li>\u95a2\u6570\u578b\u7248: \u9ad8\u968e\u95a2\u6570\u306b\u3088\u308b\u7c21\u6f54\u306a\u5b9f\u88c5</li> <li>\u6226\u7565\u306e\u5408\u6210: \u8907\u6570\u306e\u6226\u7565\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u65b9\u6cd5</li> <li>Context: \u6226\u7565\u3092\u4f7f\u7528\u3059\u308b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u5b9f\u88c5</li> </ol> <p>Strategy \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u67d4\u8edf\u306b\u4ea4\u63db\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u5834\u9762\u3067\u975e\u5e38\u306b\u6709\u52b9\u3067\u3059\u3002</p>"},{"location":"clojure/10-strategy-pattern/#_11","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part4/src/strategy_pattern/</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part4/spec/strategy_pattern/</code></li> </ul>"},{"location":"clojure/10-strategy-pattern/#_12","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Command \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u30b3\u30de\u30f3\u30c9\u3092\u30c7\u30fc\u30bf\u3068\u3057\u3066\u8868\u73fe\u3057\u3001\u30d0\u30c3\u30c1\u51e6\u7406\u3084 Undo \u6a5f\u80fd\u3092\u5b9f\u88c5\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/11-command-pattern/","title":"\u7b2c11\u7ae0: Command \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"clojure/11-command-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Command \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u30ab\u30d7\u30bb\u30eb\u5316\u3057\u3001\u7570\u306a\u308b\u30ea\u30af\u30a8\u30b9\u30c8\u3067\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u30d1\u30e9\u30e1\u30fc\u30bf\u5316\u3057\u305f\u308a\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u30ad\u30e5\u30fc\u306b\u5165\u308c\u305f\u308a\u3001\u64cd\u4f5c\u306e\u5c65\u6b74\u3092\u8a18\u9332\u3057\u305f\u308a\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u30c6\u30ad\u30b9\u30c8\u7de8\u96c6\u3068\u30ad\u30e3\u30f3\u30d0\u30b9\u64cd\u4f5c\u306e\u4f8b\u3092\u901a\u3058\u3066\u3001\u30b3\u30de\u30f3\u30c9\u306e\u30c7\u30fc\u30bf\u5316\u3001Undo/Redo \u6a5f\u80fd\u3001\u30d0\u30c3\u30c1\u51e6\u7406\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/11-command-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Command \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Command: \u30b3\u30de\u30f3\u30c9\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\uff08execute \u30e1\u30bd\u30c3\u30c9\uff09</li> <li>ConcreteCommand: \u5177\u4f53\u7684\u306a\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u88c5</li> <li>Receiver: \u30b3\u30de\u30f3\u30c9\u3092\u53d7\u3051\u53d6\u308a\u3001\u5b9f\u969b\u306e\u51e6\u7406\u3092\u884c\u3046\u30aa\u30d6\u30b8\u30a7\u30af\u30c8</li> <li>Invoker: \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8</li> </ul> <p></p>"},{"location":"clojure/11-command-pattern/#2-command","title":"2. Command \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9","text":""},{"location":"clojure/11-command-pattern/#_2","title":"\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u5b9a\u7fa9","text":"<pre><code>(ns command-pattern.command)\n\n(defmulti execute\n  \"\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\"\n  :type)\n\n(defmulti undo\n  \"\u30b3\u30de\u30f3\u30c9\u3092\u53d6\u308a\u6d88\u3059\"\n  :type)\n</code></pre>"},{"location":"clojure/11-command-pattern/#3","title":"3. \u30c6\u30ad\u30b9\u30c8\u64cd\u4f5c\u30b3\u30de\u30f3\u30c9","text":""},{"location":"clojure/11-command-pattern/#insertcommand","title":"InsertCommand: \u30c6\u30ad\u30b9\u30c8\u633f\u5165","text":"<pre><code>(ns command-pattern.text-commands\n  (:require [command-pattern.command :as cmd]))\n\n(defn make-insert-command\n  \"\u633f\u5165\u30b3\u30de\u30f3\u30c9\u3092\u4f5c\u6210\"\n  [position text]\n  {:type :insert-command\n   :position position\n   :text text})\n\n(defmethod cmd/execute :insert-command [command]\n  (fn [document]\n    (let [pos (:position command)\n          text (:text command)\n          before (subs document 0 pos)\n          after (subs document pos)]\n      (str before text after))))\n\n(defmethod cmd/undo :insert-command [command]\n  (fn [document]\n    (let [pos (:position command)\n          len (count (:text command))\n          before (subs document 0 pos)\n          after (subs document (+ pos len))]\n      (str before after))))\n</code></pre>"},{"location":"clojure/11-command-pattern/#deletecommand","title":"DeleteCommand: \u30c6\u30ad\u30b9\u30c8\u524a\u9664","text":"<pre><code>(defn make-delete-command\n  \"\u524a\u9664\u30b3\u30de\u30f3\u30c9\u3092\u4f5c\u6210\"\n  [start-position end-position deleted-text]\n  {:type :delete-command\n   :start-position start-position\n   :end-position end-position\n   :deleted-text deleted-text})\n\n(defmethod cmd/execute :delete-command [command]\n  (fn [document]\n    (let [start (:start-position command)\n          end (:end-position command)\n          before (subs document 0 start)\n          after (subs document end)]\n      (str before after))))\n\n(defmethod cmd/undo :delete-command [command]\n  (fn [document]\n    (let [start (:start-position command)\n          text (:deleted-text command)\n          before (subs document 0 start)\n          after (subs document start)]\n      (str before text after))))\n</code></pre>"},{"location":"clojure/11-command-pattern/#replacecommand","title":"ReplaceCommand: \u30c6\u30ad\u30b9\u30c8\u7f6e\u63db","text":"<pre><code>(defn make-replace-command\n  \"\u7f6e\u63db\u30b3\u30de\u30f3\u30c9\u3092\u4f5c\u6210\"\n  [start-position old-text new-text]\n  {:type :replace-command\n   :start-position start-position\n   :old-text old-text\n   :new-text new-text})\n\n(defmethod cmd/execute :replace-command [command]\n  (fn [document]\n    (let [start (:start-position command)\n          old-len (count (:old-text command))\n          new-text (:new-text command)\n          before (subs document 0 start)\n          after (subs document (+ start old-len))]\n      (str before new-text after))))\n\n(defmethod cmd/undo :replace-command [command]\n  (fn [document]\n    (let [start (:start-position command)\n          new-len (count (:new-text command))\n          old-text (:old-text command)\n          before (subs document 0 start)\n          after (subs document (+ start new-len))]\n      (str before old-text after))))\n</code></pre>"},{"location":"clojure/11-command-pattern/#_3","title":"\u30af\u30e9\u30b9\u56f3","text":""},{"location":"clojure/11-command-pattern/#_4","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>(require '[command-pattern.command :as cmd])\n(require '[command-pattern.text-commands :as tc])\n\n;; \u633f\u5165\u30b3\u30de\u30f3\u30c9\n(def insert-cmd (tc/make-insert-command 5 \" World\"))\n(def execute-fn (cmd/execute insert-cmd))\n(execute-fn \"Hello\")\n;; =&gt; \"Hello World\"\n\n;; Undo\n(def undo-fn (cmd/undo insert-cmd))\n(undo-fn \"Hello World\")\n;; =&gt; \"Hello\"\n</code></pre>"},{"location":"clojure/11-command-pattern/#4","title":"4. \u30ad\u30e3\u30f3\u30d0\u30b9\u64cd\u4f5c\u30b3\u30de\u30f3\u30c9","text":""},{"location":"clojure/11-command-pattern/#addshapecommand","title":"AddShapeCommand: \u56f3\u5f62\u8ffd\u52a0","text":"<pre><code>(ns command-pattern.canvas-commands\n  (:require [command-pattern.command :as cmd]))\n\n(defn make-add-shape-command\n  \"\u56f3\u5f62\u8ffd\u52a0\u30b3\u30de\u30f3\u30c9\u3092\u4f5c\u6210\"\n  [shape]\n  {:type :add-shape-command\n   :shape shape})\n\n(defmethod cmd/execute :add-shape-command [command]\n  (fn [canvas]\n    (update canvas :shapes conj (:shape command))))\n\n(defmethod cmd/undo :add-shape-command [command]\n  (fn [canvas]\n    (update canvas :shapes\n            (fn [shapes]\n              (filterv #(not= (:id %) (get-in command [:shape :id])) shapes)))))\n</code></pre>"},{"location":"clojure/11-command-pattern/#moveshapecommand","title":"MoveShapeCommand: \u56f3\u5f62\u79fb\u52d5","text":"<pre><code>(defn make-move-shape-command\n  \"\u56f3\u5f62\u79fb\u52d5\u30b3\u30de\u30f3\u30c9\u3092\u4f5c\u6210\"\n  [shape-id dx dy]\n  {:type :move-shape-command\n   :shape-id shape-id\n   :dx dx\n   :dy dy})\n\n(defmethod cmd/execute :move-shape-command [command]\n  (fn [canvas]\n    (update canvas :shapes\n            (fn [shapes]\n              (mapv (fn [shape]\n                      (if (= (:id shape) (:shape-id command))\n                        (-&gt; shape\n                            (update :x + (:dx command))\n                            (update :y + (:dy command)))\n                        shape))\n                    shapes)))))\n\n(defmethod cmd/undo :move-shape-command [command]\n  (fn [canvas]\n    (update canvas :shapes\n            (fn [shapes]\n              (mapv (fn [shape]\n                      (if (= (:id shape) (:shape-id command))\n                        (-&gt; shape\n                            (update :x - (:dx command))\n                            (update :y - (:dy command)))\n                        shape))\n                    shapes)))))\n</code></pre>"},{"location":"clojure/11-command-pattern/#5","title":"5. \u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u5668","text":""},{"location":"clojure/11-command-pattern/#commandexecutor","title":"CommandExecutor \u306e\u5b9f\u88c5","text":"<pre><code>(ns command-pattern.command-executor\n  (:require [command-pattern.command :as cmd]))\n\n(defn make-executor\n  \"\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u5668\u3092\u4f5c\u6210\"\n  [initial-state]\n  {:state initial-state\n   :undo-stack []\n   :redo-stack []})\n\n(defn execute-command\n  \"\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3001\u5c65\u6b74\u306b\u8ffd\u52a0\"\n  [executor command]\n  (let [state (:state executor)\n        execute-fn (cmd/execute command)\n        new-state (execute-fn state)]\n    (-&gt; executor\n        (assoc :state new-state)\n        (update :undo-stack conj command)\n        (assoc :redo-stack []))))\n\n(defn undo-command\n  \"\u6700\u5f8c\u306e\u30b3\u30de\u30f3\u30c9\u3092\u53d6\u308a\u6d88\u3059\"\n  [executor]\n  (if (seq (:undo-stack executor))\n    (let [command (peek (:undo-stack executor))\n          state (:state executor)\n          undo-fn (cmd/undo command)\n          new-state (undo-fn state)]\n      (-&gt; executor\n          (assoc :state new-state)\n          (update :undo-stack pop)\n          (update :redo-stack conj command)))\n    executor))\n\n(defn redo-command\n  \"\u6700\u5f8c\u306b\u53d6\u308a\u6d88\u3057\u305f\u30b3\u30de\u30f3\u30c9\u3092\u518d\u5b9f\u884c\"\n  [executor]\n  (if (seq (:redo-stack executor))\n    (let [command (peek (:redo-stack executor))\n          state (:state executor)\n          execute-fn (cmd/execute command)\n          new-state (execute-fn state)]\n      (-&gt; executor\n          (assoc :state new-state)\n          (update :redo-stack pop)\n          (update :undo-stack conj command)))\n    executor))\n</code></pre>"},{"location":"clojure/11-command-pattern/#_5","title":"\u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"clojure/11-command-pattern/#_6","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>(require '[command-pattern.command-executor :as exec])\n(require '[command-pattern.text-commands :as tc])\n\n;; \u5b9f\u884c\u5668\u3092\u4f5c\u6210\n(def executor (exec/make-executor \"Hello\"))\n\n;; \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\n(def executor (exec/execute-command executor (tc/make-insert-command 5 \" World\")))\n(exec/get-state executor)\n;; =&gt; \"Hello World\"\n\n;; Undo\n(def executor (exec/undo-command executor))\n(exec/get-state executor)\n;; =&gt; \"Hello\"\n\n;; Redo\n(def executor (exec/redo-command executor))\n(exec/get-state executor)\n;; =&gt; \"Hello World\"\n</code></pre>"},{"location":"clojure/11-command-pattern/#6","title":"6. \u30d0\u30c3\u30c1\u51e6\u7406\u3068\u30de\u30af\u30ed\u30b3\u30de\u30f3\u30c9","text":""},{"location":"clojure/11-command-pattern/#_7","title":"\u30d0\u30c3\u30c1\u51e6\u7406","text":"<pre><code>(defn execute-batch\n  \"\u8907\u6570\u306e\u30b3\u30de\u30f3\u30c9\u3092\u307e\u3068\u3081\u3066\u5b9f\u884c\"\n  [executor commands]\n  (reduce execute-command executor commands))\n\n(defn undo-all\n  \"\u3059\u3079\u3066\u306e\u30b3\u30de\u30f3\u30c9\u3092\u53d6\u308a\u6d88\u3059\"\n  [executor]\n  (if (can-undo? executor)\n    (recur (undo-command executor))\n    executor))\n</code></pre>"},{"location":"clojure/11-command-pattern/#macrocommand","title":"MacroCommand","text":"<pre><code>(defn make-macro-command\n  \"\u8907\u5408\u30b3\u30de\u30f3\u30c9\u3092\u4f5c\u6210\"\n  [commands]\n  {:type :macro-command\n   :commands commands})\n\n(defmethod cmd/execute :macro-command [macro]\n  (fn [state]\n    (reduce (fn [s command]\n              ((cmd/execute command) s))\n            state\n            (:commands macro))))\n\n(defmethod cmd/undo :macro-command [macro]\n  (fn [state]\n    (reduce (fn [s command]\n              ((cmd/undo command) s))\n            state\n            (reverse (:commands macro)))))\n</code></pre>"},{"location":"clojure/11-command-pattern/#macrocommand_1","title":"MacroCommand \u306e\u56f3","text":""},{"location":"clojure/11-command-pattern/#_8","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>;; MacroCommand \u3092\u4f7f\u3063\u305f\u8907\u5408\u64cd\u4f5c\n(def commands [(tc/make-insert-command 5 \" World\")\n               (tc/make-insert-command 11 \"!\")])\n(def macro (exec/make-macro-command commands))\n\n(def executor (exec/execute-command (exec/make-executor \"Hello\") macro))\n(exec/get-state executor)\n;; =&gt; \"Hello World!\"\n\n;; \u4e00\u5ea6\u306eUndo\u3067\u5168\u4f53\u3092\u53d6\u308a\u6d88\u3059\n(def executor (exec/undo-command executor))\n(exec/get-state executor)\n;; =&gt; \"Hello\"\n</code></pre>"},{"location":"clojure/11-command-pattern/#7","title":"7. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u64cd\u4f5c\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u5316: \u64cd\u4f5c\u3092\u30c7\u30fc\u30bf\u3068\u3057\u3066\u8868\u73fe\u3067\u304d\u308b</li> <li>Undo/Redo: \u64cd\u4f5c\u5c65\u6b74\u306e\u7ba1\u7406\u304c\u5bb9\u6613</li> <li>\u30d0\u30c3\u30c1\u51e6\u7406: \u8907\u6570\u306e\u64cd\u4f5c\u3092\u307e\u3068\u3081\u3066\u51e6\u7406</li> <li>\u9045\u5ef6\u5b9f\u884c: \u30b3\u30de\u30f3\u30c9\u3092\u30ad\u30e5\u30fc\u306b\u5165\u308c\u3066\u5f8c\u3067\u5b9f\u884c</li> <li>\u30ed\u30b0\u8a18\u9332: \u64cd\u4f5c\u306e\u5c65\u6b74\u3092\u30ed\u30b0\u3068\u3057\u3066\u4fdd\u5b58</li> </ol>"},{"location":"clojure/11-command-pattern/#8","title":"8. \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306e\u7279\u5fb4","text":"<p>Clojure \u3067\u306e Command \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u306b\u306f\u4ee5\u4e0b\u306e\u7279\u5fb4\u304c\u3042\u308a\u307e\u3059\uff1a</p> <ol> <li>\u30b3\u30de\u30f3\u30c9\u306f\u30c7\u30fc\u30bf: \u30b3\u30de\u30f3\u30c9\u306f\u5358\u306a\u308b\u30de\u30c3\u30d7\u3068\u3057\u3066\u8868\u73fe</li> <li>\u7d14\u7c8b\u95a2\u6570: execute/undo \u306f\u72b6\u614b\u5909\u66f4\u95a2\u6570\u3092\u8fd4\u3059\u7d14\u7c8b\u95a2\u6570</li> <li>\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb: \u72b6\u614b\u306f\u5909\u66f4\u3055\u308c\u305a\u3001\u65b0\u3057\u3044\u72b6\u614b\u304c\u8fd4\u3055\u308c\u308b</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: \u578b\u306b\u57fa\u3065\u3044\u305f\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u3067\u591a\u614b\u6027\u3092\u5b9f\u73fe</li> </ol>"},{"location":"clojure/11-command-pattern/#_9","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Command \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30b3\u30de\u30f3\u30c9\u306e\u30c7\u30fc\u30bf\u5316: \u64cd\u4f5c\u3092\u30de\u30c3\u30d7\u3068\u3057\u3066\u8868\u73fe</li> <li>Undo/Redo: \u30b3\u30de\u30f3\u30c9\u5c65\u6b74\u306b\u3088\u308b\u53d6\u308a\u6d88\u3057\u3068\u518d\u5b9f\u884c</li> <li>\u30d0\u30c3\u30c1\u51e6\u7406: \u8907\u6570\u30b3\u30de\u30f3\u30c9\u306e\u4e00\u62ec\u5b9f\u884c</li> <li>MacroCommand: \u8907\u5408\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u88c5</li> </ol> <p>Command \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u64cd\u4f5c\u306e\u5c65\u6b74\u7ba1\u7406\u3084\u53d6\u308a\u6d88\u3057\u6a5f\u80fd\u304c\u5fc5\u8981\u306a\u5834\u9762\u3067\u975e\u5e38\u306b\u6709\u52b9\u3067\u3059\u3002</p>"},{"location":"clojure/11-command-pattern/#_10","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part4/src/command_pattern/</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part4/spec/command_pattern/</code></li> </ul>"},{"location":"clojure/11-command-pattern/#_11","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Visitor \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u30c7\u30fc\u30bf\u69cb\u9020\u3068\u64cd\u4f5c\u3092\u5206\u96e2\u3057\u3001\u65b0\u3057\u3044\u64cd\u4f5c\u3092\u8ffd\u52a0\u3057\u3084\u3059\u304f\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/12-visitor-pattern/","title":"\u7b2c12\u7ae0: Visitor \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"clojure/12-visitor-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Visitor \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30c7\u30fc\u30bf\u69cb\u9020\u3068\u64cd\u4f5c\u3092\u5206\u96e2\u3057\u3001\u65e2\u5b58\u306e\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u5909\u66f4\u3059\u308b\u3053\u3068\u306a\u304f\u65b0\u3057\u3044\u64cd\u4f5c\u3092\u8ffd\u52a0\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u56f3\u5f62\uff08Shape\uff09\u306b\u5bfe\u3059\u308b\u69d8\u3005\u306a\u64cd\u4f5c\uff08JSON \u5909\u63db\u3001XML \u5909\u63db\u3001\u9762\u7a4d\u8a08\u7b97\u3001\u5468\u56f2\u9577\u8a08\u7b97\uff09\u3092\u901a\u3058\u3066\u3001\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b Visitor \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/12-visitor-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Visitor \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Visitor: \u64cd\u4f5c\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>ConcreteVisitor: \u5177\u4f53\u7684\u306a\u64cd\u4f5c\u306e\u5b9f\u88c5</li> <li>Element: \u8a2a\u554f\u3055\u308c\u308b\u8981\u7d20\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>ConcreteElement: \u5177\u4f53\u7684\u306a\u8981\u7d20</li> </ul> <p></p>"},{"location":"clojure/12-visitor-pattern/#2-element","title":"2. Element: \u56f3\u5f62\u306e\u5b9a\u7fa9","text":""},{"location":"clojure/12-visitor-pattern/#shape","title":"Shape \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9","text":"<pre><code>(ns visitor-pattern.shape)\n\n(defmulti translate\n  \"\u56f3\u5f62\u3092\u79fb\u52d5\u3059\u308b\"\n  (fn [shape _dx _dy] (::type shape)))\n\n(defmulti scale\n  \"\u56f3\u5f62\u3092\u62e1\u5927/\u7e2e\u5c0f\u3059\u308b\"\n  (fn [shape _factor] (::type shape)))\n</code></pre>"},{"location":"clojure/12-visitor-pattern/#circle","title":"Circle","text":"<pre><code>(ns visitor-pattern.circle\n  (:require [visitor-pattern.shape :as shape]))\n\n(defn make\n  \"\u5186\u3092\u4f5c\u6210\"\n  [center radius]\n  {::shape/type ::circle\n   ::center center\n   ::radius radius})\n\n(defmethod shape/translate ::circle [circle dx dy]\n  (let [[x y] (::center circle)]\n    (assoc circle ::center [(+ x dx) (+ y dy)])))\n\n(defmethod shape/scale ::circle [circle factor]\n  (let [radius (::radius circle)]\n    (assoc circle ::radius (* radius factor))))\n</code></pre>"},{"location":"clojure/12-visitor-pattern/#square","title":"Square","text":"<pre><code>(ns visitor-pattern.square\n  (:require [visitor-pattern.shape :as shape]))\n\n(defn make\n  \"\u6b63\u65b9\u5f62\u3092\u4f5c\u6210\"\n  [top-left side]\n  {::shape/type ::square\n   ::top-left top-left\n   ::side side})\n\n(defmethod shape/translate ::square [square dx dy]\n  (let [[x y] (::top-left square)]\n    (assoc square ::top-left [(+ x dx) (+ y dy)])))\n\n(defmethod shape/scale ::square [square factor]\n  (let [side (::side square)]\n    (assoc square ::side (* side factor))))\n</code></pre>"},{"location":"clojure/12-visitor-pattern/#rectangle","title":"Rectangle","text":"<pre><code>(ns visitor-pattern.rectangle\n  (:require [visitor-pattern.shape :as shape]))\n\n(defn make\n  \"\u9577\u65b9\u5f62\u3092\u4f5c\u6210\"\n  [top-left width height]\n  {::shape/type ::rectangle\n   ::top-left top-left\n   ::width width\n   ::height height})\n\n(defmethod shape/translate ::rectangle [rect dx dy]\n  (let [[x y] (::top-left rect)]\n    (assoc rect ::top-left [(+ x dx) (+ y dy)])))\n\n(defmethod shape/scale ::rectangle [rect factor]\n  (-&gt; rect\n      (update ::width * factor)\n      (update ::height * factor)))\n</code></pre>"},{"location":"clojure/12-visitor-pattern/#_2","title":"\u30af\u30e9\u30b9\u56f3","text":""},{"location":"clojure/12-visitor-pattern/#3-visitor-json","title":"3. Visitor: JSON \u5909\u63db","text":""},{"location":"clojure/12-visitor-pattern/#json-visitor","title":"JSON Visitor \u306e\u5b9f\u88c5","text":"<pre><code>(ns visitor-pattern.json-visitor\n  (:require [visitor-pattern.shape :as shape]\n            [visitor-pattern.circle :as circle]\n            [visitor-pattern.square :as square]\n            [visitor-pattern.rectangle :as rectangle]))\n\n(defmulti to-json\n  \"\u56f3\u5f62\u3092 JSON \u6587\u5b57\u5217\u306b\u5909\u63db\"\n  ::shape/type)\n\n(defmethod to-json ::circle/circle [circle]\n  (let [{:keys [::circle/center ::circle/radius]} circle\n        [x y] center]\n    (format \"{\\\"type\\\":\\\"circle\\\",\\\"center\\\":[%s,%s],\\\"radius\\\":%s}\"\n            x y radius)))\n\n(defmethod to-json ::square/square [square]\n  (let [{:keys [::square/top-left ::square/side]} square\n        [x y] top-left]\n    (format \"{\\\"type\\\":\\\"square\\\",\\\"topLeft\\\":[%s,%s],\\\"side\\\":%s}\"\n            x y side)))\n\n(defmethod to-json ::rectangle/rectangle [rect]\n  (let [{:keys [::rectangle/top-left ::rectangle/width ::rectangle/height]} rect\n        [x y] top-left]\n    (format \"{\\\"type\\\":\\\"rectangle\\\",\\\"topLeft\\\":[%s,%s],\\\"width\\\":%s,\\\"height\\\":%s}\"\n            x y width height)))\n</code></pre>"},{"location":"clojure/12-visitor-pattern/#_3","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>(require '[visitor-pattern.json-visitor :as json])\n(require '[visitor-pattern.circle :as circle])\n\n(def c (circle/make [10 20] 5))\n(json/to-json c)\n;; =&gt; \"{\\\"type\\\":\\\"circle\\\",\\\"center\\\":[10,20],\\\"radius\\\":5}\"\n</code></pre>"},{"location":"clojure/12-visitor-pattern/#4-visitor-xml","title":"4. Visitor: XML \u5909\u63db","text":""},{"location":"clojure/12-visitor-pattern/#xml-visitor","title":"XML Visitor \u306e\u5b9f\u88c5","text":"<pre><code>(ns visitor-pattern.xml-visitor\n  (:require [visitor-pattern.shape :as shape]\n            [visitor-pattern.circle :as circle]\n            [visitor-pattern.square :as square]\n            [visitor-pattern.rectangle :as rectangle]))\n\n(defmulti to-xml\n  \"\u56f3\u5f62\u3092 XML \u6587\u5b57\u5217\u306b\u5909\u63db\"\n  ::shape/type)\n\n(defmethod to-xml ::circle/circle [circle]\n  (let [{:keys [::circle/center ::circle/radius]} circle\n        [x y] center]\n    (format \"&lt;circle&gt;&lt;center x=\\\"%s\\\" y=\\\"%s\\\"/&gt;&lt;radius&gt;%s&lt;/radius&gt;&lt;/circle&gt;\"\n            x y radius)))\n\n(defmethod to-xml ::square/square [square]\n  (let [{:keys [::square/top-left ::square/side]} square\n        [x y] top-left]\n    (format \"&lt;square&gt;&lt;topLeft x=\\\"%s\\\" y=\\\"%s\\\"/&gt;&lt;side&gt;%s&lt;/side&gt;&lt;/square&gt;\"\n            x y side)))\n\n(defmethod to-xml ::rectangle/rectangle [rect]\n  (let [{:keys [::rectangle/top-left ::rectangle/width ::rectangle/height]} rect\n        [x y] top-left]\n    (format \"&lt;rectangle&gt;&lt;topLeft x=\\\"%s\\\" y=\\\"%s\\\"/&gt;&lt;width&gt;%s&lt;/width&gt;&lt;height&gt;%s&lt;/height&gt;&lt;/rectangle&gt;\"\n            x y width height)))\n</code></pre>"},{"location":"clojure/12-visitor-pattern/#5-visitor","title":"5. Visitor: \u9762\u7a4d\u8a08\u7b97","text":""},{"location":"clojure/12-visitor-pattern/#area-visitor","title":"Area Visitor \u306e\u5b9f\u88c5","text":"<pre><code>(ns visitor-pattern.area-visitor\n  (:require [visitor-pattern.shape :as shape]\n            [visitor-pattern.circle :as circle]\n            [visitor-pattern.square :as square]\n            [visitor-pattern.rectangle :as rectangle]))\n\n(defmulti calculate-area\n  \"\u56f3\u5f62\u306e\u9762\u7a4d\u3092\u8a08\u7b97\"\n  ::shape/type)\n\n(defmethod calculate-area ::circle/circle [circle]\n  (let [radius (::circle/radius circle)]\n    (* Math/PI radius radius)))\n\n(defmethod calculate-area ::square/square [square]\n  (let [side (::square/side square)]\n    (* side side)))\n\n(defmethod calculate-area ::rectangle/rectangle [rect]\n  (let [width (::rectangle/width rect)\n        height (::rectangle/height rect)]\n    (* width height)))\n\n(defn total-area\n  \"\u8907\u6570\u306e\u56f3\u5f62\u306e\u5408\u8a08\u9762\u7a4d\u3092\u8a08\u7b97\"\n  [shapes]\n  (reduce + (map calculate-area shapes)))\n</code></pre>"},{"location":"clojure/12-visitor-pattern/#6-visitor","title":"6. Visitor: \u5468\u56f2\u9577\u8a08\u7b97","text":""},{"location":"clojure/12-visitor-pattern/#perimeter-visitor","title":"Perimeter Visitor \u306e\u5b9f\u88c5","text":"<pre><code>(ns visitor-pattern.perimeter-visitor\n  (:require [visitor-pattern.shape :as shape]\n            [visitor-pattern.circle :as circle]\n            [visitor-pattern.square :as square]\n            [visitor-pattern.rectangle :as rectangle]))\n\n(defmulti calculate-perimeter\n  \"\u56f3\u5f62\u306e\u5468\u56f2\u9577\u3092\u8a08\u7b97\"\n  ::shape/type)\n\n(defmethod calculate-perimeter ::circle/circle [circle]\n  (let [radius (::circle/radius circle)]\n    (* 2 Math/PI radius)))\n\n(defmethod calculate-perimeter ::square/square [square]\n  (let [side (::square/side square)]\n    (* 4 side)))\n\n(defmethod calculate-perimeter ::rectangle/rectangle [rect]\n  (let [width (::rectangle/width rect)\n        height (::rectangle/height rect)]\n    (* 2 (+ width height))))\n</code></pre>"},{"location":"clojure/12-visitor-pattern/#7-visitor","title":"7. Visitor \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":""},{"location":"clojure/12-visitor-pattern/#8","title":"8. \u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"clojure/12-visitor-pattern/#9-visitor","title":"9. \u65b0\u3057\u3044 Visitor \u306e\u8ffd\u52a0","text":"<p>Visitor \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9\u306f\u3001\u65b0\u3057\u3044\u64cd\u4f5c\u3092\u8ffd\u52a0\u3057\u3084\u3059\u3044\u3053\u3068\u3067\u3059\u3002</p>"},{"location":"clojure/12-visitor-pattern/#visitor","title":"\u4f8b: \u63cf\u753b Visitor","text":"<pre><code>(ns visitor-pattern.draw-visitor\n  (:require [visitor-pattern.shape :as shape]\n            [visitor-pattern.circle :as circle]\n            [visitor-pattern.square :as square]))\n\n(defmulti draw\n  \"\u56f3\u5f62\u3092\u63cf\u753b\u30b3\u30de\u30f3\u30c9\u306b\u5909\u63db\"\n  ::shape/type)\n\n(defmethod draw ::circle/circle [circle]\n  (let [{:keys [::circle/center ::circle/radius]} circle\n        [x y] center]\n    {:command :draw-circle\n     :center [x y]\n     :radius radius}))\n\n(defmethod draw ::square/square [square]\n  (let [{:keys [::square/top-left ::square/side]} square\n        [x y] top-left]\n    {:command :draw-rect\n     :position [x y]\n     :width side\n     :height side}))\n</code></pre>"},{"location":"clojure/12-visitor-pattern/#10","title":"10. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9\u3068\u6b20\u70b9","text":""},{"location":"clojure/12-visitor-pattern/#_4","title":"\u5229\u70b9","text":"<ol> <li>\u64cd\u4f5c\u306e\u8ffd\u52a0\u304c\u5bb9\u6613: \u65b0\u3057\u3044 Visitor \u3092\u8ffd\u52a0\u3059\u308b\u3060\u3051\u3067\u65b0\u3057\u3044\u64cd\u4f5c\u3092\u5b9f\u88c5\u53ef\u80fd</li> <li>\u95a2\u9023\u64cd\u4f5c\u306e\u96c6\u7d04: \u540c\u3058\u64cd\u4f5c\u306b\u95a2\u3059\u308b\u30b3\u30fc\u30c9\u304c\u4e00\u7b87\u6240\u306b\u307e\u3068\u307e\u308b</li> <li>\u8981\u7d20\u306e\u72ec\u7acb\u6027: \u8981\u7d20\u30af\u30e9\u30b9\u306b\u64cd\u4f5c\u306e\u30b3\u30fc\u30c9\u3092\u542b\u3081\u306a\u304f\u3066\u3088\u3044</li> </ol>"},{"location":"clojure/12-visitor-pattern/#_5","title":"\u6b20\u70b9","text":"<ol> <li>\u8981\u7d20\u306e\u8ffd\u52a0\u304c\u56f0\u96e3: \u65b0\u3057\u3044\u8981\u7d20\u30bf\u30a4\u30d7\u3092\u8ffd\u52a0\u3059\u308b\u3068\u3001\u3059\u3079\u3066\u306e Visitor \u3092\u66f4\u65b0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b</li> <li>\u30ab\u30d7\u30bb\u30eb\u5316\u306e\u7834\u58ca: Visitor \u306f\u8981\u7d20\u306e\u5185\u90e8\u72b6\u614b\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b</li> </ol>"},{"location":"clojure/12-visitor-pattern/#11","title":"11. \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306e\u7279\u5fb4","text":"<p>Clojure \u3067\u306e Visitor \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u306b\u306f\u4ee5\u4e0b\u306e\u7279\u5fb4\u304c\u3042\u308a\u307e\u3059\uff1a</p> <ol> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: \u578b\u306b\u57fa\u3065\u3044\u305f\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u3067\u591a\u614b\u6027\u3092\u5b9f\u73fe</li> <li>\u30aa\u30fc\u30d7\u30f3\u30b7\u30b9\u30c6\u30e0: \u65b0\u3057\u3044\u30e1\u30bd\u30c3\u30c9\u3092\u5f8c\u304b\u3089\u8ffd\u52a0\u53ef\u80fd</li> <li>\u30c7\u30fc\u30bf\u3068\u3057\u3066\u306e\u8981\u7d20: \u8981\u7d20\u306f\u5358\u306a\u308b\u30de\u30c3\u30d7\u3068\u3057\u3066\u8868\u73fe</li> <li>\u7d14\u7c8b\u95a2\u6570: Visitor \u306f\u526f\u4f5c\u7528\u306e\u306a\u3044\u7d14\u7c8b\u95a2\u6570\u3068\u3057\u3066\u5b9f\u88c5</li> </ol> <p></p>"},{"location":"clojure/12-visitor-pattern/#_6","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Visitor \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30c7\u30fc\u30bf\u69cb\u9020\u3068\u64cd\u4f5c\u306e\u5206\u96e2: \u56f3\u5f62\u30c7\u30fc\u30bf\u3068\u64cd\u4f5c\u3092\u72ec\u7acb\u3057\u3066\u5b9a\u7fa9</li> <li>\u8907\u6570\u306e Visitor: JSON\u3001XML\u3001\u9762\u7a4d\u3001\u5468\u56f2\u9577\u306e\u5404\u5909\u63db</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u5b9f\u88c5: \u578b\u306b\u57fa\u3065\u3044\u305f\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1</li> <li>\u62e1\u5f35\u6027: \u65b0\u3057\u3044\u64cd\u4f5c\u306e\u8ffd\u52a0\u304c\u5bb9\u6613</li> </ol> <p>Visitor \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30c7\u30fc\u30bf\u69cb\u9020\u304c\u5b89\u5b9a\u3057\u3066\u3044\u3066\u3001\u64cd\u4f5c\u3092\u983b\u7e41\u306b\u8ffd\u52a0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u5834\u9762\u3067\u6709\u52b9\u3067\u3059\u3002</p>"},{"location":"clojure/12-visitor-pattern/#_7","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part4/src/visitor_pattern/</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part4/spec/visitor_pattern/</code></li> </ul>"},{"location":"clojure/12-visitor-pattern/#4","title":"\u7b2c4\u90e8\u306e\u307e\u3068\u3081","text":"<p>\u7b2c4\u90e8\u3067\u306f\u3001\u632f\u308b\u821e\u3044\u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ul> <li>Strategy \u30d1\u30bf\u30fc\u30f3: \u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u30ab\u30d7\u30bb\u30eb\u5316\u3057\u4ea4\u63db\u53ef\u80fd\u306b\u3059\u308b</li> <li>Command \u30d1\u30bf\u30fc\u30f3: \u64cd\u4f5c\u3092\u30c7\u30fc\u30bf\u5316\u3057\u3001Undo/Redo \u3092\u5b9f\u73fe</li> <li>Visitor \u30d1\u30bf\u30fc\u30f3: \u30c7\u30fc\u30bf\u69cb\u9020\u3068\u64cd\u4f5c\u3092\u5206\u96e2\u3057\u3001\u65b0\u3057\u3044\u64cd\u4f5c\u3092\u8ffd\u52a0\u3057\u3084\u3059\u304f\u3059\u308b</li> </ul> <p>\u3053\u308c\u3089\u306e\u30d1\u30bf\u30fc\u30f3\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u7279\u6027\u3092\u6d3b\u304b\u3057\u3066\u7c21\u6f54\u306b\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"clojure/13-abstract-factory-pattern/","title":"\u7b2c13\u7ae0: Abstract Factory \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"clojure/13-abstract-factory-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u95a2\u9023\u3059\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30d5\u30a1\u30df\u30ea\u30fc\u3092\u3001\u305d\u306e\u5177\u4f53\u7684\u306a\u30af\u30e9\u30b9\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u306a\u304f\u751f\u6210\u3059\u308b\u305f\u3081\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u63d0\u4f9b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u56f3\u5f62\u30d5\u30a1\u30af\u30c8\u30ea\u3068 UI \u30d5\u30a1\u30af\u30c8\u30ea\u306e\u4f8b\u3092\u901a\u3058\u3066\u3001\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/13-abstract-factory-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>AbstractFactory: \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u751f\u6210\u306e\u62bd\u8c61\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>ConcreteFactory: \u5177\u4f53\u7684\u306a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u751f\u6210\u3059\u308b\u30d5\u30a1\u30af\u30c8\u30ea</li> <li>AbstractProduct: \u751f\u6210\u3055\u308c\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u62bd\u8c61\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>ConcreteProduct: \u5177\u4f53\u7684\u306a\u88fd\u54c1</li> </ul> <p></p>"},{"location":"clojure/13-abstract-factory-pattern/#2-shape","title":"2. Shape \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9","text":""},{"location":"clojure/13-abstract-factory-pattern/#_2","title":"\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u5b9a\u7fa9","text":"<pre><code>(ns abstract-factory.shape)\n\n(defmulti translate\n  \"\u56f3\u5f62\u3092\u79fb\u52d5\u3059\u308b\"\n  (fn [shape _dx _dy] (::type shape)))\n\n(defmulti scale\n  \"\u56f3\u5f62\u3092\u62e1\u5927/\u7e2e\u5c0f\u3059\u308b\"\n  (fn [shape _factor] (::type shape)))\n\n(defmulti to-string\n  \"\u56f3\u5f62\u3092\u6587\u5b57\u5217\u306b\u5909\u63db\u3059\u308b\"\n  (fn [shape] (::type shape)))\n</code></pre>"},{"location":"clojure/13-abstract-factory-pattern/#circle","title":"Circle \u306e\u5b9f\u88c5","text":"<pre><code>(ns abstract-factory.circle\n  (:require [abstract-factory.shape :as shape]))\n\n(defn make\n  \"\u5186\u3092\u4f5c\u6210\"\n  [center radius]\n  {::shape/type ::circle\n   ::center center\n   ::radius radius})\n\n(defmethod shape/translate ::circle [circle dx dy]\n  (let [[x y] (::center circle)]\n    (assoc circle ::center [(+ x dx) (+ y dy)])))\n\n(defmethod shape/scale ::circle [circle factor]\n  (let [radius (::radius circle)]\n    (assoc circle ::radius (* radius factor))))\n\n(defmethod shape/to-string ::circle [circle]\n  (let [[x y] (::center circle)\n        radius (::radius circle)]\n    (str \"Circle center: [\" x \", \" y \"] radius: \" radius)))\n</code></pre>"},{"location":"clojure/13-abstract-factory-pattern/#3-shapefactory","title":"3. ShapeFactory \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9","text":""},{"location":"clojure/13-abstract-factory-pattern/#abstract-factory","title":"Abstract Factory \u306e\u5b9a\u7fa9","text":"<pre><code>(ns abstract-factory.shape-factory)\n\n(defmulti make-shape\n  \"\u56f3\u5f62\u3092\u751f\u6210\u3059\u308b\"\n  (fn [factory _type &amp; _args] (::type factory)))\n</code></pre>"},{"location":"clojure/13-abstract-factory-pattern/#4-concretefactory-standardshapefactory","title":"4. ConcreteFactory: StandardShapeFactory","text":""},{"location":"clojure/13-abstract-factory-pattern/#_3","title":"\u5b9f\u88c5","text":"<pre><code>(ns abstract-factory.standard-shape-factory\n  (:require [abstract-factory.shape-factory :as factory]\n            [abstract-factory.circle :as circle]\n            [abstract-factory.square :as square]\n            [abstract-factory.rectangle :as rectangle]))\n\n(defn make\n  \"\u6a19\u6e96\u56f3\u5f62\u30d5\u30a1\u30af\u30c8\u30ea\u3092\u4f5c\u6210\"\n  []\n  {::factory/type ::standard-factory})\n\n(defmethod factory/make-shape ::standard-factory\n  [_factory type &amp; args]\n  (case type\n    :circle (apply circle/make args)\n    :square (apply square/make args)\n    :rectangle (apply rectangle/make args)\n    (throw (ex-info (str \"Unknown shape type: \" type) {:type type}))))\n</code></pre>"},{"location":"clojure/13-abstract-factory-pattern/#_4","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>(require '[abstract-factory.standard-shape-factory :as standard])\n(require '[abstract-factory.shape-factory :as factory])\n\n(def factory (standard/make))\n\n(def circle (factory/make-shape factory :circle [10 20] 5))\n;; =&gt; {:abstract-factory.shape/type :abstract-factory.circle/circle,\n;;     :abstract-factory.circle/center [10 20],\n;;     :abstract-factory.circle/radius 5}\n\n(def square (factory/make-shape factory :square [0 0] 10))\n;; =&gt; {:abstract-factory.shape/type :abstract-factory.square/square,\n;;     :abstract-factory.square/top-left [0 0],\n;;     :abstract-factory.square/side 10}\n</code></pre>"},{"location":"clojure/13-abstract-factory-pattern/#5-concretefactory-outlinedshapefactory","title":"5. ConcreteFactory: OutlinedShapeFactory","text":""},{"location":"clojure/13-abstract-factory-pattern/#_5","title":"\u5b9f\u88c5","text":"<pre><code>(ns abstract-factory.outlined-shape-factory\n  (:require [abstract-factory.shape-factory :as factory]\n            [abstract-factory.circle :as circle]\n            [abstract-factory.square :as square]\n            [abstract-factory.rectangle :as rectangle]))\n\n(defn make\n  \"\u8f2a\u90ed\u7dda\u4ed8\u304d\u56f3\u5f62\u30d5\u30a1\u30af\u30c8\u30ea\u3092\u4f5c\u6210\"\n  [outline-color outline-width]\n  {::factory/type ::outlined-factory\n   ::outline-color outline-color\n   ::outline-width outline-width})\n\n(defn- add-outline\n  \"\u56f3\u5f62\u306b\u8f2a\u90ed\u7dda\u60c5\u5831\u3092\u8ffd\u52a0\"\n  [shape outline-color outline-width]\n  (assoc shape\n         ::outline-color outline-color\n         ::outline-width outline-width))\n\n(defmethod factory/make-shape ::outlined-factory\n  [factory type &amp; args]\n  (let [outline-color (::outline-color factory)\n        outline-width (::outline-width factory)\n        base-shape (case type\n                     :circle (apply circle/make args)\n                     :square (apply square/make args)\n                     :rectangle (apply rectangle/make args))]\n    (add-outline base-shape outline-color outline-width)))\n</code></pre>"},{"location":"clojure/13-abstract-factory-pattern/#_6","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>(require '[abstract-factory.outlined-shape-factory :as outlined])\n\n(def factory (outlined/make \"black\" 2))\n\n(def circle (factory/make-shape factory :circle [10 20] 5))\n;; \u8f2a\u90ed\u7dda\u60c5\u5831\u304c\u8ffd\u52a0\u3055\u308c\u305f\u5186\u304c\u751f\u6210\u3055\u308c\u308b\n</code></pre>"},{"location":"clojure/13-abstract-factory-pattern/#6-concretefactory-filledshapefactory","title":"6. ConcreteFactory: FilledShapeFactory","text":""},{"location":"clojure/13-abstract-factory-pattern/#_7","title":"\u5b9f\u88c5","text":"<pre><code>(ns abstract-factory.filled-shape-factory\n  (:require [abstract-factory.shape-factory :as factory]\n            [abstract-factory.circle :as circle]\n            [abstract-factory.square :as square]\n            [abstract-factory.rectangle :as rectangle]))\n\n(defn make\n  \"\u5857\u308a\u3064\u3076\u3057\u4ed8\u304d\u56f3\u5f62\u30d5\u30a1\u30af\u30c8\u30ea\u3092\u4f5c\u6210\"\n  [fill-color]\n  {::factory/type ::filled-factory\n   ::fill-color fill-color})\n\n(defmethod factory/make-shape ::filled-factory\n  [factory type &amp; args]\n  (let [fill-color (::fill-color factory)\n        base-shape (case type\n                     :circle (apply circle/make args)\n                     :square (apply square/make args)\n                     :rectangle (apply rectangle/make args))]\n    (assoc base-shape ::fill-color fill-color)))\n</code></pre>"},{"location":"clojure/13-abstract-factory-pattern/#7","title":"7. \u30af\u30e9\u30b9\u56f3","text":""},{"location":"clojure/13-abstract-factory-pattern/#8-ui","title":"8. UI \u30d5\u30a1\u30af\u30c8\u30ea\u306e\u4f8b","text":""},{"location":"clojure/13-abstract-factory-pattern/#ui","title":"\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u5225 UI \u751f\u6210","text":"<pre><code>(ns abstract-factory.ui-factory)\n\n;; Abstract Factory \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\n(defmulti create-button\n  (fn [factory _label] (::factory-type factory)))\n\n(defmulti create-text-field\n  (fn [factory _placeholder] (::factory-type factory)))\n\n(defmulti create-checkbox\n  (fn [factory _label _checked?] (::factory-type factory)))\n\n;; WindowsUIFactory\n(defn make-windows-factory []\n  {::factory-type ::windows})\n\n(defmethod create-button ::windows [_factory label]\n  (make-button label :windows))\n\n;; MacOSUIFactory\n(defn make-macos-factory []\n  {::factory-type ::macos})\n\n(defmethod create-button ::macos [_factory label]\n  (make-button label :macos))\n</code></pre>"},{"location":"clojure/13-abstract-factory-pattern/#_8","title":"\u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"clojure/13-abstract-factory-pattern/#_9","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>(require '[abstract-factory.ui-factory :as ui])\n\n;; \u30d5\u30a1\u30af\u30c8\u30ea\u306e\u4ea4\u63db\u3067\u7570\u306a\u308bUI\u3092\u751f\u6210\n(defn create-form [factory]\n  {:button (ui/create-button factory \"Submit\")\n   :field (ui/create-text-field factory \"Email\")\n   :checkbox (ui/create-checkbox factory \"Subscribe\" false)})\n\n(def windows-form (create-form (ui/make-windows-factory)))\n(def macos-form (create-form (ui/make-macos-factory)))\n\n(ui/render (:button windows-form))\n;; =&gt; \"[Submit]\"\n\n(ui/render (:button macos-form))\n;; =&gt; \"(Submit)\"\n</code></pre>"},{"location":"clojure/13-abstract-factory-pattern/#9","title":"9. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u88fd\u54c1\u306e\u30d5\u30a1\u30df\u30ea\u30fc\u4e00\u8cab\u6027: \u95a2\u9023\u3059\u308b\u88fd\u54c1\u304c\u4e00\u8cab\u3057\u3066\u751f\u6210\u3055\u308c\u308b</li> <li>\u5177\u4f53\u30af\u30e9\u30b9\u306e\u5206\u96e2: \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306f\u5177\u4f53\u7684\u306a\u88fd\u54c1\u30af\u30e9\u30b9\u3092\u77e5\u3089\u306a\u3044</li> <li>\u88fd\u54c1\u30d5\u30a1\u30df\u30ea\u30fc\u306e\u4ea4\u63db: \u30d5\u30a1\u30af\u30c8\u30ea\u3092\u4ea4\u63db\u3059\u308b\u3060\u3051\u3067\u88fd\u54c1\u7fa4\u5168\u4f53\u3092\u5909\u66f4\u53ef\u80fd</li> <li>\u65b0\u3057\u3044\u88fd\u54c1\u30d5\u30a1\u30df\u30ea\u30fc\u306e\u8ffd\u52a0\u304c\u5bb9\u6613: \u65b0\u3057\u3044 ConcreteFactory \u3092\u8ffd\u52a0\u3059\u308b\u3060\u3051</li> </ol>"},{"location":"clojure/13-abstract-factory-pattern/#10","title":"10. \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306e\u7279\u5fb4","text":"<p>Clojure \u3067\u306e Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u306b\u306f\u4ee5\u4e0b\u306e\u7279\u5fb4\u304c\u3042\u308a\u307e\u3059\uff1a</p> <ol> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: \u30d5\u30a1\u30af\u30c8\u30ea\u306e\u578b\u306b\u57fa\u3065\u3044\u305f\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1</li> <li>\u30de\u30c3\u30d7\u30d9\u30fc\u30b9\u306e\u30d5\u30a1\u30af\u30c8\u30ea: \u30d5\u30a1\u30af\u30c8\u30ea\u306f\u8a2d\u5b9a\u3092\u542b\u3080\u30de\u30c3\u30d7\u3068\u3057\u3066\u8868\u73fe</li> <li>\u7d14\u7c8b\u95a2\u6570: \u30d5\u30a1\u30af\u30c8\u30ea\u30e1\u30bd\u30c3\u30c9\u306f\u526f\u4f5c\u7528\u306e\u306a\u3044\u7d14\u7c8b\u95a2\u6570</li> <li>\u30c7\u30fc\u30bf\u3068\u3057\u3066\u306e\u88fd\u54c1: \u88fd\u54c1\u306f\u5358\u306a\u308b\u30de\u30c3\u30d7\u30c7\u30fc\u30bf</li> </ol> <p></p>"},{"location":"clojure/13-abstract-factory-pattern/#_10","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30d5\u30a1\u30af\u30c8\u30ea\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9: \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u62bd\u8c61\u5316</li> <li>\u8907\u6570\u306e\u30d5\u30a1\u30af\u30c8\u30ea\u5b9f\u88c5: Standard\u3001Outlined\u3001Filled</li> <li>UI \u30d5\u30a1\u30af\u30c8\u30ea: \u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u5225\u306e UI \u751f\u6210</li> <li>\u30d5\u30a1\u30af\u30c8\u30ea\u306e\u4ea4\u63db: \u540c\u3058\u30b3\u30fc\u30c9\u3067\u7570\u306a\u308b\u88fd\u54c1\u7fa4\u3092\u751f\u6210</li> </ol> <p>Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u95a2\u9023\u3059\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30d5\u30a1\u30df\u30ea\u30fc\u3092\u4e00\u8cab\u3057\u3066\u751f\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u5834\u9762\u3067\u6709\u52b9\u3067\u3059\u3002</p>"},{"location":"clojure/13-abstract-factory-pattern/#_11","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part5/src/abstract_factory/</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part5/spec/abstract_factory/</code></li> </ul>"},{"location":"clojure/13-abstract-factory-pattern/#_12","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Abstract Server \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u4f9d\u5b58\u95a2\u4fc2\u306e\u9006\u8ee2\u3092\u5b9f\u73fe\u3057\u3001\u30e2\u30b8\u30e5\u30fc\u30eb\u9593\u306e\u758e\u7d50\u5408\u3092\u9054\u6210\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/14-abstract-server-pattern/","title":"\u7b2c14\u7ae0: Abstract Server \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"clojure/14-abstract-server-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Abstract Server \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u4f9d\u5b58\u95a2\u4fc2\u9006\u8ee2\u306e\u539f\u5247\uff08DIP\uff09\u3092\u5b9f\u73fe\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u9ad8\u30ec\u30d9\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u4f4e\u30ec\u30d9\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u8a73\u7d30\u306b\u4f9d\u5b58\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u4e21\u8005\u304c\u62bd\u8c61\u306b\u4f9d\u5b58\u3059\u308b\u3053\u3068\u3067\u758e\u7d50\u5408\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u30b9\u30a4\u30c3\u30c1\u3068\u30c7\u30d0\u30a4\u30b9\u3001\u30ea\u30dd\u30b8\u30c8\u30ea\u3068\u30b5\u30fc\u30d3\u30b9\u306e\u4f8b\u3092\u901a\u3058\u3066\u3001\u30d7\u30ed\u30c8\u30b3\u30eb\u306b\u3088\u308b Abstract Server \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"clojure/14-abstract-server-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Abstract Server \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Client: \u30b5\u30fc\u30d3\u30b9\u3092\u5229\u7528\u3059\u308b\u30e2\u30b8\u30e5\u30fc\u30eb</li> <li>Abstract Server: \u30b5\u30fc\u30d3\u30b9\u306e\u62bd\u8c61\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>Concrete Server: \u5177\u4f53\u7684\u306a\u30b5\u30fc\u30d3\u30b9\u306e\u5b9f\u88c5</li> </ul> <p></p>"},{"location":"clojure/14-abstract-server-pattern/#2-switchable","title":"2. Switchable \u30d7\u30ed\u30c8\u30b3\u30eb","text":""},{"location":"clojure/14-abstract-server-pattern/#abstract-server","title":"Abstract Server \u306e\u5b9a\u7fa9","text":"<pre><code>(ns abstract-server.switchable)\n\n(defprotocol Switchable\n  \"\u30b9\u30a4\u30c3\u30c1\u53ef\u80fd\u306a\u30c7\u30d0\u30a4\u30b9\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\"\n  (turn-on [this] \"\u30c7\u30d0\u30a4\u30b9\u3092\u30aa\u30f3\u306b\u3059\u308b\")\n  (turn-off [this] \"\u30c7\u30d0\u30a4\u30b9\u3092\u30aa\u30d5\u306b\u3059\u308b\")\n  (is-on? [this] \"\u30c7\u30d0\u30a4\u30b9\u304c\u30aa\u30f3\u304b\u3069\u3046\u304b\u3092\u78ba\u8a8d\u3059\u308b\"))\n</code></pre>"},{"location":"clojure/14-abstract-server-pattern/#3-concrete-server-light","title":"3. Concrete Server: Light","text":""},{"location":"clojure/14-abstract-server-pattern/#_2","title":"\u5b9f\u88c5","text":"<pre><code>(ns abstract-server.light\n  (:require [abstract-server.switchable :as switchable]))\n\n(defrecord Light [state]\n  switchable/Switchable\n  (turn-on [this]\n    (assoc this :state :on))\n  (turn-off [this]\n    (assoc this :state :off))\n  (is-on? [this]\n    (= (:state this) :on)))\n\n(defn make\n  \"\u7167\u660e\u3092\u4f5c\u6210\uff08\u521d\u671f\u72b6\u614b: \u30aa\u30d5\uff09\"\n  []\n  (-&gt;Light :off))\n\n(defn make-on\n  \"\u30aa\u30f3\u72b6\u614b\u306e\u7167\u660e\u3092\u4f5c\u6210\"\n  []\n  (-&gt;Light :on))\n</code></pre>"},{"location":"clojure/14-abstract-server-pattern/#4-concrete-server-fan","title":"4. Concrete Server: Fan","text":""},{"location":"clojure/14-abstract-server-pattern/#_3","title":"\u5b9f\u88c5","text":"<pre><code>(ns abstract-server.fan\n  (:require [abstract-server.switchable :as switchable]))\n\n(defrecord Fan [state speed]\n  switchable/Switchable\n  (turn-on [this]\n    (assoc this :state :on :speed (or speed :low)))\n  (turn-off [this]\n    (assoc this :state :off :speed nil))\n  (is-on? [this]\n    (= (:state this) :on)))\n\n(defn make []\n  (-&gt;Fan :off nil))\n\n(defn set-speed [fan speed]\n  (if (switchable/is-on? fan)\n    (assoc fan :speed speed)\n    fan))\n</code></pre>"},{"location":"clojure/14-abstract-server-pattern/#5-concrete-server-motor","title":"5. Concrete Server: Motor","text":""},{"location":"clojure/14-abstract-server-pattern/#_4","title":"\u5b9f\u88c5","text":"<pre><code>(ns abstract-server.motor\n  (:require [abstract-server.switchable :as switchable]))\n\n(defrecord Motor [state direction]\n  switchable/Switchable\n  (turn-on [this]\n    (assoc this :state :on :direction (or direction :forward)))\n  (turn-off [this]\n    (assoc this :state :off))\n  (is-on? [this]\n    (= (:state this) :on)))\n\n(defn make []\n  (-&gt;Motor :off nil))\n\n(defn reverse-direction [motor]\n  (if (switchable/is-on? motor)\n    (let [current (:direction motor)]\n      (assoc motor :direction (if (= current :forward) :reverse :forward)))\n    motor))\n</code></pre>"},{"location":"clojure/14-abstract-server-pattern/#6-client-switch","title":"6. Client: Switch","text":""},{"location":"clojure/14-abstract-server-pattern/#_5","title":"\u5b9f\u88c5","text":"<pre><code>(ns abstract-server.switch\n  (:require [abstract-server.switchable :as switchable]))\n\n(defn engage\n  \"\u30b9\u30a4\u30c3\u30c1\u3092\u5165\u308c\u308b\uff08\u30c7\u30d0\u30a4\u30b9\u3092\u30aa\u30f3\u306b\u3059\u308b\uff09\"\n  [device]\n  (switchable/turn-on device))\n\n(defn disengage\n  \"\u30b9\u30a4\u30c3\u30c1\u3092\u5207\u308b\uff08\u30c7\u30d0\u30a4\u30b9\u3092\u30aa\u30d5\u306b\u3059\u308b\uff09\"\n  [device]\n  (switchable/turn-off device))\n\n(defn toggle\n  \"\u30b9\u30a4\u30c3\u30c1\u3092\u5207\u308a\u66ff\u3048\u308b\"\n  [device]\n  (if (switchable/is-on? device)\n    (switchable/turn-off device)\n    (switchable/turn-on device)))\n\n(defn status\n  \"\u30c7\u30d0\u30a4\u30b9\u306e\u72b6\u614b\u3092\u53d6\u5f97\"\n  [device]\n  (if (switchable/is-on? device)\n    :on\n    :off))\n</code></pre>"},{"location":"clojure/14-abstract-server-pattern/#_6","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>(require '[abstract-server.switch :as sw])\n(require '[abstract-server.light :as light])\n(require '[abstract-server.fan :as fan])\n(require '[abstract-server.motor :as motor])\n\n;; \u540c\u3058Switch\u30b3\u30fc\u30c9\u3067\u7570\u306a\u308b\u30c7\u30d0\u30a4\u30b9\u3092\u64cd\u4f5c\n(def l (sw/engage (light/make)))\n(sw/status l) ;; =&gt; :on\n\n(def f (sw/engage (fan/make)))\n(sw/status f) ;; =&gt; :on\n\n(def m (sw/engage (motor/make)))\n(sw/status m) ;; =&gt; :on\n</code></pre>"},{"location":"clojure/14-abstract-server-pattern/#7","title":"7. \u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"clojure/14-abstract-server-pattern/#8-repository","title":"8. Repository \u306e\u4f8b","text":""},{"location":"clojure/14-abstract-server-pattern/#abstract-server-repository","title":"Abstract Server: Repository \u30d7\u30ed\u30c8\u30b3\u30eb","text":"<pre><code>(ns abstract-server.repository)\n\n(defprotocol Repository\n  \"\u30c7\u30fc\u30bf\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\"\n  (find-by-id [this id] \"ID\u3067\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u3092\u53d6\u5f97\")\n  (find-all [this] \"\u5168\u3066\u306e\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u3092\u53d6\u5f97\")\n  (save [this entity] \"\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u3092\u4fdd\u5b58\")\n  (delete [this id] \"\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u3092\u524a\u9664\"))\n</code></pre>"},{"location":"clojure/14-abstract-server-pattern/#concrete-server-memoryrepository","title":"Concrete Server: MemoryRepository","text":"<pre><code>(ns abstract-server.memory-repository\n  (:require [abstract-server.repository :as repo]))\n\n(defrecord MemoryRepository [data]\n  repo/Repository\n  (find-by-id [this id]\n    (get @(:data this) id))\n  (find-all [this]\n    (vals @(:data this)))\n  (save [this entity]\n    (let [id (or (:id entity) (str (java.util.UUID/randomUUID)))\n          entity-with-id (assoc entity :id id)]\n      (swap! (:data this) assoc id entity-with-id)\n      entity-with-id))\n  (delete [this id]\n    (let [entity (get @(:data this) id)]\n      (swap! (:data this) dissoc id)\n      entity)))\n\n(defn make []\n  (-&gt;MemoryRepository (atom {})))\n</code></pre>"},{"location":"clojure/14-abstract-server-pattern/#client-userservice","title":"Client: UserService","text":"<pre><code>(ns abstract-server.user-service\n  (:require [abstract-server.repository :as repo]))\n\n(defn create-user [repository name email]\n  (let [user {:name name\n              :email email\n              :created-at (java.util.Date.)}]\n    (repo/save repository user)))\n\n(defn get-user [repository id]\n  (repo/find-by-id repository id))\n\n(defn get-all-users [repository]\n  (repo/find-all repository))\n</code></pre>"},{"location":"clojure/14-abstract-server-pattern/#9","title":"9. \u4f9d\u5b58\u95a2\u4fc2\u306e\u56f3","text":""},{"location":"clojure/14-abstract-server-pattern/#10","title":"10. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u758e\u7d50\u5408: \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306f\u5177\u4f53\u7684\u306a\u5b9f\u88c5\u3092\u77e5\u3089\u306a\u3044</li> <li>\u30c6\u30b9\u30c8\u5bb9\u6613\u6027: \u30e2\u30c3\u30af/\u30b9\u30bf\u30d6\u3092\u7c21\u5358\u306b\u6ce8\u5165\u53ef\u80fd</li> <li>\u67d4\u8edf\u6027: \u5b9f\u88c5\u306e\u4ea4\u63db\u304c\u5bb9\u6613</li> <li>\u4f9d\u5b58\u95a2\u4fc2\u9006\u8ee2: \u9ad8\u30ec\u30d9\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u4f4e\u30ec\u30d9\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u4f9d\u5b58\u3057\u306a\u3044</li> </ol>"},{"location":"clojure/14-abstract-server-pattern/#11","title":"11. \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306e\u7279\u5fb4","text":"<p>Clojure \u3067\u306e Abstract Server \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u306b\u306f\u4ee5\u4e0b\u306e\u7279\u5fb4\u304c\u3042\u308a\u307e\u3059\uff1a</p> <ol> <li>\u30d7\u30ed\u30c8\u30b3\u30eb: \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u5b9a\u7fa9</li> <li>\u30ec\u30b3\u30fc\u30c9: \u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u5b9f\u88c5\u3059\u308b\u30c7\u30fc\u30bf\u578b</li> <li>\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb: \u72b6\u614b\u5909\u66f4\u306f\u65b0\u3057\u3044\u30ec\u30b3\u30fc\u30c9\u3092\u8fd4\u3059</li> <li>\u4f9d\u5b58\u6027\u6ce8\u5165: \u95a2\u6570\u306e\u5f15\u6570\u3068\u3057\u3066\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u6e21\u3059</li> </ol> <p></p>"},{"location":"clojure/14-abstract-server-pattern/#_7","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Abstract Server \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30d7\u30ed\u30c8\u30b3\u30eb\u306b\u3088\u308b\u62bd\u8c61\u5316: Switchable\u3001Repository</li> <li>\u30ec\u30b3\u30fc\u30c9\u306b\u3088\u308b\u5b9f\u88c5: Light\u3001Fan\u3001Motor\u3001MemoryRepository</li> <li>\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u72ec\u7acb\u6027: Switch\u3001UserService</li> <li>\u4f9d\u5b58\u95a2\u4fc2\u9006\u8ee2: \u9ad8\u30ec\u30d9\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u62bd\u8c61\u306b\u4f9d\u5b58</li> </ol> <p>Abstract Server \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30e2\u30b8\u30e5\u30fc\u30eb\u9593\u306e\u758e\u7d50\u5408\u3092\u5b9f\u73fe\u3057\u3001\u30c6\u30b9\u30c8\u5bb9\u6613\u6027\u3068\u67d4\u8edf\u6027\u3092\u5411\u4e0a\u3055\u305b\u307e\u3059\u3002</p>"},{"location":"clojure/14-abstract-server-pattern/#_8","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part5/src/abstract_server/</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part5/spec/abstract_server/</code></li> </ul>"},{"location":"clojure/14-abstract-server-pattern/#5","title":"\u7b2c5\u90e8\u306e\u307e\u3068\u3081","text":"<p>\u7b2c5\u90e8\u3067\u306f\u3001\u751f\u6210\u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ul> <li>Abstract Factory \u30d1\u30bf\u30fc\u30f3: \u95a2\u9023\u3059\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30d5\u30a1\u30df\u30ea\u30fc\u3092\u4e00\u8cab\u3057\u3066\u751f\u6210</li> <li>Abstract Server \u30d1\u30bf\u30fc\u30f3: \u4f9d\u5b58\u95a2\u4fc2\u9006\u8ee2\u306b\u3088\u308b\u758e\u7d50\u5408\u306e\u5b9f\u73fe</li> </ul> <p>\u3053\u308c\u3089\u306e\u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u72ec\u7acb\u6027\u3092\u9ad8\u3081\u3001\u30c6\u30b9\u30c8\u5bb9\u6613\u6027\u3068\u4fdd\u5b88\u6027\u3092\u5411\u4e0a\u3055\u305b\u307e\u3059\u3002</p>"},{"location":"clojure/15-gossiping-bus-drivers/","title":"\u7b2c15\u7ae0: \u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b","text":""},{"location":"clojure/15-gossiping-bus-drivers/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u300c\u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b\u300d\u3068\u3044\u3046\u554f\u984c\u3092\u901a\u3058\u3066\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u5b9f\u8df5\u7684\u306a\u30a2\u30d7\u30ed\u30fc\u30c1\u3092\u5b66\u3073\u307e\u3059\u3002\u3053\u306e\u554f\u984c\u306f\u3001\u30d0\u30b9\u904b\u8ee2\u624b\u304c\u505c\u7559\u6240\u3067\u51fa\u4f1a\u3063\u305f\u3068\u304d\u306b\u5642\u3092\u5171\u6709\u3059\u308b\u3068\u3044\u3046\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3067\u3059\u3002</p> <p>\u3053\u306e\u554f\u984c\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u306e\u6982\u5ff5\u3092\u5b66\u3073\u307e\u3059\uff1a</p> <ul> <li>\u7121\u9650\u30b7\u30fc\u30b1\u30f3\u30b9\uff08<code>cycle</code>\uff09\u306b\u3088\u308b\u5faa\u74b0\u30c7\u30fc\u30bf\u306e\u8868\u73fe</li> <li>\u96c6\u5408\u6f14\u7b97\u306b\u3088\u308b\u72b6\u614b\u306e\u4f1d\u64ad</li> <li>\u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u8a2d\u8a08</li> </ul>"},{"location":"clojure/15-gossiping-bus-drivers/#1","title":"1. \u554f\u984c\u306e\u8aac\u660e","text":"<p>\u8907\u6570\u306e\u30d0\u30b9\u904b\u8ee2\u624b\u304c\u305d\u308c\u305e\u308c\u306e\u30eb\u30fc\u30c8\u3092\u5de1\u56de\u3057\u3066\u3044\u307e\u3059\u3002\u5404\u904b\u8ee2\u624b\u306f\u6700\u521d\u306b1\u3064\u4ee5\u4e0a\u306e\u5642\u3092\u77e5\u3063\u3066\u3044\u307e\u3059\u3002\u540c\u3058\u505c\u7559\u6240\u306b\u8907\u6570\u306e\u904b\u8ee2\u624b\u304c\u3044\u308b\u3068\u3001\u5f7c\u3089\u306f\u77e5\u3063\u3066\u3044\u308b\u5642\u3092\u3059\u3079\u3066\u5171\u6709\u3057\u307e\u3059\u3002</p> <p>\u30b4\u30fc\u30eb: \u5168\u3066\u306e\u904b\u8ee2\u624b\u304c\u5168\u3066\u306e\u5642\u3092\u77e5\u308b\u307e\u3067\u306b\u4f55\u5206\u304b\u304b\u308b\u304b\uff1f</p> <p></p>"},{"location":"clojure/15-gossiping-bus-drivers/#2","title":"2. \u30c7\u30fc\u30bf\u30e2\u30c7\u30eb","text":""},{"location":"clojure/15-gossiping-bus-drivers/#_2","title":"\u30c9\u30e9\u30a4\u30d0\u30fc\u306e\u8868\u73fe","text":"<pre><code>(defn make-driver\n  \"\u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u4f5c\u6210\u3059\u308b\n   name - \u30c9\u30e9\u30a4\u30d0\u30fc\u306e\u540d\u524d\n   route - \u505c\u7559\u6240\u306e\u30b7\u30fc\u30b1\u30f3\u30b9\n   rumors - \u77e5\u3063\u3066\u3044\u308b\u5642\u306e\u96c6\u5408\"\n  [name route rumors]\n  {:name name\n   :route (cycle route)  ; \u7121\u9650\u30b7\u30fc\u30b1\u30f3\u30b9\u3067\u5faa\u74b0\u30eb\u30fc\u30c8\n   :rumors rumors})\n</code></pre> <p>\u30dd\u30a4\u30f3\u30c8: - <code>cycle</code> \u95a2\u6570\u3067\u6709\u9650\u306e\u30eb\u30fc\u30c8\u3092\u7121\u9650\u306e\u5faa\u74b0\u30b7\u30fc\u30b1\u30f3\u30b9\u306b\u5909\u63db - \u5642\u306f\u96c6\u5408\uff08set\uff09\u3068\u3057\u3066\u7ba1\u7406</p>"},{"location":"clojure/15-gossiping-bus-drivers/#_3","title":"\u7121\u9650\u30b7\u30fc\u30b1\u30f3\u30b9\u306e\u6d3b\u7528","text":"<pre><code>;; \u30eb\u30fc\u30c8 [1 2 3] \u306f\u7121\u9650\u306b\u7e70\u308a\u8fd4\u3055\u308c\u308b\n(take 10 (cycle [1 2 3]))\n;; =&gt; (1 2 3 1 2 3 1 2 3 1)\n</code></pre>"},{"location":"clojure/15-gossiping-bus-drivers/#3","title":"3. \u79fb\u52d5\u3068\u5642\u306e\u4f1d\u64ad","text":""},{"location":"clojure/15-gossiping-bus-drivers/#_4","title":"\u30c9\u30e9\u30a4\u30d0\u30fc\u306e\u79fb\u52d5","text":"<pre><code>(defn current-stop\n  \"\u30c9\u30e9\u30a4\u30d0\u30fc\u306e\u73fe\u5728\u306e\u505c\u7559\u6240\u3092\u53d6\u5f97\"\n  [driver]\n  (first (:route driver)))\n\n(defn move-driver\n  \"\u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u6b21\u306e\u505c\u7559\u6240\u306b\u79fb\u52d5\"\n  [driver]\n  (update driver :route rest))\n\n(defn move-drivers\n  \"\u5168\u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u6b21\u306e\u505c\u7559\u6240\u306b\u79fb\u52d5\"\n  [world]\n  (map move-driver world))\n</code></pre>"},{"location":"clojure/15-gossiping-bus-drivers/#_5","title":"\u505c\u7559\u6240\u3054\u3068\u306e\u30c9\u30e9\u30a4\u30d0\u30fc\u96c6\u8a08","text":"<pre><code>(defn get-stops\n  \"\u5404\u505c\u7559\u6240\u306b\u3044\u308b\u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u30de\u30c3\u30d7\u3068\u3057\u3066\u53d6\u5f97\n   {\u505c\u7559\u6240\u756a\u53f7 =&gt; [\u30c9\u30e9\u30a4\u30d0\u30fc1, \u30c9\u30e9\u30a4\u30d0\u30fc2, ...]}\"\n  [world]\n  (loop [world world\n         stops {}]\n    (if (empty? world)\n      stops\n      (let [driver (first world)\n            stop (current-stop driver)\n            stops (update stops stop conj driver)]\n        (recur (rest world) stops)))))\n</code></pre>"},{"location":"clojure/15-gossiping-bus-drivers/#_6","title":"\u5642\u306e\u5171\u6709","text":"<pre><code>(defn merge-rumors\n  \"\u540c\u3058\u505c\u7559\u6240\u306b\u3044\u308b\u30c9\u30e9\u30a4\u30d0\u30fc\u9593\u3067\u5642\u3092\u5171\u6709\n   \u5168\u54e1\u306e\u5642\u3092\u7d71\u5408\u3057\u3001\u5404\u30c9\u30e9\u30a4\u30d0\u30fc\u306b\u8a2d\u5b9a\"\n  [drivers]\n  (let [rumors (map :rumors drivers)\n        all-rumors (apply set/union rumors)]\n    (map #(assoc % :rumors all-rumors) drivers)))\n\n(defn spread-rumors\n  \"\u5168\u505c\u7559\u6240\u3067\u5642\u3092\u4f1d\u64ad\"\n  [world]\n  (let [stops-with-drivers (get-stops world)\n        drivers-by-stop (vals stops-with-drivers)]\n    (flatten (map merge-rumors drivers-by-stop))))\n</code></pre>"},{"location":"clojure/15-gossiping-bus-drivers/#4","title":"4. \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3","text":""},{"location":"clojure/15-gossiping-bus-drivers/#1_1","title":"1\u30b9\u30c6\u30c3\u30d7\u306e\u51e6\u7406","text":"<pre><code>(defn drive\n  \"1\u30b9\u30c6\u30c3\u30d7\u5206\u306e\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\n   1. \u5168\u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u79fb\u52d5\n   2. \u540c\u3058\u505c\u7559\u6240\u306b\u3044\u308b\u30c9\u30e9\u30a4\u30d0\u30fc\u9593\u3067\u5642\u3092\u5171\u6709\"\n  [world]\n  (-&gt; world\n      move-drivers\n      spread-rumors))\n</code></pre>"},{"location":"clojure/15-gossiping-bus-drivers/#_7","title":"\u5b8c\u4e86\u5224\u5b9a","text":"<pre><code>(defn all-rumors-shared?\n  \"\u5168\u30c9\u30e9\u30a4\u30d0\u30fc\u304c\u540c\u3058\u5642\u3092\u6301\u3063\u3066\u3044\u308b\u304b\u78ba\u8a8d\"\n  [world]\n  (apply = (map :rumors world)))\n\n(defn drive-till-all-rumors-spread\n  \"\u5168\u3066\u306e\u5642\u304c\u5171\u6709\u3055\u308c\u308b\u307e\u3067\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\n   480\u5206\uff088\u6642\u9593\uff09\u4ee5\u5185\u306b\u5171\u6709\u3055\u308c\u306a\u3051\u308c\u3070 :never \u3092\u8fd4\u3059\"\n  [world]\n  (loop [world (drive world)\n         time 1]\n    (cond\n      (&gt; time 480) :never\n      (all-rumors-shared? world) time\n      :else (recur (drive world) (inc time)))))\n</code></pre>"},{"location":"clojure/15-gossiping-bus-drivers/#5","title":"5. \u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"clojure/15-gossiping-bus-drivers/#6","title":"6. \u4f7f\u7528\u4f8b","text":"<pre><code>(require '[gossiping-bus-drivers.core :as gbd])\n\n;; 3\u4eba\u306e\u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u4f5c\u6210\n(def world\n  [(gbd/make-driver \"D1\" [3 1 2 3] #{:rumor-a})\n   (gbd/make-driver \"D2\" [3 2 3 1] #{:rumor-b})\n   (gbd/make-driver \"D3\" [4 2 3 4 5] #{:rumor-c})])\n\n;; \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u5b9f\u884c\n(gbd/drive-till-all-rumors-spread world)\n;; =&gt; 5 (5\u5206\u3067\u5168\u5642\u304c\u5171\u6709\u3055\u308c\u308b)\n\n;; \u7d76\u5bfe\u306b\u51fa\u4f1a\u308f\u306a\u3044\u30eb\u30fc\u30c8\u306e\u5834\u5408\n(def never-meet\n  [(gbd/make-driver \"D1\" [1] #{:rumor-a})\n   (gbd/make-driver \"D2\" [2] #{:rumor-b})])\n\n(gbd/drive-till-all-rumors-spread never-meet)\n;; =&gt; :never\n</code></pre>"},{"location":"clojure/15-gossiping-bus-drivers/#7","title":"7. \u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1\u306e\u7279\u5fb4","text":""},{"location":"clojure/15-gossiping-bus-drivers/#_8","title":"\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020","text":"<p>\u3059\u3079\u3066\u306e\u72b6\u614b\u5909\u66f4\u306f\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u8fd4\u3057\u307e\u3059\u3002\u5143\u306e\u30c7\u30fc\u30bf\u306f\u5909\u66f4\u3055\u308c\u307e\u305b\u3093\u3002</p> <pre><code>;; \u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u79fb\u52d5\u3057\u3066\u3082\u5143\u306e\u30c9\u30e9\u30a4\u30d0\u30fc\u306f\u5909\u66f4\u3055\u308c\u306a\u3044\n(def original (gbd/make-driver \"Test\" [1 2 3] #{:a}))\n(def moved (gbd/move-driver original))\n\n(gbd/current-stop original) ;; =&gt; 1 (\u5909\u66f4\u306a\u3057)\n(gbd/current-stop moved)    ;; =&gt; 2\n</code></pre>"},{"location":"clojure/15-gossiping-bus-drivers/#_9","title":"\u9045\u5ef6\u8a55\u4fa1","text":"<p><code>cycle</code> \u306b\u3088\u308b\u7121\u9650\u30b7\u30fc\u30b1\u30f3\u30b9\u306f\u9045\u5ef6\u8a55\u4fa1\u3055\u308c\u308b\u305f\u3081\u3001\u30e1\u30e2\u30ea\u3092\u52b9\u7387\u7684\u306b\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"clojure/15-gossiping-bus-drivers/#_10","title":"\u7d14\u7c8b\u95a2\u6570","text":"<p>\u3059\u3079\u3066\u306e\u95a2\u6570\u306f\u526f\u4f5c\u7528\u304c\u306a\u304f\u3001\u540c\u3058\u5165\u529b\u306b\u5bfe\u3057\u3066\u5e38\u306b\u540c\u3058\u51fa\u529b\u3092\u8fd4\u3057\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u30c6\u30b9\u30c8\u304c\u5bb9\u6613\u306b\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/15-gossiping-bus-drivers/#8","title":"8. \u30d1\u30bf\u30fc\u30f3\u306e\u5fdc\u7528","text":"<p>\u3053\u306e\u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5834\u9762\u3067\u5fdc\u7528\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4f1d\u64ad: \u30a6\u30a4\u30eb\u30b9\u3084\u60c5\u5831\u306e\u62e1\u6563\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3</li> <li>\u30b0\u30e9\u30d5\u63a2\u7d22: \u5de1\u56de\u30bb\u30fc\u30eb\u30b9\u30de\u30f3\u554f\u984c\u306e\u5909\u5f62</li> <li>\u72b6\u614b\u540c\u671f: \u5206\u6563\u30b7\u30b9\u30c6\u30e0\u3067\u306e\u72b6\u614b\u5171\u6709</li> </ul>"},{"location":"clojure/15-gossiping-bus-drivers/#_11","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b\u554f\u984c\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u3092\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u7121\u9650\u30b7\u30fc\u30b1\u30f3\u30b9: <code>cycle</code> \u306b\u3088\u308b\u5faa\u74b0\u30c7\u30fc\u30bf\u306e\u8868\u73fe</li> <li>\u96c6\u5408\u6f14\u7b97: <code>set/union</code> \u306b\u3088\u308b\u72b6\u614b\u306e\u7d71\u5408</li> <li>\u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3: <code>-&gt;</code> \u30de\u30af\u30ed\u306b\u3088\u308b\u51e6\u7406\u306e\u9023\u9396</li> <li>\u7d42\u4e86\u6761\u4ef6\u306e\u8a2d\u8a08: \u30eb\u30fc\u30d7\u3068\u6761\u4ef6\u5206\u5c90\u306e\u7d44\u307f\u5408\u308f\u305b</li> </ol>"},{"location":"clojure/15-gossiping-bus-drivers/#_12","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part6/src/gossiping_bus_drivers/</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part6/spec/gossiping_bus_drivers/</code></li> </ul>"},{"location":"clojure/16-payroll-system/","title":"\u7b2c16\u7ae0: \u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0","text":""},{"location":"clojure/16-payroll-system/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0\u3092\u984c\u6750\u306b\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u304a\u3051\u308b\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30ea\u30f3\u30b0\u3068\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u591a\u614b\u6027\u306e\u5b9f\u73fe\u3092\u5b66\u3073\u307e\u3059\u3002</p> <p>\u3053\u306e\u554f\u984c\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u306e\u6982\u5ff5\u3092\u5b66\u3073\u307e\u3059\uff1a</p> <ul> <li>Clojure Spec \u306b\u3088\u308b\u30c7\u30fc\u30bf\u4ed5\u69d8\u5b9a\u7fa9</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u7d66\u4e0e\u30bf\u30a4\u30d7\u5225\u306e\u8a08\u7b97</li> <li>\u652f\u6255\u3044\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u306e\u30e2\u30c7\u30ea\u30f3\u30b0</li> </ul>"},{"location":"clojure/16-payroll-system/#1","title":"1. \u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30eb","text":""},{"location":"clojure/16-payroll-system/#_2","title":"\u5f93\u696d\u54e1\u306e\u7d66\u4e0e\u30bf\u30a4\u30d7","text":"<p>\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0\u3067\u306f\u3001\u4ee5\u4e0b\u306e3\u7a2e\u985e\u306e\u7d66\u4e0e\u30bf\u30a4\u30d7\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u307e\u3059\uff1a</p> <ul> <li>\u6708\u7d66\u5236\uff08Salaried\uff09: \u56fa\u5b9a\u6708\u7d66</li> <li>\u6642\u7d66\u5236\uff08Hourly\uff09: \u52b4\u50cd\u6642\u9593\u306b\u57fa\u3065\u304f\u7d66\u4e0e</li> <li>\u6b69\u5408\u5236\uff08Commissioned\uff09: \u57fa\u672c\u7d66 + \u58f2\u4e0a\u306b\u5fdc\u3058\u305f\u30b3\u30df\u30c3\u30b7\u30e7\u30f3</li> </ul> <p></p>"},{"location":"clojure/16-payroll-system/#2-clojure-spec","title":"2. Clojure Spec \u306b\u3088\u308b\u4ed5\u69d8\u5b9a\u7fa9","text":""},{"location":"clojure/16-payroll-system/#_3","title":"\u5f93\u696d\u54e1\u306e\u4ed5\u69d8","text":"<pre><code>(ns payroll.employee\n  (:require [clojure.spec.alpha :as s]))\n\n;; \u57fa\u672c\u5c5e\u6027\n(s/def ::id string?)\n(s/def ::name string?)\n(s/def ::address string?)\n\n;; \u7d66\u4e0e\u5206\u985e\n(s/def ::salary number?)\n(s/def ::hourly-rate number?)\n(s/def ::base-pay number?)\n(s/def ::commission-rate number?)\n\n(s/def ::pay-class\n  (s/or :salaried (s/tuple #{:salaried} ::salary)\n        :hourly (s/tuple #{:hourly} ::hourly-rate)\n        :commissioned (s/tuple #{:commissioned} ::base-pay ::commission-rate)))\n\n;; \u652f\u6255\u3044\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\n(s/def ::schedule #{:monthly :weekly :biweekly})\n\n;; \u652f\u6255\u3044\u65b9\u6cd5\n(s/def ::payment-method #{:hold :direct-deposit :mail})\n\n;; \u5f93\u696d\u54e1\n(s/def ::employee\n  (s/keys :req [::id ::name ::pay-class ::schedule ::payment-method]\n          :opt [::address]))\n</code></pre>"},{"location":"clojure/16-payroll-system/#_4","title":"\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf","text":"<pre><code>(defn make-salaried-employee\n  \"\u6708\u7d66\u5236\u5f93\u696d\u54e1\u3092\u4f5c\u6210\"\n  [id name salary]\n  {::id id\n   ::name name\n   ::pay-class [:salaried salary]\n   ::schedule :monthly\n   ::payment-method :hold})\n\n(defn make-hourly-employee\n  \"\u6642\u7d66\u5236\u5f93\u696d\u54e1\u3092\u4f5c\u6210\"\n  [id name hourly-rate]\n  {::id id\n   ::name name\n   ::pay-class [:hourly hourly-rate]\n   ::schedule :weekly\n   ::payment-method :hold})\n\n(defn make-commissioned-employee\n  \"\u6b69\u5408\u5236\u5f93\u696d\u54e1\u3092\u4f5c\u6210\"\n  [id name base-pay commission-rate]\n  {::id id\n   ::name name\n   ::pay-class [:commissioned base-pay commission-rate]\n   ::schedule :biweekly\n   ::payment-method :hold})\n</code></pre>"},{"location":"clojure/16-payroll-system/#3","title":"3. \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u7d66\u4e0e\u8a08\u7b97","text":""},{"location":"clojure/16-payroll-system/#_5","title":"\u7d66\u4e0e\u8a08\u7b97\u306e\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1","text":"<pre><code>(ns payroll.classification\n  (:require [payroll.employee :as emp]))\n\n(defmulti calc-pay\n  \"\u7d66\u4e0e\u3092\u8a08\u7b97\u3059\u308b\n   \u7d66\u4e0e\u30bf\u30a4\u30d7\u306b\u5fdc\u3058\u3066\u7570\u306a\u308b\u8a08\u7b97\u30ed\u30b8\u30c3\u30af\u3092\u9069\u7528\"\n  (fn [employee _context] (emp/get-pay-type employee)))\n</code></pre>"},{"location":"clojure/16-payroll-system/#_6","title":"\u6708\u7d66\u5236","text":"<pre><code>(defmethod calc-pay :salaried\n  [employee _context]\n  (let [[_ salary] (emp/get-pay-class employee)]\n    salary))\n</code></pre>"},{"location":"clojure/16-payroll-system/#_7","title":"\u6642\u7d66\u5236","text":"<pre><code>(defmethod calc-pay :hourly\n  [employee context]\n  (let [[_ hourly-rate] (emp/get-pay-class employee)\n        time-cards (get-in context [:time-cards (emp/get-id employee)] [])\n        hours (map second time-cards)\n        total-hours (reduce + 0 hours)\n        ;; \u903140\u6642\u9593\u3092\u8d85\u3048\u308b\u5206\u306f1.5\u500d\n        regular-hours (min total-hours 40)\n        overtime-hours (max 0 (- total-hours 40))]\n    (+ (* regular-hours hourly-rate)\n       (* overtime-hours hourly-rate 1.5))))\n</code></pre>"},{"location":"clojure/16-payroll-system/#_8","title":"\u6b69\u5408\u5236","text":"<pre><code>(defmethod calc-pay :commissioned\n  [employee context]\n  (let [[_ base-pay commission-rate] (emp/get-pay-class employee)\n        sales-receipts (get-in context [:sales-receipts (emp/get-id employee)] [])\n        total-sales (reduce + 0 (map second sales-receipts))]\n    (+ base-pay (* total-sales commission-rate))))\n</code></pre>"},{"location":"clojure/16-payroll-system/#4","title":"4. \u652f\u6255\u3044\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb","text":""},{"location":"clojure/16-payroll-system/#_9","title":"\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u5224\u5b9a","text":"<pre><code>(ns payroll.schedule\n  (:require [payroll.employee :as emp]))\n\n(defmulti is-pay-day?\n  \"\u6307\u5b9a\u65e5\u304c\u652f\u6255\u65e5\u304b\u3069\u3046\u304b\u3092\u5224\u5b9a\"\n  (fn [employee _date] (emp/get-schedule employee)))\n\n;; \u6708\u6b21\uff08\u6708\u672b\uff09\n(defmethod is-pay-day? :monthly\n  [_employee date]\n  (= (:day date) (last-day-of-month date)))\n\n;; \u9031\u6b21\uff08\u91d1\u66dc\u65e5\uff09\n(defmethod is-pay-day? :weekly\n  [_employee date]\n  (= (:day-of-week date) :friday))\n\n;; \u9694\u9031\uff08\u9694\u9031\u306e\u91d1\u66dc\u65e5\uff09\n(defmethod is-pay-day? :biweekly\n  [_employee date]\n  (and (= (:day-of-week date) :friday)\n       (:is-pay-week date)))\n</code></pre>"},{"location":"clojure/16-payroll-system/#5","title":"5. \u652f\u6255\u3044\u51e6\u7406","text":""},{"location":"clojure/16-payroll-system/#_10","title":"\u652f\u6255\u3044\u65b9\u6cd5\u306b\u3088\u308b\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1","text":"<pre><code>(ns payroll.payroll\n  (:require [payroll.employee :as emp]\n            [payroll.classification :as class]\n            [payroll.schedule :as sched]))\n\n(defmulti process-payment\n  \"\u652f\u6255\u3044\u3092\u51e6\u7406\"\n  (fn [employee _amount] (emp/get-payment-method employee)))\n\n(defmethod process-payment :hold\n  [employee amount]\n  {:type :hold\n   :employee-id (emp/get-id employee)\n   :amount amount\n   :message \"\u652f\u6255\u3044\u3092\u4fdd\u7559\"})\n\n(defmethod process-payment :direct-deposit\n  [employee amount]\n  {:type :direct-deposit\n   :employee-id (emp/get-id employee)\n   :amount amount\n   :message \"\u53e3\u5ea7\u306b\u632f\u308a\u8fbc\u307f\"})\n\n(defmethod process-payment :mail\n  [employee amount]\n  {:type :mail\n   :employee-id (emp/get-id employee)\n   :amount amount\n   :message \"\u5c0f\u5207\u624b\u3092\u90f5\u9001\"})\n</code></pre>"},{"location":"clojure/16-payroll-system/#6","title":"6. \u7d66\u4e0e\u652f\u6255\u3044\u306e\u5b9f\u884c","text":"<pre><code>(defn run-payroll\n  \"\u7d66\u4e0e\u652f\u6255\u3044\u3092\u5b9f\u884c\n   \u652f\u6255\u65e5\u306b\u8a72\u5f53\u3059\u308b\u5f93\u696d\u54e1\u306b\u306e\u307f\u652f\u6255\u3044\u3092\u884c\u3046\"\n  [employees context date]\n  (let [payable-employees (filter #(sched/is-pay-day? % date) employees)]\n    (for [emp payable-employees\n          :let [pay (class/calc-pay emp context)]]\n      (process-payment emp pay))))\n</code></pre>"},{"location":"clojure/16-payroll-system/#7","title":"7. \u4f7f\u7528\u4f8b","text":"<pre><code>(require '[payroll.employee :as emp])\n(require '[payroll.classification :as class])\n(require '[payroll.schedule :as sched])\n(require '[payroll.payroll :as payroll])\n\n;; \u5f93\u696d\u54e1\u306e\u4f5c\u6210\n(def salaried-emp\n  (emp/make-salaried-employee \"E001\" \"\u7530\u4e2d\u592a\u90ce\" 500000))\n\n(def hourly-emp\n  (emp/make-hourly-employee \"E002\" \"\u4f50\u85e4\u82b1\u5b50\" 1500))\n\n(def commissioned-emp\n  (emp/make-commissioned-employee \"E003\" \"\u9234\u6728\u4e00\u90ce\" 200000 0.1))\n\n;; \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u4f5c\u6210\uff08\u30bf\u30a4\u30e0\u30ab\u30fc\u30c9\u3001\u58f2\u4e0a\u30c7\u30fc\u30bf\uff09\n(def ctx\n  (-&gt; (class/make-context)\n      (class/add-time-card \"E002\" \"2024-01-15\" 8)\n      (class/add-time-card \"E002\" \"2024-01-16\" 10)\n      (class/add-sales-receipt \"E003\" \"2024-01-15\" 100000)\n      (class/add-sales-receipt \"E003\" \"2024-01-16\" 50000)))\n\n;; \u7d66\u4e0e\u8a08\u7b97\n(class/calc-pay salaried-emp ctx)     ;; =&gt; 500000\n(class/calc-pay hourly-emp ctx)       ;; =&gt; 27000.0 (18\u6642\u9593 * 1500)\n(class/calc-pay commissioned-emp ctx) ;; =&gt; 215000.0 (200000 + 15000)\n</code></pre>"},{"location":"clojure/16-payroll-system/#8","title":"8. \u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1\u306e\u5229\u70b9","text":""},{"location":"clojure/16-payroll-system/#1_1","title":"1. \u30c6\u30b9\u30c8\u5bb9\u6613\u6027","text":"<p>\u7d14\u7c8b\u95a2\u6570\u3067\u3042\u308b\u305f\u3081\u3001\u30c6\u30b9\u30c8\u304c\u7c21\u5358\u3067\u3059\u3002</p> <pre><code>(describe \"\u7d66\u4e0e\u8a08\u7b97 - \u6642\u7d66\u5236\"\n  (it \"\u6b8b\u696d\u6642\u9593\u306f1.5\u500d\u3067\u8a08\u7b97\"\n    (let [e (emp/make-hourly-employee \"E002\" \"\u4f50\u85e4\" 1000)\n          ctx (class/add-time-card {} \"E002\" \"2024-01-15\" 45)]\n      ;; 40 * 1000 + 5 * 1000 * 1.5 = 47500\n      (should= 47500.0 (class/calc-pay e ctx)))))\n</code></pre>"},{"location":"clojure/16-payroll-system/#2","title":"2. \u62e1\u5f35\u5bb9\u6613\u6027","text":"<p>\u65b0\u3057\u3044\u7d66\u4e0e\u30bf\u30a4\u30d7\u306e\u8ffd\u52a0\u306f\u3001\u65b0\u3057\u3044\u30e1\u30bd\u30c3\u30c9\u3092\u5b9a\u7fa9\u3059\u308b\u3060\u3051\u3067\u3059\u3002</p> <pre><code>;; \u65b0\u3057\u3044\u7d66\u4e0e\u30bf\u30a4\u30d7: \u5951\u7d04\u5236\n(defmethod calc-pay :contract\n  [employee context]\n  (let [[_ contract-amount] (emp/get-pay-class employee)]\n    contract-amount))\n</code></pre>"},{"location":"clojure/16-payroll-system/#3_1","title":"3. \u95a2\u5fc3\u306e\u5206\u96e2","text":"<ul> <li>employee: \u30c7\u30fc\u30bf\u69cb\u9020\u3068\u30a2\u30af\u30bb\u30b5</li> <li>classification: \u7d66\u4e0e\u8a08\u7b97\u30ed\u30b8\u30c3\u30af</li> <li>schedule: \u652f\u6255\u65e5\u5224\u5b9a</li> <li>payroll: \u7d71\u5408\u51e6\u7406</li> </ul>"},{"location":"clojure/16-payroll-system/#_11","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u3092\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>Clojure Spec: \u30c7\u30fc\u30bf\u4ed5\u69d8\u306e\u5b9a\u7fa9</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: \u7d66\u4e0e\u30bf\u30a4\u30d7\u306b\u3088\u308b\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1</li> <li>\u95a2\u5fc3\u306e\u5206\u96e2: \u30e2\u30b8\u30e5\u30fc\u30eb\u5316\u3055\u308c\u305f\u8a2d\u8a08</li> <li>\u7d14\u7c8b\u95a2\u6570: \u30c6\u30b9\u30c8\u5bb9\u6613\u306a\u5b9f\u88c5</li> </ol>"},{"location":"clojure/16-payroll-system/#_12","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part6/src/payroll/</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part6/spec/payroll/</code></li> </ul>"},{"location":"clojure/17-video-rental-system/","title":"\u7b2c17\u7ae0: \u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0","text":""},{"location":"clojure/17-video-rental-system/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Martin Fowler \u306e\u300c\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u300d\u3067\u6709\u540d\u306a\u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0\u3092\u984c\u6750\u306b\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u3088\u308b\u6599\u91d1\u8a08\u7b97\u30ed\u30b8\u30c3\u30af\u306e\u8a2d\u8a08\u3092\u5b66\u3073\u307e\u3059\u3002</p> <p>\u3053\u306e\u554f\u984c\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u306e\u6982\u5ff5\u3092\u5b66\u3073\u307e\u3059\uff1a</p> <ul> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u30dd\u30ea\u30b7\u30fc\u30d1\u30bf\u30fc\u30f3</li> <li>\u660e\u7d30\u66f8\u30d5\u30a9\u30fc\u30de\u30c3\u30bf\u30fc\u306e\u5b9f\u88c5</li> <li>\u30c7\u30fc\u30bf\u3068\u51e6\u7406\u306e\u5206\u96e2</li> </ul>"},{"location":"clojure/17-video-rental-system/#1","title":"1. \u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30eb","text":""},{"location":"clojure/17-video-rental-system/#_2","title":"\u6620\u753b\u306e\u30ab\u30c6\u30b4\u30ea","text":"<p>\u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0\u3067\u306f\u3001\u4ee5\u4e0b\u306e3\u7a2e\u985e\u306e\u6620\u753b\u30ab\u30c6\u30b4\u30ea\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u307e\u3059\uff1a</p> <ul> <li>\u901a\u5e38\uff08Regular\uff09: 2\u65e5\u307e\u30672.0\u3001\u4ee5\u964d1\u65e5\u3054\u3068\u306b1.5\u8ffd\u52a0</li> <li>\u65b0\u4f5c\uff08New Release\uff09: 1\u65e5\u3054\u3068\u306b3.0</li> <li>\u5b50\u4f9b\u5411\u3051\uff08Children's\uff09: 3\u65e5\u307e\u30671.5\u3001\u4ee5\u964d1\u65e5\u3054\u3068\u306b1.5\u8ffd\u52a0</li> </ul> <p></p>"},{"location":"clojure/17-video-rental-system/#2","title":"2. \u6620\u753b\u3068\u30ec\u30f3\u30bf\u30eb\u306e\u30e2\u30c7\u30eb","text":""},{"location":"clojure/17-video-rental-system/#_3","title":"\u6620\u753b","text":"<pre><code>(ns video-rental.movie)\n\n(def categories\n  #{:regular :new-release :childrens})\n\n(defn make-movie\n  \"\u6620\u753b\u3092\u4f5c\u6210\"\n  [title category]\n  {:title title\n   :category category})\n\n(defn make-regular [title]\n  (make-movie title :regular))\n\n(defn make-new-release [title]\n  (make-movie title :new-release))\n\n(defn make-childrens [title]\n  (make-movie title :childrens))\n</code></pre>"},{"location":"clojure/17-video-rental-system/#_4","title":"\u30ec\u30f3\u30bf\u30eb","text":"<pre><code>(ns video-rental.rental\n  (:require [video-rental.movie :as movie]))\n\n(defn make-rental\n  \"\u30ec\u30f3\u30bf\u30eb\u3092\u4f5c\u6210\"\n  [movie days]\n  {:movie movie\n   :days days})\n\n(defn get-movie [rental]\n  (:movie rental))\n\n(defn get-days [rental]\n  (:days rental))\n\n(defn get-movie-category [rental]\n  (movie/get-category (:movie rental)))\n</code></pre>"},{"location":"clojure/17-video-rental-system/#3","title":"3. \u6599\u91d1\u8a08\u7b97\u306e\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9","text":""},{"location":"clojure/17-video-rental-system/#_5","title":"\u6599\u91d1\u8a08\u7b97","text":"<pre><code>(ns video-rental.pricing\n  (:require [video-rental.rental :as rental]))\n\n(defmulti determine-amount\n  \"\u30ec\u30f3\u30bf\u30eb\u6599\u91d1\u3092\u8a08\u7b97\"\n  (fn [r] (rental/get-movie-category r)))\n\n;; \u901a\u5e38\u6620\u753b: 2\u65e5\u307e\u30672.0\u3001\u4ee5\u964d1\u65e5\u3054\u3068\u306b1.5\u8ffd\u52a0\n(defmethod determine-amount :regular\n  [r]\n  (let [days (rental/get-days r)]\n    (if (&gt; days 2)\n      (+ 2.0 (* (- days 2) 1.5))\n      2.0)))\n\n;; \u65b0\u4f5c: 1\u65e5\u3054\u3068\u306b3.0\n(defmethod determine-amount :new-release\n  [r]\n  (* (rental/get-days r) 3.0))\n\n;; \u5b50\u4f9b\u5411\u3051: 3\u65e5\u307e\u30671.5\u3001\u4ee5\u964d1\u65e5\u3054\u3068\u306b1.5\u8ffd\u52a0\n(defmethod determine-amount :childrens\n  [r]\n  (let [days (rental/get-days r)]\n    (if (&gt; days 3)\n      (+ 1.5 (* (- days 3) 1.5))\n      1.5)))\n</code></pre>"},{"location":"clojure/17-video-rental-system/#_6","title":"\u30dd\u30a4\u30f3\u30c8\u8a08\u7b97","text":"<pre><code>(defmulti determine-points\n  \"\u30ec\u30f3\u30bf\u30eb\u30dd\u30a4\u30f3\u30c8\u3092\u8a08\u7b97\"\n  (fn [r] (rental/get-movie-category r)))\n\n;; \u901a\u5e38\u6620\u753b: 1\u30dd\u30a4\u30f3\u30c8\n(defmethod determine-points :regular\n  [_r]\n  1)\n\n;; \u65b0\u4f5c: 2\u65e5\u4ee5\u4e0a\u30672\u30dd\u30a4\u30f3\u30c8\u3001\u305d\u308c\u4ee5\u5916\u306f1\u30dd\u30a4\u30f3\u30c8\n(defmethod determine-points :new-release\n  [r]\n  (if (&gt; (rental/get-days r) 1)\n    2\n    1))\n\n;; \u5b50\u4f9b\u5411\u3051: 1\u30dd\u30a4\u30f3\u30c8\n(defmethod determine-points :childrens\n  [_r]\n  1)\n</code></pre>"},{"location":"clojure/17-video-rental-system/#4","title":"4. \u660e\u7d30\u66f8\u30d5\u30a9\u30fc\u30de\u30c3\u30bf\u30fc","text":""},{"location":"clojure/17-video-rental-system/#_7","title":"\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u30d5\u30a9\u30fc\u30de\u30c3\u30c8","text":"<pre><code>(ns video-rental.statement\n  (:require [video-rental.rental :as rental]\n            [video-rental.pricing :as pricing]))\n\n(defmulti format-statement\n  \"\u660e\u7d30\u66f8\u3092\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\"\n  (fn [format _customer _rentals] format))\n\n;; \u30c6\u30ad\u30b9\u30c8\u5f62\u5f0f\n(defmethod format-statement :text\n  [_ customer rentals]\n  (let [header (str \"Rental Record for \" customer \"\\n\")\n        lines (map (fn [r]\n                     (str \"\\t\" (rental/get-movie-title r)\n                          \"\\t\" (pricing/determine-amount r) \"\\n\"))\n                   rentals)\n        total (pricing/total-amount rentals)\n        points (pricing/total-points rentals)\n        footer (str \"Amount owed is \" total \"\\n\"\n                    \"You earned \" points \" frequent renter points\")]\n    (str header (apply str lines) footer)))\n\n;; HTML\u5f62\u5f0f\n(defmethod format-statement :html\n  [_ customer rentals]\n  (let [header (str \"&lt;h1&gt;Rental Record for &lt;em&gt;\" customer \"&lt;/em&gt;&lt;/h1&gt;\\n&lt;ul&gt;\\n\")\n        lines (map (fn [r]\n                     (str \"  &lt;li&gt;\" (rental/get-movie-title r)\n                          \" - \" (pricing/determine-amount r) \"&lt;/li&gt;\\n\"))\n                   rentals)\n        total (pricing/total-amount rentals)\n        points (pricing/total-points rentals)\n        footer (str \"&lt;/ul&gt;\\n\"\n                    \"&lt;p&gt;Amount owed is &lt;strong&gt;\" total \"&lt;/strong&gt;&lt;/p&gt;\\n\"\n                    \"&lt;p&gt;You earned &lt;strong&gt;\" points \"&lt;/strong&gt; frequent renter points&lt;/p&gt;\")]\n    (str header (apply str lines) footer)))\n</code></pre>"},{"location":"clojure/17-video-rental-system/#5","title":"5. \u660e\u7d30\u30c7\u30fc\u30bf\u306e\u751f\u6210","text":"<p>\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306b\u4f9d\u5b58\u3057\u306a\u3044\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u751f\u6210\u3059\u308b\u3053\u3068\u3067\u3001\u30c6\u30b9\u30c8\u3084\u4ed6\u306e\u7528\u9014\u306b\u6d3b\u7528\u3067\u304d\u307e\u3059\u3002</p> <pre><code>(defn statement-data\n  \"\u660e\u7d30\u30c7\u30fc\u30bf\u3092\u751f\u6210\uff08\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u975e\u4f9d\u5b58\uff09\"\n  [customer rentals]\n  {:customer customer\n   :rentals (map (fn [r]\n                   {:title (rental/get-movie-title r)\n                    :days (rental/get-days r)\n                    :amount (pricing/determine-amount r)\n                    :points (pricing/determine-points r)})\n                 rentals)\n   :total-amount (pricing/total-amount rentals)\n   :total-points (pricing/total-points rentals)})\n</code></pre>"},{"location":"clojure/17-video-rental-system/#6","title":"6. \u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"clojure/17-video-rental-system/#7","title":"7. \u4f7f\u7528\u4f8b","text":"<pre><code>(require '[video-rental.movie :as movie])\n(require '[video-rental.rental :as rental])\n(require '[video-rental.pricing :as pricing])\n(require '[video-rental.statement :as stmt])\n\n;; \u6620\u753b\u306e\u4f5c\u6210\n(def inception (movie/make-regular \"Inception\"))\n(def frozen (movie/make-childrens \"Frozen\"))\n(def new-movie (movie/make-new-release \"New Movie\"))\n\n;; \u30ec\u30f3\u30bf\u30eb\u306e\u4f5c\u6210\n(def rentals\n  [(rental/make-rental inception 3)\n   (rental/make-rental frozen 4)\n   (rental/make-rental new-movie 2)])\n\n;; \u6599\u91d1\u8a08\u7b97\n(pricing/determine-amount (first rentals)) ;; =&gt; 3.5\n(pricing/total-amount rentals)              ;; =&gt; 12.5\n(pricing/total-points rentals)              ;; =&gt; 4\n\n;; \u30c6\u30ad\u30b9\u30c8\u660e\u7d30\u66f8\n(println (stmt/make-statement \"John\" rentals))\n;; Rental Record for John\n;;   Inception  3.5\n;;   Frozen     3.0\n;;   New Movie  6.0\n;; Amount owed is 12.5\n;; You earned 4 frequent renter points\n\n;; HTML\u660e\u7d30\u66f8\n(println (stmt/make-statement :html \"John\" rentals))\n;; &lt;h1&gt;Rental Record for &lt;em&gt;John&lt;/em&gt;&lt;/h1&gt;\n;; &lt;ul&gt;\n;;   &lt;li&gt;Inception - 3.5&lt;/li&gt;\n;;   &lt;li&gt;Frozen - 3.0&lt;/li&gt;\n;;   &lt;li&gt;New Movie - 6.0&lt;/li&gt;\n;; &lt;/ul&gt;\n;; &lt;p&gt;Amount owed is &lt;strong&gt;12.5&lt;/strong&gt;&lt;/p&gt;\n;; &lt;p&gt;You earned &lt;strong&gt;4&lt;/strong&gt; frequent renter points&lt;/p&gt;\n</code></pre>"},{"location":"clojure/17-video-rental-system/#8","title":"8. \u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u306e\u30dd\u30a4\u30f3\u30c8","text":""},{"location":"clojure/17-video-rental-system/#_8","title":"\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u7248\u3068\u306e\u6bd4\u8f03","text":"<p>\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u7248\u3067\u306f\u3001<code>Movie</code> \u30af\u30e9\u30b9\u306b <code>getCharge()</code> \u30e1\u30bd\u30c3\u30c9\u3092\u6301\u305f\u305b\u308b\u3053\u3068\u304c\u591a\u3044\u3067\u3059\u304c\u3001\u95a2\u6570\u578b\u3067\u306f\uff1a</p> <ol> <li>\u30c7\u30fc\u30bf\u3068\u51e6\u7406\u306e\u5206\u96e2: \u6620\u753b\u306f\u30c7\u30fc\u30bf\u306e\u307f\u3001\u6599\u91d1\u8a08\u7b97\u306f\u5225\u306e\u95a2\u6570</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: \u30ab\u30c6\u30b4\u30ea\u306b\u5fdc\u3058\u305f\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1</li> <li>\u30aa\u30fc\u30d7\u30f3\u30fb\u30af\u30ed\u30fc\u30ba\u30c9\u539f\u5247: \u65b0\u3057\u3044\u30ab\u30c6\u30b4\u30ea\u8ffd\u52a0\u6642\u3082\u65e2\u5b58\u30b3\u30fc\u30c9\u5909\u66f4\u4e0d\u8981</li> </ol> <p></p>"},{"location":"clojure/17-video-rental-system/#9","title":"9. \u62e1\u5f35\u6027","text":""},{"location":"clojure/17-video-rental-system/#_9","title":"\u65b0\u3057\u3044\u30ab\u30c6\u30b4\u30ea\u306e\u8ffd\u52a0","text":"<pre><code>;; \u65b0\u3057\u3044\u30ab\u30c6\u30b4\u30ea: \u30d7\u30ec\u30df\u30a2\u30e0\n(defmethod pricing/determine-amount :premium\n  [r]\n  (* (rental/get-days r) 5.0))\n\n(defmethod pricing/determine-points :premium\n  [r]\n  (rental/get-days r))  ; \u65e5\u6570\u5206\u306e\u30dd\u30a4\u30f3\u30c8\n</code></pre>"},{"location":"clojure/17-video-rental-system/#_10","title":"\u65b0\u3057\u3044\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306e\u8ffd\u52a0","text":"<pre><code>;; JSON\u5f62\u5f0f\n(defmethod stmt/format-statement :json\n  [_ customer rentals]\n  (json/write-str (stmt/statement-data customer rentals)))\n</code></pre>"},{"location":"clojure/17-video-rental-system/#_11","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u3092\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: \u30ab\u30c6\u30b4\u30ea\u306b\u3088\u308b\u6599\u91d1\u8a08\u7b97\u306e\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1</li> <li>\u30c7\u30fc\u30bf\u3068\u51e6\u7406\u306e\u5206\u96e2: \u6620\u753b\u30c7\u30fc\u30bf\u3068\u8a08\u7b97\u30ed\u30b8\u30c3\u30af\u306e\u5206\u96e2</li> <li>\u30d5\u30a9\u30fc\u30de\u30c3\u30bf\u30fc\u30d1\u30bf\u30fc\u30f3: \u8907\u6570\u306e\u51fa\u529b\u5f62\u5f0f\u3078\u306e\u5bfe\u5fdc</li> <li>\u62e1\u5f35\u6027: \u65b0\u3057\u3044\u30ab\u30c6\u30b4\u30ea\u3084\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306e\u8ffd\u52a0\u304c\u5bb9\u6613</li> </ol>"},{"location":"clojure/17-video-rental-system/#_12","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part6/src/video_rental/</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part6/spec/video_rental/</code></li> </ul>"},{"location":"clojure/18-concurrency-system/","title":"\u7b2c18\u7ae0: \u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0","text":""},{"location":"clojure/18-concurrency-system/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Clojure \u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u4f7f\u3063\u305f\u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0\u3092\u5b66\u3073\u307e\u3059\u3002\u96fb\u8a71\u901a\u8a71\u30b7\u30b9\u30c6\u30e0\u3092\u72b6\u614b\u6a5f\u68b0\u30d1\u30bf\u30fc\u30f3\u3067\u5b9f\u88c5\u3057\u3001\u30a4\u30d9\u30f3\u30c8\u99c6\u52d5\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306e\u57fa\u790e\u3092\u7406\u89e3\u3057\u307e\u3059\u3002</p> <p>\u3053\u306e\u554f\u984c\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u306e\u6982\u5ff5\u3092\u5b66\u3073\u307e\u3059\uff1a</p> <ul> <li>Clojure \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306b\u3088\u308b\u975e\u540c\u671f\u72b6\u614b\u7ba1\u7406</li> <li>\u72b6\u614b\u6a5f\u68b0\u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5</li> <li>\u30a4\u30d9\u30f3\u30c8\u99c6\u52d5\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3</li> </ul>"},{"location":"clojure/18-concurrency-system/#1-clojure","title":"1. Clojure \u306e\u4e26\u884c\u51e6\u7406\u30e2\u30c7\u30eb","text":"<p>Clojure \u306f\u8907\u6570\u306e\u4e26\u884c\u51e6\u7406\u30d7\u30ea\u30df\u30c6\u30a3\u30d6\u3092\u63d0\u4f9b\u3057\u307e\u3059\uff1a</p> \u30d7\u30ea\u30df\u30c6\u30a3\u30d6 \u7279\u5fb4 \u7528\u9014 Atom \u540c\u671f\u7684\u3001\u5358\u4e00\u5024 \u7c21\u5358\u306a\u72b6\u614b\u7ba1\u7406 Ref \u540c\u671f\u7684\u3001\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3 \u5354\u8abf\u7684\u306a\u5909\u66f4 Agent \u975e\u540c\u671f\u7684 \u72ec\u7acb\u3057\u305f\u72b6\u614b\u5909\u66f4 <p></p>"},{"location":"clojure/18-concurrency-system/#2","title":"2. \u72b6\u614b\u6a5f\u68b0\u30d1\u30bf\u30fc\u30f3","text":""},{"location":"clojure/18-concurrency-system/#_2","title":"\u96fb\u8a71\u901a\u8a71\u306e\u72b6\u614b\u9077\u79fb","text":""},{"location":"clojure/18-concurrency-system/#_3","title":"\u72b6\u614b\u6a5f\u68b0\u306e\u5b9a\u7fa9","text":"<pre><code>(ns concurrency.state-machine)\n\n(def user-sm\n  \"\u30e6\u30fc\u30b6\u30fc\u72b6\u614b\u6a5f\u68b0\u306e\u5b9a\u7fa9\n   {\u73fe\u5728\u306e\u72b6\u614b {\u30a4\u30d9\u30f3\u30c8 [\u6b21\u306e\u72b6\u614b \u30a2\u30af\u30b7\u30e7\u30f3]}}\"\n  {:idle {:call [:calling :caller-off-hook]\n          :ring [:waiting-for-connection :callee-off-hook]\n          :disconnect [:idle nil]}\n   :calling {:dialtone [:dialing :dial]}\n   :dialing {:ringback [:waiting-for-connection nil]}\n   :waiting-for-connection {:connected [:talking :talk]}\n   :talking {:disconnect [:idle nil]}})\n</code></pre>"},{"location":"clojure/18-concurrency-system/#3","title":"3. \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306b\u3088\u308b\u5b9f\u88c5","text":""},{"location":"clojure/18-concurrency-system/#_4","title":"\u30e6\u30fc\u30b6\u30fc\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u4f5c\u6210","text":"<pre><code>(defn make-user-agent\n  \"\u30e6\u30fc\u30b6\u30fc\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u4f5c\u6210\"\n  [user-id]\n  (agent {:user-id user-id\n          :state :idle\n          :machine user-sm\n          :peer nil}))\n\n(defn get-state\n  \"\u73fe\u5728\u306e\u72b6\u614b\u3092\u53d6\u5f97\"\n  [user-agent]\n  (:state @user-agent))\n\n(defn get-user-id\n  \"\u30e6\u30fc\u30b6\u30fcID\u3092\u53d6\u5f97\"\n  [user-agent]\n  (:user-id @user-agent))\n</code></pre>"},{"location":"clojure/18-concurrency-system/#_5","title":"\u72b6\u614b\u9077\u79fb\u306e\u5b9f\u884c","text":"<pre><code>(defn transition\n  \"\u72b6\u614b\u9077\u79fb\u3092\u5b9f\u884c\"\n  [agent-state event event-data]\n  (let [{:keys [state machine user-id peer]} agent-state\n        result (get-in machine [state event])]\n    (if result\n      (let [[next-state action-key] result\n            action (get actions action-key)]\n        (when action\n          (action user-id (or (:peer event-data) peer \"unknown\")))\n        (assoc agent-state\n               :state next-state\n               :peer (or (:peer event-data) peer)))\n      (do\n        (println (str \"Invalid transition: \" state \" -&gt; \" event))\n        agent-state))))\n\n(defn send-event\n  \"\u30a4\u30d9\u30f3\u30c8\u3092\u9001\u4fe1\"\n  ([user-agent event]\n   (send-event user-agent event {}))\n  ([user-agent event event-data]\n   (send user-agent transition event event-data)))\n</code></pre>"},{"location":"clojure/18-concurrency-system/#4","title":"4. \u30a2\u30af\u30b7\u30e7\u30f3\u95a2\u6570","text":"<pre><code>(defn caller-off-hook\n  \"\u767a\u4fe1\u8005\u304c\u30aa\u30d5\u30d5\u30c3\u30af\uff08\u53d7\u8a71\u5668\u3092\u4e0a\u3052\u308b\uff09\"\n  [from-user to-user]\n  (println (str from-user \" picked up the phone to call \" to-user)))\n\n(defn callee-off-hook\n  \"\u7740\u4fe1\u8005\u304c\u30aa\u30d5\u30d5\u30c3\u30af\uff08\u96fb\u8a71\u306b\u51fa\u308b\uff09\"\n  [from-user to-user]\n  (println (str from-user \" answered the call from \" to-user)))\n\n(defn dial\n  \"\u30c0\u30a4\u30e4\u30eb\"\n  [from-user to-user]\n  (println (str from-user \" is dialing \" to-user)))\n\n(defn talk\n  \"\u901a\u8a71\u958b\u59cb\"\n  [from-user to-user]\n  (println (str from-user \" is now talking with \" to-user)))\n\n(def actions\n  {:caller-off-hook caller-off-hook\n   :callee-off-hook callee-off-hook\n   :dial dial\n   :talk talk})\n</code></pre>"},{"location":"clojure/18-concurrency-system/#5-api","title":"5. \u96fb\u8a71\u64cd\u4f5c\u306e\u9ad8\u30ec\u30d9\u30ebAPI","text":"<pre><code>(defn make-call\n  \"\u96fb\u8a71\u3092\u304b\u3051\u308b\"\n  [caller callee]\n  (let [callee-id (get-user-id callee)]\n    (send-event caller :call {:peer callee-id})\n    (send-event callee :ring {:peer (get-user-id caller)})))\n\n(defn answer-call\n  \"\u96fb\u8a71\u306b\u51fa\u308b\"\n  [caller callee]\n  (send-event caller :dialtone {})\n  (send-event caller :ringback {})\n  (send-event caller :connected {})\n  (send-event callee :connected {}))\n\n(defn hang-up\n  \"\u96fb\u8a71\u3092\u5207\u308b\"\n  [caller callee]\n  (send-event caller :disconnect {})\n  (send-event callee :disconnect {}))\n</code></pre>"},{"location":"clojure/18-concurrency-system/#6","title":"6. \u30a4\u30d9\u30f3\u30c8\u99c6\u52d5\u30b7\u30b9\u30c6\u30e0","text":""},{"location":"clojure/18-concurrency-system/#_6","title":"\u30a4\u30d9\u30f3\u30c8\u30d0\u30b9\u306e\u5b9f\u88c5","text":"<pre><code>(ns concurrency.event-system)\n\n(defn make-event-bus\n  \"\u30a4\u30d9\u30f3\u30c8\u30d0\u30b9\u3092\u4f5c\u6210\"\n  []\n  (agent {:subscribers {}\n          :event-log []}))\n\n(defn subscribe\n  \"\u30a4\u30d9\u30f3\u30c8\u3092\u8cfc\u8aad\"\n  [bus event-type handler]\n  (send bus\n        (fn [state]\n          (update-in state [:subscribers event-type]\n                     (fnil conj []) handler))))\n\n(defn publish\n  \"\u30a4\u30d9\u30f3\u30c8\u3092\u767a\u884c\"\n  [bus event-type data]\n  (send bus\n        (fn [state]\n          (let [handlers (get-in state [:subscribers event-type] [])\n                event {:type event-type\n                       :data data\n                       :timestamp (System/currentTimeMillis)}]\n            ;; \u30cf\u30f3\u30c9\u30e9\u3092\u5b9f\u884c\n            (doseq [handler handlers]\n              (try\n                (handler event)\n                (catch Exception e\n                  (println \"Handler error:\" (.getMessage e)))))\n            ;; \u30a4\u30d9\u30f3\u30c8\u30ed\u30b0\u306b\u8ffd\u52a0\n            (update state :event-log conj event)))))\n</code></pre>"},{"location":"clojure/18-concurrency-system/#7","title":"7. \u4f7f\u7528\u4f8b","text":""},{"location":"clojure/18-concurrency-system/#_7","title":"\u96fb\u8a71\u901a\u8a71\u306e\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3","text":"<pre><code>(require '[concurrency.state-machine :as sm])\n\n;; \u30e6\u30fc\u30b6\u30fc\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u4f5c\u6210\n(def alice (sm/make-user-agent \"Alice\"))\n(def bob (sm/make-user-agent \"Bob\"))\n\n;; \u521d\u671f\u72b6\u614b\u306e\u78ba\u8a8d\n(sm/get-state alice) ;; =&gt; :idle\n(sm/get-state bob)   ;; =&gt; :idle\n\n;; Alice \u304c Bob \u306b\u96fb\u8a71\u3092\u304b\u3051\u308b\n(sm/make-call alice bob)\n(await alice bob)\n;; Alice picked up the phone to call Bob\n;; Bob answered the call from Alice\n\n(sm/get-state alice) ;; =&gt; :calling\n(sm/get-state bob)   ;; =&gt; :waiting-for-connection\n\n;; Bob \u304c\u96fb\u8a71\u306b\u51fa\u308b\n(sm/answer-call alice bob)\n(await alice bob)\n;; Alice is dialing Bob\n;; Alice is now talking with Bob\n;; Bob is now talking with Alice\n\n(sm/get-state alice) ;; =&gt; :talking\n(sm/get-state bob)   ;; =&gt; :talking\n\n;; \u96fb\u8a71\u3092\u5207\u308b\n(sm/hang-up alice bob)\n(await alice bob)\n\n(sm/get-state alice) ;; =&gt; :idle\n(sm/get-state bob)   ;; =&gt; :idle\n</code></pre>"},{"location":"clojure/18-concurrency-system/#_8","title":"\u30a4\u30d9\u30f3\u30c8\u30b7\u30b9\u30c6\u30e0\u306e\u4f7f\u7528","text":"<pre><code>(require '[concurrency.event-system :as es])\n\n;; \u30a4\u30d9\u30f3\u30c8\u30d0\u30b9\u3092\u4f5c\u6210\n(def bus (es/make-event-bus))\n\n;; \u30cf\u30f3\u30c9\u30e9\u3092\u767b\u9332\n(es/subscribe bus :user-logged-in\n              (fn [event]\n                (println \"User logged in:\" (:data event))))\n\n(es/subscribe bus :user-logged-in\n              (fn [event]\n                (println \"Sending welcome email to:\" (:data event))))\n\n;; \u30a4\u30d9\u30f3\u30c8\u3092\u767a\u884c\n(es/publish bus :user-logged-in {:user-id \"U001\" :name \"Alice\"})\n(await bus)\n;; User logged in: {:user-id \"U001\", :name \"Alice\"}\n;; Sending welcome email to: {:user-id \"U001\", :name \"Alice\"}\n\n;; \u30a4\u30d9\u30f3\u30c8\u30ed\u30b0\u306e\u78ba\u8a8d\n(es/get-event-log bus)\n;; [{:type :user-logged-in, :data {...}, :timestamp 1234567890}]\n</code></pre>"},{"location":"clojure/18-concurrency-system/#8","title":"8. \u4e26\u884c\u51e6\u7406\u306e\u7279\u5fb4","text":""},{"location":"clojure/18-concurrency-system/#_9","title":"\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u5229\u70b9","text":"<ol> <li>\u975e\u540c\u671f\u51e6\u7406: <code>send</code> \u306f\u5373\u5ea7\u306b\u623b\u308a\u3001\u51e6\u7406\u306f\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u5b9f\u884c</li> <li>\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba: \u540c\u4e00\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3078\u306e\u66f4\u65b0\u306f\u9806\u5e8f\u4fdd\u8a3c</li> <li>\u30a8\u30e9\u30fc\u51e6\u7406: \u30a8\u30e9\u30fc\u306f\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u5185\u306b\u9589\u3058\u8fbc\u3081\u3089\u308c\u308b</li> </ol>"},{"location":"clojure/18-concurrency-system/#_10","title":"\u6ce8\u610f\u70b9","text":"<pre><code>;; \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u51e6\u7406\u5b8c\u4e86\u3092\u5f85\u3064\u5834\u5408\n(await agent1 agent2)\n\n;; \u307e\u305f\u306f\n(Thread/sleep 50)\n\n;; \u30a8\u30e9\u30fc\u72b6\u614b\u306e\u78ba\u8a8d\n(agent-error user-agent)\n\n;; \u30a8\u30e9\u30fc\u72b6\u614b\u306e\u30ea\u30bb\u30c3\u30c8\n(restart-agent user-agent initial-state)\n</code></pre>"},{"location":"clojure/18-concurrency-system/#9","title":"9. \u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"clojure/18-concurrency-system/#_11","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u3092\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>Clojure \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8: \u975e\u540c\u671f\u72b6\u614b\u7ba1\u7406</li> <li>\u72b6\u614b\u6a5f\u68b0\u30d1\u30bf\u30fc\u30f3: \u5ba3\u8a00\u7684\u306a\u72b6\u614b\u9077\u79fb\u5b9a\u7fa9</li> <li>\u30a4\u30d9\u30f3\u30c8\u99c6\u52d5\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3: \u758e\u7d50\u5408\u306a\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u9593\u901a\u4fe1</li> <li>\u4e26\u884c\u51e6\u7406\u306e\u5b89\u5168\u6027: \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306b\u3088\u308b\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba</li> </ol>"},{"location":"clojure/18-concurrency-system/#_12","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part6/src/concurrency/</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part6/spec/concurrency/</code></li> </ul>"},{"location":"clojure/19-wator-simulation/","title":"\u7b2c19\u7ae0: Wa-Tor \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3","text":""},{"location":"clojure/19-wator-simulation/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Wa-Tor\uff08Water Torus\uff09\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u901a\u3058\u3066\u3001\u30bb\u30eb\u30aa\u30fc\u30c8\u30de\u30c8\u30f3\u3068\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u3063\u305f\u6355\u98df\u8005-\u88ab\u98df\u8005\u30e2\u30c7\u30eb\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p> <p>Wa-Tor \u306f1984\u5e74\u306b A.K. Dewdney \u304c Scientific American \u3067\u7d39\u4ecb\u3057\u305f\u53e4\u5178\u7684\u306a\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3067\u3001\u9b5a\uff08\u88ab\u98df\u8005\uff09\u3068\u30b5\u30e1\uff08\u6355\u98df\u8005\uff09\u306e\u751f\u614b\u7cfb\u3092\u30e2\u30c7\u30eb\u5316\u3057\u307e\u3059\u3002</p> <p>\u3053\u306e\u554f\u984c\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u306e\u6982\u5ff5\u3092\u5b66\u3073\u307e\u3059\uff1a</p> <ul> <li>\u30bb\u30eb\u30aa\u30fc\u30c8\u30de\u30c8\u30f3\u306e\u5b9f\u88c5</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u591a\u614b\u7684\u306a\u632f\u308b\u821e\u3044</li> <li>\u30c8\u30fc\u30e9\u30b9\u578b\u30ef\u30fc\u30eb\u30c9\u306e\u5ea7\u6a19\u8a08\u7b97</li> <li>\u7e41\u6b96\u3068\u6355\u98df\u306e\u30eb\u30fc\u30eb\u5b9f\u88c5</li> </ul>"},{"location":"clojure/19-wator-simulation/#1-wa-tor","title":"1. Wa-Tor \u306e\u4e16\u754c","text":""},{"location":"clojure/19-wator-simulation/#_2","title":"\u30c8\u30fc\u30e9\u30b9\u578b\u30ef\u30fc\u30eb\u30c9","text":"<p>Wa-Tor \u306e\u4e16\u754c\u306f\u30c8\u30fc\u30e9\u30b9\uff08\u30c9\u30fc\u30ca\u30c4\u578b\uff09\u3067\u3059\u3002\u7aef\u306b\u5230\u9054\u3059\u308b\u3068\u53cd\u5bfe\u5074\u306b\u51fa\u73fe\u3057\u307e\u3059\u3002</p> <p></p>"},{"location":"clojure/19-wator-simulation/#_3","title":"\u30bb\u30eb\u306e\u7a2e\u985e","text":"<ul> <li>\u6c34\uff08Water\uff09: \u7a7a\u306e\u30bb\u30eb</li> <li>\u9b5a\uff08Fish\uff09: \u88ab\u98df\u8005\u3001\u79fb\u52d5\u3068\u7e41\u6b96\u306e\u307f</li> <li>\u30b5\u30e1\uff08Shark\uff09: \u6355\u98df\u8005\u3001\u79fb\u52d5\u3001\u7e41\u6b96\u3001\u6355\u98df</li> </ul>"},{"location":"clojure/19-wator-simulation/#2","title":"2. \u6bb5\u968e\u7684\u306a\u5b9f\u88c5","text":""},{"location":"clojure/19-wator-simulation/#phase-1","title":"Phase 1: \u57fa\u672c\u69cb\u9020","text":"<p>\u307e\u305a\u3001\u30bb\u30eb\u3068\u30ef\u30fc\u30eb\u30c9\u306e\u57fa\u672c\u69cb\u9020\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002</p> <pre><code>(ns wator.cell)\n\n(defmulti tick\n  \"\u30bb\u30eb\u306e1\u30b9\u30c6\u30c3\u30d7\u3092\u5b9f\u884c\"\n  (fn [cell &amp; _args] (::type cell)))\n\n(defmulti display\n  \"\u30bb\u30eb\u306e\u8868\u793a\u6587\u5b57\u3092\u53d6\u5f97\"\n  ::type)\n</code></pre>"},{"location":"clojure/19-wator-simulation/#phase-2","title":"Phase 2: \u6c34\u30bb\u30eb","text":"<p>\u6700\u3082\u30b7\u30f3\u30d7\u30eb\u306a\u30bb\u30eb\u3067\u3042\u308b\u6c34\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002</p> <pre><code>(ns wator.water\n  (:require [wator.cell :as cell]))\n\n(defn make\n  \"\u6c34\u30bb\u30eb\u3092\u4f5c\u6210\"\n  []\n  {::cell/type ::water})\n\n(defn is?\n  \"\u6c34\u30bb\u30eb\u304b\u3069\u3046\u304b\u5224\u5b9a\"\n  [cell]\n  (= ::water (::cell/type cell)))\n\n(defmethod cell/tick ::water\n  [_water _loc _world]\n  nil)\n\n(defmethod cell/display ::water\n  [_water]\n  \".\")\n</code></pre>"},{"location":"clojure/19-wator-simulation/#phase-3","title":"Phase 3: \u30ef\u30fc\u30eb\u30c9\u69cb\u9020","text":"<pre><code>(ns wator.world\n  (:require [wator.cell :as cell]\n            [wator.water :as water]))\n\n(declare neighbors get-cell)\n\n(defn make\n  \"\u30ef\u30fc\u30eb\u30c9\u3092\u4f5c\u6210\"\n  [width height]\n  (let [locs (for [x (range width) y (range height)] [x y])\n        cells (into {} (map (fn [loc] [loc (water/make)]) locs))]\n    {:type ::world\n     :width width\n     :height height\n     :cells cells\n     :neighbors-fn neighbors\n     :get-cell-fn get-cell}))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#phase-4","title":"Phase 4: \u5ea7\u6a19\u306e\u30e9\u30c3\u30d7","text":"<pre><code>(defn wrap\n  \"\u5ea7\u6a19\u3092\u30c8\u30fc\u30e9\u30b9\u4e0a\u3067\u30e9\u30c3\u30d7\"\n  [world [x y]]\n  (let [{:keys [width height]} world]\n    [(mod x width) (mod y height)]))\n\n(defn neighbors\n  \"\u96a3\u63a5\u30bb\u30eb\u306e\u5ea7\u6a19\u3092\u53d6\u5f97\uff088\u65b9\u5411\uff09\"\n  [world [x y]]\n  (let [deltas (for [dx [-1 0 1] dy [-1 0 1]\n                     :when (not (and (= dx 0) (= dy 0)))]\n                 [dx dy])]\n    (map (fn [[dx dy]]\n           (wrap world [(+ x dx) (+ y dy)]))\n         deltas)))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#3","title":"3. \u52d5\u7269\u306e\u57fa\u672c\u6a5f\u80fd","text":""},{"location":"clojure/19-wator-simulation/#phase-5","title":"Phase 5: \u52d5\u7269\u306e\u5171\u901a\u6a5f\u80fd","text":"<pre><code>(ns wator.animal\n  (:require [wator.cell :as cell]\n            [wator.water :as water]))\n\n(defmulti move (fn [animal &amp; _args] (::cell/type animal)))\n(defmulti reproduce (fn [animal &amp; _args] (::cell/type animal)))\n(defmulti make-child ::cell/type)\n(defmulti get-reproduction-age ::cell/type)\n\n(defn make\n  \"\u52d5\u7269\u306e\u57fa\u672c\u5c5e\u6027\u3092\u4f5c\u6210\"\n  []\n  {::age 0})\n\n(defn age [animal]\n  (::age animal))\n\n(defn increment-age [animal]\n  (update animal ::age inc))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#phase-6","title":"Phase 6: \u79fb\u52d5\u30ed\u30b8\u30c3\u30af","text":"<pre><code>(defn find-empty-neighbors\n  \"\u96a3\u63a5\u3059\u308b\u7a7a\u306e\u30bb\u30eb\u3092\u691c\u7d22\"\n  [world loc]\n  (let [neighbors ((:neighbors-fn world) world loc)]\n    (filter #(water/is? ((:get-cell-fn world) world %)) neighbors)))\n\n(defn do-move\n  \"\u52d5\u7269\u3092\u7a7a\u306e\u30bb\u30eb\u306b\u79fb\u52d5\"\n  [animal loc world]\n  (let [destinations (find-empty-neighbors world loc)]\n    (if (empty? destinations)\n      [nil {loc animal}]\n      (let [new-loc (rand-nth destinations)]\n        [{loc (water/make)} {new-loc animal}]))))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#phase-7","title":"Phase 7: \u7e41\u6b96\u30ed\u30b8\u30c3\u30af","text":"<pre><code>(defn do-reproduce\n  \"\u52d5\u7269\u304c\u7e41\u6b96\u3092\u8a66\u307f\u308b\"\n  [animal loc world]\n  (if (&gt;= (age animal) (get-reproduction-age animal))\n    (let [birth-places (find-empty-neighbors world loc)]\n      (if (empty? birth-places)\n        nil\n        (let [new-loc (rand-nth birth-places)]\n          [{loc (set-age animal 0)}\n           {new-loc (make-child animal)}])))\n    nil))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#4","title":"4. \u9b5a\u306e\u5b9f\u88c5","text":""},{"location":"clojure/19-wator-simulation/#phase-8","title":"Phase 8: \u9b5a\u30af\u30e9\u30b9","text":"<pre><code>(ns wator.fish\n  (:require [wator.cell :as cell]\n            [wator.animal :as animal]\n            [wator.config :as config]))\n\n(defn is? [cell]\n  (= ::fish (::cell/type cell)))\n\n(defn make []\n  (merge {::cell/type ::fish}\n         (animal/make)))\n\n(defmethod animal/make-child ::fish [_fish]\n  (make))\n\n(defmethod animal/get-reproduction-age ::fish [_fish]\n  config/fish-reproduction-age)\n\n(defmethod animal/move ::fish [fish loc world]\n  (animal/do-move fish loc world))\n\n(defmethod animal/reproduce ::fish [fish loc world]\n  (animal/do-reproduce fish loc world))\n\n(defmethod cell/tick ::fish [fish loc world]\n  (animal/tick fish loc world))\n\n(defmethod cell/display ::fish [_fish]\n  \"f\")\n</code></pre>"},{"location":"clojure/19-wator-simulation/#5","title":"5. \u30b5\u30e1\u306e\u5b9f\u88c5","text":""},{"location":"clojure/19-wator-simulation/#phase-9","title":"Phase 9: \u30b5\u30e1\u306e\u57fa\u672c\u69cb\u9020","text":"<pre><code>(ns wator.shark\n  (:require [wator.cell :as cell]\n            [wator.animal :as animal]\n            [wator.water :as water]\n            [wator.fish :as fish]\n            [wator.config :as config]))\n\n(defn is? [cell]\n  (= ::shark (::cell/type cell)))\n\n(defn make []\n  (merge {::cell/type ::shark\n          ::health config/shark-starting-health}\n         (animal/make)))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#phase-10","title":"Phase 10: \u30b5\u30e1\u306e\u4f53\u529b\u7ba1\u7406","text":"<pre><code>(defn health [shark]\n  (::health shark))\n\n(defn set-health [shark new-health]\n  (assoc shark ::health new-health))\n\n(defn decrement-health [shark]\n  (update shark ::health dec))\n\n(defn feed [shark]\n  (let [new-health (min config/shark-max-health\n                        (+ (health shark) config/shark-eating-health))]\n    (set-health shark new-health)))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#phase-11","title":"Phase 11: \u30b5\u30e1\u306e\u6355\u98df","text":"<pre><code>(defn find-fish-neighbors\n  \"\u96a3\u63a5\u3059\u308b\u9b5a\u3092\u691c\u7d22\"\n  [world loc]\n  (let [neighbors ((:neighbors-fn world) world loc)]\n    (filter #(fish/is? ((:get-cell-fn world) world %)) neighbors)))\n\n(defn eat\n  \"\u9b5a\u3092\u98df\u3079\u308b\"\n  [shark loc world]\n  (let [fishy-neighbors (find-fish-neighbors world loc)]\n    (if (empty? fishy-neighbors)\n      nil\n      (let [target (rand-nth fishy-neighbors)]\n        [{loc (water/make)}\n         {target (feed shark)}]))))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#phase-12","title":"Phase 12: \u30b5\u30e1\u306e\u30c6\u30a3\u30c3\u30af\u51e6\u7406","text":"<pre><code>(defmethod cell/tick ::shark [shark loc world]\n  (if (&lt;= (health shark) 1)\n    ;; \u4f53\u529b\u304c\u5c3d\u304d\u305f\u3089\u6b7b\u4ea1\n    [nil {loc (water/make)}]\n    (let [aged-shark (-&gt; shark\n                         animal/increment-age\n                         decrement-health)]\n      ;; \u512a\u5148\u9806\u4f4d: \u7e41\u6b96 &gt; \u6355\u98df &gt; \u79fb\u52d5\n      (or (animal/reproduce aged-shark loc world)\n          (eat aged-shark loc world)\n          (animal/move aged-shark loc world)))))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#6","title":"6. \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u306e\u5b9f\u884c","text":""},{"location":"clojure/19-wator-simulation/#phase-13","title":"Phase 13: \u30ef\u30fc\u30eb\u30c9\u306e\u66f4\u65b0","text":"<pre><code>(defn tick-cell\n  \"1\u3064\u306e\u30bb\u30eb\u3092\u66f4\u65b0\"\n  [world loc]\n  (let [cell (get-cell world loc)]\n    (cell/tick cell loc world)))\n\n(defn tick\n  \"\u30ef\u30fc\u30eb\u30c9\u306e1\u30b9\u30c6\u30c3\u30d7\u3092\u5b9f\u884c\"\n  [world]\n  (let [locs (shuffle (keys (:cells world)))\n        changes (map #(tick-cell world %) locs)]\n    (apply-changes world (flatten (remove nil? changes)))))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#7","title":"7. \u8a2d\u5b9a\u30d1\u30e9\u30e1\u30fc\u30bf","text":"<pre><code>(ns wator.config)\n\n;; \u9b5a\u306e\u8a2d\u5b9a\n(def fish-reproduction-age 6)\n\n;; \u30b5\u30e1\u306e\u8a2d\u5b9a\n(def shark-reproduction-age 5)\n(def shark-reproduction-health 8)\n(def shark-starting-health 5)\n(def shark-eating-health 5)\n(def shark-max-health 10)\n</code></pre> \u30d1\u30e9\u30e1\u30fc\u30bf \u8aac\u660e \u30c7\u30d5\u30a9\u30eb\u30c8\u5024 fish-reproduction-age \u9b5a\u306e\u7e41\u6b96\u53ef\u80fd\u5e74\u9f62 6 shark-reproduction-age \u30b5\u30e1\u306e\u7e41\u6b96\u53ef\u80fd\u5e74\u9f62 5 shark-starting-health \u30b5\u30e1\u306e\u521d\u671f\u4f53\u529b 5 shark-eating-health \u6355\u98df\u6642\u306e\u4f53\u529b\u56de\u5fa9\u91cf 5 shark-max-health \u30b5\u30e1\u306e\u6700\u5927\u4f53\u529b 10 shark-reproduction-health \u7e41\u6b96\u306b\u5fc5\u8981\u306a\u4f53\u529b 8"},{"location":"clojure/19-wator-simulation/#8","title":"8. \u4f7f\u7528\u4f8b","text":"<pre><code>(require '[wator.world :as world])\n(require '[wator.fish :as fish])\n(require '[wator.shark :as shark])\n\n;; 10x10 \u306e\u30ef\u30fc\u30eb\u30c9\u3092\u4f5c\u6210\n(def w (world/make 10 10))\n\n;; \u9b5a20\u5339\u3001\u30b5\u30e15\u5339\u3092\u30e9\u30f3\u30c0\u30e0\u914d\u7f6e\n(def w (world/populate-random w 20 5))\n\n;; \u7d71\u8a08\u60c5\u5831\n(world/statistics w)\n;; =&gt; {:fish 20, :sharks 5, :water 75, :total 100}\n\n;; \u30ef\u30fc\u30eb\u30c9\u3092\u8868\u793a\n(println (world/display w))\n;; ..f.......\n;; .S....f...\n;; ..f.......\n;; ...f..f...\n;; ....S.....\n;; .f........\n;; ......f...\n;; ..f...S...\n;; ....f.....\n;; .......f..\n\n;; 1\u30b9\u30c6\u30c3\u30d7\u5b9f\u884c\n(def w' (world/tick w))\n\n;; 100\u30b9\u30c6\u30c3\u30d7\u5b9f\u884c\n(def w-100 (nth (iterate world/tick w) 100))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#9","title":"9. \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u306e\u30c0\u30a4\u30ca\u30df\u30af\u30b9","text":""},{"location":"clojure/19-wator-simulation/#10-gui-quil","title":"10. GUI \u3068\u306e\u7d71\u5408\uff08Quil\uff09","text":""},{"location":"clojure/19-wator-simulation/#quil","title":"Quil \u30e9\u30a4\u30d6\u30e9\u30ea","text":"<p>Quil \u306f Processing \u3092 Clojure \u304b\u3089\u5229\u7528\u3059\u308b\u305f\u3081\u306e\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059\u3002\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u8996\u899a\u5316\u3067\u304d\u307e\u3059\u3002</p> <pre><code>(ns wator-gui.main\n  (:require [quil.core :as q]\n            [quil.middleware :as m]\n            [wator.world :as world]\n            [wator.fish :as fish]\n            [wator.shark :as shark]\n            [wator.water :as water]))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#_4","title":"\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u95a2\u6570","text":"<pre><code>(def cell-size 10)\n(def world-width 60)\n(def world-height 40)\n\n(defn setup []\n  (q/frame-rate 10)\n  (q/color-mode :rgb)\n  ;; \u521d\u671f\u30ef\u30fc\u30eb\u30c9\u3092\u4f5c\u6210\n  (-&gt; (world/make world-width world-height)\n      (world/populate-random 200 30)))\n\n(defn draw-state [world]\n  (q/background 0 100 200)  ; \u9752\u3044\u6d77\n  (doseq [[[x y] cell] (:cells world)]\n    (cond\n      (fish/is? cell)\n      (do\n        (q/fill 0 255 0)  ; \u7dd1: \u9b5a\n        (q/rect (* x cell-size) (* y cell-size) cell-size cell-size))\n\n      (shark/is? cell)\n      (do\n        (q/fill 255 0 0)  ; \u8d64: \u30b5\u30e1\n        (q/rect (* x cell-size) (* y cell-size) cell-size cell-size)))))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#_5","title":"\u66f4\u65b0\u95a2\u6570","text":"<pre><code>(defn update-state [world]\n  (world/tick world))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#_6","title":"\u30e1\u30a4\u30f3\u95a2\u6570","text":"<pre><code>(defn -main []\n  (q/defsketch wator-simulation\n    :title \"Wa-Tor Simulation\"\n    :size [(* world-width cell-size) (* world-height cell-size)]\n    :setup setup\n    :update update-state\n    :draw draw-state\n    :middleware [m/fun-mode]))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#_7","title":"\u7d71\u8a08\u60c5\u5831\u306e\u8868\u793a","text":"<pre><code>(defn draw-stats [world]\n  (let [stats (world/statistics world)]\n    (q/fill 255)\n    (q/text-size 14)\n    (q/text (str \"Fish: \" (:fish stats)) 10 20)\n    (q/text (str \"Sharks: \" (:sharks stats)) 10 40)\n    (q/text (str \"Generation: \" (:generation world 0)) 10 60)))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#_8","title":"\u30ad\u30fc\u30dc\u30fc\u30c9\u30a4\u30f3\u30bf\u30e9\u30af\u30b7\u30e7\u30f3","text":"<pre><code>(defn key-pressed [world event]\n  (case (:key event)\n    :r (-&gt; (world/make world-width world-height)\n           (world/populate-random 200 30))  ; \u30ea\u30bb\u30c3\u30c8\n    :p (assoc world :paused (not (:paused world)))  ; \u4e00\u6642\u505c\u6b62\n    :+ (update world :speed inc)  ; \u901f\u5ea6\u30a2\u30c3\u30d7\n    :- (update world :speed dec)  ; \u901f\u5ea6\u30c0\u30a6\u30f3\n    world))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#gui","title":"\u95a2\u6570\u578b GUI \u306e\u7279\u5fb4","text":"<p>Quil \u306e <code>fun-mode</code> \u306f\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u539f\u5247\u306b\u5f93\u3044\u307e\u3059\uff1a</p> <ol> <li>\u72b6\u614b\u306e\u4e0d\u5909\u6027: \u5404\u30d5\u30ec\u30fc\u30e0\u3067\u65b0\u3057\u3044\u72b6\u614b\u3092\u8fd4\u3059</li> <li>\u7d14\u7c8b\u306a\u66f4\u65b0\u95a2\u6570: \u526f\u4f5c\u7528\u306a\u3057\u3067\u72b6\u614b\u3092\u5909\u63db</li> <li>\u63cf\u753b\u3068\u72b6\u614b\u306e\u5206\u96e2: <code>update</code> \u3068 <code>draw</code> \u306f\u72ec\u7acb</li> </ol> <pre><code>;; \u72b6\u614b\u306f\u5e38\u306b\u65b0\u3057\u3044\u30de\u30c3\u30d7\u3068\u3057\u3066\u8fd4\u3055\u308c\u308b\n(defn update-state [state]\n  (if (:paused state)\n    state\n    (-&gt; state\n        (update :world world/tick)\n        (update :generation inc))))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#11","title":"11. \u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1\u306e\u7279\u5fb4","text":""},{"location":"clojure/19-wator-simulation/#_9","title":"\u4e0d\u5909\u6027","text":"<p>\u3059\u3079\u3066\u306e\u72b6\u614b\u66f4\u65b0\u306f\u65b0\u3057\u3044\u30ef\u30fc\u30eb\u30c9\u3092\u8fd4\u3057\u307e\u3059\u3002</p> <pre><code>;; \u5143\u306e\u30ef\u30fc\u30eb\u30c9\u306f\u5909\u66f4\u3055\u308c\u306a\u3044\n(def w1 (world/make 5 5))\n(def w2 (world/tick w1))\n\n;; w1 \u3068 w2 \u306f\u72ec\u7acb\n(= w1 w2) ;; =&gt; false\n</code></pre>"},{"location":"clojure/19-wator-simulation/#_10","title":"\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u62e1\u5f35\u6027","text":"<p>\u65b0\u3057\u3044\u30bb\u30eb\u30bf\u30a4\u30d7\u306e\u8ffd\u52a0\u304c\u5bb9\u6613\u3067\u3059\u3002</p> <pre><code>;; \u65b0\u3057\u3044\u30bb\u30eb\u30bf\u30a4\u30d7: \u6d77\u85fb\n(defmethod cell/tick ::seaweed\n  [seaweed loc world]\n  ;; \u6d77\u85fb\u306e\u30c6\u30a3\u30c3\u30af\u51e6\u7406\n  ...)\n\n(defmethod cell/display ::seaweed\n  [_seaweed]\n  \"~\")\n</code></pre>"},{"location":"clojure/19-wator-simulation/#_11","title":"\u30c6\u30b9\u30c8\u5bb9\u6613\u6027","text":"<p>\u7d14\u7c8b\u95a2\u6570\u3067\u3042\u308b\u305f\u3081\u3001\u30c6\u30b9\u30c8\u304c\u7c21\u5358\u3067\u3059\u3002</p> <pre><code>(describe \"\u9b5a\"\n  (it \"\u7e41\u6b96\u53ef\u80fd\u5e74\u9f62\u306b\u9054\u3057\u305f\u3089\u7e41\u6b96\u3059\u308b\"\n    (let [old-fish (-&gt; (fish/make)\n                       (animal/set-age 6))\n          world (-&gt; (world/make 3 3)\n                    (world/set-cell [1 1] old-fish))]\n      ;; \u30c6\u30b9\u30c8\u30ed\u30b8\u30c3\u30af\n      )))\n</code></pre>"},{"location":"clojure/19-wator-simulation/#_12","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Wa-Tor \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u3092\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30bb\u30eb\u30aa\u30fc\u30c8\u30de\u30c8\u30f3: \u30b0\u30ea\u30c3\u30c9\u30d9\u30fc\u30b9\u306e\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: \u30bb\u30eb\u30bf\u30a4\u30d7\u306b\u3088\u308b\u591a\u614b\u7684\u306a\u632f\u308b\u821e\u3044</li> <li>\u30c8\u30fc\u30e9\u30b9\u578b\u30ef\u30fc\u30eb\u30c9: \u7aef\u306e\u30e9\u30c3\u30d7\u51e6\u7406</li> <li>\u6355\u98df\u8005-\u88ab\u98df\u8005\u30e2\u30c7\u30eb: \u7e41\u6b96\u3001\u6355\u98df\u3001\u9913\u6b7b\u306e\u30eb\u30fc\u30eb</li> <li>\u6bb5\u968e\u7684\u306a\u5b9f\u88c5: Phase 1-13 \u3067\u306e\u6f38\u9032\u7684\u306a\u958b\u767a</li> <li>GUI \u3068\u306e\u7d71\u5408: Quil \u306b\u3088\u308b\u8996\u899a\u5316\u3068\u95a2\u6570\u578b GUI \u30d1\u30bf\u30fc\u30f3</li> </ol>"},{"location":"clojure/19-wator-simulation/#_13","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/clojure/part6/src/wator/</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/clojure/part6/spec/wator/</code></li> </ul>"},{"location":"clojure/19-wator-simulation/#6_1","title":"\u7b2c6\u90e8\u306e\u307e\u3068\u3081","text":"<p>\u7b2c6\u90e8\u3067\u306f\u30015\u3064\u306e\u30b1\u30fc\u30b9\u30b9\u30bf\u30c7\u30a3\u3092\u901a\u3058\u3066\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u5b9f\u8df5\u7684\u306a\u5fdc\u7528\u3092\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ul> <li>\u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b: \u7121\u9650\u30b7\u30fc\u30b1\u30f3\u30b9\u3068\u96c6\u5408\u6f14\u7b97</li> <li>\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0: \u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30ea\u30f3\u30b0\u3068\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9</li> <li>\u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0: \u30dd\u30ea\u30b7\u30fc\u30d1\u30bf\u30fc\u30f3\u3068\u30d5\u30a9\u30fc\u30de\u30c3\u30bf\u30fc</li> <li>\u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0: \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3068\u30a4\u30d9\u30f3\u30c8\u99c6\u52d5</li> <li>Wa-Tor \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3: \u30bb\u30eb\u30aa\u30fc\u30c8\u30de\u30c8\u30f3\u3068\u591a\u614b\u6027</li> </ul> <p>\u3053\u308c\u3089\u306e\u30b1\u30fc\u30b9\u30b9\u30bf\u30c7\u30a3\u3092\u901a\u3058\u3066\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u304c\u5b9f\u4e16\u754c\u306e\u554f\u984c\u306b\u5bfe\u3057\u3066\u3069\u306e\u3088\u3046\u306b\u9069\u7528\u3067\u304d\u308b\u304b\u3092\u7406\u89e3\u3057\u307e\u3057\u305f\u3002</p>"},{"location":"clojure/20-pattern-interactions/","title":"\u7b2c20\u7ae0: \u30d1\u30bf\u30fc\u30f3\u9593\u306e\u76f8\u4e92\u4f5c\u7528","text":""},{"location":"clojure/20-pattern-interactions/#1","title":"1. \u306f\u3058\u3081\u306b","text":"<p>\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u306f\u5358\u72ec\u3067\u4f7f\u7528\u3055\u308c\u308b\u3053\u3068\u3082\u3042\u308a\u307e\u3059\u304c\u3001\u5b9f\u969b\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u306f\u8907\u6570\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u4e00\u822c\u7684\u3067\u3059\u3002\u672c\u7ae0\u3067\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u304a\u3051\u308b\u30d1\u30bf\u30fc\u30f3\u306e\u7d44\u307f\u5408\u308f\u305b\u65b9\u3068\u3001\u305d\u306e\u76f8\u4e57\u52b9\u679c\u306b\u3064\u3044\u3066\u89e3\u8aac\u3057\u307e\u3059\u3002</p>"},{"location":"clojure/20-pattern-interactions/#_1","title":"\u5b66\u7fd2\u76ee\u6a19","text":"<ul> <li>Composite \u3068 Decorator \u30d1\u30bf\u30fc\u30f3\u306e\u7d44\u307f\u5408\u308f\u305b\u3092\u7406\u89e3\u3059\u308b</li> <li>Command \u3068 Observer \u30d1\u30bf\u30fc\u30f3\u306e\u9023\u643a\u3092\u5b9f\u88c5\u3059\u308b</li> <li>\u8907\u5408\u7684\u306a\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08\u306e\u30a2\u30d7\u30ed\u30fc\u30c1\u3092\u5b66\u3076</li> </ul>"},{"location":"clojure/20-pattern-interactions/#2-composite-decorator","title":"2. Composite + Decorator \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"clojure/20-pattern-interactions/#21","title":"2.1 \u57fa\u672c\u6982\u5ff5","text":"<p>Composite \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u6728\u69cb\u9020\u3067\u8868\u73fe\u3057\u3001\u500b\u5225\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u8907\u5408\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u540c\u4e00\u8996\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002</p> <p>Decorator \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u52d5\u7684\u306b\u6a5f\u80fd\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002</p> <p>\u3053\u308c\u3089\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u3053\u3068\u3067\u3001\u8907\u5408\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u5bfe\u3057\u3066\u3082\u88c5\u98fe\u3092\u9069\u7528\u3067\u304d\u307e\u3059\u3002</p> <p></p>"},{"location":"clojure/20-pattern-interactions/#22","title":"2.2 \u57fa\u672c\u56f3\u5f62\u306e\u5b9f\u88c5","text":"<pre><code>(ns pattern-interactions.shape\n  \"\u56f3\u5f62\u306e\u57fa\u672c\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9 - Composite \u30d1\u30bf\u30fc\u30f3\u306e\u57fa\u76e4\")\n\n;; \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u56f3\u5f62\u64cd\u4f5c\n(defmulti move \"\u56f3\u5f62\u3092\u79fb\u52d5\" :type)\n(defmulti scale \"\u56f3\u5f62\u3092\u62e1\u5927/\u7e2e\u5c0f\" :type)\n(defmulti draw \"\u56f3\u5f62\u3092\u63cf\u753b\" :type)\n(defmulti area \"\u56f3\u5f62\u306e\u9762\u7a4d\u3092\u8a08\u7b97\" :type)\n\n;; \u5186\n(defn make-circle [x y radius]\n  {:type :circle :x x :y y :radius radius})\n\n(defmethod move :circle [shape dx dy]\n  (-&gt; shape\n      (update :x + dx)\n      (update :y + dy)))\n\n(defmethod scale :circle [shape factor]\n  (update shape :radius * factor))\n\n(defmethod area :circle [shape]\n  (* Math/PI (:radius shape) (:radius shape)))\n\n;; \u77e9\u5f62\n(defn make-rectangle [x y width height]\n  {:type :rectangle :x x :y y :width width :height height})\n\n(defmethod move :rectangle [shape dx dy]\n  (-&gt; shape\n      (update :x + dx)\n      (update :y + dy)))\n\n(defmethod scale :rectangle [shape factor]\n  (-&gt; shape\n      (update :width * factor)\n      (update :height * factor)))\n\n(defmethod area :rectangle [shape]\n  (* (:width shape) (:height shape)))\n</code></pre>"},{"location":"clojure/20-pattern-interactions/#23-composite","title":"2.3 Composite \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5","text":"<pre><code>(ns pattern-interactions.composite-shape\n  \"\u8907\u5408\u56f3\u5f62 - Composite \u30d1\u30bf\u30fc\u30f3\"\n  (:require [pattern-interactions.shape :as shape]))\n\n(defn make-composite\n  \"\u8907\u5408\u56f3\u5f62\u3092\u4f5c\u6210\"\n  ([] (make-composite []))\n  ([shapes] {:type :composite :shapes shapes}))\n\n(defn add-shape [composite s]\n  (update composite :shapes conj s))\n\n(defn remove-shape [composite s]\n  (update composite :shapes (fn [shapes] (remove #(= % s) shapes))))\n\n(defmethod shape/move :composite [composite dx dy]\n  (update composite :shapes\n          (fn [shapes] (mapv #(shape/move % dx dy) shapes))))\n\n(defmethod shape/scale :composite [composite factor]\n  (update composite :shapes\n          (fn [shapes] (mapv #(shape/scale % factor) shapes))))\n\n(defmethod shape/area :composite [composite]\n  (reduce + 0 (map shape/area (:shapes composite))))\n</code></pre> <p>\u30dd\u30a4\u30f3\u30c8: - <code>mapv</code> \u3092\u4f7f\u7528\u3057\u3066\u30d9\u30af\u30bf\u30fc\u3092\u8fd4\u3059\uff08\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\uff09 - \u5404\u5b50\u8981\u7d20\u306b\u5bfe\u3057\u3066\u540c\u3058\u64cd\u4f5c\u3092\u9069\u7528</p>"},{"location":"clojure/20-pattern-interactions/#24-decorator","title":"2.4 Decorator \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5","text":"<pre><code>(ns pattern-interactions.decorated-shape\n  \"\u88c5\u98fe\u4ed8\u304d\u56f3\u5f62 - Decorator \u30d1\u30bf\u30fc\u30f3\"\n  (:require [pattern-interactions.shape :as shape]))\n\n;; \u30b8\u30e3\u30fc\u30ca\u30eb\u4ed8\u304d\u56f3\u5f62\uff08\u64cd\u4f5c\u5c65\u6b74\u3092\u8a18\u9332\uff09\n(defn make-journaled [s]\n  {:type :journaled :shape s :journal []})\n\n(defn get-journal [decorated]\n  (:journal decorated))\n\n(defn- add-journal-entry [decorated operation]\n  (update decorated :journal conj\n          {:operation operation\n           :timestamp (System/currentTimeMillis)}))\n\n(defmethod shape/move :journaled [decorated dx dy]\n  (-&gt; decorated\n      (update :shape shape/move dx dy)\n      (add-journal-entry (str \"move(\" dx \", \" dy \")\"))))\n\n(defmethod shape/scale :journaled [decorated factor]\n  (-&gt; decorated\n      (update :shape shape/scale factor)\n      (add-journal-entry (str \"scale(\" factor \")\"))))\n\n;; \u8272\u4ed8\u304d\u56f3\u5f62\n(defn make-colored [s color]\n  {:type :colored :shape s :color color})\n\n(defmethod shape/move :colored [decorated dx dy]\n  (update decorated :shape shape/move dx dy))\n\n(defmethod shape/draw :colored [decorated]\n  (str \"[\" (:color decorated) \"] \" (shape/draw (:shape decorated))))\n</code></pre>"},{"location":"clojure/20-pattern-interactions/#25","title":"2.5 \u7d44\u307f\u5408\u308f\u305b\u306e\u4f8b","text":"<pre><code>;; Composite \u306b Decorator \u3092\u9069\u7528\n(let [circle (shape/make-circle 0 0 10)\n      rect (shape/make-rectangle 0 0 10 20)\n      comp (-&gt; (composite/make-composite)\n               (composite/add-shape circle)\n               (composite/add-shape rect))\n      journaled (decorated/make-journaled comp)\n      after-move (shape/move journaled 5 3)]\n  (decorated/get-journal after-move))\n;; =&gt; [{:operation \"move(5, 3)\" :timestamp ...}]\n\n;; Decorated \u306a\u56f3\u5f62\u3092 Composite \u306b\u542b\u3081\u308b\n(let [colored-circle (-&gt; (shape/make-circle 0 0 10)\n                         (decorated/make-colored \"red\"))\n      bordered-rect (-&gt; (shape/make-rectangle 0 0 10 20)\n                        (decorated/make-bordered 2))\n      comp (-&gt; (composite/make-composite)\n               (composite/add-shape colored-circle)\n               (composite/add-shape bordered-rect))]\n  (shape/draw comp))\n;; =&gt; \"Composite[\\n  [red] Circle...\\n  [Border: 2px] Rectangle...\\n]\"\n\n;; \u591a\u91cd\u30c7\u30b3\u30ec\u30fc\u30bf\n(let [circle (-&gt; (shape/make-circle 0 0 10)\n                 (decorated/make-colored \"blue\")\n                 (decorated/make-bordered 3)\n                 (decorated/make-journaled))]\n  (shape/draw circle))\n;; =&gt; \"[Journaled: 0 ops] [Border: 3px] [blue] Circle...\"\n</code></pre>"},{"location":"clojure/20-pattern-interactions/#3-command-observer","title":"3. Command + Observer \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"clojure/20-pattern-interactions/#31","title":"3.1 \u57fa\u672c\u6982\u5ff5","text":"<p>Command \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u64cd\u4f5c\u3092\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u30ab\u30d7\u30bb\u30eb\u5316\u3057\u3001Undo/Redo \u3092\u53ef\u80fd\u306b\u3057\u307e\u3059\u3002</p> <p>Observer \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u72b6\u614b\u306e\u5909\u66f4\u3092\u76e3\u8996\u8005\u306b\u901a\u77e5\u3057\u307e\u3059\u3002</p> <p>\u3053\u308c\u3089\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u3053\u3068\u3067\u3001\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u6642\u306b\u81ea\u52d5\u7684\u306b\u901a\u77e5\u3092\u884c\u3046\u30b7\u30b9\u30c6\u30e0\u3092\u69cb\u7bc9\u3067\u304d\u307e\u3059\u3002</p> <p></p>"},{"location":"clojure/20-pattern-interactions/#32-observer","title":"3.2 Observer \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5","text":"<pre><code>(ns pattern-interactions.observer\n  \"Observer \u30d1\u30bf\u30fc\u30f3 - \u30a4\u30d9\u30f3\u30c8\u901a\u77e5\u30b7\u30b9\u30c6\u30e0\")\n\n(defn make-subject []\n  (atom {:observers [] :state nil}))\n\n(defn add-observer [subject observer-fn]\n  (swap! subject update :observers conj observer-fn))\n\n(defn notify-observers [subject event]\n  (doseq [observer (:observers @subject)]\n    (observer event)))\n\n(defn set-state! [subject new-state]\n  (swap! subject assoc :state new-state)\n  (notify-observers subject {:type :state-changed\n                             :new-state new-state}))\n</code></pre>"},{"location":"clojure/20-pattern-interactions/#33-command","title":"3.3 Command \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5","text":"<pre><code>(ns pattern-interactions.command\n  \"Command \u30d1\u30bf\u30fc\u30f3 - \u64cd\u4f5c\u306e\u30ab\u30d7\u30bb\u30eb\u5316\")\n\n(defmulti execute \"\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\" :command-type)\n(defmulti undo \"\u30b3\u30de\u30f3\u30c9\u3092\u53d6\u308a\u6d88\u3057\" :command-type)\n(defmulti describe \"\u30b3\u30de\u30f3\u30c9\u306e\u8aac\u660e\" :command-type)\n\n;; \u56f3\u5f62\u8ffd\u52a0\u30b3\u30de\u30f3\u30c9\n(defn make-add-shape-command [shape]\n  {:command-type :add-shape :shape shape})\n\n(defmethod execute :add-shape [cmd]\n  (fn [canvas]\n    (update canvas :shapes conj (:shape cmd))))\n\n(defmethod undo :add-shape [cmd]\n  (fn [canvas]\n    (update canvas :shapes (fn [shapes] (vec (butlast shapes))))))\n\n;; \u56f3\u5f62\u79fb\u52d5\u30b3\u30de\u30f3\u30c9\n(defn make-move-shape-command [index dx dy]\n  {:command-type :move-shape :index index :dx dx :dy dy})\n\n(defmethod execute :move-shape [cmd]\n  (fn [canvas]\n    (update-in canvas [:shapes (:index cmd)] shape/move (:dx cmd) (:dy cmd))))\n\n(defmethod undo :move-shape [cmd]\n  (fn [canvas]\n    (update-in canvas [:shapes (:index cmd)] shape/move (- (:dx cmd)) (- (:dy cmd)))))\n\n;; \u30de\u30af\u30ed\u30b3\u30de\u30f3\u30c9\n(defn make-macro-command [commands]\n  {:command-type :macro :commands commands})\n\n(defmethod execute :macro [cmd]\n  (fn [canvas]\n    (reduce (fn [c sub-cmd] ((execute sub-cmd) c))\n            canvas\n            (:commands cmd))))\n\n(defmethod undo :macro [cmd]\n  (fn [canvas]\n    (reduce (fn [c sub-cmd] ((undo sub-cmd) c))\n            canvas\n            (reverse (:commands cmd)))))\n</code></pre>"},{"location":"clojure/20-pattern-interactions/#34-command-observer","title":"3.4 Command + Observer \u306e\u7d71\u5408","text":"<pre><code>(ns pattern-interactions.command-observer\n  \"Command + Observer \u30d1\u30bf\u30fc\u30f3\u306e\u7d71\u5408\"\n  (:require [pattern-interactions.command :as cmd]\n            [pattern-interactions.observer :as obs]))\n\n(defn make-observable-canvas []\n  {:shapes []\n   :subject (obs/make-subject)\n   :history []\n   :redo-stack []})\n\n(defn execute-command [canvas command]\n  (let [executor (cmd/execute command)\n        new-canvas (-&gt; canvas\n                       executor\n                       (update :history conj command)\n                       (assoc :redo-stack []))]\n    ;; \u30aa\u30d6\u30b6\u30fc\u30d0\u30fc\u306b\u901a\u77e5\n    (obs/notify-observers (:subject canvas)\n                          {:type :command-executed\n                           :command command\n                           :description (cmd/describe command)})\n    new-canvas))\n\n(defn undo-last [canvas]\n  (if (empty? (:history canvas))\n    canvas\n    (let [last-cmd (peek (:history canvas))\n          undoer (cmd/undo last-cmd)\n          new-canvas (-&gt; canvas\n                         undoer\n                         (update :history pop)\n                         (update :redo-stack conj last-cmd))]\n      (obs/notify-observers (:subject canvas)\n                            {:type :command-undone\n                             :command last-cmd})\n      new-canvas)))\n\n(defn redo-last [canvas]\n  (if (empty? (:redo-stack canvas))\n    canvas\n    (let [cmd-to-redo (peek (:redo-stack canvas))\n          executor (cmd/execute cmd-to-redo)\n          new-canvas (-&gt; canvas\n                         executor\n                         (update :history conj cmd-to-redo)\n                         (update :redo-stack pop))]\n      (obs/notify-observers (:subject canvas)\n                            {:type :command-redone\n                             :command cmd-to-redo})\n      new-canvas)))\n</code></pre>"},{"location":"clojure/20-pattern-interactions/#35","title":"3.5 \u4f7f\u7528\u4f8b","text":"<pre><code>;; \u30ad\u30e3\u30f3\u30d0\u30b9\u3092\u4f5c\u6210\n(def canvas (cmd-obs/make-observable-canvas))\n\n;; \u30aa\u30d6\u30b6\u30fc\u30d0\u30fc\u3092\u767b\u9332\n(def log (atom []))\n(cmd-obs/add-observer canvas\n  (fn [event]\n    (swap! log conj (str (:type event) \": \" (:description event)))))\n\n;; \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\n(def canvas1\n  (-&gt; canvas\n      (cmd-obs/execute-command\n        (cmd/make-add-shape-command (shape/make-circle 0 0 10)))\n      (cmd-obs/execute-command\n        (cmd/make-move-shape-command 0 5 3))))\n\n@log\n;; =&gt; [\":command-executed: Add shape: :circle\"\n;;     \":command-executed: Move shape[0] by (5, 3)\"]\n\n;; Undo\n(def canvas2 (cmd-obs/undo-last canvas1))\n@log\n;; =&gt; [..., \":command-undone: ...\"]\n\n;; Redo\n(def canvas3 (cmd-obs/redo-last canvas2))\n</code></pre>"},{"location":"clojure/20-pattern-interactions/#4","title":"4. \u8907\u5408\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306e\u8a2d\u8a08","text":""},{"location":"clojure/20-pattern-interactions/#41","title":"4.1 \u30d1\u30bf\u30fc\u30f3\u9078\u629e\u306e\u30ac\u30a4\u30c9\u30e9\u30a4\u30f3","text":""},{"location":"clojure/20-pattern-interactions/#42","title":"4.2 \u30d1\u30bf\u30fc\u30f3\u7d44\u307f\u5408\u308f\u305b\u306e\u30de\u30c8\u30ea\u30af\u30b9","text":"\u30d1\u30bf\u30fc\u30f3 A \u30d1\u30bf\u30fc\u30f3 B \u76f8\u4e57\u52b9\u679c Composite Decorator \u8907\u5408\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u5168\u4f53\u306b\u88c5\u98fe\u3092\u9069\u7528 Composite Visitor \u6728\u69cb\u9020\u3092\u8d70\u67fb\u3057\u3066\u5404\u8981\u7d20\u306b\u64cd\u4f5c\u3092\u9069\u7528 Command Observer \u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u3092\u76e3\u8996\u30fb\u30ed\u30b0 Command Composite \u30de\u30af\u30ed\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u73fe Strategy Decorator \u6226\u7565\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u30fb\u30ed\u30b0\u3092\u8ffd\u52a0 Factory Strategy \u751f\u6210\u6226\u7565\u306e\u5207\u308a\u66ff\u3048"},{"location":"clojure/20-pattern-interactions/#43","title":"4.3 \u95a2\u6570\u578b\u3067\u306e\u7d44\u307f\u5408\u308f\u305b\u306e\u5229\u70b9","text":"<ol> <li>\u30c7\u30fc\u30bf\u3068\u3057\u3066\u306e\u30d1\u30bf\u30fc\u30f3</li> <li>\u3059\u3079\u3066\u306e\u30d1\u30bf\u30fc\u30f3\u304c\u30c7\u30fc\u30bf\u69cb\u9020\u3068\u3057\u3066\u8868\u73fe\u3055\u308c\u308b</li> <li> <p>\u30d1\u30bf\u30fc\u30f3\u9593\u306e\u5883\u754c\u304c\u660e\u78ba</p> </li> <li> <p>\u5408\u6210\u53ef\u80fd\u6027</p> </li> <li>\u95a2\u6570\u5408\u6210\u306b\u3088\u308a\u81ea\u7136\u306b\u30d1\u30bf\u30fc\u30f3\u3092\u7d44\u307f\u5408\u308f\u305b\u53ef\u80fd</li> <li> <p>\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3067\u51e6\u7406\u3092\u9023\u7d50</p> </li> <li> <p>\u30c6\u30b9\u30c8\u5bb9\u6613\u6027</p> </li> <li>\u5404\u30d1\u30bf\u30fc\u30f3\u304c\u7d14\u7c8b\u95a2\u6570\u3067\u5b9f\u88c5</li> <li>\u7d44\u307f\u5408\u308f\u305b\u3082\u30c6\u30b9\u30c8\u3057\u3084\u3059\u3044</li> </ol>"},{"location":"clojure/20-pattern-interactions/#5","title":"5. \u30c6\u30b9\u30c8\u30b3\u30fc\u30c9","text":"<pre><code>(describe \"Composite + Decorator \u306e\u7d44\u307f\u5408\u308f\u305b\"\n  (it \"\u8907\u5408\u56f3\u5f62\u306b\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u9069\u7528\u3067\u304d\u308b\"\n    (let [circle (shape/make-circle 0 0 10)\n          rect (shape/make-rectangle 0 0 10 20)\n          comp (-&gt; (composite/make-composite)\n                   (composite/add-shape circle)\n                   (composite/add-shape rect))\n          journaled (decorated/make-journaled comp)\n          after-move (shape/move journaled 5 3)]\n      (should= 1 (count (decorated/get-journal after-move)))))\n\n  (it \"\u591a\u91cd\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u9069\u7528\u3067\u304d\u308b\"\n    (let [circle (-&gt; (shape/make-circle 0 0 10)\n                     (decorated/make-colored \"blue\")\n                     (decorated/make-bordered 3)\n                     (decorated/make-journaled))]\n      (should-contain \"[Journaled:\" (shape/draw circle))\n      (should-contain \"[Border: 3px]\" (shape/draw circle))\n      (should-contain \"[blue]\" (shape/draw circle)))))\n\n(describe \"Command + Observer \u306e\u7d71\u5408\"\n  (it \"\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u6642\u306b\u30aa\u30d6\u30b6\u30fc\u30d0\u30fc\u306b\u901a\u77e5\u3055\u308c\u308b\"\n    (let [canvas (cmd-obs/make-observable-canvas)\n          notifications (atom [])\n          observer (fn [event] (swap! notifications conj event))\n          _ (cmd-obs/add-observer canvas observer)\n          circle (shape/make-circle 0 0 10)\n          cmd (cmd/make-add-shape-command circle)\n          new-canvas (cmd-obs/execute-command canvas cmd)]\n      (should= 1 (count @notifications))\n      (should= :command-executed (:type (first @notifications)))))\n\n  (it \"Undo/Redo \u304c\u6a5f\u80fd\u3059\u308b\"\n    (let [canvas (cmd-obs/make-observable-canvas)\n          circle (shape/make-circle 0 0 10)\n          cmd (cmd/make-add-shape-command circle)\n          after-add (cmd-obs/execute-command canvas cmd)\n          after-undo (cmd-obs/undo-last after-add)\n          after-redo (cmd-obs/redo-last after-undo)]\n      (should= 1 (count (cmd-obs/get-shapes after-add)))\n      (should= 0 (count (cmd-obs/get-shapes after-undo)))\n      (should= 1 (count (cmd-obs/get-shapes after-redo))))))\n</code></pre>"},{"location":"clojure/20-pattern-interactions/#6","title":"6. \u307e\u3068\u3081","text":""},{"location":"clojure/20-pattern-interactions/#_2","title":"\u30d1\u30bf\u30fc\u30f3\u7d44\u307f\u5408\u308f\u305b\u306e\u539f\u5247","text":"<ol> <li>\u5358\u4e00\u8cac\u4efb\u3092\u7dad\u6301: \u5404\u30d1\u30bf\u30fc\u30f3\u306f\u72ec\u81ea\u306e\u8cac\u4efb\u3092\u6301\u3064</li> <li>\u758e\u7d50\u5408\u3092\u4fdd\u3064: \u30d1\u30bf\u30fc\u30f3\u9593\u306f\u660e\u78ba\u306a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u9023\u643a</li> <li>\u30c7\u30fc\u30bf\u4e2d\u5fc3: \u30d1\u30bf\u30fc\u30f3\u9593\u306e\u3084\u308a\u53d6\u308a\u306f\u30c7\u30fc\u30bf\u3067\u884c\u3046</li> <li>\u30c6\u30b9\u30c8\u53ef\u80fd\u6027: \u7d44\u307f\u5408\u308f\u305b\u3066\u3082\u500b\u5225\u306b\u30c6\u30b9\u30c8\u53ef\u80fd</li> </ol>"},{"location":"clojure/20-pattern-interactions/#_3","title":"\u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1\u306e\u5f37\u307f","text":"<ul> <li>\u900f\u904e\u7684\u306a\u5408\u6210: \u95a2\u6570\u3068\u30c7\u30fc\u30bf\u306e\u5408\u6210\u304c\u81ea\u7136</li> <li>\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb: \u72b6\u614b\u306e\u8ffd\u8de1\u304c\u5bb9\u6613</li> <li>\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9: \u67d4\u8edf\u306a\u591a\u614b\u6027\u306e\u5b9f\u73fe</li> </ul>"},{"location":"clojure/20-pattern-interactions/#_4","title":"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7","text":"<ul> <li>\u7b2c21\u7ae0: \u95a2\u6570\u578b\u30c7\u30b6\u30a4\u30f3\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9</li> <li>\u7b2c22\u7ae0: \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u304b\u3089\u95a2\u6570\u578b\u3078\u306e\u79fb\u884c</li> </ul>"},{"location":"clojure/21-best-practices/","title":"\u7b2c21\u7ae0: \u95a2\u6570\u578b\u30c7\u30b6\u30a4\u30f3\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9","text":""},{"location":"clojure/21-best-practices/#1","title":"1. \u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u304a\u3051\u308b\u8a2d\u8a08\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3092\u4f53\u7cfb\u7684\u306b\u89e3\u8aac\u3057\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u539f\u5247\u306f\u3001\u4fdd\u5b88\u6027\u304c\u9ad8\u304f\u3001\u30c6\u30b9\u30c8\u3057\u3084\u3059\u3044\u3001\u5805\u7262\u306a\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u69cb\u7bc9\u3059\u308b\u305f\u3081\u306e\u6307\u91dd\u3068\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"clojure/21-best-practices/#_1","title":"\u5b66\u7fd2\u76ee\u6a19","text":"<ul> <li>\u30c7\u30fc\u30bf\u4e2d\u5fc3\u8a2d\u8a08\u306e\u539f\u5247\u3092\u7406\u89e3\u3059\u308b</li> <li>\u7d14\u7c8b\u95a2\u6570\u3068\u526f\u4f5c\u7528\u306e\u5206\u96e2\u65b9\u6cd5\u3092\u5b66\u3076</li> <li>\u30c6\u30b9\u30c8\u53ef\u80fd\u306a\u8a2d\u8a08\u30d1\u30bf\u30fc\u30f3\u3092\u7fd2\u5f97\u3059\u308b</li> </ul>"},{"location":"clojure/21-best-practices/#2","title":"2. \u30c7\u30fc\u30bf\u4e2d\u5fc3\u8a2d\u8a08","text":""},{"location":"clojure/21-best-practices/#21_1","title":"2.1 \u57fa\u672c\u539f\u5247","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u30c7\u30fc\u30bf\u304c\u4e3b\u5f79\u3067\u3059\u3002\u307e\u305a\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u8a2d\u8a08\u3057\u3001\u305d\u306e\u30c7\u30fc\u30bf\u3092\u5909\u63db\u3059\u308b\u95a2\u6570\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002</p> <p></p>"},{"location":"clojure/21-best-practices/#22","title":"2.2 \u30c7\u30fc\u30bf\u69cb\u9020\u306e\u5b9a\u7fa9","text":"<pre><code>(ns best-practices.data-centric)\n\n;; \u30b7\u30f3\u30d7\u30eb\u306a\u30de\u30c3\u30d7\u3067\u30c7\u30fc\u30bf\u3092\u8868\u73fe\n(defn make-user [id name email]\n  {:id id\n   :name name\n   :email email\n   :created-at (System/currentTimeMillis)})\n\n(defn make-order [id user-id items]\n  {:id id\n   :user-id user-id\n   :items items\n   :status :pending\n   :created-at (System/currentTimeMillis)})\n\n(defn make-order-item [product-id quantity price]\n  {:product-id product-id\n   :quantity quantity\n   :price price})\n</code></pre> <p>\u30dd\u30a4\u30f3\u30c8: - \u30d7\u30ec\u30fc\u30f3\u306a\u30de\u30c3\u30d7\u3092\u4f7f\u7528\uff08\u30af\u30e9\u30b9\u3067\u306f\u306a\u304f\uff09 - \u5fc5\u8981\u6700\u5c0f\u9650\u306e\u30d5\u30a3\u30fc\u30eb\u30c9 - \u660e\u78ba\u306a\u547d\u540d</p>"},{"location":"clojure/21-best-practices/#23","title":"2.3 \u5c0f\u3055\u306a\u7d14\u7c8b\u95a2\u6570","text":"<pre><code>;; \u5404\u95a2\u6570\u306f\u5358\u4e00\u306e\u8cac\u4efb\u3092\u6301\u3064\n(defn calculate-item-total [item]\n  (* (:quantity item) (:price item)))\n\n(defn calculate-order-total [order]\n  (reduce + 0 (map calculate-item-total (:items order))))\n\n(defn apply-discount [total discount-rate]\n  (* total (- 1.0 discount-rate)))\n</code></pre> <p>\u539f\u5247: - 1\u3064\u306e\u95a2\u6570\u306f1\u3064\u306e\u3053\u3068\u3092\u884c\u3046 - \u5165\u529b\u304b\u3089\u51fa\u529b\u3078\u306e\u7d14\u7c8b\u306a\u5909\u63db - \u526f\u4f5c\u7528\u306a\u3057</p>"},{"location":"clojure/21-best-practices/#24","title":"2.4 \u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3","text":"<pre><code>(defn enrich-order [order]\n  (assoc order :total (calculate-order-total order)))\n\n(defn apply-tax [order tax-rate]\n  (let [total (:total order)\n        tax (* total tax-rate)]\n    (assoc order\n           :tax tax\n           :grand-total (+ total tax))))\n\n(defn process-order [order discount-rate tax-rate]\n  (-&gt; order\n      enrich-order\n      (update :total apply-discount discount-rate)\n      (apply-tax tax-rate)\n      (assoc :status :processed)))\n</code></pre> <p>\u30b9\u30ec\u30c3\u30c9\u30de\u30af\u30ed <code>-&gt;</code> \u306e\u6d3b\u7528: - \u30c7\u30fc\u30bf\u306e\u6d41\u308c\u304c\u660e\u78ba - \u5404\u30b9\u30c6\u30c3\u30d7\u304c\u72ec\u7acb - \u30c7\u30d0\u30c3\u30b0\u3057\u3084\u3059\u3044</p>"},{"location":"clojure/21-best-practices/#25","title":"2.5 \u30c7\u30fc\u30bf\u691c\u8a3c","text":"<pre><code>(defn valid-email? [email]\n  (and (string? email)\n       (re-matches #\"^[^@]+@[^@]+\\.[^@]+$\" email)))\n\n(defn valid-user? [user]\n  (and (map? user)\n       (string? (:name user))\n       (not (empty? (:name user)))\n       (valid-email? (:email user))))\n\n(defn valid-order? [order]\n  (and (map? order)\n       (not (empty? (:items order)))\n       (every? valid-order-item? (:items order))))\n</code></pre> <p>\u691c\u8a3c\u95a2\u6570\u306e\u30d1\u30bf\u30fc\u30f3: - \u8ff0\u8a9e\u95a2\u6570\uff08<code>?</code> \u3067\u7d42\u308f\u308b\uff09\u3092\u4f7f\u7528 - \u5408\u6210\u53ef\u80fd\u306a\u5c0f\u3055\u306a\u691c\u8a3c - \u660e\u78ba\u306a\u30a8\u30e9\u30fc\u6761\u4ef6</p>"},{"location":"clojure/21-best-practices/#26","title":"2.6 \u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u306a\u66f4\u65b0","text":"<pre><code>(defn update-user-email [user new-email]\n  (if (valid-email? new-email)\n    (assoc user :email new-email :updated-at (System/currentTimeMillis))\n    user))  ;; \u7121\u52b9\u306a\u5834\u5408\u306f\u5143\u306e\u30c7\u30fc\u30bf\u3092\u8fd4\u3059\n\n(defn add-order-item [order item]\n  (if (valid-order-item? item)\n    (update order :items conj item)\n    order))\n\n(defn cancel-order [order]\n  (if (= :pending (:status order))\n    (assoc order :status :cancelled :cancelled-at (System/currentTimeMillis))\n    order))\n</code></pre> <p>\u30a4\u30df\u30e5\u30fc\u30bf\u30d3\u30ea\u30c6\u30a3\u306e\u5229\u70b9: - \u5143\u306e\u30c7\u30fc\u30bf\u306f\u5909\u66f4\u3055\u308c\u306a\u3044 - \u5c65\u6b74\u306e\u8ffd\u8de1\u304c\u5bb9\u6613 - \u4e26\u884c\u51e6\u7406\u304c\u5b89\u5168</p>"},{"location":"clojure/21-best-practices/#3","title":"3. \u7d14\u7c8b\u95a2\u6570\u3068\u526f\u4f5c\u7528\u306e\u5206\u96e2","text":""},{"location":"clojure/21-best-practices/#31","title":"3.1 \u7d14\u7c8b\u95a2\u6570\u306e\u7279\u6027","text":"<pre><code>;; \u7d14\u7c8b\u95a2\u6570\u306e\u4f8b\n(defn add [a b]\n  (+ a b))  ;; \u540c\u3058\u5165\u529b \u2192 \u540c\u3058\u51fa\u529b\n\n(defn multiply [a b]\n  (* a b))  ;; \u526f\u4f5c\u7528\u306a\u3057\n\n(defn square [x]\n  (* x x))  ;; \u53c2\u7167\u900f\u904e\u6027\n</code></pre> <p>\u7d14\u7c8b\u95a2\u6570\u306e\u6761\u4ef6: 1. \u540c\u3058\u5165\u529b\u306b\u5bfe\u3057\u3066\u5e38\u306b\u540c\u3058\u51fa\u529b 2. \u526f\u4f5c\u7528\u304c\u306a\u3044 3. \u5916\u90e8\u72b6\u614b\u306b\u4f9d\u5b58\u3057\u306a\u3044</p>"},{"location":"clojure/21-best-practices/#32","title":"3.2 \u526f\u4f5c\u7528\u306e\u5206\u96e2","text":"<pre><code>;; \u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\uff08\u7d14\u7c8b\uff09\n(defn validate-amount [amount]\n  (cond\n    (nil? amount) {:valid false :error \"Amount is required\"}\n    (&lt;= amount 0) {:valid false :error \"Amount must be positive\"}\n    :else {:valid true :amount amount}))\n\n(defn calculate-fee [amount fee-rate]\n  (* amount fee-rate))\n\n(defn calculate-total [amount fee]\n  (+ amount fee))\n\n;; \u526f\u4f5c\u7528\u3092\u542b\u3080\u51e6\u7406\uff08\u5883\u754c\uff09\n(defn process-payment! [amount fee-rate side-effect-fn]\n  (let [validation (validate-amount amount)]\n    (if (:valid validation)\n      (let [fee (calculate-fee amount fee-rate)\n            total (calculate-total amount fee)\n            result {:amount amount :fee fee :total total :status :success}]\n        ;; \u526f\u4f5c\u7528\u306f\u6700\u5f8c\u306b\u5b9f\u884c\n        (side-effect-fn result)\n        result)\n      {:status :error :error (:error validation)})))\n</code></pre>"},{"location":"clojure/21-best-practices/#33","title":"3.3 \u9ad8\u968e\u95a2\u6570\u306b\u3088\u308b\u30c7\u30b3\u30ec\u30fc\u30b7\u30e7\u30f3","text":"<pre><code>(defn with-logging [f logger]\n  \"\u30ed\u30ae\u30f3\u30b0\u6a5f\u80fd\u3092\u8ffd\u52a0\u3059\u308b\u30c7\u30b3\u30ec\u30fc\u30bf\"\n  (fn [&amp; args]\n    (logger (str \"Calling with args: \" args))\n    (let [result (apply f args)]\n      (logger (str \"Result: \" result))\n      result)))\n\n;; \u4f7f\u7528\u4f8b\n(def logged-add (with-logging add println))\n(logged-add 2 3)\n;; Calling with args: (2 3)\n;; Result: 5\n;; =&gt; 5\n</code></pre>"},{"location":"clojure/21-best-practices/#34","title":"3.4 \u95a2\u6570\u5408\u6210","text":"<pre><code>(defn pipeline [&amp; fns]\n  \"\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u5f62\u5f0f\u306e\u95a2\u6570\u5408\u6210\"\n  (fn [x]\n    (reduce (fn [acc f] (f acc)) x fns)))\n\n(def process-number\n  (pipeline\n   #(+ % 1)      ;; 1\u3092\u52a0\u7b97\n   #(* % 2)      ;; 2\u500d\n   #(- % 3)))    ;; 3\u3092\u6e1b\u7b97\n\n(process-number 5)  ;; =&gt; (5+1)*2-3 = 9\n</code></pre>"},{"location":"clojure/21-best-practices/#35","title":"3.5 \u30e1\u30e2\u5316","text":"<pre><code>(defn memoize-fn [f]\n  \"\u53c2\u7167\u900f\u904e\u6027\u3092\u6d3b\u7528\u3057\u305f\u30ad\u30e3\u30c3\u30b7\u30f3\u30b0\"\n  (let [cache (atom {})]\n    (fn [&amp; args]\n      (if-let [cached (get @cache args)]\n        cached\n        (let [result (apply f args)]\n          (swap! cache assoc args result)\n          result)))))\n\n;; \u30d5\u30a3\u30dc\u30ca\u30c3\u30c1\uff08\u30e1\u30e2\u5316\u7248\uff09\n(def fib-memo\n  (memoize-fn\n   (fn [n]\n     (if (&lt;= n 1)\n       n\n       (+ (fib-memo (- n 1))\n          (fib-memo (- n 2)))))))\n</code></pre>"},{"location":"clojure/21-best-practices/#4","title":"4. \u30c6\u30b9\u30c8\u53ef\u80fd\u306a\u8a2d\u8a08","text":""},{"location":"clojure/21-best-practices/#41","title":"4.1 \u4f9d\u5b58\u6027\u6ce8\u5165","text":"<pre><code>;; \u4f9d\u5b58\u6027\u3092\u95a2\u6570\u30d1\u30e9\u30e1\u30fc\u30bf\u3068\u3057\u3066\u6ce8\u5165\n(defn get-user [repository id]\n  ((:find-by-id repository) id))\n\n(defn save-user [repository user]\n  ((:save repository) user))\n\n;; \u30c6\u30b9\u30c8\u7528\u30e2\u30c3\u30af\u30ea\u30dd\u30b8\u30c8\u30ea\n(defn make-mock-repository [initial-data]\n  (let [data (atom initial-data)]\n    {:find-by-id (fn [id]\n                   (first (filter #(= (:id %) id) @data)))\n     :find-all (fn [] @data)\n     :save (fn [entity]\n             (swap! data conj entity)\n             entity)\n     :delete (fn [id]\n               (swap! data (fn [d] (remove #(= (:id %) id) d))))}))\n</code></pre>"},{"location":"clojure/21-best-practices/#42","title":"4.2 \u6642\u9593\u306e\u62bd\u8c61\u5316","text":"<pre><code>;; \u6642\u9593\u3092\u6ce8\u5165\u53ef\u80fd\u306b\u3059\u308b\n(defn create-order [items now-fn]\n  {:items items :created-at (now-fn)})\n\n(defn is-expired? [order now-fn expiry-duration-ms]\n  (let [age (- (now-fn) (:created-at order))]\n    (&gt; age expiry-duration-ms)))\n\n;; \u30c6\u30b9\u30c8\u7528\u306e\u56fa\u5b9a\u6642\u523b\u95a2\u6570\n(defn make-fixed-clock [fixed-time]\n  (fn [] fixed-time))\n\n;; \u30c6\u30b9\u30c8\n(let [clock (make-fixed-clock 1000)\n      order (create-order [{:item \"A\"}] clock)\n      later-clock (make-fixed-clock 2000)]\n  (is-expired? order later-clock 500))  ;; =&gt; true\n</code></pre>"},{"location":"clojure/21-best-practices/#43","title":"4.3 \u30e9\u30f3\u30c0\u30e0\u6027\u306e\u62bd\u8c61\u5316","text":"<pre><code>(defn create-entity [data id-gen-fn now-fn]\n  (assoc data\n         :id (id-gen-fn)\n         :created-at (now-fn)))\n\n;; \u30c6\u30b9\u30c8\u7528\u30b7\u30fc\u30b1\u30f3\u30b7\u30e3\u30ebID\u751f\u6210\u5668\n(defn make-sequential-id-gen []\n  (let [counter (atom 0)]\n    (fn []\n      (swap! counter inc)\n      (str \"id-\" @counter))))\n\n;; \u30c6\u30b9\u30c8\n(let [id-gen (make-sequential-id-gen)\n      clock (make-fixed-clock 1000)]\n  (create-entity {:name \"Test\"} id-gen clock))\n;; =&gt; {:name \"Test\" :id \"id-1\" :created-at 1000}\n</code></pre>"},{"location":"clojure/21-best-practices/#44","title":"4.4 \u8a2d\u5b9a\u306e\u5206\u96e2","text":"<pre><code>(defn make-config [&amp; {:keys [tax-rate discount-rate currency]\n                      :or {tax-rate 0.1 discount-rate 0.0 currency \"JPY\"}}]\n  {:tax-rate tax-rate\n   :discount-rate discount-rate\n   :currency currency})\n\n(defn calculate-price [config base-price]\n  (let [discounted (* base-price (- 1.0 (:discount-rate config)))\n        with-tax (* discounted (+ 1.0 (:tax-rate config)))]\n    {:base-price base-price\n     :discounted discounted\n     :tax (* discounted (:tax-rate config))\n     :total with-tax\n     :currency (:currency config)}))\n\n;; \u30c6\u30b9\u30c8\n(let [config (make-config :tax-rate 0.08 :discount-rate 0.1)]\n  (calculate-price config 1000))\n;; =&gt; {:base-price 1000, :discounted 900.0, :tax 72.0, :total 972.0, ...}\n</code></pre>"},{"location":"clojure/21-best-practices/#45","title":"4.5 \u691c\u8a3c\u306e\u5206\u96e2","text":"<pre><code>(defn validate-input [input validations]\n  (let [errors (keep (fn [[field validation]]\n                       (let [value (get input field)]\n                         (when-not (validation value)\n                           field)))\n                     validations)]\n    (if (empty? errors)\n      {:valid true :data input}\n      {:valid false :errors errors})))\n\n(def user-validations\n  {:name (fn [v] (and (string? v) (not (empty? v))))\n   :email (fn [v] (and (string? v) (re-matches #\"^[^@]+@[^@]+\\.[^@]+$\" v)))\n   :age (fn [v] (and (number? v) (&gt;= v 0)))})\n\n;; \u4f7f\u7528\u4f8b\n(validate-input {:name \"John\" :email \"john@example.com\" :age 30}\n                user-validations)\n;; =&gt; {:valid true :data {...}}\n\n(validate-input {:name \"\" :email \"invalid\" :age -1}\n                user-validations)\n;; =&gt; {:valid false :errors (:name :email :age)}\n</code></pre>"},{"location":"clojure/21-best-practices/#46","title":"4.6 \u30d7\u30ed\u30c8\u30b3\u30eb\u306b\u3088\u308b\u30e2\u30c3\u30af","text":"<pre><code>(defprotocol Notifier\n  (send-notification [this recipient message]))\n\n;; \u672c\u756a\u7528\u5b9f\u88c5\n(defrecord EmailNotifier [smtp-config]\n  Notifier\n  (send-notification [_ recipient message]\n    ;; \u5b9f\u969b\u306e\u30e1\u30fc\u30eb\u9001\u4fe1\n    {:sent true :recipient recipient}))\n\n;; \u30c6\u30b9\u30c8\u7528\u5b9f\u88c5\n(defrecord MockNotifier [sent-messages]\n  Notifier\n  (send-notification [_ recipient message]\n    (swap! sent-messages conj {:recipient recipient :message message})\n    {:sent true :recipient recipient}))\n\n(defn make-mock-notifier []\n  (-&gt;MockNotifier (atom [])))\n\n(defn get-sent-messages [mock-notifier]\n  @(:sent-messages mock-notifier))\n</code></pre>"},{"location":"clojure/21-best-practices/#5","title":"5. \u30c6\u30b9\u30c8\u30b3\u30fc\u30c9","text":"<pre><code>(describe \"\u30c7\u30fc\u30bf\u4e2d\u5fc3\u8a2d\u8a08\"\n  (it \"\u6ce8\u6587\u306e\u5408\u8a08\u3092\u8a08\u7b97\u3067\u304d\u308b\"\n    (let [items [(make-order-item \"p1\" 2 100)\n                 (make-order-item \"p2\" 1 200)]\n          order (make-order \"o1\" \"u1\" items)]\n      (should= 400 (calculate-order-total order))))\n\n  (it \"\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u306a\u66f4\u65b0\u304c\u3067\u304d\u308b\"\n    (let [user (make-user \"u1\" \"John\" \"john@example.com\")\n          updated (update-user-email user \"new@example.com\")]\n      (should= \"new@example.com\" (:email updated))\n      (should= \"john@example.com\" (:email user)))))\n\n(describe \"\u30c6\u30b9\u30c8\u53ef\u80fd\u306a\u8a2d\u8a08\"\n  (it \"\u30e2\u30c3\u30af\u30ea\u30dd\u30b8\u30c8\u30ea\u3067\u30c6\u30b9\u30c8\u3067\u304d\u308b\"\n    (let [repo (make-mock-repository [{:id \"u1\" :name \"John\"}])\n          user (get-user repo \"u1\")]\n      (should= \"John\" (:name user))))\n\n  (it \"\u56fa\u5b9a\u6642\u523b\u3067\u30c6\u30b9\u30c8\u3067\u304d\u308b\"\n    (let [clock (make-fixed-clock 1000)\n          order (create-order [{:item \"A\"}] clock)]\n      (should= 1000 (:created-at order)))))\n</code></pre>"},{"location":"clojure/21-best-practices/#6","title":"6. \u307e\u3068\u3081","text":""},{"location":"clojure/21-best-practices/#_2","title":"\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u306e\u8981\u7d04","text":"\u30ab\u30c6\u30b4\u30ea \u30d7\u30e9\u30af\u30c6\u30a3\u30b9 \u52b9\u679c \u30c7\u30fc\u30bf\u8a2d\u8a08 \u30b7\u30f3\u30d7\u30eb\u306a\u30de\u30c3\u30d7\u3092\u4f7f\u7528 \u67d4\u8edf\u6027\u3001\u6c4e\u7528\u6027 \u95a2\u6570\u8a2d\u8a08 \u5c0f\u3055\u306a\u7d14\u7c8b\u95a2\u6570 \u30c6\u30b9\u30c8\u5bb9\u6613\u6027\u3001\u518d\u5229\u7528\u6027 \u526f\u4f5c\u7528 \u5883\u754c\u306b\u62bc\u3057\u51fa\u3059 \u4e88\u6e2c\u53ef\u80fd\u6027\u3001\u4fdd\u5b88\u6027 \u4f9d\u5b58\u6027 \u6ce8\u5165\u30d1\u30bf\u30fc\u30f3 \u30c6\u30b9\u30c8\u5bb9\u6613\u6027\u3001\u758e\u7d50\u5408 \u691c\u8a3c \u5ba3\u8a00\u7684\u306a\u691c\u8a3c\u30eb\u30fc\u30eb \u660e\u78ba\u6027\u3001\u62e1\u5f35\u6027"},{"location":"clojure/21-best-practices/#_3","title":"\u5b9f\u8df5\u306e\u30dd\u30a4\u30f3\u30c8","text":"<ol> <li>\u30c7\u30fc\u30bf\u30d5\u30a1\u30fc\u30b9\u30c8: \u307e\u305a\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u8a2d\u8a08</li> <li>\u5c0f\u3055\u306a\u95a2\u6570: 1\u95a2\u65701\u8cac\u4efb</li> <li>\u7d14\u7c8b\u6027\u3092\u512a\u5148: \u526f\u4f5c\u7528\u306f\u6700\u5f8c\u306b</li> <li>\u30c6\u30b9\u30c8\u3092\u8003\u616e: \u4f9d\u5b58\u6027\u306f\u6ce8\u5165\u53ef\u80fd\u306b</li> <li>\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3: \u30c7\u30fc\u30bf\u306e\u6d41\u308c\u3092\u660e\u78ba\u306b</li> </ol>"},{"location":"clojure/21-best-practices/#_4","title":"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7","text":"<ul> <li>\u7b2c22\u7ae0: \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u304b\u3089\u95a2\u6570\u578b\u3078\u306e\u79fb\u884c</li> </ul>"},{"location":"clojure/22-oo-to-fp-migration/","title":"\u7b2c22\u7ae0: \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u304b\u3089\u95a2\u6570\u578b\u3078\u306e\u79fb\u884c","text":""},{"location":"clojure/22-oo-to-fp-migration/#1","title":"1. \u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\uff08OO\uff09\u30b9\u30bf\u30a4\u30eb\u306e\u30b3\u30fc\u30c9\u3092\u95a2\u6570\u578b\uff08FP\uff09\u30b9\u30bf\u30a4\u30eb\u306b\u79fb\u884c\u3059\u308b\u305f\u3081\u306e\u6226\u7565\u3068\u30c6\u30af\u30cb\u30c3\u30af\u3092\u89e3\u8aac\u3057\u307e\u3059\u3002\u6bb5\u968e\u7684\u306a\u30a2\u30d7\u30ed\u30fc\u30c1\u306b\u3088\u308a\u3001\u65e2\u5b58\u306e\u30b3\u30fc\u30c9\u30d9\u30fc\u30b9\u3092\u5b89\u5168\u306b\u95a2\u6570\u578b\u306b\u79fb\u884c\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"clojure/22-oo-to-fp-migration/#_1","title":"\u5b66\u7fd2\u76ee\u6a19","text":"<ul> <li>OO \u3068 FP \u306e\u6839\u672c\u7684\u306a\u9055\u3044\u3092\u7406\u89e3\u3059\u308b</li> <li>\u6bb5\u968e\u7684\u306a\u79fb\u884c\u6226\u7565\u3092\u5b66\u3076</li> <li>\u5b9f\u8df5\u7684\u306a\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u30d1\u30bf\u30fc\u30f3\u3092\u7fd2\u5f97\u3059\u308b</li> </ul>"},{"location":"clojure/22-oo-to-fp-migration/#2-oo-fp","title":"2. OO \u3068 FP \u306e\u5bfe\u6bd4","text":""},{"location":"clojure/22-oo-to-fp-migration/#21","title":"2.1 \u30d1\u30e9\u30c0\u30a4\u30e0\u306e\u9055\u3044","text":"\u6982\u5ff5 \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411 \u95a2\u6570\u578b \u57fa\u672c\u5358\u4f4d \u30aa\u30d6\u30b8\u30a7\u30af\u30c8 \u30c7\u30fc\u30bf + \u95a2\u6570 \u72b6\u614b\u7ba1\u7406 \u53ef\u5909\uff08mutable\uff09 \u4e0d\u5909\uff08immutable\uff09 \u591a\u614b\u6027 \u7d99\u627f\u30fb\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9 \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u30fb\u30d7\u30ed\u30c8\u30b3\u30eb \u30b3\u30fc\u30c9\u518d\u5229\u7528 \u7d99\u627f \u95a2\u6570\u5408\u6210 \u526f\u4f5c\u7528 \u3069\u3053\u3067\u3082\u53ef\u80fd \u5883\u754c\u306b\u5206\u96e2"},{"location":"clojure/22-oo-to-fp-migration/#22-oo","title":"2.2 OO \u30b9\u30bf\u30a4\u30eb\u306e\u4f8b","text":"<pre><code>(ns oo-to-fp.oo-style)\n\n;; OO\u30b9\u30bf\u30a4\u30eb: \u5185\u90e8\u72b6\u614b\u3092\u6301\u3064\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\n(defn make-account-oo [id initial-balance]\n  (let [state (atom {:id id\n                     :balance initial-balance\n                     :transactions []})]\n    {:get-id (fn [] (:id @state))\n     :get-balance (fn [] (:balance @state))\n     :deposit (fn [amount]\n                (when (pos? amount)\n                  (swap! state update :balance + amount)\n                  (swap! state update :transactions conj\n                         {:type :deposit :amount amount})\n                  (:balance @state)))\n     :withdraw (fn [amount]\n                 (when (and (pos? amount)\n                            (&gt;= (:balance @state) amount))\n                   (swap! state update :balance - amount)\n                   (swap! state update :transactions conj\n                          {:type :withdrawal :amount amount})\n                   (:balance @state)))}))\n\n;; \u4f7f\u7528\u4f8b\n;; (def acc (make-account-oo \"A001\" 1000))\n;; ((:deposit acc) 500)   ;; =&gt; 1500\n;; ((:withdraw acc) 200)  ;; =&gt; 1300\n</code></pre> <p>\u554f\u984c\u70b9: - \u5185\u90e8\u72b6\u614b\u304c\u53ef\u5909 - \u30c6\u30b9\u30c8\u304c\u56f0\u96e3\uff08\u72b6\u614b\u306b\u4f9d\u5b58\uff09 - \u5c65\u6b74\u306e\u8ffd\u8de1\u304c\u96e3\u3057\u3044</p>"},{"location":"clojure/22-oo-to-fp-migration/#23-fp","title":"2.3 FP \u30b9\u30bf\u30a4\u30eb\u3078\u306e\u5909\u63db","text":"<pre><code>(ns oo-to-fp.fp-style)\n\n;; FP\u30b9\u30bf\u30a4\u30eb: \u30d7\u30ec\u30fc\u30f3\u306a\u30c7\u30fc\u30bf + \u7d14\u7c8b\u95a2\u6570\n(defn make-account [id initial-balance]\n  {:id id\n   :balance initial-balance\n   :transactions []})\n\n(defn get-balance [account]\n  (:balance account))\n\n(defn deposit [account amount]\n  (if (pos? amount)\n    (-&gt; account\n        (update :balance + amount)\n        (update :transactions conj {:type :deposit :amount amount}))\n    account))\n\n(defn withdraw [account amount]\n  (if (and (pos? amount)\n           (&gt;= (:balance account) amount))\n    (-&gt; account\n        (update :balance - amount)\n        (update :transactions conj {:type :withdrawal :amount amount}))\n    account))\n\n;; \u4f7f\u7528\u4f8b\n;; (def acc (make-account \"A001\" 1000))\n;; (def acc2 (deposit acc 500))   ;; acc \u306f\u5909\u66f4\u3055\u308c\u306a\u3044\n;; (def acc3 (withdraw acc2 200)) ;; acc2 \u3082\u5909\u66f4\u3055\u308c\u306a\u3044\n</code></pre> <p>\u5229\u70b9: - \u5143\u306e\u30c7\u30fc\u30bf\u306f\u4e0d\u5909 - \u30c6\u30b9\u30c8\u304c\u5bb9\u6613\uff08\u5165\u529b \u2192 \u51fa\u529b\uff09 - \u5b8c\u5168\u306a\u5c65\u6b74\u3092\u4fdd\u6301</p>"},{"location":"clojure/22-oo-to-fp-migration/#3","title":"3. \u79fb\u884c\u6226\u7565","text":""},{"location":"clojure/22-oo-to-fp-migration/#31-strangler-fig","title":"3.1 Strangler Fig \u30d1\u30bf\u30fc\u30f3","text":"<p>\u53e4\u3044\u30b3\u30fc\u30c9\u3092\u5f90\u3005\u306b\u65b0\u3057\u3044\u30b3\u30fc\u30c9\u3067\u300c\u7d5e\u3081\u6bba\u3059\u300d\u30d1\u30bf\u30fc\u30f3\u3002</p> <p></p> <pre><code>(defn create-account-strangler [id initial-balance use-fp?]\n  (if use-fp?\n    ;; \u65b0\u3057\u3044FP\u30b9\u30bf\u30a4\u30eb\n    {:style :fp\n     :data (fp/make-account id initial-balance)}\n    ;; \u53e4\u3044OO\u30b9\u30bf\u30a4\u30eb\uff08\u4e92\u63db\u6027\u306e\u305f\u3081\uff09\n    {:style :oo\n     :data {:id id :balance initial-balance :transactions []}}))\n\n(defn account-deposit [account amount]\n  (if (= :fp (:style account))\n    (update account :data fp/deposit amount)\n    ;; OO\u30b9\u30bf\u30a4\u30eb\u3082\u540c\u3058\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u51e6\u7406\n    (update account :data\n            (fn [data]\n              (-&gt; data\n                  (update :balance + amount)\n                  (update :transactions conj {:type :deposit :amount amount}))))))\n</code></pre>"},{"location":"clojure/22-oo-to-fp-migration/#32","title":"3.2 \u30a2\u30c0\u30d7\u30bf\u30fc\u30d1\u30bf\u30fc\u30f3","text":"<p>\u53e4\u3044\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u7dad\u6301\u3057\u306a\u304c\u3089\u3001\u5185\u90e8\u5b9f\u88c5\u3092 FP \u306b\u79fb\u884c\u3002</p> <pre><code>(defprotocol AccountOperations\n  (get-account-balance [this])\n  (deposit-to-account [this amount])\n  (withdraw-from-account [this amount]))\n\n;; FP\u30b9\u30bf\u30a4\u30eb\u306e\u30a2\u30c0\u30d7\u30bf\u30fc\n(defrecord FPAccountAdapter [account-atom]\n  AccountOperations\n  (get-account-balance [_]\n    (:balance @account-atom))\n  (deposit-to-account [_ amount]\n    (swap! account-atom fp/deposit amount)\n    (:balance @account-atom))\n  (withdraw-from-account [_ amount]\n    (swap! account-atom fp/withdraw amount)\n    (:balance @account-atom)))\n\n(defn make-fp-account-adapter [id initial-balance]\n  (-&gt;FPAccountAdapter (atom (fp/make-account id initial-balance))))\n</code></pre> <p>\u4f7f\u7528\u4f8b: <pre><code>(let [adapter (make-fp-account-adapter \"A001\" 1000)]\n  (deposit-to-account adapter 500)\n  (get-account-balance adapter))  ;; =&gt; 1500\n</code></pre></p>"},{"location":"clojure/22-oo-to-fp-migration/#33","title":"3.3 \u30a4\u30d9\u30f3\u30c8\u30bd\u30fc\u30b7\u30f3\u30b0\u79fb\u884c","text":"<p>\u72b6\u614b\u3092\u30a4\u30d9\u30f3\u30c8\u306e\u5c65\u6b74\u3068\u3057\u3066\u8868\u73fe\u3002</p> <pre><code>(defn account-event [event-type data]\n  {:event-type event-type\n   :data data\n   :timestamp (System/currentTimeMillis)})\n\n(defn apply-event [account event]\n  (case (:event-type event)\n    :created (merge account (:data event))\n    :deposited (fp/deposit account (:amount (:data event)))\n    :withdrawn (fp/withdraw account (:amount (:data event)))\n    account))\n\n(defn replay-events [events]\n  (reduce apply-event {} events))\n\n;; \u65e2\u5b58\u30c7\u30fc\u30bf\u304b\u3089\u30a4\u30d9\u30f3\u30c8\u3078\u306e\u5909\u63db\n(defn migrate-to-event-sourcing [account]\n  (let [creation-event (account-event :created\n                                      {:id (:id account)\n                                       :balance 0\n                                       :transactions []})\n        transaction-events (map (fn [tx]\n                                  (account-event\n                                   (if (= :deposit (:type tx))\n                                     :deposited\n                                     :withdrawn)\n                                   tx))\n                                (:transactions account))]\n    (cons creation-event transaction-events)))\n</code></pre> <p>\u5229\u70b9: - \u5b8c\u5168\u306a\u76e3\u67fb\u8a3c\u8de1 - \u4efb\u610f\u306e\u6642\u70b9\u306e\u72b6\u614b\u3092\u518d\u69cb\u7bc9\u53ef\u80fd - \u30c7\u30d0\u30c3\u30b0\u304c\u5bb9\u6613</p>"},{"location":"clojure/22-oo-to-fp-migration/#34","title":"3.4 \u6bb5\u968e\u7684\u306a\u95a2\u6570\u62bd\u51fa","text":"<p>\u526f\u4f5c\u7528\u3092\u542b\u3080\u30b3\u30fc\u30c9\u304b\u3089\u7d14\u7c8b\u30ed\u30b8\u30c3\u30af\u3092\u6bb5\u968e\u7684\u306b\u62bd\u51fa\u3002</p> <p></p> <pre><code>;; Step 1: \u8a08\u7b97\u30ed\u30b8\u30c3\u30af\u3092\u7d14\u7c8b\u95a2\u6570\u306b\u62bd\u51fa\n(defn calculate-interest [balance rate days]\n  (* balance rate (/ days 365.0)))\n\n(defn calculate-fee [balance fee-structure]\n  (cond\n    (&lt; balance (:minimum-balance fee-structure))\n    (:low-balance-fee fee-structure)\n\n    (&gt; balance (:premium-threshold fee-structure))\n    0\n\n    :else\n    (:standard-fee fee-structure)))\n\n;; Step 2: \u696d\u52d9\u30eb\u30fc\u30eb\u3092\u7d14\u7c8b\u95a2\u6570\u3068\u3057\u3066\u8868\u73fe\n(defn can-withdraw? [account amount overdraft-limit]\n  (&gt;= (+ (:balance account) overdraft-limit) amount))\n\n(defn calculate-new-balance [current-balance operation amount]\n  (case operation\n    :deposit (+ current-balance amount)\n    :withdraw (- current-balance amount)\n    current-balance))\n\n;; Step 3: \u526f\u4f5c\u7528\u3092\u5883\u754c\u306b\u62bc\u3057\u51fa\u3059\n(defn process-transaction [account operation amount rules]\n  (let [{:keys [overdraft-limit]} rules\n        can-process? (case operation\n                       :deposit true\n                       :withdraw (can-withdraw? account amount overdraft-limit))]\n    (if can-process?\n      {:success true\n       :account (-&gt; account\n                    (update :balance calculate-new-balance operation amount)\n                    (update :transactions conj {:type operation :amount amount}))}\n      {:success false\n       :account account\n       :error \"Insufficient funds\"})))\n</code></pre>"},{"location":"clojure/22-oo-to-fp-migration/#4","title":"4. \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u591a\u614b\u6027","text":""},{"location":"clojure/22-oo-to-fp-migration/#41","title":"4.1 \u7d99\u627f\u304b\u3089\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u3078","text":"<pre><code>;; FP\u30b9\u30bf\u30a4\u30eb: \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u3067\u591a\u614b\u6027\u3092\u5b9f\u73fe\n(defn make-circle [x y radius]\n  {:type :circle :x x :y y :radius radius})\n\n(defn make-rectangle [x y width height]\n  {:type :rectangle :x x :y y :width width :height height})\n\n(defmulti area :type)\n\n(defmethod area :circle [shape]\n  (* Math/PI (:radius shape) (:radius shape)))\n\n(defmethod area :rectangle [shape]\n  (* (:width shape) (:height shape)))\n\n(defmulti scale :type)\n\n(defmethod scale :circle [shape factor]\n  (update shape :radius * factor))\n\n(defmethod scale :rectangle [shape factor]\n  (-&gt; shape\n      (update :width * factor)\n      (update :height * factor)))\n</code></pre>"},{"location":"clojure/22-oo-to-fp-migration/#42","title":"4.2 \u5171\u901a\u64cd\u4f5c\u306e\u5b9f\u88c5","text":"<pre><code>;; \u578b\u306b\u4f9d\u5b58\u3057\u306a\u3044\u5171\u901a\u64cd\u4f5c\n(defn move [shape dx dy]\n  (-&gt; shape\n      (update :x + dx)\n      (update :y + dy)))\n\n;; \u3059\u3079\u3066\u306e\u56f3\u5f62\u3067\u4f7f\u7528\u53ef\u80fd\n(move (make-circle 0 0 10) 5 3)\n;; =&gt; {:type :circle :x 5 :y 3 :radius 10}\n\n(move (make-rectangle 0 0 10 20) 5 3)\n;; =&gt; {:type :rectangle :x 5 :y 3 :width 10 :height 20}\n</code></pre>"},{"location":"clojure/22-oo-to-fp-migration/#5","title":"5. \u30a4\u30d9\u30f3\u30c8\u99c6\u52d5\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3","text":""},{"location":"clojure/22-oo-to-fp-migration/#51-fp","title":"5.1 FP \u30b9\u30bf\u30a4\u30eb\u306e\u30a4\u30d9\u30f3\u30c8\u30b7\u30b9\u30c6\u30e0","text":"<pre><code>(defn make-event-system []\n  {:handlers {}\n   :event-log []})\n\n(defn subscribe [system event-type handler]\n  (update-in system [:handlers event-type]\n             (fnil conj []) handler))\n\n(defn publish [system event-type data]\n  (let [handlers (get-in system [:handlers event-type] [])\n        event {:type event-type :data data}\n        results (mapv #(% event) handlers)]\n    {:system (update system :event-log conj event)\n     :results results}))\n\n(defn get-event-log [system]\n  (:event-log system))\n</code></pre> <p>\u4f7f\u7528\u4f8b: <pre><code>(let [system (-&gt; (make-event-system)\n                 (subscribe :user-created\n                            (fn [e] (println \"User created:\" (:data e))))\n                 (subscribe :user-created\n                            (fn [e] (str \"Welcome, \" (:name (:data e))))))]\n  (publish system :user-created {:name \"John\" :email \"john@example.com\"}))\n</code></pre></p>"},{"location":"clojure/22-oo-to-fp-migration/#6","title":"6. \u79fb\u884c\u306e\u30c1\u30a7\u30c3\u30af\u30ea\u30b9\u30c8","text":""},{"location":"clojure/22-oo-to-fp-migration/#61","title":"6.1 \u6e96\u5099\u30d5\u30a7\u30fc\u30ba","text":"<ul> <li> \u73fe\u5728\u306e\u30b3\u30fc\u30c9\u306e\u72b6\u614b\u3092\u628a\u63e1</li> <li> \u30c6\u30b9\u30c8\u30ab\u30d0\u30ec\u30c3\u30b8\u3092\u78ba\u8a8d</li> <li> \u79fb\u884c\u306e\u512a\u5148\u9806\u4f4d\u3092\u6c7a\u5b9a</li> <li> \u30c1\u30fc\u30e0\u3078\u306e\u6559\u80b2</li> </ul>"},{"location":"clojure/22-oo-to-fp-migration/#62","title":"6.2 \u5b9f\u884c\u30d5\u30a7\u30fc\u30ba","text":"<ul> <li> \u7d14\u7c8b\u95a2\u6570\u3092\u62bd\u51fa</li> <li> \u526f\u4f5c\u7528\u3092\u5206\u96e2</li> <li> \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u79fb\u884c</li> <li> \u30c6\u30b9\u30c8\u3092\u8ffd\u52a0</li> </ul>"},{"location":"clojure/22-oo-to-fp-migration/#63","title":"6.3 \u5b8c\u4e86\u30d5\u30a7\u30fc\u30ba","text":"<ul> <li> \u53e4\u3044\u30b3\u30fc\u30c9\u3092\u524a\u9664</li> <li> \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u66f4\u65b0</li> <li> \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3092\u78ba\u8a8d</li> <li> \u30c1\u30fc\u30e0\u30ec\u30d3\u30e5\u30fc</li> </ul>"},{"location":"clojure/22-oo-to-fp-migration/#7","title":"7. \u30c6\u30b9\u30c8\u30b3\u30fc\u30c9","text":"<pre><code>(describe \"OO \u304b\u3089 FP \u3078\u306e\u79fb\u884c\"\n\n  (describe \"FP \u30b9\u30bf\u30a4\u30eb\"\n    (it \"\u5165\u91d1\u304c\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\"\n      (let [acc (fp/make-account \"A001\" 1000)\n            new-acc (fp/deposit acc 500)]\n        (should= 1000 (fp/get-balance acc))\n        (should= 1500 (fp/get-balance new-acc))))\n\n    (it \"\u9001\u91d1\u304c\u6b63\u3057\u304f\u52d5\u4f5c\u3059\u308b\"\n      (let [from (fp/make-account \"A001\" 1000)\n            to (fp/make-account \"A002\" 500)\n            result (fp/transfer from to 300)]\n        (should (:success result))\n        (should= 700 (fp/get-balance (:from result)))\n        (should= 800 (fp/get-balance (:to result))))))\n\n  (describe \"\u79fb\u884c\u6226\u7565\"\n    (it \"\u30a2\u30c0\u30d7\u30bf\u30fc\u3067\u65e2\u5b58\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u7dad\u6301\"\n      (let [adapter (ms/make-fp-account-adapter \"A001\" 1000)]\n        (ms/deposit-to-account adapter 500)\n        (should= 1500 (ms/get-account-balance adapter))))\n\n    (it \"\u30a4\u30d9\u30f3\u30c8\u3092\u30ea\u30d7\u30ec\u30a4\u3067\u304d\u308b\"\n      (let [events [(ms/account-event :created {:id \"A001\" :balance 0 :transactions []})\n                    (ms/account-event :deposited {:amount 1000})\n                    (ms/account-event :withdrawn {:amount 300})]\n            account (ms/replay-events events)]\n        (should= 700 (:balance account))))))\n</code></pre>"},{"location":"clojure/22-oo-to-fp-migration/#8","title":"8. \u307e\u3068\u3081","text":""},{"location":"clojure/22-oo-to-fp-migration/#_2","title":"\u79fb\u884c\u306e\u30dd\u30a4\u30f3\u30c8","text":"<ol> <li>\u6bb5\u968e\u7684\u306b\u9032\u3081\u308b: \u4e00\u5ea6\u306b\u3059\u3079\u3066\u3092\u5909\u66f4\u3057\u306a\u3044</li> <li>\u30c6\u30b9\u30c8\u3092\u66f8\u304f: \u79fb\u884c\u524d\u5f8c\u306e\u52d5\u4f5c\u3092\u4fdd\u8a3c</li> <li>\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u6d3b\u7528: \u65e2\u5b58\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u7dad\u6301</li> <li>\u7d14\u7c8b\u95a2\u6570\u304b\u3089\u59cb\u3081\u308b: \u8a08\u7b97\u30ed\u30b8\u30c3\u30af\u3092\u5148\u306b\u62bd\u51fa</li> </ol>"},{"location":"clojure/22-oo-to-fp-migration/#_3","title":"\u95a2\u6570\u578b\u306e\u5229\u70b9","text":"\u5074\u9762 OO FP \u30c6\u30b9\u30c8 \u30e2\u30c3\u30af\u304c\u5fc5\u8981 \u5165\u529b \u2192 \u51fa\u529b\u306e\u307f \u30c7\u30d0\u30c3\u30b0 \u72b6\u614b\u306e\u8ffd\u8de1\u304c\u56f0\u96e3 \u5024\u304c\u4e0d\u5909\u3067\u8ffd\u8de1\u5bb9\u6613 \u4e26\u884c\u51e6\u7406 \u30ed\u30c3\u30af\u304c\u5fc5\u8981 \u4e0d\u5909\u30c7\u30fc\u30bf\u3067\u5b89\u5168 \u518d\u5229\u7528 \u7d99\u627f\u306e\u5236\u7d04 \u95a2\u6570\u5408\u6210\u3067\u81ea\u7531"},{"location":"clojure/22-oo-to-fp-migration/#_4","title":"\u6700\u7d42\u7684\u306a\u30b4\u30fc\u30eb","text":""},{"location":"clojure/22-oo-to-fp-migration/#_5","title":"\u30b7\u30ea\u30fc\u30ba\u306e\u307e\u3068\u3081","text":"<p>\u672c\u30b7\u30ea\u30fc\u30ba\u3092\u901a\u3058\u3066\u3001\u4ee5\u4e0b\u3092\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u57fa\u790e\u539f\u5247: \u4e0d\u5909\u6027\u3001\u95a2\u6570\u5408\u6210\u3001\u591a\u614b\u6027</li> <li>\u4ed5\u69d8\u3068\u30c6\u30b9\u30c8: Spec\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u3001TDD</li> <li>\u69cb\u9020\u30d1\u30bf\u30fc\u30f3: Composite\u3001Decorator\u3001Adapter</li> <li>\u632f\u308b\u821e\u3044\u30d1\u30bf\u30fc\u30f3: Strategy\u3001Command\u3001Visitor</li> <li>\u751f\u6210\u30d1\u30bf\u30fc\u30f3: Abstract Factory\u3001Abstract Server</li> <li>\u30b1\u30fc\u30b9\u30b9\u30bf\u30c7\u30a3: \u5b9f\u8df5\u7684\u306a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3</li> <li>\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9: \u30c7\u30fc\u30bf\u4e2d\u5fc3\u8a2d\u8a08\u3001\u30c6\u30b9\u30c8\u53ef\u80fd\u306a\u8a2d\u8a08</li> </ol> <p>\u95a2\u6570\u578b\u30c7\u30b6\u30a4\u30f3\u306f\u3001\u30b7\u30f3\u30d7\u30eb\u3067\u4fdd\u5b88\u3057\u3084\u3059\u304f\u3001\u30c6\u30b9\u30c8\u3057\u3084\u3059\u3044\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u69cb\u7bc9\u3059\u308b\u305f\u3081\u306e\u5f37\u529b\u306a\u30a2\u30d7\u30ed\u30fc\u30c1\u3067\u3059\u3002\u3053\u308c\u3089\u306e\u539f\u5247\u3068\u30d1\u30bf\u30fc\u30f3\u3092\u6d3b\u7528\u3057\u3066\u3001\u3088\u308a\u826f\u3044\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u4f5c\u6210\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p> <p>Simple made easy.</p>"},{"location":"elixir/","title":"Elixir \u3067\u5b66\u3076\u95a2\u6570\u578b\u30c7\u30b6\u30a4\u30f3","text":""},{"location":"elixir/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u8a18\u4e8b\u30b7\u30ea\u30fc\u30ba\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u304a\u3051\u308b\u8a2d\u8a08\u539f\u5247\u3068\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u3092 Elixir \u3092\u4f7f\u3063\u3066\u5b9f\u8df5\u7684\u306b\u5b66\u3076\u305f\u3081\u306e\u30ac\u30a4\u30c9\u3067\u3059\u3002Elixir \u306f Erlang VM \u4e0a\u3067\u52d5\u4f5c\u3059\u308b\u95a2\u6570\u578b\u8a00\u8a9e\u3067\u3042\u308a\u3001\u4e0d\u5909\u30c7\u30fc\u30bf\u3001\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3001\u4e26\u884c\u51e6\u7406\u306b\u512a\u308c\u305f\u7279\u6027\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u7279\u6027\u3092\u6d3b\u304b\u3057\u3001\u5f93\u6765\u306e\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u3092\u95a2\u6570\u578b\u30d1\u30e9\u30c0\u30a4\u30e0\u3067\u3069\u306e\u3088\u3046\u306b\u8868\u73fe\u3057\u3001\u6d3b\u7528\u3067\u304d\u308b\u304b\u3092\u63a2\u6c42\u3057\u307e\u3059\u3002</p>"},{"location":"elixir/#_2","title":"\u8a18\u4e8b\u69cb\u6210","text":""},{"location":"elixir/#1","title":"\u7b2c1\u90e8: \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u57fa\u790e\u539f\u5247","text":"<ol> <li>\u4e0d\u5909\u6027\u3068\u30c7\u30fc\u30bf\u5909\u63db</li> <li>\u30de\u30c3\u30d7\u3068\u69cb\u9020\u4f53\u306b\u3088\u308b\u4e0d\u5909\u30c7\u30fc\u30bf</li> <li>\u30d1\u30a4\u30d7\u6f14\u7b97\u5b50\u306b\u3088\u308b\u30c7\u30fc\u30bf\u5909\u63db</li> <li> <p>Enum \u3068 Stream \u306b\u3088\u308b\u9045\u5ef6\u8a55\u4fa1</p> </li> <li> <p>\u95a2\u6570\u5408\u6210\u3068\u9ad8\u968e\u95a2\u6570</p> </li> <li>\u7121\u540d\u95a2\u6570\u3068\u30ad\u30e3\u30d7\u30c1\u30e3\u6f14\u7b97\u5b50</li> <li>\u95a2\u6570\u5408\u6210\u306e\u30d1\u30bf\u30fc\u30f3</li> <li> <p>\u9ad8\u968e\u95a2\u6570\u306e\u6d3b\u7528</p> </li> <li> <p>\u591a\u614b\u6027\u306e\u5b9f\u73fe\u65b9\u6cd5</p> </li> <li>\u30d7\u30ed\u30c8\u30b3\u30eb\u306b\u3088\u308b\u591a\u614b\u6027</li> <li>\u30d3\u30d8\u30a4\u30d3\u30a2\u3068\u30b3\u30fc\u30eb\u30d0\u30c3\u30af</li> <li>\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u306b\u3088\u308b\u578b\u306e\u5207\u308a\u66ff\u3048</li> </ol>"},{"location":"elixir/#2","title":"\u7b2c2\u90e8: \u4ed5\u69d8\u3068\u30c6\u30b9\u30c8","text":"<ol> <li>\u30c7\u30fc\u30bf\u691c\u8a3c</li> <li>Ecto.Changeset \u306b\u3088\u308b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3</li> <li>\u30ab\u30b9\u30bf\u30e0\u30d0\u30ea\u30c7\u30fc\u30bf\u306e\u4f5c\u6210</li> <li> <p>with \u5f0f\u306b\u3088\u308b\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0</p> </li> <li> <p>\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8</p> </li> <li>StreamData \u306e\u57fa\u672c</li> <li>\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u306e\u4f5c\u6210</li> <li> <p>\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u5b9a\u7fa9\u3068\u691c\u8a3c</p> </li> <li> <p>TDD \u3068\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0</p> </li> <li>ExUnit \u306b\u3088\u308b\u30c6\u30b9\u30c8</li> <li>Red-Green-Refactor \u30b5\u30a4\u30af\u30eb</li> <li>\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30c6\u30b9\u30c8\uff08doctest\uff09</li> </ol>"},{"location":"elixir/#3","title":"\u7b2c3\u90e8: \u69cb\u9020\u30d1\u30bf\u30fc\u30f3","text":"<ol> <li>Composite \u30d1\u30bf\u30fc\u30f3</li> <li>\u518d\u5e30\u7684\u306a\u30c7\u30fc\u30bf\u69cb\u9020</li> <li>\u30cd\u30b9\u30c8\u3057\u305f\u69cb\u9020\u306e\u64cd\u4f5c</li> <li> <p>\u30a2\u30ad\u30e5\u30e0\u30ec\u30fc\u30bf\u3092\u4f7f\u3063\u305f\u8d70\u67fb</p> </li> <li> <p>Decorator \u30d1\u30bf\u30fc\u30f3</p> </li> <li>\u95a2\u6570\u5408\u6210\u306b\u3088\u308b\u30c7\u30b3\u30ec\u30fc\u30b7\u30e7\u30f3</li> <li>\u9ad8\u968e\u95a2\u6570\u3067\u306e\u30e9\u30c3\u30d4\u30f3\u30b0</li> <li> <p>\u30de\u30af\u30ed\u306b\u3088\u308b\u632f\u308b\u821e\u3044\u306e\u8ffd\u52a0</p> </li> <li> <p>Adapter \u30d1\u30bf\u30fc\u30f3</p> </li> <li>\u95a2\u6570\u30a2\u30c0\u30d7\u30bf\u30fc</li> <li>\u30d7\u30ed\u30c8\u30b3\u30eb\u5909\u63db</li> <li>\u30ec\u30ac\u30b7\u30fc\u30b3\u30fc\u30c9\u3068\u306e\u7d71\u5408</li> </ol>"},{"location":"elixir/#4","title":"\u7b2c4\u90e8: \u632f\u308b\u821e\u3044\u30d1\u30bf\u30fc\u30f3","text":"<ol> <li> <p>Strategy \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>\u7b2c\u4e00\u7d1a\u95a2\u6570\u3068\u3057\u3066\u306e\u6226\u7565</li> <li>\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u3088\u308b\u6226\u7565\u5b9f\u88c5</li> <li>\u52d5\u7684\u306a\u6226\u7565\u5207\u308a\u66ff\u3048</li> </ul> </li> <li> <p>Command \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>\u4e0d\u5909\u30b3\u30de\u30f3\u30c9\u30c7\u30fc\u30bf</li> <li>\u30b3\u30de\u30f3\u30c9\u306e\u5c65\u6b74\u3068 Undo</li> <li>GenServer \u306b\u3088\u308b\u30b3\u30de\u30f3\u30c9\u7ba1\u7406</li> </ul> </li> <li> <p>Visitor \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u306b\u3088\u308b\u8a2a\u554f</li> <li>\u30d7\u30ed\u30c8\u30b3\u30eb\u30d9\u30fc\u30b9\u306e\u30d3\u30b8\u30bf\u30fc</li> <li>Enum.reduce \u306b\u3088\u308b\u8d70\u67fb</li> </ul> </li> </ol>"},{"location":"elixir/#5","title":"\u7b2c5\u90e8: \u751f\u6210\u30d1\u30bf\u30fc\u30f3","text":"<ol> <li> <p>Abstract Factory \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>\u95a2\u6570\u30d5\u30a1\u30af\u30c8\u30ea\u30fc</li> <li>\u30e2\u30b8\u30e5\u30fc\u30eb\u30d9\u30fc\u30b9\u306e\u751f\u6210</li> <li>\u8a2d\u5b9a\u306b\u3088\u308b\u4f9d\u5b58\u6027\u6ce8\u5165</li> </ul> </li> <li> <p>Abstract Server \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>\u30d3\u30d8\u30a4\u30d3\u30a2\u306b\u3088\u308b\u62bd\u8c61\u5316</li> <li>\u5b9f\u88c5\u306e\u5dee\u3057\u66ff\u3048</li> <li>\u30c6\u30b9\u30bf\u30d6\u30eb\u306a\u8a2d\u8a08</li> </ul> </li> </ol>"},{"location":"elixir/#6","title":"\u7b2c6\u90e8: \u30b1\u30fc\u30b9\u30b9\u30bf\u30c7\u30a3","text":"<ol> <li> <p>\u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b</p> <ul> <li>Agent \u306b\u3088\u308b\u72b6\u614b\u7ba1\u7406</li> <li>\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u306e\u5b9f\u88c5</li> <li>\u518d\u5e30\u7684\u306a\u51e6\u7406</li> </ul> </li> <li> <p>\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0</p> <ul> <li>\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30ea\u30f3\u30b0</li> <li>\u591a\u614b\u7684\u306a\u8a08\u7b97</li> <li>\u30ec\u30dd\u30fc\u30c8\u751f\u6210</li> </ul> </li> <li> <p>\u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0</p> <ul> <li>\u72b6\u614b\u9077\u79fb\u306e\u7ba1\u7406</li> <li>\u30a4\u30d9\u30f3\u30c8\u30bd\u30fc\u30b7\u30f3\u30b0</li> <li>\u30d3\u30b8\u30cd\u30b9\u30eb\u30fc\u30eb\u306e\u5b9f\u88c5</li> </ul> </li> <li> <p>\u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0</p> <ul> <li>GenServer \u306b\u3088\u308b\u72b6\u614b\u7ba1\u7406</li> <li>Task \u306b\u3088\u308b\u4e26\u884c\u5b9f\u884c</li> <li>OTP \u30d1\u30bf\u30fc\u30f3</li> </ul> </li> <li> <p>Wa-Tor \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3</p> <ul> <li>\u30bb\u30eb\u30aa\u30fc\u30c8\u30de\u30c8\u30f3</li> <li>\u4e0d\u5909\u30b0\u30ea\u30c3\u30c9\u306e\u66f4\u65b0</li> <li>\u30d7\u30ed\u30bb\u30b9\u30d9\u30fc\u30b9\u306e\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3</li> </ul> </li> </ol>"},{"location":"elixir/#7","title":"\u7b2c7\u90e8: \u307e\u3068\u3081\u3068\u5fdc\u7528","text":"<ol> <li> <p>\u30d1\u30bf\u30fc\u30f3\u9593\u306e\u76f8\u4e92\u4f5c\u7528</p> <ul> <li>Composite + Decorator</li> <li>Command + Observer</li> <li>\u30d1\u30bf\u30fc\u30f3\u306e\u7d44\u307f\u5408\u308f\u305b</li> </ul> </li> <li> <p>\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9</p> <ul> <li>\u30c7\u30fc\u30bf\u4e2d\u5fc3\u8a2d\u8a08</li> <li>\u7d14\u7c8b\u95a2\u6570\u306e\u5206\u96e2</li> <li>OTP \u30d1\u30bf\u30fc\u30f3\u306e\u6d3b\u7528</li> <li>\u30c6\u30b9\u30bf\u30d6\u30eb\u306a\u8a2d\u8a08</li> </ul> </li> <li> <p>OO \u304b\u3089 FP \u3078\u306e\u79fb\u884c</p> <ul> <li>\u79fb\u884c\u6226\u7565\uff08Strangler Fig\u3001\u30a2\u30c0\u30d7\u30bf\u30fc\uff09</li> <li>\u30a4\u30d9\u30f3\u30c8\u30bd\u30fc\u30b7\u30f3\u30b0</li> <li>\u6bb5\u968e\u7684\u306a\u95a2\u6570\u62bd\u51fa</li> <li>\u30d7\u30ed\u30c8\u30b3\u30eb\u306b\u3088\u308b\u591a\u614b\u6027</li> </ul> </li> </ol>"},{"location":"elixir/#_3","title":"\u672c\u30b7\u30ea\u30fc\u30ba\u306e\u7279\u5fb4","text":""},{"location":"elixir/#elixir_1","title":"Elixir \u306e\u7279\u6027\u3092\u6d3b\u304b\u3057\u305f\u5b9f\u88c5","text":"<p>Elixir \u306e\u5f37\u529b\u306a\u6a5f\u80fd\uff08\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3001\u30d1\u30a4\u30d7\u6f14\u7b97\u5b50\u3001\u30d7\u30ed\u30c8\u30b3\u30eb\u3001OTP \u306a\u3069\uff09\u3092\u6d3b\u7528\u3057\u3001\u5b9f\u8df5\u7684\u306a\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"elixir/#_4","title":"\u4e26\u884c\u51e6\u7406\u306e\u81ea\u7136\u306a\u7d71\u5408","text":"<p>Elixir \u306f Erlang VM \u4e0a\u3067\u52d5\u4f5c\u3059\u308b\u305f\u3081\u3001\u4e26\u884c\u51e6\u7406\u304c\u8a00\u8a9e\u306e\u4e2d\u6838\u306b\u7d44\u307f\u8fbc\u307e\u308c\u3066\u3044\u307e\u3059\u3002\u30a2\u30af\u30bf\u30fc\u30e2\u30c7\u30eb\u3068\u4e0d\u5909\u6027\u306b\u3088\u308a\u3001\u30b9\u30b1\u30fc\u30e9\u30d6\u30eb\u3067\u5805\u7262\u306a\u30b7\u30b9\u30c6\u30e0\u3092\u69cb\u7bc9\u3059\u308b\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"elixir/#_5","title":"\u5b9f\u8df5\u91cd\u8996","text":"<p>\u3059\u3079\u3066\u306e\u30d1\u30bf\u30fc\u30f3\u306f ExUnit \u306b\u3088\u308b\u5b9f\u969b\u306b\u52d5\u4f5c\u3059\u308b\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u3092\u542b\u307f\u307e\u3059\u3002\u7406\u8ad6\u3060\u3051\u3067\u306a\u304f\u3001\u5b9f\u88c5\u3092\u901a\u3058\u3066\u7406\u89e3\u3092\u6df1\u3081\u308b\u3053\u3068\u3092\u91cd\u8996\u3057\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"elixir/#_6","title":"\u6bb5\u968e\u7684\u306a\u5b66\u7fd2","text":"<p>\u57fa\u790e\u304b\u3089\u5fdc\u7528\u3078\u3068\u6bb5\u968e\u7684\u306b\u5185\u5bb9\u304c\u9032\u884c\u3057\u307e\u3059\u3002\u5404\u7ae0\u306f\u72ec\u7acb\u3057\u3066\u8aad\u3080\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u304c\u3001\u9806\u756a\u306b\u8aad\u3080\u3053\u3068\u3067\u3088\u308a\u6df1\u3044\u7406\u89e3\u304c\u5f97\u3089\u308c\u307e\u3059\u3002</p>"},{"location":"elixir/#_7","title":"\u5bfe\u8c61\u8aad\u8005","text":"<ul> <li>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u8208\u5473\u304c\u3042\u308b Elixir \u958b\u767a\u8005</li> <li>Elixir \u3092\u5b66\u7fd2\u4e2d\u306e\u958b\u767a\u8005</li> <li>\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u306e\u77e5\u8b58\u304c\u3042\u308a\u3001\u95a2\u6570\u578b\u3067\u306e\u8868\u73fe\u3092\u5b66\u3073\u305f\u3044\u958b\u767a\u8005</li> <li>Clojure \u7248\u3084\u4ed6\u8a00\u8a9e\u7248\u3068\u6bd4\u8f03\u3057\u3066\u5b66\u7fd2\u3057\u305f\u3044\u958b\u767a\u8005</li> </ul>"},{"location":"elixir/#_8","title":"\u524d\u63d0\u77e5\u8b58","text":"<ul> <li>\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u57fa\u790e\u77e5\u8b58</li> <li>Elixir \u306e\u57fa\u672c\u7684\u306a\u6587\u6cd5\uff08\u30de\u30c3\u30d7\u3001\u69cb\u9020\u4f53\u3001\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u306a\u3069\uff09</li> <li>\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u306e\u57fa\u672c\u6982\u5ff5\uff08\u63a8\u5968\uff09</li> </ul>"},{"location":"elixir/#_9","title":"\u958b\u767a\u74b0\u5883","text":"<p>\u672c\u30b7\u30ea\u30fc\u30ba\u306e\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u306e\u74b0\u5883\u3067\u52d5\u4f5c\u78ba\u8a8d\u3057\u3066\u3044\u307e\u3059\uff1a</p> <ul> <li>Elixir 1.16+</li> <li>Erlang/OTP 26+</li> <li>Mix \u30d3\u30eb\u30c9\u30c4\u30fc\u30eb</li> <li>ExUnit \u30c6\u30b9\u30c8\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af</li> <li>Nix \u306b\u3088\u308b\u74b0\u5883\u7ba1\u7406</li> </ul>"},{"location":"elixir/#_10","title":"\u74b0\u5883\u69cb\u7bc9","text":"<pre><code># Nix \u3092\u4f7f\u7528\u3057\u305f\u958b\u767a\u74b0\u5883\u306e\u8d77\u52d5\nnix develop .#elixir\n\n# \u30c6\u30b9\u30c8\u306e\u5b9f\u884c\ncd app/elixir/part1\nmix test\n</code></pre>"},{"location":"elixir/#_11","title":"\u53c2\u8003\u66f8\u7c4d","text":"<p>\u672c\u30b7\u30ea\u30fc\u30ba\u306f\u4ee5\u4e0b\u306e\u66f8\u7c4d\u306e\u5185\u5bb9\u3092\u53c2\u8003\u306b\u3057\u3066\u3044\u307e\u3059\uff1a</p> <ul> <li>\u300cFunctional Design: Principles, Patterns, and Practices\u300dRobert C. Martin</li> <li>\u300cProgramming Elixir\u300dDave Thomas</li> <li>\u300cElixir in Action\u300dSa\u0161a Juri\u0107</li> <li>\u300cDesigning Elixir Systems with OTP\u300dJames Edward Gray II, Bruce A. Tate</li> </ul>"},{"location":"elixir/01-immutability-and-data-transformation/","title":"\u7b2c1\u7ae0: \u4e0d\u5909\u6027\u3068\u30c7\u30fc\u30bf\u5909\u63db","text":""},{"location":"elixir/01-immutability-and-data-transformation/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u6700\u3082\u91cd\u8981\u306a\u6982\u5ff5\u306e\u4e00\u3064\u304c\u4e0d\u5909\u6027\uff08Immutability\uff09\u3067\u3059\u3002\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u4e88\u6e2c\u53ef\u80fd\u6027\u304c\u5411\u4e0a\u3057\u3001\u4e26\u884c\u51e6\u7406\u3067\u306e\u30d0\u30b0\u3092\u9632\u304e\u3001\u30b3\u30fc\u30c9\u306e\u7406\u89e3\u3068\u4fdd\u5b88\u304c\u5bb9\u6613\u306b\u306a\u308a\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001Elixir \u306b\u304a\u3051\u308b\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u57fa\u672c\u304b\u3089\u3001\u30d1\u30a4\u30d7\u6f14\u7b97\u5b50\u306b\u3088\u308b\u30c7\u30fc\u30bf\u5909\u63db\u3001\u526f\u4f5c\u7528\u306e\u5206\u96e2\u307e\u3067\u3001\u5b9f\u8df5\u7684\u306a\u4f8b\u3092\u901a\u3058\u3066\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"elixir/01-immutability-and-data-transformation/#1_1","title":"1. \u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u57fa\u672c","text":""},{"location":"elixir/01-immutability-and-data-transformation/#_2","title":"\u306a\u305c\u4e0d\u5909\u6027\u304c\u91cd\u8981\u306a\u306e\u304b","text":"<p>Elixir \u3067\u306f\u3059\u3079\u3066\u306e\u30c7\u30fc\u30bf\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u4e0d\u5909\u3067\u3059\u3002\u30c7\u30fc\u30bf\u3092\u300c\u5909\u66f4\u300d\u3059\u308b\u3068\u3001\u5e38\u306b\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u69cb\u9020\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\uff1a</p> <pre><code>defmodule Person do\n  @enforce_keys [:name, :age]\n  defstruct [:name, :age]\nend\n\ndef update_age(%Person{} = person, new_age) do\n  %{person | age: new_age}\nend\n\n# \u4f7f\u7528\u4f8b\noriginal_person = %Person{name: \"\u7530\u4e2d\", age: 30}\nupdated_person = update_age(original_person, 31)\n\noriginal_person   # =&gt; %Person{name: \"\u7530\u4e2d\", age: 30}  \u2190 \u5143\u306e\u30c7\u30fc\u30bf\u306f\u5909\u308f\u3089\u306a\u3044\nupdated_person    # =&gt; %Person{name: \"\u7530\u4e2d\", age: 31}  \u2190 \u65b0\u3057\u3044\u30c7\u30fc\u30bf\n</code></pre>"},{"location":"elixir/01-immutability-and-data-transformation/#_3","title":"\u4e0d\u5909\u6027\u306e\u5229\u70b9","text":"<ol> <li>\u4e88\u6e2c\u53ef\u80fd\u6027: \u30c7\u30fc\u30bf\u304c\u5909\u66f4\u3055\u308c\u306a\u3044\u305f\u3081\u3001\u95a2\u6570\u306e\u52d5\u4f5c\u3092\u4e88\u6e2c\u3057\u3084\u3059\u3044</li> <li>\u30b9\u30ec\u30c3\u30c9\u30bb\u30fc\u30d5: \u8907\u6570\u306e\u30d7\u30ed\u30bb\u30b9\u304b\u3089\u5b89\u5168\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b</li> <li>\u5c65\u6b74\u306e\u4fdd\u6301: \u5909\u66f4\u524d\u306e\u30c7\u30fc\u30bf\u3092\u4fdd\u6301\u3067\u304d\u308b\uff08Undo/Redo \u306e\u5b9f\u88c5\u304c\u5bb9\u6613\uff09</li> <li>\u30c7\u30d0\u30c3\u30b0\u306e\u5bb9\u6613\u3055: \u30c7\u30fc\u30bf\u306e\u5909\u66f4\u5c65\u6b74\u3092\u8ffd\u8de1\u3057\u3084\u3059\u3044</li> </ol>"},{"location":"elixir/01-immutability-and-data-transformation/#2-structural-sharing","title":"2. \u69cb\u9020\u5171\u6709\uff08Structural Sharing\uff09","text":"<p>\u300c\u6bce\u56de\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u4f5c\u6210\u3059\u308b\u3068\u975e\u52b9\u7387\u3067\u306f\uff1f\u300d\u3068\u601d\u3046\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002Elixir \u306e\u6c38\u7d9a\u7684\u30c7\u30fc\u30bf\u69cb\u9020\u306f\u69cb\u9020\u5171\u6709\u306b\u3088\u308a\u3001\u52b9\u7387\u7684\u306b\u30e1\u30e2\u30ea\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002</p> <pre><code>defmodule Member do\n  defstruct [:name, :role]\nend\n\ndefmodule Team do\n  defstruct [:name, :members]\nend\n\ndef add_member(%Team{members: members} = team, %Member{} = member) do\n  %{team | members: members ++ [member]}\nend\n\nteam = %Team{name: \"\u958b\u767a\u30c1\u30fc\u30e0\", members: [\n  %Member{name: \"\u7530\u4e2d\", role: \"developer\"},\n  %Member{name: \"\u9234\u6728\", role: \"designer\"},\n  %Member{name: \"\u4f50\u85e4\", role: \"manager\"}\n]}\n\nnew_team = add_member(team, %Member{name: \"\u5c71\u7530\", role: \"developer\"})\n</code></pre> <p><code>new_team</code> \u306f\u65b0\u3057\u3044 Team \u3067\u3059\u304c\u3001<code>name</code> \u306e\u5024\u3084\u65e2\u5b58\u306e\u30e1\u30f3\u30d0\u30fc\u30c7\u30fc\u30bf\u306f <code>team</code> \u3068\u5171\u6709\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u5909\u66f4\u3055\u308c\u3066\u3044\u306a\u3044\u90e8\u5206\u306f\u30b3\u30d4\u30fc\u3055\u308c\u305a\u3001\u53c2\u7167\u304c\u5171\u6709\u3055\u308c\u307e\u3059\u3002</p> <p></p>"},{"location":"elixir/01-immutability-and-data-transformation/#3","title":"3. \u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u30c7\u30fc\u30bf\u3092\u5909\u63db\u3059\u308b\u4e00\u9023\u306e\u51e6\u7406\u3092\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3068\u3057\u3066\u8868\u73fe\u3057\u307e\u3059\u3002Elixir \u3067\u306f\u30d1\u30a4\u30d7\u6f14\u7b97\u5b50 <code>|&gt;</code> \u3092\u4f7f\u7528\u3057\u3066\u3001\u8aad\u307f\u3084\u3059\u3044\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u69cb\u7bc9\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"elixir/01-immutability-and-data-transformation/#_4","title":"\u5b9f\u8df5\u4f8b\uff1a\u6ce8\u6587\u51e6\u7406\u30b7\u30b9\u30c6\u30e0","text":"<pre><code>defmodule Item do\n  defstruct [:name, :price, :quantity]\nend\n\ndefmodule Customer do\n  defstruct [:name, :membership]\nend\n\ndefmodule Order do\n  defstruct [:items, :customer]\nend\n\n# \u5404\u30a2\u30a4\u30c6\u30e0\u306e\u5c0f\u8a08\u3092\u8a08\u7b97\ndef calculate_subtotal(%Item{price: price, quantity: quantity}) do\n  price * quantity\nend\n\n# \u4f1a\u54e1\u7a2e\u5225\u306b\u5fdc\u3058\u305f\u5272\u5f15\u7387\u3092\u53d6\u5f97\ndef membership_discount(membership) do\n  case membership do\n    \"gold\"   -&gt; 0.1\n    \"silver\" -&gt; 0.05\n    \"bronze\" -&gt; 0.02\n    _        -&gt; 0.0\n  end\nend\n\n# \u6ce8\u6587\u306e\u5408\u8a08\u91d1\u984d\u3092\u8a08\u7b97\ndef calculate_total(items) do\n  items\n  |&gt; Enum.map(&amp;calculate_subtotal/1)\n  |&gt; Enum.sum()\nend\n\n# \u5272\u5f15\u3092\u9069\u7528\u3057\u305f\u91d1\u984d\u3092\u8a08\u7b97\ndef apply_discount(total, membership) do\n  discount_rate = membership_discount(membership)\n  total * (1 - discount_rate)\nend\n\n# \u6ce8\u6587\u3092\u51e6\u7406\u3057\u3001\u5272\u5f15\u5f8c\u306e\u5408\u8a08\u91d1\u984d\u3092\u8fd4\u3059\ndef process_order(%Order{items: items, customer: customer}) do\n  items\n  |&gt; calculate_total()\n  |&gt; apply_discount(customer.membership)\nend\n</code></pre>"},{"location":"elixir/01-immutability-and-data-transformation/#elixir","title":"Elixir \u306e\u30d1\u30a4\u30d7\u6f14\u7b97\u5b50","text":"<p>\u30d1\u30a4\u30d7\u6f14\u7b97\u5b50 <code>|&gt;</code> \u306f\u3001\u5de6\u5074\u306e\u5f0f\u306e\u7d50\u679c\u3092\u53f3\u5074\u306e\u95a2\u6570\u306e\u7b2c\u4e00\u5f15\u6570\u3068\u3057\u3066\u6e21\u3057\u307e\u3059\uff1a</p> <pre><code># \u30d1\u30a4\u30d7\u6f14\u7b97\u5b50\u3092\u4f7f\u7528\nitems\n|&gt; Enum.map(&amp;calculate_subtotal/1)\n|&gt; Enum.sum()\n\n# \u4e0a\u8a18\u3068\u540c\u7b49\u306e\u5165\u308c\u5b50\u547c\u3073\u51fa\u3057\nEnum.sum(Enum.map(items, &amp;calculate_subtotal/1))\n</code></pre> <p>\u30d1\u30a4\u30d7\u6f14\u7b97\u5b50\u3092\u4f7f\u3046\u3068\u3001\u30c7\u30fc\u30bf\u306e\u6d41\u308c\u304c\u4e0a\u304b\u3089\u4e0b\u3078\u3068\u660e\u78ba\u306b\u306a\u308a\u3001\u53ef\u8aad\u6027\u304c\u5411\u4e0a\u3057\u307e\u3059\u3002</p>"},{"location":"elixir/01-immutability-and-data-transformation/#4","title":"4. \u526f\u4f5c\u7528\u306e\u5206\u96e2","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u7d14\u7c8b\u95a2\u6570\u3068\u526f\u4f5c\u7528\u3092\u6301\u3064\u95a2\u6570\u3092\u660e\u78ba\u306b\u5206\u96e2\u3059\u308b\u3053\u3068\u304c\u91cd\u8981\u3067\u3059\u3002</p>"},{"location":"elixir/01-immutability-and-data-transformation/#_5","title":"\u7d14\u7c8b\u95a2\u6570\u3068\u306f","text":"<ul> <li>\u540c\u3058\u5165\u529b\u306b\u5bfe\u3057\u3066\u5e38\u306b\u540c\u3058\u51fa\u529b\u3092\u8fd4\u3059</li> <li>\u5916\u90e8\u306e\u72b6\u614b\u3092\u5909\u66f4\u3057\u306a\u3044\uff08\u526f\u4f5c\u7528\u304c\u306a\u3044\uff09</li> </ul> <pre><code># \u7d14\u7c8b\u95a2\u6570\ndef calculate_tax(amount, tax_rate) do\n  amount * tax_rate\nend\n\n# \u4f55\u5ea6\u547c\u3093\u3067\u3082\u540c\u3058\u7d50\u679c\ncalculate_tax(1000, 0.1)  # =&gt; 100.0\ncalculate_tax(1000, 0.1)  # =&gt; 100.0\n</code></pre>"},{"location":"elixir/01-immutability-and-data-transformation/#_6","title":"\u526f\u4f5c\u7528\u306e\u5206\u96e2\u30d1\u30bf\u30fc\u30f3","text":"<p>\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\uff08\u7d14\u7c8b\u95a2\u6570\uff09\u3068\u526f\u4f5c\u7528\uff08I/O\uff09\u3092\u5206\u96e2\u3057\u307e\u3059\uff1a</p> <pre><code>defmodule Invoice do\n  defstruct [:subtotal, :tax, :total]\nend\n\n# \u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\uff08\u7d14\u7c8b\u95a2\u6570\uff09\ndef calculate_invoice(items, tax_rate) do\n  subtotal = calculate_total(items)\n  tax = calculate_tax(subtotal, tax_rate)\n  total = subtotal + tax\n  %Invoice{subtotal: subtotal, tax: tax, total: total}\nend\n\n# \u526f\u4f5c\u7528\u3092\u542b\u3080\u51e6\u7406\uff08\u5206\u96e2\uff09\ndef save_invoice(%Invoice{} = invoice) do\n  # \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u306e\u4fdd\u5b58\uff08\u526f\u4f5c\u7528\uff09\n  IO.puts(\"Saving invoice: #{inspect(invoice)}\")\n  invoice\nend\n\ndef send_notification(%Invoice{} = invoice, customer_email) do\n  # \u30e1\u30fc\u30eb\u9001\u4fe1\uff08\u526f\u4f5c\u7528\uff09\n  IO.puts(\"Sending notification to: #{customer_email}\")\n  invoice\nend\n\n# \u51e6\u7406\u5168\u4f53\u306e\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\ndef process_and_save_invoice(items, tax_rate, customer_email) do\n  items\n  |&gt; calculate_invoice(tax_rate)\n  |&gt; save_invoice()\n  |&gt; send_notification(customer_email)\nend\n</code></pre> <p>Elixir \u3067\u306f\u6163\u4f8b\u7684\u306b\u526f\u4f5c\u7528\u3092\u6301\u3064\u95a2\u6570\u306b <code>!</code> \u30b5\u30d5\u30a3\u30c3\u30af\u30b9\u3092\u4ed8\u3051\u308b\u3053\u3068\u304c\u3042\u308a\u307e\u3059\uff08\u4f8b\uff1a<code>File.read!</code>\uff09\u3002</p>"},{"location":"elixir/01-immutability-and-data-transformation/#5-undoredo","title":"5. \u6c38\u7d9a\u7684\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u6d3b\u7528\uff1aUndo/Redo \u306e\u5b9f\u88c5","text":"<p>\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u6d3b\u7528\u3059\u308b\u3068\u3001\u5c65\u6b74\u7ba1\u7406\u304c\u975e\u5e38\u306b\u7c21\u5358\u306b\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p> <pre><code>defmodule History do\n  defstruct current: nil, past: [], future: []\nend\n\n# \u7a7a\u306e\u5c65\u6b74\u3092\u4f5c\u6210\ndef create_history, do: %History{}\n\n# \u65b0\u3057\u3044\u72b6\u614b\u3092\u5c65\u6b74\u306b\u30d7\u30c3\u30b7\u30e5\ndef push_state(%History{current: nil} = history, new_state) do\n  %{history | current: new_state}\nend\n\ndef push_state(%History{current: current, past: past} = history, new_state) do\n  %{history | current: new_state, past: [current | past], future: []}\nend\n\n# \u76f4\u524d\u306e\u72b6\u614b\u306b\u623b\u3059\uff08Undo\uff09\ndef undo(%History{past: []} = history), do: history\n\ndef undo(%History{current: current, past: [previous | rest], future: future}) do\n  %History{current: previous, past: rest, future: [current | future]}\nend\n\n# \u3084\u308a\u76f4\u3057\u64cd\u4f5c\uff08Redo\uff09\ndef redo(%History{future: []} = history), do: history\n\ndef redo(%History{current: current, past: past, future: [next | rest]}) do\n  %History{current: next, past: [current | past], future: rest}\nend\n</code></pre>"},{"location":"elixir/01-immutability-and-data-transformation/#_7","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>history =\n  create_history()\n  |&gt; push_state(%{text: \"Hello\"})\n  |&gt; push_state(%{text: \"Hello World\"})\n  |&gt; push_state(%{text: \"Hello World!\"})\n\nhistory.current  # =&gt; %{text: \"Hello World!\"}\n\nafter_undo = undo(history)\nafter_undo.current  # =&gt; %{text: \"Hello World\"}\n\nafter_redo = redo(after_undo)\nafter_redo.current  # =&gt; %{text: \"Hello World!\"}\n</code></pre>"},{"location":"elixir/01-immutability-and-data-transformation/#6-stream","title":"6. Stream \u306b\u3088\u308b\u9045\u5ef6\u8a55\u4fa1","text":"<p>\u8907\u6570\u306e\u5909\u63db\u3092\u884c\u3046\u5834\u5408\u3001\u901a\u5e38\u306e <code>Enum</code> \u3067\u306f\u4e2d\u9593\u30ea\u30b9\u30c8\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002Elixir \u3067\u306f Stream \u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u8907\u6570\u306e\u5909\u63db\u30921\u56de\u306e\u30d1\u30b9\u3067\u51e6\u7406\u3067\u304d\u307e\u3059\u3002</p> <pre><code># \u901a\u5e38\u306e Enum \u51e6\u7406\uff08\u4e2d\u9593\u30ea\u30b9\u30c8\u304c\u4f5c\u6210\u3055\u308c\u308b\uff09\ndef process_items(items) do\n  items\n  |&gt; Enum.filter(&amp;(&amp;1.quantity &gt; 0))\n  |&gt; Enum.map(fn item -&gt;\n    %ProcessedItem{\n      name: item.name,\n      price: item.price,\n      quantity: item.quantity,\n      subtotal: calculate_subtotal(item)\n    }\n  end)\n  |&gt; Enum.filter(&amp;(&amp;1.subtotal &gt; 100))\nend\n\n# Stream \u3092\u4f7f\u7528\u3057\u305f\u9045\u5ef6\u8a55\u4fa1\uff08\u4e2d\u9593\u30ea\u30b9\u30c8\u3092\u4f5c\u6210\u3057\u306a\u3044\uff09\ndef process_items_lazy(items) do\n  items\n  |&gt; Stream.filter(&amp;(&amp;1.quantity &gt; 0))\n  |&gt; Stream.map(fn item -&gt;\n    %ProcessedItem{\n      name: item.name,\n      price: item.price,\n      quantity: item.quantity,\n      subtotal: calculate_subtotal(item)\n    }\n  end)\n  |&gt; Stream.filter(&amp;(&amp;1.subtotal &gt; 100))\n  |&gt; Enum.to_list()\nend\n</code></pre> <p>Stream \u306e\u5229\u70b9\uff1a - \u4e2d\u9593\u30ea\u30b9\u30c8\u3092\u4f5c\u6210\u3057\u306a\u3044 - \u9045\u5ef6\u8a55\u4fa1\u306b\u3088\u308a\u5fc5\u8981\u306a\u8981\u7d20\u306e\u307f\u51e6\u7406 - \u30e1\u30e2\u30ea\u52b9\u7387\u304c\u826f\u3044</p>"},{"location":"elixir/01-immutability-and-data-transformation/#_8","title":"\u7121\u9650\u30b9\u30c8\u30ea\u30fc\u30e0","text":"<p>Stream \u306f\u7121\u9650\u30b7\u30fc\u30b1\u30f3\u30b9\u3082\u6271\u3048\u307e\u3059\uff1a</p> <pre><code>def take_even_numbers(count) do\n  Stream.iterate(1, &amp;(&amp;1 + 1))\n  |&gt; Stream.filter(&amp;(rem(&amp;1, 2) == 0))\n  |&gt; Enum.take(count)\nend\n\ntake_even_numbers(5)  # =&gt; [2, 4, 6, 8, 10]\n</code></pre>"},{"location":"elixir/01-immutability-and-data-transformation/#7","title":"7. \u30cd\u30b9\u30c8\u3057\u305f\u30c7\u30fc\u30bf\u306e\u64cd\u4f5c","text":"<p>Elixir \u306b\u306f <code>get_in</code>\u3001<code>put_in</code>\u3001<code>update_in</code> \u3068\u3044\u3046\u30de\u30af\u30ed\u304c\u3042\u308a\u3001\u30cd\u30b9\u30c8\u3057\u305f\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u7c21\u6f54\u306b\u64cd\u4f5c\u3067\u304d\u307e\u3059\u3002</p> <pre><code>data = %{user: %{profile: %{name: \"\u7530\u4e2d\", age: 30}}}\n\n# \u30cd\u30b9\u30c8\u3057\u305f\u5024\u306e\u53d6\u5f97\nget_in(data, [:user, :profile, :name])  # =&gt; \"\u7530\u4e2d\"\n\n# \u30cd\u30b9\u30c8\u3057\u305f\u5024\u306e\u66f4\u65b0\uff08\u65b0\u3057\u3044\u30de\u30c3\u30d7\u3092\u8fd4\u3059\uff09\nput_in(data, [:user, :profile, :name], \"\u9234\u6728\")\n# =&gt; %{user: %{profile: %{name: \"\u9234\u6728\", age: 30}}}\n\n# \u30cd\u30b9\u30c8\u3057\u305f\u5024\u3092\u95a2\u6570\u3067\u66f4\u65b0\nupdate_in(data, [:user, :profile, :age], &amp;(&amp;1 + 1))\n# =&gt; %{user: %{profile: %{name: \"\u7530\u4e2d\", age: 31}}}\n\n# \u5143\u306e\u30c7\u30fc\u30bf\u306f\u5909\u66f4\u3055\u308c\u306a\u3044\ndata  # =&gt; %{user: %{profile: %{name: \"\u7530\u4e2d\", age: 30}}}\n</code></pre>"},{"location":"elixir/01-immutability-and-data-transformation/#_9","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u57fa\u790e\u3067\u3042\u308b\u4e0d\u5909\u6027\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020: \u69cb\u9020\u4f53\u3068 <code>%{struct | key: value}</code> \u306b\u3088\u308b\u4e0d\u5909\u6027\u306e\u5b9f\u73fe</li> <li>\u69cb\u9020\u5171\u6709: \u52b9\u7387\u7684\u306a\u30e1\u30e2\u30ea\u4f7f\u7528\u3092\u5b9f\u73fe\u3059\u308b\u6c38\u7d9a\u7684\u30c7\u30fc\u30bf\u69cb\u9020</li> <li>\u30d1\u30a4\u30d7\u6f14\u7b97\u5b50: <code>|&gt;</code> \u306b\u3088\u308b\u8aad\u307f\u3084\u3059\u3044\u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3</li> <li>\u526f\u4f5c\u7528\u306e\u5206\u96e2: \u7d14\u7c8b\u95a2\u6570\u3068 I/O \u51e6\u7406\u306e\u660e\u78ba\u306a\u5206\u96e2</li> <li>\u5c65\u6b74\u7ba1\u7406: \u4e0d\u5909\u6027\u3092\u6d3b\u7528\u3057\u305f Undo/Redo \u306e\u7c21\u6f54\u306a\u5b9f\u88c5</li> <li>Stream: \u52b9\u7387\u7684\u306a\u9045\u5ef6\u8a55\u4fa1\u306b\u3088\u308b\u8907\u5408\u5909\u63db</li> <li>\u30cd\u30b9\u30c8\u3057\u305f\u64cd\u4f5c: <code>get_in</code>/<code>put_in</code>/<code>update_in</code> \u306b\u3088\u308b\u7c21\u6f54\u306a\u64cd\u4f5c</li> </ol> <p>\u3053\u308c\u3089\u306e\u6982\u5ff5\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u4ed6\u306e\u3059\u3079\u3066\u306e\u30d1\u30bf\u30fc\u30f3\u306e\u57fa\u76e4\u3068\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"elixir/01-immutability-and-data-transformation/#_10","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/elixir/part1/lib/chapter01.ex</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/elixir/part1/test/chapter01_test.exs</code></li> </ul>"},{"location":"elixir/01-immutability-and-data-transformation/#_11","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001\u95a2\u6570\u5408\u6210\u3068\u9ad8\u968e\u95a2\u6570\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u5c0f\u3055\u306a\u95a2\u6570\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u8907\u96d1\u306a\u51e6\u7406\u3092\u69cb\u7bc9\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"elixir/02-function-composition/","title":"\u7b2c2\u7ae0: \u95a2\u6570\u5408\u6210\u3068\u9ad8\u968e\u95a2\u6570","text":""},{"location":"elixir/02-function-composition/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u771f\u9ac4\u306f\u3001\u5c0f\u3055\u306a\u95a2\u6570\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u8907\u96d1\u306a\u51e6\u7406\u3092\u69cb\u7bc9\u3059\u308b\u3053\u3068\u306b\u3042\u308a\u307e\u3059\u3002\u672c\u7ae0\u3067\u306f\u3001Elixir \u306b\u304a\u3051\u308b\u95a2\u6570\u5408\u6210\u306e\u30c6\u30af\u30cb\u30c3\u30af\u3068\u9ad8\u968e\u95a2\u6570\u306e\u6d3b\u7528\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"elixir/02-function-composition/#1","title":"1. \u95a2\u6570\u5408\u6210\u306e\u57fa\u672c","text":"<p>Elixir \u3067\u306f\u7121\u540d\u95a2\u6570\u3068\u30d1\u30a4\u30d7\u6f14\u7b97\u5b50\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u95a2\u6570\u3092\u5408\u6210\u3067\u304d\u307e\u3059\u3002</p> <pre><code>def add_tax(rate) do\n  fn amount -&gt; amount * (1 + rate) end\nend\n\ndef apply_discount(rate) do\n  fn amount -&gt; amount * (1 - rate) end\nend\n\ndef round_to_yen(amount), do: round(amount)\n\n# \u95a2\u6570\u5408\u6210\uff08\u5de6\u304b\u3089\u53f3\u3078\uff09\ndef compose(fns) do\n  fn input -&gt;\n    Enum.reduce(fns, input, fn f, acc -&gt; f.(acc) end)\n  end\nend\n\n# \u4fa1\u683c\u8a08\u7b97\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\ndef calculate_final_price do\n  discount = apply_discount(0.2)\n  tax = add_tax(0.1)\n\n  fn amount -&gt;\n    amount\n    |&gt; discount.()\n    |&gt; tax.()\n    |&gt; round_to_yen()\n  end\nend\n\n# \u4f7f\u7528\u4f8b\ncalculate = calculate_final_price()\ncalculate.(1000)\n# =&gt; 880\n# \u51e6\u7406\u9806\u5e8f: 1000 \u2192 20%\u5272\u5f15(800) \u2192 10%\u7a0e\u8fbc(880) \u2192 \u4e38\u3081(880)\n</code></pre>"},{"location":"elixir/02-function-composition/#_2","title":"\u95a2\u6570\u5408\u6210\u306e\u5229\u70b9","text":"<ol> <li>\u5ba3\u8a00\u7684\u306a\u8a18\u8ff0: \u51e6\u7406\u306e\u6d41\u308c\u3092\u95a2\u6570\u306e\u30c1\u30a7\u30fc\u30f3\u3068\u3057\u3066\u8868\u73fe</li> <li>\u518d\u5229\u7528\u6027: \u5408\u6210\u3057\u305f\u95a2\u6570\u3092\u5225\u306e\u5834\u6240\u3067\u518d\u5229\u7528\u53ef\u80fd</li> <li>\u30c6\u30b9\u30c8\u5bb9\u6613\u6027: \u5404\u95a2\u6570\u3092\u500b\u5225\u306b\u30c6\u30b9\u30c8\u53ef\u80fd</li> </ol>"},{"location":"elixir/02-function-composition/#2_1","title":"2. \u30ab\u30ea\u30fc\u5316\u3068\u90e8\u5206\u9069\u7528","text":"<p>Elixir \u3067\u306f\u7121\u540d\u95a2\u6570\u3092\u8fd4\u3059\u95a2\u6570\u3092\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u3067\u3001\u30ab\u30ea\u30fc\u5316\u3068\u90e8\u5206\u9069\u7528\u3092\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002</p> <pre><code># \u30ab\u30ea\u30fc\u5316\u3055\u308c\u305f\u95a2\u6570\ndef greet(greeting) do\n  fn name -&gt; \"#{greeting}, #{name}!\" end\nend\n\nsay_hello = greet(\"Hello\")\nsay_goodbye = greet(\"Goodbye\")\n\nsay_hello.(\"\u7530\u4e2d\")    # =&gt; \"Hello, \u7530\u4e2d!\"\nsay_goodbye.(\"\u9234\u6728\")  # =&gt; \"Goodbye, \u9234\u6728!\"\n</code></pre>"},{"location":"elixir/02-function-composition/#_3","title":"\u8907\u6570\u5f15\u6570\u306e\u90e8\u5206\u9069\u7528","text":"<pre><code>defmodule Email do\n  defstruct [:from, :to, :subject, :body]\nend\n\ndef send_email(from) do\n  fn to -&gt;\n    fn subject -&gt;\n      fn body -&gt;\n        %Email{from: from, to: to, subject: subject, body: body}\n      end\n    end\n  end\nend\n\nsend_from_system = send_email(\"system@example.com\")\nsend_notification = send_from_system.(\"user@example.com\").(\"\u901a\u77e5\")\n\nsend_notification.(\"\u30e1\u30c3\u30bb\u30fc\u30b8\u672c\u6587\")\n# =&gt; %Email{from: \"system@example.com\",\n#           to: \"user@example.com\",\n#           subject: \"\u901a\u77e5\",\n#           body: \"\u30e1\u30c3\u30bb\u30fc\u30b8\u672c\u6587\"}\n</code></pre>"},{"location":"elixir/02-function-composition/#3-juxt","title":"3. \u8907\u6570\u306e\u95a2\u6570\u3092\u4e26\u5217\u9069\u7528\uff08juxt\uff09","text":"<p>Clojure \u306e <code>juxt</code> \u306b\u76f8\u5f53\u3059\u308b\u6a5f\u80fd\u306f\u3001Elixir \u3067\u306f\u30bf\u30d7\u30eb\u3084\u95a2\u6570\u3092\u4f7f\u3063\u3066\u8868\u73fe\u3057\u307e\u3059\u3002</p> <pre><code># \u6570\u5024\u30ea\u30b9\u30c8\u306e\u7d71\u8a08\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\ndef get_stats(numbers) do\n  {\n    hd(numbers),\n    List.last(numbers),\n    length(numbers),\n    Enum.min(numbers),\n    Enum.max(numbers)\n  }\nend\n\nget_stats([3, 1, 4, 1, 5, 9, 2, 6])\n# =&gt; {3, 6, 8, 1, 9}\n# (\u6700\u521d\u306e\u5024, \u6700\u5f8c\u306e\u5024, \u8981\u7d20\u6570, \u6700\u5c0f\u5024, \u6700\u5927\u5024)\n\n# juxt \u306e\u6c4e\u7528\u5b9f\u88c5\ndef juxt(fns) do\n  fn input -&gt;\n    fns\n    |&gt; Enum.map(fn f -&gt; f.(input) end)\n    |&gt; List.to_tuple()\n  end\nend\n\njuxt_fn = juxt([&amp;Enum.min/1, &amp;Enum.max/1, &amp;Enum.sum/1])\njuxt_fn.([1, 2, 3, 4, 5])\n# =&gt; {1, 5, 15}\n</code></pre>"},{"location":"elixir/02-function-composition/#4","title":"4. \u9ad8\u968e\u95a2\u6570\u306b\u3088\u308b\u30c7\u30fc\u30bf\u51e6\u7406","text":"<p>\u9ad8\u968e\u95a2\u6570\u3068\u306f\u3001\u95a2\u6570\u3092\u5f15\u6570\u3068\u3057\u3066\u53d7\u3051\u53d6\u308b\u304b\u3001\u95a2\u6570\u3092\u8fd4\u3059\u95a2\u6570\u306e\u3053\u3068\u3067\u3059\u3002</p>"},{"location":"elixir/02-function-composition/#_4","title":"\u30ed\u30b0\u51fa\u529b\u306e\u30e9\u30c3\u30d1\u30fc","text":"<pre><code>def with_logging(f) do\n  fn input -&gt;\n    IO.puts(\"\u5165\u529b: #{inspect(input)}\")\n    result = f.(input)\n    IO.puts(\"\u51fa\u529b: #{inspect(result)}\")\n    result\n  end\nend\n\ndouble_with_log = with_logging(fn x -&gt; x * 2 end)\ndouble_with_log.(5)\n# \u5165\u529b: 5\n# \u51fa\u529b: 10\n# =&gt; 10\n</code></pre>"},{"location":"elixir/02-function-composition/#_5","title":"\u30ea\u30c8\u30e9\u30a4\u6a5f\u80fd\u306e\u8ffd\u52a0","text":"<pre><code>def with_retry(f, max_retries) do\n  fn input -&gt;\n    do_retry(f, input, max_retries, 0)\n  end\nend\n\ndefp do_retry(f, input, max_retries, attempts) do\n  try do\n    f.(input)\n  rescue\n    e -&gt;\n      if attempts &lt; max_retries do\n        do_retry(f, input, max_retries, attempts + 1)\n      else\n        reraise e, __STACKTRACE__\n      end\n  end\nend\n\n# \u4e0d\u5b89\u5b9a\u306aAPI\u547c\u3073\u51fa\u3057\u3092\u30ea\u30c8\u30e9\u30a4\u4ed8\u304d\u3067\u30e9\u30c3\u30d7\nfetch_with_retry = with_retry(fetch_data, 3)\n</code></pre>"},{"location":"elixir/02-function-composition/#_6","title":"\u30e1\u30e2\u5316","text":"<pre><code>def memoize(f) do\n  {:ok, agent} = Agent.start_link(fn -&gt; %{} end)\n\n  memoized_fn = fn input -&gt;\n    Agent.get_and_update(agent, fn cache -&gt;\n      case Map.get(cache, input) do\n        nil -&gt;\n          result = f.(input)\n          {result, Map.put(cache, input, result)}\n\n        cached -&gt;\n          {cached, cache}\n      end\n    end)\n  end\n\n  {:ok, memoized_fn}\nend\n</code></pre>"},{"location":"elixir/02-function-composition/#5","title":"5. \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u51e6\u7406","text":"<p>\u8907\u6570\u306e\u95a2\u6570\u3092\u9806\u6b21\u9069\u7528\u3059\u308b\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002</p> <pre><code>defmodule OrderItem do\n  defstruct [:price, :quantity]\nend\n\ndefmodule Customer do\n  defstruct [:membership]\nend\n\ndefmodule Order do\n  defstruct [:items, :customer, total: 0, shipping: 0]\nend\n\ndef validate_order(%Order{items: []} = _order) do\n  raise ArgumentError, \"\u6ce8\u6587\u306b\u30a2\u30a4\u30c6\u30e0\u304c\u3042\u308a\u307e\u305b\u3093\"\nend\n\ndef validate_order(%Order{} = order), do: order\n\ndef calculate_order_total(%Order{items: items} = order) do\n  total = Enum.reduce(items, 0, fn item, acc -&gt;\n    acc + item.price * item.quantity\n  end)\n  %{order | total: total}\nend\n\ndef apply_order_discount(%Order{customer: customer, total: total} = order) do\n  discount_rates = %{\"gold\" =&gt; 0.1, \"silver\" =&gt; 0.05, \"bronze\" =&gt; 0.02}\n  discount_rate = Map.get(discount_rates, customer.membership, 0.0)\n  %{order | total: total * (1 - discount_rate)}\nend\n\ndef add_shipping(%Order{total: total} = order) do\n  shipping = if total &gt;= 5000, do: 0, else: 500\n  %{order | shipping: shipping, total: total + shipping}\nend\n\n# \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3067\u6ce8\u6587\u3092\u51e6\u7406\ndef process_order_pipeline(order) do\n  order\n  |&gt; validate_order()\n  |&gt; calculate_order_total()\n  |&gt; apply_order_discount()\n  |&gt; add_shipping()\nend\n</code></pre>"},{"location":"elixir/02-function-composition/#6","title":"6. \u95a2\u6570\u5408\u6210\u306b\u3088\u308b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3","text":"<p>\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30ed\u30b8\u30c3\u30af\u3092\u95a2\u6570\u5408\u6210\u3067\u8868\u73fe\u3057\u307e\u3059\u3002</p> <pre><code>defmodule ValidationResult do\n  defstruct [:valid, :value, :error]\nend\n\ndef validator(pred, error_msg) do\n  fn value -&gt;\n    if pred.(value) do\n      %ValidationResult{valid: true, value: value, error: nil}\n    else\n      %ValidationResult{valid: false, value: value, error: error_msg}\n    end\n  end\nend\n\ndef combine_validators(validators) do\n  fn value -&gt;\n    Enum.reduce_while(validators, %ValidationResult{valid: true, value: value},\n      fn v, acc -&gt;\n        result = v.(acc.value)\n        if result.valid, do: {:cont, result}, else: {:halt, result}\n      end)\n  end\nend\n\n# \u500b\u5225\u306e\u30d0\u30ea\u30c7\u30fc\u30bf\nis_positive = validator(fn x -&gt; x &gt; 0 end, \"\u5024\u306f\u6b63\u306e\u6570\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\")\nunder_100 = validator(fn x -&gt; x &lt; 100 end, \"\u5024\u306f100\u672a\u6e80\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\")\n\n# \u30d0\u30ea\u30c7\u30fc\u30bf\u306e\u5408\u6210\nvalidate_quantity = combine_validators([is_positive, under_100])\n\nvalidate_quantity.(50)   # =&gt; %ValidationResult{valid: true, value: 50, error: nil}\nvalidate_quantity.(-1)   # =&gt; %ValidationResult{valid: false, value: -1, error: \"...\"}\n</code></pre>"},{"location":"elixir/02-function-composition/#7","title":"7. \u95a2\u6570\u306e\u5909\u63db","text":"<p>\u95a2\u6570\u81ea\u4f53\u3092\u5909\u63db\u3059\u308b\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u95a2\u6570\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002</p> <pre><code># \u5f15\u6570\u306e\u9806\u5e8f\u3092\u53cd\u8ee2\ndef flip(f) do\n  fn b, a -&gt; f.(a, b) end\nend\n\nsubtract = fn a, b -&gt; a - b end\nflip(subtract).(3, 5)  # =&gt; 2  (5 - 3)\n\n# \u30ab\u30ea\u30fc\u5316\ndef curry(f) do\n  fn a -&gt; fn b -&gt; f.(a, b) end end\nend\n\nadd = fn a, b -&gt; a + b end\ncurried_add = curry(add)\nadd_5 = curried_add.(5)\nadd_5.(3)  # =&gt; 8\n\n# \u88dc\u95a2\u6570\uff08complement\uff09\ndef complement(pred) do\n  fn x -&gt; not pred.(x) end\nend\n\nis_even = fn x -&gt; rem(x, 2) == 0 end\nis_odd = complement(is_even)\nis_odd.(3)  # =&gt; true\n</code></pre>"},{"location":"elixir/02-function-composition/#8","title":"8. \u8ff0\u8a9e\u306e\u5408\u6210","text":"<pre><code>def compose_predicates_and(preds) do\n  fn x -&gt; Enum.all?(preds, fn pred -&gt; pred.(x) end) end\nend\n\ndef compose_predicates_or(preds) do\n  fn x -&gt; Enum.any?(preds, fn pred -&gt; pred.(x) end) end\nend\n\n# \u6709\u52b9\u306a\u5e74\u9f62\u30c1\u30a7\u30c3\u30af\nvalid_age = compose_predicates_and([\n  fn x -&gt; x &gt; 0 end,\n  fn x -&gt; x &lt;= 150 end\n])\n\nvalid_age.(25)   # =&gt; true\nvalid_age.(-1)   # =&gt; false\nvalid_age.(200)  # =&gt; false\n</code></pre>"},{"location":"elixir/02-function-composition/#_7","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u95a2\u6570\u5408\u6210\u3068\u9ad8\u968e\u95a2\u6570\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u95a2\u6570\u5408\u6210: \u8907\u6570\u306e\u95a2\u6570\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u65b0\u3057\u3044\u95a2\u6570\u3092\u4f5c\u6210</li> <li>\u30ab\u30ea\u30fc\u5316: \u5f15\u6570\u3092\u90e8\u5206\u9069\u7528\u3057\u3066\u7279\u5316\u3057\u305f\u95a2\u6570\u3092\u4f5c\u6210</li> <li>juxt: \u8907\u6570\u306e\u95a2\u6570\u3092\u4e26\u5217\u9069\u7528\u3057\u3066\u7d50\u679c\u3092\u53d6\u5f97</li> <li>\u9ad8\u968e\u95a2\u6570: \u30ed\u30b0\u3001\u30ea\u30c8\u30e9\u30a4\u3001\u30e1\u30e2\u5316\u306a\u3069\u306e\u6a2a\u65ad\u7684\u95a2\u5fc3\u4e8b\u3092\u62bd\u8c61\u5316</li> <li>\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3: <code>|&gt;</code> \u6f14\u7b97\u5b50\u3067\u51e6\u7406\u306e\u6d41\u308c\u3092\u95a2\u6570\u306e\u30c1\u30a7\u30fc\u30f3\u3068\u3057\u3066\u8868\u73fe</li> <li>\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3: \u95a2\u6570\u5408\u6210\u306b\u3088\u308b\u67d4\u8edf\u306a\u691c\u8a3c\u30ed\u30b8\u30c3\u30af</li> <li>\u8ff0\u8a9e\u5408\u6210: AND/OR \u3067\u8907\u6570\u306e\u6761\u4ef6\u3092\u7d44\u307f\u5408\u308f\u305b</li> </ol> <p>\u3053\u308c\u3089\u306e\u30c6\u30af\u30cb\u30c3\u30af\u306b\u3088\u308a\u3001\u5c0f\u3055\u304f\u518d\u5229\u7528\u53ef\u80fd\u306a\u95a2\u6570\u304b\u3089\u8907\u96d1\u306a\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u3092\u69cb\u7bc9\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"elixir/02-function-composition/#_8","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/elixir/part1/lib/chapter02.ex</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/elixir/part1/test/chapter02_test.exs</code></li> </ul>"},{"location":"elixir/02-function-composition/#_9","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001\u591a\u614b\u6027\u306e\u5b9f\u73fe\u65b9\u6cd5\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u30d7\u30ed\u30c8\u30b3\u30eb\u3001\u30d3\u30d8\u30a4\u30d3\u30a2\u3001\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3092\u6d3b\u7528\u3057\u305f\u67d4\u8edf\u306a\u8a2d\u8a08\u30d1\u30bf\u30fc\u30f3\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"elixir/03-polymorphism/","title":"\u7b2c3\u7ae0: \u591a\u614b\u6027\u306e\u5b9f\u73fe\u65b9\u6cd5","text":""},{"location":"elixir/03-polymorphism/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u591a\u614b\u6027\uff08\u30dd\u30ea\u30e2\u30fc\u30d5\u30a3\u30ba\u30e0\uff09\u306f\u3001\u540c\u3058\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u7570\u306a\u308b\u632f\u308b\u821e\u3044\u3092\u5b9f\u73fe\u3059\u308b\u5f37\u529b\u306a\u6982\u5ff5\u3067\u3059\u3002Elixir \u3067\u306f\u3001\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3001\u30d7\u30ed\u30c8\u30b3\u30eb\u3001\u30d3\u30d8\u30a4\u30d3\u30a2\u3068\u3044\u3046\u8907\u6570\u306e\u30e1\u30ab\u30cb\u30ba\u30e0\u3067\u591a\u614b\u6027\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u3053\u308c\u3089\u306e\u30e1\u30ab\u30cb\u30ba\u30e0\u3092\u4f7f\u3044\u5206\u3051\u3066\u3001\u67d4\u8edf\u3067\u62e1\u5f35\u6027\u306e\u9ad8\u3044\u30b3\u30fc\u30c9\u3092\u66f8\u304f\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"elixir/03-polymorphism/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u306b\u3088\u308b\u591a\u614b\u6027","text":"<p>Elixir \u3067\u306f\u30bf\u30b0\u4ed8\u304d\u30bf\u30d7\u30eb\u3068\u95a2\u6570\u306e\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3092\u4f7f\u3063\u3066\u3001\u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b\uff08ADT\uff09\u306b\u76f8\u5f53\u3059\u308b\u8a2d\u8a08\u3092\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"elixir/03-polymorphism/#_2","title":"\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9","text":"<pre><code># \u56f3\u5f62\u3092\u30bf\u30b0\u4ed8\u304d\u30bf\u30d7\u30eb\u3067\u8868\u73fe\n@type shape ::\n  {:rectangle, width :: number(), height :: number()}\n  | {:circle, radius :: number()}\n  | {:triangle, base :: number(), height :: number()}\n\n# \u56f3\u5f62\u306e\u9762\u7a4d\u3092\u8a08\u7b97\u3059\u308b\ndef calculate_area({:rectangle, width, height}), do: width * height\ndef calculate_area({:circle, radius}), do: :math.pi() * radius * radius\ndef calculate_area({:triangle, base, height}), do: base * height / 2\n\n# \u4f7f\u7528\u4f8b\ncalculate_area({:rectangle, 4, 5})  # =&gt; 20\ncalculate_area({:circle, 3})        # =&gt; 28.27...\ncalculate_area({:triangle, 6, 5})   # =&gt; 15.0\n</code></pre>"},{"location":"elixir/03-polymorphism/#_3","title":"\u69cb\u9020\u4f53\u3092\u4f7f\u3063\u305f\u591a\u614b\u6027","text":"<pre><code>defmodule Rectangle do\n  defstruct [:width, :height]\nend\n\ndefmodule Circle do\n  defstruct [:radius]\nend\n\ndefmodule Triangle do\n  defstruct [:base, :height]\nend\n\ndef area(%Rectangle{width: w, height: h}), do: w * h\ndef area(%Circle{radius: r}), do: :math.pi() * r * r\ndef area(%Triangle{base: b, height: h}), do: b * h / 2\n\n# \u4f7f\u7528\u4f8b\narea(%Rectangle{width: 4, height: 5})  # =&gt; 20\narea(%Circle{radius: 3})               # =&gt; 28.27...\n</code></pre>"},{"location":"elixir/03-polymorphism/#2","title":"2. \u8907\u5408\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1","text":"<p>\u30bf\u30d7\u30eb\u3092\u4f7f\u3063\u305f\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3067\u3001\u8907\u6570\u306e\u5024\u306b\u57fa\u3065\u304f\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u3092\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002</p> <pre><code>defmodule Payment do\n  defstruct [:method, :currency, :amount]\nend\n\ndefmodule PaymentResult do\n  defstruct [:status, :message, :amount, :converted]\nend\n\ndef process_payment(%Payment{method: method, currency: currency, amount: amount}) do\n  case {method, currency} do\n    {:credit_card, :jpy} -&gt;\n      %PaymentResult{\n        status: \"processed\",\n        message: \"\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\uff08\u5186\uff09\u3067\u51e6\u7406\u3057\u307e\u3057\u305f\",\n        amount: amount\n      }\n\n    {:credit_card, :usd} -&gt;\n      %PaymentResult{\n        status: \"processed\",\n        message: \"Credit card (USD) processed\",\n        amount: amount,\n        converted: amount * 150\n      }\n\n    {:bank_transfer, :jpy} -&gt;\n      %PaymentResult{\n        status: \"pending\",\n        message: \"\u9280\u884c\u632f\u8fbc\u3092\u53d7\u3051\u4ed8\u3051\u307e\u3057\u305f\",\n        amount: amount\n      }\n\n    _ -&gt;\n      %PaymentResult{\n        status: \"error\",\n        message: \"\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u652f\u6255\u3044\u65b9\u6cd5\u3067\u3059\",\n        amount: amount\n      }\n  end\nend\n\n# \u4f7f\u7528\u4f8b\nprocess_payment(%Payment{method: :credit_card, currency: :jpy, amount: 1000})\n# =&gt; %PaymentResult{status: \"processed\", message: \"\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\uff08\u5186\uff09\u3067\u51e6\u7406\u3057\u307e\u3057\u305f\", ...}\n</code></pre>"},{"location":"elixir/03-polymorphism/#3_1","title":"3. \u30d7\u30ed\u30c8\u30b3\u30eb\u306b\u3088\u308b\u591a\u614b\u6027","text":"<p>\u30d7\u30ed\u30c8\u30b3\u30eb\u306f\u3001\u7279\u5b9a\u306e\u64cd\u4f5c\u30bb\u30c3\u30c8\u3092\u5b9a\u7fa9\u3059\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u3059\u3002\u7570\u306a\u308b\u578b\u306b\u5bfe\u3057\u3066\u540c\u3058\u95a2\u6570\u3092\u547c\u3073\u51fa\u305b\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"elixir/03-polymorphism/#_4","title":"\u30d7\u30ed\u30c8\u30b3\u30eb\u306e\u5b9a\u7fa9\u3068\u5b9f\u88c5","text":"<pre><code>defprotocol Describable do\n  @doc \"\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u8aac\u660e\u3092\u8fd4\u3059\"\n  @spec describe(t) :: String.t()\n  def describe(value)\nend\n\ndefmodule Product do\n  defstruct [:name, :price]\nend\n\ndefmodule Service do\n  defstruct [:name, :hourly_rate]\nend\n\ndefimpl Describable, for: Product do\n  def describe(%Product{name: name, price: price}) do\n    \"\u5546\u54c1: #{name} (#{price}\u5186)\"\n  end\nend\n\ndefimpl Describable, for: Service do\n  def describe(%Service{name: name, hourly_rate: rate}) do\n    \"\u30b5\u30fc\u30d3\u30b9: #{name} (\u6642\u7d66#{rate}\u5186)\"\n  end\nend\n\n# \u7d44\u307f\u8fbc\u307f\u578b\u306b\u3082\u5b9f\u88c5\u3067\u304d\u308b\ndefimpl Describable, for: Map do\n  def describe(map) do\n    \"\u30de\u30c3\u30d7 with #{map_size(map)} keys\"\n  end\nend\n\ndefimpl Describable, for: List do\n  def describe(list) do\n    \"\u30ea\u30b9\u30c8 with #{length(list)} elements\"\n  end\nend\n\n# \u4f7f\u7528\u4f8b\nDescribable.describe(%Product{name: \"\u308a\u3093\u3054\", price: 150})\n# =&gt; \"\u5546\u54c1: \u308a\u3093\u3054 (150\u5186)\"\n\nDescribable.describe(%{a: 1, b: 2, c: 3})\n# =&gt; \"\u30de\u30c3\u30d7 with 3 keys\"\n</code></pre>"},{"location":"elixir/03-polymorphism/#_5","title":"\u30d7\u30ed\u30c8\u30b3\u30eb\u306e\u5229\u70b9","text":"<ol> <li>\u62e1\u5f35\u6027: \u65e2\u5b58\u306e\u578b\u306b\u5bfe\u3057\u3066\u5f8c\u304b\u3089\u632f\u308b\u821e\u3044\u3092\u8ffd\u52a0\u53ef\u80fd</li> <li>\u5206\u96e2: \u578b\u5b9a\u7fa9\u3068\u30d7\u30ed\u30c8\u30b3\u30eb\u5b9f\u88c5\u3092\u5225\u30d5\u30a1\u30a4\u30eb\u306b\u5206\u96e2\u53ef\u80fd</li> <li>\u591a\u614b\u6027: \u7570\u306a\u308b\u578b\u306b\u5bfe\u3057\u3066\u7d71\u4e00\u7684\u306a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u63d0\u4f9b</li> </ol>"},{"location":"elixir/03-polymorphism/#4","title":"4. \u30d3\u30d8\u30a4\u30d3\u30a2\u306b\u3088\u308b\u591a\u614b\u6027","text":"<p>\u30d3\u30d8\u30a4\u30d3\u30a2\u306f\u3001\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u5b9f\u88c5\u3059\u3079\u304d\u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u95a2\u6570\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002Java \u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306b\u4f3c\u3066\u3044\u307e\u3059\u3002</p> <pre><code>defmodule Serializer do\n  @callback serialize(data :: any()) :: String.t()\n  @callback deserialize(string :: String.t()) :: any()\nend\n\ndefmodule JsonSerializer do\n  @behaviour Serializer\n\n  @impl Serializer\n  def serialize(data) do\n    # JSON \u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u5b9f\u88c5\n    inspect(data)\n  end\n\n  @impl Serializer\n  def deserialize(_string) do\n    %{}\n  end\nend\n\ndefmodule CsvSerializer do\n  @behaviour Serializer\n\n  @impl Serializer\n  def serialize(data) when is_list(data) do\n    data\n    |&gt; Enum.map(&amp;Enum.join(&amp;1, \",\"))\n    |&gt; Enum.join(\"\\n\")\n  end\n\n  def serialize(_), do: \"\"\n\n  @impl Serializer\n  def deserialize(string) do\n    string\n    |&gt; String.split(\"\\n\")\n    |&gt; Enum.map(&amp;String.split(&amp;1, \",\"))\n  end\nend\n\n# \u4f7f\u7528\u4f8b\nCsvSerializer.serialize([[\"a\", \"b\", \"c\"], [\"1\", \"2\", \"3\"]])\n# =&gt; \"a,b,c\\n1,2,3\"\n</code></pre>"},{"location":"elixir/03-polymorphism/#_6","title":"\u30d3\u30d8\u30a4\u30d3\u30a2\u3068\u30d7\u30ed\u30c8\u30b3\u30eb\u306e\u4f7f\u3044\u5206\u3051","text":"\u7279\u6027 \u30d7\u30ed\u30c8\u30b3\u30eb \u30d3\u30d8\u30a4\u30d3\u30a2 \u30c7\u30a3\u30b9\u30d1\u30c3\u30c1 \u30c7\u30fc\u30bf\u306e\u578b\u306b\u3088\u308b \u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u3088\u308b \u7528\u9014 \u7570\u306a\u308b\u578b\u306b\u540c\u3058\u64cd\u4f5c \u4ea4\u63db\u53ef\u80fd\u306a\u5b9f\u88c5 \u4f8b <code>Enumerable</code>, <code>String.Chars</code> <code>GenServer</code>, <code>Supervisor</code>"},{"location":"elixir/03-polymorphism/#5","title":"5. \u578b\u30af\u30e9\u30b9\u76f8\u5f53\uff08\u30d7\u30ed\u30c8\u30b3\u30eb + \u5b9f\u88c5\uff09","text":"<p>\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u4f7f\u3063\u3066\u3001\u95a2\u6570\u578b\u8a00\u8a9e\u306e\u578b\u30af\u30e9\u30b9\u306b\u76f8\u5f53\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3092\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002</p> <pre><code>defprotocol Monoid do\n  @doc \"\u7d50\u5408\u6f14\u7b97\"\n  @spec combine(t, t) :: t\n  def combine(a, b)\nend\n\ndefmodule Sum do\n  defstruct [:value]\n  def empty, do: %Sum{value: 0}\nend\n\ndefmodule Multiply do\n  defstruct [:value]\n  def empty, do: %Multiply{value: 1}\nend\n\ndefimpl Monoid, for: Sum do\n  def combine(%Sum{value: a}, %Sum{value: b}), do: %Sum{value: a + b}\nend\n\ndefimpl Monoid, for: Multiply do\n  def combine(%Multiply{value: a}, %Multiply{value: b}), do: %Multiply{value: a * b}\nend\n\ndefimpl Monoid, for: List do\n  def combine(a, b), do: a ++ b\nend\n\n# \u30e2\u30ce\u30a4\u30c9\u306e\u30ea\u30b9\u30c8\u3092\u7573\u307f\u8fbc\u3080\ndef fold_monoid(list, empty) do\n  Enum.reduce(list, empty, &amp;Monoid.combine(&amp;2, &amp;1))\nend\n\n# \u4f7f\u7528\u4f8b\nsums = [%Sum{value: 1}, %Sum{value: 2}, %Sum{value: 3}]\nfold_monoid(sums, Sum.empty())\n# =&gt; %Sum{value: 6}\n</code></pre>"},{"location":"elixir/03-polymorphism/#6","title":"6. \u52d5\u7684\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1","text":"<p>\u30de\u30c3\u30d7\u3092\u4f7f\u3063\u305f\u95a2\u6570\u306e\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u3067\u3001\u5b9f\u884c\u6642\u306b\u67d4\u8edf\u306a\u632f\u308b\u821e\u3044\u306e\u5207\u308a\u66ff\u3048\u304c\u3067\u304d\u307e\u3059\u3002</p> <pre><code>def dispatch(handlers, operation, args) do\n  case Map.get(handlers, operation) do\n    nil -&gt; raise ArgumentError, \"Unknown operation: #{operation}\"\n    handler -&gt; apply(handler, args)\n  end\nend\n\ndef create_calculator do\n  handlers = %{\n    add: fn a, b -&gt; a + b end,\n    subtract: fn a, b -&gt; a - b end,\n    multiply: fn a, b -&gt; a * b end,\n    divide: fn a, b -&gt; a / b end\n  }\n\n  fn operation, a, b -&gt;\n    dispatch(handlers, operation, [a, b])\n  end\nend\n\n# \u4f7f\u7528\u4f8b\ncalc = create_calculator()\ncalc.(:add, 5, 3)       # =&gt; 8\ncalc.(:divide, 10, 2)   # =&gt; 5.0\n</code></pre>"},{"location":"elixir/03-polymorphism/#7","title":"7. \u5f0f\u306e\u8a55\u4fa1\uff08\u518d\u5e30\u7684\u306a\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\uff09","text":"<p>\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3092\u4f7f\u3063\u305f\u518d\u5e30\u7684\u306a\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u51e6\u7406\u306f\u3001Elixir \u306e\u5f97\u610f\u5206\u91ce\u3067\u3059\u3002</p> <pre><code>@type expr ::\n  {:num, number()}\n  | {:add, expr(), expr()}\n  | {:sub, expr(), expr()}\n  | {:mul, expr(), expr()}\n  | {:div, expr(), expr()}\n\ndef evaluate({:num, n}), do: n\ndef evaluate({:add, left, right}), do: evaluate(left) + evaluate(right)\ndef evaluate({:sub, left, right}), do: evaluate(left) - evaluate(right)\ndef evaluate({:mul, left, right}), do: evaluate(left) * evaluate(right)\ndef evaluate({:div, left, right}), do: evaluate(left) / evaluate(right)\n\ndef expr_to_string({:num, n}), do: to_string(n)\ndef expr_to_string({:add, left, right}) do\n  \"(#{expr_to_string(left)} + #{expr_to_string(right)})\"\nend\n# ... \u4ed6\u306e\u6f14\u7b97\u5b50\u3082\u540c\u69d8\n\n# \u4f7f\u7528\u4f8b\nexpr = {:add, {:num, 5}, {:mul, {:num, 2}, {:num, 3}}}\nevaluate(expr)          # =&gt; 11\nexpr_to_string(expr)    # =&gt; \"(5 + (2 * 3))\"\n</code></pre>"},{"location":"elixir/03-polymorphism/#8","title":"8. \u30ac\u30fc\u30c9\u7bc0\u306b\u3088\u308b\u591a\u614b\u6027","text":"<p>\u30ac\u30fc\u30c9\u7bc0\u3092\u4f7f\u3046\u3068\u3001\u578b\u3084\u5024\u306e\u6761\u4ef6\u306b\u57fa\u3065\u3044\u3066\u95a2\u6570\u3092\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u3067\u304d\u307e\u3059\u3002</p> <pre><code>def describe_value(n) when is_integer(n) and n &gt; 0, do: \"\u6b63\u306e\u6574\u6570: #{n}\"\ndef describe_value(n) when is_integer(n) and n &lt; 0, do: \"\u8ca0\u306e\u6574\u6570: #{n}\"\ndef describe_value(0), do: \"\u30bc\u30ed\"\ndef describe_value(n) when is_float(n), do: \"\u6d6e\u52d5\u5c0f\u6570\u70b9\u6570: #{n}\"\ndef describe_value(s) when is_binary(s), do: \"\u6587\u5b57\u5217: #{s}\"\ndef describe_value(list) when is_list(list), do: \"\u30ea\u30b9\u30c8\uff08\u8981\u7d20\u6570: #{length(list)}\uff09\"\ndef describe_value(map) when is_map(map), do: \"\u30de\u30c3\u30d7\uff08\u30ad\u30fc\u6570: #{map_size(map)}\uff09\"\ndef describe_value(_), do: \"\u305d\u306e\u4ed6\"\n\n# \u4f7f\u7528\u4f8b\ndescribe_value(42)      # =&gt; \"\u6b63\u306e\u6574\u6570: 42\"\ndescribe_value(-5)      # =&gt; \"\u8ca0\u306e\u6574\u6570: -5\"\ndescribe_value(3.14)    # =&gt; \"\u6d6e\u52d5\u5c0f\u6570\u70b9\u6570: 3.14\"\ndescribe_value(\"hello\") # =&gt; \"\u6587\u5b57\u5217: hello\"\n</code></pre>"},{"location":"elixir/03-polymorphism/#_7","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Elixir \u306b\u304a\u3051\u308b\u591a\u614b\u6027\u306e\u5b9f\u73fe\u65b9\u6cd5\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0: \u30bf\u30b0\u4ed8\u304d\u30bf\u30d7\u30eb\u3068\u95a2\u6570\u306e\u30de\u30eb\u30c1\u30d8\u30c3\u30c9\u306b\u3088\u308b ADT</li> <li>\u69cb\u9020\u4f53: \u660e\u793a\u7684\u306a\u578b\u3068\u69cb\u9020\u4f53\u306b\u3088\u308b\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0</li> <li>\u8907\u5408\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1: \u8907\u6570\u306e\u5024\u306b\u57fa\u3065\u304f\u5206\u5c90</li> <li>\u30d7\u30ed\u30c8\u30b3\u30eb: \u578b\u306b\u5bfe\u3059\u308b\u632f\u308b\u821e\u3044\u306e\u5b9a\u7fa9\u3068\u5b9f\u88c5</li> <li>\u30d3\u30d8\u30a4\u30d3\u30a2: \u30e2\u30b8\u30e5\u30fc\u30eb\u30ec\u30d9\u30eb\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u5b9a\u7fa9</li> <li>\u52d5\u7684\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1: \u30de\u30c3\u30d7\u306b\u3088\u308b\u95a2\u6570\u306e\u5b9f\u884c\u6642\u5207\u308a\u66ff\u3048</li> <li>\u30ac\u30fc\u30c9\u7bc0: \u578b\u3084\u5024\u306e\u6761\u4ef6\u306b\u3088\u308b\u5206\u5c90</li> </ol> <p>\u3053\u308c\u3089\u306e\u30e1\u30ab\u30cb\u30ba\u30e0\u3092\u9069\u5207\u306b\u4f7f\u3044\u5206\u3051\u308b\u3053\u3068\u3067\u3001\u67d4\u8edf\u3067\u4fdd\u5b88\u3057\u3084\u3059\u3044\u30b3\u30fc\u30c9\u3092\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"elixir/03-polymorphism/#_8","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/elixir/part1/lib/chapter03.ex</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/elixir/part1/test/chapter03_test.exs</code></li> </ul>"},{"location":"elixir/03-polymorphism/#_9","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001\u30c7\u30fc\u30bf\u691c\u8a3c\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002Elixir \u3067\u306e\u578b\u30c1\u30a7\u30c3\u30af\u3068\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30d1\u30bf\u30fc\u30f3\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"elixir/04-data-validation/","title":"Chapter 04: \u30c7\u30fc\u30bf\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3","text":"<p>Elixir \u306b\u304a\u3051\u308b\u30c7\u30fc\u30bf\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3068\u578b\u5b89\u5168\u6027\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"elixir/04-data-validation/#_1","title":"\u6982\u8981","text":"<p>\u3053\u306e\u30c1\u30e3\u30d7\u30bf\u30fc\u3067\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u304a\u3051\u308b\u30c7\u30fc\u30bf\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002 Elixir \u306e Result \u578b\uff08<code>{:ok, value} | {:error, reason}</code>\uff09\u3068 Validated \u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u3063\u3066\u3001 \u5b89\u5168\u3067\u8868\u73fe\u529b\u8c4a\u304b\u306a\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002</p>"},{"location":"elixir/04-data-validation/#_2","title":"\u4e3b\u306a\u30c8\u30d4\u30c3\u30af","text":"<ol> <li>Result \u578b\u306b\u3088\u308b\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0</li> <li>\u30d0\u30ea\u30c7\u30fc\u30bf\u306e\u5408\u6210</li> <li>\u30b9\u30de\u30fc\u30c8\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf</li> <li>\u30a8\u30e9\u30fc\u306e\u84c4\u7a4d</li> <li>\u5024\u30aa\u30d6\u30b8\u30a7\u30af\u30c8</li> </ol>"},{"location":"elixir/04-data-validation/#result","title":"Result \u578b\u3068\u306f","text":"<p>Result \u578b\u306f\u3001\u6210\u529f\u3068\u5931\u6557\u3092\u660e\u793a\u7684\u306b\u8868\u73fe\u3059\u308b\u30c7\u30fc\u30bf\u69cb\u9020\u3067\u3059\u3002</p> <pre><code>@type result(a) :: {:ok, a} | {:error, String.t()}\n</code></pre> <p>\u4f8b\u5916\u3092\u30b9\u30ed\u30fc\u3059\u308b\u4ee3\u308f\u308a\u306b\u3001\u5931\u6557\u3092\u901a\u5e38\u306e\u623b\u308a\u5024\u3068\u3057\u3066\u6271\u3044\u307e\u3059\u3002</p>"},{"location":"elixir/04-data-validation/#_3","title":"\u5b9f\u88c5\u4f8b","text":""},{"location":"elixir/04-data-validation/#_4","title":"\u57fa\u672c\u7684\u306a\u30d0\u30ea\u30c7\u30fc\u30bf","text":"<pre><code>defmodule Chapter04 do\n  @doc \"\"\"\n  \u6b63\u306e\u6570\u3067\u3042\u308b\u3053\u3068\u3092\u691c\u8a3c\u3059\u308b\u3002\n  \"\"\"\n  @spec validate_positive(number()) :: {:ok, number()} | {:error, String.t()}\n  def validate_positive(n) when n &gt; 0, do: {:ok, n}\n  def validate_positive(_), do: {:error, \"\u6b63\u306e\u6570\u304c\u5fc5\u8981\u3067\u3059\"}\n\n  @doc \"\"\"\n  \u7a7a\u3067\u306a\u3044\u6587\u5b57\u5217\u3067\u3042\u308b\u3053\u3068\u3092\u691c\u8a3c\u3059\u308b\u3002\n  \"\"\"\n  @spec validate_non_empty(String.t()) :: {:ok, String.t()} | {:error, String.t()}\n  def validate_non_empty(\"\"), do: {:error, \"\u7a7a\u6587\u5b57\u5217\u306f\u8a31\u53ef\u3055\u308c\u307e\u305b\u3093\"}\n  def validate_non_empty(s) when is_binary(s), do: {:ok, s}\nend\n</code></pre>"},{"location":"elixir/04-data-validation/#_5","title":"\u30d0\u30ea\u30c7\u30fc\u30bf\u306e\u5408\u6210","text":"<p>\u8907\u6570\u306e\u30d0\u30ea\u30c7\u30fc\u30bf\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u3001\u8907\u96d1\u306a\u691c\u8a3c\u30ed\u30b8\u30c3\u30af\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002</p> <pre><code># \u6700\u521d\u306e\u30a8\u30e9\u30fc\u3067\u505c\u6b62\ndef validate_all(value, validators) do\n  Enum.reduce_while(validators, {:ok, value}, fn v, {:ok, val} -&gt;\n    case v.(val) do\n      {:ok, _} = result -&gt; {:cont, result}\n      {:error, _} = error -&gt; {:halt, error}\n    end\n  end)\nend\n\n# \u3059\u3079\u3066\u306e\u30a8\u30e9\u30fc\u3092\u84c4\u7a4d\ndef validate_all_accumulate(value, validators) do\n  errors =\n    validators\n    |&gt; Enum.map(fn v -&gt; v.(value) end)\n    |&gt; Enum.flat_map(fn\n      {:error, e} -&gt; e\n      {:ok, _} -&gt; []\n    end)\n\n  if errors == [], do: {:valid, value}, else: {:invalid, errors}\nend\n</code></pre>"},{"location":"elixir/04-data-validation/#_6","title":"\u30b9\u30de\u30fc\u30c8\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf","text":"<p>\u4e0d\u6b63\u306a\u5024\u3092\u4f5c\u6210\u3067\u304d\u306a\u3044\u3088\u3046\u306b\u3001\u691c\u8a3c\u4ed8\u304d\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002</p> <pre><code>defmodule Email do\n  @enforce_keys [:value]\n  defstruct [:value]\n\n  @spec new(String.t()) :: {:ok, t()} | {:error, String.t()}\n  def new(email) do\n    cond do\n      not String.contains?(email, \"@\") -&gt;\n        {:error, \"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306b\u306f @ \u304c\u5fc5\u8981\u3067\u3059\"}\n      String.length(email) &lt; 5 -&gt;\n        {:error, \"\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u304c\u77ed\u3059\u304e\u307e\u3059\"}\n      true -&gt;\n        {:ok, %__MODULE__{value: email}}\n    end\n  end\nend\n</code></pre>"},{"location":"elixir/04-data-validation/#with","title":"with \u5f0f\u306b\u3088\u308b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3","text":"<p>Elixir \u306e <code>with</code> \u5f0f\u3092\u4f7f\u3046\u3068\u3001\u8907\u6570\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u9806\u6b21\u5b9f\u884c\u3067\u304d\u307e\u3059\u3002</p> <pre><code>def validate_user(name, age, email) do\n  with {:ok, valid_name} &lt;- NonEmptyString.new(name),\n       {:ok, valid_age} &lt;- PositiveInteger.new(age),\n       {:ok, valid_email} &lt;- Email.new(email) do\n    {:ok, %{name: valid_name, age: valid_age, email: valid_email}}\n  end\nend\n</code></pre> <p><code>with</code> \u5f0f\u306f\u6700\u521d\u306e\u5931\u6557\u3067\u505c\u6b62\u3057\u3001\u30a8\u30e9\u30fc\u3092\u8fd4\u3057\u307e\u3059\u3002</p>"},{"location":"elixir/04-data-validation/#validated","title":"Validated \u30d1\u30bf\u30fc\u30f3","text":"<p>\u3059\u3079\u3066\u306e\u30a8\u30e9\u30fc\u3092\u84c4\u7a4d\u3057\u305f\u3044\u5834\u5408\u306f\u3001Validated \u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u3044\u307e\u3059\u3002</p> <pre><code>@type validated(a) :: {:valid, a} | {:invalid, [String.t()]}\n\ndef validate_user_accumulate(params) do\n  results = [\n    validate_field(params, :name, &amp;NonEmptyString.new/1),\n    validate_field(params, :age, &amp;PositiveInteger.new/1),\n    validate_field(params, :email, &amp;Email.new/1)\n  ]\n\n  errors = Enum.flat_map(results, fn\n    {:error, e} -&gt; [e]\n    {:ok, _} -&gt; []\n  end)\n\n  if errors == [] do\n    {:valid, build_user(results)}\n  else\n    {:invalid, errors}\n  end\nend\n</code></pre>"},{"location":"elixir/04-data-validation/#_7","title":"\u30c6\u30b9\u30c8\u4f8b","text":"<pre><code>defmodule Chapter04Test do\n  use ExUnit.Case\n\n  describe \"Email.new/1\" do\n    test \"\u6709\u52b9\u306a\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3067\u4f5c\u6210\u3067\u304d\u308b\" do\n      assert {:ok, %Email{value: \"test@example.com\"}} = Email.new(\"test@example.com\")\n    end\n\n    test \"@ \u304c\u306a\u3044\u3068\u30a8\u30e9\u30fc\" do\n      assert {:error, _} = Email.new(\"invalid\")\n    end\n  end\n\n  describe \"validate_all/2\" do\n    test \"\u3059\u3079\u3066\u306e\u30d0\u30ea\u30c7\u30fc\u30bf\u304c\u6210\u529f\u3059\u308b\u3068 :ok\" do\n      validators = [\n        fn x -&gt; if x &gt; 0, do: {:ok, x}, else: {:error, \"\u6b63\u306e\u6570\u304c\u5fc5\u8981\"} end,\n        fn x -&gt; if x &lt; 100, do: {:ok, x}, else: {:error, \"100\u672a\u6e80\u304c\u5fc5\u8981\"} end\n      ]\n\n      assert {:ok, 50} = Chapter04.validate_all(50, validators)\n    end\n\n    test \"\u6700\u521d\u306e\u30a8\u30e9\u30fc\u3067\u505c\u6b62\u3059\u308b\" do\n      validators = [\n        fn _ -&gt; {:error, \"\u30a8\u30e9\u30fc1\"} end,\n        fn _ -&gt; {:error, \"\u30a8\u30e9\u30fc2\"} end\n      ]\n\n      assert {:error, [\"\u30a8\u30e9\u30fc1\"]} = Chapter04.validate_all(0, validators)\n    end\n  end\nend\n</code></pre>"},{"location":"elixir/04-data-validation/#_8","title":"\u307e\u3068\u3081","text":"<ul> <li>Result \u578b\u3067\u6210\u529f\u3068\u5931\u6557\u3092\u660e\u793a\u7684\u306b\u8868\u73fe</li> <li>\u30d0\u30ea\u30c7\u30fc\u30bf\u306e\u5408\u6210\u3067\u8907\u96d1\u306a\u691c\u8a3c\u30ed\u30b8\u30c3\u30af\u3092\u69cb\u7bc9</li> <li>\u30b9\u30de\u30fc\u30c8\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3067\u4e0d\u6b63\u306a\u5024\u306e\u4f5c\u6210\u3092\u9632\u6b62</li> <li>with \u5f0f\u3067\u9010\u6b21\u7684\u306a\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3</li> <li>Validated \u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3079\u3066\u306e\u30a8\u30e9\u30fc\u3092\u84c4\u7a4d</li> </ul>"},{"location":"elixir/04-data-validation/#_9","title":"\u95a2\u9023\u30ea\u30bd\u30fc\u30b9","text":"<ul> <li>Elixir \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8: with</li> <li>Railway Oriented Programming</li> </ul>"},{"location":"elixir/05-property-based-testing/","title":"Chapter 05: \u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8","text":"<p>Elixir \u306b\u304a\u3051\u308b StreamData \u3092\u4f7f\u3063\u305f\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"elixir/05-property-based-testing/#_1","title":"\u6982\u8981","text":"<p>\u5f93\u6765\u306e\u4f8b\u793a\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u3067\u306f\u3001\u7279\u5b9a\u306e\u5165\u529b\u306b\u5bfe\u3059\u308b\u671f\u5f85\u3055\u308c\u308b\u51fa\u529b\u3092\u624b\u52d5\u3067\u6307\u5b9a\u3057\u307e\u3059\u3002 \u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u3067\u306f\u3001\u3059\u3079\u3066\u306e\u5165\u529b\u306b\u5bfe\u3057\u3066\u6210\u308a\u7acb\u3064\u3079\u304d\u6027\u8cea\uff08\u30d7\u30ed\u30d1\u30c6\u30a3\uff09\u3092 \u5b9a\u7fa9\u3057\u3001\u30e9\u30f3\u30c0\u30e0\u306b\u751f\u6210\u3055\u308c\u305f\u591a\u6570\u306e\u5165\u529b\u3067\u305d\u306e\u6027\u8cea\u3092\u691c\u8a3c\u3057\u307e\u3059\u3002</p>"},{"location":"elixir/05-property-based-testing/#_2","title":"\u4e3b\u306a\u30c8\u30d4\u30c3\u30af","text":"<ol> <li>\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u306e\u57fa\u672c</li> <li>\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u5b9a\u7fa9</li> <li>\u53ce\u7e2e\uff08\u30b7\u30e5\u30ea\u30f3\u30ad\u30f3\u30b0\uff09</li> <li>\u30ab\u30b9\u30bf\u30e0\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf</li> <li>\u30c9\u30e1\u30a4\u30f3\u56fa\u6709\u306e\u30d7\u30ed\u30d1\u30c6\u30a3</li> </ol>"},{"location":"elixir/05-property-based-testing/#streamdata","title":"StreamData \u30e9\u30a4\u30d6\u30e9\u30ea","text":"<p>Elixir \u3067\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u3092\u884c\u3046\u306b\u306f\u3001<code>stream_data</code> \u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002</p> <pre><code># mix.exs\ndefp deps do\n  [\n    {:stream_data, \"~&gt; 1.0\", only: :test}\n  ]\nend\n</code></pre>"},{"location":"elixir/05-property-based-testing/#_3","title":"\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u7a2e\u985e","text":""},{"location":"elixir/05-property-based-testing/#idempotency","title":"\u51aa\u7b49\u6027\uff08Idempotency\uff09","text":"<p>\u540c\u3058\u64cd\u4f5c\u3092\u8907\u6570\u56de\u9069\u7528\u3057\u3066\u3082\u7d50\u679c\u304c\u5909\u308f\u3089\u306a\u3044\u6027\u8cea\u3002</p> <pre><code>property \"sort \u306f\u51aa\u7b49\" do\n  check all list &lt;- list_of(integer()) do\n    assert Enum.sort(Enum.sort(list)) == Enum.sort(list)\n  end\nend\n</code></pre>"},{"location":"elixir/05-property-based-testing/#round-trip","title":"\u30e9\u30a6\u30f3\u30c9\u30c8\u30ea\u30c3\u30d7\uff08Round-trip\uff09","text":"<p>\u30a8\u30f3\u30b3\u30fc\u30c9\u30fb\u30c7\u30b3\u30fc\u30c9\u3067\u5143\u306e\u5024\u306b\u623b\u308b\u6027\u8cea\u3002</p> <pre><code>property \"encode/decode \u306f\u30e9\u30a6\u30f3\u30c9\u30c8\u30ea\u30c3\u30d7\" do\n  check all n &lt;- integer() do\n    encoded = encode(n)\n    {:ok, decoded} = decode(encoded)\n    assert decoded == n\n  end\nend\n</code></pre>"},{"location":"elixir/05-property-based-testing/#invariant","title":"\u4e0d\u5909\u6761\u4ef6\uff08Invariant\uff09","text":"<p>\u64cd\u4f5c\u306e\u524d\u5f8c\u3067\u4fdd\u5b58\u3055\u308c\u308b\u6027\u8cea\u3002</p> <pre><code>property \"reverse \u306f\u9577\u3055\u3092\u4fdd\u5b58\u3059\u308b\" do\n  check all list &lt;- list_of(term()) do\n    assert length(Enum.reverse(list)) == length(list)\n  end\nend\n</code></pre>"},{"location":"elixir/05-property-based-testing/#inverse","title":"\u53cd\u8ee2\uff08Inverse\uff09","text":"<p>\u3042\u308b\u64cd\u4f5c\u3068\u305d\u306e\u9006\u64cd\u4f5c\u3002</p> <pre><code>property \"reverse \u306e reverse \u306f\u5143\u306b\u623b\u308b\" do\n  check all list &lt;- list_of(integer()) do\n    assert Enum.reverse(Enum.reverse(list)) == list\n  end\nend\n</code></pre>"},{"location":"elixir/05-property-based-testing/#_4","title":"\u57fa\u672c\u7684\u306a\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf","text":"<pre><code>use ExUnitProperties\n\n# \u6574\u6570\ninteger()           # \u4efb\u610f\u306e\u6574\u6570\npositive_integer()  # \u6b63\u306e\u6574\u6570\nnon_negative_integer()  # 0 \u4ee5\u4e0a\u306e\u6574\u6570\ninteger(1..100)     # \u7bc4\u56f2\u4ed8\u304d\u6574\u6570\n\n# \u6587\u5b57\u5217\nstring(:alphanumeric)\nstring(:printable, min_length: 1, max_length: 10)\n\n# \u30ea\u30b9\u30c8\nlist_of(integer())\nlist_of(integer(), min_length: 1, max_length: 5)\n\n# \u30de\u30c3\u30d7\nmap_of(atom(:alphanumeric), integer())\n\n# \u305d\u306e\u4ed6\nboolean()\nbinary()\nterm()\nmember_of([\"a\", \"b\", \"c\"])\n</code></pre>"},{"location":"elixir/05-property-based-testing/#_5","title":"\u30ab\u30b9\u30bf\u30e0\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf","text":"<pre><code># \u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306e\u30ab\u30b9\u30bf\u30e0\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\ndefp email_generator do\n  gen all local &lt;- string(:alphanumeric, min_length: 1, max_length: 10),\n          domain &lt;- string(:alphanumeric, min_length: 1, max_length: 10),\n          tld &lt;- member_of([\"com\", \"org\", \"net\", \"io\"]) do\n    \"#{local}@#{domain}.#{tld}\"\n  end\nend\n\nproperty \"\u751f\u6210\u3055\u308c\u305f\u30e1\u30fc\u30eb\u306f\u6709\u52b9\" do\n  check all email &lt;- email_generator() do\n    assert String.contains?(email, \"@\")\n    assert String.contains?(email, \".\")\n  end\nend\n</code></pre>"},{"location":"elixir/05-property-based-testing/#_6","title":"\u5b9f\u88c5\u4f8b","text":""},{"location":"elixir/05-property-based-testing/#_7","title":"\u6570\u5b66\u95a2\u6570\u306e\u30d7\u30ed\u30d1\u30c6\u30a3","text":"<pre><code>defmodule Chapter05 do\n  @doc \"\"\"\n  \u7d76\u5bfe\u5024\u3092\u8fd4\u3059\u3002\n\n  ## \u30d7\u30ed\u30d1\u30c6\u30a3\n  - \u7d50\u679c\u306f\u5e38\u306b\u975e\u8ca0\n  - \u51aa\u7b49\u6027: abs(abs(x)) == abs(x)\n  - \u5076\u95a2\u6570: abs(-x) == abs(x)\n  \"\"\"\n  def absolute(n) when n &lt; 0, do: -n\n  def absolute(n), do: n\nend\n</code></pre> <pre><code>describe \"absolute/1 \u306e\u30d7\u30ed\u30d1\u30c6\u30a3\" do\n  property \"\u7d50\u679c\u306f\u5e38\u306b\u975e\u8ca0\" do\n    check all n &lt;- integer() do\n      assert Chapter05.absolute(n) &gt;= 0\n    end\n  end\n\n  property \"\u51aa\u7b49\u6027\" do\n    check all n &lt;- integer() do\n      assert Chapter05.absolute(Chapter05.absolute(n)) == Chapter05.absolute(n)\n    end\n  end\n\n  property \"\u5076\u95a2\u6570\" do\n    check all n &lt;- integer() do\n      assert Chapter05.absolute(-n) == Chapter05.absolute(n)\n    end\n  end\nend\n</code></pre>"},{"location":"elixir/05-property-based-testing/#_8","title":"\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30eb\u306e\u30d7\u30ed\u30d1\u30c6\u30a3","text":"<pre><code>defmodule Money do\n  defstruct [:amount, :currency]\n\n  def new(amount, currency), do: %__MODULE__{amount: amount, currency: currency}\n\n  def add(%{currency: c} = m1, %{currency: c} = m2) do\n    {:ok, new(m1.amount + m2.amount, c)}\n  end\n  def add(_, _), do: {:error, \"Currency mismatch\"}\n\n  def zero(currency), do: new(0, currency)\nend\n</code></pre> <pre><code>describe \"Money \u306e\u30e2\u30ce\u30a4\u30c9\u5247\" do\n  defp money_generator(currency) do\n    gen all amount &lt;- integer() do\n      Money.new(amount, currency)\n    end\n  end\n\n  property \"\u7d50\u5408\u5f8b\" do\n    check all a &lt;- money_generator(\"JPY\"),\n              b &lt;- money_generator(\"JPY\"),\n              c &lt;- money_generator(\"JPY\") do\n      {:ok, ab} = Money.add(a, b)\n      {:ok, ab_c} = Money.add(ab, c)\n      {:ok, bc} = Money.add(b, c)\n      {:ok, a_bc} = Money.add(a, bc)\n      assert ab_c == a_bc\n    end\n  end\n\n  property \"\u5358\u4f4d\u5143\" do\n    check all m &lt;- money_generator(\"JPY\") do\n      zero = Money.zero(\"JPY\")\n      {:ok, result} = Money.add(m, zero)\n      assert result == m\n    end\n  end\n\n  property \"\u53ef\u63db\u5f8b\" do\n    check all a &lt;- money_generator(\"JPY\"),\n              b &lt;- money_generator(\"JPY\") do\n      {:ok, ab} = Money.add(a, b)\n      {:ok, ba} = Money.add(b, a)\n      assert ab == ba\n    end\n  end\nend\n</code></pre>"},{"location":"elixir/05-property-based-testing/#_9","title":"\u53ce\u7e2e\uff08\u30b7\u30e5\u30ea\u30f3\u30ad\u30f3\u30b0\uff09","text":"<p>\u30c6\u30b9\u30c8\u304c\u5931\u6557\u3057\u305f\u5834\u5408\u3001StreamData \u306f\u5931\u6557\u3092\u5f15\u304d\u8d77\u3053\u3059\u6700\u5c0f\u306e\u5165\u529b\u3092\u898b\u3064\u3051\u3088\u3046\u3068\u3057\u307e\u3059\u3002</p> <pre><code># \u6545\u610f\u306b\u5931\u6557\u3059\u308b\u30c6\u30b9\u30c8\uff08\u30c7\u30e2\u7528\uff09\nproperty \"\u30ea\u30b9\u30c8\u306e\u5408\u8a08\u306f100\u672a\u6e80\" do\n  check all list &lt;- list_of(positive_integer(), min_length: 1) do\n    assert Enum.sum(list) &lt; 100\n  end\nend\n\n# \u51fa\u529b\u4f8b:\n# Failed with generated values (after 5 successful runs):\n#     * list &lt;- [100]\n# \n# \u53ce\u7e2e\u306b\u3088\u308a\u3001\u6700\u5c0f\u306e\u53cd\u4f8b [100] \u304c\u898b\u3064\u304b\u308b\n</code></pre>"},{"location":"elixir/05-property-based-testing/#_10","title":"\u30c6\u30b9\u30c8\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9","text":"<ol> <li>\u660e\u78ba\u306a\u30d7\u30ed\u30d1\u30c6\u30a3\u3092\u5b9a\u7fa9\u3059\u308b - \u4f55\u3092\u691c\u8a3c\u3059\u308b\u304b\u660e\u78ba\u306b</li> <li>\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u3092\u9069\u5207\u306b\u5236\u7d04\u3059\u308b - \u7121\u52b9\u306a\u5165\u529b\u3092\u751f\u6210\u3057\u306a\u3044</li> <li>\u30ab\u30b9\u30bf\u30e0\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u3092\u6d3b\u7528\u3059\u308b - \u30c9\u30e1\u30a4\u30f3\u56fa\u6709\u306e\u5024\u3092\u751f\u6210</li> <li>\u53ce\u7e2e\u3092\u7406\u89e3\u3059\u308b - \u6700\u5c0f\u306e\u53cd\u4f8b\u3092\u6d3b\u7528</li> <li>\u4f8b\u793a\u30c6\u30b9\u30c8\u3068\u4f75\u7528\u3059\u308b - \u4e21\u65b9\u306e\u30a2\u30d7\u30ed\u30fc\u30c1\u3092\u4f7f\u3046</li> </ol>"},{"location":"elixir/05-property-based-testing/#_11","title":"\u307e\u3068\u3081","text":"<ul> <li>\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u3067\u591a\u304f\u306e\u30b1\u30fc\u30b9\u3092\u81ea\u52d5\u691c\u8a3c</li> <li>StreamData\u3067 Elixir \u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u30c6\u30b9\u30c8\u3092\u5b9f\u73fe</li> <li>\u30ab\u30b9\u30bf\u30e0\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u3067\u30c9\u30e1\u30a4\u30f3\u56fa\u6709\u306e\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u3092\u751f\u6210</li> <li>\u53ce\u7e2e\u3067\u6700\u5c0f\u306e\u5931\u6557\u30b1\u30fc\u30b9\u3092\u7279\u5b9a</li> <li>\u4f8b\u793a\u30c6\u30b9\u30c8\u3068\u4f75\u7528\u3067\u5805\u7262\u306a\u30c6\u30b9\u30c8\u30b9\u30a4\u30fc\u30c8\u3092\u69cb\u7bc9</li> </ul>"},{"location":"elixir/05-property-based-testing/#_12","title":"\u95a2\u9023\u30ea\u30bd\u30fc\u30b9","text":"<ul> <li>StreamData \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8</li> <li>Property-based testing with PropEr, Erlang, and Elixir</li> </ul>"},{"location":"elixir/06-tdd-and-fp/","title":"Chapter 06: TDD \u3068\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0","text":"<p>Elixir \u306b\u304a\u3051\u308b\u30c6\u30b9\u30c8\u99c6\u52d5\u958b\u767a\uff08TDD\uff09\u3068\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u878d\u5408\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"elixir/06-tdd-and-fp/#_1","title":"\u6982\u8981","text":"<p>\u30c6\u30b9\u30c8\u99c6\u52d5\u958b\u767a\uff08TDD\uff09\u306f\u3001\u30c6\u30b9\u30c8\u3092\u5148\u306b\u66f8\u3044\u3066\u304b\u3089\u5b9f\u88c5\u3059\u308b\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u958b\u767a\u624b\u6cd5\u3067\u3059\u3002 \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u7d14\u7c8b\u95a2\u6570\u3068\u4e0d\u5909\u30c7\u30fc\u30bf\u306f\u3001TDD \u3068\u975e\u5e38\u306b\u76f8\u6027\u304c\u826f\u3044\u3067\u3059\u3002</p>"},{"location":"elixir/06-tdd-and-fp/#_2","title":"\u4e3b\u306a\u30c8\u30d4\u30c3\u30af","text":"<ol> <li>TDD \u306e\u57fa\u672c\u30b5\u30a4\u30af\u30eb\uff08Red-Green-Refactor\uff09</li> <li>\u30c6\u30b9\u30bf\u30d6\u30eb\u306a\u8a2d\u8a08</li> <li>\u7d14\u7c8b\u95a2\u6570\u3068\u30c6\u30b9\u30c8\u5bb9\u6613\u6027</li> <li>\u30e2\u30c3\u30af\u3068\u30b9\u30bf\u30d6\u306e\u4ee3\u66ff\u624b\u6cd5</li> <li>Outside-In TDD</li> <li>Parameterized Tests</li> </ol>"},{"location":"elixir/06-tdd-and-fp/#tdd","title":"TDD \u306e\u57fa\u672c\u30b5\u30a4\u30af\u30eb","text":""},{"location":"elixir/06-tdd-and-fp/#red-green-refactor","title":"Red-Green-Refactor","text":"<ol> <li>Red: \u5931\u6557\u3059\u308b\u30c6\u30b9\u30c8\u3092\u66f8\u304f</li> <li>Green: \u30c6\u30b9\u30c8\u3092\u901a\u3059\u6700\u5c0f\u9650\u306e\u5b9f\u88c5</li> <li>Refactor: \u30b3\u30fc\u30c9\u3092\u6574\u7406\uff08\u30c6\u30b9\u30c8\u306f\u901a\u3063\u305f\u307e\u307e\uff09</li> </ol>"},{"location":"elixir/06-tdd-and-fp/#fizzbuzz","title":"FizzBuzz \u306e\u4f8b","text":"<pre><code># Step 1: Red - \u5931\u6557\u3059\u308b\u30c6\u30b9\u30c8\u3092\u66f8\u304f\ntest \"\u901a\u5e38\u306e\u6570\u5024\u306f\u6587\u5b57\u5217\u3068\u3057\u3066\u8fd4\u3059\" do\n  assert FizzBuzz.convert(1) == \"1\"\nend\n\n# Step 2: Green - \u6700\u5c0f\u9650\u306e\u5b9f\u88c5\ndef convert(n), do: Integer.to_string(n)\n\n# Step 3: \u6b21\u306e\u30c6\u30b9\u30c8\u3092\u8ffd\u52a0\ntest \"3\u306e\u500d\u6570\u306f 'Fizz' \u3092\u8fd4\u3059\" do\n  assert FizzBuzz.convert(3) == \"Fizz\"\nend\n\n# \u5b9f\u88c5\u3092\u62e1\u5f35\ndef convert(n) when rem(n, 3) == 0, do: \"Fizz\"\ndef convert(n), do: Integer.to_string(n)\n\n# \u4ee5\u4e0b\u540c\u69d8\u306b 5\u306e\u500d\u6570\u300115\u306e\u500d\u6570\u3092\u8ffd\u52a0...\n</code></pre>"},{"location":"elixir/06-tdd-and-fp/#_3","title":"\u30c6\u30b9\u30bf\u30d6\u30eb\u306a\u8a2d\u8a08","text":""},{"location":"elixir/06-tdd-and-fp/#_4","title":"\u4f9d\u5b58\u6027\u306e\u6ce8\u5165","text":"<p>\u5916\u90e8\u4f9d\u5b58\u3092\u95a2\u6570\u3068\u3057\u3066\u6ce8\u5165\u3059\u308b\u3053\u3068\u3067\u3001\u30c6\u30b9\u30c8\u6642\u306b\u30b9\u30bf\u30d6\u3092\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002</p> <pre><code>defmodule PricingService do\n  @doc \"\"\"\n  \u5272\u5f15\u7387\u3092\u53d6\u5f97\u3059\u308b\u95a2\u6570\u3092\u6ce8\u5165\u3059\u308b\u3053\u3068\u3067\u3001\n  \u5916\u90e8\u30b5\u30fc\u30d3\u30b9\u3092\u30e2\u30c3\u30af\u53ef\u80fd\u306b\u3059\u308b\u3002\n  \"\"\"\n  def calculate_price(product_id, base_price, discount_fetcher) do\n    discount = discount_fetcher.(product_id)\n    base_price * (1.0 - discount)\n  end\nend\n\n# \u30c6\u30b9\u30c8\u3067\u306e\u4f7f\u7528\ntest \"\u5272\u5f15\u7387\u3092\u9069\u7528\u3057\u3066\u4fa1\u683c\u3092\u8a08\u7b97\u3059\u308b\" do\n  # \u30b9\u30bf\u30d6\uff1a\u5e38\u306b10%\u5272\u5f15\u3092\u8fd4\u3059\n  discount_fetcher = fn _product_id -&gt; 0.10 end\n\n  assert PricingService.calculate_price(\"PROD001\", 1000, discount_fetcher) == 900.0\nend\n\n# \u672c\u756a\u3067\u306e\u4f7f\u7528\ndef production_discount_fetcher(product_id) do\n  DiscountAPI.fetch(product_id)\nend\n\nPricingService.calculate_price(\"PROD001\", 1000, &amp;production_discount_fetcher/1)\n</code></pre>"},{"location":"elixir/06-tdd-and-fp/#_5","title":"\u7d14\u7c8b\u95a2\u6570\u306b\u3088\u308b\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af","text":"<p>\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u3092\u7d14\u7c8b\u95a2\u6570\u3068\u3057\u3066\u5b9f\u88c5\u3059\u308b\u3053\u3068\u3067\u3001\u30c6\u30b9\u30c8\u304c\u5bb9\u6613\u306b\u306a\u308a\u307e\u3059\u3002</p> <pre><code>defmodule OrderProcessor do\n  @doc \"\u6ce8\u6587\u306e\u5c0f\u8a08\u3092\u8a08\u7b97\u3059\u308b\uff08\u7d14\u7c8b\u95a2\u6570\uff09\"\n  def calculate_subtotal(items) do\n    items\n    |&gt; Enum.map(fn {_name, qty, price} -&gt; qty * price end)\n    |&gt; Enum.sum()\n  end\n\n  @doc \"\u9867\u5ba2\u30bf\u30a4\u30d7\u306b\u5fdc\u3058\u305f\u5272\u5f15\u7387\u3092\u8fd4\u3059\uff08\u7d14\u7c8b\u95a2\u6570\uff09\"\n  def discount_rate(:regular), do: 0.0\n  def discount_rate(:premium), do: 0.05\n  def discount_rate(:vip), do: 0.10\n\n  @doc \"\u7a0e\u984d\u3092\u8a08\u7b97\u3059\u308b\uff08\u7d14\u7c8b\u95a2\u6570\uff09\"\n  def calculate_tax(amount, tax_rate), do: amount * tax_rate\n\n  @doc \"\u6ce8\u6587\u3092\u51e6\u7406\u3059\u308b\uff08\u7d14\u7c8b\u95a2\u6570\u306e\u7d44\u307f\u5408\u308f\u305b\uff09\"\n  def process_order(%{items: items, customer_type: customer_type}, tax_rate) do\n    subtotal = calculate_subtotal(items)\n    discount_amount = subtotal * discount_rate(customer_type)\n    discounted = subtotal - discount_amount\n    tax_amount = calculate_tax(discounted, tax_rate)\n    total = discounted + tax_amount\n\n    %{\n      subtotal: subtotal,\n      discount: discount_amount,\n      tax: tax_amount,\n      total: total\n    }\n  end\nend\n</code></pre> <p>\u30c6\u30b9\u30c8\u306f\u5404\u7d14\u7c8b\u95a2\u6570\u3092\u72ec\u7acb\u3057\u3066\u30c6\u30b9\u30c8\u3067\u304d\u307e\u3059\u3002</p> <pre><code>describe \"OrderProcessor\" do\n  test \"calculate_subtotal\" do\n    items = [{\"Item1\", 2, 100.0}, {\"Item2\", 3, 50.0}]\n    assert OrderProcessor.calculate_subtotal(items) == 350.0\n  end\n\n  test \"discount_rate\" do\n    assert OrderProcessor.discount_rate(:regular) == 0.0\n    assert OrderProcessor.discount_rate(:premium) == 0.05\n    assert OrderProcessor.discount_rate(:vip) == 0.10\n  end\n\n  test \"process_order for VIP customer\" do\n    order = %{items: [{\"Item\", 1, 1000.0}], customer_type: :vip}\n    result = OrderProcessor.process_order(order, 0.10)\n\n    assert result.subtotal == 1000.0\n    assert result.discount == 100.0\n    assert result.tax == 90.0\n    assert result.total == 990.0\n  end\nend\n</code></pre>"},{"location":"elixir/06-tdd-and-fp/#_6","title":"\u72b6\u614b\u9077\u79fb\u306e\u30c6\u30b9\u30c8","text":"<p>\u72b6\u614b\u9077\u79fb\u3092\u7d14\u7c8b\u95a2\u6570\u3068\u3057\u3066\u30e2\u30c7\u30eb\u5316\u3057\u307e\u3059\u3002</p> <pre><code>defmodule OrderState do\n  def new(id, items) do\n    %{id: id, state: :pending, items: items, history: [:pending]}\n  end\n\n  def confirm(%{state: :pending} = order) do\n    {:ok, %{order | state: :confirmed, history: [:confirmed | order.history]}}\n  end\n  def confirm(_), do: {:error, \"Cannot confirm\"}\n\n  def ship(%{state: :confirmed} = order) do\n    {:ok, %{order | state: :shipped, history: [:shipped | order.history]}}\n  end\n  def ship(_), do: {:error, \"Cannot ship\"}\n\n  # ... \u4ed6\u306e\u9077\u79fb\nend\n</code></pre> <pre><code>describe \"OrderState \u72b6\u614b\u9077\u79fb\" do\n  test \"\u6b63\u5e38\u306a\u72b6\u614b\u9077\u79fb\" do\n    order = OrderState.new(\"ORD001\", [])\n\n    {:ok, order} = OrderState.confirm(order)\n    assert order.state == :confirmed\n\n    {:ok, order} = OrderState.ship(order)\n    assert order.state == :shipped\n  end\n\n  test \"\u4e0d\u6b63\u306a\u72b6\u614b\u9077\u79fb\u306f\u30a8\u30e9\u30fc\" do\n    order = OrderState.new(\"ORD001\", [])\n    # pending \u304b\u3089\u76f4\u63a5 ship \u306f\u3067\u304d\u306a\u3044\n    assert {:error, _} = OrderState.ship(order)\n  end\nend\n</code></pre>"},{"location":"elixir/06-tdd-and-fp/#_7","title":"\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u30d3\u30eb\u30c0\u30fc\u30d1\u30bf\u30fc\u30f3","text":"<p>\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u3092\u67d4\u8edf\u306b\u69cb\u7bc9\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002</p> <pre><code>defmodule UserBuilder do\n  def build do\n    %{\n      name: \"Test User\",\n      email: \"test@example.com\",\n      age: 25,\n      role: :user,\n      active: true\n    }\n  end\n\n  def build(overrides) do\n    build() |&gt; Map.merge(Map.new(overrides))\n  end\n\n  def admin, do: build(role: :admin)\n  def inactive, do: build(active: false)\n\n  def build_list(count) do\n    Enum.map(1..count, fn i -&gt;\n      build(name: \"User #{i}\", email: \"user#{i}@example.com\")\n    end)\n  end\nend\n</code></pre> <pre><code>test \"\u7ba1\u7406\u8005\u306e\u307f\u304c\u30a2\u30af\u30bb\u30b9\u53ef\u80fd\" do\n  admin = UserBuilder.admin()\n  user = UserBuilder.build()\n\n  assert authorize(admin, :admin_panel) == :ok\n  assert authorize(user, :admin_panel) == :error\nend\n</code></pre>"},{"location":"elixir/06-tdd-and-fp/#_8","title":"\u30d1\u30e9\u30e1\u30bf\u30e9\u30a4\u30ba\u30c9\u30c6\u30b9\u30c8","text":"<p>\u540c\u3058\u30c6\u30b9\u30c8\u30ed\u30b8\u30c3\u30af\u3092\u8907\u6570\u306e\u5165\u529b\u3067\u5b9f\u884c\u3057\u307e\u3059\u3002</p> <pre><code>describe \"FizzBuzz \u30d1\u30e9\u30e1\u30bf\u30e9\u30a4\u30ba\u30c9\u30c6\u30b9\u30c8\" do\n  for {input, expected} &lt;- [\n    {1, \"1\"},\n    {2, \"2\"},\n    {3, \"Fizz\"},\n    {5, \"Buzz\"},\n    {15, \"FizzBuzz\"}\n  ] do\n    test \"FizzBuzz.convert(#{input}) == #{expected}\" do\n      assert FizzBuzz.convert(unquote(input)) == unquote(expected)\n    end\n  end\nend\n</code></pre>"},{"location":"elixir/06-tdd-and-fp/#result","title":"Result \u578b\u3092\u4f7f\u3063\u305f\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0","text":"<pre><code>defmodule Calculator do\n  def divide(_, b) when b == 0 or b == 0.0 do\n    {:error, \"Division by zero\"}\n  end\n  def divide(a, b), do: {:ok, a / b}\n\n  def chain(n), do: {:ok, n}\n\n  def then_divide({:ok, a}, b), do: divide(a, b)\n  def then_divide(error, _), do: error\nend\n</code></pre> <pre><code>test \"\u30a8\u30e9\u30fc\u306f\u30c1\u30a7\u30a4\u30f3\u3092\u901a\u3058\u3066\u4f1d\u64ad\u3059\u308b\" do\n  result =\n    Calculator.chain(10)\n    |&gt; Calculator.then_divide(0)\n    |&gt; Calculator.then_add(5)\n\n  assert {:error, \"Division by zero\"} = result\nend\n</code></pre>"},{"location":"elixir/06-tdd-and-fp/#_9","title":"\u307e\u3068\u3081","text":"<ul> <li>TDD \u30b5\u30a4\u30af\u30eb\uff08Red-Green-Refactor\uff09\u3067\u6bb5\u968e\u7684\u306b\u5b9f\u88c5</li> <li>\u4f9d\u5b58\u6027\u6ce8\u5165\u3067\u30c6\u30b9\u30bf\u30d6\u30eb\u306a\u8a2d\u8a08</li> <li>\u7d14\u7c8b\u95a2\u6570\u3067\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u3092\u8868\u73fe</li> <li>\u72b6\u614b\u9077\u79fb\u3092\u7d14\u7c8b\u95a2\u6570\u3068\u3057\u3066\u30e2\u30c7\u30eb\u5316</li> <li>\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u30d3\u30eb\u30c0\u30fc\u3067\u67d4\u8edf\u306a\u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u4f5c\u6210</li> <li>\u30d1\u30e9\u30e1\u30bf\u30e9\u30a4\u30ba\u30c9\u30c6\u30b9\u30c8\u3067\u591a\u304f\u306e\u30b1\u30fc\u30b9\u3092\u30ab\u30d0\u30fc</li> </ul>"},{"location":"elixir/06-tdd-and-fp/#_10","title":"\u95a2\u9023\u30ea\u30bd\u30fc\u30b9","text":"<ul> <li>ExUnit \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8</li> <li>Test-Driven Development by Example</li> </ul>"},{"location":"elixir/07-effects-and-pure-functions/","title":"Chapter 07: \u526f\u4f5c\u7528\u3068\u7d14\u7c8b\u95a2\u6570","text":"<p>Elixir \u306b\u304a\u3051\u308b\u526f\u4f5c\u7528\u306e\u7ba1\u7406\u3068\u7d14\u7c8b\u95a2\u6570\u306e\u5206\u96e2\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"elixir/07-effects-and-pure-functions/#_1","title":"\u6982\u8981","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u526f\u4f5c\u7528\uff08I/O\u3001\u72b6\u614b\u5909\u66f4\u3001\u6642\u9593\u3001\u4e71\u6570\uff09\u3092\u7d14\u7c8b\u306a\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u304b\u3089\u5206\u96e2\u3059\u308b\u3053\u3068\u304c\u91cd\u8981\u3067\u3059\u3002\u3053\u306e\u30c1\u30e3\u30d7\u30bf\u30fc\u3067\u306f\u3001\u305d\u306e\u8a2d\u8a08\u30d1\u30bf\u30fc\u30f3\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002</p>"},{"location":"elixir/07-effects-and-pure-functions/#_2","title":"\u4e3b\u306a\u30c8\u30d4\u30c3\u30af","text":"<ol> <li>\u7d14\u7c8b\u95a2\u6570\u3068\u526f\u4f5c\u7528\u306e\u5206\u96e2</li> <li>Functional Core, Imperative Shell</li> <li>\u526f\u4f5c\u7528\u306e\u9045\u5ef6\u5b9f\u884c</li> <li>Reader \u30d1\u30bf\u30fc\u30f3</li> <li>\u4f9d\u5b58\u6027\u6ce8\u5165</li> </ol>"},{"location":"elixir/07-effects-and-pure-functions/#vs","title":"\u7d14\u7c8b\u95a2\u6570 vs \u526f\u4f5c\u7528","text":""},{"location":"elixir/07-effects-and-pure-functions/#_3","title":"\u7d14\u7c8b\u95a2\u6570","text":"<ul> <li>\u540c\u3058\u5165\u529b\u306b\u5bfe\u3057\u3066\u5e38\u306b\u540c\u3058\u51fa\u529b</li> <li>\u5916\u90e8\u72b6\u614b\u3092\u5909\u66f4\u3057\u306a\u3044</li> </ul> <pre><code># \u7d14\u7c8b\u95a2\u6570\u306e\u4f8b\ndef add(a, b), do: a + b\ndef upcase(s), do: String.upcase(s)\n</code></pre>"},{"location":"elixir/07-effects-and-pure-functions/#_4","title":"\u526f\u4f5c\u7528\u3092\u6301\u3064\u95a2\u6570","text":"<ul> <li>I/O\uff08\u30b3\u30f3\u30bd\u30fc\u30eb\u3001\u30d5\u30a1\u30a4\u30eb\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\uff09</li> <li>\u72b6\u614b\u5909\u66f4</li> <li>\u73fe\u5728\u6642\u523b\u306e\u53d6\u5f97</li> <li>\u4e71\u6570\u751f\u6210</li> </ul> <pre><code># \u526f\u4f5c\u7528\u3092\u6301\u3064\u95a2\u6570\ndef current_time, do: DateTime.utc_now()  # \u975e\u6c7a\u5b9a\u7684\ndef random_number, do: :rand.uniform()    # \u975e\u6c7a\u5b9a\u7684\ndef print(msg), do: IO.puts(msg)          # I/O\n</code></pre>"},{"location":"elixir/07-effects-and-pure-functions/#functional-core-imperative-shell","title":"Functional Core, Imperative Shell","text":"<p>\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u3092\u7d14\u7c8b\u95a2\u6570\u3068\u3057\u3066\u5b9f\u88c5\u3057\u3001\u526f\u4f5c\u7528\u306f\u5883\u754c\u5c64\u3067\u51e6\u7406\u3057\u307e\u3059\u3002</p> <pre><code># Functional Core\uff08\u7d14\u7c8b\u95a2\u6570\uff09\ndefmodule PricingCore do\n  def apply_discount(price, %{type: :percentage, value: pct}) do\n    price * (1 - pct / 100)\n  end\n\n  def calculate_total(products) do\n    products |&gt; Enum.map(&amp; &amp;1.price) |&gt; Enum.sum()\n  end\nend\n\n# Imperative Shell\uff08\u526f\u4f5c\u7528\u3092\u6271\u3046\uff09\ndefmodule PricingShell do\n  def calculate_order_price(products, discount_fetcher, discount_code, tax_rate) do\n    # \u526f\u4f5c\u7528\uff1a\u5916\u90e8\u304b\u3089\u5272\u5f15\u60c5\u5831\u3092\u53d6\u5f97\n    discount = discount_fetcher.(discount_code)\n    # \u7d14\u7c8b\u95a2\u6570\u3067\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u3092\u5b9f\u884c\n    PricingCore.calculate_final_price(products, discount, tax_rate)\n  end\nend\n</code></pre>"},{"location":"elixir/07-effects-and-pure-functions/#effect-as-data","title":"\u526f\u4f5c\u7528\u306e\u9045\u5ef6\u5b9f\u884c\uff08Effect as Data\uff09","text":"<p>\u526f\u4f5c\u7528\u3092\u30c7\u30fc\u30bf\u3068\u3057\u3066\u8868\u73fe\u3057\u3001\u5b9f\u884c\u3092\u9045\u5ef6\u3055\u305b\u307e\u3059\u3002</p> <pre><code>defmodule Effect do\n  def console_log(message) do\n    {:effect, :console_log, message, fn _ -&gt; :ok end}\n  end\n\n  def get_current_time do\n    {:effect, :get_time, nil, fn time -&gt; time end}\n  end\n\n  # \u672c\u756a\u7528\u30a4\u30f3\u30bf\u30fc\u30d7\u30ea\u30bf\u30fc\n  def run({:effect, :console_log, message, cont}) do\n    IO.puts(message)\n    cont.(:ok)\n  end\n\n  # \u30c6\u30b9\u30c8\u7528\u30a4\u30f3\u30bf\u30fc\u30d7\u30ea\u30bf\u30fc\n  def run_test({:effect, effect_type, _, cont}, mock_values) do\n    cont.(Map.get(mock_values, effect_type))\n  end\nend\n</code></pre>"},{"location":"elixir/07-effects-and-pure-functions/#reader","title":"Reader \u30d1\u30bf\u30fc\u30f3","text":"<p>\u74b0\u5883\uff08\u8a2d\u5b9a\u3001\u4f9d\u5b58\u6027\uff09\u3092\u5f15\u6570\u3068\u3057\u3066\u6e21\u3059\u95a2\u6570\u3092\u30e9\u30c3\u30d7\u3057\u307e\u3059\u3002</p> <pre><code>defmodule Reader do\n  def pure(value), do: fn _env -&gt; value end\n  def ask, do: fn env -&gt; env end\n  def asks(selector), do: fn env -&gt; selector.(env) end\n\n  def flat_map(reader, f) do\n    fn env -&gt; f.(reader.(env)).(env) end\n  end\n\n  def run(reader, env), do: reader.(env)\nend\n\n# \u4f7f\u7528\u4f8b\ndef get_db_url do\n  Reader.asks(fn config -&gt; config.db_url end)\nend\n\ndef build_service do\n  Reader.flat_map(get_db_url(), fn db_url -&gt;\n    Reader.flat_map(get_api_key(), fn api_key -&gt;\n      Reader.pure(%{db: db_url, key: api_key, ready: true})\n    end)\n  end)\nend\n</code></pre>"},{"location":"elixir/07-effects-and-pure-functions/#_5","title":"\u6642\u9593\u306e\u62bd\u8c61\u5316","text":"<p>\u6642\u9593\u4f9d\u5b58\u3092\u30c6\u30b9\u30c8\u53ef\u80fd\u306b\u3057\u307e\u3059\u3002</p> <pre><code>defmodule TimeService do\n  def add_timestamp(data, time_provider) do\n    Map.put(data, :timestamp, time_provider.())\n  end\n\n  def is_expired?(expiry_date, time_provider) do\n    DateTime.compare(time_provider.(), expiry_date) == :gt\n  end\nend\n\n# \u30c6\u30b9\u30c8\ntest \"is_expired? \u306f\u671f\u9650\u5207\u308c\u3092\u5224\u5b9a\u3059\u308b\" do\n  now = ~U[2024-01-15 12:00:00Z]\n  provider = fn -&gt; now end\n\n  assert TimeService.is_expired?(~U[2024-01-10 12:00:00Z], provider) == true\n  assert TimeService.is_expired?(~U[2024-01-20 12:00:00Z], provider) == false\nend\n</code></pre>"},{"location":"elixir/07-effects-and-pure-functions/#_6","title":"\u307e\u3068\u3081","text":"<ul> <li>\u7d14\u7c8b\u95a2\u6570\u3067\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u3092\u5b9f\u88c5</li> <li>Functional Core, Imperative Shell\u3067\u526f\u4f5c\u7528\u3092\u5206\u96e2</li> <li>\u4f9d\u5b58\u6027\u6ce8\u5165\u3067\u30c6\u30b9\u30c8\u53ef\u80fd\u306a\u8a2d\u8a08</li> <li>Reader \u30d1\u30bf\u30fc\u30f3\u3067\u74b0\u5883\u3092\u5f15\u304d\u56de\u3059</li> </ul>"},{"location":"elixir/07-effects-and-pure-functions/#_7","title":"\u95a2\u9023\u30ea\u30bd\u30fc\u30b9","text":"<ul> <li>Boundaries by Gary Bernhardt</li> <li>Functional Core, Imperative Shell</li> </ul>"},{"location":"elixir/08-error-handling-strategies/","title":"Chapter 08: \u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u6226\u7565","text":"<p>Elixir \u306b\u304a\u3051\u308b\u95a2\u6570\u578b\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u30d1\u30bf\u30fc\u30f3\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"elixir/08-error-handling-strategies/#_1","title":"\u6982\u8981","text":"<p>Elixir \u3067\u306f\u3001\u4f8b\u5916\u3088\u308a\u3082\u623b\u308a\u5024\u306b\u3088\u308b\u660e\u793a\u7684\u306a\u30a8\u30e9\u30fc\u51e6\u7406\u304c\u63a8\u5968\u3055\u308c\u307e\u3059\u3002\u3053\u306e\u30c1\u30e3\u30d7\u30bf\u30fc\u3067\u306f\u3001Result \u578b\u3001Validated \u30d1\u30bf\u30fc\u30f3\u3001\u30a8\u30e9\u30fc\u5fa9\u65e7\u6226\u7565\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002</p>"},{"location":"elixir/08-error-handling-strategies/#_2","title":"\u4e3b\u306a\u30c8\u30d4\u30c3\u30af","text":"<ol> <li>Result \u578b</li> <li>Either \u30d1\u30bf\u30fc\u30f3</li> <li>Validated \u30d1\u30bf\u30fc\u30f3\uff08\u30a8\u30e9\u30fc\u84c4\u7a4d\uff09</li> <li>\u30a8\u30e9\u30fc\u5fa9\u65e7\u30d1\u30bf\u30fc\u30f3</li> <li>\u30a8\u30e9\u30fc\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30ea\u30f3\u30b0</li> </ol>"},{"location":"elixir/08-error-handling-strategies/#result","title":"Result \u578b","text":"<p>\u6210\u529f\u3068\u5931\u6557\u3092\u660e\u793a\u7684\u306b\u8868\u73fe\u3057\u307e\u3059\u3002</p> <pre><code>defmodule Result do\n  @type t(a, e) :: {:ok, a} | {:error, e}\n\n  def ok(value), do: {:ok, value}\n  def error(reason), do: {:error, reason}\n\n  def map({:ok, value}, f), do: {:ok, f.(value)}\n  def map({:error, _} = err, _f), do: err\n\n  def flat_map({:ok, value}, f), do: f.(value)\n  def flat_map({:error, _} = err, _f), do: err\n\n  def unwrap_or({:ok, value}, _default), do: value\n  def unwrap_or({:error, _}, default), do: default\nend\n</code></pre>"},{"location":"elixir/08-error-handling-strategies/#_3","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>def divide(a, b) when b != 0, do: {:ok, a / b}\ndef divide(_, 0), do: {:error, \"Division by zero\"}\n\n# \u30c1\u30a7\u30a4\u30f3\n{:ok, 10}\n|&gt; Result.flat_map(&amp;divide(&amp;1, 2))\n|&gt; Result.flat_map(&amp;divide(&amp;1, 0))\n# =&gt; {:error, \"Division by zero\"}\n</code></pre>"},{"location":"elixir/08-error-handling-strategies/#validated","title":"Validated \u30d1\u30bf\u30fc\u30f3","text":"<p>\u3059\u3079\u3066\u306e\u30a8\u30e9\u30fc\u3092\u84c4\u7a4d\u3057\u307e\u3059\u3002</p> <pre><code>defmodule Validated do\n  @type t(a, e) :: {:valid, a} | {:invalid, [e]}\n\n  def valid(value), do: {:valid, value}\n  def invalid(error), do: {:invalid, [error]}\n\n  def combine({:valid, a}, {:valid, b}, f), do: {:valid, f.(a, b)}\n  def combine({:invalid, e1}, {:invalid, e2}, _f), do: {:invalid, e1 ++ e2}\n  def combine({:valid, _}, {:invalid, errors}, _f), do: {:invalid, errors}\n  def combine({:invalid, errors}, {:valid, _}, _f), do: {:invalid, errors}\nend\n</code></pre>"},{"location":"elixir/08-error-handling-strategies/#_4","title":"\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u4f8b","text":"<pre><code>def validate_user(username, email, age) do\n  username_result = validate_username(username)\n  email_result = validate_email(email)\n  age_result = validate_age(age)\n\n  Validated.sequence([username_result, email_result, age_result])\n  |&gt; Validated.map(fn [u, e, a] -&gt; %{username: u, email: e, age: a} end)\nend\n\n# \u5168\u3066\u306e\u30a8\u30e9\u30fc\u3092\u53ce\u96c6\nvalidate_user(\"\", \"invalid\", 10)\n# =&gt; {:invalid, [{:required_field, \"username\"}, {:invalid_format, \"email\", ...}, {:out_of_range, \"age\", 18, 120}]}\n</code></pre>"},{"location":"elixir/08-error-handling-strategies/#_5","title":"\u30a8\u30e9\u30fc\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30ea\u30f3\u30b0","text":"<p>\u30c9\u30e1\u30a4\u30f3\u56fa\u6709\u306e\u30a8\u30e9\u30fc\u578b\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002</p> <pre><code>defmodule Errors do\n  @type validation_error ::\n    {:required_field, String.t()}\n    | {:invalid_format, String.t(), String.t()}\n    | {:out_of_range, String.t(), number(), number()}\n\n  @type business_error ::\n    {:insufficient_funds, number(), number()}\n    | {:item_not_found, String.t()}\n    | {:duplicate_entry, String.t()}\n\n  def format({:required_field, field}) do\n    \"\u30d5\u30a3\u30fc\u30eb\u30c9 '#{field}' \u306f\u5fc5\u9808\u3067\u3059\"\n  end\n  def format({:insufficient_funds, required, available}) do\n    \"\u6b8b\u9ad8\u4e0d\u8db3: \u5fc5\u8981\u984d #{required}\u3001\u6b8b\u9ad8 #{available}\"\n  end\nend\n</code></pre>"},{"location":"elixir/08-error-handling-strategies/#_6","title":"\u30a8\u30e9\u30fc\u5fa9\u65e7\u30d1\u30bf\u30fc\u30f3","text":""},{"location":"elixir/08-error-handling-strategies/#_7","title":"\u30ea\u30c8\u30e9\u30a4","text":"<pre><code>def retry(operation, max_attempts, should_retry) do\n  result = operation.()\n  cond do\n    Result.ok?(result) -&gt; result\n    attempt &gt;= max_attempts -&gt; result\n    should_retry.(result) -&gt; retry(operation, max_attempts, should_retry, attempt + 1)\n    true -&gt; result\n  end\nend\n</code></pre>"},{"location":"elixir/08-error-handling-strategies/#_8","title":"\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af","text":"<pre><code>def fallback_chain([]), do: {:error, \"all fallbacks failed\"}\ndef fallback_chain([operation | rest]) do\n  case operation.() do\n    {:ok, _} = ok -&gt; ok\n    {:error, _} -&gt; fallback_chain(rest)\n  end\nend\n</code></pre>"},{"location":"elixir/08-error-handling-strategies/#with","title":"\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3 with \u30a8\u30e9\u30fc","text":"<pre><code>defmodule Pipeline do\n  def pipe(initial, functions) do\n    Enum.reduce(functions, initial, fn f, acc -&gt;\n      Result.flat_map(acc, f)\n    end)\n  end\nend\n\nPipeline.pipe({:ok, 10}, [\n  &amp;({:ok, &amp;1 * 2}),\n  &amp;({:ok, &amp;1 + 5})\n])\n# =&gt; {:ok, 25}\n</code></pre>"},{"location":"elixir/08-error-handling-strategies/#_9","title":"\u307e\u3068\u3081","text":"<ul> <li>Result \u578b\u3067\u6210\u529f/\u5931\u6557\u3092\u660e\u793a\u7684\u306b\u8868\u73fe</li> <li>Validated \u30d1\u30bf\u30fc\u30f3\u3067\u5168\u3066\u306e\u30a8\u30e9\u30fc\u3092\u84c4\u7a4d</li> <li>\u30a8\u30e9\u30fc\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30ea\u30f3\u30b0\u3067\u578b\u5b89\u5168\u306a\u30a8\u30e9\u30fc\u51e6\u7406</li> <li>\u30ea\u30c8\u30e9\u30a4/\u30d5\u30a9\u30fc\u30eb\u30d0\u30c3\u30af\u3067\u5fa9\u65e7\u53ef\u80fd\u306a\u30a8\u30e9\u30fc\u3092\u51e6\u7406</li> </ul>"},{"location":"elixir/08-error-handling-strategies/#_10","title":"\u95a2\u9023\u30ea\u30bd\u30fc\u30b9","text":"<ul> <li>Railway Oriented Programming</li> <li>Elixir with Pattern</li> </ul>"},{"location":"elixir/09-io-and-external-systems/","title":"Chapter 09: I/O \u3068\u5916\u90e8\u30b7\u30b9\u30c6\u30e0","text":"<p>Elixir \u306b\u304a\u3051\u308b I/O \u64cd\u4f5c\u3068\u5916\u90e8\u30b7\u30b9\u30c6\u30e0\u3068\u306e\u9023\u643a\u3092\u95a2\u6570\u578b\u306b\u6271\u3046\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"elixir/09-io-and-external-systems/#_1","title":"\u6982\u8981","text":"<p>I/O \u64cd\u4f5c\u3084\u5916\u90e8\u30b7\u30b9\u30c6\u30e0\u3068\u306e\u9023\u643a\u306f\u526f\u4f5c\u7528\u3092\u4f34\u3044\u307e\u3059\u3002\u3053\u306e\u30c1\u30e3\u30d7\u30bf\u30fc\u3067\u306f\u3001\u3053\u308c\u3089\u3092\u62bd\u8c61\u5316\u3057\u3066\u30c6\u30b9\u30c8\u53ef\u80fd\u306b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002</p>"},{"location":"elixir/09-io-and-external-systems/#_2","title":"\u4e3b\u306a\u30c8\u30d4\u30c3\u30af","text":"<ol> <li>I/O \u306e\u62bd\u8c61\u5316</li> <li>\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u64cd\u4f5c</li> <li>\u30ea\u30dd\u30b8\u30c8\u30ea\u30d1\u30bf\u30fc\u30f3</li> <li>HTTP \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u62bd\u8c61\u5316</li> <li>\u8a2d\u5b9a\u7ba1\u7406</li> <li>\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u98a8\u64cd\u4f5c</li> </ol>"},{"location":"elixir/09-io-and-external-systems/#io","title":"\u30b3\u30f3\u30bd\u30fc\u30eb I/O \u306e\u62bd\u8c61\u5316","text":"<pre><code>defmodule IO.Console do\n  @type console :: %{\n    read: (() -&gt; String.t()),\n    write: (String.t() -&gt; :ok)\n  }\n\n  def standard do\n    %{\n      read: fn -&gt; IO.gets(\"\") |&gt; String.trim() end,\n      write: fn msg -&gt; IO.puts(msg); :ok end\n    }\n  end\n\n  def test_console(inputs) do\n    {:ok, input_agent} = Agent.start_link(fn -&gt; inputs end)\n    {:ok, output_agent} = Agent.start_link(fn -&gt; [] end)\n\n    console = %{\n      read: fn -&gt;\n        Agent.get_and_update(input_agent, fn\n          [head | tail] -&gt; {head, tail}\n          [] -&gt; {\"\", []}\n        end)\n      end,\n      write: fn msg -&gt;\n        Agent.update(output_agent, fn outputs -&gt; outputs ++ [msg] end)\n        :ok\n      end\n    }\n\n    get_output = fn -&gt; Agent.get(output_agent, &amp; &amp;1) end\n    {console, get_output}\n  end\nend\n</code></pre>"},{"location":"elixir/09-io-and-external-systems/#_3","title":"\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306e\u62bd\u8c61\u5316","text":"<pre><code>defmodule IO.FileSystem do\n  def in_memory(initial_files \\\\ %{}) do\n    {:ok, agent} = Agent.start_link(fn -&gt; initial_files end)\n\n    fs = %{\n      read: fn path -&gt;\n        case Agent.get(agent, &amp;Map.get(&amp;1, path)) do\n          nil -&gt; {:error, :enoent}\n          content -&gt; {:ok, content}\n        end\n      end,\n      write: fn path, content -&gt;\n        Agent.update(agent, &amp;Map.put(&amp;1, path, content))\n        :ok\n      end,\n      exists?: fn path -&gt; Agent.get(agent, &amp;Map.has_key?(&amp;1, path)) end,\n      delete: fn path -&gt; Agent.update(agent, &amp;Map.delete(&amp;1, path)); :ok end\n    }\n\n    get_state = fn -&gt; Agent.get(agent, &amp; &amp;1) end\n    {fs, get_state}\n  end\nend\n</code></pre>"},{"location":"elixir/09-io-and-external-systems/#_4","title":"\u30ea\u30dd\u30b8\u30c8\u30ea\u30d1\u30bf\u30fc\u30f3","text":"<pre><code>defmodule Repository do\n  def in_memory do\n    {:ok, agent} = Agent.start_link(fn -&gt; %{} end)\n\n    %{\n      find: fn id -&gt;\n        case Agent.get(agent, &amp;Map.get(&amp;1, id)) do\n          nil -&gt; {:error, :not_found}\n          entity -&gt; {:ok, entity}\n        end\n      end,\n      find_all: fn -&gt; Agent.get(agent, &amp;Map.values(&amp;1)) end,\n      save: fn entity -&gt;\n        Agent.update(agent, &amp;Map.put(&amp;1, entity.id, entity))\n        {:ok, entity}\n      end,\n      delete: fn id -&gt;\n        Agent.update(agent, &amp;Map.delete(&amp;1, id))\n        :ok\n      end,\n      exists?: fn id -&gt; Agent.get(agent, &amp;Map.has_key?(&amp;1, id)) end\n    }\n  end\n\n  def find_by(repo, predicate) do\n    repo.find_all.() |&gt; Enum.filter(predicate)\n  end\nend\n</code></pre>"},{"location":"elixir/09-io-and-external-systems/#http","title":"HTTP \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u62bd\u8c61\u5316","text":"<pre><code>defmodule Http do\n  def test_client(responses) do\n    make_request = fn url -&gt;\n      case Map.get(responses, url) do\n        nil -&gt; {:error, :not_found}\n        response -&gt; {:ok, response}\n      end\n    end\n\n    %{\n      get: make_request,\n      post: fn url, _body -&gt; make_request.(url) end,\n      put: fn url, _body -&gt; make_request.(url) end,\n      delete: make_request\n    }\n  end\nend\n\n# \u4f7f\u7528\u4f8b\nresponses = %{\n  \"https://api.example.com/users/1\" =&gt; %{\n    status: 200,\n    body: ~s({\"id\": \"1\", \"name\": \"Alice\"})\n  }\n}\n\nclient = Http.test_client(responses)\n{:ok, response} = client.get.(\"https://api.example.com/users/1\")\n</code></pre>"},{"location":"elixir/09-io-and-external-systems/#_5","title":"\u8a2d\u5b9a\u7ba1\u7406","text":"<pre><code>defmodule Config do\n  def from_map(config) do\n    %{\n      get: &amp;Map.get(config, &amp;1),\n      get_all: fn -&gt; config end\n    }\n  end\n\n  def require(source, key) do\n    case source.get.(key) do\n      nil -&gt; {:error, {:missing_config, key}}\n      value -&gt; {:ok, value}\n    end\n  end\n\n  def get_or_default(source, key, default) do\n    source.get.(key) || default\n  end\n\n  def get_integer(source, key, default) do\n    case source.get.(key) do\n      nil -&gt; default\n      value -&gt;\n        case Integer.parse(value) do\n          {int, \"\"} -&gt; int\n          _ -&gt; default\n        end\n    end\n  end\nend\n</code></pre>"},{"location":"elixir/09-io-and-external-systems/#_6","title":"\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u98a8\u64cd\u4f5c","text":"<pre><code>defmodule Transaction do\n  def execute(operations) do\n    do_execute(operations, [], [])\n  end\n\n  defp do_execute([], results, _rollbacks), do: {:ok, Enum.reverse(results)}\n  defp do_execute([{operation, rollback} | rest], results, rollbacks) do\n    case operation.() do\n      {:ok, result} -&gt;\n        do_execute(rest, [result | results], [rollback | rollbacks])\n      {:error, reason} -&gt;\n        Enum.each(rollbacks, fn rb -&gt; rb.() end)\n        {:error, reason}\n    end\n  end\n\n  def with_resource(acquire, release, use) do\n    case acquire.() do\n      {:ok, resource} -&gt;\n        try do\n          use.(resource)\n        after\n          release.(resource)\n        end\n      {:error, _} = error -&gt; error\n    end\n  end\nend\n</code></pre>"},{"location":"elixir/09-io-and-external-systems/#_7","title":"\u30b5\u30fc\u30d3\u30b9\u5c64\u306e\u4f8b","text":"<pre><code>defmodule UserService do\n  def create_user(repo, params, id_generator, time_provider) do\n    with :ok &lt;- validate_name(params.name),\n         :ok &lt;- validate_email(params.email),\n         false &lt;- email_exists?(repo, params.email) do\n      user = %{\n        id: id_generator.(),\n        name: params.name,\n        email: params.email,\n        created_at: time_provider.()\n      }\n      repo.save.(user)\n      {:ok, user}\n    else\n      {:error, _} = error -&gt; error\n      true -&gt; {:error, :email_already_exists}\n    end\n  end\nend\n</code></pre>"},{"location":"elixir/09-io-and-external-systems/#_8","title":"\u307e\u3068\u3081","text":"<ul> <li>I/O \u306e\u62bd\u8c61\u5316\u3067\u30c6\u30b9\u30c8\u53ef\u80fd\u306a\u8a2d\u8a08</li> <li>\u30ea\u30dd\u30b8\u30c8\u30ea\u30d1\u30bf\u30fc\u30f3\u3067\u30c7\u30fc\u30bf\u6c38\u7d9a\u5316\u3092\u62bd\u8c61\u5316</li> <li>HTTP \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u62bd\u8c61\u5316\u3067\u5916\u90e8 API \u3092\u30e2\u30c3\u30af</li> <li>\u8a2d\u5b9a\u7ba1\u7406\u3067\u74b0\u5883\u4f9d\u5b58\u3092\u5206\u96e2</li> <li>\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u98a8\u64cd\u4f5c\u3067\u30ea\u30bd\u30fc\u30b9\u7ba1\u7406\u3092\u5b89\u5168\u306b</li> </ul>"},{"location":"elixir/09-io-and-external-systems/#_9","title":"\u95a2\u9023\u30ea\u30bd\u30fc\u30b9","text":"<ul> <li>Hexagonal Architecture</li> <li>Ports and Adapters</li> </ul>"},{"location":"elixir/10-concurrency-patterns/","title":"Chapter 10: \u4e26\u884c\u51e6\u7406\u30d1\u30bf\u30fc\u30f3","text":"<p>Elixir \u306b\u304a\u3051\u308b\u4e26\u884c\u51e6\u7406\u30d1\u30bf\u30fc\u30f3\u3092\u5b66\u3073\u307e\u3059\u3002\u30a2\u30af\u30bf\u30fc\u30e2\u30c7\u30eb\u3068\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3092\u7d44\u307f\u5408\u308f\u305b\u305f\u5b89\u5168\u306a\u4e26\u884c\u51e6\u7406\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002</p>"},{"location":"elixir/10-concurrency-patterns/#_1","title":"\u6982\u8981","text":"<p>Elixir \u306f Erlang VM \u4e0a\u3067\u52d5\u4f5c\u3057\u3001\u8efd\u91cf\u30d7\u30ed\u30bb\u30b9\u306b\u3088\u308b\u4e26\u884c\u51e6\u7406\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u307e\u3059\u3002\u3053\u306e\u30c1\u30e3\u30d7\u30bf\u30fc\u3067\u306f\u3001\u30d7\u30ed\u30bb\u30b9\u3001Agent\u3001GenServer\u3001Task \u3092\u4f7f\u3063\u305f\u4e26\u884c\u51e6\u7406\u30d1\u30bf\u30fc\u30f3\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002</p>"},{"location":"elixir/10-concurrency-patterns/#_2","title":"\u4e3b\u306a\u30c8\u30d4\u30c3\u30af","text":"<ol> <li>\u30d7\u30ed\u30bb\u30b9\u3068\u30e1\u30c3\u30bb\u30fc\u30b8\u30d1\u30c3\u30b7\u30f3\u30b0</li> <li>Agent\uff08\u72b6\u614b\u7ba1\u7406\uff09</li> <li>GenServer\uff08\u6c4e\u7528\u30b5\u30fc\u30d0\u30fc\uff09</li> <li>Task\uff08\u975e\u540c\u671f\u51e6\u7406\uff09</li> <li>\u4e26\u5217\u51e6\u7406\u30d1\u30bf\u30fc\u30f3</li> <li>\u540c\u671f\u30d1\u30bf\u30fc\u30f3</li> </ol>"},{"location":"elixir/10-concurrency-patterns/#_3","title":"\u57fa\u672c\u7684\u306a\u30d7\u30ed\u30bb\u30b9","text":"<pre><code>defmodule BasicProcess do\n  def start_echo do\n    spawn(fn -&gt; echo_loop() end)\n  end\n\n  defp echo_loop do\n    receive do\n      {:echo, from, message} -&gt;\n        send(from, {:echoed, message})\n        echo_loop()\n      :stop -&gt; :ok\n    end\n  end\nend\n\n# \u4f7f\u7528\u4f8b\npid = BasicProcess.start_echo()\nsend(pid, {:echo, self(), \"hello\"})\nreceive do\n  {:echoed, msg} -&gt; msg  # =&gt; \"hello\"\nend\n</code></pre>"},{"location":"elixir/10-concurrency-patterns/#agent","title":"Agent\uff08\u72b6\u614b\u7ba1\u7406\uff09","text":"<pre><code>defmodule Counter do\n  def start(initial_value \\\\ 0) do\n    Agent.start_link(fn -&gt; initial_value end)\n  end\n\n  def get(counter), do: Agent.get(counter, &amp; &amp;1)\n  def increment(counter), do: Agent.update(counter, &amp;(&amp;1 + 1))\n  def decrement(counter), do: Agent.update(counter, &amp;(&amp;1 - 1))\n  def add(counter, value), do: Agent.update(counter, &amp;(&amp;1 + value))\n  def reset(counter), do: Agent.update(counter, fn _ -&gt; 0 end)\nend\n\n# \u4e26\u884c\u30a2\u30af\u30bb\u30b9\u3067\u3082\u5b89\u5168\n{:ok, counter} = Counter.start(0)\ntasks = for _ &lt;- 1..100 do\n  Task.async(fn -&gt; Counter.increment(counter) end)\nend\nEnum.each(tasks, &amp;Task.await/1)\nCounter.get(counter)  # =&gt; 100\n</code></pre>"},{"location":"elixir/10-concurrency-patterns/#genserver","title":"GenServer","text":"<pre><code>defmodule BankAccount do\n  use GenServer\n\n  # Client API\n  def open(account_id, initial_balance \\\\ 0) do\n    GenServer.start_link(__MODULE__, %{id: account_id, balance: initial_balance})\n  end\n\n  def balance(account), do: GenServer.call(account, :balance)\n  def deposit(account, amount), do: GenServer.call(account, {:deposit, amount})\n  def withdraw(account, amount), do: GenServer.call(account, {:withdraw, amount})\n\n  # Server Callbacks\n  @impl true\n  def init(state), do: {:ok, state}\n\n  @impl true\n  def handle_call(:balance, _from, state) do\n    {:reply, state.balance, state}\n  end\n\n  @impl true\n  def handle_call({:deposit, amount}, _from, state) when amount &gt; 0 do\n    new_balance = state.balance + amount\n    {:reply, {:ok, new_balance}, %{state | balance: new_balance}}\n  end\n\n  @impl true\n  def handle_call({:withdraw, amount}, _from, state) do\n    if state.balance &gt;= amount do\n      new_balance = state.balance - amount\n      {:reply, {:ok, new_balance}, %{state | balance: new_balance}}\n    else\n      {:reply, {:error, \"\u6b8b\u9ad8\u4e0d\u8db3\"}, state}\n    end\n  end\nend\n</code></pre>"},{"location":"elixir/10-concurrency-patterns/#task","title":"Task\uff08\u975e\u540c\u671f\u51e6\u7406\uff09","text":"<pre><code>defmodule AsyncTasks do\n  def parallel_execute(functions) do\n    functions\n    |&gt; Enum.map(&amp;Task.async/1)\n    |&gt; Enum.map(&amp;Task.await/1)\n  end\n\n  def parallel_map(list, fun) do\n    list\n    |&gt; Enum.map(fn item -&gt; Task.async(fn -&gt; fun.(item) end) end)\n    |&gt; Enum.map(&amp;Task.await/1)\n  end\n\n  def with_timeout(fun, timeout_ms) do\n    task = Task.async(fun)\n    case Task.yield(task, timeout_ms) || Task.shutdown(task) do\n      {:ok, result} -&gt; {:ok, result}\n      nil -&gt; {:error, :timeout}\n    end\n  end\n\n  def race(functions) do\n    parent = self()\n    pids = Enum.map(functions, fn fun -&gt;\n      spawn(fn -&gt;\n        result = fun.()\n        send(parent, {:result, self(), result})\n      end)\n    end)\n\n    receive do\n      {:result, _pid, result} -&gt;\n        Enum.each(pids, fn pid -&gt;\n          if Process.alive?(pid), do: Process.exit(pid, :kill)\n        end)\n        result\n    end\n  end\nend\n</code></pre>"},{"location":"elixir/10-concurrency-patterns/#_4","title":"\u4e26\u5217\u51e6\u7406\u30d1\u30bf\u30fc\u30f3","text":""},{"location":"elixir/10-concurrency-patterns/#map-reduce","title":"Map-Reduce","text":"<pre><code>def map_reduce(data, mapper, reducer) do\n  data\n  |&gt; Task.async_stream(mapper, ordered: false)\n  |&gt; Enum.map(fn {:ok, result} -&gt; result end)\n  |&gt; reducer.()\nend\n\n# \u4f7f\u7528\u4f8b\ndata = [1, 2, 3, 4, 5]\nmap_reduce(data, &amp;(&amp;1 * 2), &amp;Enum.sum/1)  # =&gt; 30\n</code></pre>"},{"location":"elixir/10-concurrency-patterns/#_5","title":"\u30d5\u30a1\u30f3\u30a2\u30a6\u30c8\u30fb\u30d5\u30a1\u30f3\u30a4\u30f3","text":"<pre><code>def fan_out_fan_in(data, workers) do\n  workers\n  |&gt; Enum.map(fn worker -&gt; Task.async(fn -&gt; worker.(data) end) end)\n  |&gt; Enum.map(&amp;Task.await/1)\nend\n</code></pre>"},{"location":"elixir/10-concurrency-patterns/#_6","title":"\u30d0\u30c3\u30c1\u51e6\u7406","text":"<pre><code>def batch_process(data, batch_size, processor) do\n  data\n  |&gt; Enum.chunk_every(batch_size)\n  |&gt; Task.async_stream(processor)\n  |&gt; Enum.map(fn {:ok, result} -&gt; result end)\nend\n</code></pre>"},{"location":"elixir/10-concurrency-patterns/#_7","title":"\u540c\u671f\u30d1\u30bf\u30fc\u30f3","text":""},{"location":"elixir/10-concurrency-patterns/#_8","title":"\u30bb\u30de\u30d5\u30a9","text":"<pre><code>def semaphore(max_permits) do\n  Agent.start_link(fn -&gt; max_permits end)\nend\n\ndef acquire(sem) do\n  case Agent.get_and_update(sem, fn\n    0 -&gt; {0, 0}\n    n -&gt; {n, n - 1}\n  end) do\n    0 -&gt; Process.sleep(10); acquire(sem)\n    _ -&gt; :ok\n  end\nend\n\ndef release(sem) do\n  Agent.update(sem, &amp;(&amp;1 + 1))\nend\n</code></pre>"},{"location":"elixir/10-concurrency-patterns/#_9","title":"\u30ea\u30bd\u30fc\u30b9\u30d7\u30fc\u30eb","text":"<pre><code>def resource_pool(resources) do\n  Agent.start_link(fn -&gt; resources end)\nend\n\ndef borrow(pool) do\n  Agent.get_and_update(pool, fn\n    [] -&gt; {{:error, :empty}, []}\n    [head | tail] -&gt; {{:ok, head}, tail}\n  end)\nend\n\ndef return(pool, resource) do\n  Agent.update(pool, fn resources -&gt; [resource | resources] end)\nend\n</code></pre>"},{"location":"elixir/10-concurrency-patterns/#_10","title":"\u30a4\u30d9\u30f3\u30c8\u30d0\u30b9","text":"<pre><code>defmodule EventBus do\n  def start, do: Agent.start_link(fn -&gt; %{} end)\n\n  def subscribe(bus, event_type, subscriber) do\n    Agent.update(bus, fn subscriptions -&gt;\n      current = Map.get(subscriptions, event_type, [])\n      Map.put(subscriptions, event_type, [subscriber | current])\n    end)\n  end\n\n  def publish(bus, event_type, payload) do\n    subscribers = Agent.get(bus, fn subs -&gt; Map.get(subs, event_type, []) end)\n    Enum.each(subscribers, fn sub -&gt; send(sub, {:event, event_type, payload}) end)\n    :ok\n  end\nend\n</code></pre>"},{"location":"elixir/10-concurrency-patterns/#_11","title":"\u307e\u3068\u3081","text":"<ul> <li>\u30d7\u30ed\u30bb\u30b9\u3067\u8efd\u91cf\u306a\u4e26\u884c\u51e6\u7406</li> <li>Agent\u3067\u72b6\u614b\u3092\u5b89\u5168\u306b\u7ba1\u7406</li> <li>GenServer\u3067\u30b9\u30c6\u30fc\u30c8\u30d5\u30eb\u306a\u30b5\u30fc\u30d0\u30fc\u3092\u5b9f\u88c5</li> <li>Task\u3067\u975e\u540c\u671f\u51e6\u7406\u3092\u7c21\u6f54\u306b</li> <li>\u4e26\u5217\u30d1\u30bf\u30fc\u30f3\uff08Map-Reduce\u3001\u30d5\u30a1\u30f3\u30a2\u30a6\u30c8\u30fb\u30d5\u30a1\u30f3\u30a4\u30f3\uff09\u3067\u52b9\u7387\u7684\u306a\u51e6\u7406</li> <li>\u540c\u671f\u30d1\u30bf\u30fc\u30f3\uff08\u30bb\u30de\u30d5\u30a9\u3001\u30ea\u30bd\u30fc\u30b9\u30d7\u30fc\u30eb\uff09\u3067\u7af6\u5408\u3092\u5236\u5fa1</li> </ul>"},{"location":"elixir/10-concurrency-patterns/#_12","title":"\u95a2\u9023\u30ea\u30bd\u30fc\u30b9","text":"<ul> <li>Elixir GenServer</li> <li>Elixir Task</li> <li>The Actor Model</li> </ul>"},{"location":"elixir/11-command-pattern/","title":"\u7b2c11\u7ae0: Command \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"elixir/11-command-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Command \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\uff08\u30c7\u30fc\u30bf\uff09\u3068\u3057\u3066\u30ab\u30d7\u30bb\u30eb\u5316\u3057\u3001\u7570\u306a\u308b\u30ea\u30af\u30a8\u30b9\u30c8\u3067\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u30d1\u30e9\u30e1\u30fc\u30bf\u5316\u3057\u305f\u308a\u3001\u64cd\u4f5c\u306e\u5c65\u6b74\u3092\u8a18\u9332\u3057\u305f\u308a\u3001Undo/Redo \u6a5f\u80fd\u3092\u5b9f\u88c5\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002</p> <p>Elixir \u3067\u306f\u3001\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u4f7f\u7528\u3057\u3066\u30b3\u30de\u30f3\u30c9\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u5b9a\u7fa9\u3057\u3001\u69cb\u9020\u4f53\u3067\u30b3\u30de\u30f3\u30c9\u3092\u8868\u73fe\u3057\u307e\u3059\u3002</p>"},{"location":"elixir/11-command-pattern/#1-command","title":"1. Command \u30d7\u30ed\u30c8\u30b3\u30eb","text":"<pre><code>defprotocol Command do\n  @doc \"\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3057\u3001\u65b0\u3057\u3044\u72b6\u614b\u3092\u8fd4\u3059\"\n  def execute(command, state)\n\n  @doc \"\u30b3\u30de\u30f3\u30c9\u3092\u53d6\u308a\u6d88\u3057\u3001\u4ee5\u524d\u306e\u72b6\u614b\u3092\u8fd4\u3059\"\n  def undo(command, state)\nend\n</code></pre>"},{"location":"elixir/11-command-pattern/#2","title":"2. \u30c6\u30ad\u30b9\u30c8\u64cd\u4f5c\u30b3\u30de\u30f3\u30c9","text":""},{"location":"elixir/11-command-pattern/#insertcommand","title":"InsertCommand","text":"<pre><code>defmodule InsertCommand do\n  defstruct [:position, :text]\n\n  def new(position, text), do: %__MODULE__{position: position, text: text}\nend\n\ndefimpl Command, for: InsertCommand do\n  def execute(%InsertCommand{position: pos, text: text}, document) do\n    before = String.slice(document, 0, pos)\n    after_text = String.slice(document, pos..-1//1)\n    before &lt;&gt; text &lt;&gt; after_text\n  end\n\n  def undo(%InsertCommand{position: pos, text: text}, document) do\n    len = String.length(text)\n    before = String.slice(document, 0, pos)\n    after_text = String.slice(document, (pos + len)..-1//1)\n    before &lt;&gt; after_text\n  end\nend\n</code></pre>"},{"location":"elixir/11-command-pattern/#_2","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>cmd = InsertCommand.new(5, \" World\")\nresult = Command.execute(cmd, \"Hello\")\n# =&gt; \"Hello World\"\n\nrestored = Command.undo(cmd, \"Hello World\")\n# =&gt; \"Hello\"\n</code></pre>"},{"location":"elixir/11-command-pattern/#3","title":"3. \u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u5668","text":"<pre><code>defmodule CommandExecutor do\n  defstruct [:state, undo_stack: [], redo_stack: []]\n\n  def new(initial_state), do: %__MODULE__{state: initial_state}\n\n  def execute(%__MODULE__{state: state, undo_stack: undo} = executor, command) do\n    new_state = Command.execute(command, state)\n    %{executor |\n      state: new_state,\n      undo_stack: [command | undo],\n      redo_stack: []\n    }\n  end\n\n  def undo(%__MODULE__{undo_stack: []} = executor), do: executor\n  def undo(%__MODULE__{state: state, undo_stack: [cmd | rest], redo_stack: redo} = executor) do\n    new_state = Command.undo(cmd, state)\n    %{executor |\n      state: new_state,\n      undo_stack: rest,\n      redo_stack: [cmd | redo]\n    }\n  end\n\n  def redo(%__MODULE__{redo_stack: []} = executor), do: executor\n  def redo(%__MODULE__{state: state, undo_stack: undo, redo_stack: [cmd | rest]} = executor) do\n    new_state = Command.execute(cmd, state)\n    %{executor |\n      state: new_state,\n      undo_stack: [cmd | undo],\n      redo_stack: rest\n    }\n  end\nend\n</code></pre>"},{"location":"elixir/11-command-pattern/#4","title":"4. \u30de\u30af\u30ed\u30b3\u30de\u30f3\u30c9","text":"<p>\u8907\u6570\u306e\u30b3\u30de\u30f3\u30c9\u30921\u3064\u306b\u307e\u3068\u3081\u3066\u5b9f\u884c\uff1a</p> <pre><code>defmodule MacroCommand do\n  defstruct [:commands]\n\n  def new(commands), do: %__MODULE__{commands: commands}\nend\n\ndefimpl Command, for: MacroCommand do\n  def execute(%MacroCommand{commands: commands}, state) do\n    Enum.reduce(commands, state, &amp;Command.execute(&amp;1, &amp;2))\n  end\n\n  def undo(%MacroCommand{commands: commands}, state) do\n    Enum.reduce(Enum.reverse(commands), state, &amp;Command.undo(&amp;1, &amp;2))\n  end\nend\n</code></pre>"},{"location":"elixir/11-command-pattern/#5","title":"5. \u30ad\u30e3\u30f3\u30d0\u30b9\u64cd\u4f5c","text":"<p>\u56f3\u5f62\u306e\u8ffd\u52a0\u30fb\u79fb\u52d5\u30fb\u524a\u9664\u3082\u30b3\u30de\u30f3\u30c9\u3067\u8868\u73fe\uff1a</p> <pre><code>defmodule AddShapeCommand do\n  defstruct [:shape]\nend\n\ndefimpl Command, for: AddShapeCommand do\n  def execute(%{shape: shape}, %{shapes: shapes} = canvas) do\n    %{canvas | shapes: shapes ++ [shape]}\n  end\n\n  def undo(%{shape: shape}, %{shapes: shapes} = canvas) do\n    %{canvas | shapes: Enum.reject(shapes, &amp;(&amp;1.id == shape.id))}\n  end\nend\n</code></pre>"},{"location":"elixir/11-command-pattern/#_3","title":"\u307e\u3068\u3081","text":"<p>Elixir \u3067\u306e Command \u30d1\u30bf\u30fc\u30f3\u306e\u30dd\u30a4\u30f3\u30c8\uff1a</p> <ul> <li>Protocol \u3067\u30b3\u30de\u30f3\u30c9\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u5b9a\u7fa9</li> <li>Struct \u3067\u30b3\u30de\u30f3\u30c9\u30c7\u30fc\u30bf\u3092\u8868\u73fe</li> <li>\u4e0d\u5909\u6027 \u3092\u6d3b\u304b\u3057\u305f\u72b6\u614b\u7ba1\u7406</li> <li>Undo/Redo \u30b9\u30bf\u30c3\u30af\u306b\u3088\u308b\u5c65\u6b74\u7ba1\u7406</li> <li>MacroCommand \u3067\u8907\u5408\u64cd\u4f5c\u3092\u30b5\u30dd\u30fc\u30c8</li> </ul>"},{"location":"elixir/12-visitor-pattern/","title":"\u7b2c12\u7ae0: Visitor \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"elixir/12-visitor-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Visitor \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30c7\u30fc\u30bf\u69cb\u9020\u3068\u64cd\u4f5c\u3092\u5206\u96e2\u3057\u3001\u65e2\u5b58\u306e\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u5909\u66f4\u3059\u308b\u3053\u3068\u306a\u304f\u65b0\u3057\u3044\u64cd\u4f5c\u3092\u8ffd\u52a0\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002</p> <p>Elixir \u3067\u306f\u3001\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u4f7f\u7528\u3057\u3066 Visitor \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u5b9a\u7fa9\u3057\u3001\u5404\u56f3\u5f62\u30bf\u30a4\u30d7\u306b\u5bfe\u3059\u308b\u5b9f\u88c5\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002</p>"},{"location":"elixir/12-visitor-pattern/#1-element","title":"1. Element: \u56f3\u5f62\u306e\u5b9a\u7fa9","text":"<pre><code>defmodule Circle do\n  defstruct [:center, :radius]\n  def new(center, radius), do: %__MODULE__{center: center, radius: radius}\nend\n\ndefmodule Square do\n  defstruct [:top_left, :side]\n  def new(top_left, side), do: %__MODULE__{top_left: top_left, side: side}\nend\n\ndefmodule Rectangle do\n  defstruct [:top_left, :width, :height]\n  def new(top_left, width, height) do\n    %__MODULE__{top_left: top_left, width: width, height: height}\n  end\nend\n</code></pre>"},{"location":"elixir/12-visitor-pattern/#2-visitor","title":"2. Visitor \u30d7\u30ed\u30c8\u30b3\u30eb","text":"<pre><code>defprotocol ShapeVisitor do\n  @doc \"\u56f3\u5f62\u3092\u8a2a\u554f\u3057\u3066\u51e6\u7406\u3092\u884c\u3046\"\n  def visit(visitor, shape)\nend\n</code></pre>"},{"location":"elixir/12-visitor-pattern/#3-json-visitor","title":"3. JSON Visitor","text":"<pre><code>defmodule JsonVisitor do\n  defstruct []\n  def new, do: %__MODULE__{}\n\n  def to_json(shape), do: ShapeVisitor.visit(new(), shape)\nend\n\ndefimpl ShapeVisitor, for: JsonVisitor do\n  def visit(_visitor, %Circle{center: {x, y}, radius: r}) do\n    ~s({\"type\":\"circle\",\"center\":[#{x},#{y}],\"radius\":#{r}})\n  end\n\n  def visit(_visitor, %Square{top_left: {x, y}, side: s}) do\n    ~s({\"type\":\"square\",\"topLeft\":[#{x},#{y}],\"side\":#{s}})\n  end\n\n  def visit(_visitor, %Rectangle{top_left: {x, y}, width: w, height: h}) do\n    ~s({\"type\":\"rectangle\",\"topLeft\":[#{x},#{y}],\"width\":#{w},\"height\":#{h}})\n  end\nend\n</code></pre>"},{"location":"elixir/12-visitor-pattern/#4-area-visitor","title":"4. Area Visitor","text":"<pre><code>defmodule AreaVisitor do\n  defstruct []\n  def new, do: %__MODULE__{}\n\n  def calculate_area(shape), do: ShapeVisitor.visit(new(), shape)\n\n  def total_area(shapes) do\n    Enum.reduce(shapes, 0, &amp;(&amp;2 + calculate_area(&amp;1)))\n  end\nend\n\ndefimpl ShapeVisitor, for: AreaVisitor do\n  def visit(_visitor, %Circle{radius: r}) do\n    :math.pi() * r * r\n  end\n\n  def visit(_visitor, %Square{side: s}) do\n    s * s\n  end\n\n  def visit(_visitor, %Rectangle{width: w, height: h}) do\n    w * h\n  end\nend\n</code></pre>"},{"location":"elixir/12-visitor-pattern/#5-perimeter-visitor","title":"5. Perimeter Visitor","text":"<pre><code>defmodule PerimeterVisitor do\n  defstruct []\n  def new, do: %__MODULE__{}\n\n  def calculate_perimeter(shape), do: ShapeVisitor.visit(new(), shape)\nend\n\ndefimpl ShapeVisitor, for: PerimeterVisitor do\n  def visit(_visitor, %Circle{radius: r}), do: 2 * :math.pi() * r\n  def visit(_visitor, %Square{side: s}), do: 4 * s\n  def visit(_visitor, %Rectangle{width: w, height: h}), do: 2 * (w + h)\nend\n</code></pre>"},{"location":"elixir/12-visitor-pattern/#6-svg-visitor","title":"6. SVG Visitor","text":"<pre><code>defmodule SvgVisitor do\n  defstruct fill: \"none\", stroke: \"black\", stroke_width: 1\n\n  def new(opts \\\\ []) do\n    %__MODULE__{\n      fill: Keyword.get(opts, :fill, \"none\"),\n      stroke: Keyword.get(opts, :stroke, \"black\"),\n      stroke_width: Keyword.get(opts, :stroke_width, 1)\n    }\n  end\nend\n\ndefimpl ShapeVisitor, for: SvgVisitor do\n  def visit(%{fill: f, stroke: s, stroke_width: sw}, %Circle{center: {cx, cy}, radius: r}) do\n    ~s(&lt;circle cx=\"#{cx}\" cy=\"#{cy}\" r=\"#{r}\" fill=\"#{f}\" stroke=\"#{s}\" stroke-width=\"#{sw}\"/&gt;)\n  end\n  # ... \u4ed6\u306e\u56f3\u5f62\u3082\u540c\u69d8\nend\n</code></pre>"},{"location":"elixir/12-visitor-pattern/#7-visitor","title":"7. \u8907\u5408 Visitor","text":"<pre><code>defmodule CompositeVisitor do\n  def apply_all(shape, visitors) do\n    Map.new(visitors, fn {key, visitor} -&gt;\n      {key, ShapeVisitor.visit(visitor, shape)}\n    end)\n  end\nend\n\n# \u4f7f\u7528\u4f8b\nresults = CompositeVisitor.apply_all(circle, [\n  {:json, JsonVisitor.new()},\n  {:area, AreaVisitor.new()}\n])\n</code></pre>"},{"location":"elixir/12-visitor-pattern/#8-drawingcontext","title":"8. DrawingContext","text":"<pre><code>defmodule DrawingContext do\n  defstruct shapes: []\n\n  def add_shape(ctx, shape), do: %{ctx | shapes: ctx.shapes ++ [shape]}\n\n  def to_json(%{shapes: shapes}) do\n    json_items = Enum.map(shapes, &amp;JsonVisitor.to_json/1)\n    \"[\" &lt;&gt; Enum.join(json_items, \",\") &lt;&gt; \"]\"\n  end\n\n  def total_area(%{shapes: shapes}), do: AreaVisitor.total_area(shapes)\nend\n</code></pre>"},{"location":"elixir/12-visitor-pattern/#_2","title":"\u307e\u3068\u3081","text":"<p>Elixir \u3067\u306e Visitor \u30d1\u30bf\u30fc\u30f3\u306e\u30dd\u30a4\u30f3\u30c8\uff1a</p> <ul> <li>Protocol \u3067 Visitor \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u5b9a\u7fa9</li> <li>defimpl \u3067\u5404\u56f3\u5f62\u30bf\u30a4\u30d7\u306b\u5bfe\u3059\u308b\u5b9f\u88c5\u3092\u63d0\u4f9b</li> <li>\u65b0\u3057\u3044\u64cd\u4f5c\u3092\u8ffd\u52a0\u3059\u308b\u969b\u306f\u65b0\u3057\u3044 Visitor \u3092\u4f5c\u6210</li> <li>\u65e2\u5b58\u306e\u56f3\u5f62\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u305b\u305a\u306b\u62e1\u5f35\u53ef\u80fd</li> <li>CompositeVisitor \u3067\u8907\u6570\u306e\u64cd\u4f5c\u3092\u4e00\u5ea6\u306b\u9069\u7528</li> </ul>"},{"location":"elixir/13-abstract-factory-pattern/","title":"\u7b2c13\u7ae0: Abstract Factory \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"elixir/13-abstract-factory-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u95a2\u9023\u3059\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30d5\u30a1\u30df\u30ea\u30fc\u3092\u3001\u305d\u306e\u5177\u4f53\u7684\u306a\u30af\u30e9\u30b9\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u306a\u304f\u751f\u6210\u3059\u308b\u305f\u3081\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u63d0\u4f9b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002</p> <p>Elixir \u3067\u306f\u3001\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u4f7f\u7528\u3057\u3066\u30d5\u30a1\u30af\u30c8\u30ea\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u5b9a\u7fa9\u3057\u3001\u7570\u306a\u308b\u5b9f\u88c5\u3067\u7570\u306a\u308b\u88fd\u54c1\u30d5\u30a1\u30df\u30ea\u30fc\u3092\u751f\u6210\u3057\u307e\u3059\u3002</p>"},{"location":"elixir/13-abstract-factory-pattern/#1-shape-factory","title":"1. Shape Factory","text":""},{"location":"elixir/13-abstract-factory-pattern/#_2","title":"\u56f3\u5f62\u306e\u5b9a\u7fa9","text":"<pre><code>defmodule Shapes do\n  defmodule Circle do\n    @enforce_keys [:center, :radius]\n    defstruct [:center, :radius, :outline_color, :outline_width, :fill_color]\n\n    def new(center, radius), do: %__MODULE__{center: center, radius: radius}\n\n    def to_string(%__MODULE__{center: {x, y}, radius: r} = c) do\n      base = \"Circle center: [#{x}, #{y}] radius: #{r}\"\n      with_style(base, c)\n    end\n\n    defp with_style(base, %{fill_color: fc, outline_color: oc, outline_width: ow}) do\n      parts = [base]\n      parts = if fc, do: parts ++ [\"fill: #{fc}\"], else: parts\n      parts = if oc, do: parts ++ [\"outline: #{oc}(#{ow})\"], else: parts\n      Enum.join(parts, \" \")\n    end\n  end\n\n  defmodule Square do\n    @enforce_keys [:top_left, :side]\n    defstruct [:top_left, :side, :outline_color, :outline_width, :fill_color]\n\n    def new(top_left, side), do: %__MODULE__{top_left: top_left, side: side}\n  end\n\n  defmodule Rectangle do\n    @enforce_keys [:top_left, :width, :height]\n    defstruct [:top_left, :width, :height, :outline_color, :outline_width, :fill_color]\n\n    def new(top_left, width, height) do\n      %__MODULE__{top_left: top_left, width: width, height: height}\n    end\n  end\nend\n</code></pre>"},{"location":"elixir/13-abstract-factory-pattern/#shapefactory","title":"ShapeFactory \u30d7\u30ed\u30c8\u30b3\u30eb","text":"<pre><code>defprotocol ShapeFactory do\n  @doc \"\u5186\u3092\u4f5c\u6210\"\n  def create_circle(factory, center, radius)\n\n  @doc \"\u6b63\u65b9\u5f62\u3092\u4f5c\u6210\"\n  def create_square(factory, top_left, side)\n\n  @doc \"\u9577\u65b9\u5f62\u3092\u4f5c\u6210\"\n  def create_rectangle(factory, top_left, width, height)\nend\n</code></pre>"},{"location":"elixir/13-abstract-factory-pattern/#_3","title":"\u5177\u4f53\u7684\u306a\u30d5\u30a1\u30af\u30c8\u30ea\u5b9f\u88c5","text":""},{"location":"elixir/13-abstract-factory-pattern/#standardshapefactory","title":"StandardShapeFactory\uff08\u6a19\u6e96\u306e\u56f3\u5f62\uff09","text":"<pre><code>defmodule StandardShapeFactory do\n  defstruct []\n\n  def new, do: %__MODULE__{}\nend\n\ndefimpl ShapeFactory, for: StandardShapeFactory do\n  alias Shapes.{Circle, Square, Rectangle}\n\n  def create_circle(_factory, center, radius) do\n    Circle.new(center, radius)\n  end\n\n  def create_square(_factory, top_left, side) do\n    Square.new(top_left, side)\n  end\n\n  def create_rectangle(_factory, top_left, width, height) do\n    Rectangle.new(top_left, width, height)\n  end\nend\n</code></pre>"},{"location":"elixir/13-abstract-factory-pattern/#outlinedshapefactory","title":"OutlinedShapeFactory\uff08\u8f2a\u90ed\u7dda\u4ed8\u304d\u56f3\u5f62\uff09","text":"<pre><code>defmodule OutlinedShapeFactory do\n  @enforce_keys [:outline_color, :outline_width]\n  defstruct [:outline_color, :outline_width]\n\n  def new(outline_color, outline_width) do\n    %__MODULE__{outline_color: outline_color, outline_width: outline_width}\n  end\nend\n\ndefimpl ShapeFactory, for: OutlinedShapeFactory do\n  alias Shapes.{Circle, Square, Rectangle}\n\n  def create_circle(%OutlinedShapeFactory{outline_color: oc, outline_width: ow}, center, radius) do\n    %{Circle.new(center, radius) | outline_color: oc, outline_width: ow}\n  end\n\n  def create_square(%OutlinedShapeFactory{outline_color: oc, outline_width: ow}, top_left, side) do\n    %{Square.new(top_left, side) | outline_color: oc, outline_width: ow}\n  end\n\n  def create_rectangle(%OutlinedShapeFactory{outline_color: oc, outline_width: ow}, top_left, width, height) do\n    %{Rectangle.new(top_left, width, height) | outline_color: oc, outline_width: ow}\n  end\nend\n</code></pre>"},{"location":"elixir/13-abstract-factory-pattern/#filledshapefactory","title":"FilledShapeFactory\uff08\u5857\u308a\u3064\u3076\u3057\u4ed8\u304d\u56f3\u5f62\uff09","text":"<pre><code>defmodule FilledShapeFactory do\n  @enforce_keys [:fill_color]\n  defstruct [:fill_color]\n\n  def new(fill_color), do: %__MODULE__{fill_color: fill_color}\nend\n\ndefimpl ShapeFactory, for: FilledShapeFactory do\n  alias Shapes.{Circle, Square, Rectangle}\n\n  def create_circle(%FilledShapeFactory{fill_color: fc}, center, radius) do\n    %{Circle.new(center, radius) | fill_color: fc}\n  end\n\n  def create_square(%FilledShapeFactory{fill_color: fc}, top_left, side) do\n    %{Square.new(top_left, side) | fill_color: fc}\n  end\n\n  def create_rectangle(%FilledShapeFactory{fill_color: fc}, top_left, width, height) do\n    %{Rectangle.new(top_left, width, height) | fill_color: fc}\n  end\nend\n</code></pre>"},{"location":"elixir/13-abstract-factory-pattern/#styledshapefactory","title":"StyledShapeFactory\uff08\u8f2a\u90ed\u7dda\u3068\u5857\u308a\u3064\u3076\u3057\u306e\u7d44\u307f\u5408\u308f\u305b\uff09","text":"<pre><code>defmodule StyledShapeFactory do\n  @enforce_keys [:outline_color, :outline_width, :fill_color]\n  defstruct [:outline_color, :outline_width, :fill_color]\n\n  def new(outline_color, outline_width, fill_color) do\n    %__MODULE__{\n      outline_color: outline_color,\n      outline_width: outline_width,\n      fill_color: fill_color\n    }\n  end\nend\n</code></pre>"},{"location":"elixir/13-abstract-factory-pattern/#_4","title":"\u4f7f\u7528\u4f8b","text":"<pre><code># \u6a19\u6e96\u30d5\u30a1\u30af\u30c8\u30ea\u3067\u56f3\u5f62\u3092\u4f5c\u6210\nstandard_factory = StandardShapeFactory.new()\ncircle = ShapeFactory.create_circle(standard_factory, {0, 0}, 5)\n# =&gt; %Circle{center: {0, 0}, radius: 5}\n\n# \u8f2a\u90ed\u7dda\u4ed8\u304d\u30d5\u30a1\u30af\u30c8\u30ea\u3067\u56f3\u5f62\u3092\u4f5c\u6210\noutlined_factory = OutlinedShapeFactory.new(\"black\", 2)\noutlined_circle = ShapeFactory.create_circle(outlined_factory, {0, 0}, 5)\n# =&gt; %Circle{center: {0, 0}, radius: 5, outline_color: \"black\", outline_width: 2}\n\n# \u540c\u3058\u30b3\u30fc\u30c9\u3067\u7570\u306a\u308b\u30b9\u30bf\u30a4\u30eb\u306e\u56f3\u5f62\u3092\u751f\u6210\ndef draw_scene(factory) do\n  [\n    ShapeFactory.create_circle(factory, {100, 100}, 50),\n    ShapeFactory.create_square(factory, {200, 200}, 80),\n    ShapeFactory.create_rectangle(factory, {300, 300}, 100, 60)\n  ]\nend\n</code></pre>"},{"location":"elixir/13-abstract-factory-pattern/#2-ui-factory","title":"2. UI Factory","text":""},{"location":"elixir/13-abstract-factory-pattern/#ui","title":"UI \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u5b9a\u7fa9","text":"<pre><code>defmodule UIComponents do\n  defmodule Button do\n    defstruct [:label, :platform, :style]\n\n    def new(label, platform, style \\\\ %{}) do\n      %__MODULE__{label: label, platform: platform, style: style}\n    end\n\n    def render(%__MODULE__{label: label, platform: :windows, style: style}) do\n      bg = Map.get(style, :background, \"#e1e1e1\")\n      \"[Windows Button: #{label}] bg=#{bg}\"\n    end\n\n    def render(%__MODULE__{label: label, platform: :macos, style: style}) do\n      bg = Map.get(style, :background, \"#007aff\")\n      \"(Mac Button: #{label}) bg=#{bg}\"\n    end\n\n    def render(%__MODULE__{label: label, platform: :web, style: style}) do\n      bg = Map.get(style, :background, \"#4285f4\")\n      \"&lt;button&gt;#{label}&lt;/button&gt; bg=#{bg}\"\n    end\n  end\n\n  defmodule TextField do\n    defstruct [:placeholder, :platform, :style]\n\n    def new(placeholder, platform, style \\\\ %{}), do: %__MODULE__{placeholder: placeholder, platform: platform, style: style}\n  end\n\n  defmodule Checkbox do\n    defstruct [:label, :checked, :platform, :style]\n\n    def new(label, checked, platform, style \\\\ %{}), do: %__MODULE__{label: label, checked: checked, platform: platform, style: style}\n  end\nend\n</code></pre>"},{"location":"elixir/13-abstract-factory-pattern/#uifactory","title":"UIFactory \u30d7\u30ed\u30c8\u30b3\u30eb","text":"<pre><code>defprotocol UIFactory do\n  @doc \"\u30dc\u30bf\u30f3\u3092\u4f5c\u6210\"\n  def create_button(factory, label)\n\n  @doc \"\u30c6\u30ad\u30b9\u30c8\u30d5\u30a3\u30fc\u30eb\u30c9\u3092\u4f5c\u6210\"\n  def create_text_field(factory, placeholder)\n\n  @doc \"\u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u3092\u4f5c\u6210\"\n  def create_checkbox(factory, label, checked)\nend\n</code></pre>"},{"location":"elixir/13-abstract-factory-pattern/#_5","title":"\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u5225\u30d5\u30a1\u30af\u30c8\u30ea","text":"<pre><code>defmodule WindowsUIFactory do\n  defstruct style: %{}\n  def new(style \\\\ %{}), do: %__MODULE__{style: style}\nend\n\ndefimpl UIFactory, for: WindowsUIFactory do\n  alias UIComponents.{Button, TextField, Checkbox}\n\n  def create_button(%WindowsUIFactory{style: style}, label), do: Button.new(label, :windows, style)\n  def create_text_field(%WindowsUIFactory{style: style}, placeholder), do: TextField.new(placeholder, :windows, style)\n  def create_checkbox(%WindowsUIFactory{style: style}, label, checked), do: Checkbox.new(label, checked, :windows, style)\nend\n\ndefmodule MacOSUIFactory do\n  defstruct style: %{}\n  def new(style \\\\ %{}), do: %__MODULE__{style: style}\nend\n\ndefimpl UIFactory, for: MacOSUIFactory do\n  alias UIComponents.{Button, TextField, Checkbox}\n\n  def create_button(%MacOSUIFactory{style: style}, label), do: Button.new(label, :macos, style)\n  def create_text_field(%MacOSUIFactory{style: style}, placeholder), do: TextField.new(placeholder, :macos, style)\n  def create_checkbox(%MacOSUIFactory{style: style}, label, checked), do: Checkbox.new(label, checked, :macos, style)\nend\n\ndefmodule WebUIFactory do\n  defstruct style: %{}\n  def new(style \\\\ %{}), do: %__MODULE__{style: style}\nend\n\ndefimpl UIFactory, for: WebUIFactory do\n  alias UIComponents.{Button, TextField, Checkbox}\n\n  def create_button(%WebUIFactory{style: style}, label), do: Button.new(label, :web, style)\n  def create_text_field(%WebUIFactory{style: style}, placeholder), do: TextField.new(placeholder, :web, style)\n  def create_checkbox(%WebUIFactory{style: style}, label, checked), do: Checkbox.new(label, checked, :web, style)\nend\n</code></pre>"},{"location":"elixir/13-abstract-factory-pattern/#_6","title":"\u4f7f\u7528\u4f8b","text":"<pre><code># \u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u306b\u4f9d\u5b58\u3057\u306a\u3044 UI \u69cb\u7bc9\u30b3\u30fc\u30c9\ndef create_login_form(factory) do\n  [\n    UIFactory.create_text_field(factory, \"Username\"),\n    UIFactory.create_text_field(factory, \"Password\"),\n    UIFactory.create_checkbox(factory, \"Remember me\", false),\n    UIFactory.create_button(factory, \"Login\")\n  ]\nend\n\n# Windows \u7528\nwindows_form = create_login_form(WindowsUIFactory.new())\n\n# macOS \u7528\nmacos_form = create_login_form(MacOSUIFactory.new())\n\n# Web \u7528\nweb_form = create_login_form(WebUIFactory.new())\n</code></pre>"},{"location":"elixir/13-abstract-factory-pattern/#3-theme-factory","title":"3. Theme Factory","text":""},{"location":"elixir/13-abstract-factory-pattern/#_7","title":"\u30c6\u30fc\u30de\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u5b9a\u7fa9","text":"<pre><code>defmodule ThemeComponents do\n  defmodule Colors do\n    defstruct [:primary, :secondary, :background, :text, :accent]\n    def new(attrs), do: struct(__MODULE__, attrs)\n  end\n\n  defmodule Typography do\n    defstruct [:font_family, :base_size, :heading_scale]\n    def new(attrs), do: struct(__MODULE__, attrs)\n  end\n\n  defmodule Spacing do\n    defstruct [:unit, :scale]\n    def new(attrs), do: struct(__MODULE__, attrs)\n  end\nend\n</code></pre>"},{"location":"elixir/13-abstract-factory-pattern/#themefactory","title":"ThemeFactory \u30d7\u30ed\u30c8\u30b3\u30eb","text":"<pre><code>defprotocol ThemeFactory do\n  def create_colors(factory)\n  def create_typography(factory)\n  def create_spacing(factory)\nend\n</code></pre>"},{"location":"elixir/13-abstract-factory-pattern/#_8","title":"\u30c6\u30fc\u30de\u5225\u30d5\u30a1\u30af\u30c8\u30ea","text":"<pre><code>defmodule LightThemeFactory do\n  defstruct []\n  def new, do: %__MODULE__{}\nend\n\ndefimpl ThemeFactory, for: LightThemeFactory do\n  alias ThemeComponents.{Colors, Typography, Spacing}\n\n  def create_colors(_factory) do\n    Colors.new(%{\n      primary: \"#007aff\",\n      secondary: \"#5856d6\",\n      background: \"#ffffff\",\n      text: \"#000000\",\n      accent: \"#ff9500\"\n    })\n  end\n\n  def create_typography(_factory) do\n    Typography.new(%{font_family: \"San Francisco\", base_size: 16, heading_scale: 1.25})\n  end\n\n  def create_spacing(_factory) do\n    Spacing.new(%{unit: 8, scale: [0.5, 1, 2, 3, 4, 6, 8]})\n  end\nend\n\ndefmodule DarkThemeFactory do\n  defstruct []\n  def new, do: %__MODULE__{}\nend\n\ndefimpl ThemeFactory, for: DarkThemeFactory do\n  alias ThemeComponents.{Colors, Typography, Spacing}\n\n  def create_colors(_factory) do\n    Colors.new(%{\n      primary: \"#0a84ff\",\n      secondary: \"#5e5ce6\",\n      background: \"#1c1c1e\",\n      text: \"#ffffff\",\n      accent: \"#ff9f0a\"\n    })\n  end\n\n  def create_typography(_factory), do: Typography.new(%{font_family: \"San Francisco\", base_size: 16, heading_scale: 1.25})\n  def create_spacing(_factory), do: Spacing.new(%{unit: 8, scale: [0.5, 1, 2, 3, 4, 6, 8]})\nend\n</code></pre>"},{"location":"elixir/13-abstract-factory-pattern/#4-database-factory","title":"4. Database Factory","text":""},{"location":"elixir/13-abstract-factory-pattern/#_9","title":"\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8","text":"<pre><code>defmodule DatabaseComponents do\n  defmodule Connection do\n    defstruct [:driver, :host, :port, :database, :username, :password, :options]\n\n    def new(attrs), do: struct(__MODULE__, attrs)\n\n    def connection_string(%__MODULE__{driver: :mysql} = conn) do\n      \"mysql://#{conn.username}:#{conn.password}@#{conn.host}:#{conn.port}/#{conn.database}\"\n    end\n\n    def connection_string(%__MODULE__{driver: :postgresql} = conn) do\n      \"postgresql://#{conn.username}:#{conn.password}@#{conn.host}:#{conn.port}/#{conn.database}\"\n    end\n\n    def connection_string(%__MODULE__{driver: :sqlite} = conn) do\n      \"sqlite:#{conn.database}\"\n    end\n  end\n\n  defmodule QueryBuilder do\n    defstruct [:driver, :table, :columns, :conditions, :order, :limit]\n\n    def new(driver), do: %__MODULE__{driver: driver, columns: [\"*\"], conditions: []}\n\n    def from(%__MODULE__{} = qb, table), do: %{qb | table: table}\n    def select(%__MODULE__{} = qb, columns), do: %{qb | columns: columns}\n    def where(%__MODULE__{conditions: conds} = qb, condition), do: %{qb | conditions: conds ++ [condition]}\n    def order_by(%__MODULE__{} = qb, column, direction \\\\ :asc), do: %{qb | order: {column, direction}}\n    def limit(%__MODULE__{} = qb, n), do: %{qb | limit: n}\n\n    def build(%__MODULE__{} = qb) do\n      columns = Enum.join(qb.columns, \", \")\n      sql = \"SELECT #{columns} FROM #{qb.table}\"\n      sql = if qb.conditions != [], do: sql &lt;&gt; \" WHERE \" &lt;&gt; Enum.join(qb.conditions, \" AND \"), else: sql\n      sql = if qb.order, do: sql &lt;&gt; \" ORDER BY #{elem(qb.order, 0)} #{elem(qb.order, 1) |&gt; to_string() |&gt; String.upcase()}\", else: sql\n      sql = if qb.limit, do: sql &lt;&gt; \" LIMIT #{qb.limit}\", else: sql\n      %{driver: qb.driver, sql: sql}\n    end\n  end\nend\n</code></pre>"},{"location":"elixir/13-abstract-factory-pattern/#databasefactory","title":"DatabaseFactory \u30d7\u30ed\u30c8\u30b3\u30eb","text":"<pre><code>defprotocol DatabaseFactory do\n  def create_connection(factory, config)\n  def create_query_builder(factory)\nend\n</code></pre>"},{"location":"elixir/13-abstract-factory-pattern/#_10","title":"\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u5225\u30d5\u30a1\u30af\u30c8\u30ea","text":"<pre><code>defmodule MySQLFactory do\n  defstruct []\n  def new, do: %__MODULE__{}\nend\n\ndefimpl DatabaseFactory, for: MySQLFactory do\n  alias DatabaseComponents.{Connection, QueryBuilder}\n\n  def create_connection(_factory, config) do\n    Connection.new(%{\n      driver: :mysql,\n      host: Map.get(config, :host, \"localhost\"),\n      port: Map.get(config, :port, 3306),\n      database: Map.fetch!(config, :database),\n      username: Map.fetch!(config, :username),\n      password: Map.fetch!(config, :password)\n    })\n  end\n\n  def create_query_builder(_factory), do: QueryBuilder.new(:mysql)\nend\n\ndefmodule PostgreSQLFactory do\n  defstruct []\n  def new, do: %__MODULE__{}\nend\n\ndefmodule SQLiteFactory do\n  defstruct []\n  def new, do: %__MODULE__{}\nend\n</code></pre>"},{"location":"elixir/13-abstract-factory-pattern/#5-factory-providerfactory-of-factories","title":"5. Factory Provider\uff08Factory of Factories\uff09","text":"<pre><code>defmodule FactoryProvider do\n  @moduledoc \"\"\"\n  \u30d5\u30a1\u30af\u30c8\u30ea\u306e\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u3002\n  \u8a2d\u5b9a\u306b\u57fa\u3065\u3044\u3066\u9069\u5207\u306a\u30d5\u30a1\u30af\u30c8\u30ea\u3092\u63d0\u4f9b\u3059\u308b\u3002\n  \"\"\"\n\n  # \u56f3\u5f62\u30d5\u30a1\u30af\u30c8\u30ea\n  def get_shape_factory(:standard), do: StandardShapeFactory.new()\n  def get_shape_factory(:outlined), do: OutlinedShapeFactory.new(\"black\", 1)\n  def get_shape_factory({:outlined, color, width}), do: OutlinedShapeFactory.new(color, width)\n  def get_shape_factory(:filled), do: FilledShapeFactory.new(\"gray\")\n  def get_shape_factory({:filled, color}), do: FilledShapeFactory.new(color)\n  def get_shape_factory({:styled, outline_color, outline_width, fill_color}) do\n    StyledShapeFactory.new(outline_color, outline_width, fill_color)\n  end\n\n  # UI \u30d5\u30a1\u30af\u30c8\u30ea\n  def get_ui_factory(:windows), do: WindowsUIFactory.new()\n  def get_ui_factory(:macos), do: MacOSUIFactory.new()\n  def get_ui_factory(:web), do: WebUIFactory.new()\n  def get_ui_factory({platform, style}), do: get_ui_factory_with_style(platform, style)\n\n  defp get_ui_factory_with_style(:windows, style), do: WindowsUIFactory.new(style)\n  defp get_ui_factory_with_style(:macos, style), do: MacOSUIFactory.new(style)\n  defp get_ui_factory_with_style(:web, style), do: WebUIFactory.new(style)\n\n  # \u30c6\u30fc\u30de\u30d5\u30a1\u30af\u30c8\u30ea\n  def get_theme_factory(:light), do: LightThemeFactory.new()\n  def get_theme_factory(:dark), do: DarkThemeFactory.new()\n\n  # \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30d5\u30a1\u30af\u30c8\u30ea\n  def get_database_factory(:mysql), do: MySQLFactory.new()\n  def get_database_factory(:postgresql), do: PostgreSQLFactory.new()\n  def get_database_factory(:sqlite), do: SQLiteFactory.new()\nend\n</code></pre>"},{"location":"elixir/13-abstract-factory-pattern/#_11","title":"\u4f7f\u7528\u4f8b","text":"<pre><code># \u8a2d\u5b9a\u306b\u57fa\u3065\u3044\u3066\u30d5\u30a1\u30af\u30c8\u30ea\u3092\u9078\u629e\nconfig = %{\n  shape_style: :outlined,\n  platform: :web,\n  theme: :dark,\n  database: :postgresql\n}\n\nshape_factory = FactoryProvider.get_shape_factory(config.shape_style)\nui_factory = FactoryProvider.get_ui_factory(config.platform)\ntheme_factory = FactoryProvider.get_theme_factory(config.theme)\ndb_factory = FactoryProvider.get_database_factory(config.database)\n\n# \u4e00\u8cab\u3057\u305f\u30d5\u30a1\u30df\u30ea\u30fc\u3067\u88fd\u54c1\u3092\u751f\u6210\nshapes = [\n  ShapeFactory.create_circle(shape_factory, {0, 0}, 50),\n  ShapeFactory.create_square(shape_factory, {100, 100}, 80)\n]\n\nui_components = [\n  UIFactory.create_button(ui_factory, \"Submit\"),\n  UIFactory.create_text_field(ui_factory, \"Enter name\")\n]\n\ntheme = %{\n  colors: ThemeFactory.create_colors(theme_factory),\n  typography: ThemeFactory.create_typography(theme_factory),\n  spacing: ThemeFactory.create_spacing(theme_factory)\n}\n</code></pre>"},{"location":"elixir/13-abstract-factory-pattern/#_12","title":"\u8a2d\u8a08\u306e\u30dd\u30a4\u30f3\u30c8","text":""},{"location":"elixir/13-abstract-factory-pattern/#_13","title":"\u30d7\u30ed\u30c8\u30b3\u30eb\u306b\u3088\u308b\u62bd\u8c61\u5316","text":"<p>Elixir \u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u306f\u3001Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306e\u62bd\u8c61\u30d5\u30a1\u30af\u30c8\u30ea\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u81ea\u7136\u306b\u8868\u73fe\u3057\u307e\u3059\u3002</p> <pre><code>defprotocol ShapeFactory do\n  def create_circle(factory, center, radius)\n  def create_square(factory, top_left, side)\n  def create_rectangle(factory, top_left, width, height)\nend\n</code></pre>"},{"location":"elixir/13-abstract-factory-pattern/#_14","title":"\u88fd\u54c1\u30d5\u30a1\u30df\u30ea\u30fc\u306e\u4e00\u8cab\u6027","text":"<p>\u540c\u3058\u30d5\u30a1\u30af\u30c8\u30ea\u304b\u3089\u751f\u6210\u3055\u308c\u305f\u88fd\u54c1\u306f\u4e00\u8cab\u3057\u305f\u30b9\u30bf\u30a4\u30eb\u3092\u6301\u3061\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u5168\u4f53\u3067\u7d71\u4e00\u3055\u308c\u305f\u30eb\u30c3\u30af\uff06\u30d5\u30a3\u30fc\u30eb\u3092\u4fdd\u8a3c\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"elixir/13-abstract-factory-pattern/#_15","title":"\u62e1\u5f35\u6027","text":"<p>\u65b0\u3057\u3044\u30d5\u30a1\u30af\u30c8\u30ea\u3092\u8ffd\u52a0\u3059\u308b\u306b\u306f\uff1a</p> <ol> <li>\u65b0\u3057\u3044\u30d5\u30a1\u30af\u30c8\u30ea\u69cb\u9020\u4f53\u3092\u5b9a\u7fa9</li> <li>\u30d7\u30ed\u30c8\u30b3\u30eb\u5b9f\u88c5\u3092\u8ffd\u52a0</li> <li>FactoryProvider \u306b\u65b0\u3057\u3044\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u3092\u8ffd\u52a0</li> </ol> <p>\u65e2\u5b58\u306e\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u305b\u305a\u306b\u65b0\u3057\u3044\u30b9\u30bf\u30a4\u30eb\u3084\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3092\u8ffd\u52a0\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"elixir/13-abstract-factory-pattern/#_16","title":"\u307e\u3068\u3081","text":"<p>Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9\uff1a</p> <ol> <li>\u88fd\u54c1\u30d5\u30a1\u30df\u30ea\u30fc\u306e\u4e00\u8cab\u6027: \u95a2\u9023\u3059\u308b\u88fd\u54c1\u304c\u5e38\u306b\u4e92\u3044\u306b\u9069\u5408\u3059\u308b\u3053\u3068\u3092\u4fdd\u8a3c</li> <li>\u5177\u4f53\u30af\u30e9\u30b9\u306e\u5206\u96e2: \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b3\u30fc\u30c9\u306f\u62bd\u8c61\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306e\u307f\u306b\u4f9d\u5b58</li> <li>\u88fd\u54c1\u30d5\u30a1\u30df\u30ea\u30fc\u306e\u5207\u308a\u66ff\u3048: \u30d5\u30a1\u30af\u30c8\u30ea\u3092\u4ea4\u63db\u3059\u308b\u3060\u3051\u3067\u5168\u4f53\u306e\u30b9\u30bf\u30a4\u30eb\u3092\u5909\u66f4\u53ef\u80fd</li> <li>\u5358\u4e00\u8cac\u4efb: \u88fd\u54c1\u306e\u751f\u6210\u30b3\u30fc\u30c9\u3092\u4e00\u7b87\u6240\u306b\u96c6\u7d04</li> </ol> <p>Elixir \u3067\u306f\u3001\u30d7\u30ed\u30c8\u30b3\u30eb\u3068\u69cb\u9020\u4f53\u3092\u4f7f\u7528\u3057\u3066\u3001\u578b\u5b89\u5168\u3067\u62e1\u5f35\u53ef\u80fd\u306a Abstract Factory \u30d1\u30bf\u30fc\u30f3\u3092\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"elixir/14-abstract-server-pattern/","title":"\u7b2c14\u7ae0: Abstract Server \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"elixir/14-abstract-server-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Abstract Server \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u4f9d\u5b58\u95a2\u4fc2\u9006\u8ee2\u306e\u539f\u5247\uff08DIP\uff09\u3092\u5b9f\u73fe\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u9ad8\u30ec\u30d9\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u4f4e\u30ec\u30d9\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u8a73\u7d30\u306b\u4f9d\u5b58\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u4e21\u8005\u304c\u62bd\u8c61\uff08\u30d7\u30ed\u30c8\u30b3\u30eb\uff09\u306b\u4f9d\u5b58\u3059\u308b\u3053\u3068\u3067\u758e\u7d50\u5408\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p> <p>Elixir \u3067\u306f\u3001\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u4f7f\u7528\u3057\u3066 Abstract Server \u3092\u5b9a\u7fa9\u3057\u3001\u7570\u306a\u308b\u5177\u4f53\u7684\u306a\u5b9f\u88c5\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002</p>"},{"location":"elixir/14-abstract-server-pattern/#1-switchable","title":"1. Switchable \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"elixir/14-abstract-server-pattern/#switchable","title":"Switchable \u30d7\u30ed\u30c8\u30b3\u30eb","text":"<pre><code>defprotocol Switchable do\n  @moduledoc \"\u30b9\u30a4\u30c3\u30c1\u53ef\u80fd\u306a\u30c7\u30d0\u30a4\u30b9\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\"\n\n  @doc \"\u30c7\u30d0\u30a4\u30b9\u3092\u30aa\u30f3\u306b\u3059\u308b\"\n  @spec turn_on(t()) :: t()\n  def turn_on(device)\n\n  @doc \"\u30c7\u30d0\u30a4\u30b9\u3092\u30aa\u30d5\u306b\u3059\u308b\"\n  @spec turn_off(t()) :: t()\n  def turn_off(device)\n\n  @doc \"\u30c7\u30d0\u30a4\u30b9\u304c\u30aa\u30f3\u304b\u3069\u3046\u304b\"\n  @spec on?(t()) :: boolean()\n  def on?(device)\nend\n</code></pre>"},{"location":"elixir/14-abstract-server-pattern/#concrete-server-light","title":"Concrete Server: Light","text":"<pre><code>defmodule Light do\n  defstruct state: :off, brightness: 100\n\n  def new, do: %__MODULE__{}\n  def new(brightness), do: %__MODULE__{brightness: brightness}\n\n  def set_brightness(%__MODULE__{state: :on} = light, brightness)\n      when brightness &gt;= 0 and brightness &lt;= 100 do\n    %{light | brightness: brightness}\n  end\n  def set_brightness(light, _), do: light\nend\n\ndefimpl Switchable, for: Light do\n  def turn_on(%Light{} = light), do: %{light | state: :on}\n  def turn_off(%Light{} = light), do: %{light | state: :off}\n  def on?(%Light{state: state}), do: state == :on\nend\n</code></pre>"},{"location":"elixir/14-abstract-server-pattern/#concrete-server-fan","title":"Concrete Server: Fan","text":"<pre><code>defmodule Fan do\n  defstruct state: :off, speed: nil\n\n  def new, do: %__MODULE__{}\n\n  def set_speed(%__MODULE__{state: :on} = fan, speed)\n      when speed in [:low, :medium, :high] do\n    %{fan | speed: speed}\n  end\n  def set_speed(fan, _), do: fan\nend\n\ndefimpl Switchable, for: Fan do\n  def turn_on(%Fan{} = fan), do: %{fan | state: :on, speed: :low}\n  def turn_off(%Fan{} = fan), do: %{fan | state: :off, speed: nil}\n  def on?(%Fan{state: state}), do: state == :on\nend\n</code></pre>"},{"location":"elixir/14-abstract-server-pattern/#concrete-server-motor","title":"Concrete Server: Motor","text":"<pre><code>defmodule Motor do\n  defstruct state: :off, direction: nil, rpm: 0\n\n  def new, do: %__MODULE__{}\n\n  def reverse(%__MODULE__{state: :on, direction: dir} = motor) do\n    new_dir = if dir == :forward, do: :reverse, else: :forward\n    %{motor | direction: new_dir}\n  end\n  def reverse(motor), do: motor\n\n  def set_rpm(%__MODULE__{state: :on} = motor, rpm) when rpm &gt;= 0 do\n    %{motor | rpm: rpm}\n  end\n  def set_rpm(motor, _), do: motor\nend\n\ndefimpl Switchable, for: Motor do\n  def turn_on(%Motor{} = motor), do: %{motor | state: :on, direction: :forward, rpm: 1000}\n  def turn_off(%Motor{} = motor), do: %{motor | state: :off, direction: nil, rpm: 0}\n  def on?(%Motor{state: state}), do: state == :on\nend\n</code></pre>"},{"location":"elixir/14-abstract-server-pattern/#client-switch","title":"Client: Switch","text":"<pre><code>defmodule Switch do\n  @moduledoc \"\"\"\n  \u30b9\u30a4\u30c3\u30c1\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3002\n  Switchable \u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u901a\u3058\u3066\u30c7\u30d0\u30a4\u30b9\u3092\u64cd\u4f5c\u3059\u308b\u3002\n  \"\"\"\n\n  @doc \"\u30b9\u30a4\u30c3\u30c1\u3092\u5165\u308c\u308b\"\n  def engage(device), do: Switchable.turn_on(device)\n\n  @doc \"\u30b9\u30a4\u30c3\u30c1\u3092\u5207\u308b\"\n  def disengage(device), do: Switchable.turn_off(device)\n\n  @doc \"\u30b9\u30a4\u30c3\u30c1\u3092\u5207\u308a\u66ff\u3048\u308b\"\n  def toggle(device) do\n    if Switchable.on?(device) do\n      Switchable.turn_off(device)\n    else\n      Switchable.turn_on(device)\n    end\n  end\n\n  @doc \"\u30c7\u30d0\u30a4\u30b9\u306e\u72b6\u614b\u3092\u53d6\u5f97\"\n  def status(device), do: if(Switchable.on?(device), do: :on, else: :off)\nend\n</code></pre>"},{"location":"elixir/14-abstract-server-pattern/#_2","title":"\u4f7f\u7528\u4f8b","text":"<pre><code># Light \u3092\u64cd\u4f5c\nlight = Light.new()\nlight = Switch.engage(light)    # \u30aa\u30f3\nlight = Switch.toggle(light)    # \u30aa\u30d5\n\n# Fan \u3092\u64cd\u4f5c\uff08\u540c\u3058 Switch \u30b3\u30fc\u30c9\uff09\nfan = Fan.new()\nfan = Switch.engage(fan)        # \u30aa\u30f3\uff08speed: :low\uff09\nfan = Fan.set_speed(fan, :high) # \u901f\u5ea6\u3092\u5909\u66f4\nfan = Switch.disengage(fan)     # \u30aa\u30d5\n\n# Motor \u3092\u64cd\u4f5c\uff08\u540c\u3058 Switch \u30b3\u30fc\u30c9\uff09\nmotor = Motor.new()\nmotor = Switch.engage(motor)    # \u30aa\u30f3\uff08direction: :forward, rpm: 1000\uff09\nmotor = Motor.reverse(motor)    # \u65b9\u5411\u3092\u53cd\u8ee2\n</code></pre>"},{"location":"elixir/14-abstract-server-pattern/#2-repository","title":"2. Repository \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"elixir/14-abstract-server-pattern/#repository","title":"Repository \u30d7\u30ed\u30c8\u30b3\u30eb","text":"<pre><code>defprotocol Repository do\n  @moduledoc \"\u30c7\u30fc\u30bf\u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\"\n\n  @doc \"ID\u3067\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u3092\u53d6\u5f97\"\n  @spec find_by_id(t(), String.t()) :: {:ok, map()} | {:error, :not_found}\n  def find_by_id(repo, id)\n\n  @doc \"\u5168\u3066\u306e\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u3092\u53d6\u5f97\"\n  @spec find_all(t()) :: [map()]\n  def find_all(repo)\n\n  @doc \"\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u3092\u4fdd\u5b58\"\n  @spec save(t(), map()) :: {:ok, map()}\n  def save(repo, entity)\n\n  @doc \"\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u3092\u524a\u9664\"\n  @spec delete(t(), String.t()) :: {:ok, map()} | {:error, :not_found}\n  def delete(repo, id)\nend\n</code></pre>"},{"location":"elixir/14-abstract-server-pattern/#concrete-server-memoryrepository","title":"Concrete Server: MemoryRepository","text":"<pre><code>defmodule MemoryRepository do\n  @moduledoc \"\u30a4\u30f3\u30e1\u30e2\u30ea\u30ea\u30dd\u30b8\u30c8\u30ea\"\n\n  defstruct [:agent]\n\n  def new do\n    {:ok, agent} = Agent.start_link(fn -&gt; %{} end)\n    %__MODULE__{agent: agent}\n  end\n\n  def stop(%__MODULE__{agent: agent}) do\n    if Process.alive?(agent) do\n      Agent.stop(agent)\n    else\n      :ok\n    end\n  end\nend\n\ndefimpl Repository, for: MemoryRepository do\n  def find_by_id(%MemoryRepository{agent: agent}, id) do\n    case Agent.get(agent, &amp;Map.get(&amp;1, id)) do\n      nil -&gt; {:error, :not_found}\n      entity -&gt; {:ok, entity}\n    end\n  end\n\n  def find_all(%MemoryRepository{agent: agent}) do\n    Agent.get(agent, &amp;Map.values(&amp;1))\n  end\n\n  def save(%MemoryRepository{agent: agent}, entity) do\n    id = Map.get(entity, :id) || generate_id()\n    entity_with_id = Map.put(entity, :id, id)\n    Agent.update(agent, &amp;Map.put(&amp;1, id, entity_with_id))\n    {:ok, entity_with_id}\n  end\n\n  def delete(%MemoryRepository{agent: agent}, id) do\n    case Agent.get(agent, &amp;Map.get(&amp;1, id)) do\n      nil -&gt;\n        {:error, :not_found}\n      entity -&gt;\n        Agent.update(agent, &amp;Map.delete(&amp;1, id))\n        {:ok, entity}\n    end\n  end\n\n  defp generate_id, do: :crypto.strong_rand_bytes(8) |&gt; Base.encode16(case: :lower)\nend\n</code></pre>"},{"location":"elixir/14-abstract-server-pattern/#concrete-server-mockrepository","title":"Concrete Server: MockRepository\uff08\u30c6\u30b9\u30c8\u7528\uff09","text":"<pre><code>defmodule MockRepository do\n  @moduledoc \"\u30e2\u30c3\u30af\u30ea\u30dd\u30b8\u30c8\u30ea\uff08\u30c6\u30b9\u30c8\u7528\uff09\"\n\n  defstruct data: %{}\n\n  def new(data \\\\ %{}), do: %__MODULE__{data: data}\nend\n\ndefimpl Repository, for: MockRepository do\n  def find_by_id(%MockRepository{data: data}, id) do\n    case Map.get(data, id) do\n      nil -&gt; {:error, :not_found}\n      entity -&gt; {:ok, entity}\n    end\n  end\n\n  def find_all(%MockRepository{data: data}), do: Map.values(data)\n\n  def save(%MockRepository{}, entity) do\n    id = Map.get(entity, :id) || \"mock-id\"\n    entity_with_id = Map.put(entity, :id, id)\n    {:ok, entity_with_id}\n  end\n\n  def delete(%MockRepository{data: data}, id) do\n    case Map.get(data, id) do\n      nil -&gt; {:error, :not_found}\n      entity -&gt; {:ok, entity}\n    end\n  end\nend\n</code></pre>"},{"location":"elixir/14-abstract-server-pattern/#3-logger","title":"3. Logger \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"elixir/14-abstract-server-pattern/#logger","title":"Logger \u30d7\u30ed\u30c8\u30b3\u30eb","text":"<pre><code>defprotocol Logger do\n  @moduledoc \"\u30ed\u30ac\u30fc\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\"\n\n  @doc \"\u30c7\u30d0\u30c3\u30b0\u30ed\u30b0\"\n  @spec debug(t(), String.t()) :: t()\n  def debug(logger, message)\n\n  @doc \"\u60c5\u5831\u30ed\u30b0\"\n  @spec info(t(), String.t()) :: t()\n  def info(logger, message)\n\n  @doc \"\u8b66\u544a\u30ed\u30b0\"\n  @spec warn(t(), String.t()) :: t()\n  def warn(logger, message)\n\n  @doc \"\u30a8\u30e9\u30fc\u30ed\u30b0\"\n  @spec error(t(), String.t()) :: t()\n  def error(logger, message)\nend\n</code></pre>"},{"location":"elixir/14-abstract-server-pattern/#concrete-server-consolelogger","title":"Concrete Server: ConsoleLogger","text":"<pre><code>defmodule ConsoleLogger do\n  @moduledoc \"\u30b3\u30f3\u30bd\u30fc\u30eb\u30ed\u30ac\u30fc\"\n  defstruct level: :debug\n\n  @levels [:debug, :info, :warn, :error]\n\n  def new(level \\\\ :debug), do: %__MODULE__{level: level}\n\n  def should_log?(%__MODULE__{level: min_level}, level) do\n    min_idx = Enum.find_index(@levels, &amp;(&amp;1 == min_level))\n    level_idx = Enum.find_index(@levels, &amp;(&amp;1 == level))\n    level_idx &gt;= min_idx\n  end\nend\n\ndefimpl Logger, for: ConsoleLogger do\n  def debug(logger, message) do\n    if ConsoleLogger.should_log?(logger, :debug), do: IO.puts(\"[DEBUG] #{message}\")\n    logger\n  end\n\n  def info(logger, message) do\n    if ConsoleLogger.should_log?(logger, :info), do: IO.puts(\"[INFO] #{message}\")\n    logger\n  end\n\n  def warn(logger, message) do\n    if ConsoleLogger.should_log?(logger, :warn), do: IO.puts(\"[WARN] #{message}\")\n    logger\n  end\n\n  def error(logger, message) do\n    if ConsoleLogger.should_log?(logger, :error), do: IO.puts(\"[ERROR] #{message}\")\n    logger\n  end\nend\n</code></pre>"},{"location":"elixir/14-abstract-server-pattern/#concrete-server-memorylogger","title":"Concrete Server: MemoryLogger\uff08\u30c6\u30b9\u30c8\u7528\uff09","text":"<pre><code>defmodule MemoryLogger do\n  @moduledoc \"\u30e1\u30e2\u30ea\u30ed\u30ac\u30fc\uff08\u30c6\u30b9\u30c8\u7528\uff09\"\n  defstruct entries: []\n\n  def new, do: %__MODULE__{}\n\n  def get_entries(%__MODULE__{entries: entries}), do: Enum.reverse(entries)\n\n  def clear(%__MODULE__{}), do: %__MODULE__{}\nend\n\ndefimpl Logger, for: MemoryLogger do\n  def debug(%MemoryLogger{entries: entries} = logger, message) do\n    %{logger | entries: [{:debug, message} | entries]}\n  end\n\n  def info(%MemoryLogger{entries: entries} = logger, message) do\n    %{logger | entries: [{:info, message} | entries]}\n  end\n\n  def warn(%MemoryLogger{entries: entries} = logger, message) do\n    %{logger | entries: [{:warn, message} | entries]}\n  end\n\n  def error(%MemoryLogger{entries: entries} = logger, message) do\n    %{logger | entries: [{:error, message} | entries]}\n  end\nend\n</code></pre>"},{"location":"elixir/14-abstract-server-pattern/#4-notifier","title":"4. Notifier \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"elixir/14-abstract-server-pattern/#notifier","title":"Notifier \u30d7\u30ed\u30c8\u30b3\u30eb","text":"<pre><code>defprotocol Notifier do\n  @moduledoc \"\u901a\u77e5\u306e\u30d7\u30ed\u30c8\u30b3\u30eb\"\n\n  @doc \"\u901a\u77e5\u3092\u9001\u4fe1\"\n  @spec notify(t(), String.t(), String.t()) :: {:ok, t()} | {:error, term()}\n  def notify(notifier, recipient, message)\nend\n</code></pre>"},{"location":"elixir/14-abstract-server-pattern/#_3","title":"\u8907\u6570\u306e\u901a\u77e5\u5b9f\u88c5","text":"<pre><code>defmodule EmailNotifier do\n  defstruct from: \"noreply@example.com\", sent: []\n\n  def new(from \\\\ \"noreply@example.com\"), do: %__MODULE__{from: from}\n  def get_sent(%__MODULE__{sent: sent}), do: Enum.reverse(sent)\nend\n\ndefimpl Notifier, for: EmailNotifier do\n  def notify(%EmailNotifier{from: from, sent: sent} = notifier, recipient, message) do\n    email = %{from: from, to: recipient, subject: \"Notification\", body: message}\n    {:ok, %{notifier | sent: [email | sent]}}\n  end\nend\n\ndefmodule SMSNotifier do\n  defstruct sender: \"+1234567890\", sent: []\n\n  def new(sender \\\\ \"+1234567890\"), do: %__MODULE__{sender: sender}\n  def get_sent(%__MODULE__{sent: sent}), do: Enum.reverse(sent)\nend\n\ndefimpl Notifier, for: SMSNotifier do\n  def notify(%SMSNotifier{sender: sender, sent: sent} = notifier, recipient, message) do\n    truncated = String.slice(message, 0, 160)  # SMS character limit\n    sms = %{from: sender, to: recipient, body: truncated}\n    {:ok, %{notifier | sent: [sms | sent]}}\n  end\nend\n\ndefmodule PushNotifier do\n  defstruct app_id: \"default\", sent: []\n\n  def new(app_id \\\\ \"default\"), do: %__MODULE__{app_id: app_id}\n  def get_sent(%__MODULE__{sent: sent}), do: Enum.reverse(sent)\nend\n\ndefimpl Notifier, for: PushNotifier do\n  def notify(%PushNotifier{app_id: app_id, sent: sent} = notifier, recipient, message) do\n    push = %{app_id: app_id, device_token: recipient, body: message}\n    {:ok, %{notifier | sent: [push | sent]}}\n  end\nend\n</code></pre>"},{"location":"elixir/14-abstract-server-pattern/#compositenotifier","title":"CompositeNotifier\uff08\u8907\u6570\u30c1\u30e3\u30cd\u30eb\u306b\u9001\u4fe1\uff09","text":"<pre><code>defmodule CompositeNotifier do\n  @moduledoc \"\u8907\u5408\u901a\u77e5\uff08\u8907\u6570\u30c1\u30e3\u30cd\u30eb\u306b\u540c\u6642\u9001\u4fe1\uff09\"\n  defstruct notifiers: []\n\n  def new(notifiers), do: %__MODULE__{notifiers: notifiers}\n\n  def add(%__MODULE__{notifiers: ns} = cn, notifier) do\n    %{cn | notifiers: ns ++ [notifier]}\n  end\nend\n\ndefimpl Notifier, for: CompositeNotifier do\n  def notify(%CompositeNotifier{notifiers: notifiers} = composite, recipient, message) do\n    updated_notifiers = Enum.map(notifiers, fn n -&gt;\n      case Notifier.notify(n, recipient, message) do\n        {:ok, updated} -&gt; updated\n        {:error, _} -&gt; n\n      end\n    end)\n    {:ok, %{composite | notifiers: updated_notifiers}}\n  end\nend\n</code></pre>"},{"location":"elixir/14-abstract-server-pattern/#5-service-layer","title":"5. Service Layer","text":""},{"location":"elixir/14-abstract-server-pattern/#userservice","title":"UserService","text":"<pre><code>defmodule UserService do\n  @moduledoc \"\"\"\n  \u30e6\u30fc\u30b6\u30fc\u30b5\u30fc\u30d3\u30b9\u3002\n  Repository \u3068 Logger \u306b\u4f9d\u5b58\u3059\u308b\u304c\u3001\u5177\u4f53\u7684\u306a\u5b9f\u88c5\u306f\u77e5\u3089\u306a\u3044\u3002\n  \"\"\"\n\n  defstruct [:repo, :logger]\n\n  def new(repo, logger), do: %__MODULE__{repo: repo, logger: logger}\n\n  @doc \"\u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\"\n  def create_user(%__MODULE__{repo: repo, logger: logger} = service, name, email) do\n    logger = Logger.info(logger, \"Creating user: #{name}\")\n    user = %{name: name, email: email, created_at: DateTime.utc_now()}\n\n    case Repository.save(repo, user) do\n      {:ok, saved} -&gt;\n        Logger.info(logger, \"User created: #{saved.id}\")\n        {:ok, saved, %{service | logger: logger}}\n      error -&gt;\n        Logger.error(logger, \"Failed to create user: #{inspect(error)}\")\n        error\n    end\n  end\n\n  @doc \"\u30e6\u30fc\u30b6\u30fc\u3092\u53d6\u5f97\"\n  def get_user(%__MODULE__{repo: repo, logger: logger} = service, id) do\n    logger = Logger.debug(logger, \"Getting user: #{id}\")\n\n    case Repository.find_by_id(repo, id) do\n      {:ok, user} -&gt;\n        {:ok, user, %{service | logger: logger}}\n      {:error, :not_found} = error -&gt;\n        Logger.warn(logger, \"User not found: #{id}\")\n        error\n    end\n  end\n\n  @doc \"\u5168\u30e6\u30fc\u30b6\u30fc\u3092\u53d6\u5f97\"\n  def get_all_users(%__MODULE__{repo: repo, logger: logger} = service) do\n    logger = Logger.debug(logger, \"Getting all users\")\n    users = Repository.find_all(repo)\n    {:ok, users, %{service | logger: logger}}\n  end\nend\n</code></pre>"},{"location":"elixir/14-abstract-server-pattern/#notificationservice","title":"NotificationService","text":"<pre><code>defmodule NotificationService do\n  @moduledoc \"\"\"\n  \u901a\u77e5\u30b5\u30fc\u30d3\u30b9\u3002\n  Notifier \u3068 Logger \u306b\u4f9d\u5b58\u3059\u308b\u3002\n  \"\"\"\n\n  defstruct [:notifier, :logger]\n\n  def new(notifier, logger), do: %__MODULE__{notifier: notifier, logger: logger}\n\n  @doc \"\u30e6\u30fc\u30b6\u30fc\u306b\u901a\u77e5\u3092\u9001\u4fe1\"\n  def notify_user(%__MODULE__{notifier: notifier, logger: logger} = service, user, message) do\n    recipient = Map.get(user, :email) || Map.get(user, :phone) || Map.get(user, :device_token)\n    logger = Logger.info(logger, \"Sending notification to: #{recipient}\")\n\n    case Notifier.notify(notifier, recipient, message) do\n      {:ok, updated_notifier} -&gt;\n        logger = Logger.info(logger, \"Notification sent successfully\")\n        {:ok, %{service | notifier: updated_notifier, logger: logger}}\n      {:error, reason} = error -&gt;\n        Logger.error(logger, \"Failed to send notification: #{inspect(reason)}\")\n        error\n    end\n  end\n\n  @doc \"\u8907\u6570\u30e6\u30fc\u30b6\u30fc\u306b\u901a\u77e5\u3092\u9001\u4fe1\"\n  def broadcast(%__MODULE__{} = service, users, message) do\n    Enum.reduce(users, {:ok, service}, fn user, acc -&gt;\n      case acc do\n        {:ok, srv} -&gt; notify_user(srv, user, message)\n        error -&gt; error\n      end\n    end)\n  end\nend\n</code></pre>"},{"location":"elixir/14-abstract-server-pattern/#6-dependency-injection-container","title":"6. Dependency Injection Container","text":"<pre><code>defmodule Container do\n  @moduledoc \"\"\"\n  \u4f9d\u5b58\u6027\u6ce8\u5165\u30b3\u30f3\u30c6\u30ca\u3002\n  Abstract Server \u306e\u5177\u4f53\u7684\u306a\u5b9f\u88c5\u3092\u7ba1\u7406\u3059\u308b\u3002\n  \"\"\"\n\n  defstruct services: %{}\n\n  def new, do: %__MODULE__{}\n\n  @doc \"\u30b5\u30fc\u30d3\u30b9\u3092\u767b\u9332\"\n  def register(%__MODULE__{services: services} = container, key, service) do\n    %{container | services: Map.put(services, key, service)}\n  end\n\n  @doc \"\u30b5\u30fc\u30d3\u30b9\u3092\u53d6\u5f97\"\n  def resolve(%__MODULE__{services: services}, key) do\n    case Map.get(services, key) do\n      nil -&gt; {:error, {:not_found, key}}\n      service -&gt; {:ok, service}\n    end\n  end\n\n  @doc \"\u30b5\u30fc\u30d3\u30b9\u3092\u53d6\u5f97\uff08\u5b58\u5728\u3057\u306a\u3044\u5834\u5408\u306f\u30a8\u30e9\u30fc\uff09\"\n  def resolve!(%__MODULE__{} = container, key) do\n    case resolve(container, key) do\n      {:ok, service} -&gt; service\n      {:error, _} -&gt; raise \"Service not found: #{inspect(key)}\"\n    end\n  end\n\n  @doc \"\u30d5\u30a1\u30af\u30c8\u30ea\u95a2\u6570\u3067\u30b5\u30fc\u30d3\u30b9\u3092\u767b\u9332\"\n  def register_factory(%__MODULE__{services: services} = container, key, factory)\n      when is_function(factory, 1) do\n    %{container | services: Map.put(services, key, {:factory, factory})}\n  end\n\n  @doc \"\u30d5\u30a1\u30af\u30c8\u30ea\u3092\u8003\u616e\u3057\u3066\u30b5\u30fc\u30d3\u30b9\u3092\u89e3\u6c7a\"\n  def resolve_with_factory(%__MODULE__{services: services} = container, key) do\n    case Map.get(services, key) do\n      nil -&gt; {:error, {:not_found, key}}\n      {:factory, factory} -&gt; {:ok, factory.(container)}\n      service -&gt; {:ok, service}\n    end\n  end\nend\n</code></pre>"},{"location":"elixir/14-abstract-server-pattern/#7-application","title":"7. Application \u30bb\u30c3\u30c8\u30a2\u30c3\u30d7","text":"<pre><code>defmodule Application do\n  @moduledoc \"\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u4f8b\"\n\n  @doc \"\u958b\u767a\u74b0\u5883\u7528\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\"\n  def development_container do\n    Container.new()\n    |&gt; Container.register(:repository, MemoryRepository.new())\n    |&gt; Container.register(:logger, ConsoleLogger.new(:debug))\n    |&gt; Container.register(:notifier, EmailNotifier.new(\"dev@example.com\"))\n    |&gt; Container.register_factory(:user_service, fn container -&gt;\n      repo = Container.resolve!(container, :repository)\n      logger = Container.resolve!(container, :logger)\n      UserService.new(repo, logger)\n    end)\n    |&gt; Container.register_factory(:notification_service, fn container -&gt;\n      notifier = Container.resolve!(container, :notifier)\n      logger = Container.resolve!(container, :logger)\n      NotificationService.new(notifier, logger)\n    end)\n  end\n\n  @doc \"\u30c6\u30b9\u30c8\u74b0\u5883\u7528\u306e\u30b3\u30f3\u30c6\u30ca\u3092\u4f5c\u6210\"\n  def test_container do\n    Container.new()\n    |&gt; Container.register(:repository, MockRepository.new())\n    |&gt; Container.register(:logger, MemoryLogger.new())\n    |&gt; Container.register(:notifier, EmailNotifier.new(\"test@example.com\"))\n    |&gt; Container.register_factory(:user_service, fn container -&gt;\n      repo = Container.resolve!(container, :repository)\n      logger = Container.resolve!(container, :logger)\n      UserService.new(repo, logger)\n    end)\n  end\nend\n</code></pre>"},{"location":"elixir/14-abstract-server-pattern/#_4","title":"\u4f7f\u7528\u4f8b","text":"<pre><code># \u958b\u767a\u74b0\u5883\u3067\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\ncontainer = Application.development_container()\n\n# \u30b5\u30fc\u30d3\u30b9\u3092\u53d6\u5f97\n{:ok, user_service} = Container.resolve_with_factory(container, :user_service)\n{:ok, notification_service} = Container.resolve_with_factory(container, :notification_service)\n\n# \u30b5\u30fc\u30d3\u30b9\u3092\u4f7f\u7528\n{:ok, user, _} = UserService.create_user(user_service, \"Alice\", \"alice@example.com\")\n{:ok, _} = NotificationService.notify_user(notification_service, user, \"Welcome!\")\n\n# \u30c6\u30b9\u30c8\u74b0\u5883\u306b\u5207\u308a\u66ff\u3048\ntest_container = Application.test_container()\n{:ok, test_user_service} = Container.resolve_with_factory(test_container, :user_service)\n# \u540c\u3058\u30b5\u30fc\u30d3\u30b9\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u3001\u7570\u306a\u308b\u5b9f\u88c5\uff08\u30e2\u30c3\u30af\uff09\u3092\u4f7f\u7528\n</code></pre>"},{"location":"elixir/14-abstract-server-pattern/#_5","title":"\u8a2d\u8a08\u306e\u30dd\u30a4\u30f3\u30c8","text":""},{"location":"elixir/14-abstract-server-pattern/#dip","title":"\u4f9d\u5b58\u95a2\u4fc2\u9006\u8ee2\u306e\u539f\u5247\uff08DIP\uff09","text":"<pre><code>\u5f93\u6765\u306e\u4f9d\u5b58\u95a2\u4fc2:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 UserService \u2502 \u2500\u2500\u25ba \u2502MemoryRepo   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nAbstract Server \u306b\u3088\u308b\u4f9d\u5b58\u95a2\u4fc2:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 UserService \u2502 \u2500\u2500\u25ba \u2502 Repository  \u2502 \u25c4\u2500\u2500 \u2502MemoryRepo   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2502 (Protocol)  \u2502     \u2502 MockRepo    \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"elixir/14-abstract-server-pattern/#_6","title":"\u30c6\u30b9\u30c8\u5bb9\u6613\u6027","text":"<pre><code># \u30c6\u30b9\u30c8\u6642\u306f\u30e2\u30c3\u30af\u5b9f\u88c5\u3092\u6ce8\u5165\ndefmodule UserServiceTest do\n  test \"creates user\" do\n    mock_repo = MockRepository.new()\n    memory_logger = MemoryLogger.new()\n    service = UserService.new(mock_repo, memory_logger)\n\n    {:ok, user, updated_service} = UserService.create_user(service, \"Test\", \"test@example.com\")\n\n    assert user.name == \"Test\"\n\n    # \u30ed\u30b0\u3092\u691c\u8a3c\n    entries = MemoryLogger.get_entries(updated_service.logger)\n    assert Enum.any?(entries, fn {level, _} -&gt; level == :info end)\n  end\nend\n</code></pre>"},{"location":"elixir/14-abstract-server-pattern/#_7","title":"\u62e1\u5f35\u6027","text":"<p>\u65b0\u3057\u3044\u5b9f\u88c5\u3092\u8ffd\u52a0\u3059\u308b\u306b\u306f\u3001\u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u5b9f\u88c5\u3059\u308b\u3060\u3051\uff1a</p> <pre><code># \u65b0\u3057\u3044\u30ea\u30dd\u30b8\u30c8\u30ea\u5b9f\u88c5\ndefmodule PostgresRepository do\n  defstruct [:connection]\n\n  def new(connection), do: %__MODULE__{connection: connection}\nend\n\ndefimpl Repository, for: PostgresRepository do\n  def find_by_id(repo, id), do: # PostgreSQL \u30af\u30a8\u30ea\n  def find_all(repo), do: # PostgreSQL \u30af\u30a8\u30ea\n  def save(repo, entity), do: # PostgreSQL INSERT/UPDATE\n  def delete(repo, id), do: # PostgreSQL DELETE\nend\n\n# \u65e2\u5b58\u306e\u30b5\u30fc\u30d3\u30b9\u30b3\u30fc\u30c9\u306f\u5909\u66f4\u4e0d\u8981\nservice = UserService.new(PostgresRepository.new(conn), ConsoleLogger.new())\n</code></pre>"},{"location":"elixir/14-abstract-server-pattern/#_8","title":"\u307e\u3068\u3081","text":"<p>Abstract Server \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9\uff1a</p> <ol> <li>\u758e\u7d50\u5408: \u9ad8\u30ec\u30d9\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u4f4e\u30ec\u30d9\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u8a73\u7d30\u306b\u4f9d\u5b58\u3057\u306a\u3044</li> <li>\u30c6\u30b9\u30c8\u5bb9\u6613\u6027: \u30e2\u30c3\u30af\u5b9f\u88c5\u3092\u5bb9\u6613\u306b\u6ce8\u5165\u53ef\u80fd</li> <li>\u62e1\u5f35\u6027: \u65b0\u3057\u3044\u5b9f\u88c5\u3092\u8ffd\u52a0\u3057\u3066\u3082\u65e2\u5b58\u30b3\u30fc\u30c9\u306b\u5f71\u97ff\u306a\u3057</li> <li>\u8a2d\u5b9a\u53ef\u80fd\u6027: \u74b0\u5883\u306b\u5fdc\u3058\u3066\u7570\u306a\u308b\u5b9f\u88c5\u3092\u9078\u629e\u53ef\u80fd</li> </ol> <p>Elixir \u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u306f\u3001Abstract Server \u30d1\u30bf\u30fc\u30f3\u3092\u81ea\u7136\u306b\u5b9f\u88c5\u3059\u308b\u305f\u3081\u306e\u5f37\u529b\u306a\u4ed5\u7d44\u307f\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002\u69cb\u9020\u4f53\u3068\u7d44\u307f\u5408\u308f\u305b\u308b\u3053\u3068\u3067\u3001\u578b\u5b89\u5168\u3067\u62e1\u5f35\u53ef\u80fd\u306a\u30b7\u30b9\u30c6\u30e0\u3092\u69cb\u7bc9\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"elixir/15-gossiping-bus-drivers/","title":"\u7b2c15\u7ae0: \u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b","text":""},{"location":"elixir/15-gossiping-bus-drivers/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u300c\u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b\u300d\u306f\u3001\u30d0\u30b9\u904b\u8ee2\u624b\u304c\u505c\u7559\u6240\u3067\u5642\u3092\u5171\u6709\u3059\u308b\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u554f\u984c\u3067\u3059\u3002\u7121\u9650\u30b9\u30c8\u30ea\u30fc\u30e0\uff08<code>Stream.cycle</code>\uff09\u3092\u4f7f\u3063\u3066\u5faa\u74b0\u30eb\u30fc\u30c8\u3092\u8868\u73fe\u3057\u3001\u96c6\u5408\u6f14\u7b97\uff08<code>MapSet</code>\uff09\u3067\u5642\u306e\u4f1d\u64ad\u3092\u30e2\u30c7\u30eb\u5316\u3057\u307e\u3059\u3002</p>"},{"location":"elixir/15-gossiping-bus-drivers/#1","title":"1. \u554f\u984c\u306e\u6982\u8981","text":"<ul> <li>\u8907\u6570\u306e\u30d0\u30b9\u904b\u8ee2\u624b\u304c\u305d\u308c\u305e\u308c\u306e\u30eb\u30fc\u30c8\u3092\u5faa\u74b0\u3059\u308b</li> <li>\u540c\u3058\u505c\u7559\u6240\u306b\u5c45\u5408\u308f\u305b\u305f\u30c9\u30e9\u30a4\u30d0\u30fc\u540c\u58eb\u306f\u5642\u3092\u5171\u6709\u3059\u308b</li> <li>\u5168\u54e1\u304c\u5168\u3066\u306e\u5642\u3092\u77e5\u308b\u307e\u3067\u306e\u6642\u9593\u3092\u6c42\u3081\u308b</li> <li>8\u6642\u9593\uff08480\u5206\uff09\u4ee5\u5185\u306b\u5171\u6709\u3055\u308c\u306a\u3044\u5834\u5408\u306f <code>:never</code> \u3092\u8fd4\u3059</li> </ul>"},{"location":"elixir/15-gossiping-bus-drivers/#2","title":"2. \u30c9\u30e9\u30a4\u30d0\u30fc\u306e\u4f5c\u6210\u3068\u64cd\u4f5c","text":""},{"location":"elixir/15-gossiping-bus-drivers/#driver","title":"Driver \u69cb\u9020\u4f53","text":"<pre><code>defmodule Driver do\n  defstruct [:name, :route, :rumors]\n\n  def new(name, route, rumors) when is_list(route) do\n    %__MODULE__{\n      name: name,\n      route: Stream.cycle(route),  # \u7121\u9650\u30b9\u30c8\u30ea\u30fc\u30e0\u3067\u5faa\u74b0\u30eb\u30fc\u30c8\n      rumors: MapSet.new(rumors)\n    }\n  end\n\n  def current_stop(%__MODULE__{route: route}) do\n    Enum.at(route, 0)\n  end\n\n  def move(%__MODULE__{route: route} = driver) do\n    %{driver | route: Stream.drop(route, 1)}\n  end\n\n  def set_rumors(%__MODULE__{} = driver, rumors) do\n    %{driver | rumors: rumors}\n  end\nend\n</code></pre>"},{"location":"elixir/15-gossiping-bus-drivers/#_2","title":"\u4f7f\u7528\u4f8b","text":"<pre><code># \u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u4f5c\u6210\ndriver = Driver.new(\"Alice\", [1, 2, 3], [:rumor_a])\n\n# \u73fe\u5728\u306e\u505c\u7559\u6240\nDriver.current_stop(driver)  #=&gt; 1\n\n# \u6b21\u306e\u505c\u7559\u6240\u306b\u79fb\u52d5\nmoved = Driver.move(driver)\nDriver.current_stop(moved)   #=&gt; 2\n\n# \u30eb\u30fc\u30c8\u306f\u5faa\u74b0\u3059\u308b\ndriver\n|&gt; Driver.move()\n|&gt; Driver.move()\n|&gt; Driver.move()\n|&gt; Driver.current_stop()     #=&gt; 1\uff08\u6700\u521d\u306b\u623b\u308b\uff09\n</code></pre>"},{"location":"elixir/15-gossiping-bus-drivers/#3","title":"3. \u30ef\u30fc\u30eb\u30c9\uff08\u4e16\u754c\uff09\u306e\u64cd\u4f5c","text":""},{"location":"elixir/15-gossiping-bus-drivers/#_3","title":"\u505c\u7559\u6240\u306e\u96c6\u8a08","text":"<pre><code>defmodule World do\n  def get_stops(drivers) do\n    Enum.reduce(drivers, %{}, fn driver, stops -&gt;\n      stop = Driver.current_stop(driver)\n      Map.update(stops, stop, [driver], &amp;[driver | &amp;1])\n    end)\n  end\nend\n</code></pre>"},{"location":"elixir/15-gossiping-bus-drivers/#_4","title":"\u5642\u306e\u4f1d\u64ad","text":"<pre><code>defmodule World do\n  def merge_rumors(drivers) when is_list(drivers) do\n    # \u5168\u30c9\u30e9\u30a4\u30d0\u30fc\u306e\u5642\u3092\u7d71\u5408\n    all_rumors = Enum.reduce(drivers, MapSet.new(), fn driver, acc -&gt;\n      MapSet.union(acc, driver.rumors)\n    end)\n\n    # \u5404\u30c9\u30e9\u30a4\u30d0\u30fc\u306b\u7d71\u5408\u3055\u308c\u305f\u5642\u3092\u8a2d\u5b9a\n    Enum.map(drivers, &amp;Driver.set_rumors(&amp;1, all_rumors))\n  end\n\n  def spread_rumors(drivers) do\n    stops = get_stops(drivers)\n\n    stops\n    |&gt; Map.values()\n    |&gt; Enum.flat_map(&amp;merge_rumors/1)\n  end\nend\n</code></pre>"},{"location":"elixir/15-gossiping-bus-drivers/#1_1","title":"1\u30b9\u30c6\u30c3\u30d7\u306e\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3","text":"<pre><code>def drive(drivers) do\n  drivers\n  |&gt; move_drivers()      # \u5168\u54e1\u3092\u79fb\u52d5\n  |&gt; spread_rumors()     # \u5642\u3092\u4f1d\u64ad\nend\n\ndef move_drivers(drivers) do\n  Enum.map(drivers, &amp;Driver.move/1)\nend\n</code></pre>"},{"location":"elixir/15-gossiping-bus-drivers/#4","title":"4. \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u5b9f\u884c","text":""},{"location":"elixir/15-gossiping-bus-drivers/#_5","title":"\u53ce\u675f\u5224\u5b9a","text":"<pre><code>def all_rumors_shared?(drivers) do\n  rumors_list = Enum.map(drivers, &amp; &amp;1.rumors)\n\n  case rumors_list do\n    [] -&gt; true\n    [first | rest] -&gt; Enum.all?(rest, &amp;(&amp;1 == first))\n  end\nend\n</code></pre>"},{"location":"elixir/15-gossiping-bus-drivers/#_6","title":"\u30e1\u30a4\u30f3\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3","text":"<pre><code>defmodule Simulation do\n  @max_steps 480  # 8\u6642\u9593\n\n  def run_until_spread(drivers) do\n    run_until_spread(World.drive(drivers), 1)\n  end\n\n  defp run_until_spread(_drivers, step) when step &gt; @max_steps, do: :never\n  defp run_until_spread(drivers, step) do\n    if World.all_rumors_shared?(drivers) do\n      step\n    else\n      run_until_spread(World.drive(drivers), step + 1)\n    end\n  end\nend\n</code></pre>"},{"location":"elixir/15-gossiping-bus-drivers/#_7","title":"\u4f7f\u7528\u4f8b","text":"<pre><code># \u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u4f5c\u6210\ndrivers = [\n  Driver.new(\"D1\", [3, 1, 2, 3], [:r1]),\n  Driver.new(\"D2\", [3, 2, 3, 1], [:r2]),\n  Driver.new(\"D3\", [4, 2, 3, 4, 5], [:r3])\n]\n\n# \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u5b9f\u884c\nsteps = Simulation.run_until_spread(drivers)\n#=&gt; \u4f8b: 5\uff085\u30b9\u30c6\u30c3\u30d7\u3067\u5168\u5642\u304c\u5171\u6709\u3055\u308c\u305f\uff09\n</code></pre>"},{"location":"elixir/15-gossiping-bus-drivers/#5","title":"5. \u554f\u984c\u30bd\u30eb\u30d0\u30fc","text":"<pre><code>defmodule Solver do\n  def solve(routes) when is_list(routes) do\n    drivers =\n      routes\n      |&gt; Enum.with_index(1)\n      |&gt; Enum.map(fn {route, idx} -&gt;\n        rumor = String.to_atom(\"rumor_#{idx}\")\n        Driver.new(\"Driver_#{idx}\", route, [rumor])\n      end)\n\n    Simulation.run_until_spread(drivers)\n  end\n\n  def parse_and_solve(input) when is_binary(input) do\n    routes =\n      input\n      |&gt; String.trim()\n      |&gt; String.split(\"\\n\")\n      |&gt; Enum.map(fn line -&gt;\n        line\n        |&gt; String.split()\n        |&gt; Enum.map(&amp;String.to_integer/1)\n      end)\n\n    solve(routes)\n  end\nend\n</code></pre>"},{"location":"elixir/15-gossiping-bus-drivers/#_8","title":"\u4f7f\u7528\u4f8b","text":"<pre><code># \u30eb\u30fc\u30c8\u30ea\u30b9\u30c8\u304b\u3089\u89e3\u304f\nroutes = [[3, 1, 2, 3], [3, 2, 3, 1], [4, 2, 3, 4, 5]]\nSolver.solve(routes)\n\n# \u30c6\u30ad\u30b9\u30c8\u5165\u529b\u304b\u3089\u89e3\u304f\ninput = \"\"\"\n3 1 2 3\n3 2 3 1\n4 2 3 4 5\n\"\"\"\nSolver.parse_and_solve(input)\n</code></pre>"},{"location":"elixir/15-gossiping-bus-drivers/#6","title":"6. \u8a2d\u8a08\u306e\u30dd\u30a4\u30f3\u30c8","text":""},{"location":"elixir/15-gossiping-bus-drivers/#_9","title":"\u7121\u9650\u30b9\u30c8\u30ea\u30fc\u30e0\u306e\u6d3b\u7528","text":"<p><code>Stream.cycle/1</code> \u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u5faa\u74b0\u30eb\u30fc\u30c8\u3092\u81ea\u7136\u306b\u8868\u73fe\u3067\u304d\u307e\u3059\u3002</p> <pre><code>route = Stream.cycle([1, 2, 3])\nEnum.take(route, 7)  #=&gt; [1, 2, 3, 1, 2, 3, 1]\n</code></pre>"},{"location":"elixir/15-gossiping-bus-drivers/#_10","title":"\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020","text":"<p>\u30c9\u30e9\u30a4\u30d0\u30fc\u306e\u72b6\u614b\u306f\u4e0d\u5909\u3067\u3001\u79fb\u52d5\u3084\u5642\u306e\u66f4\u65b0\u306f\u5e38\u306b\u65b0\u3057\u3044\u69cb\u9020\u4f53\u3092\u8fd4\u3057\u307e\u3059\u3002</p> <pre><code># \u5143\u306e\u30c9\u30e9\u30a4\u30d0\u30fc\u306f\u5909\u66f4\u3055\u308c\u306a\u3044\ndriver = Driver.new(\"Alice\", [1, 2], [:a])\nmoved = Driver.move(driver)\n\nDriver.current_stop(driver)  #=&gt; 1\uff08\u5143\u306e\u307e\u307e\uff09\nDriver.current_stop(moved)   #=&gt; 2\uff08\u65b0\u3057\u3044\u72b6\u614b\uff09\n</code></pre>"},{"location":"elixir/15-gossiping-bus-drivers/#_11","title":"\u96c6\u5408\u6f14\u7b97\u306b\u3088\u308b\u5642\u306e\u7d71\u5408","text":"<p><code>MapSet.union/2</code> \u3092\u4f7f\u7528\u3057\u3066\u3001\u5642\u306e\u7d71\u5408\u3092\u7c21\u6f54\u306b\u8868\u73fe\u3067\u304d\u307e\u3059\u3002</p> <pre><code>rumors1 = MapSet.new([:a, :b])\nrumors2 = MapSet.new([:b, :c])\nMapSet.union(rumors1, rumors2)  #=&gt; MapSet.new([:a, :b, :c])\n</code></pre>"},{"location":"elixir/15-gossiping-bus-drivers/#_12","title":"\u9045\u5ef6\u8a55\u4fa1","text":"<p><code>Stream</code> \u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u7121\u9650\u30b7\u30fc\u30b1\u30f3\u30b9\u3067\u3082\u30e1\u30e2\u30ea\u52b9\u7387\u826f\u304f\u51e6\u7406\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"elixir/15-gossiping-bus-drivers/#7","title":"7. \u30b5\u30f3\u30d7\u30eb\u554f\u984c","text":""},{"location":"elixir/15-gossiping-bus-drivers/#_13","title":"\u51fa\u4f1a\u308f\u306a\u3044\u30b1\u30fc\u30b9","text":"<pre><code>drivers = [\n  Driver.new(\"D1\", [1], [:r1]),  # \u505c\u7559\u62401\u306b\u56fa\u5b9a\n  Driver.new(\"D2\", [2], [:r2])   # \u505c\u7559\u62402\u306b\u56fa\u5b9a\n]\n\nSimulation.run_until_spread(drivers)  #=&gt; :never\n</code></pre>"},{"location":"elixir/15-gossiping-bus-drivers/#_14","title":"\u3059\u3050\u306b\u51fa\u4f1a\u3046\u30b1\u30fc\u30b9","text":"<pre><code>drivers = [\n  Driver.new(\"D1\", [1, 2], [:r1]),\n  Driver.new(\"D2\", [1, 3], [:r2]),\n  Driver.new(\"D3\", [1, 4], [:r3])\n]\n\n# \u5168\u54e1\u304c\u6700\u521d\u304b\u3089\u505c\u7559\u62401\u306b\u3044\u308b\u306e\u3067\u30011\u30b9\u30c6\u30c3\u30d7\u76ee\u3067\u5642\u304c\u5171\u6709\u3055\u308c\u308b\nSimulation.run_until_spread(drivers)  #=&gt; 1\n</code></pre>"},{"location":"elixir/15-gossiping-bus-drivers/#_15","title":"\u307e\u3068\u3081","text":"<p>\u3053\u306e\u554f\u984c\u306f\u4ee5\u4e0b\u306e\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u6982\u5ff5\u3092\u6d3b\u7528\u3057\u3066\u3044\u307e\u3059\uff1a</p> <ol> <li>\u7121\u9650\u30b9\u30c8\u30ea\u30fc\u30e0: <code>Stream.cycle</code> \u3067\u5faa\u74b0\u30eb\u30fc\u30c8\u3092\u8868\u73fe</li> <li>\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020: \u72b6\u614b\u5909\u66f4\u306f\u5e38\u306b\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u3092\u8fd4\u3059</li> <li>\u96c6\u5408\u6f14\u7b97: <code>MapSet</code> \u3067\u5642\u306e\u7d71\u5408\u3092\u7c21\u6f54\u306b\u5b9f\u88c5</li> <li>\u518d\u5e30\u3068\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1: \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u306e\u7d42\u4e86\u6761\u4ef6\u3092\u660e\u78ba\u306b\u8868\u73fe</li> <li>\u9ad8\u968e\u95a2\u6570: <code>Enum.map</code>, <code>Enum.reduce</code>, <code>Enum.filter</code> \u3067\u30c7\u30fc\u30bf\u5909\u63db</li> </ol> <p>Elixir \u306e\u5f37\u529b\u306a\u30b9\u30c8\u30ea\u30fc\u30e0\u51e6\u7406\u3068\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u306b\u3088\u308a\u3001\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u554f\u984c\u3092\u5ba3\u8a00\u7684\u306b\u8a18\u8ff0\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"elixir/16-payroll-system/","title":"\u7b2c16\u7ae0: \u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0","text":""},{"location":"elixir/16-payroll-system/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0\u306f\u3001\u5f93\u696d\u54e1\u306e\u7d66\u4e0e\u8a08\u7b97\u3068\u652f\u6255\u3044\u51e6\u7406\u3092\u7d71\u5408\u7684\u306b\u7ba1\u7406\u3059\u308b\u30b7\u30b9\u30c6\u30e0\u3067\u3059\u3002\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u306b\u3088\u308b\u591a\u614b\u6027\u3092\u6d3b\u7528\u3057\u3066\u3001\u7570\u306a\u308b\u7d66\u4e0e\u30bf\u30a4\u30d7\u306b\u5bfe\u5fdc\u3057\u305f\u8a08\u7b97\u30ed\u30b8\u30c3\u30af\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002</p>"},{"location":"elixir/16-payroll-system/#1","title":"1. \u5f93\u696d\u54e1\u30e2\u30c7\u30eb","text":""},{"location":"elixir/16-payroll-system/#employee","title":"Employee \u69cb\u9020\u4f53","text":"<pre><code>defmodule Employee do\n  @type pay_type :: :salaried | :hourly | :commissioned\n  @type schedule :: :monthly | :weekly | :biweekly\n  @type payment_method :: :hold | :direct_deposit | :mail\n\n  defstruct [\n    :id,\n    :name,\n    :address,\n    :pay_class,\n    :schedule,\n    :payment_method\n  ]\nend\n</code></pre>"},{"location":"elixir/16-payroll-system/#_2","title":"\u5f93\u696d\u54e1\u306e\u4f5c\u6210","text":"<pre><code># \u6708\u7d66\u5236\u5f93\u696d\u54e1\ndef make_salaried(id, name, salary) do\n  %Employee{\n    id: id,\n    name: name,\n    pay_class: {:salaried, salary},\n    schedule: :monthly,\n    payment_method: :hold\n  }\nend\n\n# \u6642\u7d66\u5236\u5f93\u696d\u54e1\ndef make_hourly(id, name, hourly_rate) do\n  %Employee{\n    id: id,\n    name: name,\n    pay_class: {:hourly, hourly_rate},\n    schedule: :weekly,\n    payment_method: :hold\n  }\nend\n\n# \u6b69\u5408\u5236\u5f93\u696d\u54e1\ndef make_commissioned(id, name, base_pay, commission_rate) do\n  %Employee{\n    id: id,\n    name: name,\n    pay_class: {:commissioned, base_pay, commission_rate},\n    schedule: :biweekly,\n    payment_method: :hold\n  }\nend\n</code></pre>"},{"location":"elixir/16-payroll-system/#_3","title":"\u4f7f\u7528\u4f8b","text":"<pre><code># \u6708\u7d6650\u4e07\u5186\u306e\u5f93\u696d\u54e1\nsalaried = Employee.make_salaried(\"E001\", \"\u7530\u4e2d\u592a\u90ce\", 500_000)\n\n# \u6642\u7d661500\u5186\u306e\u5f93\u696d\u54e1\nhourly = Employee.make_hourly(\"E002\", \"\u4f50\u85e4\u82b1\u5b50\", 1500)\n\n# \u57fa\u672c\u7d6620\u4e07\u5186 + \u58f2\u4e0a\u306e10%\u306e\u5f93\u696d\u54e1\ncommissioned = Employee.make_commissioned(\"E003\", \"\u9234\u6728\u4e00\u90ce\", 200_000, 0.1)\n</code></pre>"},{"location":"elixir/16-payroll-system/#2","title":"2. \u7d66\u4e0e\u8a08\u7b97","text":""},{"location":"elixir/16-payroll-system/#_4","title":"\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u306b\u3088\u308b\u8a08\u7b97","text":"<pre><code>defmodule Classification do\n  # \u6708\u7d66\u5236\uff1a\u305d\u306e\u307e\u307e\u6708\u7d66\u3092\u8fd4\u3059\n  def calc_pay(%Employee{pay_class: {:salaried, salary}}, _context) do\n    salary\n  end\n\n  # \u6642\u7d66\u5236\uff1a\u30bf\u30a4\u30e0\u30ab\u30fc\u30c9\u304b\u3089\u8a08\u7b97\uff08\u6b8b\u696d\u306f1.5\u500d\uff09\n  def calc_pay(%Employee{pay_class: {:hourly, hourly_rate}} = employee, context) do\n    time_cards = get_in(context, [:time_cards, Employee.get_id(employee)]) || []\n    hours = Enum.map(time_cards, fn {_date, hours} -&gt; hours end)\n    total_hours = Enum.sum(hours)\n\n    regular_hours = min(total_hours, 40)\n    overtime_hours = max(0, total_hours - 40)\n\n    regular_hours * hourly_rate + overtime_hours * hourly_rate * 1.5\n  end\n\n  # \u6b69\u5408\u5236\uff1a\u57fa\u672c\u7d66 + \u58f2\u4e0a \u00d7 \u30b3\u30df\u30c3\u30b7\u30e7\u30f3\u7387\n  def calc_pay(%Employee{pay_class: {:commissioned, base_pay, commission_rate}} = employee, context) do\n    sales_receipts = get_in(context, [:sales_receipts, Employee.get_id(employee)]) || []\n    total_sales = Enum.sum(Enum.map(sales_receipts, fn {_date, amount} -&gt; amount end))\n\n    base_pay + total_sales * commission_rate\n  end\nend\n</code></pre>"},{"location":"elixir/16-payroll-system/#_5","title":"\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u7ba1\u7406","text":"<pre><code>defmodule Classification do\n  def make_context do\n    %{\n      time_cards: %{},\n      sales_receipts: %{}\n    }\n  end\n\n  def add_time_card(context, employee_id, date, hours) do\n    update_in(context, [:time_cards, employee_id], fn\n      nil -&gt; [{date, hours}]\n      cards -&gt; [{date, hours} | cards]\n    end)\n  end\n\n  def add_sales_receipt(context, employee_id, date, amount) do\n    update_in(context, [:sales_receipts, employee_id], fn\n      nil -&gt; [{date, amount}]\n      receipts -&gt; [{date, amount} | receipts]\n    end)\n  end\nend\n</code></pre>"},{"location":"elixir/16-payroll-system/#_6","title":"\u4f7f\u7528\u4f8b","text":"<pre><code># \u6642\u7d66\u5236\u5f93\u696d\u54e1\u306e\u7d66\u4e0e\u8a08\u7b97\nhourly = Employee.make_hourly(\"E002\", \"\u4f50\u85e4\", 1500)\nctx =\n  Classification.make_context()\n  |&gt; Classification.add_time_card(\"E002\", \"2024-01-15\", 8)\n  |&gt; Classification.add_time_card(\"E002\", \"2024-01-16\", 8)\n\nClassification.calc_pay(hourly, ctx)  #=&gt; 24000.0\n\n# \u6b8b\u696d\u3092\u542b\u3080\u5834\u5408\nctx_overtime =\n  Classification.make_context()\n  |&gt; Classification.add_time_card(\"E002\", \"2024-01-15\", 45)\n\nClassification.calc_pay(hourly, ctx_overtime)\n#=&gt; 40 * 1500 + 5 * 1500 * 1.5 = 67500.0\n</code></pre>"},{"location":"elixir/16-payroll-system/#3","title":"3. \u652f\u6255\u3044\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb","text":"<pre><code>defmodule Schedule do\n  # \u6708\u7d66\u5236\uff1a\u6708\u672b\u304c\u652f\u6255\u65e5\n  def is_pay_day?(%Employee{schedule: :monthly}, date) do\n    is_last_day_of_month?(date)\n  end\n\n  # \u6642\u7d66\u5236\uff1a\u6bce\u9031\u91d1\u66dc\u65e5\n  def is_pay_day?(%Employee{schedule: :weekly}, date) do\n    Map.get(date, :day_of_week) == :friday\n  end\n\n  # \u6b69\u5408\u5236\uff1a\u9694\u9031\u91d1\u66dc\u65e5\n  def is_pay_day?(%Employee{schedule: :biweekly}, date) do\n    Map.get(date, :day_of_week) == :friday and\n      Map.get(date, :is_pay_week, false) == true\n  end\n\n  # \u65e5\u4ed8\u30d5\u30a1\u30af\u30c8\u30ea\n  def end_of_month(year, month), do: # ...\n  def friday(year, month, day), do: # ...\n  def pay_friday(year, month, day), do: # ...\nend\n</code></pre>"},{"location":"elixir/16-payroll-system/#4","title":"4. \u652f\u6255\u3044\u51e6\u7406","text":"<pre><code>defmodule Payment do\n  def process(%Employee{payment_method: :hold} = employee, amount) do\n    %{\n      type: :hold,\n      employee_id: Employee.get_id(employee),\n      amount: amount,\n      message: \"\u652f\u6255\u3044\u3092\u4fdd\u7559\"\n    }\n  end\n\n  def process(%Employee{payment_method: :direct_deposit} = employee, amount) do\n    %{\n      type: :direct_deposit,\n      employee_id: Employee.get_id(employee),\n      amount: amount,\n      message: \"\u53e3\u5ea7\u306b\u632f\u308a\u8fbc\u307f\"\n    }\n  end\n\n  def process(%Employee{payment_method: :mail} = employee, amount) do\n    %{\n      type: :mail,\n      employee_id: Employee.get_id(employee),\n      amount: amount,\n      message: \"\u5c0f\u5207\u624b\u3092\u90f5\u9001\"\n    }\n  end\nend\n</code></pre>"},{"location":"elixir/16-payroll-system/#5","title":"5. \u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0","text":""},{"location":"elixir/16-payroll-system/#payroll","title":"Payroll \u30e2\u30b8\u30e5\u30fc\u30eb","text":"<pre><code>defmodule Payroll do\n  def calculate_pay(employee, context) do\n    Classification.calc_pay(employee, context)\n  end\n\n  def calculate_payroll(employees, context) do\n    Enum.map(employees, fn emp -&gt;\n      %{employee: emp, pay: calculate_pay(emp, context)}\n    end)\n  end\n\n  def run_payroll(employees, context, date) do\n    employees\n    |&gt; Enum.filter(&amp;Schedule.is_pay_day?(&amp;1, date))\n    |&gt; Enum.map(fn emp -&gt;\n      pay = calculate_pay(emp, context)\n      Payment.process(emp, pay)\n    end)\n  end\n\n  def payroll_report(employees, context) do\n    payroll = calculate_payroll(employees, context)\n    total = Enum.sum(Enum.map(payroll, &amp; &amp;1.pay))\n\n    %{\n      employees: Enum.map(payroll, fn %{employee: emp, pay: pay} -&gt;\n        %{\n          id: Employee.get_id(emp),\n          name: Employee.get_name(emp),\n          type: Employee.get_pay_type(emp),\n          pay: pay\n        }\n      end),\n      total: total,\n      count: length(employees)\n    }\n  end\nend\n</code></pre>"},{"location":"elixir/16-payroll-system/#6","title":"6. \u5f93\u696d\u54e1\u30ea\u30dd\u30b8\u30c8\u30ea","text":"<pre><code>defmodule EmployeeRepository do\n  def start_link do\n    Agent.start_link(fn -&gt; %{} end)\n  end\n\n  def add(pid, %Employee{} = employee) do\n    Agent.update(pid, &amp;Map.put(&amp;1, employee.id, employee))\n    {:ok, employee}\n  end\n\n  def get(pid, id) do\n    case Agent.get(pid, &amp;Map.get(&amp;1, id)) do\n      nil -&gt; {:error, :not_found}\n      employee -&gt; {:ok, employee}\n    end\n  end\n\n  def get_all(pid) do\n    Agent.get(pid, &amp;Map.values(&amp;1))\n  end\n\n  def update(pid, id, update_fn) do\n    Agent.get_and_update(pid, fn state -&gt;\n      case Map.get(state, id) do\n        nil -&gt;\n          {{:error, :not_found}, state}\n        employee -&gt;\n          updated = update_fn.(employee)\n          {{:ok, updated}, Map.put(state, id, updated)}\n      end\n    end)\n  end\n\n  def delete(pid, id) do\n    Agent.get_and_update(pid, fn state -&gt;\n      case Map.pop(state, id) do\n        {nil, state} -&gt; {{:error, :not_found}, state}\n        {employee, state} -&gt; {{:ok, employee}, state}\n      end\n    end)\n  end\nend\n</code></pre>"},{"location":"elixir/16-payroll-system/#7","title":"7. \u30b5\u30fc\u30d3\u30b9\u5c64","text":"<pre><code>defmodule PayrollService do\n  defstruct [:repo, :context]\n\n  def new do\n    {:ok, repo} = EmployeeRepository.start_link()\n    %__MODULE__{\n      repo: repo,\n      context: Classification.make_context()\n    }\n  end\n\n  def add_salaried_employee(service, id, name, salary) do\n    employee = Employee.make_salaried(id, name, salary)\n    EmployeeRepository.add(service.repo, employee)\n  end\n\n  def add_time_card(%__MODULE__{context: ctx} = service, employee_id, date, hours) do\n    new_ctx = Classification.add_time_card(ctx, employee_id, date, hours)\n    %{service | context: new_ctx}\n  end\n\n  def run_payroll(service, date) do\n    employees = EmployeeRepository.get_all(service.repo)\n    Payroll.run_payroll(employees, service.context, date)\n  end\n\n  def payroll_report(service) do\n    employees = EmployeeRepository.get_all(service.repo)\n    Payroll.payroll_report(employees, service.context)\n  end\nend\n</code></pre>"},{"location":"elixir/16-payroll-system/#8","title":"8. \u5b8c\u5168\u306a\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u4f8b","text":"<pre><code># \u30b5\u30fc\u30d3\u30b9\u3092\u4f5c\u6210\nservice = PayrollService.new()\n\n# \u5f93\u696d\u54e1\u3092\u8ffd\u52a0\nPayrollService.add_salaried_employee(service, \"E001\", \"\u7530\u4e2d\u592a\u90ce\", 500_000)\nPayrollService.add_hourly_employee(service, \"E002\", \"\u4f50\u85e4\u82b1\u5b50\", 1500)\nPayrollService.add_commissioned_employee(service, \"E003\", \"\u9234\u6728\u4e00\u90ce\", 200_000, 0.1)\n\n# \u652f\u6255\u3044\u65b9\u6cd5\u3092\u5909\u66f4\nPayrollService.change_payment_method(service, \"E001\", :direct_deposit)\n\n# \u30bf\u30a4\u30e0\u30ab\u30fc\u30c9\u3092\u8ffd\u52a0\nservice = PayrollService.add_time_card(service, \"E002\", \"2024-01-15\", 8)\nservice = PayrollService.add_time_card(service, \"E002\", \"2024-01-16\", 8)\n\n# \u58f2\u4e0a\u30ec\u30b7\u30fc\u30c8\u3092\u8ffd\u52a0\nservice = PayrollService.add_sales_receipt(service, \"E003\", \"2024-01-15\", 100_000)\n\n# \u30ec\u30dd\u30fc\u30c8\u3092\u751f\u6210\nreport = PayrollService.payroll_report(service)\n#=&gt; %{count: 3, total: 722_000.0, employees: [...]}\n\n# \u7d66\u4e0e\u3092\u652f\u6255\u3044\uff08\u6708\u672b\uff09\nend_of_month = Schedule.end_of_month(2024, 1)\npayments = PayrollService.run_payroll(service, end_of_month)\n#=&gt; \u6708\u7d66\u5236\u5f93\u696d\u54e1\u3078\u306e\u652f\u6255\u3044\u304c\u51e6\u7406\u3055\u308c\u308b\n\n# \u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\nPayrollService.stop(service)\n</code></pre>"},{"location":"elixir/16-payroll-system/#_7","title":"\u8a2d\u8a08\u306e\u30dd\u30a4\u30f3\u30c8","text":""},{"location":"elixir/16-payroll-system/#_8","title":"\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u306b\u3088\u308b\u591a\u614b\u6027","text":"<p>Clojure \u306e\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u76f8\u5f53\u3059\u308b\u6a5f\u80fd\u3092\u3001Elixir \u3067\u306f\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3067\u5b9f\u73fe\u3057\u3066\u3044\u307e\u3059\u3002</p> <pre><code># \u7d66\u4e0e\u30bf\u30a4\u30d7\u3054\u3068\u306b\u7570\u306a\u308b\u8a08\u7b97\u30ed\u30b8\u30c3\u30af\ndef calc_pay(%Employee{pay_class: {:salaried, salary}}, _), do: salary\ndef calc_pay(%Employee{pay_class: {:hourly, rate}}, ctx), do: # ...\ndef calc_pay(%Employee{pay_class: {:commissioned, base, rate}}, ctx), do: # ...\n</code></pre>"},{"location":"elixir/16-payroll-system/#_9","title":"\u30bf\u30d7\u30eb\u306b\u3088\u308b\u5206\u985e\u30c7\u30fc\u30bf\u306e\u8868\u73fe","text":"<pre><code>pay_class: {:salaried, 500_000}\npay_class: {:hourly, 1500}\npay_class: {:commissioned, 200_000, 0.1}\n</code></pre>"},{"location":"elixir/16-payroll-system/#agent","title":"Agent \u306b\u3088\u308b\u72b6\u614b\u7ba1\u7406","text":"<p>\u30ea\u30dd\u30b8\u30c8\u30ea\u306f <code>Agent</code> \u3092\u4f7f\u7528\u3057\u3066\u72b6\u614b\u3092\u7ba1\u7406\u3057\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u95a2\u6570\u578b\u306e\u7d14\u7c8b\u6027\u3092\u4fdd\u3061\u306a\u304c\u3089\u3001\u5fc5\u8981\u306a\u7b87\u6240\u3067\u306e\u307f\u72b6\u614b\u3092\u6301\u3064\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"elixir/16-payroll-system/#_10","title":"\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306b\u3088\u308b\u88dc\u52a9\u30c7\u30fc\u30bf\u306e\u7ba1\u7406","text":"<p>\u30bf\u30a4\u30e0\u30ab\u30fc\u30c9\u3084\u58f2\u4e0a\u30ec\u30b7\u30fc\u30c8\u306f\u3001\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\uff08\u30de\u30c3\u30d7\uff09\u3068\u3057\u3066\u7ba1\u7406\u3057\u3001\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u7d66\u4e0e\u8a08\u7b97\u306b\u6e21\u3057\u307e\u3059\u3002</p>"},{"location":"elixir/16-payroll-system/#_11","title":"\u307e\u3068\u3081","text":"<p>\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0\u306f\u4ee5\u4e0b\u306e\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u6982\u5ff5\u3092\u6d3b\u7528\u3057\u3066\u3044\u307e\u3059\uff1a</p> <ol> <li>\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0: \u7d66\u4e0e\u30bf\u30a4\u30d7\u3054\u3068\u306e\u8a08\u7b97\u30ed\u30b8\u30c3\u30af\u3092\u660e\u78ba\u306b\u5206\u96e2</li> <li>\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020: \u5f93\u696d\u54e1\u30c7\u30fc\u30bf\u306e\u5b89\u5168\u306a\u7ba1\u7406</li> <li>\u9ad8\u968e\u95a2\u6570: \u30ea\u30b9\u30c8\u51e6\u7406\u306e\u7c21\u6f54\u306a\u5b9f\u88c5</li> <li>Agent: \u5fc5\u8981\u6700\u5c0f\u9650\u306e\u72b6\u614b\u7ba1\u7406</li> <li>\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3: \u30c7\u30fc\u30bf\u5909\u63db\u306e\u9023\u9396\u7684\u306a\u51e6\u7406</li> </ol> <p>Elixir \u306e\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3068\u95a2\u6570\u578b\u306e\u7279\u6027\u306b\u3088\u308a\u3001\u8907\u96d1\u306a\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u3092\u660e\u78ba\u304b\u3064\u4fdd\u5b88\u3057\u3084\u3059\u3044\u5f62\u3067\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"elixir/17-video-rental-system/","title":"\u7b2c17\u7ae0: \u30d3\u30c7\u30aa\u30ec\u30f3\u30bf\u30eb\u30b7\u30b9\u30c6\u30e0","text":""},{"location":"elixir/17-video-rental-system/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u30d3\u30c7\u30aa\u30ec\u30f3\u30bf\u30eb\u30b7\u30b9\u30c6\u30e0\u306f\u3001Martin Fowler \u306e\u300cRefactoring\u300d\u3067\u6709\u540d\u306a\u30b5\u30f3\u30d7\u30eb\u30b3\u30fc\u30c9\u3092 Elixir \u3067\u95a2\u6570\u578b\u306b\u518d\u5b9f\u88c5\u3057\u305f\u3082\u306e\u3067\u3059\u3002Strategy \u30d1\u30bf\u30fc\u30f3\u306b\u76f8\u5f53\u3059\u308b\u4fa1\u683c\u8a08\u7b97\u3092\u3001\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3068\u95a2\u6570\u306e\u5408\u6210\u3067\u5b9f\u73fe\u3057\u307e\u3059\u3002</p>"},{"location":"elixir/17-video-rental-system/#1","title":"1. \u6620\u753b\u3068\u4fa1\u683c\u8a2d\u5b9a","text":""},{"location":"elixir/17-video-rental-system/#movie","title":"Movie \u69cb\u9020\u4f53","text":"<pre><code>defmodule Movie do\n  @type price_code :: :regular | :new_release | :children\n\n  defstruct [:title, :price_code]\n\n  def new(title, price_code) do\n    %__MODULE__{title: title, price_code: price_code}\n  end\n\n  def regular(title), do: new(title, :regular)\n  def new_release(title), do: new(title, :new_release)\n  def children(title), do: new(title, :children)\nend\n</code></pre>"},{"location":"elixir/17-video-rental-system/#_2","title":"\u4fa1\u683c\u8a08\u7b97\u30e2\u30b8\u30e5\u30fc\u30eb","text":"<pre><code>defmodule Pricing do\n  @doc \"\u30ec\u30f3\u30bf\u30eb\u6599\u91d1\u3092\u8a08\u7b97\"\n  def calculate_amount(movie, days_rented) do\n    case movie.price_code do\n      :regular -&gt; regular_price(days_rented)\n      :new_release -&gt; new_release_price(days_rented)\n      :children -&gt; children_price(days_rented)\n    end\n  end\n\n  defp regular_price(days) do\n    if days &gt; 2, do: 2.0 + (days - 2) * 1.5, else: 2.0\n  end\n\n  defp new_release_price(days) do\n    days * 3.0\n  end\n\n  defp children_price(days) do\n    if days &gt; 3, do: 1.5 + (days - 3) * 1.5, else: 1.5\n  end\nend\n</code></pre>"},{"location":"elixir/17-video-rental-system/#_3","title":"\u30dd\u30a4\u30f3\u30c8\u8a08\u7b97","text":"<pre><code>def calculate_points(movie, days_rented) do\n  base_points = 1\n  bonus = if movie.price_code == :new_release and days_rented &gt; 1, do: 1, else: 0\n  base_points + bonus\nend\n</code></pre>"},{"location":"elixir/17-video-rental-system/#2","title":"2. \u30ec\u30f3\u30bf\u30eb\u7ba1\u7406","text":""},{"location":"elixir/17-video-rental-system/#rental","title":"Rental \u69cb\u9020\u4f53","text":"<pre><code>defmodule Rental do\n  defstruct [:movie, :days_rented]\n\n  def new(movie, days_rented) do\n    %__MODULE__{movie: movie, days_rented: days_rented}\n  end\n\n  def amount(rental) do\n    Pricing.calculate_amount(rental.movie, rental.days_rented)\n  end\n\n  def points(rental) do\n    Pricing.calculate_points(rental.movie, rental.days_rented)\n  end\nend\n</code></pre>"},{"location":"elixir/17-video-rental-system/#3","title":"3. \u660e\u7d30\u751f\u6210","text":""},{"location":"elixir/17-video-rental-system/#statement","title":"Statement \u30e2\u30b8\u30e5\u30fc\u30eb","text":"<pre><code>defmodule Statement do\n  @doc \"\u30c6\u30ad\u30b9\u30c8\u5f62\u5f0f\u306e\u660e\u7d30\u3092\u751f\u6210\"\n  def generate(customer_name, rentals) do\n    {total, points, lines} = calculate_statement(rentals)\n\n    header = \"Rental Record for #{customer_name}\\n\"\n    body = Enum.join(lines, \"\\n\")\n    footer = \"\"\"\n\n    Amount owed is #{format_currency(total)}\n    You earned #{points} frequent renter points\n    \"\"\"\n\n    header &lt;&gt; body &lt;&gt; footer\n  end\n\n  defp calculate_statement(rentals) do\n    Enum.reduce(rentals, {0.0, 0, []}, fn rental, {total, points, lines} -&gt;\n      amount = Rental.amount(rental)\n      rental_points = Rental.points(rental)\n      line = \"\\t#{rental.movie.title}\\t#{format_currency(amount)}\"\n      {total + amount, points + rental_points, lines ++ [line]}\n    end)\n  end\n\n  defp format_currency(amount) do\n    :io_lib.format(\"~.2f\", [amount]) |&gt; to_string()\n  end\nend\n</code></pre>"},{"location":"elixir/17-video-rental-system/#html","title":"HTML \u5f62\u5f0f\u306e\u660e\u7d30","text":"<pre><code>def generate_html(customer_name, rentals) do\n  {total, points, rows} = calculate_html_statement(rentals)\n\n  \"\"\"\n  &lt;html&gt;\n  &lt;head&gt;&lt;title&gt;Rental Statement&lt;/title&gt;&lt;/head&gt;\n  &lt;body&gt;\n  &lt;h1&gt;Rental Record for #{customer_name}&lt;/h1&gt;\n  &lt;table&gt;\n  &lt;tr&gt;&lt;th&gt;Title&lt;/th&gt;&lt;th&gt;Amount&lt;/th&gt;&lt;/tr&gt;\n  #{Enum.join(rows, \"\\n\")}\n  &lt;/table&gt;\n  &lt;p&gt;Amount owed is &lt;strong&gt;#{format_currency(total)}&lt;/strong&gt;&lt;/p&gt;\n  &lt;p&gt;You earned &lt;strong&gt;#{points}&lt;/strong&gt; frequent renter points&lt;/p&gt;\n  &lt;/body&gt;\n  &lt;/html&gt;\n  \"\"\"\nend\n</code></pre>"},{"location":"elixir/17-video-rental-system/#4","title":"4. \u9867\u5ba2\u7ba1\u7406","text":""},{"location":"elixir/17-video-rental-system/#customer","title":"Customer \u30e2\u30b8\u30e5\u30fc\u30eb","text":"<pre><code>defmodule Customer do\n  defstruct [:name, rentals: []]\n\n  def new(name) do\n    %__MODULE__{name: name}\n  end\n\n  def add_rental(customer, rental) do\n    %{customer | rentals: customer.rentals ++ [rental]}\n  end\n\n  def statement(customer) do\n    Statement.generate(customer.name, customer.rentals)\n  end\n\n  def html_statement(customer) do\n    Statement.generate_html(customer.name, customer.rentals)\n  end\n\n  def total_amount(customer) do\n    customer.rentals\n    |&gt; Enum.map(&amp;Rental.amount/1)\n    |&gt; Enum.sum()\n  end\n\n  def total_points(customer) do\n    customer.rentals\n    |&gt; Enum.map(&amp;Rental.points/1)\n    |&gt; Enum.sum()\n  end\nend\n</code></pre>"},{"location":"elixir/17-video-rental-system/#5","title":"5. \u30ea\u30dd\u30b8\u30c8\u30ea\u30d1\u30bf\u30fc\u30f3","text":""},{"location":"elixir/17-video-rental-system/#movierepository-agent","title":"MovieRepository (Agent \u30d9\u30fc\u30b9)","text":"<pre><code>defmodule MovieRepository do\n  use Agent\n\n  def start_link(_opts \\\\ []) do\n    Agent.start_link(fn -&gt; %{} end, name: __MODULE__)\n  end\n\n  def add(movie) do\n    Agent.update(__MODULE__, fn movies -&gt;\n      Map.put(movies, movie.title, movie)\n    end)\n  end\n\n  def find(title) do\n    Agent.get(__MODULE__, fn movies -&gt;\n      Map.get(movies, title)\n    end)\n  end\n\n  def all do\n    Agent.get(__MODULE__, fn movies -&gt;\n      Map.values(movies)\n    end)\n  end\n\n  def clear do\n    Agent.update(__MODULE__, fn _ -&gt; %{} end)\n  end\nend\n</code></pre>"},{"location":"elixir/17-video-rental-system/#6","title":"6. \u30ec\u30f3\u30bf\u30eb\u30b5\u30fc\u30d3\u30b9","text":""},{"location":"elixir/17-video-rental-system/#_4","title":"\u30b5\u30fc\u30d3\u30b9\u5c64","text":"<pre><code>defmodule RentalService do\n  @doc \"\u6620\u753b\u3092\u30ec\u30f3\u30bf\u30eb\"\n  def rent_movie(customer, movie_title, days) do\n    case MovieRepository.find(movie_title) do\n      nil -&gt; {:error, :movie_not_found}\n      movie -&gt;\n        rental = Rental.new(movie, days)\n        {:ok, Customer.add_rental(customer, rental)}\n    end\n  end\n\n  @doc \"\u8907\u6570\u6620\u753b\u3092\u4e00\u62ec\u30ec\u30f3\u30bf\u30eb\"\n  def rent_movies(customer, rentals_data) do\n    Enum.reduce_while(rentals_data, {:ok, customer}, fn {title, days}, {:ok, c} -&gt;\n      case rent_movie(c, title, days) do\n        {:ok, updated} -&gt; {:cont, {:ok, updated}}\n        {:error, _} = err -&gt; {:halt, err}\n      end\n    end)\n  end\n\n  @doc \"\u63a8\u5968\u6620\u753b\u3092\u53d6\u5f97\"\n  def recommend_movies(customer) do\n    rented_titles = MapSet.new(customer.rentals, &amp; &amp;1.movie.title)\n\n    MovieRepository.all()\n    |&gt; Enum.reject(fn m -&gt; MapSet.member?(rented_titles, m.title) end)\n    |&gt; Enum.sort_by(&amp; &amp;1.title)\n  end\nend\n</code></pre>"},{"location":"elixir/17-video-rental-system/#7","title":"7. \u95a2\u6570\u578b\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u306e\u30dd\u30a4\u30f3\u30c8","text":""},{"location":"elixir/17-video-rental-system/#oop","title":"OOP \u3068\u306e\u6bd4\u8f03","text":"OOP \u30a2\u30d7\u30ed\u30fc\u30c1 \u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1 \u7d99\u627f\u306b\u3088\u308b\u4fa1\u683c\u30bf\u30a4\u30d7\u306e\u5b9f\u88c5 \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u306b\u3088\u308b\u5206\u5c90 \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u72b6\u614b\u3092\u6301\u3064 \u69cb\u9020\u4f53\u306f\u4e0d\u5909\u3001\u95a2\u6570\u3067\u5909\u63db Repository \u30af\u30e9\u30b9 Agent + \u7d14\u7c8b\u95a2\u6570 Statement \u30af\u30e9\u30b9\u306e\u30e1\u30bd\u30c3\u30c9 \u72ec\u7acb\u3057\u305f\u95a2\u6570\u7fa4"},{"location":"elixir/17-video-rental-system/#_5","title":"\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306b\u3088\u308b\u660e\u78ba\u306a\u51e6\u7406\u30d5\u30ed\u30fc","text":"<pre><code># \u9867\u5ba2\u306e\u660e\u7d30\u751f\u6210\ncustomer\n|&gt; Customer.add_rental(rental1)\n|&gt; Customer.add_rental(rental2)\n|&gt; Customer.statement()\n</code></pre>"},{"location":"elixir/17-video-rental-system/#_6","title":"\u5909\u63db\u306e\u5206\u96e2","text":"<pre><code># \u8a08\u7b97\u3068\u8868\u793a\u306e\u5206\u96e2\n{total, points, lines} = calculate_statement(rentals)  # \u7d14\u7c8b\u306a\u8a08\u7b97\nformat_statement(total, points, lines)                  # \u30d5\u30a9\u30fc\u30de\u30c3\u30c8\n</code></pre>"},{"location":"elixir/17-video-rental-system/#8","title":"8. \u30c6\u30b9\u30c8\u306e\u4f8b","text":"<pre><code>test \"regular movie pricing\" do\n  movie = Movie.regular(\"The Matrix\")\n  assert Pricing.calculate_amount(movie, 1) == 2.0\n  assert Pricing.calculate_amount(movie, 2) == 2.0\n  assert Pricing.calculate_amount(movie, 3) == 3.5\nend\n\ntest \"customer statement\" do\n  movie1 = Movie.regular(\"The Matrix\")\n  movie2 = Movie.new_release(\"Avatar 2\")\n\n  customer = Customer.new(\"John\")\n              |&gt; Customer.add_rental(Rental.new(movie1, 3))\n              |&gt; Customer.add_rental(Rental.new(movie2, 2))\n\n  statement = Customer.statement(customer)\n  assert String.contains?(statement, \"John\")\n  assert String.contains?(statement, \"The Matrix\")\n  assert String.contains?(statement, \"Avatar 2\")\nend\n</code></pre>"},{"location":"elixir/17-video-rental-system/#_7","title":"\u307e\u3068\u3081","text":"<p>\u30d3\u30c7\u30aa\u30ec\u30f3\u30bf\u30eb\u30b7\u30b9\u30c6\u30e0\u306f\u3001OOP \u306e\u30af\u30e9\u30b7\u30c3\u30af\u306a\u4f8b\u984c\u3092\u95a2\u6570\u578b\u3067\u66f8\u304d\u76f4\u3059\u3053\u3068\u3067\u3001\u4ee5\u4e0b\u306e\u6d1e\u5bdf\u3092\u5f97\u3089\u308c\u307e\u3059\uff1a</p> <ol> <li>\u7d99\u627f\u306a\u3057\u306e\u591a\u614b\u6027: \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3067\u4fa1\u683c\u30bf\u30a4\u30d7\u3054\u3068\u306e\u51e6\u7406\u3092\u5b9f\u73fe</li> <li>\u4e0d\u5909\u30c7\u30fc\u30bf: \u9867\u5ba2\u3084\u30ec\u30f3\u30bf\u30eb\u306f\u5909\u66f4\u3067\u306f\u306a\u304f\u65b0\u3057\u3044\u5024\u3092\u751f\u6210</li> <li>\u95a2\u6570\u306e\u5408\u6210: \u5c0f\u3055\u306a\u7d14\u7c8b\u95a2\u6570\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u8907\u96d1\u306a\u51e6\u7406\u3092\u69cb\u7bc9</li> <li>\u8cac\u52d9\u306e\u5206\u96e2: \u8a08\u7b97\u3001\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3001\u6c38\u7d9a\u5316\u304c\u660e\u78ba\u306b\u5206\u96e2</li> </ol> <p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u3088\u308a\u3001\u5143\u306e\u30b3\u30fc\u30c9\u3088\u308a\u3082\u30c6\u30b9\u30bf\u30d6\u30eb\u3067\u4fdd\u5b88\u3057\u3084\u3059\u3044\u8a2d\u8a08\u306b\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"elixir/18-concurrency-system/","title":"\u7b2c18\u7ae0: \u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0","text":""},{"location":"elixir/18-concurrency-system/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0\u306f\u3001Elixir \u306e\u5f37\u529b\u306a\u4e26\u884c\u51e6\u7406\u6a5f\u80fd\u3092\u6d3b\u7528\u3057\u3066\u3001\u30a4\u30d9\u30f3\u30c8\u99c6\u52d5\u3001\u72b6\u614b\u30de\u30b7\u30f3\u3001\u30e1\u30c3\u30bb\u30fc\u30b8\u30ad\u30e5\u30fc\u306a\u3069\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002OTP \u306e GenServer \u3068 Agent \u3092\u4f7f\u7528\u3057\u3066\u3001\u4fe1\u983c\u6027\u306e\u9ad8\u3044\u4e26\u884c\u51e6\u7406\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p>"},{"location":"elixir/18-concurrency-system/#1-eventbus","title":"1. \u30a4\u30d9\u30f3\u30c8\u30d0\u30b9 (EventBus)","text":""},{"location":"elixir/18-concurrency-system/#genserver","title":"GenServer \u30d9\u30fc\u30b9\u306e\u5b9f\u88c5","text":"<pre><code>defmodule EventBus do\n  use GenServer\n\n  # \u30af\u30e9\u30a4\u30a2\u30f3\u30c8 API\n  def start_link(opts \\\\ []) do\n    name = Keyword.get(opts, :name, __MODULE__)\n    GenServer.start_link(__MODULE__, %{}, name: name)\n  end\n\n  def subscribe(topic, handler, bus \\\\ __MODULE__) do\n    GenServer.call(bus, {:subscribe, topic, handler})\n  end\n\n  def unsubscribe(topic, handler_id, bus \\\\ __MODULE__) do\n    GenServer.call(bus, {:unsubscribe, topic, handler_id})\n  end\n\n  def publish(topic, message, bus \\\\ __MODULE__) do\n    GenServer.call(bus, {:publish, topic, message})\n  end\n\n  def publish_async(topic, message, bus \\\\ __MODULE__) do\n    GenServer.cast(bus, {:publish, topic, message})\n  end\n\n  # \u30b5\u30fc\u30d0\u30fc \u30b3\u30fc\u30eb\u30d0\u30c3\u30af\n  @impl true\n  def init(_opts) do\n    {:ok, %{subscriptions: %{}, next_id: 1}}\n  end\n\n  @impl true\n  def handle_call({:subscribe, topic, handler}, _from, state) do\n    id = state.next_id\n    subscriptions = Map.update(\n      state.subscriptions,\n      topic,\n      [{id, handler}],\n      fn handlers -&gt; [{id, handler} | handlers] end\n    )\n    {:reply, {:ok, id}, %{state | subscriptions: subscriptions, next_id: id + 1}}\n  end\n\n  @impl true\n  def handle_call({:publish, topic, message}, _from, state) do\n    handlers = Map.get(state.subscriptions, topic, [])\n    results = Enum.map(handlers, fn {_id, handler} -&gt;\n      try do\n        {:ok, handler.(message)}\n      rescue\n        e -&gt; {:error, e}\n      end\n    end)\n    {:reply, results, state}\n  end\n\n  @impl true\n  def handle_cast({:publish, topic, message}, state) do\n    handlers = Map.get(state.subscriptions, topic, [])\n    Enum.each(handlers, fn {_id, handler} -&gt;\n      Task.start(fn -&gt; handler.(message) end)\n    end)\n    {:noreply, state}\n  end\nend\n</code></pre>"},{"location":"elixir/18-concurrency-system/#_2","title":"\u4f7f\u7528\u4f8b","text":"<pre><code># \u30a4\u30d9\u30f3\u30c8\u30d0\u30b9\u306e\u8d77\u52d5\n{:ok, _pid} = EventBus.start_link()\n\n# \u30c8\u30d4\u30c3\u30af\u306b\u8cfc\u8aad\nEventBus.subscribe(:user_created, fn user -&gt;\n  IO.puts(\"User created: #{user.name}\")\nend)\n\n# \u30a4\u30d9\u30f3\u30c8\u3092\u767a\u884c\nEventBus.publish(:user_created, %{name: \"Alice\"})\n</code></pre>"},{"location":"elixir/18-concurrency-system/#2-statemachine","title":"2. \u72b6\u614b\u30de\u30b7\u30f3 (StateMachine)","text":""},{"location":"elixir/18-concurrency-system/#genserver_1","title":"GenServer \u306b\u3088\u308b\u5b9f\u88c5","text":"<pre><code>defmodule StateMachine do\n  use GenServer\n\n  defstruct [:state, :transitions, :log]\n\n  def start_link(initial_state, transitions, opts \\\\ []) do\n    name = Keyword.get(opts, :name, __MODULE__)\n    GenServer.start_link(__MODULE__, {initial_state, transitions}, name: name)\n  end\n\n  def current_state(machine \\\\ __MODULE__) do\n    GenServer.call(machine, :current_state)\n  end\n\n  def trigger(event, machine \\\\ __MODULE__) do\n    GenServer.call(machine, {:trigger, event})\n  end\n\n  def history(machine \\\\ __MODULE__) do\n    GenServer.call(machine, :history)\n  end\n\n  @impl true\n  def init({initial_state, transitions}) do\n    {:ok, %__MODULE__{\n      state: initial_state,\n      transitions: transitions,\n      log: [{:init, initial_state, DateTime.utc_now()}]\n    }}\n  end\n\n  @impl true\n  def handle_call(:current_state, _from, machine) do\n    {:reply, machine.state, machine}\n  end\n\n  @impl true\n  def handle_call({:trigger, event}, _from, machine) do\n    case get_transition(machine, event) do\n      nil -&gt;\n        {:reply, {:error, :invalid_transition}, machine}\n\n      {next_state, action} -&gt;\n        action &amp;&amp; action.()\n        log_entry = {event, next_state, DateTime.utc_now()}\n        updated = %{machine | state: next_state, log: [log_entry | machine.log]}\n        {:reply, {:ok, next_state}, updated}\n    end\n  end\n\n  defp get_transition(machine, event) do\n    machine.transitions\n    |&gt; Map.get(machine.state, %{})\n    |&gt; Map.get(event)\n  end\nend\n</code></pre>"},{"location":"elixir/18-concurrency-system/#_3","title":"\u96fb\u8a71\u30b7\u30b9\u30c6\u30e0\u306e\u4f8b","text":"<pre><code>defmodule PhoneSystem do\n  def create_transitions do\n    %{\n      :on_hook =&gt; %{\n        :lift_receiver =&gt; {:off_hook, nil}\n      },\n      :off_hook =&gt; %{\n        :dial =&gt; {:dialing, nil},\n        :hang_up =&gt; {:on_hook, nil}\n      },\n      :dialing =&gt; %{\n        :connected =&gt; {:connected, nil},\n        :busy =&gt; {:off_hook, fn -&gt; IO.puts(\"Busy tone\") end},\n        :hang_up =&gt; {:on_hook, nil}\n      },\n      :connected =&gt; %{\n        :hang_up =&gt; {:on_hook, nil},\n        :remote_hang_up =&gt; {:off_hook, nil}\n      }\n    }\n  end\n\n  def start_phone do\n    StateMachine.start_link(:on_hook, create_transitions(), name: :phone)\n  end\nend\n</code></pre>"},{"location":"elixir/18-concurrency-system/#3","title":"3. \u30e1\u30c3\u30bb\u30fc\u30b8\u30ad\u30e5\u30fc","text":""},{"location":"elixir/18-concurrency-system/#genserver_2","title":"GenServer \u306b\u3088\u308b\u5b9f\u88c5","text":"<pre><code>defmodule MessageQueue do\n  use GenServer\n\n  def start_link(opts \\\\ []) do\n    name = Keyword.get(opts, :name, __MODULE__)\n    GenServer.start_link(__MODULE__, :queue.new(), name: name)\n  end\n\n  def enqueue(message, queue \\\\ __MODULE__) do\n    GenServer.call(queue, {:enqueue, message})\n  end\n\n  def dequeue(queue \\\\ __MODULE__) do\n    GenServer.call(queue, :dequeue)\n  end\n\n  def peek(queue \\\\ __MODULE__) do\n    GenServer.call(queue, :peek)\n  end\n\n  def size(queue \\\\ __MODULE__) do\n    GenServer.call(queue, :size)\n  end\n\n  @impl true\n  def init(queue) do\n    {:ok, queue}\n  end\n\n  @impl true\n  def handle_call({:enqueue, message}, _from, queue) do\n    {:reply, :ok, :queue.in(message, queue)}\n  end\n\n  @impl true\n  def handle_call(:dequeue, _from, queue) do\n    case :queue.out(queue) do\n      {{:value, item}, new_queue} -&gt; {:reply, {:ok, item}, new_queue}\n      {:empty, _} -&gt; {:reply, {:error, :empty}, queue}\n    end\n  end\n\n  @impl true\n  def handle_call(:peek, _from, queue) do\n    case :queue.peek(queue) do\n      {:value, item} -&gt; {:reply, {:ok, item}, queue}\n      :empty -&gt; {:reply, {:error, :empty}, queue}\n    end\n  end\n\n  @impl true\n  def handle_call(:size, _from, queue) do\n    {:reply, :queue.len(queue), queue}\n  end\nend\n</code></pre>"},{"location":"elixir/18-concurrency-system/#4","title":"4. \u30ef\u30fc\u30ab\u30fc\u30d7\u30fc\u30eb","text":""},{"location":"elixir/18-concurrency-system/#_4","title":"\u4e26\u884c\u30bf\u30b9\u30af\u51e6\u7406","text":"<pre><code>defmodule WorkerPool do\n  use GenServer\n\n  def start_link(worker_count, opts \\\\ []) do\n    name = Keyword.get(opts, :name, __MODULE__)\n    GenServer.start_link(__MODULE__, worker_count, name: name)\n  end\n\n  def submit(task, pool \\\\ __MODULE__) do\n    GenServer.call(pool, {:submit, task})\n  end\n\n  def submit_async(task, pool \\\\ __MODULE__) do\n    GenServer.cast(pool, {:submit, task})\n  end\n\n  def stats(pool \\\\ __MODULE__) do\n    GenServer.call(pool, :stats)\n  end\n\n  @impl true\n  def init(worker_count) do\n    {:ok, %{\n      workers: worker_count,\n      active: 0,\n      completed: 0,\n      pending: :queue.new()\n    }}\n  end\n\n  @impl true\n  def handle_call({:submit, task}, from, state) do\n    if state.active &lt; state.workers do\n      spawn_worker(task, from, self())\n      {:noreply, %{state | active: state.active + 1}}\n    else\n      pending = :queue.in({task, from}, state.pending)\n      {:noreply, %{state | pending: pending}}\n    end\n  end\n\n  @impl true\n  def handle_info({:task_complete, result, from}, state) do\n    GenServer.reply(from, result)\n\n    case :queue.out(state.pending) do\n      {{:value, {task, pending_from}}, new_pending} -&gt;\n        spawn_worker(task, pending_from, self())\n        {:noreply, %{state | pending: new_pending, completed: state.completed + 1}}\n\n      {:empty, _} -&gt;\n        {:noreply, %{state | active: state.active - 1, completed: state.completed + 1}}\n    end\n  end\n\n  defp spawn_worker(task, from, pool_pid) do\n    Task.start(fn -&gt;\n      result = task.()\n      send(pool_pid, {:task_complete, result, from})\n    end)\n  end\nend\n</code></pre>"},{"location":"elixir/18-concurrency-system/#_5","title":"\u4f7f\u7528\u4f8b","text":"<pre><code># \u30d7\u30fc\u30eb\u3092\u8d77\u52d5\uff083\u30ef\u30fc\u30ab\u30fc\uff09\n{:ok, _} = WorkerPool.start_link(3)\n\n# \u30bf\u30b9\u30af\u3092\u6295\u5165\nresults = Enum.map(1..10, fn i -&gt;\n  WorkerPool.submit(fn -&gt;\n    Process.sleep(100)\n    i * 2\n  end)\nend)\n\n# \u7d50\u679c: [2, 4, 6, 8, 10, 12, 14, 16, 18, 20]\n</code></pre>"},{"location":"elixir/18-concurrency-system/#5-agent","title":"5. \u30ab\u30a6\u30f3\u30bf\u30fc (Agent)","text":""},{"location":"elixir/18-concurrency-system/#_6","title":"\u30b7\u30f3\u30d7\u30eb\u306a\u72b6\u614b\u7ba1\u7406","text":"<pre><code>defmodule Counter do\n  use Agent\n\n  def start_link(initial \\\\ 0, opts \\\\ []) do\n    name = Keyword.get(opts, :name, __MODULE__)\n    Agent.start_link(fn -&gt; initial end, name: name)\n  end\n\n  def value(counter \\\\ __MODULE__) do\n    Agent.get(counter, &amp; &amp;1)\n  end\n\n  def increment(counter \\\\ __MODULE__) do\n    Agent.update(counter, &amp;(&amp;1 + 1))\n  end\n\n  def increment_by(amount, counter \\\\ __MODULE__) do\n    Agent.update(counter, &amp;(&amp;1 + amount))\n  end\n\n  def decrement(counter \\\\ __MODULE__) do\n    Agent.update(counter, &amp;(&amp;1 - 1))\n  end\n\n  def reset(counter \\\\ __MODULE__) do\n    Agent.update(counter, fn _ -&gt; 0 end)\n  end\nend\n</code></pre>"},{"location":"elixir/18-concurrency-system/#6","title":"6. \u5b89\u5168\u306a\u505c\u6b62\u51e6\u7406","text":""},{"location":"elixir/18-concurrency-system/#processalive","title":"Process.alive? \u306b\u3088\u308b\u30c1\u30a7\u30c3\u30af","text":"<p>\u4e26\u884c\u30d7\u30ed\u30bb\u30b9\u3092\u505c\u6b62\u3059\u308b\u969b\u306f\u3001\u30d7\u30ed\u30bb\u30b9\u304c\u751f\u304d\u3066\u3044\u308b\u304b\u78ba\u8a8d\u304c\u5fc5\u8981\u3067\u3059\uff1a</p> <pre><code>def stop(pid) do\n  if Process.alive?(pid) do\n    GenServer.stop(pid)\n  end\nend\n\n# Agent \u306e\u5834\u5408\ndef stop_counter(counter \\\\ __MODULE__) do\n  pid = case counter do\n    name when is_atom(name) -&gt; Process.whereis(name)\n    pid when is_pid(pid) -&gt; pid\n  end\n\n  if pid &amp;&amp; Process.alive?(pid) do\n    Agent.stop(pid)\n  end\nend\n</code></pre>"},{"location":"elixir/18-concurrency-system/#_7","title":"\u30c6\u30b9\u30c8\u3067\u306e\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7","text":"<pre><code>setup do\n  {:ok, pid} = EventBus.start_link(name: :test_bus)\n  on_exit(fn -&gt;\n    if Process.alive?(pid), do: GenServer.stop(pid)\n  end)\n  %{bus: pid}\nend\n</code></pre>"},{"location":"elixir/18-concurrency-system/#7","title":"7. \u30d1\u30bf\u30fc\u30f3\u306e\u6bd4\u8f03","text":""},{"location":"elixir/18-concurrency-system/#genserver-vs-agent","title":"GenServer vs Agent","text":"GenServer Agent \u8907\u96d1\u306a\u72b6\u614b\u7ba1\u7406 \u30b7\u30f3\u30d7\u30eb\u306a\u72b6\u614b\u7ba1\u7406 \u975e\u540c\u671f\u30e1\u30c3\u30bb\u30fc\u30b8\u51e6\u7406 \u540c\u671f\u7684\u306a\u66f4\u65b0 \u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3001\u7d99\u7d9a\u306a\u3069 \u72b6\u614b\u306e\u53d6\u5f97\u30fb\u66f4\u65b0\u306e\u307f \u30b3\u30fc\u30eb\u30d0\u30c3\u30af\u95a2\u6570\u3092\u5b9f\u88c5 \u533f\u540d\u95a2\u6570\u3067\u64cd\u4f5c"},{"location":"elixir/18-concurrency-system/#_8","title":"\u4f7f\u3044\u5206\u3051\u306e\u6307\u91dd","text":"<ul> <li>Agent: \u5358\u7d14\u306a\u30ad\u30fc\u5024\u30b9\u30c8\u30a2\u3001\u30ab\u30a6\u30f3\u30bf\u30fc\u3001\u30ad\u30e3\u30c3\u30b7\u30e5</li> <li>GenServer: \u30a4\u30d9\u30f3\u30c8\u51e6\u7406\u3001\u72b6\u614b\u30de\u30b7\u30f3\u3001\u30d7\u30ed\u30c8\u30b3\u30eb\u5b9f\u88c5</li> </ul>"},{"location":"elixir/18-concurrency-system/#8","title":"8. \u30c6\u30b9\u30c8\u306e\u4f8b","text":"<pre><code>test \"EventBus publish and subscribe\" do\n  {:ok, _} = EventBus.start_link(name: :test_bus)\n\n  messages = Agent.start_link(fn -&gt; [] end) |&gt; elem(1)\n\n  EventBus.subscribe(:test, fn msg -&gt;\n    Agent.update(messages, &amp;[msg | &amp;1])\n  end, :test_bus)\n\n  EventBus.publish(:test, \"hello\", :test_bus)\n  EventBus.publish(:test, \"world\", :test_bus)\n\n  assert Agent.get(messages, &amp; &amp;1) == [\"world\", \"hello\"]\nend\n\ntest \"StateMachine transitions\" do\n  transitions = %{\n    :idle =&gt; %{start: {:running, nil}},\n    :running =&gt; %{stop: {:idle, nil}}\n  }\n\n  {:ok, _} = StateMachine.start_link(:idle, transitions, name: :test_sm)\n\n  assert StateMachine.current_state(:test_sm) == :idle\n  assert StateMachine.trigger(:start, :test_sm) == {:ok, :running}\n  assert StateMachine.current_state(:test_sm) == :running\nend\n</code></pre>"},{"location":"elixir/18-concurrency-system/#_9","title":"\u307e\u3068\u3081","text":"<p>Elixir \u306e\u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0\u306f\u3001OTP \u306e\u62bd\u8c61\u5316\u306b\u3088\u3063\u3066\u4ee5\u4e0b\u3092\u5b9f\u73fe\u3057\u307e\u3059\uff1a</p> <ol> <li>\u4fe1\u983c\u6027: GenServer \u306e\u30b9\u30fc\u30d1\u30fc\u30d3\u30b8\u30e7\u30f3\u30c4\u30ea\u30fc\u306b\u3088\u308b\u969c\u5bb3\u5fa9\u65e7</li> <li>\u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3: \u8efd\u91cf\u30d7\u30ed\u30bb\u30b9\u306b\u3088\u308b\u5927\u91cf\u306e\u4e26\u884c\u51e6\u7406</li> <li>\u660e\u78ba\u306a\u30d7\u30ed\u30c8\u30b3\u30eb: call/cast \u306b\u3088\u308b\u540c\u671f/\u975e\u540c\u671f\u306e\u660e\u793a\u7684\u306a\u533a\u5225</li> <li>\u30c6\u30b9\u30bf\u30d3\u30ea\u30c6\u30a3: \u540d\u524d\u4ed8\u304d\u30d7\u30ed\u30bb\u30b9\u306b\u3088\u308b\u30c6\u30b9\u30c8\u5bb9\u6613\u6027</li> </ol> <p>\u3053\u308c\u3089\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u3053\u3068\u3067\u3001\u8907\u96d1\u306a\u4e26\u884c\u30b7\u30b9\u30c6\u30e0\u3092\u5b89\u5168\u306b\u69cb\u7bc9\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"elixir/19-wator-simulation/","title":"\u7b2c19\u7ae0: Wa-Tor \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3","text":""},{"location":"elixir/19-wator-simulation/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Wa-Tor \u306f\u3001A.K. Dewdney \u304c Scientific American \u8a8c\u3067\u7d39\u4ecb\u3057\u305f\u751f\u614b\u7cfb\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3067\u3059\u3002\u30c8\u30fc\u30e9\u30b9\u72b6\u306e\u6c34\u754c\u3067\u9b5a\u3068\u30b5\u30e1\u304c\u76f8\u4e92\u4f5c\u7528\u3057\u3001\u6355\u98df\u3068\u7e41\u6b96\u306e\u52d5\u7684\u306a\u30d0\u30e9\u30f3\u30b9\u3092\u89b3\u5bdf\u3067\u304d\u307e\u3059\u3002\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u72b6\u614b\u306e\u9032\u5316\u3092\u30e2\u30c7\u30eb\u5316\u3059\u308b\u512a\u308c\u305f\u984c\u6750\u3067\u3059\u3002</p>"},{"location":"elixir/19-wator-simulation/#1","title":"1. \u8a2d\u5b9a\u3068\u69cb\u9020\u4f53","text":""},{"location":"elixir/19-wator-simulation/#config","title":"Config \u30e2\u30b8\u30e5\u30fc\u30eb","text":"<pre><code>defmodule Config do\n  @doc \"\u9b5a\u306e\u7e41\u6b96\u5e74\u9f62\"\n  def fish_reproduction_age, do: 3\n\n  @doc \"\u30b5\u30e1\u306e\u7e41\u6b96\u5e74\u9f62\"\n  def shark_reproduction_age, do: 8\n\n  @doc \"\u30b5\u30e1\u306e\u7e41\u6b96\u306b\u5fc5\u8981\u306a\u4f53\u529b\"\n  def shark_reproduction_health, do: 4\n\n  @doc \"\u30b5\u30e1\u306e\u521d\u671f\u4f53\u529b\"\n  def shark_starting_health, do: 5\n\n  @doc \"\u30b5\u30e1\u306e\u6700\u5927\u4f53\u529b\"\n  def shark_max_health, do: 10\n\n  @doc \"\u30b5\u30e1\u304c\u9b5a\u3092\u98df\u3079\u305f\u6642\u306e\u4f53\u529b\u56de\u5fa9\"\n  def shark_eating_health, do: 3\nend\n</code></pre>"},{"location":"elixir/19-wator-simulation/#cell","title":"Cell \u30e2\u30b8\u30e5\u30fc\u30eb","text":"<pre><code>defmodule Cell do\n  @doc \"\u6c34\uff08\u7a7a\u30bb\u30eb\uff09\"\n  def water, do: nil\n\n  def is_water?(nil), do: true\n  def is_water?(_), do: false\n\n  def display(nil), do: \"~\"\n  def display(%{type: :fish}), do: \"f\"\n  def display(%{type: :shark}), do: \"S\"\nend\n</code></pre>"},{"location":"elixir/19-wator-simulation/#fish","title":"Fish \u69cb\u9020\u4f53","text":"<pre><code>defmodule Fish do\n  def new do\n    %{type: :fish, age: 0}\n  end\n\n  def is?(%{type: :fish}), do: true\n  def is?(_), do: false\n\n  def increment_age(fish) do\n    %{fish | age: fish.age + 1}\n  end\n\n  def can_reproduce?(fish) do\n    fish.age &gt;= Config.fish_reproduction_age()\n  end\n\n  def reproduce(fish) do\n    if can_reproduce?(fish) do\n      parent = %{fish | age: 0}\n      child = new()\n      {parent, child}\n    else\n      nil\n    end\n  end\nend\n</code></pre>"},{"location":"elixir/19-wator-simulation/#shark","title":"Shark \u69cb\u9020\u4f53","text":"<pre><code>defmodule Shark do\n  def new do\n    %{type: :shark, age: 0, health: Config.shark_starting_health()}\n  end\n\n  def is?(%{type: :shark}), do: true\n  def is?(_), do: false\n\n  def increment_age(shark) do\n    %{shark | age: shark.age + 1}\n  end\n\n  def decrement_health(shark) do\n    %{shark | health: shark.health - 1}\n  end\n\n  def feed(shark) do\n    new_health = min(Config.shark_max_health(), shark.health + Config.shark_eating_health())\n    %{shark | health: new_health}\n  end\n\n  def is_alive?(shark) do\n    shark.health &gt; 0\n  end\n\n  def can_reproduce?(shark) do\n    shark.age &gt;= Config.shark_reproduction_age() and\n      shark.health &gt;= Config.shark_reproduction_health()\n  end\n\n  def reproduce(shark) do\n    if can_reproduce?(shark) do\n      half_health = div(shark.health, 2)\n      parent = %{shark | age: 0, health: half_health}\n      child = %{new() | health: half_health}\n      {parent, child}\n    else\n      nil\n    end\n  end\nend\n</code></pre>"},{"location":"elixir/19-wator-simulation/#2","title":"2. \u30ef\u30fc\u30eb\u30c9","text":""},{"location":"elixir/19-wator-simulation/#_2","title":"\u30c8\u30fc\u30e9\u30b9\u72b6\u306e\u4e16\u754c","text":"<pre><code>defmodule World do\n  defstruct [:width, :height, :cells]\n\n  def new(width, height) do\n    %__MODULE__{width: width, height: height, cells: %{}}\n  end\n\n  @doc \"\u30c8\u30fc\u30e9\u30b9\u5ea7\u6a19\u306e\u6b63\u898f\u5316\"\n  def normalize(%__MODULE__{width: w, height: h}, {x, y}) do\n    {rem(rem(x, w) + w, w), rem(rem(y, h) + h, h)}\n  end\n\n  @doc \"\u30bb\u30eb\u306e\u53d6\u5f97\"\n  def get_cell(world, loc) do\n    normalized = normalize(world, loc)\n    Map.get(world.cells, normalized)\n  end\n\n  @doc \"\u30bb\u30eb\u306e\u8a2d\u5b9a\"\n  def set_cell(world, loc, cell) do\n    normalized = normalize(world, loc)\n    if cell == nil do\n      %{world | cells: Map.delete(world.cells, normalized)}\n    else\n      %{world | cells: Map.put(world.cells, normalized, cell)}\n    end\n  end\n\n  @doc \"\u9b5a\u3092\u914d\u7f6e\"\n  def set_fish(world, loc) do\n    set_cell(world, loc, Fish.new())\n  end\n\n  @doc \"\u30b5\u30e1\u3092\u914d\u7f6e\"\n  def set_shark(world, loc) do\n    set_cell(world, loc, Shark.new())\n  end\nend\n</code></pre>"},{"location":"elixir/19-wator-simulation/#_3","title":"\u96a3\u63a5\u30bb\u30eb\u306e\u53d6\u5f97","text":"<pre><code>@doc \"\u30d5\u30a9\u30f3\u30fb\u30ce\u30a4\u30de\u30f3\u8fd1\u508d\uff08\u4e0a\u4e0b\u5de6\u53f3\uff09\"\ndef neighbors(world, {x, y}) do\n  [{x, y - 1}, {x + 1, y}, {x, y + 1}, {x - 1, y}]\n  |&gt; Enum.map(&amp;normalize(world, &amp;1))\nend\n</code></pre>"},{"location":"elixir/19-wator-simulation/#_4","title":"\u7d71\u8a08\u60c5\u5831","text":"<pre><code>def count_fish(world) do\n  world.cells\n  |&gt; Map.values()\n  |&gt; Enum.count(&amp;Fish.is?/1)\nend\n\ndef count_sharks(world) do\n  world.cells\n  |&gt; Map.values()\n  |&gt; Enum.count(&amp;Shark.is?/1)\nend\n\ndef statistics(world) do\n  %{\n    fish: count_fish(world),\n    sharks: count_sharks(world),\n    total: map_size(world.cells)\n  }\nend\n</code></pre>"},{"location":"elixir/19-wator-simulation/#_5","title":"\u30ef\u30fc\u30eb\u30c9\u306e\u8868\u793a","text":"<pre><code>def display(%__MODULE__{width: w, height: h} = world) do\n  rows = for y &lt;- 0..(h - 1) do\n    row = for x &lt;- 0..(w - 1) do\n      Cell.display(get_cell(world, {x, y}))\n    end\n    Enum.join(row, \"\")\n  end\n  Enum.join(rows, \"\\n\")\nend\n</code></pre> <p>\u51fa\u529b\u4f8b\uff1a <pre><code>~~~~~\n~f~~~\n~~S~~\n~f~~~\n~~~~~\n</code></pre></p>"},{"location":"elixir/19-wator-simulation/#3","title":"3. \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3","text":""},{"location":"elixir/19-wator-simulation/#tick","title":"tick \u95a2\u6570","text":"<pre><code>defmodule Simulation do\n  @doc \"1\u30b9\u30c6\u30c3\u30d7\u5b9f\u884c\"\n  def tick(world) do\n    # \u5168\u30bb\u30eb\u3092\u30b7\u30e3\u30c3\u30d5\u30eb\u3057\u3066\u51e6\u7406\uff08\u9806\u5e8f\u306e\u30d0\u30a4\u30a2\u30b9\u3092\u907f\u3051\u308b\uff09\n    locs = Enum.shuffle(Map.keys(world.cells))\n\n    Enum.reduce(locs, world, fn loc, acc_world -&gt;\n      tick_cell(acc_world, loc)\n    end)\n  end\n\n  defp tick_cell(world, loc) do\n    cell = World.get_cell(world, loc)\n\n    cond do\n      Fish.is?(cell) -&gt; tick_fish(world, loc, cell)\n      Shark.is?(cell) -&gt; tick_shark(world, loc, cell)\n      true -&gt; world\n    end\n  end\nend\n</code></pre>"},{"location":"elixir/19-wator-simulation/#_6","title":"\u9b5a\u306e\u66f4\u65b0","text":"<pre><code>defp tick_fish(world, loc, fish) do\n  aged_fish = Fish.increment_age(fish)\n\n  # \u7e41\u6b96\u3092\u8a66\u307f\u308b\n  case Fish.reproduce(aged_fish) do\n    {parent, child} -&gt;\n      case find_empty_neighbor(world, loc) do\n        nil -&gt; World.set_cell(world, loc, aged_fish)\n        empty_loc -&gt;\n          world\n          |&gt; World.set_cell(loc, parent)\n          |&gt; World.set_cell(empty_loc, child)\n      end\n\n    nil -&gt;\n      # \u79fb\u52d5\u3092\u8a66\u307f\u308b\n      case find_empty_neighbor(world, loc) do\n        nil -&gt; World.set_cell(world, loc, aged_fish)\n        empty_loc -&gt;\n          world\n          |&gt; World.set_cell(loc, Cell.water())\n          |&gt; World.set_cell(empty_loc, aged_fish)\n      end\n  end\nend\n</code></pre>"},{"location":"elixir/19-wator-simulation/#_7","title":"\u30b5\u30e1\u306e\u66f4\u65b0","text":"<pre><code>defp tick_shark(world, loc, shark) do\n  # \u4f53\u529b\u30c1\u30a7\u30c3\u30af - \u65e2\u306b\u6b7b\u3093\u3067\u3044\u308b\u5834\u5408\u306f\u6c34\u306b\n  if not Shark.is_alive?(shark) do\n    World.set_cell(world, loc, Cell.water())\n  else\n    aged_shark = shark |&gt; Shark.increment_age() |&gt; Shark.decrement_health()\n\n    # \u4f53\u529b\u304c\u5c3d\u304d\u305f\u3089\u6b7b\u4ea1\n    if not Shark.is_alive?(aged_shark) do\n      World.set_cell(world, loc, Cell.water())\n    else\n      # \u6355\u98df\u3092\u8a66\u307f\u308b\n      case find_fish_neighbor(world, loc) do\n        nil -&gt;\n          # \u9b5a\u304c\u3044\u306a\u3044\u5834\u5408\u3001\u7e41\u6b96\u307e\u305f\u306f\u79fb\u52d5\n          handle_shark_movement(world, loc, aged_shark)\n\n        fish_loc -&gt;\n          fed_shark = Shark.feed(aged_shark)\n          world\n          |&gt; World.set_cell(loc, Cell.water())\n          |&gt; World.set_cell(fish_loc, fed_shark)\n      end\n    end\n  end\nend\n</code></pre>"},{"location":"elixir/19-wator-simulation/#_8","title":"\u8907\u6570\u30b9\u30c6\u30c3\u30d7\u306e\u5b9f\u884c","text":"<pre><code>@doc \"\u8907\u6570\u30b9\u30c6\u30c3\u30d7\u5b9f\u884c\"\ndef run(world, steps) do\n  Enum.reduce(1..steps, world, fn _, acc -&gt; tick(acc) end)\nend\n\n@doc \"\u5c65\u6b74\u4ed8\u304d\u3067\u5b9f\u884c\"\ndef run_with_history(world, steps) do\n  {history, _final} =\n    Enum.reduce(1..steps, {[world], world}, fn _, {hist, w} -&gt;\n      next = tick(w)\n      {[next | hist], next}\n    end)\n\n  Enum.reverse(history)\nend\n\n@doc \"\u7d71\u8a08\u5c65\u6b74\u4ed8\u304d\u3067\u5b9f\u884c\"\ndef run_with_stats(world, steps) do\n  {stats, final} =\n    Enum.reduce(0..steps, {[], world}, fn step, {acc_stats, w} -&gt;\n      stat = Map.put(World.statistics(w), :step, step)\n      if step == steps do\n        {[stat | acc_stats], w}\n      else\n        next = tick(w)\n        {[stat | acc_stats], next}\n      end\n    end)\n\n  %{\n    final_world: final,\n    statistics: Enum.reverse(stats)\n  }\nend\n</code></pre>"},{"location":"elixir/19-wator-simulation/#4","title":"4. \u30d8\u30eb\u30d1\u30fc\u95a2\u6570","text":""},{"location":"elixir/19-wator-simulation/#_9","title":"\u96a3\u63a5\u30bb\u30eb\u306e\u691c\u7d22","text":"<pre><code># \u7a7a\u306e\u96a3\u63a5\u30bb\u30eb\u3092\u63a2\u3059\ndefp find_empty_neighbor(world, loc) do\n  world\n  |&gt; World.neighbors(loc)\n  |&gt; Enum.filter(fn neighbor_loc -&gt;\n    Cell.is_water?(World.get_cell(world, neighbor_loc))\n  end)\n  |&gt; case do\n    [] -&gt; nil\n    neighbors -&gt; Enum.random(neighbors)\n  end\nend\n\n# \u9b5a\u304c\u3044\u308b\u96a3\u63a5\u30bb\u30eb\u3092\u63a2\u3059\ndefp find_fish_neighbor(world, loc) do\n  world\n  |&gt; World.neighbors(loc)\n  |&gt; Enum.filter(fn neighbor_loc -&gt;\n    Fish.is?(World.get_cell(world, neighbor_loc))\n  end)\n  |&gt; case do\n    [] -&gt; nil\n    neighbors -&gt; Enum.random(neighbors)\n  end\nend\n</code></pre>"},{"location":"elixir/19-wator-simulation/#5","title":"5. \u30b5\u30f3\u30d7\u30eb\u30b7\u30ca\u30ea\u30aa","text":""},{"location":"elixir/19-wator-simulation/#examples","title":"Examples \u30e2\u30b8\u30e5\u30fc\u30eb","text":"<pre><code>defmodule Examples do\n  @doc \"\u5c0f\u3055\u306a\u4e16\u754c\u306e\u4f8b\"\n  def small_world do\n    World.new(10, 10)\n    |&gt; World.set_fish({2, 2})\n    |&gt; World.set_fish({3, 3})\n    |&gt; World.set_fish({5, 5})\n    |&gt; World.set_shark({7, 7})\n  end\n\n  @doc \"\u4e2d\u304f\u3089\u3044\u306e\u4e16\u754c\"\n  def medium_world do\n    world = World.new(20, 20)\n\n    # \u9b5a\u3092\u6563\u308a\u3070\u3081\u308b\n    fish_positions = for _ &lt;- 1..30, do: {:rand.uniform(20) - 1, :rand.uniform(20) - 1}\n    shark_positions = for _ &lt;- 1..5, do: {:rand.uniform(20) - 1, :rand.uniform(20) - 1}\n\n    world\n    |&gt; populate(fish_positions, &amp;World.set_fish/2)\n    |&gt; populate(shark_positions, &amp;World.set_shark/2)\n  end\n\n  defp populate(world, positions, setter) do\n    Enum.reduce(positions, world, fn pos, acc -&gt;\n      setter.(acc, pos)\n    end)\n  end\n\n  @doc \"\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u5b9f\u884c\u3057\u3066\u7d50\u679c\u3092\u8868\u793a\"\n  def run_demo(steps \\\\ 100) do\n    result = small_world()\n             |&gt; Simulation.run_with_stats(steps)\n\n    IO.puts(\"Final world:\")\n    IO.puts(World.display(result.final_world))\n    IO.puts(\"\\nPopulation over time:\")\n\n    result.statistics\n    |&gt; Enum.each(fn stat -&gt;\n      IO.puts(\"Step #{stat.step}: Fish=#{stat.fish}, Sharks=#{stat.sharks}\")\n    end)\n\n    result\n  end\nend\n</code></pre>"},{"location":"elixir/19-wator-simulation/#6","title":"6. \u30c6\u30b9\u30c8\u306e\u4f8b","text":"<pre><code>test \"fish reproduces at correct age\" do\n  fish = %{Fish.new() | age: Config.fish_reproduction_age()}\n  world = World.new(3, 3)\n          |&gt; World.set_cell({1, 1}, fish)\n\n  final = Simulation.tick(world)\n  assert World.count_fish(final) == 2\nend\n\ntest \"shark dies without food\" do\n  shark = %{Shark.new() | health: 2}\n  world = World.new(5, 5)\n          |&gt; World.set_cell({2, 2}, shark)\n\n  # Run until shark starves (health goes 2 -&gt; 1 -&gt; 0)\n  final = Simulation.run(world, 3)\n  assert World.count_sharks(final) == 0\nend\n\ntest \"shark eats fish and gains health\" do\n  world = World.new(3, 3)\n          |&gt; World.set_shark({1, 1})\n          |&gt; World.set_fish({1, 0})\n\n  final = Simulation.tick(world)\n\n  # Either fish was eaten or shark moved elsewhere\n  stats = World.statistics(final)\n  assert stats.sharks == 1\n  assert stats.fish &lt;= 1\nend\n\ntest \"toroidal world wraps correctly\" do\n  world = World.new(5, 5)\n\n  assert World.normalize(world, {-1, 0}) == {4, 0}\n  assert World.normalize(world, {0, -1}) == {0, 4}\n  assert World.normalize(world, {5, 5}) == {0, 0}\nend\n</code></pre>"},{"location":"elixir/19-wator-simulation/#7","title":"7. \u95a2\u6570\u578b\u8a2d\u8a08\u306e\u30dd\u30a4\u30f3\u30c8","text":""},{"location":"elixir/19-wator-simulation/#_10","title":"\u4e0d\u5909\u30c7\u30fc\u30bf\u3068\u7d14\u7c8b\u95a2\u6570","text":"\u5074\u9762 \u8aac\u660e \u4e0d\u5909\u306eWorld \u5404 tick \u306f\u65b0\u3057\u3044 World \u3092\u8fd4\u3059 \u7d14\u7c8b\u306a\u72b6\u614b\u9077\u79fb <code>tick(world)</code> \u306f\u540c\u3058\u5165\u529b\u306b\u5bfe\u3057\u3066\uff08\u4e71\u6570\u3092\u9664\u304d\uff09\u540c\u3058\u51fa\u529b \u660e\u793a\u7684\u306a\u72b6\u614b \u526f\u4f5c\u7528\u306a\u3057\u3067\u72b6\u614b\u306e\u5909\u5316\u3092\u8ffd\u8de1\u53ef\u80fd"},{"location":"elixir/19-wator-simulation/#reduce","title":"reduce \u306b\u3088\u308b\u72b6\u614b\u306e\u9032\u5316","text":"<pre><code># \u5404\u30bb\u30eb\u3092\u9806\u756a\u306b\u51e6\u7406\u3057\u3001\u7d2f\u7a4d\u7684\u306b\u30ef\u30fc\u30eb\u30c9\u3092\u66f4\u65b0\nEnum.reduce(locations, world, fn loc, acc_world -&gt;\n  tick_cell(acc_world, loc)\nend)\n</code></pre>"},{"location":"elixir/19-wator-simulation/#_11","title":"\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u306b\u3088\u308b\u5206\u5c90","text":"<pre><code>cond do\n  Fish.is?(cell) -&gt; tick_fish(world, loc, cell)\n  Shark.is?(cell) -&gt; tick_shark(world, loc, cell)\n  true -&gt; world  # \u6c34\u306e\u5834\u5408\u306f\u5909\u66f4\u306a\u3057\nend\n</code></pre>"},{"location":"elixir/19-wator-simulation/#_12","title":"\u307e\u3068\u3081","text":"<p>Wa-Tor \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u5f37\u307f\u3092\u793a\u3059\u512a\u308c\u305f\u4f8b\u3067\u3059\uff1a</p> <ol> <li>\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020: World \u306e\u5404\u72b6\u614b\u306f\u72ec\u7acb\u3057\u3066\u304a\u308a\u3001\u5c65\u6b74\u306e\u4fdd\u5b58\u304c\u5bb9\u6613</li> <li>\u7d14\u7c8b\u95a2\u6570: tick \u95a2\u6570\u306f\uff08\u4e71\u6570\u3092\u9664\u304d\uff09\u53c2\u7167\u900f\u904e\u7684</li> <li>\u660e\u793a\u7684\u306a\u72b6\u614b\u9077\u79fb: \u72b6\u614b\u5909\u5316\u304c\u8ffd\u8de1\u53ef\u80fd\u3067\u3001\u30c7\u30d0\u30c3\u30b0\u3057\u3084\u3059\u3044</li> <li>\u30e2\u30b8\u30e5\u30e9\u30fc\u8a2d\u8a08: Fish\u3001Shark\u3001World\u3001Simulation \u304c\u660e\u78ba\u306b\u5206\u96e2</li> </ol> <p>\u3053\u306e\u8a2d\u8a08\u306b\u3088\u308a\u3001\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u306e\u6b63\u78ba\u6027\u3092\u78ba\u8a8d\u3057\u3084\u3059\u304f\u3001\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u8abf\u6574\u3084\u65b0\u3057\u3044\u30eb\u30fc\u30eb\u306e\u8ffd\u52a0\u304c\u5bb9\u6613\u306b\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"elixir/20-pattern-interactions/","title":"\u7b2c20\u7ae0: \u30d1\u30bf\u30fc\u30f3\u9593\u306e\u76f8\u4e92\u4f5c\u7528","text":""},{"location":"elixir/20-pattern-interactions/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u95a2\u6570\u578b\u8a2d\u8a08\u30d1\u30bf\u30fc\u30f3\u306f\u5358\u72ec\u3067\u4f7f\u7528\u3059\u308b\u3088\u308a\u3082\u3001\u7d44\u307f\u5408\u308f\u305b\u308b\u3053\u3068\u3067\u3088\u308a\u5f37\u529b\u306b\u306a\u308a\u307e\u3059\u3002\u3053\u306e\u7ae0\u3067\u306f\u3001\u8907\u6570\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u7d71\u5408\u3057\u3066\u8907\u96d1\u306a\u554f\u984c\u3092\u89e3\u6c7a\u3059\u308b\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"elixir/20-pattern-interactions/#1-visitor-iterator","title":"1. Visitor + Iterator \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"elixir/20-pattern-interactions/#_2","title":"\u6728\u69cb\u9020\u306e\u8d70\u67fb\u3068\u51e6\u7406","text":"<pre><code>defmodule TreeNode do\n  defstruct [:value, :left, :right]\n\n  def leaf(value), do: %__MODULE__{value: value}\n  def node(value, left, right), do: %__MODULE__{value: value, left: left, right: right}\nend\n\n# \u30a4\u30c6\u30ec\u30fc\u30bf: \u8d70\u67fb\u6226\u7565\ndefmodule Iterator do\n  def preorder(nil), do: []\n  def preorder(%TreeNode{value: v, left: l, right: r}) do\n    [v | preorder(l) ++ preorder(r)]\n  end\n\n  def inorder(nil), do: []\n  def inorder(%TreeNode{value: v, left: l, right: r}) do\n    inorder(l) ++ [v] ++ inorder(r)\n  end\nend\n\n# \u30d3\u30b8\u30bf\u30fc: \u8981\u7d20\u3078\u306e\u64cd\u4f5c\ndefmodule Visitor do\n  def sum(values), do: Enum.sum(values)\n  def max(values), do: Enum.max(values)\n  def map(values, func), do: Enum.map(values, func)\nend\n</code></pre>"},{"location":"elixir/20-pattern-interactions/#_3","title":"\u7d44\u307f\u5408\u308f\u305b\u3066\u4f7f\u7528","text":"<pre><code>def traverse_and_visit(tree, iterator_fn, visitor_fn) do\n  tree\n  |&gt; iterator_fn.()\n  |&gt; visitor_fn.()\nend\n\n# \u4f7f\u7528\u4f8b\ntree\n|&gt; traverse_and_visit(&amp;Iterator.inorder/1, &amp;Visitor.sum/1)\n</code></pre>"},{"location":"elixir/20-pattern-interactions/#2-strategy-factory","title":"2. Strategy + Factory \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"elixir/20-pattern-interactions/#_4","title":"\u52d5\u7684\u306a\u6226\u7565\u751f\u6210","text":"<pre><code>defmodule DiscountFactory do\n  def create(:regular), do: &amp;regular_discount/1\n  def create(:premium), do: &amp;premium_discount/1\n  def create(:vip), do: &amp;vip_discount/1\n  def create({:seasonal, rate}), do: fn price -&gt; price * (1 - rate) end\n  def create({:combined, strategies}) do\n    fn price -&gt;\n      Enum.reduce(strategies, price, fn s, acc -&gt; create(s).(acc) end)\n    end\n  end\n\n  defp regular_discount(price), do: price\n  defp premium_discount(price), do: price * 0.9\n  defp vip_discount(price), do: price * 0.8\nend\n\n# \u4f7f\u7528\u4f8b\nstrategy = DiscountFactory.create({:combined, [:premium, {:seasonal, 0.1}]})\nfinal_price = strategy.(100.0)  # 81.0\n</code></pre>"},{"location":"elixir/20-pattern-interactions/#3-observer-state","title":"3. Observer + State \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"elixir/20-pattern-interactions/#_5","title":"\u72b6\u614b\u5909\u5316\u306e\u901a\u77e5","text":"<pre><code>defmodule OrderStateMachine do\n  use GenServer\n\n  @transitions %{\n    pending: [:confirmed, :cancelled],\n    confirmed: [:shipped, :cancelled],\n    shipped: [:delivered]\n  }\n\n  def transition(pid, new_state) do\n    GenServer.call(pid, {:transition, new_state})\n  end\n\n  @impl true\n  def handle_call({:transition, new_state}, _from, state) do\n    allowed = Map.get(@transitions, state.current, [])\n\n    if new_state in allowed do\n      # \u30aa\u30d6\u30b6\u30fc\u30d0\u30fc\u306b\u901a\u77e5\n      notify_observers(state.observers, %{\n        old_state: state.current,\n        new_state: new_state\n      })\n      {:reply, {:ok, new_state}, %{state | current: new_state}}\n    else\n      {:reply, {:error, :invalid_transition}, state}\n    end\n  end\n\n  defp notify_observers(observers, event) do\n    Enum.each(observers, fn {_id, handler} -&gt; handler.(event) end)\n  end\nend\n</code></pre>"},{"location":"elixir/20-pattern-interactions/#4-decorator-pipeline","title":"4. Decorator + Pipeline \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"elixir/20-pattern-interactions/#_6","title":"\u51e6\u7406\u306e\u52d5\u7684\u62e1\u5f35","text":"<pre><code>defmodule DecoratorPipeline do\n  def with_logging(func, label) do\n    fn input -&gt;\n      IO.puts(\"[#{label}] Input: #{inspect(input)}\")\n      result = func.(input)\n      IO.puts(\"[#{label}] Output: #{inspect(result)}\")\n      result\n    end\n  end\n\n  def with_timing(func) do\n    fn input -&gt;\n      start = System.monotonic_time(:microsecond)\n      result = func.(input)\n      elapsed = System.monotonic_time(:microsecond) - start\n      {result, elapsed}\n    end\n  end\n\n  def with_error_handling(func, default \\\\ nil) do\n    fn input -&gt;\n      try do\n        {:ok, func.(input)}\n      rescue\n        e -&gt; {:error, e, default}\n      end\n    end\n  end\nend\n\n# \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u30d3\u30eb\u30c0\u30fc\ndefmodule PipelineBuilder do\n  defstruct steps: []\n\n  def new, do: %__MODULE__{}\n\n  def add_step(builder, step) do\n    %{builder | steps: builder.steps ++ [step]}\n  end\n\n  def build(builder, base_func) do\n    Enum.reduce(builder.steps, base_func, fn decorator, func -&gt;\n      decorator.(func)\n    end)\n  end\nend\n</code></pre>"},{"location":"elixir/20-pattern-interactions/#5-composite-visitor","title":"5. Composite + Visitor \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"elixir/20-pattern-interactions/#_7","title":"\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306e\u4f8b","text":"<pre><code>defmodule FileSystem do\n  defmodule File do\n    defstruct [:name, :size]\n  end\n\n  defmodule Directory do\n    defstruct [:name, children: []]\n  end\n\n  # \u30d3\u30b8\u30bf\u30fc: \u5408\u8a08\u30b5\u30a4\u30ba\n  def total_size(%File{size: size}), do: size\n  def total_size(%Directory{children: children}) do\n    children |&gt; Enum.map(&amp;total_size/1) |&gt; Enum.sum()\n  end\n\n  # \u30d3\u30b8\u30bf\u30fc: \u30d5\u30a1\u30a4\u30eb\u6570\n  def file_count(%File{}), do: 1\n  def file_count(%Directory{children: children}) do\n    children |&gt; Enum.map(&amp;file_count/1) |&gt; Enum.sum()\n  end\n\n  # \u30d3\u30b8\u30bf\u30fc: \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u3067\u30d5\u30a1\u30a4\u30eb\u691c\u7d22\n  def find_files(%File{name: name} = file, pattern) do\n    if String.match?(name, pattern), do: [file], else: []\n  end\n  def find_files(%Directory{children: children}, pattern) do\n    children |&gt; Enum.flat_map(&amp;find_files(&amp;1, pattern))\n  end\nend\n</code></pre>"},{"location":"elixir/20-pattern-interactions/#_8","title":"\u5f0f\u306e\u8a55\u4fa1","text":"<pre><code>defmodule Expression do\n  defmodule Number do\n    defstruct [:value]\n  end\n\n  defmodule BinaryOp do\n    defstruct [:op, :left, :right]\n  end\n\n  # \u8a55\u4fa1\u30d3\u30b8\u30bf\u30fc\n  def evaluate(%Number{value: v}), do: v\n  def evaluate(%BinaryOp{op: :add, left: l, right: r}) do\n    evaluate(l) + evaluate(r)\n  end\n  def evaluate(%BinaryOp{op: :mul, left: l, right: r}) do\n    evaluate(l) * evaluate(r)\n  end\n\n  # \u6587\u5b57\u5217\u5316\u30d3\u30b8\u30bf\u30fc\n  def stringify(%Number{value: v}), do: \"#{v}\"\n  def stringify(%BinaryOp{op: op, left: l, right: r}) do\n    \"(#{stringify(l)} #{op_symbol(op)} #{stringify(r)})\"\n  end\n\n  defp op_symbol(:add), do: \"+\"\n  defp op_symbol(:mul), do: \"*\"\nend\n</code></pre>"},{"location":"elixir/20-pattern-interactions/#6","title":"6. \u7d71\u5408\u4f8b: \u6ce8\u6587\u51e6\u7406\u30b7\u30b9\u30c6\u30e0","text":"<pre><code>defmodule OrderProcessor do\n  alias DiscountFactory\n  alias ValidatorFactory\n\n  defstruct [:customer_type, :items, :validators]\n\n  def new(customer_type) do\n    %__MODULE__{customer_type: customer_type, items: [], validators: []}\n  end\n\n  def add_item(processor, name, price) do\n    %{processor | items: [{name, price} | processor.items]}\n  end\n\n  def add_validator(processor, validator_type) do\n    %{processor | validators: [validator_type | processor.validators]}\n  end\n\n  def calculate_total(processor) do\n    strategy = DiscountFactory.create(processor.customer_type)\n    processor.items\n    |&gt; Enum.map(fn {_name, price} -&gt; strategy.(price) end)\n    |&gt; Enum.sum()\n  end\n\n  def process(processor) do\n    # \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3067\u51e6\u7406\n    PipelineBuilder.new()\n    |&gt; PipelineBuilder.add_error_handling(0.0)\n    |&gt; PipelineBuilder.execute(fn _ -&gt; calculate_total(processor) end, processor)\n  end\nend\n</code></pre>"},{"location":"elixir/20-pattern-interactions/#_9","title":"\u307e\u3068\u3081","text":"<p>\u30d1\u30bf\u30fc\u30f3\u306e\u7d44\u307f\u5408\u308f\u305b\u306b\u3088\u308a\u3001\u4ee5\u4e0b\u304c\u5b9f\u73fe\u3067\u304d\u307e\u3059\uff1a</p> <ol> <li>\u67d4\u8edf\u6027: \u7570\u306a\u308b\u8d70\u67fb\u6226\u7565\u3068\u51e6\u7406\u3092\u7d44\u307f\u5408\u308f\u305b</li> <li>\u518d\u5229\u7528\u6027: \u5171\u901a\u306e\u30d3\u30eb\u30c7\u30a3\u30f3\u30b0\u30d6\u30ed\u30c3\u30af\u3092\u69d8\u3005\u306a\u6587\u8108\u3067\u4f7f\u7528</li> <li>\u62e1\u5f35\u6027: \u30c7\u30b3\u30ec\u30fc\u30bf\u3067\u65e2\u5b58\u306e\u51e6\u7406\u3092\u62e1\u5f35</li> <li>\u578b\u5b89\u5168\u6027: \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u306b\u3088\u308b\u5805\u7262\u306a\u51e6\u7406\u5206\u5c90</li> </ol> <p>\u30d1\u30bf\u30fc\u30f3\u3092\u5358\u72ec\u3067\u7406\u89e3\u3057\u305f\u5f8c\u306f\u3001\u7d44\u307f\u5408\u308f\u305b\u3066\u4f7f\u3046\u7df4\u7fd2\u304c\u91cd\u8981\u3067\u3059\u3002</p>"},{"location":"elixir/21-best-practices/","title":"\u7b2c21\u7ae0: \u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9","text":""},{"location":"elixir/21-best-practices/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3092\u5b9f\u8df5\u7684\u306a\u4f8b\u3068\u3068\u3082\u306b\u89e3\u8aac\u3057\u307e\u3059\u3002\u826f\u3044\u30b3\u30fc\u30c9\u3068\u6539\u5584\u304c\u5fc5\u8981\u306a\u30b3\u30fc\u30c9\u3092\u6bd4\u8f03\u3057\u306a\u304c\u3089\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"elixir/21-best-practices/#1","title":"1. \u4e0d\u5909\u6027\u3068\u7d14\u7c8b\u95a2\u6570","text":""},{"location":"elixir/21-best-practices/#_2","title":"\u60aa\u3044\u4f8b: \u5916\u90e8\u72b6\u614b\u3078\u306e\u4f9d\u5b58","text":"<pre><code># \u274c \u7d14\u7c8b\u95a2\u6570\u3067\u306f\u306a\u3044\ndef get_current_time_greeting do\n  hour = DateTime.utc_now().hour\n  cond do\n    hour &lt; 12 -&gt; \"Good morning\"\n    hour &lt; 18 -&gt; \"Good afternoon\"\n    true -&gt; \"Good evening\"\n  end\nend\n</code></pre>"},{"location":"elixir/21-best-practices/#_3","title":"\u826f\u3044\u4f8b: \u4f9d\u5b58\u6027\u306e\u6ce8\u5165","text":"<pre><code># \u2705 \u7d14\u7c8b\u95a2\u6570\ndef greeting_for_hour(hour) when hour &gt;= 0 and hour &lt; 24 do\n  cond do\n    hour &lt; 12 -&gt; \"Good morning\"\n    hour &lt; 18 -&gt; \"Good afternoon\"\n    true -&gt; \"Good evening\"\n  end\nend\n\n# \u4e0d\u7d14\u306a\u30e9\u30c3\u30d1\u30fc\ndef current_greeting do\n  greeting_for_hour(DateTime.utc_now().hour)\nend\n</code></pre>"},{"location":"elixir/21-best-practices/#_4","title":"\u4e0d\u5909\u30c7\u30fc\u30bf\u306e\u64cd\u4f5c","text":"<pre><code># \u30de\u30c3\u30d7\u306e\u5b89\u5168\u306a\u66f4\u65b0\ndef update_user(user, updates) do\n  Map.merge(user, updates)\nend\n\n# \u30cd\u30b9\u30c8\u3057\u305f\u30c7\u30fc\u30bf\u306e\u66f4\u65b0\ndef update_nested(data, path, func) do\n  update_in(data, path, func)\nend\n\n# \u30ea\u30b9\u30c8\u3078\u306e\u8ffd\u52a0\uff08\u5148\u982d\u304c\u52b9\u7387\u7684\uff09\ndef prepend(list, item), do: [item | list]\n</code></pre>"},{"location":"elixir/21-best-practices/#2","title":"2. \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3068\u95a2\u6570\u5408\u6210","text":""},{"location":"elixir/21-best-practices/#_5","title":"\u60aa\u3044\u4f8b: \u30cd\u30b9\u30c8\u3057\u305f\u95a2\u6570\u547c\u3073\u51fa\u3057","text":"<pre><code># \u274c \u8aad\u307f\u306b\u304f\u3044\ndef process(data) do\n  Enum.join(\n    Enum.map(\n      Enum.filter(\n        String.split(data, \",\"),\n        fn s -&gt; String.length(String.trim(s)) &gt; 0 end\n      ),\n      &amp;String.upcase(String.trim(&amp;1))\n    ),\n    \" | \"\n  )\nend\n</code></pre>"},{"location":"elixir/21-best-practices/#_6","title":"\u826f\u3044\u4f8b: \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3","text":"<pre><code># \u2705 \u8aad\u307f\u3084\u3059\u3044\ndef process(data) do\n  data\n  |&gt; String.split(\",\")\n  |&gt; Enum.map(&amp;String.trim/1)\n  |&gt; Enum.filter(&amp;(String.length(&amp;1) &gt; 0))\n  |&gt; Enum.map(&amp;String.upcase/1)\n  |&gt; Enum.join(\" | \")\nend\n</code></pre>"},{"location":"elixir/21-best-practices/#_7","title":"\u95a2\u6570\u5408\u6210","text":"<pre><code># \u8907\u6570\u306e\u95a2\u6570\u3092\u5408\u6210\ndef pipe_compose(functions) do\n  fn x -&gt;\n    Enum.reduce(functions, x, fn f, acc -&gt; f.(acc) end)\n  end\nend\n\n# \u4f7f\u7528\u4f8b\npipeline = pipe_compose([\n  fn x -&gt; x + 1 end,\n  fn x -&gt; x * 2 end\n])\npipeline.(5)  # =&gt; 12\n</code></pre>"},{"location":"elixir/21-best-practices/#3","title":"3. \u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0","text":""},{"location":"elixir/21-best-practices/#_8","title":"\u30bf\u30b0\u4ed8\u304d\u30bf\u30d7\u30eb","text":"<pre><code># \u6210\u529f/\u5931\u6557\u3092\u660e\u793a\u7684\u306b\u8fd4\u3059\ndef divide(a, b) when b != 0, do: {:ok, a / b}\ndef divide(_a, 0), do: {:error, :division_by_zero}\n\n# nil\u306e\u4ee3\u308f\u308a\u306b\u30bf\u30b0\u4ed8\u304d\u30bf\u30d7\u30eb\ndef find_user(users, id) do\n  case Enum.find(users, &amp;(&amp;1.id == id)) do\n    nil -&gt; {:error, :not_found}\n    user -&gt; {:ok, user}\n  end\nend\n</code></pre>"},{"location":"elixir/21-best-practices/#with","title":"with\u69cb\u6587","text":"<pre><code>def process_order(order_id, user_id, users, orders) do\n  with {:ok, user} &lt;- find_user(users, user_id),\n       {:ok, order} &lt;- find_order(orders, order_id),\n       :ok &lt;- validate_owner(user, order) do\n    {:ok, %{user: user, order: order}}\n  end\nend\n</code></pre>"},{"location":"elixir/21-best-practices/#railway-oriented-programming","title":"Railway Oriented Programming","text":"<pre><code>defmodule Railway do\n  def bind({:ok, value}, func), do: func.(value)\n  def bind({:error, _} = error, _func), do: error\n\n  def pipeline(value, functions) do\n    Enum.reduce(functions, {:ok, value}, fn func, acc -&gt;\n      bind(acc, func)\n    end)\n  end\nend\n</code></pre>"},{"location":"elixir/21-best-practices/#4","title":"4. \u30c6\u30b9\u30bf\u30d3\u30ea\u30c6\u30a3","text":""},{"location":"elixir/21-best-practices/#_9","title":"\u4f9d\u5b58\u6027\u6ce8\u5165","text":"<pre><code># HTTP\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u6ce8\u5165\u53ef\u80fd\u306b\ndef fetch_user(user_id, http_client \\\\ &amp;default_http_client/1) do\n  case http_client.(\"https://api.example.com/users/#{user_id}\") do\n    {:ok, body} -&gt; {:ok, parse_json(body)}\n    {:error, _} = error -&gt; error\n  end\nend\n\n# \u6642\u8a08\u3092\u6ce8\u5165\u53ef\u80fd\u306b\ndef is_weekend?(clock \\\\ &amp;DateTime.utc_now/0) do\n  day = clock.() |&gt; Date.day_of_week()\n  day in [6, 7]\nend\n\n# \u30c6\u30b9\u30c8\u3067\u306e\u4f7f\u7528\ntest \"is_weekend? with mock clock\" do\n  saturday = fn -&gt; ~D[2024-01-06] end\n  assert is_weekend?(saturday)\nend\n</code></pre>"},{"location":"elixir/21-best-practices/#_10","title":"\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u5411\u3051\u306e\u8a2d\u8a08","text":"<pre><code># \u9006\u6f14\u7b97\u304c\u5b58\u5728\u3059\u308b\u95a2\u6570\ndef encode(string), do: Base.encode64(string)\ndef decode(encoded), do: Base.decode64!(encoded)\n\n# \u51aa\u7b49\u306a\u95a2\u6570\ndef normalize_email(email) do\n  email |&gt; String.downcase() |&gt; String.trim()\nend\n</code></pre>"},{"location":"elixir/21-best-practices/#5","title":"5. \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u6700\u9069\u5316","text":""},{"location":"elixir/21-best-practices/#_11","title":"\u9045\u5ef6\u8a55\u4fa1","text":"<pre><code># \u5927\u304d\u306a\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306b\u306fStream\u3092\u4f7f\u7528\ndef process_large_file(path) do\n  File.stream!(path)\n  |&gt; Stream.map(&amp;String.trim/1)\n  |&gt; Stream.filter(&amp;(String.length(&amp;1) &gt; 0))\n  |&gt; Enum.take(100)\nend\n\n# \u7121\u9650\u30b9\u30c8\u30ea\u30fc\u30e0\ndef fibonacci_stream do\n  Stream.unfold({0, 1}, fn {a, b} -&gt; {a, {b, a + b}} end)\nend\n</code></pre>"},{"location":"elixir/21-best-practices/#_12","title":"\u672b\u5c3e\u518d\u5e30","text":"<pre><code># \u274c \u672b\u5c3e\u518d\u5e30\u3067\u306a\u3044\ndef sum_bad([]), do: 0\ndef sum_bad([h | t]), do: h + sum_bad(t)\n\n# \u2705 \u672b\u5c3e\u518d\u5e30\ndef sum_good(list), do: do_sum(list, 0)\ndefp do_sum([], acc), do: acc\ndefp do_sum([h | t], acc), do: do_sum(t, acc + h)\n</code></pre>"},{"location":"elixir/21-best-practices/#_13","title":"\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u9078\u629e","text":"<pre><code># O(1)\u306e\u30e1\u30f3\u30d0\u30fc\u30b7\u30c3\u30d7\u691c\u67fb\u306b\u306fMapSet\u3092\u4f7f\u7528\ndef member_check_efficient(items, item) do\n  set = MapSet.new(items)\n  MapSet.member?(set, item)\nend\n\n# \u30ad\u30fc\u306b\u3088\u308b\u9ad8\u901f\u30eb\u30c3\u30af\u30a2\u30c3\u30d7\u306b\u306fMap\u3092\u4f7f\u7528\ndef build_index(items, key_fn) do\n  Map.new(items, fn item -&gt; {key_fn.(item), item} end)\nend\n</code></pre>"},{"location":"elixir/21-best-practices/#6","title":"6. \u30b3\u30fc\u30c9\u69cb\u6210","text":""},{"location":"elixir/21-best-practices/#_14","title":"\u5c0f\u3055\u306a\u95a2\u6570","text":"<pre><code>def validate_email(email) do\n  email\n  |&gt; check_format()\n  |&gt; check_domain()\n  |&gt; check_length()\nend\n\ndefp check_format({:error, _} = error), do: error\ndefp check_format(email) do\n  if String.match?(email, ~r/^[\\w.+-]+@[\\w.-]+\\.\\w+$/) do\n    email\n  else\n    {:error, :invalid_format}\n  end\nend\n</code></pre>"},{"location":"elixir/21-best-practices/#_15","title":"\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u8cac\u52d9\u5206\u96e2","text":"<pre><code># \u30c7\u30fc\u30bf\u5b9a\u7fa9\ndefmodule User do\n  defstruct [:id, :name, :email, :role]\nend\n\n# \u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\ndefmodule UserService do\n  def can_access?(user, resource) do\n    user.role in allowed_roles(resource)\n  end\nend\n\n# \u30d5\u30a9\u30fc\u30de\u30c3\u30c8\ndefmodule UserFormatter do\n  def to_display_name(%User{name: name}), do: name\nend\n</code></pre>"},{"location":"elixir/21-best-practices/#7","title":"7. \u5b9f\u8df5\u7684\u306a\u30d1\u30bf\u30fc\u30f3","text":""},{"location":"elixir/21-best-practices/#_16","title":"\u30aa\u30d7\u30b7\u30e7\u30f3\u30d1\u30bf\u30fc\u30f3","text":"<pre><code>@default_options [timeout: 5000, retries: 3]\n\ndef fetch_data(url, opts \\\\ []) do\n  opts = Keyword.merge(@default_options, opts)\n  # ...\nend\n</code></pre>"},{"location":"elixir/21-best-practices/#_17","title":"\u30d3\u30eb\u30c0\u30fc\u30d1\u30bf\u30fc\u30f3","text":"<pre><code>defmodule Builder do\n  defstruct fields: %{}, validations: []\n\n  def new, do: %__MODULE__{}\n  def set(b, key, value), do: %{b | fields: Map.put(b.fields, key, value)}\n  def build(b), do: {:ok, b.fields}\nend\n</code></pre>"},{"location":"elixir/21-best-practices/#_18","title":"\u30e1\u30e2\u5316","text":"<pre><code>defmodule Memoization do\n  use Agent\n\n  def memoize(key, func) do\n    case Agent.get(__MODULE__, &amp;Map.get(&amp;1, key)) do\n      nil -&gt;\n        result = func.()\n        Agent.update(__MODULE__, &amp;Map.put(&amp;1, key, result))\n        result\n      cached -&gt;\n        cached\n    end\n  end\nend\n</code></pre>"},{"location":"elixir/21-best-practices/#_19","title":"\u307e\u3068\u3081","text":"\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9 \u76ee\u7684 \u7d14\u7c8b\u95a2\u6570 \u30c6\u30b9\u30bf\u30d3\u30ea\u30c6\u30a3\u3001\u4e88\u6e2c\u53ef\u80fd\u6027 \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3 \u53ef\u8aad\u6027\u3001\u30c7\u30fc\u30bf\u30d5\u30ed\u30fc\u660e\u78ba\u5316 \u30bf\u30b0\u4ed8\u304d\u30bf\u30d7\u30eb \u660e\u793a\u7684\u306a\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0 \u4f9d\u5b58\u6027\u6ce8\u5165 \u30c6\u30b9\u30c8\u5bb9\u6613\u6027 \u9045\u5ef6\u8a55\u4fa1 \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9 \u672b\u5c3e\u518d\u5e30 \u30e1\u30e2\u30ea\u52b9\u7387 \u5c0f\u3055\u306a\u95a2\u6570 \u4fdd\u5b88\u6027\u3001\u518d\u5229\u7528\u6027 <p>\u3053\u308c\u3089\u306e\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3092\u610f\u8b58\u3059\u308b\u3053\u3068\u3067\u3001\u3088\u308a\u5805\u7262\u3067\u4fdd\u5b88\u3057\u3084\u3059\u3044 Elixir \u30b3\u30fc\u30c9\u304c\u66f8\u3051\u307e\u3059\u3002</p>"},{"location":"elixir/22-oo-to-fp-migration/","title":"\u7b2c22\u7ae0: OO \u304b\u3089 FP \u3078\u306e\u79fb\u884c","text":""},{"location":"elixir/22-oo-to-fp-migration/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\uff08OOP\uff09\u304b\u3089\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\uff08FP\uff09\u3078\u306e\u79fb\u884c\u30d1\u30bf\u30fc\u30f3\u3092\u89e3\u8aac\u3057\u307e\u3059\u3002\u65e2\u5b58\u306e OOP \u6982\u5ff5\u3092 Elixir \u3067\u3069\u306e\u3088\u3046\u306b\u8868\u73fe\u3059\u308b\u304b\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"elixir/22-oo-to-fp-migration/#1","title":"1. \u30af\u30e9\u30b9\u304b\u3089\u30e2\u30b8\u30e5\u30fc\u30eb\u3078","text":""},{"location":"elixir/22-oo-to-fp-migration/#oop","title":"OOP \u306e\u30af\u30e9\u30b9","text":"<pre><code># Python \u3067\u306e\u5b9f\u88c5\nclass BankAccount:\n    def __init__(self, owner, balance=0):\n        self.owner = owner\n        self.balance = balance\n\n    def deposit(self, amount):\n        self.balance += amount\n\n    def withdraw(self, amount):\n        if amount &lt;= self.balance:\n            self.balance -= amount\n            return True\n        return False\n</code></pre>"},{"location":"elixir/22-oo-to-fp-migration/#elixir","title":"Elixir \u3067\u306e\u5b9f\u88c5","text":"<pre><code>defmodule BankAccount do\n  defstruct [:owner, balance: 0]\n\n  def new(owner, balance \\\\ 0) do\n    %__MODULE__{owner: owner, balance: balance}\n  end\n\n  def deposit(account, amount) when amount &gt; 0 do\n    %{account | balance: account.balance + amount}\n  end\n\n  def withdraw(account, amount) when amount &gt; 0 do\n    if amount &lt;= account.balance do\n      {:ok, %{account | balance: account.balance - amount}}\n    else\n      {:error, :insufficient_funds}\n    end\n  end\nend\n</code></pre>"},{"location":"elixir/22-oo-to-fp-migration/#_2","title":"\u4e3b\u306a\u9055\u3044","text":"OOP FP (Elixir) \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u5909\u66f4 \u65b0\u3057\u3044\u5024\u3092\u8fd4\u3059 <code>self.balance += amount</code> <code>%{account | balance: ...}</code> <code>return True/False</code> <code>{:ok, ...}</code> / <code>{:error, ...}</code>"},{"location":"elixir/22-oo-to-fp-migration/#2","title":"2. \u7d99\u627f\u304b\u3089\u30b3\u30f3\u30dd\u30b8\u30b7\u30e7\u30f3\u3078","text":""},{"location":"elixir/22-oo-to-fp-migration/#oop_1","title":"OOP \u306e\u7d99\u627f","text":"<pre><code>class Animal:\n    def speak(self): pass\n\nclass Dog(Animal):\n    def speak(self): return \"Woof!\"\n\nclass Cat(Animal):\n    def speak(self): return \"Meow!\"\n</code></pre>"},{"location":"elixir/22-oo-to-fp-migration/#elixir_1","title":"Elixir \u306e\u30d7\u30ed\u30c8\u30b3\u30eb","text":"<pre><code>defprotocol Speakable do\n  def speak(animal)\nend\n\ndefmodule Dog do\n  defstruct [:name]\nend\n\ndefmodule Cat do\n  defstruct [:name]\nend\n\ndefimpl Speakable, for: Dog do\n  def speak(_dog), do: \"Woof!\"\nend\n\ndefimpl Speakable, for: Cat do\n  def speak(_cat), do: \"Meow!\"\nend\n</code></pre>"},{"location":"elixir/22-oo-to-fp-migration/#_3","title":"\u30d3\u30d8\u30a4\u30d3\u30a2\u306b\u3088\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9","text":"<pre><code>defmodule Serializable do\n  @callback to_json(term()) :: String.t()\n  @callback from_json(String.t()) :: {:ok, term()} | {:error, term()}\nend\n\ndefmodule User do\n  @behaviour Serializable\n\n  @impl true\n  def to_json(%__MODULE__{id: id, name: name}) do\n    ~s({\"id\":#{id},\"name\":\"#{name}\"})\n  end\n\n  @impl true\n  def from_json(json) do\n    # \u30d1\u30fc\u30b9\u51e6\u7406\n  end\nend\n</code></pre>"},{"location":"elixir/22-oo-to-fp-migration/#_4","title":"\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30e1\u30bd\u30c3\u30c9\u306e\u4ee3\u66ff: \u9ad8\u968e\u95a2\u6570","text":"<pre><code>defmodule DataProcessor do\n  def process(data, opts \\\\ []) do\n    parser = Keyword.get(opts, :parser, &amp;default_parse/1)\n    validator = Keyword.get(opts, :validator, &amp;default_validate/1)\n\n    data\n    |&gt; parser.()\n    |&gt; validator.()\n  end\nend\n</code></pre>"},{"location":"elixir/22-oo-to-fp-migration/#3","title":"3. \u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u72b6\u614b\u304b\u3089\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u5909\u63db\u3078","text":""},{"location":"elixir/22-oo-to-fp-migration/#oop_2","title":"OOP \u306e\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u72b6\u614b","text":"<pre><code>class ShoppingCart:\n    def __init__(self):\n        self.items = []\n\n    def add_item(self, item):\n        self.items.append(item)\n\n    def total(self):\n        return sum(i.price for i in self.items)\n</code></pre>"},{"location":"elixir/22-oo-to-fp-migration/#elixir_2","title":"Elixir \u306e\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb","text":"<pre><code>defmodule ShoppingCart do\n  defstruct items: []\n\n  def new, do: %__MODULE__{}\n\n  def add_item(cart, item) do\n    %{cart | items: [item | cart.items]}\n  end\n\n  def total(cart) do\n    cart.items\n    |&gt; Enum.map(&amp;(&amp;1.price * &amp;1.quantity))\n    |&gt; Enum.sum()\n  end\nend\n</code></pre>"},{"location":"elixir/22-oo-to-fp-migration/#_5","title":"\u72b6\u614b\u9077\u79fb\u30d1\u30bf\u30fc\u30f3","text":"<pre><code>defmodule OrderState do\n  def transition(%{status: :pending} = order, :confirm) do\n    {:ok, Map.put(order, :status, :confirmed)}\n  end\n\n  def transition(%{status: :confirmed} = order, :ship) do\n    {:ok, Map.put(order, :status, :shipped)}\n  end\n\n  def transition(%{status: status}, action) do\n    {:error, {:invalid_transition, status, action}}\n  end\nend\n</code></pre>"},{"location":"elixir/22-oo-to-fp-migration/#_6","title":"\u30a4\u30d9\u30f3\u30c8\u30bd\u30fc\u30b7\u30f3\u30b0","text":"<pre><code>defmodule Account do\n  defstruct [:id, :balance, :events]\n\n  def apply_event(account, {:deposited, amount, timestamp}) do\n    %{account |\n      balance: account.balance + amount,\n      events: [{:deposited, amount, timestamp} | account.events]\n    }\n  end\n\n  def deposit(account, amount) when amount &gt; 0 do\n    event = {:deposited, amount, DateTime.utc_now()}\n    {:ok, apply_event(account, event)}\n  end\n\n  def replay(account, events) do\n    Enum.reduce(events, account, &amp;apply_event(&amp;2, &amp;1))\n  end\nend\n</code></pre>"},{"location":"elixir/22-oo-to-fp-migration/#4","title":"4. \u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u306e\u5909\u63db","text":""},{"location":"elixir/22-oo-to-fp-migration/#strategy","title":"Strategy \u2192 \u9ad8\u968e\u95a2\u6570","text":"<pre><code># OOP: Strategy\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3068\u5b9f\u88c5\u30af\u30e9\u30b9\n# FP: \u95a2\u6570\u3092\u76f4\u63a5\u6e21\u3059\ndef sort(items, comparator \\\\ &amp;&lt;=/2) do\n  Enum.sort(items, comparator)\nend\n\n# \u4e8b\u524d\u5b9a\u7fa9\u3055\u308c\u305f\u6226\u7565\ndef by_name, do: fn a, b -&gt; a.name &lt;= b.name end\ndef by_price, do: fn a, b -&gt; a.price &lt;= b.price end\n</code></pre>"},{"location":"elixir/22-oo-to-fp-migration/#observer","title":"Observer \u2192 \u30e1\u30c3\u30bb\u30fc\u30b8\u30d1\u30c3\u30b7\u30f3\u30b0","text":"<pre><code>defmodule EventNotifier do\n  use GenServer\n\n  def subscribe(pid, subscriber) do\n    GenServer.call(pid, {:subscribe, subscriber})\n  end\n\n  def notify(pid, event) do\n    GenServer.cast(pid, {:notify, event})\n  end\n\n  @impl true\n  def handle_cast({:notify, event}, state) do\n    Enum.each(state.subscribers, fn {_id, sub} -&gt;\n      send(sub, {:event, event})\n    end)\n    {:noreply, state}\n  end\nend\n</code></pre>"},{"location":"elixir/22-oo-to-fp-migration/#decorator","title":"Decorator \u2192 \u95a2\u6570\u5408\u6210","text":"<pre><code>def log(message), do: \"[LOG] #{message}\"\n\ndef with_timestamp(log_fn) do\n  fn message -&gt;\n    timestamp = DateTime.utc_now() |&gt; DateTime.to_string()\n    log_fn.(\"[#{timestamp}] #{message}\")\n  end\nend\n\ndef with_level(log_fn, level) do\n  fn message -&gt;\n    log_fn.(\"[#{level}] #{message}\")\n  end\nend\n\n# \u5408\u6210\nlogger = (&amp;log/1) |&gt; with_timestamp() |&gt; with_level(:info)\n</code></pre>"},{"location":"elixir/22-oo-to-fp-migration/#command","title":"Command \u2192 \u30c7\u30fc\u30bf","text":"<pre><code>def execute({:create_user, name, email}) do\n  {:ok, %{id: generate_id(), name: name, email: email}}\nend\n\ndef execute({:delete_user, id}) do\n  {:ok, {:deleted, id}}\nend\n\n# \u30d0\u30c3\u30c1\u5b9f\u884c\ndef execute_batch(commands) do\n  Enum.map(commands, &amp;execute/1)\nend\n</code></pre>"},{"location":"elixir/22-oo-to-fp-migration/#visitor","title":"Visitor \u2192 \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1","text":"<pre><code># \u5f0f\u306e\u8a55\u4fa1\ndef eval({:number, n}), do: n\ndef eval({:add, a, b}), do: eval(a) + eval(b)\ndef eval({:mul, a, b}), do: eval(a) * eval(b)\n\n# \u5f0f\u306e\u6700\u9069\u5316\ndef optimize({:add, {:number, 0}, b}), do: optimize(b)\ndef optimize({:mul, {:number, 1}, b}), do: optimize(b)\ndef optimize({:mul, {:number, 0}, _}), do: {:number, 0}\ndef optimize(expr), do: expr\n</code></pre>"},{"location":"elixir/22-oo-to-fp-migration/#5","title":"5. \u5b9f\u8df5\u7684\u306a\u79fb\u884c\u4f8b","text":""},{"location":"elixir/22-oo-to-fp-migration/#_7","title":"\u30e6\u30fc\u30b6\u30fc\u7ba1\u7406\u30b7\u30b9\u30c6\u30e0","text":"<pre><code># \u30c7\u30fc\u30bf\u5b9a\u7fa9\ndefmodule User do\n  defstruct [:id, :name, :email, :role, :active, created_at: nil]\n\n  def new(attrs) do\n    Map.merge(%__MODULE__{\n      id: generate_id(),\n      active: true,\n      created_at: DateTime.utc_now()\n    }, Map.new(attrs))\n  end\nend\n\n# \u5909\u63db\u95a2\u6570\uff08\u7d14\u7c8b\uff09\ndefmodule Transformations do\n  def activate(user), do: %{user | active: true}\n  def deactivate(user), do: %{user | active: false}\n\n  def change_role(user, role) when role in [:admin, :user, :guest] do\n    {:ok, %{user | role: role}}\n  end\nend\n\n# \u30af\u30a8\u30ea\u95a2\u6570\uff08\u7d14\u7c8b\uff09\ndefmodule Queries do\n  def active_users(users), do: Enum.filter(users, &amp; &amp;1.active)\n  def by_role(users, role), do: Enum.filter(users, &amp;(&amp;1.role == role))\nend\n\n# \u30ea\u30dd\u30b8\u30c8\u30ea\uff08\u72b6\u614b\u3042\u308a\uff09\ndefmodule Repository do\n  use Agent\n\n  def add(user), do: Agent.update(__MODULE__, &amp;Map.put(&amp;1, user.id, user))\n  def get(id), do: Agent.get(__MODULE__, &amp;Map.get(&amp;1, id))\nend\n\n# \u30b5\u30fc\u30d3\u30b9\u5c64\ndefmodule Service do\n  def create_user(attrs) do\n    user = User.new(attrs)\n    Repository.add(user)\n    {:ok, user}\n  end\n\n  def promote_to_admin(user_id) do\n    with user when not is_nil(user) &lt;- Repository.get(user_id),\n         {:ok, updated} &lt;- Transformations.change_role(user, :admin) do\n      Repository.update(updated)\n      {:ok, updated}\n    else\n      nil -&gt; {:error, :not_found}\n      error -&gt; error\n    end\n  end\nend\n</code></pre>"},{"location":"elixir/22-oo-to-fp-migration/#6","title":"6. \u79fb\u884c\u306e\u30ac\u30a4\u30c9\u30e9\u30a4\u30f3","text":"OOP \u6982\u5ff5 FP \u4ee3\u66ff \u30af\u30e9\u30b9 \u30e2\u30b8\u30e5\u30fc\u30eb + \u69cb\u9020\u4f53 \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u5909\u6570 \u69cb\u9020\u4f53\u306e\u30d5\u30a3\u30fc\u30eb\u30c9 \u30e1\u30bd\u30c3\u30c9 \u30e2\u30b8\u30e5\u30fc\u30eb\u95a2\u6570 \u7d99\u627f \u30d7\u30ed\u30c8\u30b3\u30eb\u3001\u30d3\u30d8\u30a4\u30d3\u30a2 \u30dd\u30ea\u30e2\u30fc\u30d5\u30a3\u30ba\u30e0 \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1 \u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u72b6\u614b \u5909\u63db\u95a2\u6570\u3001GenServer/Agent \u4f8b\u5916 \u30bf\u30b0\u4ed8\u304d\u30bf\u30d7\u30eb null <code>nil</code> + \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1"},{"location":"elixir/22-oo-to-fp-migration/#_8","title":"\u307e\u3068\u3081","text":"<p>OOP \u304b\u3089 FP \u3078\u306e\u79fb\u884c\u3067\u91cd\u8981\u306a\u30dd\u30a4\u30f3\u30c8\uff1a</p> <ol> <li>\u30c7\u30fc\u30bf\u3068\u632f\u308b\u821e\u3044\u306e\u5206\u96e2: \u69cb\u9020\u4f53\u306f\u30c7\u30fc\u30bf\u306e\u307f\u3001\u95a2\u6570\u306f\u5909\u63db</li> <li>\u4e0d\u5909\u6027\u306e\u53d7\u3051\u5165\u308c: \u5909\u66f4\u3067\u306f\u306a\u304f\u65b0\u3057\u3044\u5024\u3092\u751f\u6210</li> <li>\u660e\u793a\u7684\u306a\u72b6\u614b\u7ba1\u7406: GenServer/Agent \u3067\u72b6\u614b\u3092\u5c40\u6240\u5316</li> <li>\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u306e\u6d3b\u7528: \u6761\u4ef6\u5206\u5c90\u3092\u30c7\u30fc\u30bf\u69cb\u9020\u3067\u8868\u73fe</li> <li>\u95a2\u6570\u306e\u5408\u6210: \u5c0f\u3055\u306a\u7d14\u7c8b\u95a2\u6570\u3092\u7d44\u307f\u5408\u308f\u305b\u308b</li> </ol> <p>\u6700\u521d\u306f\u9055\u548c\u611f\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u6163\u308c\u308b\u3068 FP \u306e\u65b9\u304c\u7406\u89e3\u3057\u3084\u3059\u304f\u3001\u30c6\u30b9\u30c8\u3057\u3084\u3059\u3044\u30b3\u30fc\u30c9\u306b\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"fsharp/","title":"F# \u3067\u5b66\u3076\u95a2\u6570\u578b\u30c7\u30b6\u30a4\u30f3","text":""},{"location":"fsharp/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u8a18\u4e8b\u30b7\u30ea\u30fc\u30ba\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u304a\u3051\u308b\u8a2d\u8a08\u539f\u5247\u3068\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u3092 F# \u3092\u4f7f\u3063\u3066\u5b9f\u8df5\u7684\u306b\u5b66\u3076\u305f\u3081\u306e\u30ac\u30a4\u30c9\u3067\u3059\u3002F# \u306f .NET \u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u4e0a\u3067\u52d5\u4f5c\u3059\u308b\u95a2\u6570\u578b\u30d5\u30a1\u30fc\u30b9\u30c8\u8a00\u8a9e\u3067\u3042\u308a\u3001\u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b\u3001\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3001\u578b\u63a8\u8ad6\u306a\u3069\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u672c\u8cea\u7684\u306a\u6a5f\u80fd\u3092\u30cd\u30a4\u30c6\u30a3\u30d6\u306b\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"fsharp/#_2","title":"\u8a18\u4e8b\u69cb\u6210","text":""},{"location":"fsharp/#1","title":"\u7b2c1\u90e8: \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u57fa\u790e\u539f\u5247","text":"<ol> <li>\u4e0d\u5909\u6027\u3068\u30c7\u30fc\u30bf\u5909\u63db</li> <li>\u30ec\u30b3\u30fc\u30c9\u3068\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020</li> <li>\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u6f14\u7b97\u5b50\uff08|&gt;\uff09</li> <li> <p>\u526f\u4f5c\u7528\u306e\u5206\u96e2</p> </li> <li> <p>\u95a2\u6570\u5408\u6210\u3068\u9ad8\u968e\u95a2\u6570</p> </li> <li> <p>\u3068 &lt;&lt; \u306b\u3088\u308b\u95a2\u6570\u5408\u6210</p> </li> <li>\u30ab\u30ea\u30fc\u5316\u3068\u90e8\u5206\u9069\u7528</li> <li> <p>\u9ad8\u968e\u95a2\u6570\u306e\u6d3b\u7528</p> </li> <li> <p>\u591a\u614b\u6027\u306e\u5b9f\u73fe\u65b9\u6cd5</p> </li> <li>\u5224\u5225\u5171\u7528\u4f53\uff08Discriminated Union\uff09</li> <li>\u30a2\u30af\u30c6\u30a3\u30d6\u30d1\u30bf\u30fc\u30f3</li> <li>\u578b\u62e1\u5f35\u3068\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> </ol>"},{"location":"fsharp/#2","title":"\u7b2c2\u90e8: \u4ed5\u69d8\u3068\u30c6\u30b9\u30c8","text":"<ol> <li>\u30c7\u30fc\u30bf\u691c\u8a3c</li> <li>Result \u578b\u306b\u3088\u308b\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0</li> <li>Computation Expression</li> <li> <p>\u30ab\u30b9\u30bf\u30e0\u30d0\u30ea\u30c7\u30fc\u30bf\u306e\u4f5c\u6210</p> </li> <li> <p>\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8</p> </li> <li>FsCheck \u306e\u57fa\u672c</li> <li>\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u306e\u4f5c\u6210</li> <li> <p>\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u5b9a\u7fa9\u3068\u691c\u8a3c</p> </li> <li> <p>TDD \u3068\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0</p> </li> <li>xUnit / Expecto \u306b\u3088\u308b\u30c6\u30b9\u30c8</li> <li>Red-Green-Refactor \u30b5\u30a4\u30af\u30eb</li> <li>\u30c6\u30b9\u30c8\u30d5\u30a1\u30fc\u30b9\u30c8\u306e\u95a2\u6570\u8a2d\u8a08</li> </ol>"},{"location":"fsharp/#3","title":"\u7b2c3\u90e8: \u69cb\u9020\u30d1\u30bf\u30fc\u30f3","text":"<ol> <li>Composite \u30d1\u30bf\u30fc\u30f3</li> <li>\u518d\u5e30\u7684\u306a\u5224\u5225\u5171\u7528\u4f53</li> <li>\u30c4\u30ea\u30fc\u69cb\u9020\u306e\u8868\u73fe</li> <li> <p>fold \u306b\u3088\u308b\u8d70\u67fb</p> </li> <li> <p>Decorator \u30d1\u30bf\u30fc\u30f3</p> </li> <li>\u95a2\u6570\u5408\u6210\u306b\u3088\u308b\u30c7\u30b3\u30ec\u30fc\u30b7\u30e7\u30f3</li> <li>\u9ad8\u968e\u95a2\u6570\u3067\u306e\u30e9\u30c3\u30d4\u30f3\u30b0</li> <li> <p>\u632f\u308b\u821e\u3044\u306e\u52d5\u7684\u8ffd\u52a0</p> </li> <li> <p>Adapter \u30d1\u30bf\u30fc\u30f3</p> </li> <li>\u95a2\u6570\u30a2\u30c0\u30d7\u30bf\u30fc</li> <li>\u30d7\u30ed\u30c8\u30b3\u30eb\u5909\u63db</li> <li>\u30ec\u30ac\u30b7\u30fc\u30b3\u30fc\u30c9\u3068\u306e\u7d71\u5408</li> </ol>"},{"location":"fsharp/#4","title":"\u7b2c4\u90e8: \u632f\u308b\u821e\u3044\u30d1\u30bf\u30fc\u30f3","text":"<ol> <li> <p>Strategy \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>\u7b2c\u4e00\u7d1a\u95a2\u6570\u3068\u3057\u3066\u306e\u6226\u7565</li> <li>\u52d5\u7684\u306a\u6226\u7565\u5207\u308a\u66ff\u3048</li> <li>\u6226\u7565\u306e\u5408\u6210</li> </ul> </li> <li> <p>Command \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>\u4e0d\u5909\u30b3\u30de\u30f3\u30c9\u30ec\u30b3\u30fc\u30c9</li> <li>\u30b3\u30de\u30f3\u30c9\u306e\u5c65\u6b74\u3068 Undo</li> <li>\u30de\u30af\u30ed\u30b3\u30de\u30f3\u30c9</li> </ul> </li> <li> <p>Visitor \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u306b\u3088\u308b\u8a2a\u554f</li> <li>fold \u30d9\u30fc\u30b9\u306e\u30d3\u30b8\u30bf\u30fc</li> <li>\u62e1\u5f35\u53ef\u80fd\u306a\u30d3\u30b8\u30bf\u30fc</li> </ul> </li> </ol>"},{"location":"fsharp/#5","title":"\u7b2c5\u90e8: \u751f\u6210\u30d1\u30bf\u30fc\u30f3","text":"<ol> <li> <p>Abstract Factory \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>\u95a2\u6570\u30d5\u30a1\u30af\u30c8\u30ea\u30fc</li> <li>\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u3088\u308b\u62bd\u8c61\u5316</li> <li>\u4f9d\u5b58\u6027\u6ce8\u5165</li> </ul> </li> <li> <p>Abstract Server \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306b\u3088\u308b\u62bd\u8c61\u5316</li> <li>\u5b9f\u88c5\u306e\u5dee\u3057\u66ff\u3048</li> <li>\u30c6\u30b9\u30bf\u30d6\u30eb\u306a\u8a2d\u8a08</li> </ul> </li> </ol>"},{"location":"fsharp/#6","title":"\u7b2c6\u90e8: \u30b1\u30fc\u30b9\u30b9\u30bf\u30c7\u30a3","text":"<ol> <li> <p>\u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b</p> <ul> <li>\u4e0d\u5909\u72b6\u614b\u306e\u7ba1\u7406</li> <li>\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u306e\u5b9f\u88c5</li> <li>\u518d\u5e30\u7684\u306a\u51e6\u7406</li> </ul> </li> <li> <p>\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0</p> <ul> <li>\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30ea\u30f3\u30b0</li> <li>\u591a\u614b\u7684\u306a\u8a08\u7b97</li> <li>\u30ec\u30dd\u30fc\u30c8\u751f\u6210</li> </ul> </li> <li> <p>\u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0</p> <ul> <li>\u72b6\u614b\u9077\u79fb\u306e\u7ba1\u7406</li> <li>\u30a4\u30d9\u30f3\u30c8\u30bd\u30fc\u30b7\u30f3\u30b0</li> <li>\u30d3\u30b8\u30cd\u30b9\u30eb\u30fc\u30eb\u306e\u5b9f\u88c5</li> </ul> </li> <li> <p>\u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0</p> <ul> <li>MailboxProcessor\uff08Agent\uff09</li> <li>\u975e\u540c\u671f\u30ef\u30fc\u30af\u30d5\u30ed\u30fc</li> <li>\u4e26\u884c\u72b6\u614b\u7ba1\u7406</li> </ul> </li> <li> <p>Wa-Tor \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3</p> <ul> <li>\u30bb\u30eb\u30aa\u30fc\u30c8\u30de\u30c8\u30f3</li> <li>\u4e0d\u5909\u30b0\u30ea\u30c3\u30c9\u306e\u66f4\u65b0</li> <li>\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30d7</li> </ul> </li> </ol>"},{"location":"fsharp/#7","title":"\u7b2c7\u90e8: \u307e\u3068\u3081\u3068\u5fdc\u7528","text":"<ol> <li> <p>\u30d1\u30bf\u30fc\u30f3\u9593\u306e\u76f8\u4e92\u4f5c\u7528</p> <ul> <li>Composite + Decorator</li> <li>Command + Observer</li> <li>\u30d1\u30bf\u30fc\u30f3\u306e\u7d44\u307f\u5408\u308f\u305b</li> </ul> </li> <li> <p>\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9</p> <ul> <li>\u30c7\u30fc\u30bf\u4e2d\u5fc3\u8a2d\u8a08</li> <li>Computation Expression</li> <li>\u95a2\u6570\u30c7\u30b3\u30ec\u30fc\u30bf\u30fc</li> <li>\u30c6\u30b9\u30bf\u30d6\u30eb\u306a\u8a2d\u8a08</li> </ul> </li> <li> <p>OO \u304b\u3089 FP \u3078\u306e\u79fb\u884c</p> <ul> <li>\u79fb\u884c\u6226\u7565</li> <li>\u30a4\u30d9\u30f3\u30c8\u30bd\u30fc\u30b7\u30f3\u30b0</li> <li>\u6bb5\u968e\u7684\u306a\u95a2\u6570\u62bd\u51fa</li> <li>\u5224\u5225\u5171\u7528\u4f53\u306b\u3088\u308b\u591a\u614b\u6027</li> </ul> </li> </ol>"},{"location":"fsharp/#_3","title":"\u672c\u30b7\u30ea\u30fc\u30ba\u306e\u7279\u5fb4","text":""},{"location":"fsharp/#f_1","title":"F# \u306e\u7279\u6027\u3092\u6d3b\u304b\u3057\u305f\u5b9f\u88c5","text":"<p>F# \u306f\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u305f\u3081\u306b\u8a2d\u8a08\u3055\u308c\u305f\u8a00\u8a9e\u3067\u3042\u308a\u3001\u4ee5\u4e0b\u306e\u6a5f\u80fd\u3092\u30cd\u30a4\u30c6\u30a3\u30d6\u306b\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u3059\uff1a</p> <ul> <li>\u5224\u5225\u5171\u7528\u4f53\uff08Discriminated Union\uff09: \u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b\u3092\u7c21\u6f54\u306b\u5b9a\u7fa9</li> <li>\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u6f14\u7b97\u5b50\uff08|&gt;\uff09: \u30c7\u30fc\u30bf\u5909\u63db\u306e\u6d41\u308c\u3092\u81ea\u7136\u306b\u8a18\u8ff0</li> <li>\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0: \u7db2\u7f85\u6027\u30c1\u30a7\u30c3\u30af\u4ed8\u304d\u306e\u5f37\u529b\u306a\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1</li> <li>\u578b\u63a8\u8ad6: \u660e\u793a\u7684\u306a\u578b\u6ce8\u91c8\u3092\u6700\u5c0f\u9650\u306b</li> <li>Computation Expression: \u30e2\u30ca\u30c9\u7684\u306a\u8a08\u7b97\u3092 DSL \u3068\u3057\u3066\u5b9a\u7fa9</li> </ul>"},{"location":"fsharp/#_4","title":"\u5b9f\u8df5\u91cd\u8996","text":"<p>\u3059\u3079\u3066\u306e\u30d1\u30bf\u30fc\u30f3\u306f xUnit \u306b\u3088\u308b\u5b9f\u969b\u306b\u52d5\u4f5c\u3059\u308b\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u3092\u542b\u307f\u307e\u3059\u3002\u7406\u8ad6\u3060\u3051\u3067\u306a\u304f\u3001\u5b9f\u88c5\u3092\u901a\u3058\u3066\u7406\u89e3\u3092\u6df1\u3081\u308b\u3053\u3068\u3092\u91cd\u8996\u3057\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"fsharp/#_5","title":"\u6bb5\u968e\u7684\u306a\u5b66\u7fd2","text":"<p>\u57fa\u790e\u304b\u3089\u5fdc\u7528\u3078\u3068\u6bb5\u968e\u7684\u306b\u5185\u5bb9\u304c\u9032\u884c\u3057\u307e\u3059\u3002\u5404\u7ae0\u306f\u72ec\u7acb\u3057\u3066\u8aad\u3080\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u304c\u3001\u9806\u756a\u306b\u8aad\u3080\u3053\u3068\u3067\u3088\u308a\u6df1\u3044\u7406\u89e3\u304c\u5f97\u3089\u308c\u307e\u3059\u3002</p>"},{"location":"fsharp/#_6","title":"\u5bfe\u8c61\u8aad\u8005","text":"<ul> <li>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u8208\u5473\u304c\u3042\u308b F# \u958b\u767a\u8005</li> <li>F# \u3092\u5b66\u7fd2\u4e2d\u306e\u958b\u767a\u8005</li> <li>\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u306e\u77e5\u8b58\u304c\u3042\u308a\u3001\u95a2\u6570\u578b\u3067\u306e\u8868\u73fe\u3092\u5b66\u3073\u305f\u3044\u958b\u767a\u8005</li> <li>Clojure / Scala \u7248\u3068\u6bd4\u8f03\u3057\u3066\u5b66\u7fd2\u3057\u305f\u3044\u958b\u767a\u8005</li> <li>.NET \u74b0\u5883\u3067\u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1\u3092\u5c0e\u5165\u3057\u305f\u3044\u958b\u767a\u8005</li> </ul>"},{"location":"fsharp/#_7","title":"\u524d\u63d0\u77e5\u8b58","text":"<ul> <li>\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u57fa\u790e\u77e5\u8b58</li> <li>F# \u306e\u57fa\u672c\u7684\u306a\u6587\u6cd5\uff08let \u30d0\u30a4\u30f3\u30c7\u30a3\u30f3\u30b0\u3001\u95a2\u6570\u5b9a\u7fa9\u3001\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u306a\u3069\uff09</li> <li>\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u306e\u57fa\u672c\u6982\u5ff5\uff08\u63a8\u5968\uff09</li> </ul>"},{"location":"fsharp/#_8","title":"\u958b\u767a\u74b0\u5883","text":"<p>\u672c\u30b7\u30ea\u30fc\u30ba\u306e\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u306e\u74b0\u5883\u3067\u52d5\u4f5c\u78ba\u8a8d\u3057\u3066\u3044\u307e\u3059\uff1a</p> <ul> <li>.NET 8.0</li> <li>F# 8.0</li> <li>xUnit 2.x</li> <li>FsCheck\uff08\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u7528\uff09</li> <li>Nix \u306b\u3088\u308b\u74b0\u5883\u7ba1\u7406</li> </ul>"},{"location":"fsharp/#_9","title":"\u74b0\u5883\u69cb\u7bc9","text":"<pre><code># Nix \u3092\u4f7f\u7528\u3057\u305f\u958b\u767a\u74b0\u5883\u306e\u8d77\u52d5\nnix develop .#fsharp\n\n# \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u4f5c\u6210\uff08Part 1 \u306e\u4f8b\uff09\ncd app/fsharp/part1\ndotnet new sln -n FunctionalDesignPart1\ndotnet new classlib -lang F# -n FunctionalDesign -o src\ndotnet new xunit -lang F# -n FunctionalDesign.Tests -o tests\ndotnet sln add src/FunctionalDesign.fsproj tests/FunctionalDesign.Tests.fsproj\ndotnet add tests/FunctionalDesign.Tests.fsproj reference src/FunctionalDesign.fsproj\n\n# \u30c6\u30b9\u30c8\u306e\u5b9f\u884c\ndotnet test\n\n# REPL \u306e\u8d77\u52d5\ndotnet fsi\n</code></pre>"},{"location":"fsharp/#clojure-scala","title":"Clojure / Scala \u3068\u306e\u6bd4\u8f03","text":"\u6982\u5ff5 Clojure Scala F# \u4e0d\u5909\u30c7\u30fc\u30bf \u30c7\u30d5\u30a9\u30eb\u30c8 <code>val</code>, <code>case class</code> \u30c7\u30d5\u30a9\u30eb\u30c8 ADT \u30d7\u30ed\u30c8\u30b3\u30eb + \u30ec\u30b3\u30fc\u30c9 <code>sealed trait</code> \u5224\u5225\u5171\u7528\u4f53 \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3 <code>-&gt;</code>, <code>-&gt;&gt;</code> \u30e1\u30bd\u30c3\u30c9\u30c1\u30a7\u30fc\u30f3 <code>|&gt;</code>, <code>&gt;&gt;</code> \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1 <code>case</code>, <code>cond</code> <code>match</code> <code>match</code> \u578b\u30b7\u30b9\u30c6\u30e0 \u52d5\u7684 \u9759\u7684\uff08\u5f37\u3044\uff09 \u9759\u7684\uff08\u5f37\u3044\u63a8\u8ad6\uff09 \u4e26\u884c\u51e6\u7406 Agent, core.async Future, Actor MailboxProcessor, Async"},{"location":"fsharp/#_10","title":"\u53c2\u8003\u66f8\u7c4d","text":"<p>\u672c\u30b7\u30ea\u30fc\u30ba\u306f\u4ee5\u4e0b\u306e\u66f8\u7c4d\u306e\u5185\u5bb9\u3092\u53c2\u8003\u306b\u3057\u3066\u3044\u307e\u3059\uff1a</p> <ul> <li>\u300cFunctional Design: Principles, Patterns, and Practices\u300dRobert C. Martin</li> <li>\u300cDomain Modeling Made Functional\u300dScott Wlaschin</li> <li>\u300cF# for Fun and Profit\u300dScott Wlaschin\uff08\u30aa\u30f3\u30e9\u30a4\u30f3\uff09</li> <li>\u300cReal-World Functional Programming\u300dTomas Petricek, Jon Skeet</li> </ul>"},{"location":"fsharp/01-immutability-and-data-transformation/","title":"\u7b2c1\u7ae0: \u4e0d\u5909\u6027\u3068\u30c7\u30fc\u30bf\u5909\u63db","text":""},{"location":"fsharp/01-immutability-and-data-transformation/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u6700\u3082\u91cd\u8981\u306a\u6982\u5ff5\u306e\u4e00\u3064\u304c\u4e0d\u5909\u6027\uff08Immutability\uff09\u3067\u3059\u3002\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u4e88\u6e2c\u53ef\u80fd\u6027\u304c\u5411\u4e0a\u3057\u3001\u4e26\u884c\u51e6\u7406\u3067\u306e\u30d0\u30b0\u3092\u9632\u304e\u3001\u30b3\u30fc\u30c9\u306e\u7406\u89e3\u3068\u4fdd\u5b88\u304c\u5bb9\u6613\u306b\u306a\u308a\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001F# \u306b\u304a\u3051\u308b\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u57fa\u672c\u304b\u3089\u3001\u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3001\u526f\u4f5c\u7528\u306e\u5206\u96e2\u307e\u3067\u3001\u5b9f\u8df5\u7684\u306a\u4f8b\u3092\u901a\u3058\u3066\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"fsharp/01-immutability-and-data-transformation/#1_1","title":"1. \u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u57fa\u672c","text":""},{"location":"fsharp/01-immutability-and-data-transformation/#_2","title":"\u306a\u305c\u4e0d\u5909\u6027\u304c\u91cd\u8981\u306a\u306e\u304b","text":"<p>\u5f93\u6765\u306e\u547d\u4ee4\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u5909\u6570\u3084\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u72b6\u614b\u3092\u76f4\u63a5\u5909\u66f4\u3057\u307e\u3059\uff1a</p> <pre><code>// C#\uff08\u53ef\u5909\uff09\nperson.Age = 31;  // \u5143\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u5909\u66f4\u3055\u308c\u308b\n</code></pre> <p>\u3053\u308c\u306b\u5bfe\u3057\u3001F# \u306e\u30ec\u30b3\u30fc\u30c9\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u4e0d\u5909\u3067\u3059\u3002\u30c7\u30fc\u30bf\u3092\u300c\u5909\u66f4\u300d\u3059\u308b\u3068\u3001\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u69cb\u9020\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\uff1a</p> <pre><code>type Person = { Name: string; Age: int }\n\nlet updateAge person newAge = { person with Age = newAge }\n\n// \u4f7f\u7528\u4f8b\nlet originalPerson = { Name = \"\u7530\u4e2d\"; Age = 30 }\nlet updatedPerson = updateAge originalPerson 31\n\noriginalPerson   // =&gt; { Name = \"\u7530\u4e2d\"; Age = 30 }  \u2190 \u5143\u306e\u30c7\u30fc\u30bf\u306f\u5909\u308f\u3089\u306a\u3044\nupdatedPerson    // =&gt; { Name = \"\u7530\u4e2d\"; Age = 31 }  \u2190 \u65b0\u3057\u3044\u30c7\u30fc\u30bf\n</code></pre>"},{"location":"fsharp/01-immutability-and-data-transformation/#_3","title":"\u4e0d\u5909\u6027\u306e\u5229\u70b9","text":"<ol> <li>\u4e88\u6e2c\u53ef\u80fd\u6027: \u30c7\u30fc\u30bf\u304c\u5909\u66f4\u3055\u308c\u306a\u3044\u305f\u3081\u3001\u95a2\u6570\u306e\u52d5\u4f5c\u3092\u4e88\u6e2c\u3057\u3084\u3059\u3044</li> <li>\u30b9\u30ec\u30c3\u30c9\u30bb\u30fc\u30d5: \u8907\u6570\u306e\u30b9\u30ec\u30c3\u30c9\u304b\u3089\u5b89\u5168\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b</li> <li>\u5c65\u6b74\u306e\u4fdd\u6301: \u5909\u66f4\u524d\u306e\u30c7\u30fc\u30bf\u3092\u4fdd\u6301\u3067\u304d\u308b\uff08Undo/Redo \u306e\u5b9f\u88c5\u304c\u5bb9\u6613\uff09</li> <li>\u30c7\u30d0\u30c3\u30b0\u306e\u5bb9\u6613\u3055: \u30c7\u30fc\u30bf\u306e\u5909\u66f4\u5c65\u6b74\u3092\u8ffd\u8de1\u3057\u3084\u3059\u3044</li> </ol>"},{"location":"fsharp/01-immutability-and-data-transformation/#2-structural-sharing","title":"2. \u69cb\u9020\u5171\u6709\uff08Structural Sharing\uff09","text":"<p>\u300c\u6bce\u56de\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u4f5c\u6210\u3059\u308b\u3068\u975e\u52b9\u7387\u3067\u306f\uff1f\u300d\u3068\u601d\u3046\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002F# \u306f\u69cb\u9020\u5171\u6709\u306b\u3088\u308a\u3001\u52b9\u7387\u7684\u306b\u30e1\u30e2\u30ea\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002</p> <pre><code>type Member = { Name: string; Role: string }\ntype Team = { Name: string; Members: Member list }\n\nlet addMember team newMember =\n    { team with Members = team.Members @ [ newMember ] }\n\nlet team = \n    { Name = \"\u958b\u767a\u30c1\u30fc\u30e0\"\n      Members = \n        [ { Name = \"\u7530\u4e2d\"; Role = \"developer\" }\n          { Name = \"\u9234\u6728\"; Role = \"designer\" }\n          { Name = \"\u4f50\u85e4\"; Role = \"manager\" } ] }\n\nlet newTeam = addMember team { Name = \"\u5c71\u7530\"; Role = \"developer\" }\n</code></pre> <p><code>newTeam</code> \u306f\u65b0\u3057\u3044 Team \u3067\u3059\u304c\u3001<code>Name</code> \u306e\u5024\u3084\u65e2\u5b58\u306e\u30e1\u30f3\u30d0\u30fc\u30c7\u30fc\u30bf\u306f <code>team</code> \u3068\u5171\u6709\u3055\u308c\u3066\u3044\u307e\u3059\u3002</p> <p></p>"},{"location":"fsharp/01-immutability-and-data-transformation/#3","title":"3. \u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u30c7\u30fc\u30bf\u3092\u5909\u63db\u3059\u308b\u4e00\u9023\u306e\u51e6\u7406\u3092\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3068\u3057\u3066\u8868\u73fe\u3057\u307e\u3059\u3002F# \u3067\u306f\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u6f14\u7b97\u5b50\uff08<code>|&gt;</code>\uff09\u3092\u4f7f\u7528\u3057\u3066\u3001\u8aad\u307f\u3084\u3059\u3044\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u69cb\u7bc9\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"fsharp/01-immutability-and-data-transformation/#_4","title":"\u5b9f\u8df5\u4f8b\uff1a\u6ce8\u6587\u51e6\u7406\u30b7\u30b9\u30c6\u30e0","text":"<pre><code>type Item = { Name: string; Price: int; Quantity: int }\n\ntype Membership =\n    | Gold\n    | Silver\n    | Bronze\n    | Standard\n\ntype Customer = { Name: string; Membership: Membership }\ntype Order = { Items: Item list; Customer: Customer }\n\n/// \u5c0f\u8a08\u3092\u8a08\u7b97\nlet calculateSubtotal item = item.Price * item.Quantity\n\n/// \u4f1a\u54e1\u7a2e\u5225\u306b\u5fdc\u3058\u305f\u5272\u5f15\u7387\u3092\u53d6\u5f97\nlet membershipDiscount = function\n    | Gold -&gt; 0.1\n    | Silver -&gt; 0.05\n    | Bronze -&gt; 0.02\n    | Standard -&gt; 0.0\n\n/// \u6ce8\u6587\u306e\u5408\u8a08\u91d1\u984d\u3092\u8a08\u7b97\nlet calculateTotal order =\n    order.Items |&gt; List.map calculateSubtotal |&gt; List.sum\n\n/// \u5272\u5f15\u5f8c\u306e\u91d1\u984d\u3092\u8a08\u7b97\nlet applyDiscount order total =\n    let discountRate = membershipDiscount order.Customer.Membership\n    float total * (1.0 - discountRate)\n</code></pre>"},{"location":"fsharp/01-immutability-and-data-transformation/#_5","title":"\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u6f14\u7b97\u5b50\u306e\u6d3b\u7528","text":"<p>F# \u306e\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u6f14\u7b97\u5b50 <code>|&gt;</code> \u306f\u3001\u5de6\u8fba\u306e\u5024\u3092\u53f3\u8fba\u306e\u95a2\u6570\u306e\u6700\u5f8c\u306e\u5f15\u6570\u3068\u3057\u3066\u6e21\u3057\u307e\u3059\u3002</p> <pre><code>/// \u6ce8\u6587\u51e6\u7406\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\nlet processOrder order =\n    order\n    |&gt; calculateTotal\n    |&gt; applyDiscount order\n\n// \u4f7f\u7528\u4f8b\nlet order = \n    { Items = \n        [ { Name = \"\u5546\u54c1A\"; Price = 1000; Quantity = 2 }    // 2000\n          { Name = \"\u5546\u54c1B\"; Price = 500; Quantity = 3 }     // 1500\n          { Name = \"\u5546\u54c1C\"; Price = 2000; Quantity = 1 } ]  // 2000\n      Customer = { Name = \"\u5c71\u7530\"; Membership = Gold } }\n\nlet result = processOrder order  // 5500 * 0.9 = 4950.0\n</code></pre>"},{"location":"fsharp/01-immutability-and-data-transformation/#4","title":"4. \u526f\u4f5c\u7528\u306e\u5206\u96e2","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u7d14\u7c8b\u95a2\u6570\u3068\u526f\u4f5c\u7528\u3092\u6301\u3064\u95a2\u6570\u3092\u660e\u78ba\u306b\u5206\u96e2\u3059\u308b\u3053\u3068\u304c\u91cd\u8981\u3067\u3059\u3002</p>"},{"location":"fsharp/01-immutability-and-data-transformation/#_6","title":"\u7d14\u7c8b\u95a2\u6570\u3068\u306f","text":"<ul> <li>\u540c\u3058\u5165\u529b\u306b\u5bfe\u3057\u3066\u5e38\u306b\u540c\u3058\u51fa\u529b\u3092\u8fd4\u3059</li> <li>\u5916\u90e8\u306e\u72b6\u614b\u3092\u5909\u66f4\u3057\u306a\u3044\uff08\u526f\u4f5c\u7528\u304c\u306a\u3044\uff09</li> </ul> <pre><code>/// \u7a0e\u91d1\u3092\u8a08\u7b97\uff08\u7d14\u7c8b\u95a2\u6570\uff09\nlet calculateTax amount taxRate = float amount * taxRate\n\n// \u4f55\u5ea6\u547c\u3093\u3067\u3082\u540c\u3058\u7d50\u679c\ncalculateTax 1000 0.1  // =&gt; 100.0\ncalculateTax 1000 0.1  // =&gt; 100.0\n</code></pre>"},{"location":"fsharp/01-immutability-and-data-transformation/#_7","title":"\u526f\u4f5c\u7528\u306e\u5206\u96e2\u30d1\u30bf\u30fc\u30f3","text":"<p>\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\uff08\u7d14\u7c8b\u95a2\u6570\uff09\u3068\u526f\u4f5c\u7528\uff08I/O\uff09\u3092\u5206\u96e2\u3057\u307e\u3059\uff1a</p> <pre><code>type Invoice = \n    { Subtotal: int\n      Tax: float\n      Total: float }\n\n/// \u8acb\u6c42\u66f8\u3092\u4f5c\u6210\uff08\u7d14\u7c8b\u95a2\u6570\uff09\nlet calculateInvoice items taxRate =\n    let subtotal = items |&gt; List.map calculateSubtotal |&gt; List.sum\n    let tax = calculateTax subtotal taxRate\n    let total = float subtotal + tax\n    { Subtotal = subtotal; Tax = tax; Total = total }\n\n/// \u526f\u4f5c\u7528\u3092\u542b\u3080\u51e6\u7406\uff08\u5206\u96e2\uff09\nlet saveInvoice invoice =\n    // \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u306e\u4fdd\u5b58\uff08\u526f\u4f5c\u7528\uff09\n    printfn \"Saving invoice: %A\" invoice\n    invoice\n\nlet sendNotification invoice customerEmail =\n    // \u30e1\u30fc\u30eb\u9001\u4fe1\uff08\u526f\u4f5c\u7528\uff09\n    printfn \"Sending notification to: %s\" customerEmail\n    invoice\n\n/// \u51e6\u7406\u5168\u4f53\u306e\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\nlet processAndSaveInvoice items taxRate customerEmail =\n    calculateInvoice items taxRate\n    |&gt; saveInvoice\n    |&gt; fun invoice -&gt; sendNotification invoice customerEmail\n</code></pre>"},{"location":"fsharp/01-immutability-and-data-transformation/#5-undoredo","title":"5. \u6c38\u7d9a\u7684\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u6d3b\u7528\uff1aUndo/Redo \u306e\u5b9f\u88c5","text":"<p>\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u6d3b\u7528\u3059\u308b\u3068\u3001\u5c65\u6b74\u7ba1\u7406\u304c\u975e\u5e38\u306b\u7c21\u5358\u306b\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p> <pre><code>type History&lt;'T&gt; =\n    { Current: 'T option\n      Past: 'T list\n      Future: 'T list }\n\nlet createHistory () = { Current = None; Past = []; Future = [] }\n\nlet pushState newState history =\n    let newPast =\n        match history.Current with\n        | Some current -&gt; current :: history.Past\n        | None -&gt; history.Past\n    { Current = Some newState; Past = newPast; Future = [] }\n\nlet undo history =\n    match history.Past with\n    | [] -&gt; history\n    | previous :: rest -&gt;\n        let newFuture =\n            match history.Current with\n            | Some current -&gt; current :: history.Future\n            | None -&gt; history.Future\n        { Current = Some previous; Past = rest; Future = newFuture }\n\nlet redo history =\n    match history.Future with\n    | [] -&gt; history\n    | next :: rest -&gt;\n        let newPast =\n            match history.Current with\n            | Some current -&gt; current :: history.Past\n            | None -&gt; history.Past\n        { Current = Some next; Past = newPast; Future = rest }\n\nlet currentState history = history.Current\n</code></pre>"},{"location":"fsharp/01-immutability-and-data-transformation/#_8","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>let history =\n    createHistory ()\n    |&gt; pushState {| Text = \"Hello\" |}\n    |&gt; pushState {| Text = \"Hello World\" |}\n    |&gt; pushState {| Text = \"Hello World!\" |}\n\ncurrentState history  // =&gt; Some {| Text = \"Hello World!\" |}\n\nlet afterUndo = undo history\ncurrentState afterUndo  // =&gt; Some {| Text = \"Hello World\" |}\n\nlet afterRedo = redo afterUndo\ncurrentState afterRedo  // =&gt; Some {| Text = \"Hello World!\" |}\n</code></pre>"},{"location":"fsharp/01-immutability-and-data-transformation/#6-seq","title":"6. \u52b9\u7387\u7684\u306a\u5909\u63db\uff08Seq \u306b\u3088\u308b\u9045\u5ef6\u8a55\u4fa1\uff09","text":"<p>\u8907\u6570\u306e\u5909\u63db\u3092\u884c\u3046\u5834\u5408\u3001<code>Seq</code> \u3092\u4f7f\u7528\u3059\u308b\u3068\u9045\u5ef6\u8a55\u4fa1\u306b\u3088\u308a\u52b9\u7387\u7684\u306b\u51e6\u7406\u3067\u304d\u307e\u3059\u3002</p> <pre><code>let processItemsEfficiently items =\n    items\n    |&gt; Seq.filter (fun item -&gt; item.Quantity &gt; 0)\n    |&gt; Seq.map (fun item -&gt; {| item with Subtotal = calculateSubtotal item |})\n    |&gt; Seq.filter (fun item -&gt; item.Subtotal &gt; 100)\n    |&gt; Seq.toList\n</code></pre> <p><code>Seq</code> \u306e\u5229\u70b9\uff1a - \u4e2d\u9593\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3057\u306a\u3044 - \u5fc5\u8981\u306a\u5206\u3060\u3051\u51e6\u7406\uff08\u9045\u5ef6\u8a55\u4fa1\uff09 - \u30e1\u30e2\u30ea\u52b9\u7387\u304c\u826f\u3044</p>"},{"location":"fsharp/01-immutability-and-data-transformation/#7","title":"7. \u4e0d\u5909\u30ea\u30b9\u30c8\u306e\u64cd\u4f5c","text":"<p>F# \u306e\u30ea\u30b9\u30c8\u306f\u4e0d\u5909\u306e\u9023\u7d50\u30ea\u30b9\u30c8\u3067\u3059\u3002</p> <pre><code>/// \u30ea\u30b9\u30c8\u306e\u5148\u982d\u306b\u8ffd\u52a0\uff08\u52b9\u7387\u7684\uff1aO(1)\uff09\nlet prepend item list = item :: list\n\n/// \u30ea\u30b9\u30c8\u306e\u672b\u5c3e\u306b\u8ffd\u52a0\uff08\u975e\u52b9\u7387\uff1aO(n)\uff09\nlet append item list = list @ [ item ]\n\n/// \u30ea\u30b9\u30c8\u3092\u7d50\u5408\nlet concat list1 list2 = list1 @ list2\n\n/// \u6761\u4ef6\u3067\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\nlet filterBy predicate list = List.filter predicate list\n\n/// \u30de\u30c3\u30d4\u30f3\u30b0\nlet mapWith f list = List.map f list\n\n/// \u7573\u307f\u8fbc\u307f\nlet foldWith folder initial list = List.fold folder initial list\n</code></pre>"},{"location":"fsharp/01-immutability-and-data-transformation/#8-map","title":"8. \u4e0d\u5909 Map \u306e\u64cd\u4f5c","text":"<pre><code>/// \u30a8\u30f3\u30c8\u30ea\u3092\u8ffd\u52a0\nlet addEntry key value map = Map.add key value map\n\n/// \u30a8\u30f3\u30c8\u30ea\u3092\u524a\u9664\nlet removeEntry key map = Map.remove key map\n\n/// \u5024\u3092\u53d6\u5f97\nlet tryGetValue key map = Map.tryFind key map\n\n/// \u30ad\u30fc\u304c\u5b58\u5728\u3059\u308b\u304b\nlet containsKey key map = Map.containsKey key map\n\n/// \u5024\u3092\u66f4\u65b0\nlet updateValue key updater map =\n    match Map.tryFind key map with\n    | Some value -&gt; Map.add key (updater value) map\n    | None -&gt; map\n</code></pre>"},{"location":"fsharp/01-immutability-and-data-transformation/#_9","title":"\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9","text":"<pre><code>[&lt;Fact&gt;]\nlet ``Person \u30ec\u30b3\u30fc\u30c9\u306f\u4e0d\u5909`` () =\n    let original = { Name = \"\u7530\u4e2d\"; Age = 30 }\n    let updated = updateAge original 31\n    Assert.Equal(30, original.Age)  // \u5143\u306f\u5909\u308f\u3089\u306a\u3044\n    Assert.Equal(31, updated.Age)\n\n[&lt;Fact&gt;]\nlet ``\u6ce8\u6587\u51e6\u7406\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3`` () =\n    let order = \n        { Items = \n            [ { Name = \"\u5546\u54c1A\"; Price = 1000; Quantity = 2 }\n              { Name = \"\u5546\u54c1B\"; Price = 500; Quantity = 3 }\n              { Name = \"\u5546\u54c1C\"; Price = 2000; Quantity = 1 } ]\n          Customer = { Name = \"\u5c71\u7530\"; Membership = Gold } }\n    let result = processOrder order\n    Assert.Equal(4950.0, result)\n\n[&lt;Fact&gt;]\nlet ``Undo \u3067\u524d\u306e\u72b6\u614b\u306b\u623b\u308b`` () =\n    let history: History&lt;string&gt; =\n        createHistory ()\n        |&gt; pushState \"A\"\n        |&gt; pushState \"B\"\n        |&gt; pushState \"C\"\n        |&gt; undo\n    Assert.Equal(Some \"B\", currentState history)\n</code></pre>"},{"location":"fsharp/01-immutability-and-data-transformation/#_10","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u57fa\u790e\u3067\u3042\u308b\u4e0d\u5909\u6027\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020: \u30ec\u30b3\u30fc\u30c9\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u4e0d\u5909\u3001<code>with</code> \u5f0f\u3067\u65b0\u3057\u3044\u30ec\u30b3\u30fc\u30c9\u3092\u4f5c\u6210</li> <li>\u69cb\u9020\u5171\u6709: \u52b9\u7387\u7684\u306a\u30e1\u30e2\u30ea\u4f7f\u7528\u3092\u5b9f\u73fe</li> <li>\u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3: <code>|&gt;</code> \u6f14\u7b97\u5b50\u306b\u3088\u308b\u8aad\u307f\u3084\u3059\u3044\u5909\u63db\u51e6\u7406</li> <li>\u526f\u4f5c\u7528\u306e\u5206\u96e2: \u7d14\u7c8b\u95a2\u6570\u3068 I/O \u51e6\u7406\u306e\u660e\u78ba\u306a\u5206\u96e2</li> <li>\u5c65\u6b74\u7ba1\u7406: \u4e0d\u5909\u6027\u3092\u6d3b\u7528\u3057\u305f Undo/Redo \u306e\u7c21\u6f54\u306a\u5b9f\u88c5</li> <li>\u9045\u5ef6\u8a55\u4fa1: <code>Seq</code> \u306b\u3088\u308b\u52b9\u7387\u7684\u306a\u5909\u63db</li> </ol> <p>\u3053\u308c\u3089\u306e\u6982\u5ff5\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u4ed6\u306e\u3059\u3079\u3066\u306e\u30d1\u30bf\u30fc\u30f3\u306e\u57fa\u76e4\u3068\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"fsharp/01-immutability-and-data-transformation/#_11","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/fsharp/part1/src/Library.fs</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/fsharp/part1/tests/Tests.fs</code></li> </ul>"},{"location":"fsharp/01-immutability-and-data-transformation/#_12","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001\u95a2\u6570\u5408\u6210\u3068\u9ad8\u968e\u95a2\u6570\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u5c0f\u3055\u306a\u95a2\u6570\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u8907\u96d1\u306a\u51e6\u7406\u3092\u69cb\u7bc9\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"fsharp/02-function-composition/","title":"\u7b2c2\u7ae0: \u95a2\u6570\u5408\u6210\u3068\u9ad8\u968e\u95a2\u6570","text":""},{"location":"fsharp/02-function-composition/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u771f\u9ac4\u306f\u3001\u5c0f\u3055\u306a\u95a2\u6570\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u8907\u96d1\u306a\u51e6\u7406\u3092\u69cb\u7bc9\u3059\u308b\u3053\u3068\u306b\u3042\u308a\u307e\u3059\u3002\u672c\u7ae0\u3067\u306f\u3001F# \u306b\u304a\u3051\u308b\u95a2\u6570\u5408\u6210\u306e\u30c6\u30af\u30cb\u30c3\u30af\u3068\u9ad8\u968e\u95a2\u6570\u306e\u6d3b\u7528\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"fsharp/02-function-composition/#1","title":"1. \u95a2\u6570\u5408\u6210\u306e\u57fa\u672c (<code>&gt;&gt;</code> \u3068 <code>&lt;&lt;</code>)","text":""},{"location":"fsharp/02-function-composition/#_2","title":"<code>&gt;&gt;</code> \u3068 <code>&lt;&lt;</code> \u306b\u3088\u308b\u95a2\u6570\u306e\u9023\u7d50","text":"<p>F# \u3067\u306f <code>&gt;&gt;</code> \u3068 <code>&lt;&lt;</code> \u6f14\u7b97\u5b50\u3092\u4f7f\u7528\u3057\u3066\u95a2\u6570\u3092\u5408\u6210\u3067\u304d\u307e\u3059\u3002</p> <ul> <li><code>&gt;&gt;</code>: \u5de6\u304b\u3089\u53f3\u3078\u9806\u756a\u306b\u9069\u7528\uff08\u76f4\u611f\u7684\u3001\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3068\u540c\u3058\u65b9\u5411\uff09</li> <li><code>&lt;&lt;</code>: \u53f3\u304b\u3089\u5de6\u3078\u9806\u756a\u306b\u9069\u7528\uff08\u6570\u5b66\u7684\u306a\u95a2\u6570\u5408\u6210\uff09</li> </ul> <pre><code>/// \u7a0e\u91d1\u3092\u8ffd\u52a0\u3059\u308b\nlet addTax rate amount = amount * (1.0 + rate)\n\n/// \u5272\u5f15\u3092\u9069\u7528\u3059\u308b\nlet applyDiscountRate rate amount = amount * (1.0 - rate)\n\n/// \u5186\u5358\u4f4d\u306b\u4e38\u3081\u308b\nlet roundToYen (amount: float) = int64 (System.Math.Round(amount))\n\n/// &gt;&gt; \u306b\u3088\u308b\u95a2\u6570\u5408\u6210\uff08\u5de6\u304b\u3089\u53f3\uff09\nlet calculateFinalPrice: float -&gt; int64 =\n    applyDiscountRate 0.2 &gt;&gt; addTax 0.1 &gt;&gt; roundToYen\n\n/// &lt;&lt; \u306b\u3088\u308b\u95a2\u6570\u5408\u6210\uff08\u53f3\u304b\u3089\u5de6\u3001\u6570\u5b66\u7684\uff09\nlet calculateFinalPriceCompose: float -&gt; int64 =\n    roundToYen &lt;&lt; addTax 0.1 &lt;&lt; applyDiscountRate 0.2\n\n// \u4f7f\u7528\u4f8b\ncalculateFinalPrice 1000.0\n// =&gt; 880L\n// \u51e6\u7406\u9806\u5e8f: 1000 \u2192 20%\u5272\u5f15(800) \u2192 10%\u7a0e\u8fbc(880) \u2192 \u4e38\u3081(880)\n</code></pre>"},{"location":"fsharp/02-function-composition/#_3","title":"\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u6f14\u7b97\u5b50\u3068\u306e\u95a2\u4fc2","text":"<pre><code>// \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u6f14\u7b97\u5b50 |&gt; \u3092\u4f7f\u3063\u305f\u540c\u7b49\u306e\u51e6\u7406\nlet result =\n    1000.0\n    |&gt; applyDiscountRate 0.2\n    |&gt; addTax 0.1\n    |&gt; roundToYen\n// =&gt; 880L\n</code></pre>"},{"location":"fsharp/02-function-composition/#_4","title":"\u95a2\u6570\u5408\u6210\u306e\u5229\u70b9","text":"<ol> <li>\u5ba3\u8a00\u7684\u306a\u8a18\u8ff0: \u51e6\u7406\u306e\u6d41\u308c\u3092\u95a2\u6570\u306e\u30c1\u30a7\u30fc\u30f3\u3068\u3057\u3066\u8868\u73fe</li> <li>\u518d\u5229\u7528\u6027: \u5408\u6210\u3057\u305f\u95a2\u6570\u3092\u5225\u306e\u5834\u6240\u3067\u518d\u5229\u7528\u53ef\u80fd</li> <li>\u30c6\u30b9\u30c8\u5bb9\u6613\u6027: \u5404\u95a2\u6570\u3092\u500b\u5225\u306b\u30c6\u30b9\u30c8\u53ef\u80fd</li> </ol>"},{"location":"fsharp/02-function-composition/#2_1","title":"2. \u30ab\u30ea\u30fc\u5316\u3068\u90e8\u5206\u9069\u7528","text":""},{"location":"fsharp/02-function-composition/#f","title":"F# \u306e\u30ab\u30ea\u30fc\u5316","text":"<p>F# \u3067\u306f\u5168\u3066\u306e\u95a2\u6570\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u30ab\u30ea\u30fc\u5316\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u8907\u6570\u306e\u5f15\u6570\u3092\u6301\u3064\u95a2\u6570\u306f\u3001\u5b9f\u969b\u306b\u306f\u300c1\u3064\u306e\u5f15\u6570\u3092\u53d6\u308a\u3001\u6b21\u306e\u95a2\u6570\u3092\u8fd4\u3059\u95a2\u6570\u300d\u306e\u30c1\u30a7\u30fc\u30f3\u3067\u3059\u3002</p> <pre><code>/// \u30ab\u30ea\u30fc\u5316\u3055\u308c\u305f\u6328\u62f6\u95a2\u6570\nlet greet greeting name = sprintf \"%s, %s!\" greeting name\n\n/// \u90e8\u5206\u9069\u7528\u3067\u7279\u5316\u3057\u305f\u95a2\u6570\u3092\u4f5c\u6210\nlet sayHello = greet \"Hello\"\nlet sayGoodbye = greet \"Goodbye\"\n\nsayHello \"\u7530\u4e2d\"    // =&gt; \"Hello, \u7530\u4e2d!\"\nsayGoodbye \"\u9234\u6728\"  // =&gt; \"Goodbye, \u9234\u6728!\"\n</code></pre>"},{"location":"fsharp/02-function-composition/#_5","title":"\u8907\u6570\u5f15\u6570\u306e\u90e8\u5206\u9069\u7528","text":"<pre><code>/// Email\u30ec\u30b3\u30fc\u30c9\ntype Email =\n    { From: string\n      To: string\n      Subject: string\n      Body: string }\n\n/// \u30ab\u30ea\u30fc\u5316\u3055\u308c\u305f\u30e1\u30fc\u30eb\u9001\u4fe1\u95a2\u6570\nlet sendEmail from' to' subject body =\n    { From = from'\n      To = to'\n      Subject = subject\n      Body = body }\n\n/// \u90e8\u5206\u9069\u7528\u3067\u30b7\u30b9\u30c6\u30e0\u30e1\u30fc\u30eb\u9001\u4fe1\u95a2\u6570\u3092\u4f5c\u6210\nlet sendFromSystem = sendEmail \"system@example.com\"\nlet sendNotification = sendFromSystem \"user@example.com\" \"\u901a\u77e5\"\n\nsendNotification \"\u30e1\u30c3\u30bb\u30fc\u30b8\u672c\u6587\"\n// =&gt; { From = \"system@example.com\"\n//      To = \"user@example.com\"\n//      Subject = \"\u901a\u77e5\"\n//      Body = \"\u30e1\u30c3\u30bb\u30fc\u30b8\u672c\u6587\" }\n</code></pre>"},{"location":"fsharp/02-function-composition/#3-juxt","title":"3. \u8907\u6570\u306e\u95a2\u6570\u3092\u4e26\u5217\u9069\u7528 (juxt \u76f8\u5f53)","text":"<p>Clojure \u306e <code>juxt</code> \u306b\u76f8\u5f53\u3059\u308b\u6a5f\u80fd\u306f\u3001F# \u3067\u306f\u30bf\u30d7\u30eb\u3092\u4f7f\u3063\u3066\u8868\u73fe\u3057\u307e\u3059\u3002</p> <pre><code>/// \u6570\u5024\u30ea\u30b9\u30c8\u306e\u7d71\u8a08\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\nlet getStats (numbers: int list) =\n    (List.head numbers,\n     List.last numbers,\n     List.length numbers,\n     List.min numbers,\n     List.max numbers)\n\ngetStats [3; 1; 4; 1; 5; 9; 2; 6]\n// =&gt; (3, 6, 8, 1, 9)\n// (\u6700\u521d\u306e\u5024, \u6700\u5f8c\u306e\u5024, \u8981\u7d20\u6570, \u6700\u5c0f\u5024, \u6700\u5927\u5024)\n</code></pre>"},{"location":"fsharp/02-function-composition/#juxt","title":"juxt \u7684\u306a\u9ad8\u968e\u95a2\u6570","text":"<pre><code>/// juxt\u7684\u306a\u95a2\u6570\u3092\u4f5c\u6210\u3059\u308b\u9ad8\u968e\u95a2\u6570\nlet juxt2 f1 f2 x = (f1 x, f2 x)\nlet juxt3 f1 f2 f3 x = (f1 x, f2 x, f3 x)\n\n// \u4f7f\u7528\u4f8b\njuxt2 (fun x -&gt; x * 2) (fun x -&gt; x + 10) 5\n// =&gt; (10, 15)\n\njuxt3 List.head List.last List.length [1; 2; 3]\n// =&gt; (1, 3, 3)\n</code></pre>"},{"location":"fsharp/02-function-composition/#_6","title":"\u5b9f\u7528\u4f8b\uff1a\u30c7\u30fc\u30bf\u5206\u6790","text":"<pre><code>/// \u4eba\u7269\u5206\u6790\u7d50\u679c\ntype PersonAnalysis =\n    { Name: string\n      Age: int\n      Category: string }\n\n/// \u4eba\u7269\u60c5\u5831\u3092\u5206\u6790\u3059\u308b\nlet analyzePerson (person: Map&lt;string, obj&gt;) =\n    let name = person.[\"name\"] :?&gt; string\n    let age = person.[\"age\"] :?&gt; int\n    let category = if age &gt;= 18 then \"adult\" else \"minor\"\n    { Name = name; Age = age; Category = category }\n\nanalyzePerson (Map.ofList [\"name\", box \"\u7530\u4e2d\"; \"age\", box 25])\n// =&gt; { Name = \"\u7530\u4e2d\"; Age = 25; Category = \"adult\" }\n</code></pre>"},{"location":"fsharp/02-function-composition/#4","title":"4. \u9ad8\u968e\u95a2\u6570\u306b\u3088\u308b\u30c7\u30fc\u30bf\u51e6\u7406","text":"<p>\u9ad8\u968e\u95a2\u6570\u3068\u306f\u3001\u95a2\u6570\u3092\u5f15\u6570\u3068\u3057\u3066\u53d7\u3051\u53d6\u308b\u304b\u3001\u95a2\u6570\u3092\u8fd4\u3059\u95a2\u6570\u306e\u3053\u3068\u3067\u3059\u3002</p>"},{"location":"fsharp/02-function-composition/#_7","title":"\u51e6\u7406\u306e\u8a18\u9332","text":"<pre><code>/// \u51e6\u7406\u7d50\u679c\u3092\u8a18\u9332\u3059\u308b\ntype ProcessLog&lt;'a, 'b&gt; = { Input: 'a; Output: 'b }\n\nlet processWithLog (f: 'a -&gt; 'b) (input: 'a) : ProcessLog&lt;'a, 'b&gt; =\n    let output = f input\n    { Input = input; Output = output }\n\nlet log = processWithLog (fun x -&gt; x * 2) 5\n// =&gt; { Input = 5; Output = 10 }\n</code></pre>"},{"location":"fsharp/02-function-composition/#_8","title":"\u30ea\u30c8\u30e9\u30a4\u6a5f\u80fd\u306e\u8ffd\u52a0","text":"<pre><code>/// \u30ea\u30c8\u30e9\u30a4\u6a5f\u80fd\u3092\u8ffd\u52a0\u3059\u308b\u9ad8\u968e\u95a2\u6570\nlet retry maxRetries (f: 'a -&gt; 'b) (input: 'a) : 'b =\n    let rec attempt attempts =\n        try\n            f input\n        with\n        | ex -&gt;\n            if attempts &lt; maxRetries then\n                attempt (attempts + 1)\n            else\n                reraise ()\n    attempt 0\n\n// \u4e0d\u5b89\u5b9a\u306aAPI\u547c\u3073\u51fa\u3057\u3092\u30ea\u30c8\u30e9\u30a4\u4ed8\u304d\u3067\u30e9\u30c3\u30d7\nlet fetchWithRetry = retry 3 fetchData\n</code></pre>"},{"location":"fsharp/02-function-composition/#_9","title":"\u30e1\u30e2\u5316","text":"<pre><code>/// \u57fa\u672c\u7684\u306a\u30e1\u30e2\u5316\nlet memoize (f: 'a -&gt; 'b) : 'a -&gt; 'b =\n    let cache = System.Collections.Generic.Dictionary&lt;'a, 'b&gt;()\n    fun input -&gt;\n        match cache.TryGetValue(input) with\n        | true, value -&gt; value\n        | false, _ -&gt;\n            let result = f input\n            cache.[input] &lt;- result\n            result\n\n// \u4f7f\u7528\u4f8b\nlet mutable callCount = 0\nlet expensiveFunction x =\n    callCount &lt;- callCount + 1\n    x * 2\n\nlet memoized = memoize expensiveFunction\nmemoized 5  // \u8a08\u7b97\u5b9f\u884c\nmemoized 5  // \u30ad\u30e3\u30c3\u30b7\u30e5\u304b\u3089\u53d6\u5f97\nmemoized 5  // \u30ad\u30e3\u30c3\u30b7\u30e5\u304b\u3089\u53d6\u5f97\n// callCount = 1 (1\u56de\u3060\u3051\u8a08\u7b97)\n</code></pre>"},{"location":"fsharp/02-function-composition/#5","title":"5. \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u51e6\u7406","text":"<p>\u8907\u6570\u306e\u95a2\u6570\u3092\u9806\u6b21\u9069\u7528\u3059\u308b\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002</p> <pre><code>/// \u95a2\u6570\u306e\u30ea\u30b9\u30c8\u3092\u9806\u6b21\u9069\u7528\u3059\u308b\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u4f5c\u6210\u3059\u308b\nlet pipeline (fns: ('a -&gt; 'a) list) (input: 'a) : 'a =\n    List.fold (fun acc f -&gt; f acc) input fns\n</code></pre>"},{"location":"fsharp/02-function-composition/#_10","title":"\u6ce8\u6587\u51e6\u7406\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u5b9f\u88c5","text":"<pre><code>/// \u6ce8\u6587\u30a2\u30a4\u30c6\u30e0\ntype OrderItem = { Price: int; Quantity: int }\n\n/// \u9867\u5ba2\ntype PipelineCustomer = { Membership: string }\n\n/// \u6ce8\u6587\ntype PipelineOrder =\n    { Items: OrderItem list\n      Customer: PipelineCustomer\n      Total: float\n      Shipping: int }\n\n/// \u6ce8\u6587\u3092\u691c\u8a3c\u3059\u308b\nlet validateOrder (order: PipelineOrder) =\n    if List.isEmpty order.Items then\n        failwith \"\u6ce8\u6587\u306b\u30a2\u30a4\u30c6\u30e0\u304c\u3042\u308a\u307e\u305b\u3093\"\n    else\n        order\n\n/// \u6ce8\u6587\u5408\u8a08\u3092\u8a08\u7b97\u3059\u308b\nlet calculateOrderTotal (order: PipelineOrder) =\n    let total =\n        order.Items\n        |&gt; List.map (fun item -&gt; item.Price * item.Quantity)\n        |&gt; List.sum\n        |&gt; float\n    { order with Total = total }\n\n/// \u6ce8\u6587\u5272\u5f15\u3092\u9069\u7528\u3059\u308b\nlet applyOrderDiscount (order: PipelineOrder) =\n    let discountRates = Map.ofList [\"gold\", 0.1; \"silver\", 0.05; \"bronze\", 0.02]\n    let discountRate =\n        discountRates\n        |&gt; Map.tryFind order.Customer.Membership\n        |&gt; Option.defaultValue 0.0\n    { order with Total = order.Total * (1.0 - discountRate) }\n\n/// \u9001\u6599\u3092\u8ffd\u52a0\u3059\u308b\nlet addShipping (order: PipelineOrder) =\n    let shipping = if order.Total &gt;= 5000.0 then 0 else 500\n    { order with\n        Shipping = shipping\n        Total = order.Total + float shipping }\n\n/// \u6ce8\u6587\u51e6\u7406\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\nlet processOrderPipeline =\n    pipeline [validateOrder; calculateOrderTotal; applyOrderDiscount; addShipping]\n\n// \u4f7f\u7528\u4f8b\nprocessOrderPipeline\n    { Items = [{Price = 1000; Quantity = 2}; {Price = 500; Quantity = 3}]\n      Customer = { Membership = \"gold\" }\n      Total = 0.0\n      Shipping = 0 }\n// =&gt; { Items = [...]; Customer = ...; Total = 3650.0; Shipping = 500 }\n</code></pre>"},{"location":"fsharp/02-function-composition/#6","title":"6. \u95a2\u6570\u5408\u6210\u306b\u3088\u308b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3","text":"<p>\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30ed\u30b8\u30c3\u30af\u3092\u95a2\u6570\u5408\u6210\u3067\u8868\u73fe\u3057\u307e\u3059\u3002</p> <pre><code>/// \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u7d50\u679c\ntype ValidationResult&lt;'a&gt; =\n    { Valid: bool\n      Value: 'a\n      Error: string option }\n\n/// \u30d0\u30ea\u30c7\u30fc\u30bf\u3092\u4f5c\u6210\u3059\u308b\u9ad8\u968e\u95a2\u6570\nlet validator (pred: 'a -&gt; bool) (errorMsg: string) (value: 'a) : ValidationResult&lt;'a&gt; =\n    if pred value then\n        { Valid = true; Value = value; Error = None }\n    else\n        { Valid = false; Value = value; Error = Some errorMsg }\n\n/// \u8907\u6570\u306e\u30d0\u30ea\u30c7\u30fc\u30bf\u3092\u5408\u6210\u3059\u308b\nlet combineValidators (validators: ('a -&gt; ValidationResult&lt;'a&gt;) list) (value: 'a) =\n    let initial = { Valid = true; Value = value; Error = None }\n    validators\n    |&gt; List.fold (fun result v -&gt;\n        if result.Valid then v result.Value\n        else result) initial\n\n// \u500b\u5225\u306e\u30d0\u30ea\u30c7\u30fc\u30bf\nlet validatePositive = validator (fun x -&gt; x &gt; 0) \"\u5024\u306f\u6b63\u306e\u6570\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"\nlet validateUnder100 = validator (fun x -&gt; x &lt; 100) \"\u5024\u306f100\u672a\u6e80\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"\n\n// \u30d0\u30ea\u30c7\u30fc\u30bf\u306e\u5408\u6210\nlet validateQuantity = combineValidators [validatePositive; validateUnder100]\n\n// \u4f7f\u7528\u4f8b\nvalidateQuantity 50   // =&gt; { Valid = true; Value = 50; Error = None }\nvalidateQuantity -1   // =&gt; { Valid = false; Value = -1; Error = Some \"\u5024\u306f\u6b63\u306e\u6570\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\" }\nvalidateQuantity 100  // =&gt; { Valid = false; Value = 100; Error = Some \"\u5024\u306f100\u672a\u6e80\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\" }\n</code></pre>"},{"location":"fsharp/02-function-composition/#7","title":"7. \u95a2\u6570\u306e\u5909\u63db","text":"<p>\u95a2\u6570\u81ea\u4f53\u3092\u5909\u63db\u3059\u308b\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u95a2\u6570\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002</p>"},{"location":"fsharp/02-function-composition/#_11","title":"\u5f15\u6570\u306e\u9806\u5e8f\u3092\u53cd\u8ee2","text":"<pre><code>/// \u5f15\u6570\u306e\u9806\u5e8f\u3092\u53cd\u8ee2\u3059\u308b\nlet flip f a b = f b a\n\nlet subtract a b = a - b\nflip subtract 3 5  // =&gt; 2  (5 - 3)\n</code></pre>"},{"location":"fsharp/02-function-composition/#_12","title":"\u30ab\u30ea\u30fc\u5316\u3068\u975e\u30ab\u30ea\u30fc\u5316","text":"<pre><code>/// 2\u5f15\u6570\u95a2\u6570\u3092\u30ab\u30ea\u30fc\u5316\u3059\u308b\nlet curry f a b = f (a, b)\n\n/// \u30ab\u30ea\u30fc\u5316\u3055\u308c\u305f\u95a2\u6570\u3092\u5143\u306b\u623b\u3059\nlet uncurry f (a, b) = f a b\n\nlet addTuple (a, b) = a + b\nlet curriedAdd = curry addTuple\ncurriedAdd 5 3  // =&gt; 8\n\nlet addCurried a b = a + b\nlet uncurriedAdd = uncurry addCurried\nuncurriedAdd (5, 3)  // =&gt; 8\n</code></pre>"},{"location":"fsharp/02-function-composition/#complement","title":"\u88dc\u95a2\u6570\uff08complement\uff09","text":"<pre><code>/// \u88dc\u95a2\u6570\uff08\u8ff0\u8a9e\u3092\u53cd\u8ee2\uff09\nlet complement pred x = not (pred x)\n\nlet isEven x = x % 2 = 0\nlet isOdd = complement isEven\nisOdd 3  // =&gt; true\nisOdd 4  // =&gt; false\n</code></pre>"},{"location":"fsharp/02-function-composition/#8","title":"8. \u95a2\u6570\u5408\u6210\u306e\u30d1\u30bf\u30fc\u30f3","text":""},{"location":"fsharp/02-function-composition/#_13","title":"\u8ff0\u8a9e\u306e\u5408\u6210","text":"<pre><code>/// \u8907\u6570\u306e\u8ff0\u8a9e\u3092 AND \u3067\u5408\u6210\u3059\u308b\nlet composePredicates (preds: ('a -&gt; bool) list) (x: 'a) : bool =\n    preds |&gt; List.forall (fun pred -&gt; pred x)\n\n/// \u8907\u6570\u306e\u8ff0\u8a9e\u3092 OR \u3067\u5408\u6210\u3059\u308b\nlet composePredicatesOr (preds: ('a -&gt; bool) list) (x: 'a) : bool =\n    preds |&gt; List.exists (fun pred -&gt; pred x)\n\n// \u6709\u52b9\u306a\u5e74\u9f62\u30c1\u30a7\u30c3\u30af\nlet validAge =\n    composePredicates [(fun x -&gt; x &gt; 0); (fun x -&gt; x &lt;= 150)]\n\nvalidAge 25   // =&gt; true\nvalidAge -1   // =&gt; false\nvalidAge 200  // =&gt; false\n\n// \u30d7\u30ec\u30df\u30a2\u30e0\u9867\u5ba2\u30c1\u30a7\u30c3\u30af\ntype CustomerInfo =\n    { Membership: string\n      PurchaseCount: int\n      TotalSpent: int }\n\nlet premiumCustomer =\n    composePredicatesOr [\n        (fun c -&gt; c.Membership = \"gold\")\n        (fun c -&gt; c.PurchaseCount &gt;= 100)\n        (fun c -&gt; c.TotalSpent &gt;= 100000)\n    ]\n\npremiumCustomer { Membership = \"gold\"; PurchaseCount = 0; TotalSpent = 0 }\n// =&gt; true\npremiumCustomer { Membership = \"bronze\"; PurchaseCount = 100; TotalSpent = 0 }\n// =&gt; true\npremiumCustomer { Membership = \"bronze\"; PurchaseCount = 10; TotalSpent = 1000 }\n// =&gt; false\n</code></pre>"},{"location":"fsharp/02-function-composition/#clojure-scala-f","title":"Clojure / Scala / F# \u6bd4\u8f03","text":"\u6982\u5ff5 Clojure Scala F# \u95a2\u6570\u5408\u6210\uff08\u5de6\u304b\u3089\u53f3\uff09 <code>-&gt;&gt;</code>\uff08\u30b9\u30ec\u30c3\u30c7\u30a3\u30f3\u30b0\uff09 <code>andThen</code> <code>&gt;&gt;</code> \u95a2\u6570\u5408\u6210\uff08\u53f3\u304b\u3089\u5de6\uff09 <code>comp</code> <code>compose</code> <code>&lt;&lt;</code> \u90e8\u5206\u9069\u7528 <code>partial</code> \u30ab\u30ea\u30fc\u5316\u69cb\u6587 \u81ea\u52d5\u30ab\u30ea\u30fc\u5316 \u4e26\u5217\u9069\u7528 <code>juxt</code> \u30bf\u30d7\u30eb \u30bf\u30d7\u30eb \u8ff0\u8a9e\u5408\u6210 AND <code>every-pred</code> <code>forall</code> <code>List.forall</code> \u8ff0\u8a9e\u5408\u6210 OR <code>some-fn</code> <code>exists</code> <code>List.exists</code>"},{"location":"fsharp/02-function-composition/#_14","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u95a2\u6570\u5408\u6210\u3068\u9ad8\u968e\u95a2\u6570\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li><code>&gt;&gt;</code> / <code>&lt;&lt;</code>: \u95a2\u6570\u3092\u5408\u6210\u3057\u3066\u65b0\u3057\u3044\u95a2\u6570\u3092\u4f5c\u6210</li> <li>\u30ab\u30ea\u30fc\u5316: F# \u3067\u306f\u5168\u95a2\u6570\u304c\u81ea\u52d5\u7684\u306b\u30ab\u30ea\u30fc\u5316</li> <li>\u30bf\u30d7\u30eb: \u8907\u6570\u306e\u95a2\u6570\u3092\u4e26\u5217\u9069\u7528\u3057\u3066\u7d50\u679c\u3092\u53d6\u5f97</li> <li>\u9ad8\u968e\u95a2\u6570: \u30ed\u30b0\u3001\u30ea\u30c8\u30e9\u30a4\u3001\u30e1\u30e2\u5316\u306a\u3069\u306e\u6a2a\u65ad\u7684\u95a2\u5fc3\u4e8b\u3092\u62bd\u8c61\u5316</li> <li>\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3: \u51e6\u7406\u306e\u6d41\u308c\u3092\u95a2\u6570\u306e\u30c1\u30a7\u30fc\u30f3\u3068\u3057\u3066\u8868\u73fe</li> <li>\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3: \u95a2\u6570\u5408\u6210\u306b\u3088\u308b\u67d4\u8edf\u306a\u691c\u8a3c\u30ed\u30b8\u30c3\u30af</li> <li>\u8ff0\u8a9e\u5408\u6210: AND/OR \u3067\u8907\u6570\u306e\u6761\u4ef6\u3092\u7d44\u307f\u5408\u308f\u305b</li> </ol> <p>\u3053\u308c\u3089\u306e\u30c6\u30af\u30cb\u30c3\u30af\u306b\u3088\u308a\u3001\u5c0f\u3055\u304f\u518d\u5229\u7528\u53ef\u80fd\u306a\u95a2\u6570\u304b\u3089\u8907\u96d1\u306a\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u3092\u69cb\u7bc9\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"fsharp/02-function-composition/#_15","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/fsharp/part1/src/Library.fs</code>\uff08Composition \u30e2\u30b8\u30e5\u30fc\u30eb\uff09</li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/fsharp/part1/tests/Tests.fs</code></li> </ul>"},{"location":"fsharp/02-function-composition/#_16","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001\u591a\u614b\u6027\u3068\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u5224\u5225\u5171\u7528\u4f53\u3001\u30a2\u30af\u30c6\u30a3\u30d6\u30d1\u30bf\u30fc\u30f3\u3001\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u6d3b\u7528\u3057\u305f\u67d4\u8edf\u306a\u8a2d\u8a08\u30d1\u30bf\u30fc\u30f3\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"fsharp/03-polymorphism/","title":"\u7b2c3\u7ae0: \u591a\u614b\u6027\u3068\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1","text":""},{"location":"fsharp/03-polymorphism/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u591a\u614b\u6027\uff08\u30dd\u30ea\u30e2\u30fc\u30d5\u30a3\u30ba\u30e0\uff09\u306f\u3001\u540c\u3058\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u7570\u306a\u308b\u632f\u308b\u821e\u3044\u3092\u5b9f\u73fe\u3059\u308b\u5f37\u529b\u306a\u6982\u5ff5\u3067\u3059\u3002F# \u3067\u306f\u3001\u5224\u5225\u5171\u7528\u4f53\u3001\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3001\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3001\u30a2\u30af\u30c6\u30a3\u30d6\u30d1\u30bf\u30fc\u30f3\u3068\u3044\u3046\u8907\u6570\u306e\u30e1\u30ab\u30cb\u30ba\u30e0\u3067\u591a\u614b\u6027\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u3053\u308c\u3089\u306e\u30e1\u30ab\u30cb\u30ba\u30e0\u3092\u4f7f\u3044\u5206\u3051\u3066\u3001\u67d4\u8edf\u3067\u62e1\u5f35\u6027\u306e\u9ad8\u3044\u30b3\u30fc\u30c9\u3092\u66f8\u304f\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"fsharp/03-polymorphism/#1","title":"1. \u5224\u5225\u5171\u7528\u4f53\u306b\u3088\u308b\u591a\u614b\u6027\uff08\u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b\uff09","text":"<p>F# \u306e\u5224\u5225\u5171\u7528\u4f53\uff08Discriminated Union\uff09\u306f\u3001\u6709\u9650\u306e\u578b\u306e\u30d0\u30ea\u30a8\u30fc\u30b7\u30e7\u30f3\u3092\u5b9a\u7fa9\u3059\u308b\u306e\u306b\u6700\u9069\u3067\u3059\u3002\u30b3\u30f3\u30d1\u30a4\u30e9\u304c\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u306e\u7db2\u7f85\u6027\u3092\u30c1\u30a7\u30c3\u30af\u3057\u3066\u304f\u308c\u307e\u3059\u3002</p>"},{"location":"fsharp/03-polymorphism/#_2","title":"\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9","text":"<pre><code>/// \u56f3\u5f62\u3092\u8868\u3059\u5224\u5225\u5171\u7528\u4f53\ntype Shape =\n    | Rectangle of width: float * height: float\n    | Circle of radius: float\n    | Triangle of baseLength: float * height: float\n\n/// \u56f3\u5f62\u306e\u9762\u7a4d\u3092\u8a08\u7b97\u3059\u308b\nlet calculateArea shape =\n    match shape with\n    | Rectangle(w, h) -&gt; w * h\n    | Circle r -&gt; System.Math.PI * r * r\n    | Triangle(b, h) -&gt; b * h / 2.0\n\n// \u4f7f\u7528\u4f8b\ncalculateArea (Rectangle(4.0, 5.0))  // =&gt; 20.0\ncalculateArea (Circle(3.0))          // =&gt; 28.27...\ncalculateArea (Triangle(6.0, 5.0))   // =&gt; 15.0\n</code></pre>"},{"location":"fsharp/03-polymorphism/#_3","title":"\u5224\u5225\u5171\u7528\u4f53\u306e\u5229\u70b9","text":"<ol> <li>\u7db2\u7f85\u6027\u30c1\u30a7\u30c3\u30af: \u30b3\u30f3\u30d1\u30a4\u30e9\u304c\u3059\u3079\u3066\u306e\u30b1\u30fc\u30b9\u304c\u30ab\u30d0\u30fc\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d</li> <li>\u578b\u5b89\u5168\u6027: \u4e0d\u6b63\u306a\u578b\u306e\u5024\u3092\u6e21\u305b\u306a\u3044</li> <li>\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0: \u5206\u5c90\u3092\u7c21\u6f54\u306b\u8a18\u8ff0\u53ef\u80fd</li> </ol>"},{"location":"fsharp/03-polymorphism/#2","title":"2. \u8907\u5408\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1","text":"<p>\u30bf\u30d7\u30eb\u3092\u4f7f\u3063\u305f\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3067\u3001\u8907\u6570\u306e\u5024\u306b\u57fa\u3065\u304f\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u3092\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002</p> <pre><code>/// \u652f\u6255\u3044\u65b9\u6cd5\ntype PaymentMethod =\n    | CreditCard\n    | BankTransfer\n    | Cash\n\n/// \u901a\u8ca8\ntype Currency =\n    | JPY\n    | USD\n    | EUR\n\n/// \u652f\u6255\u3044\u60c5\u5831\ntype Payment =\n    { Method: PaymentMethod\n      Currency: Currency\n      Amount: int }\n\n/// \u652f\u6255\u3044\u7d50\u679c\ntype PaymentResult =\n    { Status: string\n      Message: string\n      Amount: int\n      Converted: int option }\n\n/// \u652f\u6255\u3044\u3092\u51e6\u7406\u3059\u308b\uff08\u8907\u5408\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\uff09\nlet processPayment payment =\n    match payment.Method, payment.Currency with\n    | CreditCard, JPY -&gt;\n        { Status = \"processed\"\n          Message = \"\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\uff08\u5186\uff09\u3067\u51e6\u7406\u3057\u307e\u3057\u305f\"\n          Amount = payment.Amount\n          Converted = None }\n    | CreditCard, USD -&gt;\n        { Status = \"processed\"\n          Message = \"Credit card (USD) processed\"\n          Amount = payment.Amount\n          Converted = Some(payment.Amount * 150) }\n    | BankTransfer, JPY -&gt;\n        { Status = \"pending\"\n          Message = \"\u9280\u884c\u632f\u8fbc\u3092\u53d7\u3051\u4ed8\u3051\u307e\u3057\u305f\"\n          Amount = payment.Amount\n          Converted = None }\n    | _, _ -&gt;\n        { Status = \"error\"\n          Message = \"\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u652f\u6255\u3044\u65b9\u6cd5\u3067\u3059\"\n          Amount = payment.Amount\n          Converted = None }\n\n// \u4f7f\u7528\u4f8b\nprocessPayment { Method = CreditCard; Currency = JPY; Amount = 1000 }\n// =&gt; { Status = \"processed\"; Message = \"\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\uff08\u5186\uff09\u3067\u51e6\u7406\u3057\u307e\u3057\u305f\"; ... }\n</code></pre>"},{"location":"fsharp/03-polymorphism/#3_1","title":"3. \u968e\u5c64\u7684\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\uff08\u578b\u968e\u5c64\u306e\u6a21\u5023\uff09","text":"<p>\u5224\u5225\u5171\u7528\u4f53\u3092\u4f7f\u3063\u3066\u578b\u306e\u968e\u5c64\u3092\u5b9a\u7fa9\u3057\u3001\u5404\u578b\u306b\u56fa\u6709\u306e\u632f\u308b\u821e\u3044\u3092\u6301\u305f\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</p> <pre><code>/// \u53e3\u5ea7\u30bf\u30a4\u30d7\ntype AccountType =\n    | Savings\n    | PremiumSavings\n    | Checking\n\n/// \u53e3\u5ea7\ntype Account =\n    { AccountType: AccountType\n      Balance: int }\n\n/// \u5229\u7387\u3092\u53d6\u5f97\nlet getInterestRate accountType =\n    match accountType with\n    | Savings -&gt; 0.02\n    | PremiumSavings -&gt; 0.05\n    | Checking -&gt; 0.001\n\n/// \u5229\u606f\u3092\u8a08\u7b97\nlet calculateInterest account =\n    float account.Balance * getInterestRate account.AccountType\n\n// \u4f7f\u7528\u4f8b\ncalculateInterest { AccountType = Savings; Balance = 10000 }        // =&gt; 200.0\ncalculateInterest { AccountType = PremiumSavings; Balance = 10000 } // =&gt; 500.0\ncalculateInterest { AccountType = Checking; Balance = 10000 }       // =&gt; 10.0\n</code></pre>"},{"location":"fsharp/03-polymorphism/#4-f","title":"4. \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\uff08F# \u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u6a5f\u80fd\uff09","text":"<p>F# \u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306f\u3001\u7279\u5b9a\u306e\u64cd\u4f5c\u30bb\u30c3\u30c8\u3092\u5b9a\u7fa9\u3059\u308b\u5951\u7d04\u3067\u3059\u3002\u8907\u6570\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"fsharp/03-polymorphism/#_4","title":"\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306e\u5b9a\u7fa9","text":"<pre><code>/// \u30d0\u30a6\u30f3\u30c7\u30a3\u30f3\u30b0\u30dc\u30c3\u30af\u30b9\ntype BoundingBox =\n    { X: float; Y: float; Width: float; Height: float }\n\n/// \u63cf\u753b\u53ef\u80fd\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\ntype IDrawable =\n    abstract member Draw: unit -&gt; string\n    abstract member GetBoundingBox: unit -&gt; BoundingBox\n\n/// \u5909\u63db\u53ef\u80fd\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\ntype ITransformable&lt;'T&gt; =\n    abstract member Translate: float * float -&gt; 'T\n    abstract member Scale: float -&gt; 'T\n    abstract member Rotate: float -&gt; 'T\n</code></pre>"},{"location":"fsharp/03-polymorphism/#_5","title":"\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306e\u5229\u70b9","text":"<ol> <li>\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9: \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3088\u308a\u9ad8\u901f\u306a\u578b\u30d9\u30fc\u30b9\u306e\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1</li> <li>\u660e\u78ba\u306a\u30b3\u30f3\u30c8\u30e9\u30af\u30c8: \u5b9f\u88c5\u3059\u3079\u304d\u30e1\u30bd\u30c3\u30c9\u304c\u660e\u793a\u7684</li> <li>\u8907\u6570\u5b9f\u88c5: \u8907\u6570\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u7d44\u307f\u5408\u308f\u305b\u53ef\u80fd</li> </ol>"},{"location":"fsharp/03-polymorphism/#5","title":"5. \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u5b9f\u88c5\u3059\u308b\u30ec\u30b3\u30fc\u30c9","text":"<pre><code>/// \u63cf\u753b\u53ef\u80fd\u306a\u9577\u65b9\u5f62\ntype DrawableRectangle =\n    { X: float; Y: float; Width: float; Height: float }\n\n    interface IDrawable with\n        member this.Draw() =\n            sprintf \"Rectangle at (%.1f,%.1f) with size %.1fx%.1f\"\n                this.X this.Y this.Width this.Height\n        member this.GetBoundingBox() =\n            { X = this.X; Y = this.Y; Width = this.Width; Height = this.Height }\n\n    interface ITransformable&lt;DrawableRectangle&gt; with\n        member this.Translate(dx, dy) =\n            { this with X = this.X + dx; Y = this.Y + dy }\n        member this.Scale(factor) =\n            { this with Width = this.Width * factor; Height = this.Height * factor }\n        member this.Rotate(_) = this\n\n/// \u63cf\u753b\u53ef\u80fd\u306a\u5186\ntype DrawableCircle =\n    { X: float; Y: float; Radius: float }\n\n    interface IDrawable with\n        member this.Draw() =\n            sprintf \"Circle at (%.1f,%.1f) with radius %.1f\" this.X this.Y this.Radius\n        member this.GetBoundingBox() =\n            { X = this.X - this.Radius\n              Y = this.Y - this.Radius\n              Width = this.Radius * 2.0\n              Height = this.Radius * 2.0 }\n\n    interface ITransformable&lt;DrawableCircle&gt; with\n        member this.Translate(dx, dy) =\n            { this with X = this.X + dx; Y = this.Y + dy }\n        member this.Scale(factor) =\n            { this with Radius = this.Radius * factor }\n        member this.Rotate(_) = this\n\n// \u30d8\u30eb\u30d1\u30fc\u95a2\u6570\uff08\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u30e1\u30bd\u30c3\u30c9\u3092\u547c\u3073\u51fa\u3057\u3084\u3059\u304f\u3059\u308b\uff09\nlet draw (drawable: IDrawable) = drawable.Draw()\nlet getBoundingBox (drawable: IDrawable) = drawable.GetBoundingBox()\n\n// \u4f7f\u7528\u4f8b\nlet rect = { DrawableRectangle.X = 10.0; Y = 20.0; Width = 100.0; Height = 50.0 }\ndraw rect  // =&gt; \"Rectangle at (10.0,20.0) with size 100.0x50.0\"\n\nlet circle = { DrawableCircle.X = 50.0; Y = 50.0; Radius = 25.0 }\ngetBoundingBox circle  // =&gt; { X = 25.0; Y = 25.0; Width = 50.0; Height = 50.0 }\n</code></pre>"},{"location":"fsharp/03-polymorphism/#6","title":"6. \u30a2\u30af\u30c6\u30a3\u30d6\u30d1\u30bf\u30fc\u30f3\uff08\u65e2\u5b58\u578b\u3078\u306e\u62e1\u5f35\uff09","text":"<p>\u30a2\u30af\u30c6\u30a3\u30d6\u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3092\u62e1\u5f35\u3057\u3066\u3001\u4efb\u610f\u306e\u5909\u63db\u30ed\u30b8\u30c3\u30af\u3092\u9069\u7528\u3067\u304d\u307e\u3059\u3002</p> <pre><code>/// \u6587\u5b57\u5217\u5316\u30a2\u30af\u30c6\u30a3\u30d6\u30d1\u30bf\u30fc\u30f3\uff08Map\u7528\uff09\nlet (|MapToString|) (m: Map&lt;string, obj&gt;) =\n    let pairs = m |&gt; Map.toSeq |&gt; Seq.map (fun (k, v) -&gt; sprintf \"%s: %O\" k v)\n    \"{\" + System.String.Join(\", \", pairs) + \"}\"\n\n/// \u6587\u5b57\u5217\u5316\u30a2\u30af\u30c6\u30a3\u30d6\u30d1\u30bf\u30fc\u30f3\uff08\u30ea\u30b9\u30c8\u7528\uff09\nlet (|ListToString|) (l: 'a list) =\n    \"[\" + System.String.Join(\", \", l |&gt; List.map string) + \"]\"\n\n/// \u6587\u5b57\u5217\u5316\u95a2\u6570\nlet stringify value =\n    match box value with\n    | :? Map&lt;string, obj&gt; as m -&gt;\n        let (MapToString s) = m\n        s\n    | :? (int list) as l -&gt;\n        let (ListToString s) = l\n        s\n    | :? string as s -&gt; s\n    | :? int as i -&gt; string i\n    | null -&gt; \"nil\"\n    | _ -&gt; sprintf \"%O\" value\n\n// \u4f7f\u7528\u4f8b\nstringify (Map.ofList [\"name\", box \"\u7530\u4e2d\"; \"age\", box 30])\n// =&gt; \"{name: \u7530\u4e2d, age: 30}\"\n\nstringify [1; 2; 3]\n// =&gt; \"[1, 2, 3]\"\n</code></pre>"},{"location":"fsharp/03-polymorphism/#7","title":"7. \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u30d1\u30bf\u30fc\u30f3\uff08\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u7ba1\u7406\uff09","text":"<p>\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u4f7f\u3063\u3066\u3001\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u7ba1\u7406\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p> <pre><code>/// \u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\ntype ILifecycle&lt;'T&gt; =\n    abstract member Start: unit -&gt; 'T\n    abstract member Stop: unit -&gt; 'T\n\n/// \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\ntype DatabaseConnection =\n    { Host: string; Port: int; Connected: bool }\n\n    static member Create(host, port) =\n        { Host = host; Port = port; Connected = false }\n\n    interface ILifecycle&lt;DatabaseConnection&gt; with\n        member this.Start() =\n            printfn \"\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u63a5\u7d9a\u4e2d: %s : %d\" this.Host this.Port\n            { this with Connected = true }\n        member this.Stop() =\n            printfn \"\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\u3092\u5207\u65ad\u4e2d\"\n            { this with Connected = false }\n\n/// Web\u30b5\u30fc\u30d0\u30fc\ntype WebServer =\n    { Port: int; Db: DatabaseConnection; Running: bool }\n\n    static member Create(port, db) =\n        { Port = port; Db = db; Running = false }\n\n    interface ILifecycle&lt;WebServer&gt; with\n        member this.Start() =\n            printfn \"Web\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u4e2d \u30dd\u30fc\u30c8: %d\" this.Port\n            let startedDb = (this.Db :&gt; ILifecycle&lt;DatabaseConnection&gt;).Start()\n            { this with Db = startedDb; Running = true }\n        member this.Stop() =\n            printfn \"Web\u30b5\u30fc\u30d0\u30fc\u3092\u505c\u6b62\u4e2d\"\n            let stoppedDb = (this.Db :&gt; ILifecycle&lt;DatabaseConnection&gt;).Stop()\n            { this with Db = stoppedDb; Running = false }\n\n// \u4f7f\u7528\u4f8b\nlet db = DatabaseConnection.Create(\"localhost\", 5432)\nlet server = WebServer.Create(8080, db)\n\nlet startedServer = (server :&gt; ILifecycle&lt;WebServer&gt;).Start()\n// \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u63a5\u7d9a\u4e2d: localhost : 5432\n// Web\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u4e2d \u30dd\u30fc\u30c8: 8080\n\nlet stoppedServer = (startedServer :&gt; ILifecycle&lt;WebServer&gt;).Stop()\n// Web\u30b5\u30fc\u30d0\u30fc\u3092\u505c\u6b62\u4e2d\n// \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\u3092\u5207\u65ad\u4e2d\n</code></pre>"},{"location":"fsharp/03-polymorphism/#8-strategy","title":"8. \u6761\u4ef6\u5206\u5c90\u306e\u7f6e\u304d\u63db\u3048\uff08Strategy \u30d1\u30bf\u30fc\u30f3\uff09","text":"<p>\u591a\u614b\u6027\u3092\u4f7f\u3063\u3066\u3001switch/case \u6587\u306b\u3088\u308b\u578b\u5224\u5b9a\u3092\u6392\u9664\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"fsharp/03-polymorphism/#before","title":"Before\uff08\u6761\u4ef6\u5206\u5c90\uff09","text":"<pre><code>// \u60aa\u3044\u4f8b\uff1a\u578b\u306b\u3088\u308b\u6761\u4ef6\u5206\u5c90\nlet sendNotificationBad notificationType message (opts: Map&lt;string, string&gt;) =\n    match notificationType with\n    | \"email\" -&gt;\n        {| Type = \"email\"; To = opts.[\"to\"]; Body = message |}\n    | \"sms\" -&gt;\n        {| Type = \"sms\"; To = opts.[\"phone\"]; Body = message.[..min 159 (message.Length - 1)] |}\n    | \"push\" -&gt;\n        {| Type = \"push\"; Device = opts.[\"device\"]; Body = message |}\n    | _ -&gt; failwith \"\u672a\u77e5\u306e\u901a\u77e5\u30bf\u30a4\u30d7\"\n</code></pre>"},{"location":"fsharp/03-polymorphism/#after","title":"After\uff08\u591a\u614b\u6027\uff09","text":"<pre><code>/// \u901a\u77e5\u7d50\u679c\ntype NotificationResult =\n    { NotificationType: string\n      To: string\n      Body: string\n      Status: string\n      Subject: string option }\n\n/// \u901a\u77e5\u9001\u4fe1\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\ntype INotificationSender =\n    abstract member SendNotification: string -&gt; NotificationResult\n    abstract member DeliveryTime: string\n\n/// \u30e1\u30fc\u30eb\u901a\u77e5\ntype EmailNotification =\n    { To: string; Subject: string }\n    interface INotificationSender with\n        member this.SendNotification(message) =\n            { NotificationType = \"email\"\n              To = this.To\n              Body = message\n              Status = \"sent\"\n              Subject = Some this.Subject }\n        member this.DeliveryTime = \"1-2\u5206\"\n\n/// SMS\u901a\u77e5\ntype SMSNotification =\n    { PhoneNumber: string }\n    interface INotificationSender with\n        member this.SendNotification(message) =\n            let truncated = if message.Length &gt; 160 then message.[..156] else message\n            { NotificationType = \"sms\"\n              To = this.PhoneNumber\n              Body = truncated\n              Status = \"sent\"\n              Subject = None }\n        member this.DeliveryTime = \"\u6570\u79d2\"\n\n/// \u30d7\u30c3\u30b7\u30e5\u901a\u77e5\ntype PushNotification =\n    { DeviceToken: string }\n    interface INotificationSender with\n        member this.SendNotification(message) =\n            { NotificationType = \"push\"\n              To = this.DeviceToken\n              Body = message\n              Status = \"sent\"\n              Subject = None }\n        member this.DeliveryTime = \"\u5373\u6642\"\n\n/// \u901a\u77e5\u3092\u4f5c\u6210\u3059\u308b\u30d5\u30a1\u30af\u30c8\u30ea\u95a2\u6570\nlet createNotification notificationType (opts: Map&lt;string, string&gt;) : INotificationSender =\n    match notificationType with\n    | \"email\" -&gt;\n        { To = opts |&gt; Map.tryFind \"to\" |&gt; Option.defaultValue \"\"\n          Subject = opts |&gt; Map.tryFind \"subject\" |&gt; Option.defaultValue \"\u901a\u77e5\" }\n    | \"sms\" -&gt;\n        { PhoneNumber = opts |&gt; Map.tryFind \"phone\" |&gt; Option.defaultValue \"\" }\n    | \"push\" -&gt;\n        { DeviceToken = opts |&gt; Map.tryFind \"device\" |&gt; Option.defaultValue \"\" }\n    | _ -&gt; failwithf \"\u672a\u77e5\u306e\u901a\u77e5\u30bf\u30a4\u30d7: %s\" notificationType\n\n// \u4f7f\u7528\u4f8b\nlet email = createNotification \"email\" (Map.ofList [\"to\", \"user@example.com\"])\nemail.SendNotification(\"\u91cd\u8981\u306a\u304a\u77e5\u3089\u305b\")\n// =&gt; { NotificationType = \"email\"; To = \"user@example.com\"; Body = \"\u91cd\u8981\u306a\u304a\u77e5\u3089\u305b\"; ... }\n</code></pre>"},{"location":"fsharp/03-polymorphism/#9-expression-problem","title":"9. \u5f0f\u30c4\u30ea\u30fc\u30d1\u30bf\u30fc\u30f3\uff08Expression Problem \u306e\u89e3\u6c7a\uff09","text":"<p>\u5224\u5225\u5171\u7528\u4f53\u3068\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3092\u4f7f\u3063\u3066\u3001\u5f0f\u306e\u8a55\u4fa1\u3084\u5909\u63db\u3092\u884c\u3044\u307e\u3059\u3002</p> <pre><code>/// \u5f0f\u3092\u8868\u3059\u5224\u5225\u5171\u7528\u4f53\ntype Expr =\n    | Num of int\n    | Add of Expr * Expr\n    | Mul of Expr * Expr\n    | Neg of Expr\n\n/// \u5f0f\u3092\u8a55\u4fa1\u3059\u308b\nlet rec eval expr =\n    match expr with\n    | Num n -&gt; n\n    | Add(e1, e2) -&gt; eval e1 + eval e2\n    | Mul(e1, e2) -&gt; eval e1 * eval e2\n    | Neg e -&gt; -(eval e)\n\n/// \u5f0f\u3092\u6587\u5b57\u5217\u5316\u3059\u308b\nlet rec exprToString expr =\n    match expr with\n    | Num n -&gt; string n\n    | Add(e1, e2) -&gt; sprintf \"(%s + %s)\" (exprToString e1) (exprToString e2)\n    | Mul(e1, e2) -&gt; sprintf \"(%s * %s)\" (exprToString e1) (exprToString e2)\n    | Neg e -&gt; sprintf \"(-%s)\" (exprToString e)\n\n/// \u5f0f\u3092\u7c21\u7d04\u3059\u308b\uff08\u5b9a\u6570\u7573\u307f\u8fbc\u307f\uff09\nlet rec simplify expr =\n    match expr with\n    | Add(Num 0, e) | Add(e, Num 0) -&gt; simplify e\n    | Mul(Num 0, _) | Mul(_, Num 0) -&gt; Num 0\n    | Mul(Num 1, e) | Mul(e, Num 1) -&gt; simplify e\n    | Neg(Neg e) -&gt; simplify e\n    | Add(e1, e2) -&gt; Add(simplify e1, simplify e2)\n    | Mul(e1, e2) -&gt; Mul(simplify e1, simplify e2)\n    | Neg e -&gt; Neg(simplify e)\n    | e -&gt; e\n\n// \u4f7f\u7528\u4f8b\nlet expr = Mul(Add(Num 2, Num 3), Num 4)\neval expr          // =&gt; 20\nexprToString expr  // =&gt; \"((2 + 3) * 4)\"\n\nsimplify (Add(Num 0, Num 5))  // =&gt; Num 5\nsimplify (Mul(Num 1, Num 5))  // =&gt; Num 5\n</code></pre>"},{"location":"fsharp/03-polymorphism/#clojure-scala-f","title":"Clojure / Scala / F# \u6bd4\u8f03","text":"\u6982\u5ff5 Clojure Scala F# \u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9 sealed trait \u5224\u5225\u5171\u7528\u4f53 \u8907\u5408\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1 \u30d9\u30af\u30bf\u30fc\u30ad\u30fc \u30bf\u30d7\u30eb\u30de\u30c3\u30c1 \u30bf\u30d7\u30eb\u30de\u30c3\u30c1 \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9 \u30d7\u30ed\u30c8\u30b3\u30eb trait interface \u578b\u968e\u5c64 derive \u7d99\u627f \u5224\u5225\u5171\u7528\u4f53 \u65e2\u5b58\u578b\u62e1\u5f35 extend-protocol \u578b\u30af\u30e9\u30b9 \u30a2\u30af\u30c6\u30a3\u30d6\u30d1\u30bf\u30fc\u30f3 \u30d5\u30a1\u30af\u30c8\u30ea \u95a2\u6570 \u30b3\u30f3\u30d1\u30cb\u30aa\u30f3\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 \u95a2\u6570/\u9759\u7684\u30e1\u30bd\u30c3\u30c9"},{"location":"fsharp/03-polymorphism/#_6","title":"\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3068\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306e\u4f7f\u3044\u5206\u3051","text":"\u7279\u5fb4 \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0 \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9 \u30c7\u30a3\u30b9\u30d1\u30c3\u30c1 \u5024\u306b\u57fa\u3065\u304f \u578b\u306b\u57fa\u3065\u304f \u62e1\u5f35\u6027 \u30af\u30ed\u30fc\u30ba\u30c9 \u30aa\u30fc\u30d7\u30f3 \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9 \u826f\u3044 \u6700\u826f \u7528\u9014 ADT\u3001\u6709\u9650\u306e\u578b \u5171\u901a\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9"},{"location":"fsharp/03-polymorphism/#_7","title":"\u4f7f\u3044\u5206\u3051\u306e\u6307\u91dd","text":"<ul> <li>\u5224\u5225\u5171\u7528\u4f53 + \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0: \u6709\u9650\u3067\u56fa\u5b9a\u3055\u308c\u305f\u578b\u306e\u30d0\u30ea\u30a8\u30fc\u30b7\u30e7\u30f3</li> <li>\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9: \u65b0\u3057\u3044\u578b\u304c\u8ffd\u52a0\u3055\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u5834\u5408</li> <li>\u30a2\u30af\u30c6\u30a3\u30d6\u30d1\u30bf\u30fc\u30f3: \u65e2\u5b58\u306e\u578b\u306b\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3092\u62e1\u5f35\u3057\u305f\u3044\u5834\u5408</li> </ul>"},{"location":"fsharp/03-polymorphism/#_8","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001F# \u306b\u304a\u3051\u308b\u591a\u614b\u6027\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u5224\u5225\u5171\u7528\u4f53: \u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b\u306b\u3088\u308b\u6709\u9650\u306e\u578b\u30d0\u30ea\u30a8\u30fc\u30b7\u30e7\u30f3</li> <li>\u8907\u5408\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1: \u30bf\u30d7\u30eb\u306b\u3088\u308b\u8907\u6570\u306e\u5024\u306b\u57fa\u3065\u304f\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0</li> <li>\u968e\u5c64\u7684\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1: \u5224\u5225\u5171\u7528\u4f53\u3092\u4f7f\u3063\u305f\u578b\u968e\u5c64</li> <li>\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9: \u5171\u901a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306e\u5b9a\u7fa9\u3068\u8907\u6570\u5b9f\u88c5</li> <li>\u30a2\u30af\u30c6\u30a3\u30d6\u30d1\u30bf\u30fc\u30f3: \u65e2\u5b58\u578b\u3078\u306e\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u62e1\u5f35</li> <li>\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u30d1\u30bf\u30fc\u30f3: \u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u7ba1\u7406</li> <li>Strategy \u30d1\u30bf\u30fc\u30f3: \u6761\u4ef6\u5206\u5c90\u306e\u7f6e\u304d\u63db\u3048</li> <li>\u5f0f\u30c4\u30ea\u30fc: \u8a55\u4fa1\u30fb\u5909\u63db\u30fb\u7c21\u7d04\u306e\u5b9f\u88c5</li> </ol> <p>\u3053\u308c\u3089\u306e\u30e1\u30ab\u30cb\u30ba\u30e0\u3092\u9069\u5207\u306b\u4f7f\u3044\u5206\u3051\u308b\u3053\u3068\u3067\u3001\u62e1\u5f35\u6027\u304c\u9ad8\u304f\u4fdd\u5b88\u3057\u3084\u3059\u3044\u30b3\u30fc\u30c9\u3092\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"fsharp/03-polymorphism/#_9","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/fsharp/part1/src/Library.fs</code>\uff08Polymorphism \u30e2\u30b8\u30e5\u30fc\u30eb\uff09</li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/fsharp/part1/tests/Tests.fs</code></li> </ul>"},{"location":"fsharp/03-polymorphism/#_10","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u304b\u3089\u7b2c2\u90e8\u300c\u4ed5\u69d8\u3068\u30c6\u30b9\u30c8\u300d\u306b\u5165\u308a\u307e\u3059\u3002F# \u306e\u30c7\u30fc\u30bf\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3068\u4ed5\u69d8\u5b9a\u7fa9\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"fsharp/04-data-validation/","title":"\u7b2c4\u7ae0: \u30c7\u30fc\u30bf\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3","text":""},{"location":"fsharp/04-data-validation/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>F# \u3067\u306f\u3001\u5224\u5225\u5171\u7528\u4f53\u3001\u30b9\u30de\u30fc\u30c8\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3001<code>Result</code> \u578b\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u3053\u3068\u3067\u3001\u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u3068\u5b9f\u884c\u6642\u306e\u4e21\u65b9\u3067\u30c7\u30fc\u30bf\u306e\u6574\u5408\u6027\u3092\u4fdd\u8a3c\u3067\u304d\u307e\u3059\u3002\u672c\u7ae0\u3067\u306f\u3001<code>Result</code>\u3001<code>Validated</code> \u30d1\u30bf\u30fc\u30f3\u3001\u30c9\u30e1\u30a4\u30f3\u30d7\u30ea\u30df\u30c6\u30a3\u30d6\u3092\u4f7f\u3063\u305f\u30c7\u30fc\u30bf\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u306e\u5b9f\u73fe\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"fsharp/04-data-validation/#1-result","title":"1. \u57fa\u672c\u7684\u306a\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\uff08Result \u3092\u4f7f\u7528\uff09","text":""},{"location":"fsharp/04-data-validation/#result","title":"Result \u306b\u3088\u308b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3","text":"<p><code>Result&lt;'T, 'E&gt;</code> \u306f\u3001\u6210\u529f\u6642\u306b <code>Ok</code>\u3001\u5931\u6557\u6642\u306b <code>Error</code> \u3092\u8fd4\u3059\u578b\u3067\u3059\u3002\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u306b\u6700\u9069\u3067\u3059\u3002</p> <pre><code>/// \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u7d50\u679c\u306e\u578b\u30a8\u30a4\u30ea\u30a2\u30b9\ntype ValidationResult&lt;'T&gt; = Result&lt;'T, string list&gt;\n\n/// \u540d\u524d\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\nlet validateName (name: string) : ValidationResult&lt;string&gt; =\n    if System.String.IsNullOrEmpty(name) then\n        Error [\"\u540d\u524d\u306f\u7a7a\u306b\u3067\u304d\u307e\u305b\u3093\"]\n    elif name.Length &gt; 100 then\n        Error [\"\u540d\u524d\u306f100\u6587\u5b57\u4ee5\u5185\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"]\n    else\n        Ok name\n\n/// \u5e74\u9f62\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\nlet validateAge (age: int) : ValidationResult&lt;int&gt; =\n    if age &lt; 0 then\n        Error [\"\u5e74\u9f62\u306f0\u4ee5\u4e0a\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"]\n    elif age &gt; 150 then\n        Error [\"\u5e74\u9f62\u306f150\u4ee5\u4e0b\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"]\n    else\n        Ok age\n\n/// \u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\nlet validateEmail (email: string) : ValidationResult&lt;string&gt; =\n    let emailRegex = System.Text.RegularExpressions.Regex(@\".+@.+\\..+\")\n    if emailRegex.IsMatch(email) then Ok email\n    else Error [\"\u7121\u52b9\u306a\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u5f62\u5f0f\u3067\u3059\"]\n\n// \u4f7f\u7528\u4f8b\nvalidateName \"\u7530\u4e2d\u592a\u90ce\"  // =&gt; Ok \"\u7530\u4e2d\u592a\u90ce\"\nvalidateName \"\"          // =&gt; Error [\"\u540d\u524d\u306f\u7a7a\u306b\u3067\u304d\u307e\u305b\u3093\"]\nvalidateAge 25           // =&gt; Ok 25\nvalidateAge -1           // =&gt; Error [\"\u5e74\u9f62\u306f0\u4ee5\u4e0a\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"]\n</code></pre>"},{"location":"fsharp/04-data-validation/#2","title":"2. \u5217\u6319\u578b\u3068\u30b9\u30de\u30fc\u30c8\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf","text":""},{"location":"fsharp/04-data-validation/#_2","title":"\u5224\u5225\u5171\u7528\u4f53\u306b\u3088\u308b\u5217\u6319\u578b","text":"<pre><code>/// \u4f1a\u54e1\u7a2e\u5225\ntype Membership =\n    | Bronze\n    | Silver\n    | Gold\n    | Platinum\n\nmodule Membership =\n    let fromString (s: string) : ValidationResult&lt;Membership&gt; =\n        match s.ToLower() with\n        | \"bronze\" -&gt; Ok Bronze\n        | \"silver\" -&gt; Ok Silver\n        | \"gold\" -&gt; Ok Gold\n        | \"platinum\" -&gt; Ok Platinum\n        | _ -&gt; Error [sprintf \"\u7121\u52b9\u306a\u4f1a\u54e1\u7a2e\u5225: %s\" s]\n\n    let toString = function\n        | Bronze -&gt; \"bronze\"\n        | Silver -&gt; \"silver\"\n        | Gold -&gt; \"gold\"\n        | Platinum -&gt; \"platinum\"\n\n/// \u30b9\u30c6\u30fc\u30bf\u30b9\ntype Status =\n    | Active\n    | Inactive\n    | Suspended\n\n// \u4f7f\u7528\u4f8b\nMembership.fromString \"gold\"    // =&gt; Ok Gold\nMembership.fromString \"GOLD\"    // =&gt; Ok Gold\uff08\u5927\u6587\u5b57\u5c0f\u6587\u5b57\u3092\u533a\u5225\u3057\u306a\u3044\uff09\nMembership.fromString \"invalid\" // =&gt; Error [\"\u7121\u52b9\u306a\u4f1a\u54e1\u7a2e\u5225: invalid\"]\n</code></pre>"},{"location":"fsharp/04-data-validation/#3-validated","title":"3. Validated \u30d1\u30bf\u30fc\u30f3\uff08\u30a8\u30e9\u30fc\u84c4\u7a4d\uff09","text":"<p><code>Result</code> \u306f\u6700\u521d\u306e\u30a8\u30e9\u30fc\u3067\u505c\u6b62\u3057\u307e\u3059\u304c\u3001\u3059\u3079\u3066\u306e\u30a8\u30e9\u30fc\u3092\u53ce\u96c6\u3057\u305f\u3044\u5834\u5408\u306f <code>Validated</code> \u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002</p> <pre><code>/// Validated \u578b\uff08\u30a8\u30e9\u30fc\u84c4\u7a4d\u5bfe\u5fdc\uff09\ntype Validated&lt;'E, 'A&gt; =\n    | Valid of 'A\n    | Invalid of 'E list\n\nmodule Validated =\n    let valid a : Validated&lt;'E, 'A&gt; = Valid a\n    let invalid errors : Validated&lt;'E, 'A&gt; = Invalid errors\n\n    let map (f: 'A -&gt; 'B) (va: Validated&lt;'E, 'A&gt;) : Validated&lt;'E, 'B&gt; =\n        match va with\n        | Valid a -&gt; Valid (f a)\n        | Invalid errs -&gt; Invalid errs\n\n    let isValid = function\n        | Valid _ -&gt; true\n        | Invalid _ -&gt; false\n\n    let toResult = function\n        | Valid a -&gt; Ok a\n        | Invalid errs -&gt; Error errs\n\n    /// 2\u3064\u306e Validated \u3092\u7d50\u5408\uff08\u30a8\u30e9\u30fc\u84c4\u7a4d\uff09\n    let combine (f: 'A -&gt; 'B -&gt; 'C) (va: Validated&lt;'E, 'A&gt;) (vb: Validated&lt;'E, 'B&gt;) : Validated&lt;'E, 'C&gt; =\n        match va, vb with\n        | Valid a, Valid b -&gt; Valid (f a b)\n        | Invalid e1, Invalid e2 -&gt; Invalid (e1 @ e2)  // \u30a8\u30e9\u30fc\u3092\u84c4\u7a4d\uff01\n        | Invalid e, _ -&gt; Invalid e\n        | _, Invalid e -&gt; Invalid e\n</code></pre>"},{"location":"fsharp/04-data-validation/#_3","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>let result =\n    Validated.combine (+)\n        (Validated.invalid [\"error1\"])\n        (Validated.invalid [\"error2\"])\n// =&gt; Invalid [\"error1\"; \"error2\"]  // \u4e21\u65b9\u306e\u30a8\u30e9\u30fc\u304c\u53ce\u96c6\u3055\u308c\u308b\n</code></pre>"},{"location":"fsharp/04-data-validation/#4_1","title":"4. \u30c9\u30e1\u30a4\u30f3\u30d7\u30ea\u30df\u30c6\u30a3\u30d6\uff08\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u4ed8\u304d\u578b\uff09","text":"<p>\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u306a\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3092\u6301\u3064\u578b\u3067\u3001\u4e0d\u6b63\u306a\u5024\u306e\u751f\u6210\u3092\u9632\u304e\u307e\u3059\u3002</p> <pre><code>/// \u5546\u54c1ID\ntype ProductId = private ProductId of string\n\nmodule ProductId =\n    let private pattern = System.Text.RegularExpressions.Regex(@\"^PROD-\\d{5}$\")\n\n    let create (id: string) : Validated&lt;string, ProductId&gt; =\n        if pattern.IsMatch(id) then Validated.valid (ProductId id)\n        else Validated.invalid [sprintf \"\u7121\u52b9\u306a\u5546\u54c1ID\u5f62\u5f0f: %s (PROD-XXXXX\u306e\u5f62\u5f0f\u304c\u5fc5\u8981)\" id]\n\n    let value (ProductId id) = id\n    let unsafe id = ProductId id  // \u30c6\u30b9\u30c8\u7528\n\n/// \u4fa1\u683c\uff08\u6b63\u306e\u6570\uff09\ntype Price = private Price of decimal\n\nmodule Price =\n    let create (amount: decimal) : Validated&lt;string, Price&gt; =\n        if amount &lt;= 0m then Validated.invalid [\"\u4fa1\u683c\u306f\u6b63\u306e\u6570\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"]\n        else Validated.valid (Price amount)\n\n    let value (Price p) = p\n    let unsafe amount = Price amount\n\n/// \u6570\u91cf\uff08\u6b63\u306e\u6574\u6570\uff09\ntype Quantity = private Quantity of int\n\nmodule Quantity =\n    let create (qty: int) : Validated&lt;string, Quantity&gt; =\n        if qty &lt;= 0 then Validated.invalid [\"\u6570\u91cf\u306f\u6b63\u306e\u6574\u6570\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"]\n        else Validated.valid (Quantity qty)\n\n    let value (Quantity q) = q\n    let unsafe qty = Quantity qty\n\n// \u4f7f\u7528\u4f8b\nProductId.create \"PROD-00001\"  // =&gt; Valid (ProductId \"PROD-00001\")\nProductId.create \"INVALID\"     // =&gt; Invalid [\"\u7121\u52b9\u306a\u5546\u54c1ID\u5f62\u5f0f: INVALID...\"]\n\nPrice.create 1000m  // =&gt; Valid (Price 1000m)\nPrice.create 0m     // =&gt; Invalid [\"\u4fa1\u683c\u306f\u6b63\u306e\u6570\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"]\n</code></pre>"},{"location":"fsharp/04-data-validation/#5","title":"5. \u5546\u54c1\u30e2\u30c7\u30eb","text":""},{"location":"fsharp/04-data-validation/#_4","title":"\u30c9\u30e1\u30a4\u30f3\u30d7\u30ea\u30df\u30c6\u30a3\u30d6\u3092\u4f7f\u7528\u3057\u305f\u5546\u54c1\u578b","text":"<pre><code>/// \u5546\u54c1\ntype Product =\n    { Id: ProductId\n      Name: ProductName\n      Price: Price\n      Description: string option\n      Category: string option }\n\nmodule Product =\n    let create\n        (id: string)\n        (name: string)\n        (price: decimal)\n        (description: string option)\n        (category: string option)\n        : Validated&lt;string, Product&gt; =\n        Validated.combine3\n            (fun pid pname pprice -&gt;\n                { Id = pid\n                  Name = pname\n                  Price = pprice\n                  Description = description\n                  Category = category })\n            (ProductId.create id)\n            (ProductName.create name)\n            (Price.create price)\n\n// \u4f7f\u7528\u4f8b\nProduct.create \"PROD-00001\" \"\u30c6\u30b9\u30c8\u5546\u54c1\" 1000m None None\n// =&gt; Valid { Id = ProductId \"PROD-00001\"; Name = ProductName \"\u30c6\u30b9\u30c8\u5546\u54c1\"; Price = Price 1000m; ... }\n\nProduct.create \"INVALID\" \"\" -100m None None\n// =&gt; Invalid [\"\u7121\u52b9\u306a\u5546\u54c1ID\u5f62\u5f0f...\", \"\u5546\u54c1\u540d\u306f\u7a7a\u306b\u3067\u304d\u307e\u305b\u3093\", \"\u4fa1\u683c\u306f\u6b63\u306e\u6570\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"]\n// \u3059\u3079\u3066\u306e\u30a8\u30e9\u30fc\u304c\u84c4\u7a4d\u3055\u308c\u308b\uff01\n</code></pre>"},{"location":"fsharp/04-data-validation/#6","title":"6. \u6ce8\u6587\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30eb","text":"<pre><code>/// \u6ce8\u6587ID\ntype OrderId = private OrderId of string\n\nmodule OrderId =\n    let private pattern = System.Text.RegularExpressions.Regex(@\"^ORD-\\d{8}$\")\n    let create (id: string) : Validated&lt;string, OrderId&gt; =\n        if pattern.IsMatch(id) then Validated.valid (OrderId id)\n        else Validated.invalid [sprintf \"\u7121\u52b9\u306a\u6ce8\u6587ID\u5f62\u5f0f: %s\" id]\n\n/// \u6ce8\u6587\u30a2\u30a4\u30c6\u30e0\ntype OrderItem =\n    { ProductId: ProductId\n      Quantity: Quantity\n      Price: Price }\n\nmodule OrderItem =\n    let create (productId: string) (quantity: int) (price: decimal) : Validated&lt;string, OrderItem&gt; =\n        Validated.combine3\n            (fun pid qty pr -&gt; { ProductId = pid; Quantity = qty; Price = pr })\n            (ProductId.create productId)\n            (Quantity.create quantity)\n            (Price.create price)\n\n    let total (item: OrderItem) =\n        Price.value item.Price * decimal (Quantity.value item.Quantity)\n\n/// \u6ce8\u6587\ntype Order =\n    { OrderId: OrderId\n      CustomerId: CustomerId\n      Items: OrderItem list\n      OrderDate: System.DateTime\n      Total: decimal option\n      Status: Status option }\n\nmodule Order =\n    let calculateTotal (order: Order) =\n        order.Items |&gt; List.sumBy OrderItem.total\n</code></pre>"},{"location":"fsharp/04-data-validation/#7-adt","title":"7. \u6761\u4ef6\u4ed8\u304d\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\uff08ADT\uff09","text":"<p>\u30c7\u30fc\u30bf\u306e\u7a2e\u985e\u306b\u5fdc\u3058\u3066\u7570\u306a\u308b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u3092\u9069\u7528\u3059\u308b\u5834\u5408\u306f\u3001\u5224\u5225\u5171\u7528\u4f53\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002</p> <pre><code>/// \u901a\u77e5\uff08\u5224\u5225\u5171\u7528\u4f53\u306b\u3088\u308b\u6761\u4ef6\u4ed8\u304d\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\uff09\ntype Notification =\n    | EmailNotification of to': string * subject: string * body: string\n    | SMSNotification of phoneNumber: string * body: string\n    | PushNotification of deviceToken: string * body: string\n\nmodule Notification =\n    let private emailPattern = System.Text.RegularExpressions.Regex(@\".+@.+\\..+\")\n    let private phonePattern = System.Text.RegularExpressions.Regex(@\"\\d{2,4}-\\d{2,4}-\\d{4}\")\n\n    let createEmail (to': string) (subject: string) (body: string) : Validated&lt;string, Notification&gt; =\n        let errors = [\n            if not (emailPattern.IsMatch(to')) then \"\u7121\u52b9\u306a\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u5f62\u5f0f\u3067\u3059\"\n            if System.String.IsNullOrEmpty(subject) then \"\u4ef6\u540d\u306f\u7a7a\u306b\u3067\u304d\u307e\u305b\u3093\"\n            if System.String.IsNullOrEmpty(body) then \"\u672c\u6587\u306f\u7a7a\u306b\u3067\u304d\u307e\u305b\u3093\"\n        ]\n        if errors.IsEmpty then Validated.valid (EmailNotification(to', subject, body))\n        else Validated.invalid errors\n\n    let createSMS (phoneNumber: string) (body: string) : Validated&lt;string, Notification&gt; =\n        let errors = [\n            if not (phonePattern.IsMatch(phoneNumber)) then \"\u7121\u52b9\u306a\u96fb\u8a71\u756a\u53f7\u5f62\u5f0f\u3067\u3059\"\n            if System.String.IsNullOrEmpty(body) then \"\u672c\u6587\u306f\u7a7a\u306b\u3067\u304d\u307e\u305b\u3093\"\n        ]\n        if errors.IsEmpty then Validated.valid (SMSNotification(phoneNumber, body))\n        else Validated.invalid errors\n\n    let createPush (deviceToken: string) (body: string) : Validated&lt;string, Notification&gt; =\n        let errors = [\n            if System.String.IsNullOrEmpty(deviceToken) then \"\u30c7\u30d0\u30a4\u30b9\u30c8\u30fc\u30af\u30f3\u306f\u7a7a\u306b\u3067\u304d\u307e\u305b\u3093\"\n            if System.String.IsNullOrEmpty(body) then \"\u672c\u6587\u306f\u7a7a\u306b\u3067\u304d\u307e\u305b\u3093\"\n        ]\n        if errors.IsEmpty then Validated.valid (PushNotification(deviceToken, body))\n        else Validated.invalid errors\n\n// \u4f7f\u7528\u4f8b\nNotification.createEmail \"test@example.com\" \"\u30c6\u30b9\u30c8\" \"\u672c\u6587\"\n// =&gt; Valid (EmailNotification (\"test@example.com\", \"\u30c6\u30b9\u30c8\", \"\u672c\u6587\"))\n\nNotification.createSMS \"090-1234-5678\" \"\u672c\u6587\"\n// =&gt; Valid (SMSNotification (\"090-1234-5678\", \"\u672c\u6587\"))\n</code></pre>"},{"location":"fsharp/04-data-validation/#8","title":"8. \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3","text":""},{"location":"fsharp/04-data-validation/#_5","title":"\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u7d50\u679c\u306e\u69cb\u9020\u5316","text":"<pre><code>/// \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30ec\u30b9\u30dd\u30f3\u30b9\ntype ValidationResponse&lt;'T&gt; =\n    { Valid: bool\n      Data: 'T option\n      Errors: string list }\n\n/// Person \u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\nlet validatePerson (name: string) (age: int) (email: string option) : ValidationResponse&lt;Person&gt; =\n    let nameV =\n        if System.String.IsNullOrEmpty(name) then Validated.invalid [\"\u540d\u524d\u306f\u7a7a\u306b\u3067\u304d\u307e\u305b\u3093\"]\n        else Validated.valid name\n\n    let ageV =\n        if age &lt; 0 then Validated.invalid [\"\u5e74\u9f62\u306f0\u4ee5\u4e0a\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"]\n        else Validated.valid age\n\n    let validated =\n        Validated.combine\n            (fun n a -&gt; { Name = n; Age = a; Email = email })\n            nameV\n            ageV\n\n    match validated with\n    | Valid p -&gt; { Valid = true; Data = Some p; Errors = [] }\n    | Invalid e -&gt; { Valid = false; Data = None; Errors = e }\n\n// \u4f7f\u7528\u4f8b\nvalidatePerson \"\u7530\u4e2d\" 30 None\n// =&gt; { Valid = true; Data = Some { Name = \"\u7530\u4e2d\"; Age = 30; Email = None }; Errors = [] }\n\nvalidatePerson \"\" -1 None\n// =&gt; { Valid = false; Data = None; Errors = [\"\u540d\u524d\u306f\u7a7a\u306b\u3067\u304d\u307e\u305b\u3093\"; \"\u5e74\u9f62\u306f0\u4ee5\u4e0a\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"] }\n</code></pre>"},{"location":"fsharp/04-data-validation/#_6","title":"\u4f8b\u5916\u3092\u30b9\u30ed\u30fc\u3059\u308b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3","text":"<pre><code>let conformOrThrow (validated: Validated&lt;string, 'T&gt;) : 'T =\n    match validated with\n    | Valid a -&gt; a\n    | Invalid errs -&gt; failwithf \"Validation failed: %s\" (System.String.Join(\", \", errs))\n</code></pre>"},{"location":"fsharp/04-data-validation/#9","title":"9. \u8a08\u7b97\u95a2\u6570","text":"<pre><code>/// \u30a2\u30a4\u30c6\u30e0\u5408\u8a08\u3092\u8a08\u7b97\nlet calculateItemTotal (item: OrderItem) =\n    Price.value item.Price * decimal (Quantity.value item.Quantity)\n\n/// \u6ce8\u6587\u5408\u8a08\u3092\u8a08\u7b97\nlet calculateOrderTotal (order: Order) =\n    order.Items |&gt; List.sumBy calculateItemTotal\n\n/// \u5272\u5f15\u3092\u9069\u7528\nlet applyDiscount (total: decimal) (discountRate: float) : Result&lt;decimal, string&gt; =\n    if discountRate &lt; 0.0 || discountRate &gt; 1.0 then\n        Error \"\u5272\u5f15\u7387\u306f0\u304b\u30891\u306e\u9593\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"\n    else\n        Ok (total * (1m - decimal discountRate))\n\n/// \u8907\u6570\u306e\u4fa1\u683c\u3092\u5408\u8a08\nlet sumPrices (prices: decimal list) : decimal =\n    prices |&gt; List.sum\n</code></pre>"},{"location":"fsharp/04-data-validation/#clojure-spec-scala","title":"Clojure Spec / Scala \u3068\u306e\u6bd4\u8f03","text":"\u7279\u5fb4 Clojure Spec Scala F# \u691c\u8a3c\u30bf\u30a4\u30df\u30f3\u30b0 \u5b9f\u884c\u6642 \u30b3\u30f3\u30d1\u30a4\u30eb\u6642 + \u5b9f\u884c\u6642 \u30b3\u30f3\u30d1\u30a4\u30eb\u6642 + \u5b9f\u884c\u6642 \u30a8\u30e9\u30fc\u84c4\u7a4d explain-data Validated \u30d1\u30bf\u30fc\u30f3 Validated \u30d1\u30bf\u30fc\u30f3 \u578b\u5b89\u5168\u6027 \u52d5\u7684 \u9759\u7684\uff08Opaque Type\uff09 \u9759\u7684\uff08\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\uff09 \u30b8\u30a7\u30cd\u30ec\u30fc\u30bf \u7d44\u307f\u8fbc\u307f ScalaCheck FsCheck \u95a2\u6570\u4ed5\u69d8 fdef \u578b\u30b7\u30b0\u30cd\u30c1\u30e3 \u578b\u30b7\u30b0\u30cd\u30c1\u30e3"},{"location":"fsharp/04-data-validation/#_7","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001F# \u306b\u304a\u3051\u308b\u30c7\u30fc\u30bf\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>Result: \u57fa\u672c\u7684\u306a\u6210\u529f/\u5931\u6557\u306e\u8868\u73fe</li> <li>Validated \u30d1\u30bf\u30fc\u30f3: \u30a8\u30e9\u30fc\u306e\u84c4\u7a4d</li> <li>\u30c9\u30e1\u30a4\u30f3\u30d7\u30ea\u30df\u30c6\u30a3\u30d6: \u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u306b\u3088\u308b\u578b\u5b89\u5168\u306a\u30c9\u30e1\u30a4\u30f3\u578b</li> <li>\u30b9\u30de\u30fc\u30c8\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf: \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u4ed8\u304d\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u751f\u6210</li> <li>\u5224\u5225\u5171\u7528\u4f53: \u6761\u4ef6\u4ed8\u304d\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3</li> <li>ValidationResponse: \u69cb\u9020\u5316\u3055\u308c\u305f\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u7d50\u679c</li> </ol> <p>F# \u306e\u578b\u30b7\u30b9\u30c6\u30e0\u3092\u6d3b\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u306b\u591a\u304f\u306e\u30a8\u30e9\u30fc\u3092\u691c\u51fa\u3057\u3001\u5b9f\u884c\u6642\u306b\u306f Validated \u30d1\u30bf\u30fc\u30f3\u3067\u8a73\u7d30\u306a\u30a8\u30e9\u30fc\u60c5\u5831\u3092\u63d0\u4f9b\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"fsharp/04-data-validation/#_8","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/fsharp/part2/src/Library.fs</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/fsharp/part2/tests/Tests.fs</code></li> </ul>"},{"location":"fsharp/04-data-validation/#_9","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002FsCheck \u3092\u4f7f\u3063\u305f\u751f\u6210\u7684\u30c6\u30b9\u30c8\u306e\u624b\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"fsharp/05-property-based-testing/","title":"\u7b2c5\u7ae0: \u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8","text":""},{"location":"fsharp/05-property-based-testing/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u5f93\u6765\u306e\u5358\u4f53\u30c6\u30b9\u30c8\u3067\u306f\u3001\u7279\u5b9a\u306e\u5165\u529b\u306b\u5bfe\u3059\u308b\u671f\u5f85\u3055\u308c\u308b\u51fa\u529b\u3092\u691c\u8a3c\u3057\u307e\u3059\u3002\u4e00\u65b9\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u3067\u306f\u3001\u3059\u3079\u3066\u306e\u5165\u529b\u306b\u5bfe\u3057\u3066\u6210\u308a\u7acb\u3064\u3079\u304d\u300c\u6027\u8cea\uff08\u30d7\u30ed\u30d1\u30c6\u30a3\uff09\u300d\u3092\u5b9a\u7fa9\u3057\u3001\u30e9\u30f3\u30c0\u30e0\u306b\u751f\u6210\u3055\u308c\u305f\u591a\u6570\u306e\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u3067\u691c\u8a3c\u3057\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001F# \u306e FsCheck \u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3063\u305f\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u306e\u624b\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"fsharp/05-property-based-testing/#1","title":"1. \u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u3068\u306f","text":""},{"location":"fsharp/05-property-based-testing/#_2","title":"\u5f93\u6765\u306e\u30c6\u30b9\u30c8\u3068\u306e\u9055\u3044","text":"<pre><code>// \u5f93\u6765\u306e\u30c6\u30b9\u30c8\uff1a\u7279\u5b9a\u306e\u5165\u529b\u306b\u5bfe\u3059\u308b\u51fa\u529b\u3092\u691c\u8a3c\n[&lt;Fact&gt;]\nlet ``reverseString should reverse a specific string`` () =\n    StringOperations.reverseString \"hello\" |&gt; should equal \"olleh\"\n    StringOperations.reverseString \"\" |&gt; should equal \"\"\n    StringOperations.reverseString \"a\" |&gt; should equal \"a\"\n\n// \u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\uff1a\u6027\u8cea\u3092\u691c\u8a3c\n[&lt;Property&gt;]\nlet ``\u6587\u5b57\u5217\u53cd\u8ee2\u306f\u5bfe\u5408\uff08involutory\uff09: 2\u56de\u53cd\u8ee2\u3059\u308b\u3068\u5143\u306b\u623b\u308b`` (s: string) =\n    let s = if isNull s then \"\" else s\n    reverseString (reverseString s) = s\n</code></pre>"},{"location":"fsharp/05-property-based-testing/#_3","title":"\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u306e\u5229\u70b9","text":"<ol> <li>\u7db2\u7f85\u6027: \u624b\u52d5\u3067\u306f\u601d\u3044\u3064\u304b\u306a\u3044\u30a8\u30c3\u30b8\u30b1\u30fc\u30b9\u3092\u767a\u898b</li> <li>\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u6027: \u30b3\u30fc\u30c9\u306e\u6027\u8cea\u3092\u660e\u78ba\u306b\u8868\u73fe</li> <li>\u56de\u5e30\u9632\u6b62: \u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u6642\u306e\u5b89\u5168\u7db2</li> <li>\u30b7\u30e5\u30ea\u30f3\u30ad\u30f3\u30b0: \u5931\u6557\u6642\u306b\u6700\u5c0f\u306e\u53cd\u4f8b\u3092\u63d0\u793a</li> </ol>"},{"location":"fsharp/05-property-based-testing/#2-fscheck","title":"2. FsCheck \u306e\u57fa\u672c","text":""},{"location":"fsharp/05-property-based-testing/#_4","title":"\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7","text":"<pre><code># \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306b FsCheck \u3092\u8ffd\u52a0\ndotnet add package FsCheck.Xunit\n</code></pre>"},{"location":"fsharp/05-property-based-testing/#_5","title":"\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9","text":"<pre><code>open FsCheck\nopen FsCheck.Xunit\n\n[&lt;Property&gt;]\nlet ``\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u4f8b`` (s: string) =\n    let s = if isNull s then \"\" else s\n    s.Reverse().Reverse() = s.ToCharArray() |&gt; Array.rev |&gt; System.String\n</code></pre>"},{"location":"fsharp/05-property-based-testing/#3","title":"3. \u57fa\u672c\u7684\u306a\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf","text":""},{"location":"fsharp/05-property-based-testing/#_6","title":"\u30d7\u30ea\u30df\u30c6\u30a3\u30d6\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf","text":"<pre><code>// FsCheck \u306f\u578b\u306b\u57fa\u3065\u3044\u3066\u81ea\u52d5\u7684\u306b\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u3092\u9078\u629e\n[&lt;Property&gt;]\nlet ``\u6574\u6570\u306e\u30d7\u30ed\u30d1\u30c6\u30a3`` (n: int) = ...\n\n[&lt;Property&gt;]\nlet ``\u6587\u5b57\u5217\u306e\u30d7\u30ed\u30d1\u30c6\u30a3`` (s: string) = ...\n\n[&lt;Property&gt;]\nlet ``\u30ea\u30b9\u30c8\u306e\u30d7\u30ed\u30d1\u30c6\u30a3`` (list: int list) = ...\n\n// PositiveInt \u306a\u3069\u7279\u6b8a\u306a\u578b\u3082\u4f7f\u7528\u53ef\u80fd\n[&lt;Property&gt;]\nlet ``\u6b63\u306e\u6574\u6570\u306e\u30d7\u30ed\u30d1\u30c6\u30a3`` (n: PositiveInt) =\n    n.Get &gt; 0\n</code></pre>"},{"location":"fsharp/05-property-based-testing/#_7","title":"\u30ab\u30b9\u30bf\u30e0\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf","text":"<pre><code>open FsCheck\n\n// \u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u751f\u6210\nlet validEmailGen =\n    gen {\n        let! local = Gen.elements [\"user\"; \"test\"; \"admin\"; \"info\"]\n        let! domain = Gen.elements [\"example\"; \"test\"; \"company\"]\n        let! tld = Gen.elements [\"com\"; \"org\"; \"net\"; \"io\"; \"jp\"]\n        return sprintf \"%s@%s.%s\" local domain tld\n    }\n\n// \u96fb\u8a71\u756a\u53f7\u3092\u751f\u6210\nlet validPhoneGen =\n    gen {\n        let! length = Gen.choose(10, 15)\n        let! digits = Gen.listOfLength length (Gen.elements ['0'..'9'])\n        return System.String(digits |&gt; List.toArray)\n    }\n</code></pre>"},{"location":"fsharp/05-property-based-testing/#4","title":"4. \u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u5b9a\u7fa9\u30d1\u30bf\u30fc\u30f3","text":""},{"location":"fsharp/05-property-based-testing/#idempotency","title":"\u51aa\u7b49\u6027\uff08Idempotency\uff09","text":"<p>\u540c\u3058\u64cd\u4f5c\u3092\u8907\u6570\u56de\u9069\u7528\u3057\u3066\u3082\u7d50\u679c\u304c\u5909\u308f\u3089\u306a\u3044\u6027\u8cea\u3002</p> <pre><code>[&lt;Property&gt;]\nlet ``\u30bd\u30fc\u30c8\u306f\u51aa\u7b49: 2\u56de\u30bd\u30fc\u30c8\u3057\u3066\u3082\u7d50\u679c\u306f\u540c\u3058`` (nums: int list) =\n    sortNumbers (sortNumbers nums) = sortNumbers nums\n\n[&lt;Property&gt;]\nlet ``\u5927\u6587\u5b57\u5909\u63db\u306f\u51aa\u7b49`` (s: string) =\n    let s = if isNull s then \"\" else s\n    toUpperCase (toUpperCase s) = toUpperCase s\n</code></pre>"},{"location":"fsharp/05-property-based-testing/#involution","title":"\u5bfe\u5408\u6027\uff08Involution\uff09","text":"<p>2\u56de\u9069\u7528\u3059\u308b\u3068\u5143\u306b\u623b\u308b\u6027\u8cea\u3002</p> <pre><code>[&lt;Property&gt;]\nlet ``\u6587\u5b57\u5217\u53cd\u8ee2\u306f\u5bfe\u5408: 2\u56de\u53cd\u8ee2\u3059\u308b\u3068\u5143\u306b\u623b\u308b`` (s: string) =\n    let s = if isNull s then \"\" else s\n    reverseString (reverseString s) = s\n\n[&lt;Property&gt;]\nlet ``\u30ea\u30b9\u30c8\u53cd\u8ee2\u306f\u5bfe\u5408`` (list: int list) =\n    reverse (reverse list) = list\n</code></pre>"},{"location":"fsharp/05-property-based-testing/#invariant","title":"\u4e0d\u5909\u91cf\uff08Invariant\uff09","text":"<p>\u64cd\u4f5c\u306e\u524d\u5f8c\u3067\u4fdd\u5b58\u3055\u308c\u308b\u6027\u8cea\u3002</p> <pre><code>[&lt;Property&gt;]\nlet ``\u30bd\u30fc\u30c8\u306f\u8981\u7d20\u3092\u4fdd\u5b58\u3059\u308b`` (nums: int list) =\n    (sortNumbers nums |&gt; List.sort) = (nums |&gt; List.sort)\n\n[&lt;Property&gt;]\nlet ``\u30bd\u30fc\u30c8\u306f\u9577\u3055\u3092\u4fdd\u5b58\u3059\u308b`` (nums: int list) =\n    (sortNumbers nums).Length = nums.Length\n</code></pre>"},{"location":"fsharp/05-property-based-testing/#boundary-conditions","title":"\u5883\u754c\u6761\u4ef6\uff08Boundary Conditions\uff09","text":"<pre><code>[&lt;Property&gt;]\nlet ``\u5272\u5f15\u5f8c\u306e\u4fa1\u683c\u306f0\u4ee5\u4e0a\u3001\u5143\u306e\u4fa1\u683c\u4ee5\u4e0b`` (price: PositiveInt) =\n    let p = decimal price.Get\n    let r = 0.5 // \u5272\u5f15\u7387\n    let discounted = calculateDiscount p r\n    discounted &gt;= 0m &amp;&amp; discounted &lt;= p\n</code></pre>"},{"location":"fsharp/05-property-based-testing/#5_1","title":"5. \u30e9\u30a6\u30f3\u30c9\u30c8\u30ea\u30c3\u30d7\u30d7\u30ed\u30d1\u30c6\u30a3","text":"<p>\u30a8\u30f3\u30b3\u30fc\u30c9/\u30c7\u30b3\u30fc\u30c9\u306e\u53ef\u9006\u6027\u306f\u5178\u578b\u7684\u306a\u30d7\u30ed\u30d1\u30c6\u30a3\u3067\u3059\u3002</p> <pre><code>/// \u30e9\u30f3\u30ec\u30f3\u30b0\u30b9\u7b26\u53f7\u5316\nlet encode (s: string) : (char * int) list =\n    if System.String.IsNullOrEmpty(s) then []\n    else\n        s |&gt; Seq.fold (fun acc c -&gt;\n            match acc with\n            | [] -&gt; [(c, 1)]\n            | (lastChar, count) :: rest when lastChar = c -&gt;\n                (lastChar, count + 1) :: rest\n            | _ -&gt; (c, 1) :: acc\n        ) []\n        |&gt; List.rev\n\n/// \u30e9\u30f3\u30ec\u30f3\u30b0\u30b9\u5fa9\u53f7\u5316\nlet decode (encoded: (char * int) list) : string =\n    encoded\n    |&gt; List.map (fun (c, count) -&gt; System.String(c, count))\n    |&gt; System.String.Concat\n\n[&lt;Property&gt;]\nlet ``\u30e9\u30f3\u30ec\u30f3\u30b0\u30b9\u7b26\u53f7\u5316\u306f\u53ef\u9006`` (s: string) =\n    let s = if isNull s then \"\" else s\n    let alphaOnly = s |&gt; String.filter System.Char.IsLetter\n    if alphaOnly.Length &gt; 0 then\n        decode (encode alphaOnly) = alphaOnly\n    else\n        true\n\n[&lt;Property&gt;]\nlet ``Base64\u30a8\u30f3\u30b3\u30fc\u30c9/\u30c7\u30b3\u30fc\u30c9\u306f\u53ef\u9006`` (s: string) =\n    let s = if isNull s then \"\" else s\n    try\n        base64Decode (base64Encode s) = s\n    with _ -&gt; true\n</code></pre>"},{"location":"fsharp/05-property-based-testing/#6","title":"6. \u4ee3\u6570\u7684\u6027\u8cea","text":""},{"location":"fsharp/05-property-based-testing/#_8","title":"\u30e2\u30ce\u30a4\u30c9\u306e\u6cd5\u5247","text":"<pre><code>/// \u30e2\u30ce\u30a4\u30c9\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\ntype IMonoid&lt;'T&gt; =\n    abstract member Empty: 'T\n    abstract member Combine: 'T -&gt; 'T -&gt; 'T\n\n/// \u6574\u6570\u52a0\u7b97\u30e2\u30ce\u30a4\u30c9\nlet intAdditionMonoid =\n    { new IMonoid&lt;int&gt; with\n        member _.Empty = 0\n        member _.Combine x y = x + y }\n\n// \u7d50\u5408\u5f8b\u306e\u30c6\u30b9\u30c8\n[&lt;Property&gt;]\nlet ``\u6574\u6570\u52a0\u7b97\u30e2\u30ce\u30a4\u30c9\u306e\u7d50\u5408\u5f8b`` (a: int) (b: int) (c: int) =\n    let m = intAdditionMonoid\n    m.Combine (m.Combine a b) c = m.Combine a (m.Combine b c)\n\n// \u5358\u4f4d\u5143\u306e\u30c6\u30b9\u30c8\n[&lt;Property&gt;]\nlet ``\u6574\u6570\u52a0\u7b97\u30e2\u30ce\u30a4\u30c9\u306e\u5358\u4f4d\u5143`` (a: int) =\n    let m = intAdditionMonoid\n    m.Combine a m.Empty = a &amp;&amp; m.Combine m.Empty a = a\n</code></pre>"},{"location":"fsharp/05-property-based-testing/#_9","title":"\u7b97\u8853\u6f14\u7b97\u306e\u6027\u8cea","text":"<pre><code>[&lt;Property&gt;]\nlet ``\u52a0\u7b97\u306e\u7d50\u5408\u5f8b`` (a: int) (b: int) (c: int) =\n    let a, b, c = a % 1000, b % 1000, c % 1000\n    (a + b) + c = a + (b + c)\n\n[&lt;Property&gt;]\nlet ``\u52a0\u7b97\u306e\u4ea4\u63db\u5f8b`` (a: int) (b: int) =\n    a + b = b + a\n\n[&lt;Property&gt;]\nlet ``\u52a0\u7b97\u306e\u5358\u4f4d\u5143`` (a: int) =\n    a + 0 = a &amp;&amp; 0 + a = a\n</code></pre>"},{"location":"fsharp/05-property-based-testing/#7","title":"7. \u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u64cd\u4f5c\u306e\u30d7\u30ed\u30d1\u30c6\u30a3","text":""},{"location":"fsharp/05-property-based-testing/#filter","title":"filter \u306e\u6027\u8cea","text":"<pre><code>[&lt;Property&gt;]\nlet ``filter\u306f\u9577\u3055\u3092\u6e1b\u3089\u3059\u304b\u7dad\u6301\u3059\u308b`` (list: int list) =\n    (filter (fun x -&gt; x &gt; 0) list).Length &lt;= list.Length\n\n[&lt;Property&gt;]\nlet ``filter(\u5e38\u306btrue)\u306f\u5143\u306e\u30ea\u30b9\u30c8\u3068\u540c\u3058`` (list: int list) =\n    filter (fun _ -&gt; true) list = list\n\n[&lt;Property&gt;]\nlet ``filter(\u5e38\u306bfalse)\u306f\u7a7a\u30ea\u30b9\u30c8`` (list: int list) =\n    filter (fun _ -&gt; false) list = []\n</code></pre>"},{"location":"fsharp/05-property-based-testing/#map","title":"map \u306e\u6027\u8cea","text":"<pre><code>[&lt;Property&gt;]\nlet ``map\u306f\u9577\u3055\u3092\u4fdd\u5b58\u3059\u308b`` (list: int list) =\n    (map (fun x -&gt; x * 2) list).Length = list.Length\n\n[&lt;Property&gt;]\nlet ``map(identity)\u306f\u5143\u306e\u30ea\u30b9\u30c8\u3068\u540c\u3058`` (list: int list) =\n    map id list = list\n</code></pre>"},{"location":"fsharp/05-property-based-testing/#concat","title":"concat \u306e\u6027\u8cea","text":"<pre><code>[&lt;Property&gt;]\nlet ``concat\u306e\u7d50\u5408\u5f8b`` (a: int list) (b: int list) (c: int list) =\n    concat (concat a b) c = concat a (concat b c)\n\n[&lt;Property&gt;]\nlet ``concat\u306e\u9577\u3055\u306f\u5165\u529b\u306e\u9577\u3055\u306e\u5408\u8a08`` (a: int list) (b: int list) =\n    (concat a b).Length = a.Length + b.Length\n</code></pre>"},{"location":"fsharp/05-property-based-testing/#8","title":"8. \u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u306e\u30d7\u30ed\u30d1\u30c6\u30a3","text":"<pre><code>[&lt;Property&gt;]\nlet ``\u6700\u7d42\u4fa1\u683c\u306f\u5143\u306e\u4fa1\u683c\u4ee5\u4e0b`` (price: PositiveInt) (membership: Membership) =\n    let total = decimal price.Get\n    let finalPrice = calculateFinalPrice total membership\n    finalPrice &lt;= total\n\n[&lt;Property&gt;]\nlet ``Platinum\u306f\u6700\u5927\u306e\u5272\u5f15\u3092\u53d7\u3051\u308b`` (price: PositiveInt) =\n    let total = decimal price.Get\n    let platinumPrice = calculateFinalPrice total Platinum\n    let bronzePrice = calculateFinalPrice total Bronze\n    platinumPrice &lt;= bronzePrice\n\n[&lt;Property&gt;]\nlet ``\u5272\u5f15\u7387\u306e\u9806\u5e8f: Platinum &lt; Gold &lt; Silver &lt; Bronze`` (price: PositiveInt) =\n    let total = decimal price.Get\n    let prices = [Platinum; Gold; Silver; Bronze] |&gt; List.map (calculateFinalPrice total)\n    prices |&gt; List.pairwise |&gt; List.forall (fun (a, b) -&gt; a &lt;= b)\n</code></pre>"},{"location":"fsharp/05-property-based-testing/#9","title":"9. \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u306e\u30d7\u30ed\u30d1\u30c6\u30a3","text":"<p>\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u3067\u6709\u52b9\u306a\u5165\u529b\u3092\u751f\u6210\u3057\u3001\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u901a\u904e\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002</p> <pre><code>let validEmailGen =\n    gen {\n        let! local = Gen.elements [\"user\"; \"test\"; \"admin\"; \"info\"]\n        let! domain = Gen.elements [\"example\"; \"test\"; \"company\"]\n        let! tld = Gen.elements [\"com\"; \"org\"; \"net\"; \"io\"; \"jp\"]\n        return sprintf \"%s@%s.%s\" local domain tld\n    }\n\n[&lt;Property&gt;]\nlet ``\u751f\u6210\u3055\u308c\u305f\u6709\u52b9\u306a\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306f\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u901a\u904e\u3059\u308b`` () =\n    Prop.forAll (Arb.fromGen validEmailGen) (fun email -&gt;\n        isValidEmail email)\n</code></pre>"},{"location":"fsharp/05-property-based-testing/#10","title":"10. \u30aa\u30e9\u30af\u30eb\u30c6\u30b9\u30c8","text":"<p>\u65e2\u77e5\u306e\u6b63\u3057\u3044\u5b9f\u88c5\uff08\u6a19\u6e96\u30e9\u30a4\u30d6\u30e9\u30ea\u306a\u3069\uff09\u3068\u6bd4\u8f03\u3057\u307e\u3059\u3002</p> <pre><code>[&lt;Property&gt;]\nlet ``sortNumbers\u306f\u6a19\u6e96\u30e9\u30a4\u30d6\u30e9\u30ea\u306esort\u3068\u540c\u3058\u7d50\u679c`` (nums: int list) =\n    sortNumbers nums = List.sort nums\n\n[&lt;Property&gt;]\nlet ``reverse\u306f\u6a19\u6e96\u30e9\u30a4\u30d6\u30e9\u30ea\u306erev\u3068\u540c\u3058\u7d50\u679c`` (list: int list) =\n    reverse list = List.rev list\n\n[&lt;Property&gt;]\nlet ``filter\u306f\u6a19\u6e96\u30e9\u30a4\u30d6\u30e9\u30ea\u306efilter\u3068\u540c\u3058\u7d50\u679c`` (list: int list) =\n    let pred x = x &gt; 0\n    filter pred list = List.filter pred list\n</code></pre>"},{"location":"fsharp/05-property-based-testing/#clojure-scala-f","title":"Clojure / Scala / F# \u6bd4\u8f03","text":"\u6982\u5ff5 Clojure (test.check) Scala (ScalaCheck) F# (FsCheck) \u30b8\u30a7\u30cd\u30ec\u30fc\u30bf <code>gen/string</code>, <code>gen/int</code> <code>Gen.alphaStr</code>, <code>Gen.posNum[Int]</code> \u578b\u63a8\u8ad6 / <code>Gen</code> \u7bc4\u56f2\u6307\u5b9a <code>gen/choose</code> <code>Gen.chooseNum</code> <code>Gen.choose</code> \u5217\u6319 <code>gen/elements</code> <code>Gen.oneOf</code> <code>Gen.elements</code> \u30b3\u30ec\u30af\u30b7\u30e7\u30f3 <code>gen/vector</code>, <code>gen/list</code> <code>Gen.listOf</code> \u578b\u63a8\u8ad6 \u5909\u63db <code>gen/fmap</code> <code>Gen.map</code> Computation expression \u30d5\u30a3\u30eb\u30bf <code>gen/such-that</code> <code>Gen.suchThat</code> <code>Gen.filter</code> \u30d7\u30ed\u30d1\u30c6\u30a3\u5b9a\u7fa9 <code>prop/for-all</code> <code>forAll</code> <code>[&lt;Property&gt;]</code>"},{"location":"fsharp/05-property-based-testing/#_10","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf: \u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u306e\u81ea\u52d5\u751f\u6210</li> <li>\u30d7\u30ea\u30df\u30c6\u30a3\u30d6: \u6574\u6570\u3001\u6587\u5b57\u5217\u3001\u30d6\u30fc\u30eb\u5024\u306a\u3069</li> <li>\u30b3\u30ec\u30af\u30b7\u30e7\u30f3: \u30ea\u30b9\u30c8\u3001\u30de\u30c3\u30d7\u3001\u30bb\u30c3\u30c8</li> <li>\u5909\u63db: computation expression \u306b\u3088\u308b\u52a0\u5de5</li> <li>\u30d7\u30ed\u30d1\u30c6\u30a3: \u3059\u3079\u3066\u306e\u5165\u529b\u3067\u6210\u308a\u7acb\u3064\u3079\u304d\u6027\u8cea</li> <li>\u30d1\u30bf\u30fc\u30f3: \u51aa\u7b49\u6027\u3001\u5bfe\u5408\u6027\u3001\u4e0d\u5909\u91cf\u3001\u30e9\u30a6\u30f3\u30c9\u30c8\u30ea\u30c3\u30d7</li> <li>\u4ee3\u6570\u7684\u6027\u8cea: \u30e2\u30ce\u30a4\u30c9\u5247</li> </ol> <p>\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u306f\u3001\u5f93\u6765\u306e\u30c6\u30b9\u30c8\u3092\u88dc\u5b8c\u3057\u3001\u3088\u308a\u5805\u7262\u306a\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p>"},{"location":"fsharp/05-property-based-testing/#_11","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/fsharp/part2/src/Library.fs</code>\uff08PropertyBasedTesting \u30e2\u30b8\u30e5\u30fc\u30eb\uff09</li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/fsharp/part2/tests/Tests.fs</code></li> </ul>"},{"location":"fsharp/05-property-based-testing/#_12","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001\u30c6\u30b9\u30c8\u99c6\u52d5\u958b\u767a\u3068\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002Red-Green-Refactor \u30b5\u30a4\u30af\u30eb\u3092\u95a2\u6570\u578b\u30b9\u30bf\u30a4\u30eb\u3067\u5b9f\u8df5\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"fsharp/06-tdd-functional/","title":"\u7b2c6\u7ae0: \u30c6\u30b9\u30c8\u99c6\u52d5\u958b\u767a\u3068\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0","text":""},{"location":"fsharp/06-tdd-functional/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u30c6\u30b9\u30c8\u99c6\u52d5\u958b\u767a\uff08TDD\uff09\u306f\u3001\u30c6\u30b9\u30c8\u3092\u5148\u306b\u66f8\u3044\u3066\u304b\u3089\u5b9f\u88c5\u3092\u884c\u3046\u958b\u767a\u624b\u6cd5\u3067\u3059\u3002\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3068 TDD \u306f\u76f8\u6027\u304c\u826f\u304f\u3001\u7d14\u7c8b\u95a2\u6570\u306f\u30c6\u30b9\u30c8\u304c\u5bb9\u6613\u3067\u3001\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u306f\u4e88\u6e2c\u53ef\u80fd\u306a\u52d5\u4f5c\u3092\u4fdd\u8a3c\u3057\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001Red-Green-Refactor \u30b5\u30a4\u30af\u30eb\u3092\u95a2\u6570\u578b\u30b9\u30bf\u30a4\u30eb\u3067\u5b9f\u8df5\u3059\u308b\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"fsharp/06-tdd-functional/#1-tdd","title":"1. TDD \u306e\u57fa\u672c\u30b5\u30a4\u30af\u30eb","text":""},{"location":"fsharp/06-tdd-functional/#red-green-refactor","title":"Red-Green-Refactor","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                                                 \u2502\n\u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502    \u2502  Red  \u2502 \u2500\u2500\u25ba \u2502 Green \u2502 \u2500\u2500\u25ba \u2502 Refactor  \u2502   \u2502\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502        \u25b2                              \u2502         \u2502\n\u2502        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502\n\u2502                                                 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <ol> <li>Red\uff08\u8d64\uff09: \u5931\u6557\u3059\u308b\u30c6\u30b9\u30c8\u3092\u66f8\u304f</li> <li>Green\uff08\u7dd1\uff09: \u30c6\u30b9\u30c8\u3092\u901a\u3059\u6700\u5c0f\u9650\u306e\u30b3\u30fc\u30c9\u3092\u66f8\u304f</li> <li>Refactor\uff08\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\uff09: \u30b3\u30fc\u30c9\u3092\u6539\u5584\u3059\u308b\uff08\u30c6\u30b9\u30c8\u306f\u901a\u3063\u305f\u307e\u307e\uff09</li> </ol>"},{"location":"fsharp/06-tdd-functional/#2-fizzbuzz-tdd","title":"2. FizzBuzz - TDD \u306e\u5178\u578b\u4f8b","text":""},{"location":"fsharp/06-tdd-functional/#step-1-red","title":"Step 1: Red\uff08\u6700\u521d\u306e\u30c6\u30b9\u30c8\uff09","text":"<pre><code>[&lt;Fact&gt;]\nlet ``fizzbuzz 1\u306f\"1\"\u3092\u8fd4\u3059`` () =\n    Assert.Equal(\"1\", fizzbuzz 1)\n</code></pre>"},{"location":"fsharp/06-tdd-functional/#step-2-green","title":"Step 2: Green\uff08\u6700\u5c0f\u9650\u306e\u5b9f\u88c5\uff09","text":"<pre><code>let fizzbuzz n = \"1\"\n</code></pre>"},{"location":"fsharp/06-tdd-functional/#step-3","title":"Step 3: \u6b21\u306e\u30c6\u30b9\u30c8\u3092\u8ffd\u52a0\u3057\u3066\u6bb5\u968e\u7684\u306b\u5b9f\u88c5\u3092\u767a\u5c55","text":"<pre><code>// \u30c6\u30b9\u30c8\u3092\u8ffd\u52a0\n[&lt;Fact&gt;]\nlet ``fizzbuzz 2\u306f\"2\"\u3092\u8fd4\u3059`` () =\n    Assert.Equal(\"2\", fizzbuzz 2)\n\n[&lt;Fact&gt;]\nlet ``fizzbuzz 3\u306f\"Fizz\"\u3092\u8fd4\u3059`` () =\n    Assert.Equal(\"Fizz\", fizzbuzz 3)\n\n[&lt;Fact&gt;]\nlet ``fizzbuzz 5\u306f\"Buzz\"\u3092\u8fd4\u3059`` () =\n    Assert.Equal(\"Buzz\", fizzbuzz 5)\n\n[&lt;Fact&gt;]\nlet ``fizzbuzz 15\u306f\"FizzBuzz\"\u3092\u8fd4\u3059`` () =\n    Assert.Equal(\"FizzBuzz\", fizzbuzz 15)\n</code></pre>"},{"location":"fsharp/06-tdd-functional/#_2","title":"\u6700\u7d42\u5b9f\u88c5\uff08\u5c0f\u3055\u306a\u30d8\u30eb\u30d1\u30fc\u95a2\u6570\u306b\u5206\u5272\uff09","text":"<pre><code>/// 3\u3067\u5272\u308a\u5207\u308c\u308b\u304b\u3069\u3046\u304b\nlet isFizz n = n % 3 = 0\n\n/// 5\u3067\u5272\u308a\u5207\u308c\u308b\u304b\u3069\u3046\u304b\nlet isBuzz n = n % 5 = 0\n\n/// 15\u3067\u5272\u308a\u5207\u308c\u308b\u304b\u3069\u3046\u304b\uff08FizzBuzz\uff09\nlet isFizzBuzz n = isFizz n &amp;&amp; isBuzz n\n\n/// FizzBuzz\u5909\u63db\nlet fizzbuzz n =\n    if isFizzBuzz n then \"FizzBuzz\"\n    elif isFizz n then \"Fizz\"\n    elif isBuzz n then \"Buzz\"\n    else string n\n\n/// 1\u304b\u3089n\u307e\u3067\u306eFizzBuzz\u5217\u3092\u751f\u6210\nlet fizzbuzzSequence n =\n    [ 1 .. n ] |&gt; List.map fizzbuzz\n</code></pre>"},{"location":"fsharp/06-tdd-functional/#_3","title":"\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u3068\u7d44\u307f\u5408\u308f\u305b","text":"<pre><code>[&lt;Property&gt;]\nlet ``3\u306e\u500d\u6570\u306f\u5e38\u306bFizz\u3092\u542b\u3080`` (n: FsCheck.PositiveInt) =\n    let num = n.Get * 3\n    let result = fizzbuzz num\n    result.Contains(\"Fizz\")\n\n[&lt;Property&gt;]\nlet ``5\u306e\u500d\u6570\u306f\u5e38\u306bBuzz\u3092\u542b\u3080`` (n: FsCheck.PositiveInt) =\n    let num = n.Get * 5\n    let result = fizzbuzz num\n    result.Contains(\"Buzz\")\n</code></pre>"},{"location":"fsharp/06-tdd-functional/#3","title":"3. \u30ed\u30fc\u30de\u6570\u5b57\u5909\u63db","text":""},{"location":"fsharp/06-tdd-functional/#_4","title":"\u30c6\u30b9\u30c8\u304b\u3089\u59cb\u3081\u308b","text":"<pre><code>[&lt;Fact&gt;]\nlet ``toRoman 1\u306fI\u3092\u8fd4\u3059`` () =\n    Assert.Equal(\"I\", toRoman 1)\n\n[&lt;Fact&gt;]\nlet ``toRoman 4\u306fIV\u3092\u8fd4\u3059`` () =\n    Assert.Equal(\"IV\", toRoman 4)\n\n[&lt;Fact&gt;]\nlet ``toRoman 1994\u306fMCMXCIV\u3092\u8fd4\u3059`` () =\n    Assert.Equal(\"MCMXCIV\", toRoman 1994)\n\n[&lt;Fact&gt;]\nlet ``toRoman\u3068fromRoman\u306f\u9006\u95a2\u6570`` () =\n    for n in 1..100 do\n        Assert.Equal(n, fromRoman (toRoman n))\n</code></pre>"},{"location":"fsharp/06-tdd-functional/#_5","title":"\u30c7\u30fc\u30bf\u99c6\u52d5\u306e\u5b9f\u88c5","text":"<pre><code>/// \u30ed\u30fc\u30de\u6570\u5b57\u306e\u5bfe\u5fdc\u8868\uff08\u5927\u304d\u3044\u9806\uff09\nlet private romanNumerals =\n    [ (1000, \"M\"); (900, \"CM\"); (500, \"D\"); (400, \"CD\")\n      (100, \"C\");  (90, \"XC\");  (50, \"L\");  (40, \"XL\")\n      (10, \"X\");   (9, \"IX\");   (5, \"V\");   (4, \"IV\")\n      (1, \"I\") ]\n\n/// \u6574\u6570\u3092\u30ed\u30fc\u30de\u6570\u5b57\u306b\u5909\u63db\nlet toRoman n =\n    if n &lt;= 0 || n &gt; 3999 then\n        invalidArg \"n\" \"n must be between 1 and 3999\"\n\n    let rec loop remaining result =\n        if remaining = 0 then\n            result\n        else\n            let (value, numeral) = romanNumerals |&gt; List.find (fun (v, _) -&gt; v &lt;= remaining)\n            loop (remaining - value) (result + numeral)\n\n    loop n \"\"\n\n/// \u30ed\u30fc\u30de\u6570\u5b57\u304b\u3089\u6574\u6570\u3078\u5909\u63db\uff08\u9006\u5909\u63db\uff09\nlet private romanValues =\n    Map.ofList [ ('I', 1); ('V', 5); ('X', 10); ('L', 50)\n                 ('C', 100); ('D', 500); ('M', 1000) ]\n\nlet fromRoman (roman: string) =\n    let values = roman |&gt; Seq.map (fun c -&gt; Map.find c romanValues) |&gt; Seq.toList\n\n    let rec loop vals acc =\n        match vals with\n        | [] -&gt; acc\n        | [ x ] -&gt; acc + x\n        | x :: y :: rest when x &lt; y -&gt; loop (y :: rest) (acc - x)\n        | x :: rest -&gt; loop rest (acc + x)\n\n    loop values 0\n</code></pre>"},{"location":"fsharp/06-tdd-functional/#4","title":"4. \u30dc\u30a6\u30ea\u30f3\u30b0\u30b9\u30b3\u30a2\u8a08\u7b97","text":""},{"location":"fsharp/06-tdd-functional/#tdd","title":"\u8907\u96d1\u306a\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u306e TDD","text":"<pre><code>[&lt;Fact&gt;]\nlet ``\u30ac\u30bf\u30fc\u30b9\u30b3\u30a2\u306f0`` () =\n    Assert.Equal(0, bowlingScore (List.replicate 20 0))\n\n[&lt;Fact&gt;]\nlet ``\u3059\u3079\u30661\u30d4\u30f3\u306f20\u70b9`` () =\n    Assert.Equal(20, bowlingScore (List.replicate 20 1))\n\n[&lt;Fact&gt;]\nlet ``\u30b9\u30da\u30a2\u306e\u5f8c\u306e\u6295\u7403\u306f\u30dc\u30fc\u30ca\u30b9`` () =\n    let rolls = [ 5; 5; 3; 0 ] @ List.replicate 16 0\n    Assert.Equal(16, bowlingScore rolls)\n\n[&lt;Fact&gt;]\nlet ``\u30b9\u30c8\u30e9\u30a4\u30af\u306e\u5f8c\u306e2\u6295\u306f\u30dc\u30fc\u30ca\u30b9`` () =\n    let rolls = [ 10; 3; 4 ] @ List.replicate 16 0\n    Assert.Equal(24, bowlingScore rolls)\n\n[&lt;Fact&gt;]\nlet ``\u30d1\u30fc\u30d5\u30a7\u30af\u30c8\u30b2\u30fc\u30e0\u306f300\u70b9`` () =\n    Assert.Equal(300, bowlingScore (List.replicate 12 10))\n</code></pre>"},{"location":"fsharp/06-tdd-functional/#_6","title":"\u5c0f\u3055\u306a\u95a2\u6570\u306b\u5206\u5272","text":"<pre><code>/// \u30b9\u30c8\u30e9\u30a4\u30af\u304b\u3069\u3046\u304b\nlet isStrike rolls =\n    match rolls with\n    | x :: _ -&gt; x = 10\n    | [] -&gt; false\n\n/// \u30b9\u30da\u30a2\u304b\u3069\u3046\u304b\nlet isSpare rolls =\n    match rolls with\n    | x :: y :: _ -&gt; x + y = 10 &amp;&amp; x &lt;&gt; 10\n    | _ -&gt; false\n\n/// \u30b9\u30c8\u30e9\u30a4\u30af\u30dc\u30fc\u30ca\u30b9\nlet strikeBonus remaining =\n    remaining |&gt; List.truncate 2 |&gt; List.sum\n\n/// \u30b9\u30da\u30a2\u30dc\u30fc\u30ca\u30b9\nlet spareBonus remaining =\n    remaining |&gt; List.tryHead |&gt; Option.defaultValue 0\n\n/// \u30dc\u30a6\u30ea\u30f3\u30b0\u30b9\u30b3\u30a2\u3092\u8a08\u7b97\nlet bowlingScore rolls =\n    let rec loop remainingRolls frame total =\n        if frame &gt; 10 || List.isEmpty remainingRolls then\n            total\n        elif isStrike remainingRolls then\n            loop (List.tail remainingRolls) (frame + 1) (total + 10 + strikeBonus (List.tail remainingRolls))\n        elif isSpare remainingRolls then\n            loop (remainingRolls |&gt; List.skip 2) (frame + 1) (total + 10 + spareBonus (remainingRolls |&gt; List.skip 2))\n        else\n            let frameScore = remainingRolls |&gt; List.truncate 2 |&gt; List.sum\n            loop (remainingRolls |&gt; List.skip 2) (frame + 1) (total + frameScore)\n\n    loop rolls 1 0\n</code></pre>"},{"location":"fsharp/06-tdd-functional/#5-tdd","title":"5. \u7d20\u6570 - \u30b7\u30f3\u30d7\u30eb\u306a\u95a2\u6570\u306e TDD","text":""},{"location":"fsharp/06-tdd-functional/#_7","title":"\u30c6\u30b9\u30c8\u304b\u3089\u8a2d\u8a08\u3092\u5c0e\u304f","text":"<pre><code>[&lt;Fact&gt;]\nlet ``0\u306f\u7d20\u6570\u3067\u306f\u306a\u3044`` () =\n    Assert.False(isPrime 0)\n\n[&lt;Fact&gt;]\nlet ``2\u306f\u7d20\u6570`` () =\n    Assert.True(isPrime 2)\n\n[&lt;Fact&gt;]\nlet ``primesUpTo 20\u306f\u6b63\u3057\u3044\u7d20\u6570\u30ea\u30b9\u30c8\u3092\u8fd4\u3059`` () =\n    let expected = [ 2; 3; 5; 7; 11; 13; 17; 19 ]\n    Assert.Equal&lt;int list&gt;(expected, primesUpTo 20)\n\n[&lt;Fact&gt;]\nlet ``primeFactors 24\u306f2,2,2,3\u3092\u8fd4\u3059`` () =\n    let expected = [ 2; 2; 2; 3 ]\n    Assert.Equal&lt;int list&gt;(expected, primeFactors 24)\n\n[&lt;Fact&gt;]\nlet ``primeFactors\u306e\u7a4d\u306f\u5143\u306e\u6570\u306b\u7b49\u3057\u3044`` () =\n    for n in 2..100 do\n        let factors = primeFactors n\n        let product = factors |&gt; List.fold (*) 1\n        Assert.Equal(n, product)\n</code></pre>"},{"location":"fsharp/06-tdd-functional/#_8","title":"\u5b9f\u88c5","text":"<pre><code>/// \u7d20\u6570\u5224\u5b9a\nlet isPrime n =\n    if n &lt; 2 then false\n    elif n = 2 then true\n    elif n % 2 = 0 then false\n    else\n        let sqrtN = int (sqrt (float n))\n        seq { 3 .. 2 .. sqrtN }\n        |&gt; Seq.exists (fun i -&gt; n % i = 0)\n        |&gt; not\n\n/// n\u4ee5\u4e0b\u306e\u7d20\u6570\u3092\u3059\u3079\u3066\u8fd4\u3059\nlet primesUpTo n =\n    [ 2 .. n ] |&gt; List.filter isPrime\n\n/// \u7d20\u56e0\u6570\u5206\u89e3\nlet primeFactors n =\n    let rec loop remaining factor factors =\n        if remaining = 1 then\n            List.rev factors\n        elif remaining % factor = 0 then\n            loop (remaining / factor) factor (factor :: factors)\n        else\n            loop remaining (factor + 1) factors\n\n    loop n 2 []\n</code></pre>"},{"location":"fsharp/06-tdd-functional/#6-","title":"6. \u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020 - \u30b9\u30bf\u30c3\u30af\u3068\u30ad\u30e5\u30fc","text":""},{"location":"fsharp/06-tdd-functional/#_9","title":"\u4e0d\u5909\u30b9\u30bf\u30c3\u30af","text":"<pre><code>type Stack&lt;'T&gt; =\n    private { Items: 'T list }\n\n    member this.IsEmpty = List.isEmpty this.Items\n    member this.Size = List.length this.Items\n\n    member this.Push(item: 'T) = { Items = item :: this.Items }\n\n    member this.Pop() =\n        match this.Items with\n        | head :: tail -&gt; Some(head, { Items = tail })\n        | [] -&gt; None\n\n    member this.Peek() = List.tryHead this.Items\n\nmodule Stack =\n    let empty&lt;'T&gt; : Stack&lt;'T&gt; = { Items = [] }\n    let push item (stack: Stack&lt;'T&gt;) = stack.Push(item)\n    let pop (stack: Stack&lt;'T&gt;) = stack.Pop()\n    let peek (stack: Stack&lt;'T&gt;) = stack.Peek()\n    let isEmpty (stack: Stack&lt;'T&gt;) = stack.IsEmpty\n    let size (stack: Stack&lt;'T&gt;) = stack.Size\n</code></pre>"},{"location":"fsharp/06-tdd-functional/#_10","title":"\u30c6\u30b9\u30c8","text":"<pre><code>[&lt;Fact&gt;]\nlet ``LIFO\u9806\u5e8f\u3067\u52d5\u4f5c\u3059\u308b`` () =\n    let stack =\n        Stack.empty\n        |&gt; Stack.push \"a\"\n        |&gt; Stack.push \"b\"\n        |&gt; Stack.push \"c\"\n\n    match Stack.pop stack with\n    | Some (v1, s1) -&gt;\n        Assert.Equal(\"c\", v1)\n        match Stack.pop s1 with\n        | Some (v2, s2) -&gt;\n            Assert.Equal(\"b\", v2)\n            match Stack.pop s2 with\n            | Some (v3, s3) -&gt;\n                Assert.Equal(\"a\", v3)\n                Assert.True(Stack.isEmpty s3)\n            | None -&gt; Assert.Fail(\"Expected value\")\n        | None -&gt; Assert.Fail(\"Expected value\")\n    | None -&gt; Assert.Fail(\"Expected value\")\n</code></pre>"},{"location":"fsharp/06-tdd-functional/#2","title":"\u4e0d\u5909\u30ad\u30e5\u30fc\uff082\u3064\u306e\u30ea\u30b9\u30c8\u3067\u5b9f\u88c5\uff09","text":"<pre><code>type Queue&lt;'T&gt; =\n    private { Front: 'T list; Back: 'T list }\n\n    member this.IsEmpty = List.isEmpty this.Front &amp;&amp; List.isEmpty this.Back\n\n    member this.Enqueue(item: 'T) = { Front = this.Front; Back = item :: this.Back }\n\n    member this.Dequeue() =\n        match this.Front with\n        | head :: tail -&gt; Some(head, { Front = tail; Back = this.Back })\n        | [] -&gt;\n            match List.rev this.Back with\n            | head :: tail -&gt; Some(head, { Front = tail; Back = [] })\n            | [] -&gt; None\n\nmodule Queue =\n    let empty&lt;'T&gt; : Queue&lt;'T&gt; = { Front = []; Back = [] }\n    let enqueue item (queue: Queue&lt;'T&gt;) = queue.Enqueue(item)\n    let dequeue (queue: Queue&lt;'T&gt;) = queue.Dequeue()\n    let isEmpty (queue: Queue&lt;'T&gt;) = queue.IsEmpty\n</code></pre>"},{"location":"fsharp/06-tdd-functional/#7-","title":"7. \u6587\u5b57\u5217\u96fb\u5353 - \u6bb5\u968e\u7684\u306a\u8981\u4ef6\u8ffd\u52a0","text":""},{"location":"fsharp/06-tdd-functional/#_11","title":"\u30c6\u30b9\u30c8","text":"<pre><code>[&lt;Fact&gt;]\nlet ``\u7a7a\u6587\u5b57\u5217\u306f0\u3092\u8fd4\u3059`` () =\n    Assert.Equal(0, StringCalculator.add \"\")\n\n[&lt;Fact&gt;]\nlet ``\u5358\u4e00\u306e\u6570\u5024\u306f\u305d\u306e\u5024\u3092\u8fd4\u3059`` () =\n    Assert.Equal(5, StringCalculator.add \"5\")\n\n[&lt;Fact&gt;]\nlet ``\u30ab\u30f3\u30de\u533a\u5207\u308a\u306e\u6570\u5024\u3092\u5408\u8a08\u3059\u308b`` () =\n    Assert.Equal(6, StringCalculator.add \"1,2,3\")\n\n[&lt;Fact&gt;]\nlet ``\u6539\u884c\u533a\u5207\u308a\u3082\u51e6\u7406\u3059\u308b`` () =\n    Assert.Equal(6, StringCalculator.add \"1\\n2,3\")\n\n[&lt;Fact&gt;]\nlet ``\u30ab\u30b9\u30bf\u30e0\u533a\u5207\u308a\u6587\u5b57\u3092\u4f7f\u7528\u3067\u304d\u308b`` () =\n    Assert.Equal(3, StringCalculator.add \"//;\\n1;2\")\n\n[&lt;Fact&gt;]\nlet ``\u8ca0\u306e\u6570\u306f\u4f8b\u5916\u3092\u30b9\u30ed\u30fc\u3059\u308b`` () =\n    let ex = Assert.Throws&lt;System.ArgumentException&gt;(fun () -&gt;\n        StringCalculator.add \"1,-2,3\" |&gt; ignore)\n    Assert.Contains(\"-2\", ex.Message)\n\n[&lt;Fact&gt;]\nlet ``1000\u3088\u308a\u5927\u304d\u3044\u6570\u306f\u7121\u8996\u3059\u308b`` () =\n    Assert.Equal(2, StringCalculator.add \"2,1001\")\n</code></pre>"},{"location":"fsharp/06-tdd-functional/#_12","title":"\u5b9f\u88c5","text":"<pre><code>module StringCalculator =\n    /// \u533a\u5207\u308a\u6587\u5b57\u3068\u6570\u5024\u6587\u5b57\u5217\u3092\u30d1\u30fc\u30b9\n    let private parseInput (input: string) =\n        if input.StartsWith(\"//\") then\n            let delimiterEnd = input.IndexOf('\\n')\n            let delimiter = input.Substring(2, delimiterEnd - 2)\n            let numbers = input.Substring(delimiterEnd + 1)\n            (delimiter, numbers)\n        else\n            (\",|\\n\", input)\n\n    /// \u6570\u5024\u3092\u30d1\u30fc\u30b9\n    let private parseNumbers (numbers: string) (delimiter: string) =\n        let regex = System.Text.RegularExpressions.Regex(delimiter)\n        regex.Split(numbers)\n        |&gt; Array.filter (fun s -&gt; not (System.String.IsNullOrEmpty(s)))\n        |&gt; Array.map int\n        |&gt; Array.toList\n\n    /// \u8ca0\u306e\u6570\u3092\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\n    let private validateNumbers (nums: int list) =\n        let negatives = nums |&gt; List.filter (fun n -&gt; n &lt; 0)\n        if not (List.isEmpty negatives) then\n            let negStr = negatives |&gt; List.map string |&gt; String.concat \", \"\n            invalidArg \"input\" (sprintf \"negatives not allowed: %s\" negStr)\n\n    /// \u6587\u5b57\u5217\u96fb\u5353\n    let add (input: string) =\n        if System.String.IsNullOrEmpty(input) then\n            0\n        else\n            let (delimiter, numbers) = parseInput input\n            let nums = parseNumbers numbers delimiter\n            validateNumbers nums\n            nums |&gt; List.filter (fun n -&gt; n &lt;= 1000) |&gt; List.sum\n</code></pre>"},{"location":"fsharp/06-tdd-functional/#8","title":"8. \u7d14\u7c8b\u95a2\u6570\u3068\u30c6\u30b9\u30c8\u5bb9\u6613\u6027","text":""},{"location":"fsharp/06-tdd-functional/#_13","title":"\u7d14\u7c8b\u95a2\u6570\u306e\u5229\u70b9","text":"<pre><code>type Item = { Name: string; Price: decimal }\n\ntype TaxCalculation =\n    { Subtotal: decimal\n      Tax: decimal\n      Total: decimal }\n\nmodule TaxCalculator =\n    /// \u7a0e\u984d\u3092\u8a08\u7b97\n    let calculateTax (amount: decimal) (rate: decimal) = amount * rate\n\n    /// \u7a0e\u8fbc\u307f\u7dcf\u984d\u3092\u8a08\u7b97\n    let calculateTotalWithTax (items: Item list) (taxRate: decimal) =\n        let subtotal = items |&gt; List.sumBy (fun i -&gt; i.Price)\n        let tax = calculateTax subtotal taxRate\n        { Subtotal = subtotal\n          Tax = tax\n          Total = subtotal + tax }\n</code></pre>"},{"location":"fsharp/06-tdd-functional/#_14","title":"\u30c6\u30b9\u30c8","text":"<pre><code>[&lt;Fact&gt;]\nlet ``calculateTotalWithTax\u306f\u7a0e\u8fbc\u307f\u7dcf\u984d\u3092\u8a08\u7b97\u3059\u308b`` () =\n    let items =\n        [ { Name = \"\u5546\u54c1A\"; Price = 1000m }\n          { Name = \"\u5546\u54c1B\"; Price = 2000m } ]\n    let result = TaxCalculator.calculateTotalWithTax items 0.1m\n\n    Assert.Equal(3000m, result.Subtotal)\n    Assert.Equal(300m, result.Tax)\n    Assert.Equal(3300m, result.Total)\n</code></pre>"},{"location":"fsharp/06-tdd-functional/#9-","title":"9. \u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u30d1\u30bf\u30fc\u30f3 - \u30c7\u30fc\u30bf\u99c6\u52d5\u306e\u5b9f\u88c5","text":""},{"location":"fsharp/06-tdd-functional/#before","title":"Before: \u8907\u96d1\u306a\u6761\u4ef6\u5206\u5c90","text":"<pre><code>let calculateShippingBefore total weight region =\n    if total &gt;= 10000m then 0\n    else\n        match region with\n        | Local when weight &lt; 5.0 -&gt; 300\n        | Local -&gt; 500\n        | Domestic when weight &lt; 5.0 -&gt; 500\n        | Domestic -&gt; 800\n        | International when weight &lt; 5.0 -&gt; 2000\n        | International -&gt; 3000\n</code></pre>"},{"location":"fsharp/06-tdd-functional/#after","title":"After: \u30c7\u30fc\u30bf\u99c6\u52d5\u306e\u5b9f\u88c5","text":"<pre><code>type Region =\n    | Local\n    | Domestic\n    | International\n\ntype ShippingOrder =\n    { Total: decimal\n      Weight: float\n      Region: Region }\n\nmodule ShippingCalculator =\n    let isFreeShipping (total: decimal) = total &gt;= 10000m\n\n    let private shippingRates =\n        Map.ofList\n            [ (Local, Map.ofList [ (true, 300); (false, 500) ])\n              (Domestic, Map.ofList [ (true, 500); (false, 800) ])\n              (International, Map.ofList [ (true, 2000); (false, 3000) ]) ]\n\n    let calculateShipping (order: ShippingOrder) =\n        if isFreeShipping order.Total then\n            0\n        else\n            let isLight = order.Weight &lt; 5.0\n            shippingRates\n            |&gt; Map.tryFind order.Region\n            |&gt; Option.bind (Map.tryFind isLight)\n            |&gt; Option.defaultValue 500\n</code></pre>"},{"location":"fsharp/06-tdd-functional/#10-","title":"10. \u30d1\u30b9\u30ef\u30fc\u30c9\u30d0\u30ea\u30c7\u30fc\u30bf\u30fc - \u30eb\u30fc\u30eb\u306e\u5408\u6210","text":"<pre><code>module PasswordValidator =\n    type Rule = string -&gt; string option\n\n    let minLength (min: int) : Rule =\n        fun password -&gt;\n            if password.Length &gt;= min then None\n            else Some (sprintf \"Password must be at least %d characters\" min)\n\n    let hasUppercase: Rule =\n        fun password -&gt;\n            if password |&gt; Seq.exists System.Char.IsUpper then None\n            else Some \"Password must contain at least one uppercase letter\"\n\n    let hasLowercase: Rule =\n        fun password -&gt;\n            if password |&gt; Seq.exists System.Char.IsLower then None\n            else Some \"Password must contain at least one lowercase letter\"\n\n    let hasDigit: Rule =\n        fun password -&gt;\n            if password |&gt; Seq.exists System.Char.IsDigit then None\n            else Some \"Password must contain at least one digit\"\n\n    let defaultRules: Rule list =\n        [ minLength 8; hasUppercase; hasLowercase; hasDigit ]\n\n    let validate (password: string) (rules: Rule list) : Result&lt;string, string list&gt; =\n        let errors = rules |&gt; List.choose (fun rule -&gt; rule password)\n        if List.isEmpty errors then Ok password\n        else Error errors\n\n    let validateWithDefaults (password: string) : Result&lt;string, string list&gt; =\n        validate password defaultRules\n</code></pre>"},{"location":"fsharp/06-tdd-functional/#tdd_1","title":"TDD \u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9","text":""},{"location":"fsharp/06-tdd-functional/#1","title":"1. \u5c0f\u3055\u306a\u30b9\u30c6\u30c3\u30d7\u3067\u9032\u3080","text":"<ul> <li>\u4e00\u5ea6\u306b1\u3064\u306e\u30c6\u30b9\u30c8\u3060\u3051\u3092\u8ffd\u52a0</li> <li>\u30c6\u30b9\u30c8\u304c\u901a\u3063\u305f\u3089\u6b21\u306e\u30c6\u30b9\u30c8\u3078</li> </ul>"},{"location":"fsharp/06-tdd-functional/#2_1","title":"2. \u30c6\u30b9\u30c8\u540d\u306f\u4ed5\u69d8\u3068\u3057\u3066\u8aad\u3081\u308b","text":"<pre><code>[&lt;Fact&gt;]\nlet ``10000\u5186\u4ee5\u4e0a\u306f\u9001\u6599\u7121\u6599`` () = ...\n\n[&lt;Fact&gt;]\nlet ``\u8ca0\u306e\u6570\u306f\u4f8b\u5916\u3092\u30b9\u30ed\u30fc\u3059\u308b`` () = ...\n\n[&lt;Fact&gt;]\nlet ``\u30d1\u30fc\u30d5\u30a7\u30af\u30c8\u30b2\u30fc\u30e0\u306f300\u70b9`` () = ...\n</code></pre>"},{"location":"fsharp/06-tdd-functional/#3_1","title":"3. \u7d14\u7c8b\u95a2\u6570\u3092\u512a\u5148","text":"<ul> <li>\u526f\u4f5c\u7528\u3092\u6301\u3064\u95a2\u6570\u306f\u6700\u5c0f\u9650\u306b</li> <li>\u526f\u4f5c\u7528\u306f\u5883\u754c\u306b\u8ffd\u3044\u51fa\u3059</li> </ul>"},{"location":"fsharp/06-tdd-functional/#4_1","title":"4. \u30a8\u30c3\u30b8\u30b1\u30fc\u30b9\u3092\u30c6\u30b9\u30c8","text":"<pre><code>[&lt;Fact&gt;]\nlet ``\u7a7a\u6587\u5b57\u5217\u306f0\u3092\u8fd4\u3059`` () = ...\n\n[&lt;Fact&gt;]\nlet ``\u7a7a\u306e\u30ea\u30b9\u30c8\u306f\u7a7a\u306e\u30ea\u30b9\u30c8\u3092\u8fd4\u3059`` () = ...\n\n[&lt;Fact&gt;]\nlet ``\u5883\u754c\u5024\u3067\u6b63\u3057\u304f\u52d5\u4f5c\u3059\u308b`` () = ...\n</code></pre>"},{"location":"fsharp/06-tdd-functional/#clojurescala","title":"Clojure/Scala \u3068\u306e\u6bd4\u8f03","text":"\u6982\u5ff5 Clojure Scala F# \u30c6\u30b9\u30c8\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af speclj, clojure.test ScalaTest xUnit, FsCheck \u30c6\u30b9\u30c8\u69cb\u6587 <code>(it \"...\" (should= ...))</code> <code>test(\"...\") { ... shouldBe ... }</code> <code>[&lt;Fact&gt;] let ``...`` () = Assert.Equal(...)</code> \u4f8b\u5916\u30c6\u30b9\u30c8 <code>(should-throw ...)</code> <code>intercept[...] { ... }</code> <code>Assert.Throws&lt;...&gt;(...)</code> \u30c7\u30fc\u30bf\u69cb\u9020 \u6c38\u7d9a\u5316\u30c7\u30fc\u30bf\u69cb\u9020\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\uff09 <code>case class</code> + <code>copy</code> \u30ec\u30b3\u30fc\u30c9\u578b + <code>with</code> \u30eb\u30fc\u30d7 <code>loop/recur</code> <code>@annotation.tailrec</code> <code>let rec</code> \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1 <code>cond</code>, <code>case</code> <code>match</code> <code>match</code> \u578b\u30b7\u30b9\u30c6\u30e0 \u52d5\u7684\u578b\u4ed8\u3051 \u9759\u7684\u578b\u4ed8\u3051 \u9759\u7684\u578b\u4ed8\u3051 + \u578b\u63a8\u8ad6"},{"location":"fsharp/06-tdd-functional/#f","title":"F# \u7279\u6709\u306e\u30d1\u30bf\u30fc\u30f3","text":""},{"location":"fsharp/06-tdd-functional/#_15","title":"\u30d0\u30c3\u30af\u30af\u30a9\u30fc\u30c8\u30c6\u30b9\u30c8\u540d","text":"<p>F# \u3067\u306f\u65e5\u672c\u8a9e\u3084\u30b9\u30da\u30fc\u30b9\u3092\u542b\u3080\u30c6\u30b9\u30c8\u540d\u304c\u66f8\u3051\u308b\uff1a</p> <pre><code>[&lt;Fact&gt;]\nlet ``fizzbuzz 15\u306f\"FizzBuzz\"\u3092\u8fd4\u3059`` () = ...\n</code></pre>"},{"location":"fsharp/06-tdd-functional/#option","title":"Option \u578b\u306b\u3088\u308b\u5b89\u5168\u306a\u30a2\u30af\u30bb\u30b9","text":"<pre><code>member this.Pop() =\n    match this.Items with\n    | head :: tail -&gt; Some(head, { Items = tail })\n    | [] -&gt; None\n</code></pre>"},{"location":"fsharp/06-tdd-functional/#_16","title":"\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u6f14\u7b97\u5b50\u3068\u306e\u89aa\u548c\u6027","text":"<pre><code>let fizzbuzzSequence n =\n    [ 1 .. n ] |&gt; List.map fizzbuzz\n</code></pre>"},{"location":"fsharp/06-tdd-functional/#_17","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001TDD \u3068\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>Red-Green-Refactor: \u57fa\u672c\u30b5\u30a4\u30af\u30eb</li> <li>FizzBuzz: \u5178\u578b\u7684\u306a TDD \u4f8b</li> <li>\u30ed\u30fc\u30de\u6570\u5b57: \u30c7\u30fc\u30bf\u99c6\u52d5\u306e\u5b9f\u88c5</li> <li>\u30dc\u30a6\u30ea\u30f3\u30b0: \u8907\u96d1\u306a\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af</li> <li>\u7d20\u6570: \u30b7\u30f3\u30d7\u30eb\u306a\u95a2\u6570\u8a2d\u8a08</li> <li>\u30b9\u30bf\u30c3\u30af/\u30ad\u30e5\u30fc: \u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020</li> <li>\u6587\u5b57\u5217\u96fb\u5353: \u6bb5\u968e\u7684\u306a\u8981\u4ef6\u8ffd\u52a0</li> <li>\u7d14\u7c8b\u95a2\u6570: \u30c6\u30b9\u30c8\u5bb9\u6613\u6027</li> <li>\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0: \u6761\u4ef6\u5206\u5c90\u306e\u6574\u7406</li> <li>\u30d1\u30b9\u30ef\u30fc\u30c9\u30d0\u30ea\u30c7\u30fc\u30bf\u30fc: \u30eb\u30fc\u30eb\u306e\u5408\u6210</li> </ol> <p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3068 TDD \u306e\u7d44\u307f\u5408\u308f\u305b\u306b\u3088\u308a\u3001\u4fe1\u983c\u6027\u306e\u9ad8\u3044\u30b3\u30fc\u30c9\u3092\u52b9\u7387\u7684\u306b\u958b\u767a\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"fsharp/06-tdd-functional/#_18","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/fsharp/part2/src/Library.fs</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/fsharp/part2/tests/Tests.fs</code></li> </ul>"},{"location":"fsharp/06-tdd-functional/#_19","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u304b\u3089\u7b2c3\u90e8\u300c\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3 - \u69cb\u9020\u30d1\u30bf\u30fc\u30f3\u300d\u306b\u5165\u308a\u307e\u3059\u3002Composite \u30d1\u30bf\u30fc\u30f3\u3092\u95a2\u6570\u578b\u30b9\u30bf\u30a4\u30eb\u3067\u5b9f\u88c5\u3059\u308b\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"fsharp/07-composite-pattern/","title":"\u7b2c7\u7ae0: Composite \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"fsharp/07-composite-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Composite \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u30c4\u30ea\u30fc\u69cb\u9020\u3067\u69cb\u6210\u3057\u3001\u500b\u3005\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u96c6\u5408\u3092\u540c\u3058\u3088\u3046\u306b\u6271\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u3053\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306f\u500b\u3005\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u305d\u306e\u7d44\u307f\u5408\u308f\u305b\u3092\u533a\u5225\u305b\u305a\u306b\u64cd\u4f5c\u3067\u304d\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u56f3\u5f62\uff08Shape\uff09\u3001\u30b9\u30a4\u30c3\u30c1\uff08Switchable\uff09\u3001\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3001\u30e1\u30cb\u30e5\u30fc\u3001\u6570\u5f0f\u3001\u7d44\u7e54\u69cb\u9020\u306a\u3069\u3001\u69d8\u3005\u306a\u4f8b\u3092\u901a\u3058\u3066 Composite \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"fsharp/07-composite-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Composite \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Component: \u5168\u3066\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u5171\u901a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>Leaf: \u5b50\u8981\u7d20\u3092\u6301\u305f\u306a\u3044\u672b\u7aef\u30aa\u30d6\u30b8\u30a7\u30af\u30c8</li> <li>Composite: \u5b50\u8981\u7d20\u3092\u6301\u3064\u30b3\u30f3\u30c6\u30ca\u30aa\u30d6\u30b8\u30a7\u30af\u30c8</li> </ul> <p></p>"},{"location":"fsharp/07-composite-pattern/#2-shape-composite","title":"2. Shape - \u56f3\u5f62\u306e Composite \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"fsharp/07-composite-pattern/#_2","title":"\u5224\u5225\u5171\u7528\u4f53\u306b\u3088\u308b\u5171\u901a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9","text":"<p>F# \u3067\u306f\u5224\u5225\u5171\u7528\u4f53\u3092\u4f7f\u3063\u3066 Component \u3092\u8868\u73fe\u3057\u307e\u3059\uff1a</p> <pre><code>/// 2D\u5ea7\u6a19\ntype Point =\n    { X: float\n      Y: float }\n\n/// \u56f3\u5f62\u306e\u5171\u901a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\uff08\u5224\u5225\u5171\u7528\u4f53\uff09\n[&lt;RequireQualifiedAccess&gt;]\ntype Shape =\n    | Circle of center: Point * radius: float\n    | Square of topLeft: Point * side: float\n    | Rectangle of topLeft: Point * width: float * height: float\n    | Composite of shapes: Shape list\n</code></pre>"},{"location":"fsharp/07-composite-pattern/#_3","title":"\u518d\u5e30\u7684\u306a\u64cd\u4f5c","text":"<pre><code>module Shape =\n    /// \u56f3\u5f62\u3092\u79fb\u52d5\n    let rec translate dx dy shape =\n        match shape with\n        | Shape.Circle(center, radius) -&gt;\n            Shape.Circle({ X = center.X + dx; Y = center.Y + dy }, radius)\n        | Shape.Square(topLeft, side) -&gt;\n            Shape.Square({ X = topLeft.X + dx; Y = topLeft.Y + dy }, side)\n        | Shape.Rectangle(topLeft, width, height) -&gt;\n            Shape.Rectangle({ X = topLeft.X + dx; Y = topLeft.Y + dy }, width, height)\n        | Shape.Composite shapes -&gt;\n            Shape.Composite(shapes |&gt; List.map (translate dx dy))\n\n    /// \u56f3\u5f62\u3092\u62e1\u5927\u30fb\u7e2e\u5c0f\n    let rec scale factor shape =\n        match shape with\n        | Shape.Circle(center, radius) -&gt; Shape.Circle(center, radius * factor)\n        | Shape.Square(topLeft, side) -&gt; Shape.Square(topLeft, side * factor)\n        | Shape.Rectangle(topLeft, width, height) -&gt;\n            Shape.Rectangle(topLeft, width * factor, height * factor)\n        | Shape.Composite shapes -&gt; Shape.Composite(shapes |&gt; List.map (scale factor))\n\n    /// \u56f3\u5f62\u306e\u9762\u7a4d\u3092\u8a08\u7b97\n    let rec area shape =\n        match shape with\n        | Shape.Circle(_, radius) -&gt; System.Math.PI * radius * radius\n        | Shape.Square(_, side) -&gt; side * side\n        | Shape.Rectangle(_, width, height) -&gt; width * height\n        | Shape.Composite shapes -&gt; shapes |&gt; List.sumBy area\n</code></pre>"},{"location":"fsharp/07-composite-pattern/#_4","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// \u500b\u3005\u306e\u56f3\u5f62\u3092\u4f5c\u6210\nlet circle = Shape.Circle(Point.create 10.0 10.0, 5.0)\nlet square = Shape.Square(Point.create 0.0 0.0, 10.0)\n\n// \u8907\u5408\u56f3\u5f62\u3092\u4f5c\u6210\nlet group =\n    Shape.emptyComposite\n    |&gt; Shape.add circle\n    |&gt; Shape.add square\n\n// \u8907\u5408\u56f3\u5f62\u3092\u79fb\u52d5\uff08\u5168\u3066\u306e\u5b50\u8981\u7d20\u304c\u79fb\u52d5\u3059\u308b\uff09\nlet moved = Shape.translate 5.0 5.0 group\n\n// \u8907\u5408\u56f3\u5f62\u3092\u62e1\u5927\uff08\u5168\u3066\u306e\u5b50\u8981\u7d20\u304c\u62e1\u5927\u3059\u308b\uff09\nlet scaled = Shape.scale 2.0 group\n\n// \u9762\u7a4d\u306f\u5168\u3066\u306e\u5b50\u8981\u7d20\u306e\u5408\u8a08\nlet totalArea = Shape.area group  // PI * 25 + 100\n</code></pre>"},{"location":"fsharp/07-composite-pattern/#3-switchable-composite","title":"3. Switchable - \u30b9\u30a4\u30c3\u30c1\u306e Composite \u30d1\u30bf\u30fc\u30f3","text":"<pre><code>/// \u30b9\u30a4\u30c3\u30c1\u306e\u5171\u901a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\n[&lt;RequireQualifiedAccess&gt;]\ntype Switchable =\n    | Light of on: bool * name: string\n    | DimmableLight of intensity: int * name: string\n    | Fan of on: bool * speed: int * name: string\n    | Composite of switchables: Switchable list * name: string\n\nmodule Switchable =\n    /// \u30b9\u30a4\u30c3\u30c1\u3092\u30aa\u30f3\u306b\u3059\u308b\n    let rec turnOn switchable =\n        match switchable with\n        | Switchable.Light(_, name) -&gt; Switchable.Light(true, name)\n        | Switchable.DimmableLight(_, name) -&gt; Switchable.DimmableLight(100, name)\n        | Switchable.Fan(_, speed, name) -&gt; Switchable.Fan(true, speed, name)\n        | Switchable.Composite(switchables, name) -&gt;\n            Switchable.Composite(switchables |&gt; List.map turnOn, name)\n\n    /// \u30b9\u30a4\u30c3\u30c1\u304c\u30aa\u30f3\u304b\u3069\u3046\u304b\n    let rec isOn switchable =\n        match switchable with\n        | Switchable.Light(on, _) -&gt; on\n        | Switchable.DimmableLight(intensity, _) -&gt; intensity &gt; 0\n        | Switchable.Fan(on, _, _) -&gt; on\n        | Switchable.Composite(switchables, _) -&gt; switchables |&gt; List.exists isOn\n</code></pre>"},{"location":"fsharp/07-composite-pattern/#_5","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// \u90e8\u5c4b\u306e\u30b9\u30a4\u30c3\u30c1\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\nlet bedroom =\n    Switchable.emptyComposite \"Bedroom\"\n    |&gt; Switchable.add (Switchable.Light(false, \"Ceiling\"))\n    |&gt; Switchable.add (Switchable.DimmableLight(0, \"Bedside\"))\n\nlet livingRoom =\n    Switchable.emptyComposite \"LivingRoom\"\n    |&gt; Switchable.add (Switchable.Light(false, \"Main\"))\n    |&gt; Switchable.add (Switchable.Fan(false, 0, \"CeilingFan\"))\n\n// \u5bb6\u5168\u4f53\u306e\u30b0\u30eb\u30fc\u30d7\nlet house =\n    Switchable.emptyComposite \"House\"\n    |&gt; Switchable.add bedroom\n    |&gt; Switchable.add livingRoom\n\n// \u5bb6\u4e2d\u306e\u5168\u3066\u306e\u30b9\u30a4\u30c3\u30c1\u3092\u30aa\u30f3\nlet allOn = Switchable.turnOn house\n</code></pre>"},{"location":"fsharp/07-composite-pattern/#4-filesystem-composite","title":"4. FileSystem - \u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306e Composite \u30d1\u30bf\u30fc\u30f3","text":"<pre><code>/// \u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u30a8\u30f3\u30c8\u30ea\n[&lt;RequireQualifiedAccess&gt;]\ntype FileSystemEntry =\n    | File of name: string * size: int64 * extension: string\n    | Directory of name: string * children: FileSystemEntry list\n\nmodule FileSystemEntry =\n    /// \u30b5\u30a4\u30ba\u3092\u53d6\u5f97\n    let rec size entry =\n        match entry with\n        | FileSystemEntry.File(_, fileSize, _) -&gt; fileSize\n        | FileSystemEntry.Directory(_, children) -&gt; children |&gt; List.sumBy size\n\n    /// \u30d5\u30a1\u30a4\u30eb\u6570\u3092\u53d6\u5f97\n    let rec fileCount entry =\n        match entry with\n        | FileSystemEntry.File _ -&gt; 1\n        | FileSystemEntry.Directory(_, children) -&gt; children |&gt; List.sumBy fileCount\n\n    /// \u62e1\u5f35\u5b50\u3067\u30d5\u30a1\u30a4\u30eb\u3092\u691c\u7d22\n    let findByExtension ext entry =\n        find\n            (function\n            | FileSystemEntry.File(_, _, e) -&gt; e = ext\n            | _ -&gt; false)\n            entry\n\n    /// \u3059\u3079\u3066\u306e\u30d5\u30a1\u30a4\u30eb\u3092\u53d6\u5f97\n    let rec allFiles entry =\n        match entry with\n        | FileSystemEntry.File _ as f -&gt; [ f ]\n        | FileSystemEntry.Directory(_, children) -&gt; children |&gt; List.collect allFiles\n</code></pre>"},{"location":"fsharp/07-composite-pattern/#_6","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// \u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u69cb\u9020\u3092\u69cb\u7bc9\nlet readme = FileSystemEntry.File(\"readme.txt\", 1024L, \".txt\")\nlet config = FileSystemEntry.File(\"config.json\", 512L, \".json\")\nlet src = FileSystemEntry.Directory(\"src\", [\n    FileSystemEntry.File(\"main.fs\", 2048L, \".fs\")\n    FileSystemEntry.File(\"util.fs\", 1024L, \".fs\")\n])\nlet root = FileSystemEntry.Directory(\"project\", [ readme; config; src ])\n\n// \u7dcf\u30b5\u30a4\u30ba\u3092\u53d6\u5f97\nlet totalSize = FileSystemEntry.size root  // 4608\n\n// .fs \u30d5\u30a1\u30a4\u30eb\u3092\u691c\u7d22\nlet fsFiles = FileSystemEntry.findByExtension \".fs\" root\n</code></pre>"},{"location":"fsharp/07-composite-pattern/#5-menuitem-composite","title":"5. MenuItem - \u30e1\u30cb\u30e5\u30fc\u306e Composite \u30d1\u30bf\u30fc\u30f3","text":"<pre><code>/// \u30e1\u30cb\u30e5\u30fc\u9805\u76ee\n[&lt;RequireQualifiedAccess&gt;]\ntype MenuItem =\n    | Item of name: string * price: decimal * category: string\n    | SetMenu of name: string * items: MenuItem list * discountRate: float\n\nmodule MenuItem =\n    /// \u4fa1\u683c\u3092\u8a08\u7b97\n    let rec price menuItem =\n        match menuItem with\n        | MenuItem.Item(_, itemPrice, _) -&gt; itemPrice\n        | MenuItem.SetMenu(_, items, discountRate) -&gt;\n            let totalPrice = items |&gt; List.sumBy price\n            totalPrice * (1m - decimal discountRate)\n\n    /// \u30a2\u30a4\u30c6\u30e0\u6570\u3092\u53d6\u5f97\n    let rec itemCount menuItem =\n        match menuItem with\n        | MenuItem.Item _ -&gt; 1\n        | MenuItem.SetMenu(_, items, _) -&gt; items |&gt; List.sumBy itemCount\n</code></pre>"},{"location":"fsharp/07-composite-pattern/#_7","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// \u5358\u54c1\u30e1\u30cb\u30e5\u30fc\nlet burger = MenuItem.Item(\"Hamburger\", 500m, \"Main\")\nlet fries = MenuItem.Item(\"Fries\", 200m, \"Side\")\nlet drink = MenuItem.Item(\"Cola\", 150m, \"Drink\")\n\n// \u30bb\u30c3\u30c8\u30e1\u30cb\u30e5\u30fc\uff0810%\u5272\u5f15\uff09\nlet lunchSet = MenuItem.SetMenu(\"Lunch Set\", [ burger; fries; drink ], 0.1)\n\n// \u30bb\u30c3\u30c8\u4fa1\u683c = (500 + 200 + 150) * 0.9 = 765\nlet setPrice = MenuItem.price lunchSet\n</code></pre>"},{"location":"fsharp/07-composite-pattern/#6-expression-composite","title":"6. Expression - \u6570\u5f0f\u306e Composite \u30d1\u30bf\u30fc\u30f3","text":"<pre><code>/// \u6570\u5f0f\n[&lt;RequireQualifiedAccess&gt;]\ntype Expression =\n    | Number of float\n    | Variable of name: string * value: float option\n    | Add of left: Expression * right: Expression\n    | Subtract of left: Expression * right: Expression\n    | Multiply of left: Expression * right: Expression\n    | Divide of left: Expression * right: Expression\n    | Negate of Expression\n\nmodule Expression =\n    /// \u6570\u5f0f\u3092\u8a55\u4fa1\n    let rec evaluate expr =\n        match expr with\n        | Expression.Number n -&gt; n\n        | Expression.Variable(name, value) -&gt;\n            match value with\n            | Some v -&gt; v\n            | None -&gt; failwithf \"Variable %s has no value\" name\n        | Expression.Add(left, right) -&gt; evaluate left + evaluate right\n        | Expression.Subtract(left, right) -&gt; evaluate left - evaluate right\n        | Expression.Multiply(left, right) -&gt; evaluate left * evaluate right\n        | Expression.Divide(left, right) -&gt; evaluate left / evaluate right\n        | Expression.Negate e -&gt; -(evaluate e)\n\n    /// \u6570\u5f0f\u3092\u7c21\u7565\u5316\n    let rec simplify expr =\n        match expr with\n        | Expression.Add(left, right) -&gt;\n            match simplify left, simplify right with\n            | Expression.Number 0.0, r -&gt; r\n            | l, Expression.Number 0.0 -&gt; l\n            | Expression.Number a, Expression.Number b -&gt; Expression.Number(a + b)\n            | l, r -&gt; Expression.Add(l, r)\n        // ... \u4ed6\u306e\u6f14\u7b97\u5b50\u3082\u540c\u69d8\n</code></pre>"},{"location":"fsharp/07-composite-pattern/#_8","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// (2 + 3) * 4 = 20\nlet expr =\n    Expression.Multiply(\n        Expression.Add(Expression.Number 2.0, Expression.Number 3.0),\n        Expression.Number 4.0\n    )\nlet result = Expression.evaluate expr  // 20.0\n\n// \u5909\u6570\u3092\u542b\u3080\u5f0f\nlet exprWithVars =\n    Expression.Add(Expression.Variable(\"x\", None), Expression.Variable(\"y\", None))\nlet bound = Expression.bind (Map.ofList [ (\"x\", 10.0); (\"y\", 20.0) ]) exprWithVars\nlet value = Expression.evaluate bound  // 30.0\n\n// \u5f0f\u306e\u7c21\u7565\u5316\nlet simplified = Expression.simplify (Expression.Add(Expression.Variable(\"x\", None), Expression.Number 0.0))\n// =&gt; Expression.Variable(\"x\", None)\n</code></pre>"},{"location":"fsharp/07-composite-pattern/#7-organization-composite","title":"7. Organization - \u7d44\u7e54\u69cb\u9020\u306e Composite \u30d1\u30bf\u30fc\u30f3","text":"<pre><code>/// \u7d44\u7e54\u306e\u69cb\u6210\u54e1\n[&lt;RequireQualifiedAccess&gt;]\ntype OrganizationMember =\n    | Employee of name: string * salary: decimal * role: string\n    | Department of name: string * members: OrganizationMember list * manager: string option\n\nmodule OrganizationMember =\n    /// \u7dcf\u7d66\u4e0e\u3092\u8a08\u7b97\n    let rec totalSalary orgMember =\n        match orgMember with\n        | OrganizationMember.Employee(_, salary, _) -&gt; salary\n        | OrganizationMember.Department(_, members, _) -&gt; members |&gt; List.sumBy totalSalary\n\n    /// \u5f93\u696d\u54e1\u6570\u3092\u53d6\u5f97\n    let rec employeeCount orgMember =\n        match orgMember with\n        | OrganizationMember.Employee _ -&gt; 1\n        | OrganizationMember.Department(_, members, _) -&gt; members |&gt; List.sumBy employeeCount\n\n    /// \u5f79\u8077\u3067\u5f93\u696d\u54e1\u3092\u691c\u7d22\n    let rec findByRole role orgMember =\n        match orgMember with\n        | OrganizationMember.Employee(_, _, r) as emp -&gt;\n            if r = role then [ emp ] else []\n        | OrganizationMember.Department(_, members, _) -&gt;\n            members |&gt; List.collect (findByRole role)\n</code></pre>"},{"location":"fsharp/07-composite-pattern/#_9","title":"\u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u7d71\u4e00\u7684\u306a\u64cd\u4f5c: \u500b\u3005\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u30b0\u30eb\u30fc\u30d7\u3092\u540c\u3058\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u64cd\u4f5c\u53ef\u80fd</li> <li>\u968e\u5c64\u69cb\u9020: \u30cd\u30b9\u30c8\u3057\u305f\u69cb\u9020\u3092\u81ea\u7136\u306b\u8868\u73fe\u53ef\u80fd</li> <li>\u62e1\u5f35\u6027: \u65b0\u3057\u3044 Leaf \u3084 Composite \u3092\u8ffd\u52a0\u3057\u3084\u3059\u3044</li> <li>\u518d\u5e30\u7684\u306a\u69cb\u9020: Composite \u306f\u4ed6\u306e Composite \u3092\u542b\u3080\u3053\u3068\u3082\u53ef\u80fd</li> </ol>"},{"location":"fsharp/07-composite-pattern/#f","title":"F# \u3067\u306e\u7279\u5fb4","text":""},{"location":"fsharp/07-composite-pattern/#_10","title":"\u5224\u5225\u5171\u7528\u4f53\u306b\u3088\u308b\u578b\u5b89\u5168\u6027","text":"<pre><code>// \u5168\u3066\u306e\u30b1\u30fc\u30b9\u3092\u7db2\u7f85\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\nlet rec area shape =\n    match shape with\n    | Shape.Circle(_, radius) -&gt; System.Math.PI * radius * radius\n    | Shape.Square(_, side) -&gt; side * side\n    | Shape.Rectangle(_, width, height) -&gt; width * height\n    | Shape.Composite shapes -&gt; shapes |&gt; List.sumBy area\n    // \u65b0\u3057\u3044\u30b1\u30fc\u30b9\u3092\u8ffd\u52a0\u3059\u308b\u3068\u3001\u30b3\u30f3\u30d1\u30a4\u30e9\u304c\u8b66\u544a\u3092\u51fa\u3059\n</code></pre>"},{"location":"fsharp/07-composite-pattern/#_11","title":"\u4e0d\u5909\u6027\u306b\u3088\u308b\u5b89\u5168\u306a\u64cd\u4f5c","text":"<pre><code>// \u5143\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u5909\u66f4\u3055\u308c\u306a\u3044\nlet original = Shape.emptyComposite |&gt; Shape.add (Shape.Circle(Point.origin, 5.0))\nlet moved = Shape.translate 10.0 10.0 original\n\n// original \u306f\u5909\u66f4\u3055\u308c\u3066\u3044\u306a\u3044\n</code></pre>"},{"location":"fsharp/07-composite-pattern/#_12","title":"\u518d\u5e30\u95a2\u6570\u3068\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3","text":"<pre><code>// \u518d\u5e30\u7684\u306a\u51e6\u7406\u3082\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3067\u8aad\u307f\u3084\u3059\u304f\nlet result =\n    Shape.emptyComposite\n    |&gt; Shape.add circle\n    |&gt; Shape.add square\n    |&gt; Shape.translate 5.0 5.0\n    |&gt; Shape.scale 2.0\n    |&gt; Shape.area\n</code></pre>"},{"location":"fsharp/07-composite-pattern/#clojurescala","title":"Clojure/Scala \u3068\u306e\u6bd4\u8f03","text":"\u6982\u5ff5 Clojure Scala F# \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9 \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9 sealed trait \u5224\u5225\u5171\u7528\u4f53 Leaf defmethod case class extends trait Union case Composite defmethod + mapv case class extends trait Union case with list \u30c7\u30fc\u30bf\u69cb\u9020 \u30de\u30c3\u30d7 case class \u30ec\u30b3\u30fc\u30c9/Union \u64cd\u4f5c\u306e\u59d4\u8b72 mapv shapes.map(...) List.map \u4e0d\u5909\u6027 \u30c7\u30d5\u30a9\u30eb\u30c8 case class + copy \u30c7\u30d5\u30a9\u30eb\u30c8 \u7db2\u7f85\u6027\u30c1\u30a7\u30c3\u30af \u306a\u3057 sealed \u3067\u8b66\u544a \u5b8c\u5168\u30c1\u30a7\u30c3\u30af"},{"location":"fsharp/07-composite-pattern/#_13","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Composite \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>Shape \u306e\u4f8b: \u56f3\u5f62\u306e\u79fb\u52d5\u3068\u62e1\u5927\u3092\u7d71\u4e00\u7684\u306b\u64cd\u4f5c</li> <li>Switchable \u306e\u4f8b: \u8907\u6570\u306e\u30b9\u30a4\u30c3\u30c1\u3092\u30b0\u30eb\u30fc\u30d7\u5316\u3057\u3066\u64cd\u4f5c</li> <li>FileSystem \u306e\u4f8b: \u30d5\u30a1\u30a4\u30eb\u3068\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u968e\u5c64\u69cb\u9020</li> <li>Menu \u306e\u4f8b: \u5358\u54c1\u3068\u30bb\u30c3\u30c8\u30e1\u30cb\u30e5\u30fc\u306e\u4fa1\u683c\u8a08\u7b97</li> <li>Expression \u306e\u4f8b: \u6570\u5f0f\u306e\u8a55\u4fa1\u3068\u7c21\u7565\u5316</li> <li>Organization \u306e\u4f8b: \u7d44\u7e54\u69cb\u9020\u306e\u7d66\u4e0e\u8a08\u7b97</li> </ol> <p>Composite \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30c4\u30ea\u30fc\u69cb\u9020\u306e\u30c7\u30fc\u30bf\u3092\u6271\u3046\u969b\u306b\u975e\u5e38\u306b\u6709\u52b9\u306a\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002F# \u306e\u5224\u5225\u5171\u7528\u4f53\u3068\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u3092\u4f7f\u3046\u3053\u3068\u3067\u3001\u578b\u5b89\u5168\u3067\u4e0d\u5909\u306a\u30c4\u30ea\u30fc\u69cb\u9020\u3092\u7c21\u6f54\u306b\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"fsharp/07-composite-pattern/#_14","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/fsharp/part3/src/Library.fs</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/fsharp/part3/tests/Tests.fs</code></li> </ul>"},{"location":"fsharp/07-composite-pattern/#_15","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Decorator \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u65e2\u5b58\u306e\u6a5f\u80fd\u306b\u65b0\u3057\u3044\u6a5f\u80fd\u3092\u52d5\u7684\u306b\u8ffd\u52a0\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"fsharp/08-decorator-pattern/","title":"\u7b2c8\u7ae0: Decorator \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"fsharp/08-decorator-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Decorator \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u65e2\u5b58\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u65b0\u3057\u3044\u6a5f\u80fd\u3092\u52d5\u7684\u306b\u8ffd\u52a0\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u3053\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u30b5\u30d6\u30af\u30e9\u30b9\u5316\u306b\u3088\u308b\u7d99\u627f\u3088\u308a\u3082\u67d4\u8edf\u306a\u65b9\u6cd5\u3067\u6a5f\u80fd\u3092\u62e1\u5f35\u3067\u304d\u307e\u3059\u3002</p> <p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u9ad8\u968e\u95a2\u6570\u3092\u4f7f\u3063\u3066\u95a2\u6570\u3092\u30e9\u30c3\u30d7\u3057\u3001\u6a2a\u65ad\u7684\u95a2\u5fc3\u4e8b\uff08\u30ed\u30b0\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u3001\u8a8d\u8a3c\u306a\u3069\uff09\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\u672c\u7ae0\u3067\u306f\u3001\u5f62\u72b6\u306e\u30b8\u30e3\u30fc\u30ca\u30ea\u30f3\u30b0\u3068\u95a2\u6570\u30c7\u30b3\u30ec\u30fc\u30bf\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"fsharp/08-decorator-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":""},{"location":"fsharp/08-decorator-pattern/#2-journaledshape-","title":"2. JournaledShape - \u5f62\u72b6\u30c7\u30b3\u30ec\u30fc\u30bf","text":""},{"location":"fsharp/08-decorator-pattern/#_2","title":"\u57fa\u672c\u5f62\u72b6\u306e\u5b9a\u7fa9","text":"<pre><code>/// \u30b8\u30e3\u30fc\u30ca\u30eb\u30a8\u30f3\u30c8\u30ea\uff08\u64cd\u4f5c\u306e\u8a18\u9332\uff09\ntype JournalEntry =\n    | Translate of dx: float * dy: float\n    | Scale of factor: float\n    | Rotate of angle: float\n\n/// \u57fa\u672c\u5f62\u72b6\uff08\u30c7\u30b3\u30ec\u30fc\u30c8\u5bfe\u8c61\uff09\n[&lt;RequireQualifiedAccess&gt;]\ntype Shape =\n    | Circle of centerX: float * centerY: float * radius: float\n    | Square of topLeftX: float * topLeftY: float * side: float\n    | Rectangle of topLeftX: float * topLeftY: float * width: float * height: float\n\nmodule Shape =\n    let translate dx dy shape =\n        match shape with\n        | Shape.Circle(cx, cy, r) -&gt; Shape.Circle(cx + dx, cy + dy, r)\n        | Shape.Square(x, y, s) -&gt; Shape.Square(x + dx, y + dy, s)\n        | Shape.Rectangle(x, y, w, h) -&gt; Shape.Rectangle(x + dx, y + dy, w, h)\n\n    let scale factor shape =\n        match shape with\n        | Shape.Circle(cx, cy, r) -&gt; Shape.Circle(cx, cy, r * factor)\n        | Shape.Square(x, y, s) -&gt; Shape.Square(x, y, s * factor)\n        | Shape.Rectangle(x, y, w, h) -&gt; Shape.Rectangle(x, y, w * factor, h * factor)\n</code></pre>"},{"location":"fsharp/08-decorator-pattern/#_3","title":"\u30b8\u30e3\u30fc\u30ca\u30eb\u4ed8\u304d\u5f62\u72b6\uff08\u30c7\u30b3\u30ec\u30fc\u30bf\uff09","text":"<pre><code>/// \u30b8\u30e3\u30fc\u30ca\u30eb\u4ed8\u304d\u5f62\u72b6\uff08\u30c7\u30b3\u30ec\u30fc\u30bf\uff09\ntype JournaledShape =\n    { Shape: Shape\n      Journal: JournalEntry list }\n\nmodule JournaledShape =\n    let create shape =\n        { Shape = shape; Journal = [] }\n\n    let translate dx dy js =\n        { Shape = Shape.translate dx dy js.Shape\n          Journal = js.Journal @ [ Translate(dx, dy) ] }\n\n    let scale factor js =\n        { Shape = Shape.scale factor js.Shape\n          Journal = js.Journal @ [ Scale factor ] }\n\n    let clearJournal js = { js with Journal = [] }\n\n    /// \u30b8\u30e3\u30fc\u30ca\u30eb\u30a8\u30f3\u30c8\u30ea\u3092\u518d\u751f\n    let replay entries js =\n        entries\n        |&gt; List.fold\n            (fun acc entry -&gt;\n                match entry with\n                | Translate(dx, dy) -&gt; translate dx dy acc\n                | Scale factor -&gt; scale factor acc\n                | Rotate _ -&gt; acc)\n            js\n</code></pre>"},{"location":"fsharp/08-decorator-pattern/#_4","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// \u5f62\u72b6\u3092\u30c7\u30b3\u30ec\u30fc\u30c8\nlet circle = Shape.Circle(0.0, 0.0, 5.0)\nlet journaled =\n    JournaledShape.create circle\n    |&gt; JournaledShape.translate 2.0 3.0\n    |&gt; JournaledShape.scale 5.0\n\n// \u30b8\u30e3\u30fc\u30ca\u30eb\u3092\u78ba\u8a8d\nJournaledShape.getJournal journaled\n// =&gt; [Translate(2.0, 3.0); Scale(5.0)]\n\n// \u5b9f\u969b\u306e\u5f62\u72b6\u3092\u78ba\u8a8d\nJournaledShape.getShape journaled\n// =&gt; Circle(2.0, 3.0, 25.0)\n</code></pre>"},{"location":"fsharp/08-decorator-pattern/#3","title":"3. \u95a2\u6570\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u9ad8\u968e\u95a2\u6570\u3092\u4f7f\u3063\u3066\u95a2\u6570\u3092\u30c7\u30b3\u30ec\u30fc\u30c8\u3057\u307e\u3059\u3002</p>"},{"location":"fsharp/08-decorator-pattern/#_5","title":"\u30ed\u30b0\u4ed8\u304d\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>/// \u30ed\u30b0\u30b3\u30ec\u30af\u30bf\u30fc\uff08\u526f\u4f5c\u7528\u3092\u8ffd\u8de1\uff09\ntype LogCollector() =\n    let mutable logs: string list = []\n    member _.Add(msg: string) = logs &lt;- logs @ [ msg ]\n    member _.GetLogs() = logs\n\n/// \u30ed\u30b0\u4ed8\u304d\u30c7\u30b3\u30ec\u30fc\u30bf\nlet withLogging (name: string) (collector: LogCollector) (f: 'a -&gt; 'b) : 'a -&gt; 'b =\n    fun a -&gt;\n        collector.Add(sprintf \"[%s] called with: %A\" name a)\n        let result = f a\n        collector.Add(sprintf \"[%s] returned: %A\" name result)\n        result\n\n// \u4f7f\u7528\u4f8b\nlet collector = LogCollector()\nlet add10 = fun x -&gt; x + 10\nlet logged = withLogging \"add10\" collector add10\nlogged 5  // 15 (\u30ed\u30b0\u3082\u8a18\u9332\u3055\u308c\u308b)\n</code></pre>"},{"location":"fsharp/08-decorator-pattern/#_6","title":"\u30ea\u30c8\u30e9\u30a4\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>/// \u30ea\u30c8\u30e9\u30a4\u30c7\u30b3\u30ec\u30fc\u30bf\nlet withRetry (maxRetries: int) (f: 'a -&gt; 'b) : 'a -&gt; 'b =\n    fun a -&gt;\n        let rec attempt remaining =\n            try\n                f a\n            with ex -&gt;\n                if remaining &gt; 0 then\n                    attempt (remaining - 1)\n                else\n                    raise ex\n\n        attempt maxRetries\n\n// \u4f7f\u7528\u4f8b\nlet unreliableFn = withRetry 3 callExternalService\n</code></pre>"},{"location":"fsharp/08-decorator-pattern/#_7","title":"\u30ad\u30e3\u30c3\u30b7\u30e5\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>/// \u30ad\u30e3\u30c3\u30b7\u30e5\u30c7\u30b3\u30ec\u30fc\u30bf\nlet withCache () : ('a -&gt; 'b) -&gt; ('a -&gt; 'b) =\n    fun f -&gt;\n        let cache = System.Collections.Generic.Dictionary&lt;'a, 'b&gt;()\n\n        fun a -&gt;\n            if cache.ContainsKey(a) then\n                cache.[a]\n            else\n                let result = f a\n                cache.[a] &lt;- result\n                result\n\n// \u4f7f\u7528\u4f8b\nlet expensiveFn = withCache () (fun x -&gt; x * x)\n</code></pre>"},{"location":"fsharp/08-decorator-pattern/#_8","title":"\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>/// \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30c7\u30b3\u30ec\u30fc\u30bf\nlet withValidation (validator: 'a -&gt; bool) (errorMsg: string) (f: 'a -&gt; 'b) : 'a -&gt; 'b =\n    fun a -&gt;\n        if validator a then\n            f a\n        else\n            invalidArg \"input\" (sprintf \"%s: %A\" errorMsg a)\n\n// \u4f7f\u7528\u4f8b\nlet positiveOnly = withValidation (fun x -&gt; x &gt; 0) \"Must be positive\" (fun x -&gt; x * 2)\npositiveOnly 5   // 10\npositiveOnly -5  // Exception!\n</code></pre>"},{"location":"fsharp/08-decorator-pattern/#_9","title":"\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>/// Option\u7d50\u679c\u30c7\u30b3\u30ec\u30fc\u30bf\uff08\u4f8b\u5916\u3092Option\u306b\u5909\u63db\uff09\nlet withOptionResult (f: 'a -&gt; 'b) : 'a -&gt; 'b option =\n    fun a -&gt;\n        try\n            Some(f a)\n        with _ -&gt;\n            None\n\n/// Either\u7d50\u679c\u30c7\u30b3\u30ec\u30fc\u30bf\uff08\u4f8b\u5916\u3092Result\u306b\u5909\u63db\uff09\nlet withEitherResult (f: 'a -&gt; 'b) : 'a -&gt; Result&lt;'b, exn&gt; =\n    fun a -&gt;\n        try\n            Ok(f a)\n        with ex -&gt;\n            Error ex\n\n/// \u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u30c7\u30b3\u30ec\u30fc\u30bf\nlet withDefault (defaultValue: 'b) (f: 'a -&gt; 'b) : 'a -&gt; 'b =\n    fun a -&gt;\n        try\n            f a\n        with _ -&gt;\n            defaultValue\n</code></pre>"},{"location":"fsharp/08-decorator-pattern/#4","title":"4. \u30c7\u30b3\u30ec\u30fc\u30bf\u306e\u5408\u6210","text":"<pre><code>/// \u8907\u6570\u306e\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u5408\u6210\nlet composeDecorators (decorators: (('a -&gt; 'b) -&gt; ('a -&gt; 'b)) list) (f: 'a -&gt; 'b) : 'a -&gt; 'b =\n    decorators |&gt; List.fold (fun decorated decorator -&gt; decorator decorated) f\n\n// \u4f7f\u7528\u4f8b\nlet collector = LogCollector()\nlet double' = fun x -&gt; x * 2\nlet decorators = [\n    withLogging \"double\" collector\n    withValidation (fun x -&gt; x &gt; 0) \"Must be positive\"\n]\nlet composed = composeDecorators decorators double'\ncomposed 5  // 10 (\u30ed\u30b0\u3082\u8a18\u9332\u3055\u308c\u308b)\n</code></pre>"},{"location":"fsharp/08-decorator-pattern/#5-auditedlist-","title":"5. AuditedList - \u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>/// \u64cd\u4f5c\u5c65\u6b74\u4ed8\u304d\u30ea\u30b9\u30c8\ntype AuditedList&lt;'T&gt; =\n    { Items: 'T list\n      Operations: string list }\n\nmodule AuditedList =\n    let empty&lt;'T&gt; : AuditedList&lt;'T&gt; = { Items = []; Operations = [] }\n\n    let add (item: 'T) (list: AuditedList&lt;'T&gt;) =\n        { Items = list.Items @ [ item ]\n          Operations = list.Operations @ [ sprintf \"add(%A)\" item ] }\n\n    let remove (item: 'T) (list: AuditedList&lt;'T&gt;) =\n        { Items = list.Items |&gt; List.filter ((&lt;&gt;) item)\n          Operations = list.Operations @ [ sprintf \"remove(%A)\" item ] }\n\n    let map (f: 'T -&gt; 'U) (list: AuditedList&lt;'T&gt;) : AuditedList&lt;'U&gt; =\n        { Items = List.map f list.Items\n          Operations = list.Operations @ [ \"map\" ] }\n\n    let filter (predicate: 'T -&gt; bool) (list: AuditedList&lt;'T&gt;) =\n        { Items = List.filter predicate list.Items\n          Operations = list.Operations @ [ \"filter\" ] }\n\n// \u4f7f\u7528\u4f8b\nlet list =\n    AuditedList.empty\n    |&gt; AuditedList.add 1\n    |&gt; AuditedList.add 2\n    |&gt; AuditedList.add 3\n    |&gt; AuditedList.filter (fun x -&gt; x &gt; 1)\n\nlist.Operations // [\"add(1)\"; \"add(2)\"; \"add(3)\"; \"filter\"]\n</code></pre>"},{"location":"fsharp/08-decorator-pattern/#6-http","title":"6. HTTP\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>/// HTTP\u30ec\u30b9\u30dd\u30f3\u30b9\ntype HttpResponse = { StatusCode: int; Body: string }\n\n/// HTTP\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\ntype IHttpClient =\n    abstract member Get: string -&gt; HttpResponse\n\n/// \u30b7\u30f3\u30d7\u30eb\u306aHTTP\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\ntype SimpleHttpClient() =\n    interface IHttpClient with\n        member _.Get(url: string) =\n            { StatusCode = 200\n              Body = sprintf \"Response from %s\" url }\n\n/// \u30ed\u30b0\u4ed8\u304dHTTP\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\uff08\u30c7\u30b3\u30ec\u30fc\u30bf\uff09\ntype LoggingHttpClient(client: IHttpClient, collector: LogCollector) =\n    interface IHttpClient with\n        member _.Get(url: string) =\n            collector.Add(sprintf \"[HTTP] GET %s\" url)\n            let response = client.Get(url)\n            collector.Add(sprintf \"[HTTP] Response: %d\" response.StatusCode)\n            response\n\n/// \u30ad\u30e3\u30c3\u30b7\u30e5\u4ed8\u304dHTTP\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\uff08\u30c7\u30b3\u30ec\u30fc\u30bf\uff09\ntype CachingHttpClient(client: IHttpClient) =\n    let cache = System.Collections.Generic.Dictionary&lt;string, HttpResponse&gt;()\n\n    interface IHttpClient with\n        member _.Get(url: string) =\n            if cache.ContainsKey(url) then\n                cache.[url]\n            else\n                let response = client.Get(url)\n                cache.[url] &lt;- response\n                response\n\n// \u30c7\u30b3\u30ec\u30fc\u30bf\u306e\u7d44\u307f\u5408\u308f\u305b\nlet collector = LogCollector()\nlet client =\n    SimpleHttpClient() :&gt; IHttpClient\n    |&gt; fun c -&gt; CachingHttpClient(c) :&gt; IHttpClient\n    |&gt; fun c -&gt; LoggingHttpClient(c, collector) :&gt; IHttpClient\n</code></pre>"},{"location":"fsharp/08-decorator-pattern/#7-functionbuilder-","title":"7. FunctionBuilder - \u30d3\u30eb\u30c0\u30fc\u30b9\u30bf\u30a4\u30eb","text":"<pre><code>/// \u95a2\u6570\u30d3\u30eb\u30c0\u30fc\ntype FunctionBuilder&lt;'a, 'b&gt;(f: 'a -&gt; 'b, collector: LogCollector) =\n    let mutable current = f\n\n    member _.WithLogging(name: string) =\n        current &lt;- withLogging name collector current\n        FunctionBuilder(current, collector)\n\n    member _.WithValidation(validator: 'a -&gt; bool, errorMsg: string) =\n        current &lt;- withValidation validator errorMsg current\n        FunctionBuilder(current, collector)\n\n    member _.WithRetry(maxRetries: int) =\n        current &lt;- withRetry maxRetries current\n        FunctionBuilder(current, collector)\n\n    member _.Build() = current\n\n// \u4f7f\u7528\u4f8b\nlet collector = LogCollector()\nlet fn =\n    FunctionBuilder.create collector (fun x -&gt; x * 2)\n    |&gt; fun b -&gt; b.WithLogging(\"double\")\n    |&gt; fun b -&gt; b.WithValidation((fun x -&gt; x &gt; 0), \"Must be positive\")\n    |&gt; fun b -&gt; b.Build()\n</code></pre>"},{"location":"fsharp/08-decorator-pattern/#8-transactionaloperation-","title":"8. TransactionalOperation - \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>/// \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u72b6\u614b\ntype TransactionState =\n    | NotStarted\n    | InProgress\n    | Committed\n    | RolledBack\n\n/// \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u4ed8\u304d\u64cd\u4f5c\ntype TransactionalOperation&lt;'T&gt; =\n    { Operations: ('T -&gt; 'T) list\n      State: TransactionState\n      OriginalValue: 'T option\n      CurrentValue: 'T option }\n\nmodule TransactionalOperation =\n    let create () =\n        { Operations = []; State = NotStarted; OriginalValue = None; CurrentValue = None }\n\n    let begin' (value: 'T) (tx: TransactionalOperation&lt;'T&gt;) =\n        { tx with State = InProgress; OriginalValue = Some value; CurrentValue = Some value }\n\n    let addOperation (op: 'T -&gt; 'T) (tx: TransactionalOperation&lt;'T&gt;) =\n        match tx.State with\n        | InProgress -&gt;\n            let newValue = tx.CurrentValue |&gt; Option.map op\n            { tx with Operations = tx.Operations @ [ op ]; CurrentValue = newValue }\n        | _ -&gt; tx\n\n    let commit (tx: TransactionalOperation&lt;'T&gt;) =\n        match tx.State with\n        | InProgress -&gt; { tx with State = Committed }\n        | _ -&gt; tx\n\n    let rollback (tx: TransactionalOperation&lt;'T&gt;) =\n        match tx.State with\n        | InProgress -&gt;\n            { tx with State = RolledBack; CurrentValue = tx.OriginalValue; Operations = [] }\n        | _ -&gt; tx\n</code></pre>"},{"location":"fsharp/08-decorator-pattern/#_10","title":"\u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u5358\u4e00\u8cac\u4efb\u306e\u539f\u5247: \u5404\u30c7\u30b3\u30ec\u30fc\u30bf\u306f\u4e00\u3064\u306e\u6a5f\u80fd\u306e\u307f\u3092\u8ffd\u52a0</li> <li>\u958b\u653e/\u9589\u9396\u306e\u539f\u5247: \u65e2\u5b58\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u305b\u305a\u306b\u6a5f\u80fd\u3092\u8ffd\u52a0</li> <li>\u67d4\u8edf\u306a\u7d44\u307f\u5408\u308f\u305b: \u5fc5\u8981\u306a\u6a5f\u80fd\u3060\u3051\u3092\u9078\u629e\u3057\u3066\u7d44\u307f\u5408\u308f\u305b\u53ef\u80fd</li> <li>\u5b9f\u884c\u6642\u306e\u6c7a\u5b9a: \u3069\u306e\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u9069\u7528\u3059\u308b\u304b\u5b9f\u884c\u6642\u306b\u6c7a\u5b9a\u53ef\u80fd</li> </ol>"},{"location":"fsharp/08-decorator-pattern/#f","title":"F# \u3067\u306e\u7279\u5fb4","text":""},{"location":"fsharp/08-decorator-pattern/#_11","title":"\u9ad8\u968e\u95a2\u6570\u306b\u3088\u308b\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>// \u95a2\u6570\u3092\u53d7\u3051\u53d6\u308a\u3001\u95a2\u6570\u3092\u8fd4\u3059\nlet withLogging name collector f =\n    fun a -&gt;\n        collector.Add(sprintf \"called with: %A\" a)\n        f a\n</code></pre>"},{"location":"fsharp/08-decorator-pattern/#_12","title":"\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3067\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u9069\u7528","text":"<pre><code>let decorated =\n    originalFn\n    |&gt; withCache ()\n    |&gt; withLogging \"fn\" collector\n    |&gt; withRetry 3\n</code></pre>"},{"location":"fsharp/08-decorator-pattern/#_13","title":"\u4e0d\u5909\u6027\u3092\u7dad\u6301\u3057\u305f\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>// \u5143\u306e\u30c7\u30fc\u30bf\u306f\u5909\u66f4\u3055\u308c\u306a\u3044\nlet original = JournaledShape.create circle\nlet decorated = original |&gt; JournaledShape.translate 2.0 3.0\n// original \u306f\u5909\u66f4\u3055\u308c\u3066\u3044\u306a\u3044\n</code></pre>"},{"location":"fsharp/08-decorator-pattern/#clojurescala","title":"Clojure/Scala \u3068\u306e\u6bd4\u8f03","text":"\u6982\u5ff5 Clojure Scala F# \u9ad8\u968e\u95a2\u6570 <code>(defn with-logging [f] ...)</code> <code>def withLogging[A,B](f: A =&gt; B)</code> <code>let withLogging f = fun a -&gt; ...</code> \u30af\u30ed\u30fc\u30b8\u30e3 <code>(let [cache (atom {})] ...)</code> <code>val cache = mutable.Map.empty</code> <code>let cache = Dictionary()</code> \u5408\u6210 <code>(comp decorator1 decorator2)</code> <code>compose(f, decorators)</code> <code>composeDecorators decorators f</code> \u72b6\u614b <code>atom</code> <code>var</code> or mutable <code>mutable</code> (explicit) \u30d3\u30eb\u30c0\u30fc \u306a\u3057\uff08\u95a2\u6570\u5408\u6210\uff09 class with fluent API F# class with methods"},{"location":"fsharp/08-decorator-pattern/#_14","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Decorator \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>JournaledShape: \u5f62\u72b6\u64cd\u4f5c\u306e\u5c65\u6b74\u3092\u8a18\u9332\u3059\u308b\u30c7\u30b3\u30ec\u30fc\u30bf</li> <li>\u95a2\u6570\u30c7\u30b3\u30ec\u30fc\u30bf: \u30ed\u30b0\u3001\u30ea\u30c8\u30e9\u30a4\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u306a\u3069\u306e\u6a2a\u65ad\u7684\u95a2\u5fc3\u4e8b</li> <li>AuditedList: \u64cd\u4f5c\u5c65\u6b74\u4ed8\u304d\u30b3\u30ec\u30af\u30b7\u30e7\u30f3</li> <li>HTTP\u30af\u30e9\u30a4\u30a2\u30f3\u30c8: \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u30d9\u30fc\u30b9\u306e\u30c7\u30b3\u30ec\u30fc\u30bf</li> <li>FunctionBuilder: \u30d3\u30eb\u30c0\u30fc\u30b9\u30bf\u30a4\u30eb\u306e\u30c7\u30b3\u30ec\u30fc\u30bf\u9069\u7528</li> <li>TransactionalOperation: \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u6a5f\u80fd</li> </ol> <p>Decorator \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u65e2\u5b58\u306e\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u305b\u305a\u306b\u6a5f\u80fd\u3092\u62e1\u5f35\u3059\u308b\u5f37\u529b\u306a\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002F# \u3067\u306f\u9ad8\u968e\u95a2\u6570\u3092\u4f7f\u3063\u3066\u95a2\u6570\u30ec\u30d9\u30eb\u3067\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u5b9f\u88c5\u3067\u304d\u3001\u578b\u5b89\u5168\u3067\u67d4\u8edf\u306a\u8a2d\u8a08\u304c\u53ef\u80fd\u3067\u3059\u3002</p>"},{"location":"fsharp/08-decorator-pattern/#_15","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/fsharp/part3/src/Library.fs</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/fsharp/part3/tests/Tests.fs</code></li> </ul>"},{"location":"fsharp/08-decorator-pattern/#_16","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Adapter \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u7570\u306a\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u9593\u306e\u5909\u63db\u3068\u30ec\u30ac\u30b7\u30fc\u30b7\u30b9\u30c6\u30e0\u3068\u306e\u7d71\u5408\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"fsharp/09-adapter-pattern/","title":"\u7b2c9\u7ae0: Adapter \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"fsharp/09-adapter-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Adapter \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u65e2\u5b58\u306e\u30af\u30e9\u30b9\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u671f\u5f85\u3059\u308b\u5225\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306b\u5909\u63db\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u3053\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u4e92\u63db\u6027\u306e\u306a\u3044\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u6301\u3064\u30af\u30e9\u30b9\u540c\u58eb\u3092\u9023\u643a\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u53ef\u5909\u5f37\u5ea6\u30e9\u30a4\u30c8\u306e\u30a2\u30c0\u30d7\u30bf\u30fc\u3068\u30c7\u30fc\u30bf\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u5909\u63db\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"fsharp/09-adapter-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Adapter \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Target: \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u671f\u5f85\u3059\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>Adaptee: \u65e2\u5b58\u306e\u30af\u30e9\u30b9\uff08\u9069\u5fdc\u3055\u308c\u308b\u5074\uff09</li> <li>Adapter: Target \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u5b9f\u88c5\u3057\u3001Adaptee \u3092\u4f7f\u7528</li> </ul> <p></p>"},{"location":"fsharp/09-adapter-pattern/#2-variablelight","title":"2. VariableLight \u306e\u4f8b","text":""},{"location":"fsharp/09-adapter-pattern/#switchable-target","title":"Switchable \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9 (Target)","text":"<pre><code>/// Switchable\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\uff08Target\uff09\ntype Switchable =\n    abstract member TurnOn: unit -&gt; unit\n    abstract member TurnOff: unit -&gt; unit\n</code></pre>"},{"location":"fsharp/09-adapter-pattern/#variablelight-adaptee","title":"VariableLight (Adaptee)","text":"<p>\u53ef\u5909\u5f37\u5ea6\u3092\u6301\u3064\u30e9\u30a4\u30c8\u306f\u3001\u5358\u7d14\u306a\u30aa\u30f3/\u30aa\u30d5\u3067\u306f\u306a\u304f\u3001\u5f37\u5ea6\u3092\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p> <pre><code>/// \u53ef\u5909\u5f37\u5ea6\u30e9\u30a4\u30c8\uff08Adaptee\uff09\ntype VariableLight() =\n    member this.SetIntensity(intensity: int) =\n        printfn \"VariableLight: intensity set to %d\" intensity\n        intensity\n</code></pre>"},{"location":"fsharp/09-adapter-pattern/#variablelightadapter-adapter","title":"VariableLightAdapter (Adapter)","text":"<pre><code>/// VariableLight\u3092Switchable\u306b\u9069\u5fdc\u3055\u305b\u308b\u30a2\u30c0\u30d7\u30bf\u30fc\ntype VariableLightAdapter(light: VariableLight, minIntensity: int, maxIntensity: int) =\n    interface Switchable with\n        member this.TurnOn() =\n            light.SetIntensity(maxIntensity) |&gt; ignore\n        member this.TurnOff() =\n            light.SetIntensity(minIntensity) |&gt; ignore\n</code></pre>"},{"location":"fsharp/09-adapter-pattern/#_2","title":"\u95a2\u6570\u578b\u30a2\u30c0\u30d7\u30bf\u30fc","text":"<p>F# \u3067\u306f\u3001\u95a2\u6570\u3092\u4f7f\u3063\u305f\u30a2\u30c0\u30d7\u30bf\u30fc\u3082\u81ea\u7136\u306b\u5b9f\u88c5\u3067\u304d\u307e\u3059\uff1a</p> <pre><code>module VariableLightAdapter =\n    /// VariableLight \u3092 Switchable \u98a8\u306e\u95a2\u6570\u306b\u9069\u5fdc\n    let adapt (minIntensity: int) (maxIntensity: int) (light: VariableLight) =\n        let turnOn () = light.SetIntensity(maxIntensity) |&gt; ignore\n        let turnOff () = light.SetIntensity(minIntensity) |&gt; ignore\n        (turnOn, turnOff)\n</code></pre>"},{"location":"fsharp/09-adapter-pattern/#_3","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// \u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u4f5c\u6210\uff08\u6700\u5c0f0\u3001\u6700\u5927100\uff09\nlet light = VariableLight()\nlet adapter = VariableLightAdapter(light, 0, 100) :&gt; Switchable\n\n// Switchable\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u64cd\u4f5c\nadapter.TurnOn()   // VariableLight: intensity set to 100\nadapter.TurnOff()  // VariableLight: intensity set to 0\n\n// \u95a2\u6570\u578b\u30a2\u30c0\u30d7\u30bf\u30fc\u306e\u5834\u5408\nlet (turnOn, turnOff) = VariableLightAdapter.adapt 0 100 light\nturnOn()  // VariableLight: intensity set to 100\nturnOff() // VariableLight: intensity set to 0\n</code></pre>"},{"location":"fsharp/09-adapter-pattern/#3","title":"3. \u30c7\u30fc\u30bf\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u30a2\u30c0\u30d7\u30bf\u30fc","text":""},{"location":"fsharp/09-adapter-pattern/#_4","title":"\u30e6\u30fc\u30b6\u30fc\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u5909\u63db","text":"<p>\u7570\u306a\u308b\u30b7\u30b9\u30c6\u30e0\u9593\u3067\u30c7\u30fc\u30bf\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304c\u7570\u306a\u308b\u5834\u5408\u3001\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u4f7f\u3063\u3066\u5909\u63db\u3057\u307e\u3059\u3002</p> <pre><code>/// \u65e7\u30e6\u30fc\u30b6\u30fc\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\ntype OldUserFormat =\n    { FirstName: string\n      LastName: string\n      EmailAddress: string\n      PhoneNumber: string }\n\n/// \u65b0\u30e6\u30fc\u30b6\u30fc\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\ntype NewUserFormat =\n    { Name: string\n      Email: string\n      Phone: string\n      Metadata: Map&lt;string, obj&gt; }\n\nmodule UserFormatAdapter =\n    /// \u65e7\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u65b0\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306b\u5909\u63db\n    let oldToNew (oldUser: OldUserFormat) : NewUserFormat =\n        { Name = sprintf \"%s %s\" oldUser.LastName oldUser.FirstName\n          Email = oldUser.EmailAddress\n          Phone = oldUser.PhoneNumber\n          Metadata = Map.ofList [ (\"migrated\", box true); (\"originalFormat\", box \"old\") ] }\n\n    /// \u65b0\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u65e7\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306b\u5909\u63db\n    let newToOld (newUser: NewUserFormat) : OldUserFormat =\n        let nameParts = newUser.Name.Split(' ')\n        let lastName = if nameParts.Length &gt; 0 then nameParts.[0] else \"\"\n        let firstName = if nameParts.Length &gt; 1 then nameParts.[1] else \"\"\n        { FirstName = firstName\n          LastName = lastName\n          EmailAddress = newUser.Email\n          PhoneNumber = newUser.Phone }\n</code></pre>"},{"location":"fsharp/09-adapter-pattern/#_5","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// \u65e7\u30d5\u30a9\u30fc\u30de\u30c3\u30c8 \u2192 \u65b0\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\nlet oldUser =\n    { FirstName = \"\u592a\u90ce\"\n      LastName = \"\u5c71\u7530\"\n      EmailAddress = \"taro@example.com\"\n      PhoneNumber = \"090-1234-5678\" }\n\nlet newUser = UserFormatAdapter.oldToNew oldUser\n// { Name = \"\u5c71\u7530 \u592a\u90ce\"\n//   Email = \"taro@example.com\"\n//   Phone = \"090-1234-5678\"\n//   Metadata = ... }\n\n// \u65b0\u30d5\u30a9\u30fc\u30de\u30c3\u30c8 \u2192 \u65e7\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\nlet converted = UserFormatAdapter.newToOld newUser\n// { FirstName = \"\u592a\u90ce\"\n//   LastName = \"\u5c71\u7530\"\n//   EmailAddress = \"taro@example.com\"\n//   PhoneNumber = \"090-1234-5678\" }\n</code></pre>"},{"location":"fsharp/09-adapter-pattern/#4","title":"4. \u6e29\u5ea6\u5909\u63db\u30a2\u30c0\u30d7\u30bf\u30fc","text":"<pre><code>/// \u6e29\u5ea6\u306e\u5358\u4f4d\n[&lt;RequireQualifiedAccess&gt;]\ntype TemperatureUnit =\n    | Celsius\n    | Fahrenheit\n    | Kelvin\n\ntype Temperature = { Value: float; Unit: TemperatureUnit }\n\nmodule TemperatureAdapter =\n    /// \u83ef\u6c0f\u3092\u6442\u6c0f\u306b\u5909\u63db\n    let fahrenheitToCelsius (temp: Temperature) : Temperature =\n        match temp.Unit with\n        | TemperatureUnit.Fahrenheit -&gt;\n            { Value = (temp.Value - 32.0) * 5.0 / 9.0\n              Unit = TemperatureUnit.Celsius }\n        | _ -&gt; temp\n\n    /// \u6442\u6c0f\u3092\u83ef\u6c0f\u306b\u5909\u63db\n    let celsiusToFahrenheit (temp: Temperature) : Temperature =\n        match temp.Unit with\n        | TemperatureUnit.Celsius -&gt;\n            { Value = temp.Value * 9.0 / 5.0 + 32.0\n              Unit = TemperatureUnit.Fahrenheit }\n        | _ -&gt; temp\n\n    /// \u30b1\u30eb\u30d3\u30f3\u3092\u6442\u6c0f\u306b\u5909\u63db\n    let kelvinToCelsius (temp: Temperature) : Temperature =\n        match temp.Unit with\n        | TemperatureUnit.Kelvin -&gt;\n            { Value = temp.Value - 273.15\n              Unit = TemperatureUnit.Celsius }\n        | _ -&gt; temp\n</code></pre>"},{"location":"fsharp/09-adapter-pattern/#5","title":"5. \u65e5\u4ed8\u30fb\u6642\u523b\u5909\u63db\u30a2\u30c0\u30d7\u30bf\u30fc","text":"<pre><code>module DateTimeAdapter =\n    /// Unix \u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u3092 DateTime \u306b\u5909\u63db\n    let unixToDateTime (timestamp: int64) : System.DateTime =\n        System.DateTimeOffset.FromUnixTimeSeconds(timestamp).DateTime\n\n    /// DateTime \u3092 Unix \u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u306b\u5909\u63db\n    let dateTimeToUnix (dt: System.DateTime) : int64 =\n        System.DateTimeOffset(dt).ToUnixTimeSeconds()\n\n    /// ISO8601 \u6587\u5b57\u5217\u3092 DateTime \u306b\u5909\u63db\n    let iso8601ToDateTime (iso: string) : System.DateTime option =\n        match System.DateTime.TryParse(iso) with\n        | true, dt -&gt; Some dt\n        | false, _ -&gt; None\n\n    /// DateTime \u3092 ISO8601 \u6587\u5b57\u5217\u306b\u5909\u63db\n    let dateTimeToIso8601 (dt: System.DateTime) : string =\n        dt.ToString(\"o\")\n</code></pre>"},{"location":"fsharp/09-adapter-pattern/#6","title":"6. \u901a\u8ca8\u5909\u63db\u30a2\u30c0\u30d7\u30bf\u30fc","text":"<pre><code>[&lt;RequireQualifiedAccess&gt;]\ntype Currency =\n    | USD of decimal\n    | JPY of decimal\n    | EUR of decimal\n    | GBP of decimal\n\nmodule CurrencyAdapter =\n    let private rates =\n        Map.ofList\n            [ (\"USD_JPY\", 150.0m)\n              (\"EUR_USD\", 1.08m)\n              (\"GBP_USD\", 1.27m) ]\n\n    /// USD \u3092 JPY \u306b\u5909\u63db\n    let usdToJpy (currency: Currency) : Currency =\n        match currency with\n        | Currency.USD amount -&gt;\n            Currency.JPY(amount * rates.[\"USD_JPY\"])\n        | _ -&gt; currency\n\n    /// JPY \u3092 USD \u306b\u5909\u63db\n    let jpyToUsd (currency: Currency) : Currency =\n        match currency with\n        | Currency.JPY amount -&gt;\n            Currency.USD(amount / rates.[\"USD_JPY\"])\n        | _ -&gt; currency\n</code></pre>"},{"location":"fsharp/09-adapter-pattern/#7","title":"7. \u30d5\u30a1\u30a4\u30eb\u30d1\u30b9\u5909\u63db\u30a2\u30c0\u30d7\u30bf\u30fc","text":"<pre><code>module FilePathAdapter =\n    /// Windows \u30d1\u30b9\u3092 Unix \u30d1\u30b9\u306b\u5909\u63db\n    let windowsToUnix (path: string) : string =\n        path.Replace(\"\\\\\", \"/\")\n            .Replace(\"C:\", \"/c\")\n            .Replace(\"D:\", \"/d\")\n\n    /// Unix \u30d1\u30b9\u3092 Windows \u30d1\u30b9\u306b\u5909\u63db\n    let unixToWindows (path: string) : string =\n        let result = path.Replace(\"/\", \"\\\\\")\n        if result.StartsWith(\"\\\\c\\\\\") then\n            \"C:\" + result.Substring(2)\n        elif result.StartsWith(\"\\\\d\\\\\") then\n            \"D:\" + result.Substring(2)\n        else\n            result\n</code></pre>"},{"location":"fsharp/09-adapter-pattern/#8","title":"8. \u30ed\u30b0\u30ec\u30d9\u30eb\u5909\u63db\u30a2\u30c0\u30d7\u30bf\u30fc","text":"<pre><code>/// \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306e\u30ed\u30b0\u30ec\u30d9\u30eb\n[&lt;RequireQualifiedAccess&gt;]\ntype AppLogLevel =\n    | Trace\n    | Debug\n    | Info\n    | Warning\n    | Error\n    | Fatal\n\n/// \u5916\u90e8\u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30ed\u30b0\u30ec\u30d9\u30eb\ntype ExternalLogLevel =\n    | Verbose = 0\n    | Debug = 1\n    | Information = 2\n    | Warning = 3\n    | Error = 4\n    | Critical = 5\n\nmodule LogLevelAdapter =\n    /// \u30a2\u30d7\u30ea\u306e\u30ed\u30b0\u30ec\u30d9\u30eb\u3092\u5916\u90e8\u5f62\u5f0f\u306b\u5909\u63db\n    let appToExternal level =\n        match level with\n        | AppLogLevel.Trace -&gt; ExternalLogLevel.Verbose\n        | AppLogLevel.Debug -&gt; ExternalLogLevel.Debug\n        | AppLogLevel.Info -&gt; ExternalLogLevel.Information\n        | AppLogLevel.Warning -&gt; ExternalLogLevel.Warning\n        | AppLogLevel.Error -&gt; ExternalLogLevel.Error\n        | AppLogLevel.Fatal -&gt; ExternalLogLevel.Critical\n\n    /// \u5916\u90e8\u5f62\u5f0f\u3092\u30a2\u30d7\u30ea\u306e\u30ed\u30b0\u30ec\u30d9\u30eb\u306b\u5909\u63db\n    let externalToApp level =\n        match level with\n        | ExternalLogLevel.Verbose -&gt; AppLogLevel.Trace\n        | ExternalLogLevel.Debug -&gt; AppLogLevel.Debug\n        | ExternalLogLevel.Information -&gt; AppLogLevel.Info\n        | ExternalLogLevel.Warning -&gt; AppLogLevel.Warning\n        | ExternalLogLevel.Error -&gt; AppLogLevel.Error\n        | ExternalLogLevel.Critical -&gt; AppLogLevel.Fatal\n        | _ -&gt; AppLogLevel.Info\n</code></pre>"},{"location":"fsharp/09-adapter-pattern/#9","title":"9. \u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u5909\u63db\u30a2\u30c0\u30d7\u30bf\u30fc","text":"<pre><code>module CollectionAdapter =\n    /// Array \u3092 List \u306b\u5909\u63db\n    let arrayToList (arr: 'T array) = Array.toList arr\n\n    /// List \u3092 Array \u306b\u5909\u63db\n    let listToArray (lst: 'T list) = List.toArray lst\n\n    /// Seq \u3092 List \u306b\u5909\u63db\n    let seqToList (seq: 'T seq) = Seq.toList seq\n\n    /// List \u3092 Seq \u306b\u5909\u63db\n    let listToSeq (lst: 'T list) = List.toSeq lst\n\n    /// Dictionary \u3092 Map \u306b\u5909\u63db\n    let dictToMap (dict: System.Collections.Generic.Dictionary&lt;'K, 'V&gt;) =\n        dict |&gt; Seq.map (fun kvp -&gt; (kvp.Key, kvp.Value)) |&gt; Map.ofSeq\n\n    /// Map \u3092 Dictionary \u306b\u5909\u63db\n    let mapToDict (map: Map&lt;'K, 'V&gt;) =\n        let dict = System.Collections.Generic.Dictionary&lt;'K, 'V&gt;()\n        map |&gt; Map.iter (fun k v -&gt; dict.[k] &lt;- v)\n        dict\n</code></pre>"},{"location":"fsharp/09-adapter-pattern/#10-result","title":"10. Result \u578b\u5909\u63db\u30a2\u30c0\u30d7\u30bf\u30fc","text":"<p>F# \u306e <code>Result</code> \u578b\u3068\u4ed6\u306e\u5f62\u5f0f\u9593\u306e\u5909\u63db\uff1a</p> <pre><code>module ResultAdapter =\n    /// Option \u3092 Result \u306b\u5909\u63db\n    let optionToResult (error: 'E) (opt: 'T option) : Result&lt;'T, 'E&gt; =\n        match opt with\n        | Some v -&gt; Ok v\n        | None -&gt; Error error\n\n    /// Result \u3092 Option \u306b\u5909\u63db\n    let resultToOption (result: Result&lt;'T, 'E&gt;) : 'T option =\n        match result with\n        | Ok v -&gt; Some v\n        | Error _ -&gt; None\n\n    /// \u4f8b\u5916\u30d9\u30fc\u30b9\u306e\u51e6\u7406\u3092 Result \u306b\u5909\u63db\n    let tryToResult (f: unit -&gt; 'T) : Result&lt;'T, exn&gt; =\n        try\n            Ok(f ())\n        with ex -&gt;\n            Error ex\n\n    /// Result \u3092\u4f8b\u5916\u30d9\u30fc\u30b9\u306b\u5909\u63db\uff08\u4f8b\u5916\u3092\u30b9\u30ed\u30fc\uff09\n    let resultToTry (result: Result&lt;'T, exn&gt;) : 'T =\n        match result with\n        | Ok v -&gt; v\n        | Error ex -&gt; raise ex\n</code></pre>"},{"location":"fsharp/09-adapter-pattern/#_6","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// Option \u2192 Result\nlet maybeValue: int option = Some 42\nlet result = ResultAdapter.optionToResult \"\u5024\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\" maybeValue\n// Ok 42\n\nlet nothing: int option = None\nlet errorResult = ResultAdapter.optionToResult \"\u5024\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\" nothing\n// Error \"\u5024\u304c\u898b\u3064\u304b\u308a\u307e\u305b\u3093\"\n\n// \u4f8b\u5916\u30d9\u30fc\u30b9 \u2192 Result\nlet safeDiv =\n    ResultAdapter.tryToResult (fun () -&gt; 10 / 2)\n// Ok 5\n\nlet failedDiv =\n    ResultAdapter.tryToResult (fun () -&gt; 10 / 0)\n// Error (System.DivideByZeroException)\n</code></pre>"},{"location":"fsharp/09-adapter-pattern/#11","title":"11. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u65e2\u5b58\u30b3\u30fc\u30c9\u306e\u518d\u5229\u7528: \u65e2\u5b58\u306e\u30af\u30e9\u30b9\u3092\u5909\u66f4\u305b\u305a\u306b\u65b0\u3057\u3044\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u4f7f\u7528</li> <li>\u5358\u4e00\u8cac\u4efb\u306e\u539f\u5247: \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u5909\u63db\u306e\u30ed\u30b8\u30c3\u30af\u3092\u5206\u96e2</li> <li>\u958b\u653e/\u9589\u9396\u306e\u539f\u5247: \u65b0\u3057\u3044\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u8ffd\u52a0\u3057\u3066\u3082\u65e2\u5b58\u30b3\u30fc\u30c9\u306f\u5909\u66f4\u4e0d\u8981</li> <li>\u30ec\u30ac\u30b7\u30fc\u30b7\u30b9\u30c6\u30e0\u3068\u306e\u7d71\u5408: \u53e4\u3044\u30b7\u30b9\u30c6\u30e0\u3068\u65b0\u3057\u3044\u30b7\u30b9\u30c6\u30e0\u3092\u9023\u643a</li> </ol>"},{"location":"fsharp/09-adapter-pattern/#12","title":"12. \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306e\u7279\u5fb4","text":"<p>F# \u3067\u306e Adapter \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u306b\u306f\u4ee5\u4e0b\u306e\u7279\u5fb4\u304c\u3042\u308a\u307e\u3059\uff1a</p> <ol> <li>\u95a2\u6570\u306b\u3088\u308b\u5909\u63db: \u5358\u7d14\u306a\u30c7\u30fc\u30bf\u5909\u63db\u306f\u95a2\u6570\u3067\u76f4\u63a5\u5b9f\u88c5</li> <li>\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u6f14\u7b97\u5b50: \u5909\u63db\u3092\u9023\u9396\u3055\u305b\u3084\u3059\u3044</li> <li>\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u306a\u30c7\u30fc\u30bf: \u5909\u63db\u5f8c\u3082\u5143\u306e\u30c7\u30fc\u30bf\u306f\u5909\u66f4\u3055\u308c\u306a\u3044</li> <li>\u578b\u5b89\u5168: \u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u306b\u578b\u306e\u4e0d\u6574\u5408\u3092\u691c\u51fa</li> <li>\u5408\u6210\u306e\u3057\u3084\u3059\u3055: \u8907\u6570\u306e\u30a2\u30c0\u30d7\u30bf\u30fc\u3092 <code>&gt;&gt;</code> \u3067\u5408\u6210\u53ef\u80fd</li> </ol> <pre><code>// \u30a2\u30c0\u30d7\u30bf\u30fc\u306e\u5408\u6210\u4f8b\nlet convertAndFormat =\n    TemperatureAdapter.celsiusToFahrenheit\n    &gt;&gt; fun temp -&gt; sprintf \"%.1f\u00b0F\" temp.Value\n\nlet result = { Value = 100.0; Unit = TemperatureUnit.Celsius } |&gt; convertAndFormat\n// \"212.0\u00b0F\"\n</code></pre>"},{"location":"fsharp/09-adapter-pattern/#_7","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Adapter \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>VariableLightAdapter: \u53ef\u5909\u5f37\u5ea6\u30e9\u30a4\u30c8\u3092\u5358\u7d14\u306a\u30aa\u30f3/\u30aa\u30d5\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306b\u9069\u5fdc</li> <li>\u30c7\u30fc\u30bf\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u30a2\u30c0\u30d7\u30bf\u30fc: \u7570\u306a\u308b\u30c7\u30fc\u30bf\u5f62\u5f0f\u9593\u306e\u5909\u63db</li> <li>\u578b\u5909\u63db\u30a2\u30c0\u30d7\u30bf\u30fc: \u6e29\u5ea6\u3001\u901a\u8ca8\u3001\u65e5\u6642\u306a\u3069\u306e\u5358\u4f4d\u5909\u63db</li> <li>\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u30a2\u30c0\u30d7\u30bf\u30fc: \u7570\u306a\u308b\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u578b\u9593\u306e\u5909\u63db</li> <li>Result \u30a2\u30c0\u30d7\u30bf\u30fc: \u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u65b9\u5f0f\u9593\u306e\u5909\u63db</li> </ol> <p>F# \u3067\u306f\u3001\u95a2\u6570\u3068\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u6f14\u7b97\u5b50\u3092\u6d3b\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u30b7\u30f3\u30d7\u30eb\u3067\u5408\u6210\u3057\u3084\u3059\u3044\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"fsharp/09-adapter-pattern/#_8","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/fsharp/part3/src/Library.fs</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/fsharp/part3/tests/Tests.fs</code></li> </ul>"},{"location":"fsharp/09-adapter-pattern/#_9","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Strategy \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u30ab\u30d7\u30bb\u30eb\u5316\u3057\u3001\u5b9f\u884c\u6642\u306b\u5207\u308a\u66ff\u3048\u53ef\u80fd\u306b\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"fsharp/10-strategy-pattern/","title":"\u7b2c10\u7ae0: Strategy \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"fsharp/10-strategy-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Strategy \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u30ab\u30d7\u30bb\u30eb\u5316\u3057\u3001\u305d\u308c\u3089\u3092\u4ea4\u63db\u53ef\u80fd\u306b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u3053\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u72ec\u7acb\u3057\u3066\u5909\u66f4\u3067\u304d\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u6599\u91d1\u8a08\u7b97\u3001\u914d\u9001\u6599\u91d1\u3001\u652f\u6255\u3044\u65b9\u6cd5\u306a\u3069\u306e\u4f8b\u3092\u901a\u3058\u3066\u3001\u5224\u5225\u5171\u7528\u4f53\u3068\u9ad8\u968e\u95a2\u6570\u306b\u3088\u308b Strategy \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"fsharp/10-strategy-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Strategy \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Strategy: \u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>ConcreteStrategy: \u5177\u4f53\u7684\u306a\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u5b9f\u88c5</li> <li>Context: Strategy \u3092\u4f7f\u7528\u3059\u308b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8</li> </ul> <p></p>"},{"location":"fsharp/10-strategy-pattern/#2","title":"2. \u6599\u91d1\u8a08\u7b97\u6226\u7565\uff08\u5224\u5225\u5171\u7528\u4f53\u7248\uff09","text":""},{"location":"fsharp/10-strategy-pattern/#_2","title":"\u4f1a\u54e1\u30ec\u30d9\u30eb\u3068\u6599\u91d1\u6226\u7565\u306e\u5b9a\u7fa9","text":"<pre><code>/// \u4f1a\u54e1\u30ec\u30d9\u30eb\n[&lt;RequireQualifiedAccess&gt;]\ntype MemberLevel =\n    | Gold\n    | Silver\n    | Bronze\n\n/// \u6599\u91d1\u8a08\u7b97\u6226\u7565\n[&lt;RequireQualifiedAccess&gt;]\ntype PricingStrategy =\n    | Regular\n    | Discount of rate: decimal\n    | Member of level: MemberLevel\n    | Bulk of threshold: decimal * bulkDiscount: decimal\n</code></pre>"},{"location":"fsharp/10-strategy-pattern/#_3","title":"\u6599\u91d1\u8a08\u7b97\u306e\u5b9f\u88c5","text":"<pre><code>module PricingStrategy =\n    /// \u6599\u91d1\u3092\u8a08\u7b97\u3059\u308b\n    let calculatePrice (strategy: PricingStrategy) (amount: decimal) : decimal =\n        match strategy with\n        | PricingStrategy.Regular -&gt; amount\n        | PricingStrategy.Discount rate -&gt; amount * (1.0m - rate)\n        | PricingStrategy.Member level -&gt;\n            let rate =\n                match level with\n                | MemberLevel.Gold -&gt; 0.20m\n                | MemberLevel.Silver -&gt; 0.15m\n                | MemberLevel.Bronze -&gt; 0.10m\n            amount * (1.0m - rate)\n        | PricingStrategy.Bulk(threshold, bulkDiscount) -&gt;\n            if amount &gt;= threshold then\n                amount * (1.0m - bulkDiscount)\n            else\n                amount\n</code></pre>"},{"location":"fsharp/10-strategy-pattern/#_4","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// \u901a\u5e38\u6599\u91d1\nPricingStrategy.calculatePrice PricingStrategy.Regular 1000.0m\n// =&gt; 1000.0m\n\n// 10%\u5272\u5f15\nPricingStrategy.calculatePrice (PricingStrategy.Discount 0.10m) 1000.0m\n// =&gt; 900.0m\n\n// \u30b4\u30fc\u30eb\u30c9\u4f1a\u54e1\u6599\u91d1\nPricingStrategy.calculatePrice (PricingStrategy.Member MemberLevel.Gold) 1000.0m\n// =&gt; 800.0m\n</code></pre>"},{"location":"fsharp/10-strategy-pattern/#3-context","title":"3. Context: \u30b7\u30e7\u30c3\u30d4\u30f3\u30b0\u30ab\u30fc\u30c8","text":"<pre><code>type CartItem =\n    { Name: string\n      Price: decimal\n      Quantity: int }\n\ntype ShoppingCart =\n    { Items: CartItem list\n      Strategy: PricingStrategy }\n\nmodule ShoppingCart =\n    /// \u30ab\u30fc\u30c8\u3092\u4f5c\u6210\n    let create (items: CartItem list) (strategy: PricingStrategy) : ShoppingCart =\n        { Items = items; Strategy = strategy }\n\n    /// \u30ab\u30fc\u30c8\u306e\u5c0f\u8a08\u3092\u8a08\u7b97\n    let subtotal (cart: ShoppingCart) : decimal =\n        cart.Items\n        |&gt; List.sumBy (fun item -&gt; item.Price * decimal item.Quantity)\n\n    /// \u30ab\u30fc\u30c8\u306e\u5408\u8a08\u91d1\u984d\u3092\u8a08\u7b97\n    let total (cart: ShoppingCart) : decimal =\n        let sub = subtotal cart\n        PricingStrategy.calculatePrice cart.Strategy sub\n\n    /// \u6226\u7565\u3092\u5909\u66f4\n    let changeStrategy (newStrategy: PricingStrategy) (cart: ShoppingCart) : ShoppingCart =\n        { cart with Strategy = newStrategy }\n</code></pre>"},{"location":"fsharp/10-strategy-pattern/#_5","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// \u30ab\u30fc\u30c8\u3092\u4f5c\u6210\nlet items =\n    [ { Name = \"Item A\"; Price = 500.0m; Quantity = 1 }\n      { Name = \"Item B\"; Price = 500.0m; Quantity = 1 } ]\n\nlet cart = ShoppingCart.create items PricingStrategy.Regular\nShoppingCart.total cart  // =&gt; 1000.0m\n\n// \u6226\u7565\u3092\u5909\u66f4\nlet discountedCart = ShoppingCart.changeStrategy (PricingStrategy.Member MemberLevel.Gold) cart\nShoppingCart.total discountedCart  // =&gt; 800.0m\n</code></pre>"},{"location":"fsharp/10-strategy-pattern/#4","title":"4. \u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1\uff08\u9ad8\u968e\u95a2\u6570\u7248\uff09","text":"<p>F# \u3067\u306f\u3001\u95a2\u6570\u3092\u7b2c\u4e00\u7d1a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u6271\u3048\u308b\u305f\u3081\u3001\u3088\u308a\u7c21\u6f54\u306b Strategy \u30d1\u30bf\u30fc\u30f3\u3092\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p> <pre><code>module FunctionalStrategy =\n    /// \u901a\u5e38\u6599\u91d1\u6226\u7565\n    let regularPricing: decimal -&gt; decimal = id\n\n    /// \u5272\u5f15\u6599\u91d1\u6226\u7565\u3092\u4f5c\u6210\n    let discountPricing (rate: decimal) : decimal -&gt; decimal =\n        fun amount -&gt; amount * (1.0m - rate)\n\n    /// \u4f1a\u54e1\u6599\u91d1\u6226\u7565\u3092\u4f5c\u6210\n    let memberPricing (level: MemberLevel) : decimal -&gt; decimal =\n        let rate =\n            match level with\n            | MemberLevel.Gold -&gt; 0.20m\n            | MemberLevel.Silver -&gt; 0.15m\n            | MemberLevel.Bronze -&gt; 0.10m\n        fun amount -&gt; amount * (1.0m - rate)\n\n    /// \u7a0e\u91d1\u6226\u7565\u3092\u4f5c\u6210\n    let taxStrategy (taxRate: decimal) : decimal -&gt; decimal =\n        fun amount -&gt; amount * (1.0m + taxRate)\n\n    /// \u8907\u6570\u306e\u6226\u7565\u3092\u5408\u6210\n    let composeStrategies (strategies: (decimal -&gt; decimal) list) : decimal -&gt; decimal =\n        fun amount -&gt; List.fold (fun acc strategy -&gt; strategy acc) amount strategies\n\n    /// \u6761\u4ef6\u4ed8\u304d\u6226\u7565\n    let conditionalStrategy\n        (predicate: decimal -&gt; bool)\n        (thenStrategy: decimal -&gt; decimal)\n        (elseStrategy: decimal -&gt; decimal)\n        : decimal -&gt; decimal =\n        fun amount -&gt;\n            if predicate amount then\n                thenStrategy amount\n            else\n                elseStrategy amount\n</code></pre>"},{"location":"fsharp/10-strategy-pattern/#_6","title":"\u6226\u7565\u306e\u5408\u6210","text":"<p>\u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1\u306e\u5927\u304d\u306a\u5229\u70b9\u306f\u3001\u6226\u7565\u3092\u7c21\u5358\u306b\u5408\u6210\u3067\u304d\u308b\u3053\u3068\u3067\u3059\u3002</p> <pre><code>// \u5272\u5f15\u5f8c\u306b\u7a0e\u91d1\u3092\u9069\u7528\nlet discount = FunctionalStrategy.discountPricing 0.10m\nlet tax = FunctionalStrategy.taxStrategy 0.08m\nlet combined = FunctionalStrategy.composeStrategies [ discount; tax ]\n\nFunctionalStrategy.applyPricing combined 1000.0m\n// =&gt; 972.0m  (1000 * 0.9 * 1.08)\n\n// \u6761\u4ef6\u4ed8\u304d\u6226\u7565: 5000\u5186\u4ee5\u4e0a\u306720%\u5272\u5f15\nlet highValueDiscount =\n    FunctionalStrategy.conditionalStrategy\n        (fun amount -&gt; amount &gt;= 5000.0m)\n        (FunctionalStrategy.discountPricing 0.20m)\n        FunctionalStrategy.regularPricing\n\nFunctionalStrategy.applyPricing highValueDiscount 6000.0m  // =&gt; 4800.0m\nFunctionalStrategy.applyPricing highValueDiscount 3000.0m  // =&gt; 3000.0m\n</code></pre>"},{"location":"fsharp/10-strategy-pattern/#5","title":"5. \u914d\u9001\u6599\u91d1\u6226\u7565","text":"<pre><code>[&lt;RequireQualifiedAccess&gt;]\ntype ShippingStrategy =\n    | Standard\n    | Express\n    | FreeShipping of minOrderAmount: decimal\n    | DistanceBased of ratePerKm: decimal\n\nmodule ShippingStrategy =\n    /// \u914d\u9001\u6599\u91d1\u3092\u8a08\u7b97\n    let calculateShipping (strategy: ShippingStrategy) (weight: decimal) (distance: decimal) (orderAmount: decimal) : decimal =\n        match strategy with\n        | ShippingStrategy.Standard -&gt;\n            weight * 10.0m + distance * 5.0m\n        | ShippingStrategy.Express -&gt;\n            weight * 20.0m + distance * 15.0m\n        | ShippingStrategy.FreeShipping minAmount -&gt;\n            if orderAmount &gt;= minAmount then 0.0m\n            else weight * 10.0m + distance * 5.0m\n        | ShippingStrategy.DistanceBased ratePerKm -&gt;\n            distance * ratePerKm\n</code></pre>"},{"location":"fsharp/10-strategy-pattern/#6","title":"6. \u652f\u6255\u3044\u65b9\u6cd5\u6226\u7565","text":"<pre><code>[&lt;RequireQualifiedAccess&gt;]\ntype PaymentStrategy =\n    | Cash\n    | CreditCard of fee: decimal\n    | Points of pointsPerYen: int\n    | Combined of primary: PaymentStrategy * secondary: PaymentStrategy * primaryAmount: decimal\n\ntype PaymentResult =\n    { AmountPaid: decimal\n      Fee: decimal\n      PointsUsed: int\n      PointsEarned: int }\n\nmodule PaymentStrategy =\n    /// \u652f\u6255\u3044\u3092\u51e6\u7406\n    let rec processPayment (strategy: PaymentStrategy) (amount: decimal) (availablePoints: int) : PaymentResult =\n        match strategy with\n        | PaymentStrategy.Cash -&gt;\n            { AmountPaid = amount\n              Fee = 0.0m\n              PointsUsed = 0\n              PointsEarned = int (amount / 100.0m) }\n        | PaymentStrategy.CreditCard fee -&gt;\n            let feeAmount = amount * fee\n            { AmountPaid = amount + feeAmount\n              Fee = feeAmount\n              PointsUsed = 0\n              PointsEarned = int (amount / 100.0m) * 2 }\n        | PaymentStrategy.Points pointsPerYen -&gt;\n            let pointsNeeded = int amount * pointsPerYen\n            let pointsToUse = min pointsNeeded availablePoints\n            let pointsCoverage = decimal pointsToUse / decimal pointsPerYen\n            let remaining = amount - pointsCoverage\n            { AmountPaid = remaining\n              Fee = 0.0m\n              PointsUsed = pointsToUse\n              PointsEarned = 0 }\n        | PaymentStrategy.Combined(primary, secondary, primaryAmount) -&gt;\n            // \u518d\u5e30\u7684\u306b\u51e6\u7406\n            let primaryResult = processPayment primary (min primaryAmount amount) availablePoints\n            let remainingAmount = amount - primaryAmount\n            if remainingAmount &gt; 0.0m then\n                let secondaryResult = processPayment secondary remainingAmount (availablePoints - primaryResult.PointsUsed)\n                { AmountPaid = primaryResult.AmountPaid + secondaryResult.AmountPaid\n                  Fee = primaryResult.Fee + secondaryResult.Fee\n                  PointsUsed = primaryResult.PointsUsed + secondaryResult.PointsUsed\n                  PointsEarned = primaryResult.PointsEarned + secondaryResult.PointsEarned }\n            else\n                primaryResult\n</code></pre>"},{"location":"fsharp/10-strategy-pattern/#7","title":"7. \u30bd\u30fc\u30c8\u6226\u7565","text":"<pre><code>type Person =\n    { Name: string\n      Age: int\n      Score: decimal }\n\nmodule SortingStrategy =\n    /// \u540d\u524d\u3067\u30bd\u30fc\u30c8\n    let sortByName (people: Person list) : Person list =\n        people |&gt; List.sortBy (fun p -&gt; p.Name)\n\n    /// \u5e74\u9f62\u3067\u30bd\u30fc\u30c8\n    let sortByAge (people: Person list) : Person list =\n        people |&gt; List.sortBy (fun p -&gt; p.Age)\n\n    /// \u30b9\u30b3\u30a2\u3067\u964d\u9806\u30bd\u30fc\u30c8\n    let sortByScoreDesc (people: Person list) : Person list =\n        people |&gt; List.sortByDescending (fun p -&gt; p.Score)\n\n    /// \u30ab\u30b9\u30bf\u30e0\u30bd\u30fc\u30c8\u6226\u7565\u3092\u9069\u7528\n    let sortWith (sortFn: Person list -&gt; Person list) (people: Person list) : Person list =\n        sortFn people\n</code></pre>"},{"location":"fsharp/10-strategy-pattern/#8","title":"8. \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u6226\u7565","text":"<pre><code>type ValidationResult =\n    | Valid\n    | Invalid of errors: string list\n\nmodule ValidationStrategy =\n    /// \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u7d50\u679c\u3092\u5408\u6210\n    let combine (result1: ValidationResult) (result2: ValidationResult) : ValidationResult =\n        match result1, result2 with\n        | Valid, Valid -&gt; Valid\n        | Valid, Invalid errors -&gt; Invalid errors\n        | Invalid errors, Valid -&gt; Invalid errors\n        | Invalid errors1, Invalid errors2 -&gt; Invalid(errors1 @ errors2)\n\n    /// \u5fc5\u9808\u30d5\u30a3\u30fc\u30eb\u30c9\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\n    let required (fieldName: string) (value: string) : ValidationResult =\n        if System.String.IsNullOrWhiteSpace(value) then\n            Invalid [ sprintf \"%s\u306f\u5fc5\u9808\u3067\u3059\" fieldName ]\n        else\n            Valid\n\n    /// \u6700\u5c0f\u9577\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\n    let minLength (fieldName: string) (min: int) (value: string) : ValidationResult =\n        if String.length value &lt; min then\n            Invalid [ sprintf \"%s\u306f%d\u6587\u5b57\u4ee5\u4e0a\u5fc5\u8981\u3067\u3059\" fieldName min ]\n        else\n            Valid\n\n    /// \u8907\u6570\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u9069\u7528\n    let validate (validators: ValidationResult list) : ValidationResult =\n        validators |&gt; List.fold combine Valid\n</code></pre>"},{"location":"fsharp/10-strategy-pattern/#_7","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>let result = ValidationStrategy.validate [\n    ValidationStrategy.required \"\u540d\u524d\" \"\u592a\u90ce\"\n    ValidationStrategy.minLength \"\u30d1\u30b9\u30ef\u30fc\u30c9\" 8 \"password123\"\n]\n// =&gt; Valid\n\nlet errorResult = ValidationStrategy.validate [\n    ValidationStrategy.required \"\u540d\u524d\" \"\"\n    ValidationStrategy.minLength \"\u30d1\u30b9\u30ef\u30fc\u30c9\" 8 \"pass\"\n]\n// =&gt; Invalid [\"\u540d\u524d\u306f\u5fc5\u9808\u3067\u3059\"; \"\u30d1\u30b9\u30ef\u30fc\u30c9\u306f8\u6587\u5b57\u4ee5\u4e0a\u5fc5\u8981\u3067\u3059\"]\n</code></pre>"},{"location":"fsharp/10-strategy-pattern/#9","title":"9. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u4ea4\u63db: \u5b9f\u884c\u6642\u306b\u6226\u7565\u3092\u5909\u66f4\u53ef\u80fd</li> <li>\u958b\u653e/\u9589\u9396\u306e\u539f\u5247: \u65b0\u3057\u3044\u6226\u7565\u3092\u8ffd\u52a0\u3057\u3066\u3082\u65e2\u5b58\u30b3\u30fc\u30c9\u306f\u5909\u66f4\u4e0d\u8981</li> <li>\u6761\u4ef6\u5206\u5c90\u306e\u6392\u9664: if/switch \u6587\u306e\u4ee3\u308f\u308a\u306b\u30dd\u30ea\u30e2\u30fc\u30d5\u30a3\u30ba\u30e0\u3092\u4f7f\u7528</li> <li>\u30c6\u30b9\u30c8\u306e\u5bb9\u6613\u3055: \u5404\u6226\u7565\u3092\u72ec\u7acb\u3057\u3066\u30c6\u30b9\u30c8\u53ef\u80fd</li> </ol>"},{"location":"fsharp/10-strategy-pattern/#10","title":"10. \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306e\u7279\u5fb4","text":"<p>F# \u3067\u306e Strategy \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u306b\u306f\u4ee5\u4e0b\u306e\u7279\u5fb4\u304c\u3042\u308a\u307e\u3059\uff1a</p> <ol> <li>\u5224\u5225\u5171\u7528\u4f53: \u578b\u5b89\u5168\u306a\u6226\u7565\u306e\u8868\u73fe</li> <li>\u9ad8\u968e\u95a2\u6570: \u95a2\u6570\u3092\u6226\u7565\u3068\u3057\u3066\u76f4\u63a5\u6e21\u3059\u3053\u3068\u304c\u3067\u304d\u308b</li> <li>\u95a2\u6570\u5408\u6210: <code>&gt;&gt;</code> \u6f14\u7b97\u5b50\u3067\u8907\u6570\u306e\u6226\u7565\u3092\u5408\u6210\u53ef\u80fd</li> <li>\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0: \u6226\u7565\u306e\u5206\u5c90\u3092\u660e\u78ba\u306b\u8868\u73fe</li> <li>\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb: \u6226\u7565\u306e\u5909\u66f4\u306f\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u8fd4\u3059</li> </ol> <pre><code>// \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u6f14\u7b97\u5b50\u3092\u4f7f\u3063\u305f\u6226\u7565\u306e\u9069\u7528\nlet finalPrice =\n    1000.0m\n    |&gt; FunctionalStrategy.discountPricing 0.10m\n    |&gt; FunctionalStrategy.taxStrategy 0.08m\n// =&gt; 972.0m\n</code></pre>"},{"location":"fsharp/10-strategy-pattern/#_8","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Strategy \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u5224\u5225\u5171\u7528\u4f53\u7248: \u578b\u5b89\u5168\u306a\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u306b\u3088\u308b\u5b9f\u88c5</li> <li>\u95a2\u6570\u578b\u7248: \u9ad8\u968e\u95a2\u6570\u306b\u3088\u308b\u7c21\u6f54\u306a\u5b9f\u88c5</li> <li>\u6226\u7565\u306e\u5408\u6210: \u8907\u6570\u306e\u6226\u7565\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u65b9\u6cd5</li> <li>Context: \u6226\u7565\u3092\u4f7f\u7528\u3059\u308b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u5b9f\u88c5</li> <li>\u5fdc\u7528\u4f8b: \u914d\u9001\u3001\u652f\u6255\u3044\u3001\u30bd\u30fc\u30c8\u3001\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3</li> </ol> <p>Strategy \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u67d4\u8edf\u306b\u4ea4\u63db\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u5834\u9762\u3067\u975e\u5e38\u306b\u6709\u52b9\u3067\u3059\u3002</p>"},{"location":"fsharp/10-strategy-pattern/#_9","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/fsharp/part4/src/Library.fs</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/fsharp/part4/tests/Tests.fs</code></li> </ul>"},{"location":"fsharp/10-strategy-pattern/#_10","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Command \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u30b3\u30de\u30f3\u30c9\u3092\u30c7\u30fc\u30bf\u3068\u3057\u3066\u8868\u73fe\u3057\u3001\u30d0\u30c3\u30c1\u51e6\u7406\u3084 Undo \u6a5f\u80fd\u3092\u5b9f\u88c5\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"fsharp/11-command-pattern/","title":"\u7b2c11\u7ae0: Command \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"fsharp/11-command-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Command \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u30ab\u30d7\u30bb\u30eb\u5316\u3057\u3001\u7570\u306a\u308b\u30ea\u30af\u30a8\u30b9\u30c8\u3067\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u30d1\u30e9\u30e1\u30fc\u30bf\u5316\u3057\u305f\u308a\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u30ad\u30e5\u30fc\u306b\u5165\u308c\u305f\u308a\u3001\u64cd\u4f5c\u306e\u5c65\u6b74\u3092\u8a18\u9332\u3057\u305f\u308a\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u30c6\u30ad\u30b9\u30c8\u7de8\u96c6\u3068\u30ad\u30e3\u30f3\u30d0\u30b9\u64cd\u4f5c\u306e\u4f8b\u3092\u901a\u3058\u3066\u3001\u30b3\u30de\u30f3\u30c9\u306e\u30c7\u30fc\u30bf\u5316\u3001Undo/Redo \u6a5f\u80fd\u3001\u30d0\u30c3\u30c1\u51e6\u7406\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"fsharp/11-command-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Command \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Command: \u30b3\u30de\u30f3\u30c9\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\uff08execute \u30e1\u30bd\u30c3\u30c9\uff09</li> <li>ConcreteCommand: \u5177\u4f53\u7684\u306a\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u88c5</li> <li>Receiver: \u30b3\u30de\u30f3\u30c9\u3092\u53d7\u3051\u53d6\u308a\u3001\u5b9f\u969b\u306e\u51e6\u7406\u3092\u884c\u3046\u30aa\u30d6\u30b8\u30a7\u30af\u30c8</li> <li>Invoker: \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8</li> </ul> <p></p>"},{"location":"fsharp/11-command-pattern/#2","title":"2. \u30c6\u30ad\u30b9\u30c8\u64cd\u4f5c\u30b3\u30de\u30f3\u30c9","text":""},{"location":"fsharp/11-command-pattern/#_2","title":"\u30b3\u30de\u30f3\u30c9\u306e\u5b9a\u7fa9","text":"<pre><code>/// \u30c6\u30ad\u30b9\u30c8\u30b3\u30de\u30f3\u30c9\n[&lt;RequireQualifiedAccess&gt;]\ntype TextCommand =\n    | Insert of position: int * text: string\n    | Delete of startPos: int * endPos: int * deletedText: string\n    | Replace of startPos: int * oldText: string * newText: string\n</code></pre>"},{"location":"fsharp/11-command-pattern/#_3","title":"\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\u3068\u53d6\u308a\u6d88\u3057","text":"<pre><code>module TextCommand =\n    /// \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\n    let execute (command: TextCommand) (document: string) : string =\n        match command with\n        | TextCommand.Insert(pos, text) -&gt;\n            let before = document.Substring(0, pos)\n            let after = document.Substring(pos)\n            before + text + after\n        | TextCommand.Delete(startPos, endPos, _) -&gt;\n            let before = document.Substring(0, startPos)\n            let after = document.Substring(endPos)\n            before + after\n        | TextCommand.Replace(startPos, oldText, newText) -&gt;\n            let before = document.Substring(0, startPos)\n            let after = document.Substring(startPos + oldText.Length)\n            before + newText + after\n\n    /// \u30b3\u30de\u30f3\u30c9\u3092\u53d6\u308a\u6d88\u3057\n    let undo (command: TextCommand) (document: string) : string =\n        match command with\n        | TextCommand.Insert(pos, text) -&gt;\n            let before = document.Substring(0, pos)\n            let after = document.Substring(pos + text.Length)\n            before + after\n        | TextCommand.Delete(startPos, _, deletedText) -&gt;\n            let before = document.Substring(0, startPos)\n            let after = document.Substring(startPos)\n            before + deletedText + after\n        | TextCommand.Replace(startPos, oldText, newText) -&gt;\n            let before = document.Substring(0, startPos)\n            let after = document.Substring(startPos + newText.Length)\n            before + oldText + after\n</code></pre>"},{"location":"fsharp/11-command-pattern/#_4","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// \u633f\u5165\u30b3\u30de\u30f3\u30c9\nlet insertCmd = TextCommand.Insert(5, \" World\")\nlet result = TextCommand.execute insertCmd \"Hello\"\n// =&gt; \"Hello World\"\n\n// Undo\nlet undone = TextCommand.undo insertCmd \"Hello World\"\n// =&gt; \"Hello\"\n</code></pre>"},{"location":"fsharp/11-command-pattern/#3","title":"3. \u30ad\u30e3\u30f3\u30d0\u30b9\u64cd\u4f5c\u30b3\u30de\u30f3\u30c9","text":""},{"location":"fsharp/11-command-pattern/#_5","title":"\u56f3\u5f62\u3068\u30ad\u30e3\u30f3\u30d0\u30b9\u306e\u5b9a\u7fa9","text":"<pre><code>type Shape =\n    { Id: string\n      ShapeType: string\n      X: int\n      Y: int\n      Width: int\n      Height: int }\n\ntype Canvas = { Shapes: Shape list }\n\n/// \u30ad\u30e3\u30f3\u30d0\u30b9\u30b3\u30de\u30f3\u30c9\n[&lt;RequireQualifiedAccess&gt;]\ntype CanvasCommand =\n    | AddShape of shape: Shape\n    | RemoveShape of shapeId: string * removedShape: Shape option\n    | MoveShape of shapeId: string * dx: int * dy: int\n    | ResizeShape of shapeId: string * oldWidth: int * oldHeight: int * newWidth: int * newHeight: int\n</code></pre>"},{"location":"fsharp/11-command-pattern/#_6","title":"\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\u3068\u53d6\u308a\u6d88\u3057","text":"<pre><code>module CanvasCommand =\n    /// \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\n    let execute (command: CanvasCommand) (canvas: Canvas) : Canvas =\n        match command with\n        | CanvasCommand.AddShape shape -&gt;\n            { canvas with Shapes = shape :: canvas.Shapes }\n        | CanvasCommand.MoveShape(shapeId, dx, dy) -&gt;\n            { canvas with\n                Shapes =\n                    canvas.Shapes\n                    |&gt; List.map (fun s -&gt;\n                        if s.Id = shapeId then\n                            { s with X = s.X + dx; Y = s.Y + dy }\n                        else\n                            s) }\n        // ... \u4ed6\u306e\u30b1\u30fc\u30b9\n\n    /// \u30b3\u30de\u30f3\u30c9\u3092\u53d6\u308a\u6d88\u3057\n    let undo (command: CanvasCommand) (canvas: Canvas) : Canvas =\n        match command with\n        | CanvasCommand.AddShape shape -&gt;\n            { canvas with Shapes = canvas.Shapes |&gt; List.filter (fun s -&gt; s.Id &lt;&gt; shape.Id) }\n        | CanvasCommand.MoveShape(shapeId, dx, dy) -&gt;\n            { canvas with\n                Shapes =\n                    canvas.Shapes\n                    |&gt; List.map (fun s -&gt;\n                        if s.Id = shapeId then\n                            { s with X = s.X - dx; Y = s.Y - dy }\n                        else\n                            s) }\n        // ... \u4ed6\u306e\u30b1\u30fc\u30b9\n</code></pre>"},{"location":"fsharp/11-command-pattern/#4","title":"4. \u6c4e\u7528\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u5668","text":""},{"location":"fsharp/11-command-pattern/#_7","title":"\u5b9f\u884c\u5668\u306e\u5b9a\u7fa9","text":"<pre><code>type CommandExecutor&lt;'TState, 'TCommand&gt; =\n    { State: 'TState\n      UndoStack: 'TCommand list\n      RedoStack: 'TCommand list\n      ExecuteFn: 'TCommand -&gt; 'TState -&gt; 'TState\n      UndoFn: 'TCommand -&gt; 'TState -&gt; 'TState }\n\nmodule CommandExecutor =\n    /// \u5b9f\u884c\u5668\u3092\u4f5c\u6210\n    let create\n        (initialState: 'TState)\n        (executeFn: 'TCommand -&gt; 'TState -&gt; 'TState)\n        (undoFn: 'TCommand -&gt; 'TState -&gt; 'TState)\n        : CommandExecutor&lt;'TState, 'TCommand&gt; =\n        { State = initialState\n          UndoStack = []\n          RedoStack = []\n          ExecuteFn = executeFn\n          UndoFn = undoFn }\n\n    /// \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\n    let execute (command: 'TCommand) (executor: CommandExecutor&lt;'TState, 'TCommand&gt;) =\n        let newState = executor.ExecuteFn command executor.State\n        { executor with\n            State = newState\n            UndoStack = command :: executor.UndoStack\n            RedoStack = [] }\n\n    /// \u30a2\u30f3\u30c9\u30a5\n    let undo (executor: CommandExecutor&lt;'TState, 'TCommand&gt;) =\n        match executor.UndoStack with\n        | [] -&gt; executor\n        | command :: rest -&gt;\n            let newState = executor.UndoFn command executor.State\n            { executor with\n                State = newState\n                UndoStack = rest\n                RedoStack = command :: executor.RedoStack }\n\n    /// \u30ea\u30c9\u30a5\n    let redo (executor: CommandExecutor&lt;'TState, 'TCommand&gt;) =\n        match executor.RedoStack with\n        | [] -&gt; executor\n        | command :: rest -&gt;\n            let newState = executor.ExecuteFn command executor.State\n            { executor with\n                State = newState\n                UndoStack = command :: executor.UndoStack\n                RedoStack = rest }\n</code></pre>"},{"location":"fsharp/11-command-pattern/#_8","title":"\u30c6\u30ad\u30b9\u30c8\u30a8\u30c7\u30a3\u30bf\u306e\u4f5c\u6210","text":"<pre><code>module TextEditor =\n    /// \u30c6\u30ad\u30b9\u30c8\u30a8\u30c7\u30a3\u30bf\u3092\u4f5c\u6210\n    let create (initialText: string) : CommandExecutor&lt;string, TextCommand&gt; =\n        CommandExecutor.create initialText TextCommand.execute TextCommand.undo\n</code></pre>"},{"location":"fsharp/11-command-pattern/#_9","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// \u30a8\u30c7\u30a3\u30bf\u3092\u4f5c\u6210\nlet editor = TextEditor.create \"Hello\"\n\n// \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\nlet editor = CommandExecutor.execute (TextCommand.Insert(5, \" World\")) editor\nCommandExecutor.getState editor  // =&gt; \"Hello World\"\n\n// Undo\nlet editor = CommandExecutor.undo editor\nCommandExecutor.getState editor  // =&gt; \"Hello\"\n\n// Redo\nlet editor = CommandExecutor.redo editor\nCommandExecutor.getState editor  // =&gt; \"Hello World\"\n</code></pre>"},{"location":"fsharp/11-command-pattern/#5","title":"5. \u30de\u30af\u30ed\u30b3\u30de\u30f3\u30c9","text":"<p>\u8907\u6570\u306e\u30b3\u30de\u30f3\u30c9\u3092\u4e00\u3064\u306e\u30b3\u30de\u30f3\u30c9\u3068\u3057\u3066\u6271\u3044\u307e\u3059\u3002</p> <pre><code>type MacroCommand&lt;'TCommand&gt; = { Commands: 'TCommand list }\n\nmodule MacroCommand =\n    /// \u30de\u30af\u30ed\u30b3\u30de\u30f3\u30c9\u3092\u4f5c\u6210\n    let create (commands: 'TCommand list) : MacroCommand&lt;'TCommand&gt; =\n        { Commands = commands }\n\n    /// \u30de\u30af\u30ed\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\n    let execute (executeFn: 'TCommand -&gt; 'TState -&gt; 'TState) (macro: MacroCommand&lt;'TCommand&gt;) (state: 'TState) : 'TState =\n        List.fold (fun s cmd -&gt; executeFn cmd s) state macro.Commands\n\n    /// \u30de\u30af\u30ed\u30b3\u30de\u30f3\u30c9\u3092\u53d6\u308a\u6d88\u3057\uff08\u9006\u9806\u3067\u5b9f\u884c\uff09\n    let undo (undoFn: 'TCommand -&gt; 'TState -&gt; 'TState) (macro: MacroCommand&lt;'TCommand&gt;) (state: 'TState) : 'TState =\n        List.fold (fun s cmd -&gt; undoFn cmd s) state (List.rev macro.Commands)\n</code></pre>"},{"location":"fsharp/11-command-pattern/#_10","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>let macro = MacroCommand.create [\n    TextCommand.Insert(5, \" World\")\n    TextCommand.Insert(11, \"!\")\n]\n\nlet result = MacroCommand.execute TextCommand.execute macro \"Hello\"\n// =&gt; \"Hello World!\"\n\nlet undone = MacroCommand.undo TextCommand.undo macro \"Hello World!\"\n// =&gt; \"Hello\"\n</code></pre>"},{"location":"fsharp/11-command-pattern/#6","title":"6. \u30d0\u30c3\u30c1\u5b9f\u884c","text":"<pre><code>module BatchExecutor =\n    /// \u8907\u6570\u306e\u30b3\u30de\u30f3\u30c9\u3092\u30d0\u30c3\u30c1\u5b9f\u884c\n    let executeBatch (commands: 'TCommand list) (executor: CommandExecutor&lt;'TState, 'TCommand&gt;) =\n        List.fold (fun exec cmd -&gt; CommandExecutor.execute cmd exec) executor commands\n\n    /// \u3059\u3079\u3066\u306e\u30b3\u30de\u30f3\u30c9\u3092\u53d6\u308a\u6d88\u3057\n    let undoAll (executor: CommandExecutor&lt;'TState, 'TCommand&gt;) =\n        let rec loop exec =\n            if CommandExecutor.canUndo exec then\n                loop (CommandExecutor.undo exec)\n            else\n                exec\n        loop executor\n</code></pre>"},{"location":"fsharp/11-command-pattern/#7","title":"7. \u30b3\u30de\u30f3\u30c9\u30ad\u30e5\u30fc","text":"<pre><code>type CommandQueue&lt;'TCommand&gt; = { Queue: 'TCommand list }\n\nmodule CommandQueue =\n    /// \u7a7a\u306e\u30ad\u30e5\u30fc\u3092\u4f5c\u6210\n    let empty: CommandQueue&lt;'TCommand&gt; = { Queue = [] }\n\n    /// \u30b3\u30de\u30f3\u30c9\u3092\u30ad\u30e5\u30fc\u306b\u8ffd\u52a0\n    let enqueue (command: 'TCommand) (queue: CommandQueue&lt;'TCommand&gt;) =\n        { Queue = queue.Queue @ [ command ] }\n\n    /// \u30b3\u30de\u30f3\u30c9\u3092\u30c7\u30ad\u30e5\u30fc\n    let dequeue (queue: CommandQueue&lt;'TCommand&gt;) =\n        match queue.Queue with\n        | [] -&gt; (None, queue)\n        | head :: tail -&gt; (Some head, { Queue = tail })\n\n    /// \u3059\u3079\u3066\u306e\u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\n    let executeAll (executor: CommandExecutor&lt;'TState, 'TCommand&gt;) (queue: CommandQueue&lt;'TCommand&gt;) =\n        List.fold (fun exec cmd -&gt; CommandExecutor.execute cmd exec) executor queue.Queue\n</code></pre>"},{"location":"fsharp/11-command-pattern/#8","title":"8. \u8a08\u7b97\u6a5f\u30b3\u30de\u30f3\u30c9","text":"<pre><code>[&lt;RequireQualifiedAccess&gt;]\ntype CalculatorCommand =\n    | Add of value: decimal\n    | Subtract of value: decimal\n    | Multiply of value: decimal\n    | Divide of value: decimal\n    | Clear\n\ntype CalculatorState =\n    { Value: decimal\n      History: (CalculatorCommand * decimal) list }\n\nmodule Calculator =\n    let create () : CalculatorState =\n        { Value = 0.0m; History = [] }\n\n    let execute (command: CalculatorCommand) (state: CalculatorState) =\n        let previousValue = state.Value\n        let newValue = CalculatorCommand.execute command state.Value\n        { Value = newValue\n          History = (command, previousValue) :: state.History }\n\n    let undo (state: CalculatorState) =\n        match state.History with\n        | [] -&gt; state\n        | (_, previousValue) :: rest -&gt;\n            { Value = previousValue; History = rest }\n</code></pre>"},{"location":"fsharp/11-command-pattern/#_11","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>let calc = Calculator.create ()\nlet calc = Calculator.execute (CalculatorCommand.Add 10.0m) calc\nlet calc = Calculator.execute (CalculatorCommand.Multiply 2.0m) calc\n// calc.Value = 20.0m\n\nlet calc = Calculator.undo calc\n// calc.Value = 10.0m\n</code></pre>"},{"location":"fsharp/11-command-pattern/#9","title":"9. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u64cd\u4f5c\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u5316: \u64cd\u4f5c\u3092\u30c7\u30fc\u30bf\u3068\u3057\u3066\u8868\u73fe\u3067\u304d\u308b</li> <li>Undo/Redo: \u64cd\u4f5c\u5c65\u6b74\u306e\u7ba1\u7406\u304c\u5bb9\u6613</li> <li>\u30d0\u30c3\u30c1\u51e6\u7406: \u8907\u6570\u306e\u64cd\u4f5c\u3092\u307e\u3068\u3081\u3066\u51e6\u7406</li> <li>\u9045\u5ef6\u5b9f\u884c: \u30b3\u30de\u30f3\u30c9\u3092\u30ad\u30e5\u30fc\u306b\u5165\u308c\u3066\u5f8c\u3067\u5b9f\u884c</li> <li>\u30ed\u30b0\u8a18\u9332: \u64cd\u4f5c\u306e\u5c65\u6b74\u3092\u30ed\u30b0\u3068\u3057\u3066\u4fdd\u5b58</li> </ol>"},{"location":"fsharp/11-command-pattern/#10","title":"10. \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306e\u7279\u5fb4","text":"<p>F# \u3067\u306e Command \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u306b\u306f\u4ee5\u4e0b\u306e\u7279\u5fb4\u304c\u3042\u308a\u307e\u3059\uff1a</p> <ol> <li>\u30b3\u30de\u30f3\u30c9\u306f\u30c7\u30fc\u30bf: \u5224\u5225\u5171\u7528\u4f53\u3067\u30b3\u30de\u30f3\u30c9\u3092\u8868\u73fe</li> <li>\u7d14\u7c8b\u95a2\u6570: execute/undo \u306f\u72b6\u614b\u3092\u53d7\u3051\u53d6\u308a\u65b0\u3057\u3044\u72b6\u614b\u3092\u8fd4\u3059\u7d14\u7c8b\u95a2\u6570</li> <li>\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb: \u72b6\u614b\u306f\u5909\u66f4\u3055\u308c\u305a\u3001\u65b0\u3057\u3044\u72b6\u614b\u304c\u8fd4\u3055\u308c\u308b</li> <li>\u578b\u5b89\u5168: \u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u306b\u30b3\u30de\u30f3\u30c9\u306e\u7a2e\u985e\u3068\u5f15\u6570\u3092\u691c\u8a3c</li> <li>\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0: \u30b3\u30de\u30f3\u30c9\u306e\u5206\u5c90\u51e6\u7406\u304c\u660e\u78ba</li> </ol> <pre><code>// \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u6f14\u7b97\u5b50\u3092\u4f7f\u3063\u305f\u9023\u7d9a\u64cd\u4f5c\nlet result =\n    \"Hello\"\n    |&gt; TextCommand.execute (TextCommand.Insert(5, \" World\"))\n    |&gt; TextCommand.execute (TextCommand.Insert(11, \"!\"))\n// =&gt; \"Hello World!\"\n</code></pre>"},{"location":"fsharp/11-command-pattern/#_12","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Command \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30b3\u30de\u30f3\u30c9\u306e\u30c7\u30fc\u30bf\u5316: \u64cd\u4f5c\u3092\u5224\u5225\u5171\u7528\u4f53\u3068\u3057\u3066\u8868\u73fe</li> <li>Undo/Redo: \u5c65\u6b74\u30b9\u30bf\u30c3\u30af\u3092\u4f7f\u3063\u305f\u53d6\u308a\u6d88\u3057\u30fb\u3084\u308a\u76f4\u3057</li> <li>\u6c4e\u7528\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u5668: \u4efb\u610f\u306e\u72b6\u614b\u3068\u30b3\u30de\u30f3\u30c9\u306b\u5bfe\u5fdc</li> <li>\u30de\u30af\u30ed\u30b3\u30de\u30f3\u30c9: \u8907\u6570\u306e\u30b3\u30de\u30f3\u30c9\u3092\u4e00\u3064\u306b\u307e\u3068\u3081\u308b</li> <li>\u30d0\u30c3\u30c1\u51e6\u7406: \u8907\u6570\u306e\u30b3\u30de\u30f3\u30c9\u3092\u4e00\u62ec\u5b9f\u884c</li> <li>\u30b3\u30de\u30f3\u30c9\u30ad\u30e5\u30fc: \u30b3\u30de\u30f3\u30c9\u306e\u9045\u5ef6\u5b9f\u884c</li> </ol> <p>Command \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u64cd\u4f5c\u306e\u5c65\u6b74\u7ba1\u7406\u3084\u53d6\u308a\u6d88\u3057\u6a5f\u80fd\u304c\u5fc5\u8981\u306a\u5834\u9762\u3067\u975e\u5e38\u306b\u6709\u52b9\u3067\u3059\u3002</p>"},{"location":"fsharp/11-command-pattern/#_13","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/fsharp/part4/src/Library.fs</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/fsharp/part4/tests/Tests.fs</code></li> </ul>"},{"location":"fsharp/11-command-pattern/#_14","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Visitor \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u69cb\u9020\u3092\u5909\u66f4\u305b\u305a\u306b\u65b0\u3057\u3044\u64cd\u4f5c\u3092\u8ffd\u52a0\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"fsharp/12-visitor-pattern/","title":"\u7b2c12\u7ae0: Visitor \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"fsharp/12-visitor-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Visitor \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30c7\u30fc\u30bf\u69cb\u9020\u3068\u64cd\u4f5c\u3092\u5206\u96e2\u3057\u3001\u65e2\u5b58\u306e\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u5909\u66f4\u3059\u308b\u3053\u3068\u306a\u304f\u65b0\u3057\u3044\u64cd\u4f5c\u3092\u8ffd\u52a0\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u56f3\u5f62\uff08Shape\uff09\u306b\u5bfe\u3059\u308b\u69d8\u3005\u306a\u64cd\u4f5c\uff08JSON \u5909\u63db\u3001XML \u5909\u63db\u3001\u9762\u7a4d\u8a08\u7b97\u3001\u5468\u56f2\u9577\u8a08\u7b97\uff09\u3092\u901a\u3058\u3066\u3001\u5224\u5225\u5171\u7528\u4f53\u3068\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u306b\u3088\u308b Visitor \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"fsharp/12-visitor-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Visitor \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Visitor: \u64cd\u4f5c\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>ConcreteVisitor: \u5177\u4f53\u7684\u306a\u64cd\u4f5c\u306e\u5b9f\u88c5</li> <li>Element: \u8a2a\u554f\u3055\u308c\u308b\u8981\u7d20\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>ConcreteElement: \u5177\u4f53\u7684\u306a\u8981\u7d20</li> </ul> <p></p>"},{"location":"fsharp/12-visitor-pattern/#2-element","title":"2. Element: \u56f3\u5f62\u306e\u5b9a\u7fa9","text":""},{"location":"fsharp/12-visitor-pattern/#_2","title":"\u5224\u5225\u5171\u7528\u4f53\u306b\u3088\u308b\u56f3\u5f62\u5b9a\u7fa9","text":"<pre><code>[&lt;RequireQualifiedAccess&gt;]\ntype Shape =\n    | Circle of center: (float * float) * radius: float\n    | Square of topLeft: (float * float) * side: float\n    | Rectangle of topLeft: (float * float) * width: float * height: float\n    | Triangle of p1: (float * float) * p2: (float * float) * p3: (float * float)\n</code></pre>"},{"location":"fsharp/12-visitor-pattern/#_3","title":"\u56f3\u5f62\u306e\u64cd\u4f5c","text":"<pre><code>module Shape =\n    /// \u56f3\u5f62\u3092\u79fb\u52d5\n    let translate (dx: float) (dy: float) (shape: Shape) : Shape =\n        match shape with\n        | Shape.Circle((x, y), r) -&gt; Shape.Circle((x + dx, y + dy), r)\n        | Shape.Square((x, y), s) -&gt; Shape.Square((x + dx, y + dy), s)\n        | Shape.Rectangle((x, y), w, h) -&gt; Shape.Rectangle((x + dx, y + dy), w, h)\n        | Shape.Triangle((x1, y1), (x2, y2), (x3, y3)) -&gt;\n            Shape.Triangle((x1 + dx, y1 + dy), (x2 + dx, y2 + dy), (x3 + dx, y3 + dy))\n\n    /// \u56f3\u5f62\u3092\u62e1\u5927/\u7e2e\u5c0f\n    let scale (factor: float) (shape: Shape) : Shape =\n        match shape with\n        | Shape.Circle(c, r) -&gt; Shape.Circle(c, r * factor)\n        | Shape.Square(tl, s) -&gt; Shape.Square(tl, s * factor)\n        | Shape.Rectangle(tl, w, h) -&gt; Shape.Rectangle(tl, w * factor, h * factor)\n        // ...\n</code></pre>"},{"location":"fsharp/12-visitor-pattern/#3-visitor-json","title":"3. Visitor: JSON \u5909\u63db","text":"<pre><code>module JsonVisitor =\n    /// \u56f3\u5f62\u3092 JSON \u6587\u5b57\u5217\u306b\u5909\u63db\n    let toJson (shape: Shape) : string =\n        match shape with\n        | Shape.Circle((x, y), r) -&gt;\n            sprintf \"\"\"{\"type\":\"circle\",\"center\":[%g,%g],\"radius\":%g}\"\"\" x y r\n        | Shape.Square((x, y), s) -&gt;\n            sprintf \"\"\"{\"type\":\"square\",\"topLeft\":[%g,%g],\"side\":%g}\"\"\" x y s\n        | Shape.Rectangle((x, y), w, h) -&gt;\n            sprintf \"\"\"{\"type\":\"rectangle\",\"topLeft\":[%g,%g],\"width\":%g,\"height\":%g}\"\"\" x y w h\n        | Shape.Triangle((x1, y1), (x2, y2), (x3, y3)) -&gt;\n            sprintf \"\"\"{\"type\":\"triangle\",\"points\":[[%g,%g],[%g,%g],[%g,%g]]}\"\"\" x1 y1 x2 y2 x3 y3\n\n    /// \u8907\u6570\u306e\u56f3\u5f62\u3092 JSON \u914d\u5217\u306b\u5909\u63db\n    let shapesToJson (shapes: Shape list) : string =\n        let jsonShapes = shapes |&gt; List.map toJson |&gt; String.concat \",\"\n        sprintf \"[%s]\" jsonShapes\n</code></pre>"},{"location":"fsharp/12-visitor-pattern/#_4","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>let circle = Shape.Circle((10.0, 20.0), 5.0)\nlet json = JsonVisitor.toJson circle\n// =&gt; {\"type\":\"circle\",\"center\":[10,20],\"radius\":5}\n</code></pre>"},{"location":"fsharp/12-visitor-pattern/#4-visitor-xml","title":"4. Visitor: XML \u5909\u63db","text":"<pre><code>module XmlVisitor =\n    /// \u56f3\u5f62\u3092 XML \u6587\u5b57\u5217\u306b\u5909\u63db\n    let toXml (shape: Shape) : string =\n        match shape with\n        | Shape.Circle((x, y), r) -&gt;\n            sprintf \"\"\"&lt;circle&gt;&lt;center x=\"%g\" y=\"%g\"/&gt;&lt;radius&gt;%g&lt;/radius&gt;&lt;/circle&gt;\"\"\" x y r\n        | Shape.Square((x, y), s) -&gt;\n            sprintf \"\"\"&lt;square&gt;&lt;topLeft x=\"%g\" y=\"%g\"/&gt;&lt;side&gt;%g&lt;/side&gt;&lt;/square&gt;\"\"\" x y s\n        | Shape.Rectangle((x, y), w, h) -&gt;\n            sprintf \"\"\"&lt;rectangle&gt;&lt;topLeft x=\"%g\" y=\"%g\"/&gt;&lt;width&gt;%g&lt;/width&gt;&lt;height&gt;%g&lt;/height&gt;&lt;/rectangle&gt;\"\"\" x y w h\n        | Shape.Triangle((x1, y1), (x2, y2), (x3, y3)) -&gt;\n            sprintf \"\"\"&lt;triangle&gt;&lt;p1 x=\"%g\" y=\"%g\"/&gt;&lt;p2 x=\"%g\" y=\"%g\"/&gt;&lt;p3 x=\"%g\" y=\"%g\"/&gt;&lt;/triangle&gt;\"\"\" x1 y1 x2 y2 x3 y3\n</code></pre>"},{"location":"fsharp/12-visitor-pattern/#5-visitor","title":"5. Visitor: \u9762\u7a4d\u8a08\u7b97","text":"<pre><code>module AreaVisitor =\n    /// \u56f3\u5f62\u306e\u9762\u7a4d\u3092\u8a08\u7b97\n    let calculateArea (shape: Shape) : float =\n        match shape with\n        | Shape.Circle(_, r) -&gt; System.Math.PI * r * r\n        | Shape.Square(_, s) -&gt; s * s\n        | Shape.Rectangle(_, w, h) -&gt; w * h\n        | Shape.Triangle((x1, y1), (x2, y2), (x3, y3)) -&gt;\n            // \u30d8\u30ed\u30f3\u306e\u516c\u5f0f\n            let a = sqrt((x2 - x1) ** 2.0 + (y2 - y1) ** 2.0)\n            let b = sqrt((x3 - x2) ** 2.0 + (y3 - y2) ** 2.0)\n            let c = sqrt((x1 - x3) ** 2.0 + (y1 - y3) ** 2.0)\n            let s = (a + b + c) / 2.0\n            sqrt(s * (s - a) * (s - b) * (s - c))\n\n    /// \u8907\u6570\u306e\u56f3\u5f62\u306e\u5408\u8a08\u9762\u7a4d\u3092\u8a08\u7b97\n    let totalArea (shapes: Shape list) : float =\n        shapes |&gt; List.sumBy calculateArea\n</code></pre>"},{"location":"fsharp/12-visitor-pattern/#6-visitor","title":"6. Visitor: \u5468\u56f2\u9577\u8a08\u7b97","text":"<pre><code>module PerimeterVisitor =\n    /// \u56f3\u5f62\u306e\u5468\u56f2\u9577\u3092\u8a08\u7b97\n    let calculatePerimeter (shape: Shape) : float =\n        match shape with\n        | Shape.Circle(_, r) -&gt; 2.0 * System.Math.PI * r\n        | Shape.Square(_, s) -&gt; 4.0 * s\n        | Shape.Rectangle(_, w, h) -&gt; 2.0 * (w + h)\n        | Shape.Triangle((x1, y1), (x2, y2), (x3, y3)) -&gt;\n            let a = sqrt((x2 - x1) ** 2.0 + (y2 - y1) ** 2.0)\n            let b = sqrt((x3 - x2) ** 2.0 + (y3 - y2) ** 2.0)\n            let c = sqrt((x1 - x3) ** 2.0 + (y1 - y3) ** 2.0)\n            a + b + c\n</code></pre>"},{"location":"fsharp/12-visitor-pattern/#7-visitor","title":"7. Visitor: \u30d0\u30a6\u30f3\u30c7\u30a3\u30f3\u30b0\u30dc\u30c3\u30af\u30b9\u8a08\u7b97","text":"<pre><code>type BoundingBox =\n    { MinX: float\n      MinY: float\n      MaxX: float\n      MaxY: float }\n\nmodule BoundingBoxVisitor =\n    /// \u56f3\u5f62\u306e\u30d0\u30a6\u30f3\u30c7\u30a3\u30f3\u30b0\u30dc\u30c3\u30af\u30b9\u3092\u8a08\u7b97\n    let calculateBoundingBox (shape: Shape) : BoundingBox =\n        match shape with\n        | Shape.Circle((x, y), r) -&gt;\n            { MinX = x - r; MinY = y - r; MaxX = x + r; MaxY = y + r }\n        | Shape.Square((x, y), s) -&gt;\n            { MinX = x; MinY = y; MaxX = x + s; MaxY = y + s }\n        | Shape.Rectangle((x, y), w, h) -&gt;\n            { MinX = x; MinY = y; MaxX = x + w; MaxY = y + h }\n        // ...\n</code></pre>"},{"location":"fsharp/12-visitor-pattern/#8-expression-visitor","title":"8. Expression Visitor\uff08\u5f0f\u306e\u8a55\u4fa1\uff09","text":"<pre><code>[&lt;RequireQualifiedAccess&gt;]\ntype Expr =\n    | Num of float\n    | Add of Expr * Expr\n    | Sub of Expr * Expr\n    | Mul of Expr * Expr\n    | Div of Expr * Expr\n    | Neg of Expr\n    | Var of string\n\nmodule ExprVisitor =\n    /// \u5f0f\u3092\u8a55\u4fa1\n    let rec evaluate (env: Map&lt;string, float&gt;) (expr: Expr) : float =\n        match expr with\n        | Expr.Num n -&gt; n\n        | Expr.Add(a, b) -&gt; evaluate env a + evaluate env b\n        | Expr.Sub(a, b) -&gt; evaluate env a - evaluate env b\n        | Expr.Mul(a, b) -&gt; evaluate env a * evaluate env b\n        | Expr.Div(a, b) -&gt; evaluate env a / evaluate env b\n        | Expr.Neg e -&gt; -(evaluate env e)\n        | Expr.Var name -&gt; Map.tryFind name env |&gt; Option.defaultValue 0.0\n\n    /// \u5f0f\u3092\u6587\u5b57\u5217\u306b\u5909\u63db\n    let rec toString (expr: Expr) : string =\n        match expr with\n        | Expr.Num n -&gt; sprintf \"%g\" n\n        | Expr.Add(a, b) -&gt; sprintf \"(%s + %s)\" (toString a) (toString b)\n        // ...\n\n    /// \u5f0f\u3092\u7c21\u7d04\n    let rec simplify (expr: Expr) : Expr =\n        match expr with\n        | Expr.Add(Expr.Num 0.0, e) -&gt; simplify e\n        | Expr.Mul(Expr.Num 1.0, e) -&gt; simplify e\n        | Expr.Mul(Expr.Num 0.0, _) -&gt; Expr.Num 0.0\n        // ...\n</code></pre>"},{"location":"fsharp/12-visitor-pattern/#_5","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>let expr = Expr.Add(Expr.Num 3.0, Expr.Mul(Expr.Num 2.0, Expr.Num 4.0))\nlet result = ExprVisitor.evaluate Map.empty expr\n// =&gt; 11.0\n\nlet expr = Expr.Add(Expr.Var \"x\", Expr.Num 5.0)\nlet env = Map.ofList [ (\"x\", 10.0) ]\nlet result = ExprVisitor.evaluate env expr\n// =&gt; 15.0\n</code></pre>"},{"location":"fsharp/12-visitor-pattern/#9-tree-visitor","title":"9. Tree Visitor","text":"<pre><code>type Tree&lt;'T&gt; =\n    | Leaf of 'T\n    | Node of Tree&lt;'T&gt; list\n\nmodule TreeVisitor =\n    /// \u30c4\u30ea\u30fc\u306e\u5168\u3066\u306e\u8449\u306e\u5024\u3092\u53ce\u96c6\n    let rec collectLeaves (tree: Tree&lt;'T&gt;) : 'T list =\n        match tree with\n        | Leaf v -&gt; [ v ]\n        | Node children -&gt; children |&gt; List.collect collectLeaves\n\n    /// \u30c4\u30ea\u30fc\u306e\u6df1\u3055\u3092\u8a08\u7b97\n    let rec depth (tree: Tree&lt;'T&gt;) : int =\n        match tree with\n        | Leaf _ -&gt; 1\n        | Node [] -&gt; 1\n        | Node children -&gt; 1 + (children |&gt; List.map depth |&gt; List.max)\n\n    /// \u30c4\u30ea\u30fc\u3092\u5909\u63db\n    let rec map (f: 'T -&gt; 'U) (tree: Tree&lt;'T&gt;) : Tree&lt;'U&gt; =\n        match tree with\n        | Leaf v -&gt; Leaf(f v)\n        | Node children -&gt; Node(children |&gt; List.map (map f))\n\n    /// \u30c4\u30ea\u30fc\u3092\u30d5\u30a9\u30fc\u30eb\u30c9\n    let rec fold (leafFn: 'T -&gt; 'Acc) (nodeFn: 'Acc list -&gt; 'Acc) (tree: Tree&lt;'T&gt;) : 'Acc =\n        match tree with\n        | Leaf v -&gt; leafFn v\n        | Node children -&gt; nodeFn (children |&gt; List.map (fold leafFn nodeFn))\n</code></pre>"},{"location":"fsharp/12-visitor-pattern/#_6","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>let tree = Node [ Leaf 1; Node [ Leaf 2; Leaf 3 ]; Leaf 4 ]\n\nlet leaves = TreeVisitor.collectLeaves tree\n// =&gt; [1; 2; 3; 4]\n\nlet d = TreeVisitor.depth tree\n// =&gt; 3\n\nlet sum = TreeVisitor.fold id List.sum tree\n// =&gt; 10\n</code></pre>"},{"location":"fsharp/12-visitor-pattern/#10","title":"10. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u64cd\u4f5c\u306e\u8ffd\u52a0\u304c\u5bb9\u6613: \u65b0\u3057\u3044 Visitor \u3092\u8ffd\u52a0\u3059\u308b\u3060\u3051\u3067\u65b0\u3057\u3044\u64cd\u4f5c\u3092\u5b9f\u88c5</li> <li>\u5358\u4e00\u8cac\u4efb\u306e\u539f\u5247: \u5404 Visitor \u306f\u4e00\u3064\u306e\u64cd\u4f5c\u306b\u5c02\u5ff5</li> <li>\u95a2\u9023\u3059\u308b\u64cd\u4f5c\u306e\u4e00\u5143\u5316: \u540c\u3058\u64cd\u4f5c\u306e\u30b3\u30fc\u30c9\u304c\u4e00\u7b87\u6240\u306b\u307e\u3068\u307e\u308b</li> <li>\u30c7\u30fc\u30bf\u69cb\u9020\u3068\u64cd\u4f5c\u306e\u5206\u96e2: \u8981\u7d20\u30af\u30e9\u30b9\u3092\u5909\u66f4\u305b\u305a\u306b\u64cd\u4f5c\u3092\u8ffd\u52a0</li> </ol>"},{"location":"fsharp/12-visitor-pattern/#11","title":"11. \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306e\u7279\u5fb4","text":"<p>F# \u3067\u306e Visitor \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u306b\u306f\u4ee5\u4e0b\u306e\u7279\u5fb4\u304c\u3042\u308a\u307e\u3059\uff1a</p> <ol> <li>\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0: \u5224\u5225\u5171\u7528\u4f53\u3068 match \u5f0f\u3067\u81ea\u7136\u306b\u5b9f\u88c5</li> <li>\u7db2\u7f85\u6027\u30c1\u30a7\u30c3\u30af: \u30b3\u30f3\u30d1\u30a4\u30e9\u304c\u5168\u3066\u306e\u30b1\u30fc\u30b9\u3092\u51e6\u7406\u3057\u3066\u3044\u308b\u304b\u691c\u8a3c</li> <li>\u518d\u5e30\u7684\u30c7\u30fc\u30bf\u69cb\u9020: \u5f0f\u3084\u30c4\u30ea\u30fc\u306a\u3069\u306e\u518d\u5e30\u7684\u69cb\u9020\u306b\u6700\u9069</li> <li>\u7d14\u7c8b\u95a2\u6570: \u526f\u4f5c\u7528\u306e\u306a\u3044\u5909\u63db\u51e6\u7406</li> <li>\u5408\u6210\u3057\u3084\u3059\u3055: \u8907\u6570\u306e Visitor \u3092\u7d44\u307f\u5408\u308f\u305b\u53ef\u80fd</li> </ol> <pre><code>// \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u6f14\u7b97\u5b50\u3092\u4f7f\u3063\u305f\u8907\u6570\u306e\u64cd\u4f5c\nlet shapes = [\n    Shape.Circle((0.0, 0.0), 5.0)\n    Shape.Square((10.0, 10.0), 10.0)\n]\n\nlet totalArea = AreaVisitor.totalArea shapes\nlet json = JsonVisitor.shapesToJson shapes\n</code></pre>"},{"location":"fsharp/12-visitor-pattern/#_7","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Visitor \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u56f3\u5f62\u306e\u5b9a\u7fa9: \u5224\u5225\u5171\u7528\u4f53\u306b\u3088\u308b Element \u306e\u8868\u73fe</li> <li>JSON/XML \u5909\u63db: \u30b7\u30ea\u30a2\u30e9\u30a4\u30bc\u30fc\u30b7\u30e7\u30f3 Visitor</li> <li>\u9762\u7a4d/\u5468\u56f2\u9577\u8a08\u7b97: \u6570\u5b66\u7684\u8a08\u7b97 Visitor</li> <li>\u30d0\u30a6\u30f3\u30c7\u30a3\u30f3\u30b0\u30dc\u30c3\u30af\u30b9: \u7a7a\u9593\u8a08\u7b97 Visitor</li> <li>\u5f0f\u306e\u8a55\u4fa1: \u518d\u5e30\u7684\u30c7\u30fc\u30bf\u69cb\u9020\u3078\u306e Visitor</li> <li>\u30c4\u30ea\u30fc\u64cd\u4f5c: \u6c4e\u7528\u7684\u306a\u30c4\u30ea\u30fc Visitor</li> </ol> <p>F# \u3067\u306f\u3001\u5224\u5225\u5171\u7528\u4f53\u3068\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u306b\u3088\u308a\u3001Visitor \u30d1\u30bf\u30fc\u30f3\u3092\u975e\u5e38\u306b\u81ea\u7136\u306b\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"fsharp/12-visitor-pattern/#_8","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/fsharp/part4/src/Library.fs</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/fsharp/part4/tests/Tests.fs</code></li> </ul>"},{"location":"fsharp/12-visitor-pattern/#_9","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u95a2\u9023\u3059\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30d5\u30a1\u30df\u30ea\u30fc\u3092\u751f\u6210\u3059\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u63d0\u4f9b\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"fsharp/13-abstract-factory-pattern/","title":"\u7b2c13\u7ae0: Abstract Factory \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"fsharp/13-abstract-factory-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u95a2\u9023\u3059\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30d5\u30a1\u30df\u30ea\u30fc\u3092\u3001\u305d\u306e\u5177\u4f53\u7684\u306a\u30af\u30e9\u30b9\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u306a\u304f\u751f\u6210\u3059\u308b\u305f\u3081\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u63d0\u4f9b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u56f3\u5f62\u30d5\u30a1\u30af\u30c8\u30ea\u3001UI \u30d5\u30a1\u30af\u30c8\u30ea\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30d5\u30a1\u30af\u30c8\u30ea\u306a\u3069\u306e\u4f8b\u3092\u901a\u3058\u3066\u3001\u5224\u5225\u5171\u7528\u4f53\u306b\u3088\u308b Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"fsharp/13-abstract-factory-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>AbstractFactory: \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u751f\u6210\u306e\u62bd\u8c61\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>ConcreteFactory: \u5177\u4f53\u7684\u306a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u751f\u6210\u3059\u308b\u30d5\u30a1\u30af\u30c8\u30ea</li> <li>AbstractProduct: \u751f\u6210\u3055\u308c\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u62bd\u8c61\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>ConcreteProduct: \u5177\u4f53\u7684\u306a\u88fd\u54c1</li> </ul> <p></p>"},{"location":"fsharp/13-abstract-factory-pattern/#2","title":"2. \u56f3\u5f62\u30d5\u30a1\u30af\u30c8\u30ea","text":""},{"location":"fsharp/13-abstract-factory-pattern/#_2","title":"\u30b9\u30bf\u30a4\u30eb\u60c5\u5831\u306e\u5b9a\u7fa9","text":"<pre><code>type ShapeStyle =\n    { OutlineColor: string option\n      OutlineWidth: float option\n      FillColor: string option\n      Opacity: float option }\n\nmodule ShapeStyle =\n    let empty =\n        { OutlineColor = None\n          OutlineWidth = None\n          FillColor = None\n          Opacity = None }\n\n    let withOutline color width style =\n        { style with OutlineColor = Some color; OutlineWidth = Some width }\n\n    let withFill color style =\n        { style with FillColor = Some color }\n</code></pre>"},{"location":"fsharp/13-abstract-factory-pattern/#_3","title":"\u30d5\u30a1\u30af\u30c8\u30ea\u306e\u5b9a\u7fa9","text":"<pre><code>[&lt;RequireQualifiedAccess&gt;]\ntype ShapeFactory =\n    | Standard\n    | Outlined of color: string * width: float\n    | Filled of color: string\n    | Custom of style: ShapeStyle\n</code></pre>"},{"location":"fsharp/13-abstract-factory-pattern/#_4","title":"\u30d5\u30a1\u30af\u30c8\u30ea\u306e\u5b9f\u88c5","text":"<pre><code>module ShapeFactory =\n    /// \u5186\u3092\u4f5c\u6210\n    let createCircle (factory: ShapeFactory) (center: float * float) (radius: float) : StyledShape =\n        let shape = Shape.Circle(center, radius)\n        let style =\n            match factory with\n            | ShapeFactory.Standard -&gt; ShapeStyle.empty\n            | ShapeFactory.Outlined(color, width) -&gt; ShapeStyle.empty |&gt; ShapeStyle.withOutline color width\n            | ShapeFactory.Filled color -&gt; ShapeStyle.empty |&gt; ShapeStyle.withFill color\n            | ShapeFactory.Custom style -&gt; style\n        { Shape = shape; Style = style }\n</code></pre>"},{"location":"fsharp/13-abstract-factory-pattern/#_5","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// \u6a19\u6e96\u30d5\u30a1\u30af\u30c8\u30ea\nlet standardFactory = ShapeFactory.Standard\nlet circle = ShapeFactory.createCircle standardFactory (10.0, 20.0) 5.0\n\n// \u8f2a\u90ed\u7dda\u4ed8\u304d\u30d5\u30a1\u30af\u30c8\u30ea\nlet outlinedFactory = ShapeFactory.Outlined(\"black\", 2.0)\nlet square = ShapeFactory.createSquare outlinedFactory (0.0, 0.0) 10.0\n\n// \u30ab\u30b9\u30bf\u30e0\u30b9\u30bf\u30a4\u30eb\u30d5\u30a1\u30af\u30c8\u30ea\nlet customStyle =\n    ShapeStyle.empty\n    |&gt; ShapeStyle.withOutline \"blue\" 3.0\n    |&gt; ShapeStyle.withFill \"yellow\"\nlet customFactory = ShapeFactory.Custom customStyle\nlet rect = ShapeFactory.createRectangle customFactory (0.0, 0.0) 20.0 10.0\n</code></pre>"},{"location":"fsharp/13-abstract-factory-pattern/#3-ui","title":"3. UI \u30d5\u30a1\u30af\u30c8\u30ea","text":""},{"location":"fsharp/13-abstract-factory-pattern/#_6","title":"\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u5b9a\u7fa9","text":"<pre><code>type Button =\n    { Label: string\n      Platform: string\n      Style: Map&lt;string, string&gt; }\n\ntype TextField =\n    { Placeholder: string\n      Platform: string\n      Style: Map&lt;string, string&gt; }\n\ntype Checkbox =\n    { Label: string\n      Checked: bool\n      Platform: string\n      Style: Map&lt;string, string&gt; }\n</code></pre>"},{"location":"fsharp/13-abstract-factory-pattern/#_7","title":"\u30d5\u30a1\u30af\u30c8\u30ea\u306e\u5b9a\u7fa9","text":"<pre><code>[&lt;RequireQualifiedAccess&gt;]\ntype UIFactory =\n    | Windows\n    | MacOS\n    | Linux\n    | Web\n</code></pre>"},{"location":"fsharp/13-abstract-factory-pattern/#_8","title":"\u30d5\u30a1\u30af\u30c8\u30ea\u306e\u5b9f\u88c5","text":"<pre><code>module UIFactory =\n    /// \u30dc\u30bf\u30f3\u3092\u4f5c\u6210\n    let createButton (factory: UIFactory) (label: string) : Button =\n        let platform = match factory with\n            | UIFactory.Windows -&gt; \"windows\"\n            | UIFactory.MacOS -&gt; \"macos\"\n            | UIFactory.Linux -&gt; \"linux\"\n            | UIFactory.Web -&gt; \"web\"\n        let style = match factory with\n            | UIFactory.Windows -&gt; Map.ofList [ (\"border\", \"1px solid gray\") ]\n            | UIFactory.MacOS -&gt; Map.ofList [ (\"borderRadius\", \"5px\") ]\n            // ...\n        { Label = label; Platform = platform; Style = style }\n</code></pre>"},{"location":"fsharp/13-abstract-factory-pattern/#_9","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// Windows UI \u3092\u4f5c\u6210\nlet windowsFactory = UIFactory.Windows\nlet okButton = UIFactory.createButton windowsFactory \"OK\"\nlet nameField = UIFactory.createTextField windowsFactory \"Enter name\"\n\n// MacOS UI \u3092\u4f5c\u6210\nlet macFactory = UIFactory.MacOS\nlet submitButton = UIFactory.createButton macFactory \"Submit\"\n</code></pre>"},{"location":"fsharp/13-abstract-factory-pattern/#4","title":"4. \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30d5\u30a1\u30af\u30c8\u30ea","text":"<pre><code>type DatabaseConnection =\n    { ConnectionString: string\n      DatabaseType: string\n      MaxPoolSize: int }\n\n[&lt;RequireQualifiedAccess&gt;]\ntype DatabaseFactory =\n    | SqlServer of connectionString: string\n    | PostgreSQL of connectionString: string\n    | MySQL of connectionString: string\n    | SQLite of filePath: string\n\nmodule DatabaseFactory =\n    let createConnection (factory: DatabaseFactory) : DatabaseConnection =\n        match factory with\n        | DatabaseFactory.SqlServer connStr -&gt;\n            { ConnectionString = connStr\n              DatabaseType = \"SqlServer\"\n              MaxPoolSize = 100 }\n        | DatabaseFactory.PostgreSQL connStr -&gt;\n            { ConnectionString = connStr\n              DatabaseType = \"PostgreSQL\"\n              MaxPoolSize = 50 }\n        | DatabaseFactory.SQLite path -&gt;\n            { ConnectionString = sprintf \"Data Source=%s\" path\n              DatabaseType = \"SQLite\"\n              MaxPoolSize = 1 }\n        // ...\n</code></pre>"},{"location":"fsharp/13-abstract-factory-pattern/#5","title":"5. \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30d5\u30a1\u30af\u30c8\u30ea","text":"<pre><code>[&lt;RequireQualifiedAccess&gt;]\ntype DocumentFactory =\n    | HTML\n    | Markdown\n    | PlainText\n\nmodule DocumentFactory =\n    /// \u6bb5\u843d\u3092\u4f5c\u6210\n    let createParagraph (factory: DocumentFactory) (text: string) : string =\n        match factory with\n        | DocumentFactory.HTML -&gt; sprintf \"&lt;p&gt;%s&lt;/p&gt;\" text\n        | DocumentFactory.Markdown -&gt; text + \"\\n\"\n        | DocumentFactory.PlainText -&gt; text + \"\\n\"\n\n    /// \u898b\u51fa\u3057\u3092\u4f5c\u6210\n    let createHeading (factory: DocumentFactory) (level: int) (text: string) : string =\n        match factory with\n        | DocumentFactory.HTML -&gt; sprintf \"&lt;h%d&gt;%s&lt;/h%d&gt;\" level text level\n        | DocumentFactory.Markdown -&gt; String.replicate level \"#\" + \" \" + text + \"\\n\"\n        | DocumentFactory.PlainText -&gt; text.ToUpper() + \"\\n\"\n</code></pre>"},{"location":"fsharp/13-abstract-factory-pattern/#6","title":"6. \u30c6\u30fc\u30de\u30d5\u30a1\u30af\u30c8\u30ea","text":"<pre><code>type ThemeColors =\n    { Primary: string\n      Secondary: string\n      Background: string\n      Text: string }\n\ntype Theme =\n    { Name: string\n      Colors: ThemeColors\n      Fonts: ThemeFonts }\n\n[&lt;RequireQualifiedAccess&gt;]\ntype ThemeFactory =\n    | Light\n    | Dark\n    | HighContrast\n\nmodule ThemeFactory =\n    let createTheme (factory: ThemeFactory) : Theme =\n        match factory with\n        | ThemeFactory.Light -&gt;\n            { Name = \"Light\"\n              Colors = { Primary = \"#007bff\"; Background = \"#ffffff\"; ... }\n              ... }\n        | ThemeFactory.Dark -&gt;\n            { Name = \"Dark\"\n              Colors = { Primary = \"#0d6efd\"; Background = \"#212529\"; ... }\n              ... }\n</code></pre>"},{"location":"fsharp/13-abstract-factory-pattern/#7","title":"7. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u88fd\u54c1\u30d5\u30a1\u30df\u30ea\u30fc\u306e\u4e00\u8cab\u6027: \u540c\u3058\u30d5\u30a1\u30af\u30c8\u30ea\u304b\u3089\u751f\u6210\u3055\u308c\u305f\u88fd\u54c1\u306f\u4e92\u3044\u306b\u4e92\u63db\u6027\u304c\u3042\u308b</li> <li>\u5177\u4f53\u30af\u30e9\u30b9\u306e\u5206\u96e2: \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306f\u5177\u4f53\u7684\u306a\u88fd\u54c1\u30af\u30e9\u30b9\u3092\u77e5\u308b\u5fc5\u8981\u304c\u306a\u3044</li> <li>\u30d5\u30a1\u30af\u30c8\u30ea\u306e\u4ea4\u63db: \u30d5\u30a1\u30af\u30c8\u30ea\u3092\u5207\u308a\u66ff\u3048\u308b\u3060\u3051\u3067\u7570\u306a\u308b\u88fd\u54c1\u30d5\u30a1\u30df\u30ea\u30fc\u3092\u4f7f\u7528\u53ef\u80fd</li> <li>\u65b0\u3057\u3044\u30d5\u30a1\u30df\u30ea\u30fc\u306e\u8ffd\u52a0: \u65b0\u3057\u3044\u30d5\u30a1\u30af\u30c8\u30ea\u3092\u8ffd\u52a0\u3059\u308b\u3060\u3051\u3067\u65b0\u3057\u3044\u88fd\u54c1\u30d5\u30a1\u30df\u30ea\u30fc\u306b\u5bfe\u5fdc</li> </ol>"},{"location":"fsharp/13-abstract-factory-pattern/#8","title":"8. \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306e\u7279\u5fb4","text":"<p>F# \u3067\u306e Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u306b\u306f\u4ee5\u4e0b\u306e\u7279\u5fb4\u304c\u3042\u308a\u307e\u3059\uff1a</p> <ol> <li>\u5224\u5225\u5171\u7528\u4f53: \u30d5\u30a1\u30af\u30c8\u30ea\u306e\u7a2e\u985e\u3092\u578b\u5b89\u5168\u306b\u8868\u73fe</li> <li>\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0: \u30d5\u30a1\u30af\u30c8\u30ea\u306e\u7a2e\u985e\u306b\u5fdc\u3058\u305f\u51e6\u7406\u3092\u660e\u78ba\u306b\u8a18\u8ff0</li> <li>\u30e2\u30b8\u30e5\u30fc\u30eb\u95a2\u6570: \u30d5\u30a1\u30af\u30c8\u30ea\u306e\u64cd\u4f5c\u3092\u95a2\u6570\u3068\u3057\u3066\u5b9a\u7fa9</li> <li>\u4e0d\u5909\u30c7\u30fc\u30bf: \u751f\u6210\u3055\u308c\u305f\u88fd\u54c1\u306f\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb</li> <li>\u5408\u6210\u3057\u3084\u3059\u3055: \u30d5\u30a1\u30af\u30c8\u30ea\u95a2\u6570\u3092\u5408\u6210\u53ef\u80fd</li> </ol> <pre><code>// \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u6f14\u7b97\u5b50\u3092\u4f7f\u3063\u305f\u5229\u7528\nlet createForm factory =\n    let button = UIFactory.createButton factory \"Submit\"\n    let field = UIFactory.createTextField factory \"Email\"\n    (button, field)\n\nlet (windowsBtn, windowsField) = createForm UIFactory.Windows\nlet (macBtn, macField) = createForm UIFactory.MacOS\n</code></pre>"},{"location":"fsharp/13-abstract-factory-pattern/#_10","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u56f3\u5f62\u30d5\u30a1\u30af\u30c8\u30ea: \u30b9\u30bf\u30a4\u30eb\u4ed8\u304d\u56f3\u5f62\u306e\u751f\u6210</li> <li>UI \u30d5\u30a1\u30af\u30c8\u30ea: \u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u5225 UI \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u751f\u6210</li> <li>\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30d5\u30a1\u30af\u30c8\u30ea: DB \u63a5\u7d9a\u3068\u30b3\u30de\u30f3\u30c9\u306e\u751f\u6210</li> <li>\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30d5\u30a1\u30af\u30c8\u30ea: \u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u5225\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u8981\u7d20\u306e\u751f\u6210</li> <li>\u30c6\u30fc\u30de\u30d5\u30a1\u30af\u30c8\u30ea: \u30c6\u30fc\u30de\u8a2d\u5b9a\u306e\u751f\u6210</li> </ol> <p>F# \u3067\u306f\u3001\u5224\u5225\u5171\u7528\u4f53\u3068\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u306b\u3088\u308a\u3001Abstract Factory \u30d1\u30bf\u30fc\u30f3\u3092\u578b\u5b89\u5168\u304b\u3064\u7c21\u6f54\u306b\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"fsharp/13-abstract-factory-pattern/#_11","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/fsharp/part4/src/Library.fs</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/fsharp/part4/tests/Tests.fs</code></li> </ul>"},{"location":"fsharp/13-abstract-factory-pattern/#_12","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Abstract Server \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3068\u30b5\u30fc\u30d0\u30fc\u9593\u306e\u62bd\u8c61\u5316\u5c64\u3092\u63d0\u4f9b\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"fsharp/14-abstract-server-pattern/","title":"\u7b2c14\u7ae0: Abstract Server \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"fsharp/14-abstract-server-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Abstract Server \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u4f9d\u5b58\u95a2\u4fc2\u9006\u8ee2\u306e\u539f\u5247\uff08DIP\uff09\u3092\u5b9f\u73fe\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u9ad8\u30ec\u30d9\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u4f4e\u30ec\u30d9\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u8a73\u7d30\u306b\u4f9d\u5b58\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u4e21\u8005\u304c\u62bd\u8c61\u306b\u4f9d\u5b58\u3059\u308b\u3053\u3068\u3067\u758e\u7d50\u5408\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u30b9\u30a4\u30c3\u30c1\u3068\u30c7\u30d0\u30a4\u30b9\u3001\u30ea\u30dd\u30b8\u30c8\u30ea\u3068\u30b5\u30fc\u30d3\u30b9\u306e\u4f8b\u3092\u901a\u3058\u3066\u3001\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306b\u3088\u308b Abstract Server \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"fsharp/14-abstract-server-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Abstract Server \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Client: \u30b5\u30fc\u30d3\u30b9\u3092\u5229\u7528\u3059\u308b\u30e2\u30b8\u30e5\u30fc\u30eb</li> <li>Abstract Server: \u30b5\u30fc\u30d3\u30b9\u306e\u62bd\u8c61\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>Concrete Server: \u5177\u4f53\u7684\u306a\u30b5\u30fc\u30d3\u30b9\u306e\u5b9f\u88c5</li> </ul> <p></p>"},{"location":"fsharp/14-abstract-server-pattern/#2-iswitchable","title":"2. ISwitchable \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9","text":""},{"location":"fsharp/14-abstract-server-pattern/#abstract-server","title":"Abstract Server \u306e\u5b9a\u7fa9","text":"<pre><code>/// \u30b9\u30a4\u30c3\u30c1\u53ef\u80fd\u306a\u30c7\u30d0\u30a4\u30b9\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\ntype ISwitchable =\n    abstract member TurnOn: unit -&gt; ISwitchable\n    abstract member TurnOff: unit -&gt; ISwitchable\n    abstract member IsOn: bool\n</code></pre> <p>F# \u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306f\u3001\u30e1\u30bd\u30c3\u30c9\u3092\u5b9a\u7fa9\u3059\u308b abstract member \u3068\u3057\u3066\u5ba3\u8a00\u3057\u307e\u3059\u3002\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u306a\u5b9f\u88c5\u306e\u305f\u3081\u3001<code>TurnOn</code> \u3068 <code>TurnOff</code> \u306f\u65b0\u3057\u3044 <code>ISwitchable</code> \u3092\u8fd4\u3057\u307e\u3059\u3002</p>"},{"location":"fsharp/14-abstract-server-pattern/#3-concrete-server-light","title":"3. Concrete Server: Light","text":""},{"location":"fsharp/14-abstract-server-pattern/#_2","title":"\u5b9f\u88c5","text":"<pre><code>type Light =\n    { State: bool }\n    interface ISwitchable with\n        member this.TurnOn() = { State = true } :&gt; ISwitchable\n        member this.TurnOff() = { State = false } :&gt; ISwitchable\n        member this.IsOn = this.State\n\nmodule Light =\n    let create () = { State = false }\n    let createOn () = { State = true }\n</code></pre> <p>Light \u306f\u30ec\u30b3\u30fc\u30c9\u578b\u3068\u3057\u3066\u5b9a\u7fa9\u3057\u3001<code>ISwitchable</code> \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002<code>:&gt;</code> \u6f14\u7b97\u5b50\u3067\u57fa\u5e95\u578b\u3078\u306e\u30a2\u30c3\u30d7\u30ad\u30e3\u30b9\u30c8\u3092\u884c\u3044\u307e\u3059\u3002</p>"},{"location":"fsharp/14-abstract-server-pattern/#4-concrete-server-fan","title":"4. Concrete Server: Fan","text":""},{"location":"fsharp/14-abstract-server-pattern/#_3","title":"\u5b9f\u88c5","text":"<pre><code>[&lt;RequireQualifiedAccess&gt;]\ntype FanSpeed = | Low | Medium | High\n\ntype Fan =\n    { State: bool\n      Speed: FanSpeed option }\n    interface ISwitchable with\n        member this.TurnOn() = { State = true; Speed = Some FanSpeed.Low } :&gt; ISwitchable\n        member this.TurnOff() = { State = false; Speed = None } :&gt; ISwitchable\n        member this.IsOn = this.State\n\nmodule Fan =\n    let create () = { State = false; Speed = None }\n    let setSpeed (speed: FanSpeed) (fan: Fan) =\n        if fan.State then { fan with Speed = Some speed }\n        else fan\n</code></pre> <p>Fan \u306f\u30b9\u30d4\u30fc\u30c9\u8a2d\u5b9a\u3092\u6301\u3064\u30c7\u30d0\u30a4\u30b9\u3067\u3059\u3002<code>[&lt;RequireQualifiedAccess&gt;]</code> \u5c5e\u6027\u306b\u3088\u308a\u3001<code>FanSpeed.Low</code> \u306e\u3088\u3046\u306b\u4fee\u98fe\u540d\u3067\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002</p>"},{"location":"fsharp/14-abstract-server-pattern/#5-concrete-server-motor","title":"5. Concrete Server: Motor","text":""},{"location":"fsharp/14-abstract-server-pattern/#_4","title":"\u5b9f\u88c5","text":"<pre><code>[&lt;RequireQualifiedAccess&gt;]\ntype MotorDirection = | Forward | Reverse\n\ntype Motor =\n    { State: bool\n      Direction: MotorDirection option }\n    interface ISwitchable with\n        member this.TurnOn() = { State = true; Direction = Some MotorDirection.Forward } :&gt; ISwitchable\n        member this.TurnOff() = { State = false; Direction = None } :&gt; ISwitchable\n        member this.IsOn = this.State\n\nmodule Motor =\n    let create () = { State = false; Direction = None }\n    let reverse (motor: Motor) =\n        if motor.State then\n            let newDir =\n                match motor.Direction with\n                | Some MotorDirection.Forward -&gt; Some MotorDirection.Reverse\n                | Some MotorDirection.Reverse -&gt; Some MotorDirection.Forward\n                | None -&gt; Some MotorDirection.Forward\n            { motor with Direction = newDir }\n        else motor\n</code></pre> <p>Motor \u306f\u65b9\u5411\u3092\u6301\u3064\u30c7\u30d0\u30a4\u30b9\u3067\u3001<code>reverse</code> \u95a2\u6570\u3067\u65b9\u5411\u3092\u53cd\u8ee2\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"fsharp/14-abstract-server-pattern/#6-client-switch","title":"6. Client: Switch","text":""},{"location":"fsharp/14-abstract-server-pattern/#_5","title":"\u5b9f\u88c5","text":"<pre><code>module Switch =\n    /// \u30b9\u30a4\u30c3\u30c1\u3092\u5165\u308c\u308b\n    let engage (device: ISwitchable) : ISwitchable =\n        device.TurnOn()\n\n    /// \u30b9\u30a4\u30c3\u30c1\u3092\u5207\u308b\n    let disengage (device: ISwitchable) : ISwitchable =\n        device.TurnOff()\n\n    /// \u30b9\u30a4\u30c3\u30c1\u3092\u5207\u308a\u66ff\u3048\u308b\n    let toggle (device: ISwitchable) : ISwitchable =\n        if device.IsOn then device.TurnOff()\n        else device.TurnOn()\n\n    /// \u30c7\u30d0\u30a4\u30b9\u306e\u72b6\u614b\u3092\u53d6\u5f97\n    let status (device: ISwitchable) : string =\n        if device.IsOn then \"ON\" else \"OFF\"\n</code></pre>"},{"location":"fsharp/14-abstract-server-pattern/#_6","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// \u540c\u3058Switch\u30b3\u30fc\u30c9\u3067\u7570\u306a\u308b\u30c7\u30d0\u30a4\u30b9\u3092\u64cd\u4f5c\nlet light = Light.create ()\nlet lightOn = Switch.engage (light :&gt; ISwitchable)\nprintfn \"%s\" (Switch.status lightOn) // \"ON\"\n\nlet fan = Fan.create ()\nlet fanOn = Switch.engage (fan :&gt; ISwitchable)\nprintfn \"%s\" (Switch.status fanOn) // \"ON\"\n\nlet motor = Motor.create ()\nlet motorOn = Switch.engage (motor :&gt; ISwitchable)\nprintfn \"%s\" (Switch.status motorOn) // \"ON\"\n</code></pre>"},{"location":"fsharp/14-abstract-server-pattern/#7","title":"7. \u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"fsharp/14-abstract-server-pattern/#8-repository","title":"8. Repository \u306e\u4f8b","text":""},{"location":"fsharp/14-abstract-server-pattern/#abstract-server-irepository","title":"Abstract Server: IRepository \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9","text":"<pre><code>/// \u30ea\u30dd\u30b8\u30c8\u30ea\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\ntype IRepository&lt;'TEntity, 'TId&gt; =\n    abstract member FindById: 'TId -&gt; 'TEntity option\n    abstract member FindAll: unit -&gt; 'TEntity list\n    abstract member Save: 'TEntity -&gt; 'TEntity\n    abstract member Delete: 'TId -&gt; bool\n</code></pre> <p>\u30b8\u30a7\u30cd\u30ea\u30c3\u30af\u578b\u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4f7f\u7528\u3057\u3066\u3001\u4efb\u610f\u306e\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u3068 ID \u578b\u306b\u5bfe\u5fdc\u3057\u307e\u3059\u3002</p>"},{"location":"fsharp/14-abstract-server-pattern/#concrete-server-memoryuserrepository","title":"Concrete Server: MemoryUserRepository","text":"<pre><code>type User =\n    { Id: string\n      Name: string\n      Email: string\n      CreatedAt: System.DateTime }\n\ntype MemoryUserRepository(initialData: Map&lt;string, User&gt;) =\n    let mutable data = initialData\n\n    interface IRepository&lt;User, string&gt; with\n        member _.FindById(id) = Map.tryFind id data\n        member _.FindAll() = data |&gt; Map.toList |&gt; List.map snd\n        member _.Save(user) =\n            let userId = if user.Id = \"\" then System.Guid.NewGuid().ToString() else user.Id\n            let userWithId = { user with Id = userId }\n            data &lt;- Map.add userId userWithId data\n            userWithId\n        member _.Delete(id) =\n            if Map.containsKey id data then\n                data &lt;- Map.remove id data\n                true\n            else false\n\nmodule MemoryUserRepository =\n    let create () = MemoryUserRepository(Map.empty)\n</code></pre>"},{"location":"fsharp/14-abstract-server-pattern/#client-userservice","title":"Client: UserService","text":"<pre><code>module UserService =\n    /// \u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\n    let createUser (repo: IRepository&lt;User, string&gt;) (name: string) (email: string) : User =\n        let user =\n            { Id = \"\"\n              Name = name\n              Email = email\n              CreatedAt = System.DateTime.UtcNow }\n        repo.Save(user)\n\n    /// \u30e6\u30fc\u30b6\u30fc\u3092\u53d6\u5f97\n    let getUser (repo: IRepository&lt;User, string&gt;) (id: string) : User option =\n        repo.FindById(id)\n\n    /// \u5168\u30e6\u30fc\u30b6\u30fc\u3092\u53d6\u5f97\n    let getAllUsers (repo: IRepository&lt;User, string&gt;) : User list =\n        repo.FindAll()\n\n    /// \u30e6\u30fc\u30b6\u30fc\u3092\u524a\u9664\n    let deleteUser (repo: IRepository&lt;User, string&gt;) (id: string) : bool =\n        repo.Delete(id)\n</code></pre>"},{"location":"fsharp/14-abstract-server-pattern/#9","title":"9. \u4f9d\u5b58\u95a2\u4fc2\u306e\u56f3","text":""},{"location":"fsharp/14-abstract-server-pattern/#10","title":"10. \u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1\uff1a\u30ec\u30b3\u30fc\u30c9\uff0b\u95a2\u6570","text":"<p>F# \u3067\u306f\u3001\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306e\u4ee3\u308f\u308a\u306b\u30ec\u30b3\u30fc\u30c9\u578b\u3067\u95a2\u6570\u3092\u675f\u306d\u308b\u65b9\u6cd5\u3082\u3042\u308a\u307e\u3059\uff1a</p> <pre><code>/// \u95a2\u6570\u578b\u30ea\u30dd\u30b8\u30c8\u30ea\ntype FunctionalRepository&lt;'TEntity, 'TId&gt; =\n    { FindById: 'TId -&gt; 'TEntity option\n      FindAll: unit -&gt; 'TEntity list\n      Save: 'TEntity -&gt; 'TEntity\n      Delete: 'TId -&gt; bool }\n\nmodule FunctionalRepository =\n    /// \u30a4\u30f3\u30e1\u30e2\u30ea\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u4f5c\u6210\n    let createInMemory&lt;'TId, 'TEntity when 'TId: comparison&gt;\n        (getId: 'TEntity -&gt; 'TId)\n        (setId: 'TId -&gt; 'TEntity -&gt; 'TEntity)\n        (generateId: unit -&gt; 'TId)\n        : FunctionalRepository&lt;'TEntity, 'TId&gt; =\n        let mutable data: Map&lt;'TId, 'TEntity&gt; = Map.empty\n        { FindById = fun id -&gt; Map.tryFind id data\n          FindAll = fun () -&gt; data |&gt; Map.toList |&gt; List.map snd\n          Save = fun entity -&gt;\n              let entityId = if getId entity = Unchecked.defaultof&lt;'TId&gt; then generateId() else getId entity\n              let entityWithId = setId entityId entity\n              data &lt;- Map.add entityId entityWithId data\n              entityWithId\n          Delete = fun id -&gt;\n              if Map.containsKey id data then\n                  data &lt;- Map.remove id data\n                  true\n              else false }\n</code></pre> <p>\u4f7f\u7528\u4f8b\uff1a</p> <pre><code>type SimpleUser = { Id: int; Name: string }\n\nlet mutable nextId = 1\nlet repo = FunctionalRepository.createInMemory&lt;int, SimpleUser&gt;\n               (fun u -&gt; u.Id)\n               (fun id u -&gt; { u with Id = id })\n               (fun () -&gt;\n                   let id = nextId\n                   nextId &lt;- nextId + 1\n                   id)\n\nlet user = repo.Save { Id = 0; Name = \"Alice\" }\nlet found = repo.FindById user.Id\n</code></pre>"},{"location":"fsharp/14-abstract-server-pattern/#11-logger-cache","title":"11. Logger \u3068 Cache \u306e\u4f8b","text":""},{"location":"fsharp/14-abstract-server-pattern/#ilogger","title":"ILogger \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9","text":"<pre><code>[&lt;RequireQualifiedAccess&gt;]\ntype LogLevel = | Debug | Info | Warning | Error\n\ntype ILogger =\n    abstract member Log: LogLevel -&gt; string -&gt; unit\n    abstract member Debug: string -&gt; unit\n    abstract member Info: string -&gt; unit\n    abstract member Warning: string -&gt; unit\n    abstract member Error: string -&gt; unit\n\ntype BufferedLogger() =\n    let mutable logs: (LogLevel * string * System.DateTime) list = []\n\n    interface ILogger with\n        member _.Log level message =\n            logs &lt;- (level, message, System.DateTime.UtcNow) :: logs\n        member this.Debug message = (this :&gt; ILogger).Log LogLevel.Debug message\n        member this.Info message = (this :&gt; ILogger).Log LogLevel.Info message\n        member this.Warning message = (this :&gt; ILogger).Log LogLevel.Warning message\n        member this.Error message = (this :&gt; ILogger).Log LogLevel.Error message\n\n    member _.GetLogs() = List.rev logs\n    member _.Clear() = logs &lt;- []\n\ntype NullLogger() =\n    interface ILogger with\n        member _.Log _ _ = ()\n        member _.Debug _ = ()\n        member _.Info _ = ()\n        member _.Warning _ = ()\n        member _.Error _ = ()\n</code></pre>"},{"location":"fsharp/14-abstract-server-pattern/#icache","title":"ICache \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9","text":"<pre><code>type ICache&lt;'TKey, 'TValue&gt; =\n    abstract member Get: 'TKey -&gt; 'TValue option\n    abstract member Set: 'TKey -&gt; 'TValue -&gt; unit\n    abstract member Remove: 'TKey -&gt; bool\n    abstract member Clear: unit -&gt; unit\n\ntype MemoryCache&lt;'TKey, 'TValue when 'TKey: comparison&gt;() =\n    let mutable data: Map&lt;'TKey, 'TValue&gt; = Map.empty\n\n    interface ICache&lt;'TKey, 'TValue&gt; with\n        member _.Get key = Map.tryFind key data\n        member _.Set key value = data &lt;- Map.add key value data\n        member _.Remove key =\n            if Map.containsKey key data then\n                data &lt;- Map.remove key data\n                true\n            else false\n        member _.Clear() = data &lt;- Map.empty\n</code></pre>"},{"location":"fsharp/14-abstract-server-pattern/#12","title":"12. \u4f9d\u5b58\u6027\u6ce8\u5165\u30b3\u30f3\u30c6\u30ca","text":"<p>\u30b7\u30f3\u30d7\u30eb\u306a DI \u30b3\u30f3\u30c6\u30ca\u306e\u5b9f\u88c5\u4f8b\uff1a</p> <pre><code>type ServiceContainer() =\n    let mutable services: Map&lt;string, obj&gt; = Map.empty\n\n    member _.Register&lt;'T&gt;(key: string) (service: 'T) =\n        services &lt;- Map.add key (box service) services\n\n    member _.Resolve&lt;'T&gt;(key: string) : 'T option =\n        Map.tryFind key services |&gt; Option.map (fun s -&gt; s :?&gt; 'T)\n\n    member _.RegisterSingleton&lt;'T&gt;(service: 'T) =\n        let key = typeof&lt;'T&gt;.FullName\n        services &lt;- Map.add key (box service) services\n\n    member _.ResolveSingleton&lt;'T&gt;() : 'T option =\n        let key = typeof&lt;'T&gt;.FullName\n        Map.tryFind key services |&gt; Option.map (fun s -&gt; s :?&gt; 'T)\n</code></pre>"},{"location":"fsharp/14-abstract-server-pattern/#13","title":"13. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u758e\u7d50\u5408: \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306f\u5177\u4f53\u7684\u306a\u5b9f\u88c5\u3092\u77e5\u3089\u306a\u3044</li> <li>\u30c6\u30b9\u30c8\u5bb9\u6613\u6027: \u30e2\u30c3\u30af/\u30b9\u30bf\u30d6\u3092\u7c21\u5358\u306b\u6ce8\u5165\u53ef\u80fd</li> <li>\u67d4\u8edf\u6027: \u5b9f\u88c5\u306e\u4ea4\u63db\u304c\u5bb9\u6613</li> <li>\u4f9d\u5b58\u95a2\u4fc2\u9006\u8ee2: \u9ad8\u30ec\u30d9\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u4f4e\u30ec\u30d9\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u4f9d\u5b58\u3057\u306a\u3044</li> </ol>"},{"location":"fsharp/14-abstract-server-pattern/#14-f","title":"14. F# \u3067\u306e\u7279\u5fb4","text":"<p>F# \u3067\u306e Abstract Server \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u306b\u306f\u4ee5\u4e0b\u306e\u7279\u5fb4\u304c\u3042\u308a\u307e\u3059\uff1a</p> <ol> <li>\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9: \u62bd\u8c61\u30b5\u30fc\u30d0\u30fc\u3092\u5b9a\u7fa9</li> <li>\u30ec\u30b3\u30fc\u30c9\u578b + \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u5b9f\u88c5: \u5177\u4f53\u7684\u306a\u30b5\u30fc\u30d0\u30fc\u3092\u5b9f\u88c5</li> <li>\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb: \u72b6\u614b\u5909\u66f4\u306f\u65b0\u3057\u3044\u30ec\u30b3\u30fc\u30c9\u3092\u8fd4\u3059</li> <li>\u4f9d\u5b58\u6027\u6ce8\u5165: \u95a2\u6570\u306e\u5f15\u6570\u3068\u3057\u3066\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u6e21\u3059</li> </ol> <p></p>"},{"location":"fsharp/14-abstract-server-pattern/#_7","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Abstract Server \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306b\u3088\u308b\u62bd\u8c61\u5316: ISwitchable\u3001IRepository\u3001ILogger\u3001ICache</li> <li>\u30ec\u30b3\u30fc\u30c9/\u30af\u30e9\u30b9\u306b\u3088\u308b\u5b9f\u88c5: Light\u3001Fan\u3001Motor\u3001MemoryUserRepository</li> <li>\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u72ec\u7acb\u6027: Switch\u3001UserService</li> <li>\u4f9d\u5b58\u95a2\u4fc2\u9006\u8ee2: \u9ad8\u30ec\u30d9\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u62bd\u8c61\u306b\u4f9d\u5b58</li> <li>\u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1: \u30ec\u30b3\u30fc\u30c9\u578b\u3067\u95a2\u6570\u3092\u675f\u306d\u308b\u65b9\u6cd5</li> </ol> <p>Abstract Server \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30e2\u30b8\u30e5\u30fc\u30eb\u9593\u306e\u758e\u7d50\u5408\u3092\u5b9f\u73fe\u3057\u3001\u30c6\u30b9\u30c8\u5bb9\u6613\u6027\u3068\u67d4\u8edf\u6027\u3092\u5411\u4e0a\u3055\u305b\u307e\u3059\u3002</p>"},{"location":"fsharp/14-abstract-server-pattern/#_8","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/fsharp/part4/src/Library.fs</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/fsharp/part4/tests/Tests.fs</code></li> </ul>"},{"location":"fsharp/14-abstract-server-pattern/#4","title":"\u7b2c4\u90e8\u306e\u307e\u3068\u3081","text":"<p>\u7b2c4\u90e8\u3067\u306f\u3001\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ul> <li>Strategy \u30d1\u30bf\u30fc\u30f3: \u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u30ab\u30d7\u30bb\u30eb\u5316\u3057\u3066\u4ea4\u63db\u53ef\u80fd\u306b\u3059\u308b</li> <li>Command \u30d1\u30bf\u30fc\u30f3: \u64cd\u4f5c\u3092\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u30ab\u30d7\u30bb\u30eb\u5316</li> <li>Visitor \u30d1\u30bf\u30fc\u30f3: \u30c7\u30fc\u30bf\u69cb\u9020\u3068\u51e6\u7406\u3092\u5206\u96e2</li> <li>Abstract Factory \u30d1\u30bf\u30fc\u30f3: \u95a2\u9023\u3059\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30d5\u30a1\u30df\u30ea\u30fc\u3092\u4e00\u8cab\u3057\u3066\u751f\u6210</li> <li>Abstract Server \u30d1\u30bf\u30fc\u30f3: \u4f9d\u5b58\u95a2\u4fc2\u9006\u8ee2\u306b\u3088\u308b\u758e\u7d50\u5408\u306e\u5b9f\u73fe</li> </ul> <p>\u3053\u308c\u3089\u306e\u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u72ec\u7acb\u6027\u3092\u9ad8\u3081\u3001\u30c6\u30b9\u30c8\u5bb9\u6613\u6027\u3068\u4fdd\u5b88\u6027\u3092\u5411\u4e0a\u3055\u305b\u307e\u3059\u3002</p>"},{"location":"fsharp/15-gossiping-bus-drivers/","title":"\u7b2c15\u7ae0: \u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b","text":""},{"location":"fsharp/15-gossiping-bus-drivers/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u300c\u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b\u300d\u3068\u3044\u3046\u554f\u984c\u3092\u901a\u3058\u3066\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u5b9f\u8df5\u7684\u306a\u30a2\u30d7\u30ed\u30fc\u30c1\u3092\u5b66\u3073\u307e\u3059\u3002\u3053\u306e\u554f\u984c\u306f\u3001\u30d0\u30b9\u904b\u8ee2\u624b\u304c\u505c\u7559\u6240\u3067\u51fa\u4f1a\u3063\u305f\u3068\u304d\u306b\u5642\u3092\u5171\u6709\u3059\u308b\u3068\u3044\u3046\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3067\u3059\u3002</p> <p>\u3053\u306e\u554f\u984c\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u306e\u6982\u5ff5\u3092\u5b66\u3073\u307e\u3059\uff1a</p> <ul> <li>\u5faa\u74b0\u30b7\u30fc\u30b1\u30f3\u30b9\u306b\u3088\u308b\u30eb\u30fc\u30c8\u8868\u73fe</li> <li>\u96c6\u5408\u6f14\u7b97\u306b\u3088\u308b\u72b6\u614b\u306e\u4f1d\u64ad</li> <li>\u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u8a2d\u8a08</li> </ul>"},{"location":"fsharp/15-gossiping-bus-drivers/#1","title":"1. \u554f\u984c\u306e\u8aac\u660e","text":"<p>\u8907\u6570\u306e\u30d0\u30b9\u904b\u8ee2\u624b\u304c\u305d\u308c\u305e\u308c\u306e\u30eb\u30fc\u30c8\u3092\u5de1\u56de\u3057\u3066\u3044\u307e\u3059\u3002\u5404\u904b\u8ee2\u624b\u306f\u6700\u521d\u306b1\u3064\u4ee5\u4e0a\u306e\u5642\u3092\u77e5\u3063\u3066\u3044\u307e\u3059\u3002\u540c\u3058\u505c\u7559\u6240\u306b\u8907\u6570\u306e\u904b\u8ee2\u624b\u304c\u3044\u308b\u3068\u3001\u5f7c\u3089\u306f\u77e5\u3063\u3066\u3044\u308b\u5642\u3092\u3059\u3079\u3066\u5171\u6709\u3057\u307e\u3059\u3002</p> <p>\u30b4\u30fc\u30eb: \u5168\u3066\u306e\u904b\u8ee2\u624b\u304c\u5168\u3066\u306e\u5642\u3092\u77e5\u308b\u307e\u3067\u306b\u4f55\u5206\u304b\u304b\u308b\u304b\uff1f</p> <p></p>"},{"location":"fsharp/15-gossiping-bus-drivers/#2","title":"2. \u30c7\u30fc\u30bf\u30e2\u30c7\u30eb","text":""},{"location":"fsharp/15-gossiping-bus-drivers/#_2","title":"\u30c9\u30e9\u30a4\u30d0\u30fc\u306e\u8868\u73fe","text":"<pre><code>/// \u5642\u306e\u578b\uff08\u6587\u5b57\u5217\u306e\u96c6\u5408\uff09\ntype Rumors = Set&lt;string&gt;\n\n/// \u30c9\u30e9\u30a4\u30d0\u30fc\u306e\u578b\ntype Driver =\n    { Name: string\n      Route: int list       // \u5143\u306e\u30eb\u30fc\u30c8\uff08\u5faa\u74b0\u7528\uff09\n      Position: int         // \u73fe\u5728\u306e\u30eb\u30fc\u30c8\u4f4d\u7f6e\n      Rumors: Rumors }\n</code></pre> <p>\u30dd\u30a4\u30f3\u30c8: - <code>Route</code> \u306f\u30ea\u30b9\u30c8\u3067\u4fdd\u6301\u3057\u3001<code>Position</code> \u3067\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u7ba1\u7406 - \u5642\u306f <code>Set&lt;string&gt;</code> \u3068\u3057\u3066\u7ba1\u7406\uff08\u96c6\u5408\u6f14\u7b97\u304c\u5bb9\u6613\uff09</p>"},{"location":"fsharp/15-gossiping-bus-drivers/#_3","title":"\u30c9\u30e9\u30a4\u30d0\u30fc\u64cd\u4f5c","text":"<pre><code>module Driver =\n    /// \u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u4f5c\u6210\n    let create (name: string) (route: int list) (rumors: Rumors) : Driver =\n        { Name = name\n          Route = route\n          Position = 0\n          Rumors = rumors }\n\n    /// \u73fe\u5728\u306e\u505c\u7559\u6240\u3092\u53d6\u5f97\n    let currentStop (driver: Driver) : int =\n        driver.Route.[driver.Position % driver.Route.Length]\n\n    /// \u6b21\u306e\u505c\u7559\u6240\u306b\u79fb\u52d5\n    let move (driver: Driver) : Driver =\n        { driver with Position = driver.Position + 1 }\n\n    /// \u5642\u3092\u8ffd\u52a0\n    let addRumors (newRumors: Rumors) (driver: Driver) : Driver =\n        { driver with Rumors = Set.union driver.Rumors newRumors }\n</code></pre>"},{"location":"fsharp/15-gossiping-bus-drivers/#_4","title":"\u5faa\u74b0\u30eb\u30fc\u30c8\u306e\u5b9f\u73fe","text":"<pre><code>// Position \u3092\u30eb\u30fc\u30c8\u9577\u3067\u5272\u3063\u305f\u4f59\u308a\u3092\u4f7f\u7528\nlet currentStop (driver: Driver) : int =\n    driver.Route.[driver.Position % driver.Route.Length]\n\n// \u4f8b: \u30eb\u30fc\u30c8 [1; 2; 3] \u306e\u5834\u5408\n// Position 0 -&gt; \u505c\u7559\u6240 1\n// Position 1 -&gt; \u505c\u7559\u6240 2\n// Position 2 -&gt; \u505c\u7559\u6240 3\n// Position 3 -&gt; \u505c\u7559\u6240 1 (3 % 3 = 0)\n</code></pre>"},{"location":"fsharp/15-gossiping-bus-drivers/#3","title":"3. \u79fb\u52d5\u3068\u5642\u306e\u4f1d\u64ad","text":""},{"location":"fsharp/15-gossiping-bus-drivers/#_5","title":"\u30ef\u30fc\u30eb\u30c9\u64cd\u4f5c","text":"<pre><code>/// \u30ef\u30fc\u30eb\u30c9 = \u30c9\u30e9\u30a4\u30d0\u30fc\u306e\u30ea\u30b9\u30c8\ntype World = Driver list\n\nmodule World =\n    /// \u5168\u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u79fb\u52d5\n    let moveAll (world: World) : World =\n        List.map Driver.move world\n\n    /// \u505c\u7559\u6240\u3054\u3068\u306b\u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u30b0\u30eb\u30fc\u30d7\u5316\n    let groupByStop (world: World) : Map&lt;int, Driver list&gt; =\n        world\n        |&gt; List.groupBy Driver.currentStop\n        |&gt; Map.ofList\n\n    /// \u540c\u3058\u505c\u7559\u6240\u306b\u3044\u308b\u30c9\u30e9\u30a4\u30d0\u30fc\u9593\u3067\u5642\u3092\u5171\u6709\n    let shareRumors (drivers: Driver list) : Driver list =\n        let allRumors =\n            drivers\n            |&gt; List.map (fun d -&gt; d.Rumors)\n            |&gt; Set.unionMany\n        drivers\n        |&gt; List.map (Driver.addRumors allRumors)\n\n    /// \u5168\u505c\u7559\u6240\u3067\u5642\u3092\u4f1d\u64ad\n    let spreadRumors (world: World) : World =\n        world\n        |&gt; groupByStop\n        |&gt; Map.toList\n        |&gt; List.map snd\n        |&gt; List.map shareRumors\n        |&gt; List.concat\n</code></pre>"},{"location":"fsharp/15-gossiping-bus-drivers/#_6","title":"\u5642\u306e\u5171\u6709\u30d7\u30ed\u30bb\u30b9","text":""},{"location":"fsharp/15-gossiping-bus-drivers/#4","title":"4. \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3","text":""},{"location":"fsharp/15-gossiping-bus-drivers/#1_1","title":"1\u30b9\u30c6\u30c3\u30d7\u306e\u51e6\u7406","text":"<pre><code>/// 1\u30b9\u30c6\u30c3\u30d7\u306e\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\n/// 1. \u5168\u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u79fb\u52d5\n/// 2. \u540c\u3058\u505c\u7559\u6240\u306b\u3044\u308b\u30c9\u30e9\u30a4\u30d0\u30fc\u9593\u3067\u5642\u3092\u5171\u6709\nlet drive (world: World) : World =\n    world\n    |&gt; World.moveAll\n    |&gt; World.spreadRumors\n</code></pre>"},{"location":"fsharp/15-gossiping-bus-drivers/#_7","title":"\u5b8c\u4e86\u5224\u5b9a","text":"<pre><code>/// \u5168\u30c9\u30e9\u30a4\u30d0\u30fc\u304c\u540c\u3058\u5642\u3092\u6301\u3063\u3066\u3044\u308b\u304b\u78ba\u8a8d\nlet allRumorsShared (world: World) : bool =\n    match world with\n    | [] -&gt; true\n    | first :: rest -&gt;\n        rest |&gt; List.forall (fun d -&gt; d.Rumors = first.Rumors)\n</code></pre>"},{"location":"fsharp/15-gossiping-bus-drivers/#_8","title":"\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u5b9f\u884c","text":"<pre><code>/// \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u7d50\u679c\ntype SimulationResult =\n    | Completed of minutes: int\n    | Never\n\n/// \u5168\u5642\u304c\u5171\u6709\u3055\u308c\u308b\u307e\u3067\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\nlet driveTillAllRumorsSpread (maxMinutes: int) (world: World) : SimulationResult =\n    let rec loop (w: World) (time: int) =\n        if time &gt; maxMinutes then\n            Never\n        elif World.allRumorsShared w then\n            Completed time\n        else\n            loop (drive w) (time + 1)\n    loop (drive world) 1\n\n/// 480\u5206\uff088\u6642\u9593\uff09\u3092\u4e0a\u9650\u3068\u3057\u3066\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\nlet simulate (world: World) : SimulationResult =\n    driveTillAllRumorsSpread 480 world\n</code></pre>"},{"location":"fsharp/15-gossiping-bus-drivers/#5","title":"5. \u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"fsharp/15-gossiping-bus-drivers/#6","title":"6. \u4f7f\u7528\u4f8b","text":"<pre><code>open FunctionalDesign.Part5.GossipingBusDrivers\n\n// 3\u4eba\u306e\u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u4f5c\u6210\nlet world = [\n    Driver.create \"D1\" [3; 1; 2; 3] (Set.ofList [\"rumor-a\"])\n    Driver.create \"D2\" [3; 2; 3; 1] (Set.ofList [\"rumor-b\"])\n    Driver.create \"D3\" [4; 2; 3; 4; 5] (Set.ofList [\"rumor-c\"])\n]\n\n// \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u5b9f\u884c\nmatch simulate world with\n| Completed minutes -&gt; printfn \"%d\u5206\u3067\u5168\u5642\u304c\u5171\u6709\u3055\u308c\u307e\u3057\u305f\" minutes\n| Never -&gt; printfn \"8\u6642\u9593\u4ee5\u5185\u306b\u5168\u5642\u306f\u5171\u6709\u3055\u308c\u307e\u305b\u3093\u3067\u3057\u305f\"\n\n// \u7d76\u5bfe\u306b\u51fa\u4f1a\u308f\u306a\u3044\u30eb\u30fc\u30c8\u306e\u5834\u5408\nlet neverMeet = [\n    Driver.create \"D1\" [1] (Set.ofList [\"rumor-a\"])\n    Driver.create \"D2\" [2] (Set.ofList [\"rumor-b\"])\n]\n\nmatch simulate neverMeet with\n| Never -&gt; printfn \"\u30c9\u30e9\u30a4\u30d0\u30fc\u306f\u51fa\u4f1a\u3044\u307e\u305b\u3093\"\n| Completed _ -&gt; printfn \"\u4e88\u671f\u3057\u306a\u3044\u7d50\u679c\"\n</code></pre>"},{"location":"fsharp/15-gossiping-bus-drivers/#7","title":"7. \u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1\u306e\u7279\u5fb4","text":""},{"location":"fsharp/15-gossiping-bus-drivers/#_9","title":"\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020","text":"<p>\u3059\u3079\u3066\u306e\u72b6\u614b\u5909\u66f4\u306f\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u8fd4\u3057\u307e\u3059\u3002\u5143\u306e\u30c7\u30fc\u30bf\u306f\u5909\u66f4\u3055\u308c\u307e\u305b\u3093\u3002</p> <pre><code>// \u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u79fb\u52d5\u3057\u3066\u3082\u5143\u306e\u30c9\u30e9\u30a4\u30d0\u30fc\u306f\u5909\u66f4\u3055\u308c\u306a\u3044\nlet original = Driver.create \"Test\" [1; 2; 3] (Set.ofList [\"a\"])\nlet moved = Driver.move original\n\nDriver.currentStop original // 1 (\u5909\u66f4\u306a\u3057)\nDriver.currentStop moved    // 2\n</code></pre>"},{"location":"fsharp/15-gossiping-bus-drivers/#_10","title":"\u96c6\u5408\u6f14\u7b97\u306e\u6d3b\u7528","text":"<pre><code>// \u8907\u6570\u306e\u96c6\u5408\u3092\u7d71\u5408\nlet rumors1 = Set.ofList [\"a\"; \"b\"]\nlet rumors2 = Set.ofList [\"c\"]\nlet rumors3 = Set.ofList [\"a\"; \"d\"]\n\nSet.unionMany [rumors1; rumors2; rumors3]\n// Set [\"a\"; \"b\"; \"c\"; \"d\"]\n</code></pre>"},{"location":"fsharp/15-gossiping-bus-drivers/#_11","title":"\u7d14\u7c8b\u95a2\u6570","text":"<p>\u3059\u3079\u3066\u306e\u95a2\u6570\u306f\u526f\u4f5c\u7528\u304c\u306a\u304f\u3001\u540c\u3058\u5165\u529b\u306b\u5bfe\u3057\u3066\u5e38\u306b\u540c\u3058\u51fa\u529b\u3092\u8fd4\u3057\u307e\u3059\u3002</p>"},{"location":"fsharp/15-gossiping-bus-drivers/#8","title":"8. \u30d1\u30bf\u30fc\u30f3\u306e\u5fdc\u7528","text":"<p>\u3053\u306e\u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5834\u9762\u3067\u5fdc\u7528\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4f1d\u64ad: \u30a6\u30a4\u30eb\u30b9\u3084\u60c5\u5831\u306e\u62e1\u6563\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3</li> <li>\u30b0\u30e9\u30d5\u63a2\u7d22: \u5de1\u56de\u30bb\u30fc\u30eb\u30b9\u30de\u30f3\u554f\u984c\u306e\u5909\u5f62</li> <li>\u72b6\u614b\u540c\u671f: \u5206\u6563\u30b7\u30b9\u30c6\u30e0\u3067\u306e\u72b6\u614b\u5171\u6709</li> </ul>"},{"location":"fsharp/15-gossiping-bus-drivers/#_12","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b\u554f\u984c\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u3092\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u5faa\u74b0\u30eb\u30fc\u30c8: \u30e2\u30b8\u30e5\u30ed\u6f14\u7b97\u306b\u3088\u308b\u5faa\u74b0\u306e\u5b9f\u73fe</li> <li>\u96c6\u5408\u6f14\u7b97: <code>Set.union</code>\u3001<code>Set.unionMany</code> \u306b\u3088\u308b\u72b6\u614b\u306e\u7d71\u5408</li> <li>\u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3: <code>|&gt;</code> \u306b\u3088\u308b\u51e6\u7406\u306e\u9023\u9396</li> <li>\u7d42\u4e86\u6761\u4ef6\u306e\u8a2d\u8a08: \u518d\u5e30\u95a2\u6570\u3068\u6761\u4ef6\u5206\u5c90\u306e\u7d44\u307f\u5408\u308f\u305b</li> </ol>"},{"location":"fsharp/15-gossiping-bus-drivers/#_13","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/fsharp/part5/src/Library.fs</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/fsharp/part5/tests/Tests.fs</code></li> </ul>"},{"location":"fsharp/16-payroll-system/","title":"\u7b2c16\u7ae0: \u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0","text":""},{"location":"fsharp/16-payroll-system/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0\u3092\u901a\u3058\u3066\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u696d\u52d9\u30c9\u30e1\u30a4\u30f3\u3092\u30e2\u30c7\u30ea\u30f3\u30b0\u3059\u308b\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002\u7570\u306a\u308b\u96c7\u7528\u5f62\u614b\uff08\u6708\u7d66\u5236\u3001\u6642\u7d66\u5236\u3001\u6b69\u5408\u5236\uff09\u306b\u5bfe\u5fdc\u3057\u305f\u7d66\u4e0e\u8a08\u7b97\u3092\u3001\u5224\u5225\u5171\u7528\u4f53\u3068\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3067\u5b9f\u88c5\u3057\u307e\u3059\u3002</p>"},{"location":"fsharp/16-payroll-system/#1","title":"1. \u554f\u984c\u306e\u8aac\u660e","text":"<p>\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0\u306f\u4ee5\u4e0b\u306e\u8981\u4ef6\u3092\u6e80\u305f\u3059\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\uff1a</p> <ul> <li>\u6708\u7d66\u5236\u5f93\u696d\u54e1: \u56fa\u5b9a\u306e\u6708\u7d66\u3092\u652f\u6255\u3046</li> <li>\u6642\u7d66\u5236\u5f93\u696d\u54e1: \u52b4\u50cd\u6642\u9593\u306b\u57fa\u3065\u3044\u3066\u652f\u6255\u3046\uff08\u6b8b\u696d\u306f1.5\u500d\uff09</li> <li>\u6b69\u5408\u5236\u5f93\u696d\u54e1: \u57fa\u672c\u7d66 + \u58f2\u4e0a\u306b\u5fdc\u3058\u305f\u6b69\u5408\u3092\u652f\u6255\u3046</li> </ul> <p></p>"},{"location":"fsharp/16-payroll-system/#2","title":"2. \u30c7\u30fc\u30bf\u30e2\u30c7\u30eb","text":""},{"location":"fsharp/16-payroll-system/#_2","title":"\u5f93\u696d\u54e1\u306e\u7a2e\u985e","text":"<pre><code>/// \u5f93\u696d\u54e1\u306e\u7a2e\u985e\n[&lt;RequireQualifiedAccess&gt;]\ntype EmployeeType =\n    | Salaried       // \u6708\u7d66\u5236\n    | Hourly         // \u6642\u7d66\u5236\n    | Commissioned   // \u6b69\u5408\u5236\n</code></pre>"},{"location":"fsharp/16-payroll-system/#_3","title":"\u30bf\u30a4\u30e0\u30ab\u30fc\u30c9\u3068\u58f2\u4e0a\u30ec\u30b7\u30fc\u30c8","text":"<pre><code>/// \u30bf\u30a4\u30e0\u30ab\u30fc\u30c9\u30a8\u30f3\u30c8\u30ea\ntype TimeCard =\n    { Date: DateTime\n      Hours: decimal }\n\n/// \u58f2\u4e0a\u30ec\u30b7\u30fc\u30c8\ntype SalesReceipt =\n    { Date: DateTime\n      Amount: decimal }\n</code></pre>"},{"location":"fsharp/16-payroll-system/#_4","title":"\u5f93\u696d\u54e1","text":"<pre><code>/// \u5f93\u696d\u54e1\ntype Employee =\n    { Id: string\n      Name: string\n      Type: EmployeeType\n      Salary: decimal option          // \u6708\u7d66\uff08Salaried, Commissioned\u306e\u5834\u5408\uff09\n      HourlyRate: decimal option      // \u6642\u7d66\uff08Hourly\u306e\u5834\u5408\uff09\n      CommissionRate: decimal option  // \u6b69\u5408\u7387\uff08Commissioned\u306e\u5834\u5408\uff09\n      TimeCards: TimeCard list\n      SalesReceipts: SalesReceipt list }\n</code></pre>"},{"location":"fsharp/16-payroll-system/#3","title":"3. \u5f93\u696d\u54e1\u4f5c\u6210","text":"<pre><code>module Employee =\n    /// \u6708\u7d66\u5236\u5f93\u696d\u54e1\u3092\u4f5c\u6210\n    let createSalaried (id: string) (name: string) (salary: decimal) : Employee =\n        { Id = id\n          Name = name\n          Type = EmployeeType.Salaried\n          Salary = Some salary\n          HourlyRate = None\n          CommissionRate = None\n          TimeCards = []\n          SalesReceipts = [] }\n\n    /// \u6642\u7d66\u5236\u5f93\u696d\u54e1\u3092\u4f5c\u6210\n    let createHourly (id: string) (name: string) (hourlyRate: decimal) : Employee =\n        { Id = id\n          Name = name\n          Type = EmployeeType.Hourly\n          Salary = None\n          HourlyRate = Some hourlyRate\n          CommissionRate = None\n          TimeCards = []\n          SalesReceipts = [] }\n\n    /// \u6b69\u5408\u5236\u5f93\u696d\u54e1\u3092\u4f5c\u6210\n    let createCommissioned (id: string) (name: string) (salary: decimal) (commissionRate: decimal) : Employee =\n        { Id = id\n          Name = name\n          Type = EmployeeType.Commissioned\n          Salary = Some salary\n          HourlyRate = None\n          CommissionRate = Some commissionRate\n          TimeCards = []\n          SalesReceipts = [] }\n\n    /// \u30bf\u30a4\u30e0\u30ab\u30fc\u30c9\u3092\u8ffd\u52a0\n    let addTimeCard (timeCard: TimeCard) (employee: Employee) : Employee =\n        { employee with TimeCards = timeCard :: employee.TimeCards }\n\n    /// \u58f2\u4e0a\u30ec\u30b7\u30fc\u30c8\u3092\u8ffd\u52a0\n    let addSalesReceipt (receipt: SalesReceipt) (employee: Employee) : Employee =\n        { employee with SalesReceipts = receipt :: employee.SalesReceipts }\n</code></pre>"},{"location":"fsharp/16-payroll-system/#4","title":"4. \u7d66\u4e0e\u8a08\u7b97","text":""},{"location":"fsharp/16-payroll-system/#_5","title":"\u8a08\u7b97\u30ed\u30b8\u30c3\u30af","text":"<pre><code>module Payroll =\n    /// \u6642\u7d66\u5236\u306e\u7d66\u4e0e\u8a08\u7b97\uff088\u6642\u9593\u3092\u8d85\u3048\u308b\u30681.5\u500d\uff09\n    let calculateHourlyPay (hourlyRate: decimal) (timeCards: TimeCard list) : decimal =\n        timeCards\n        |&gt; List.sumBy (fun tc -&gt;\n            let regularHours = min tc.Hours 8.0m\n            let overtimeHours = max (tc.Hours - 8.0m) 0.0m\n            (regularHours * hourlyRate) + (overtimeHours * hourlyRate * 1.5m))\n\n    /// \u6b69\u5408\u5236\u306e\u7d66\u4e0e\u8a08\u7b97\n    let calculateCommissionPay (baseSalary: decimal) (commissionRate: decimal) (receipts: SalesReceipt list) : decimal =\n        let totalSales = receipts |&gt; List.sumBy (fun r -&gt; r.Amount)\n        baseSalary + (totalSales * commissionRate)\n\n    /// \u5f93\u696d\u54e1\u306e\u7d66\u4e0e\u3092\u8a08\u7b97\n    let calculatePay (employee: Employee) : decimal =\n        match employee.Type with\n        | EmployeeType.Salaried -&gt;\n            employee.Salary |&gt; Option.defaultValue 0m\n        | EmployeeType.Hourly -&gt;\n            let rate = employee.HourlyRate |&gt; Option.defaultValue 0m\n            calculateHourlyPay rate employee.TimeCards\n        | EmployeeType.Commissioned -&gt;\n            let salary = employee.Salary |&gt; Option.defaultValue 0m\n            let rate = employee.CommissionRate |&gt; Option.defaultValue 0m\n            calculateCommissionPay salary rate employee.SalesReceipts\n</code></pre>"},{"location":"fsharp/16-payroll-system/#_6","title":"\u6b8b\u696d\u8a08\u7b97\u306e\u56f3\u89e3","text":""},{"location":"fsharp/16-payroll-system/#5","title":"5. \u7d66\u4e0e\u660e\u7d30","text":""},{"location":"fsharp/16-payroll-system/#_7","title":"\u7d66\u4e0e\u660e\u7d30\u306e\u5b9a\u7fa9","text":"<pre><code>/// \u7d66\u4e0e\u660e\u7d30\ntype Payslip =\n    { EmployeeId: string\n      EmployeeName: string\n      EmployeeType: EmployeeType\n      GrossPay: decimal\n      PayDate: DateTime }\n</code></pre>"},{"location":"fsharp/16-payroll-system/#_8","title":"\u7d66\u4e0e\u660e\u7d30\u306e\u751f\u6210","text":"<pre><code>module Payslip =\n    /// \u7d66\u4e0e\u660e\u7d30\u3092\u751f\u6210\n    let generate (payDate: DateTime) (employee: Employee) : Payslip =\n        { EmployeeId = employee.Id\n          EmployeeName = employee.Name\n          EmployeeType = employee.Type\n          GrossPay = Payroll.calculatePay employee\n          PayDate = payDate }\n\n    /// \u8907\u6570\u5f93\u696d\u54e1\u306e\u7d66\u4e0e\u660e\u7d30\u3092\u751f\u6210\n    let generateAll (payDate: DateTime) (employees: Employee list) : Payslip list =\n        employees |&gt; List.map (generate payDate)\n</code></pre>"},{"location":"fsharp/16-payroll-system/#6","title":"6. \u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"fsharp/16-payroll-system/#7","title":"7. \u4f7f\u7528\u4f8b","text":"<pre><code>open System\nopen FunctionalDesign.Part5.PayrollSystem\n\n// \u6708\u7d66\u5236\u5f93\u696d\u54e1\nlet alice = Employee.createSalaried \"E001\" \"Alice\" 5000.0m\nlet alicePay = Payroll.calculatePay alice\n// 5000.0m\n\n// \u6642\u7d66\u5236\u5f93\u696d\u54e1\uff08\u6b8b\u696d\u3042\u308a\uff09\nlet bob =\n    Employee.createHourly \"E002\" \"Bob\" 25.0m\n    |&gt; Employee.addTimeCard { Date = DateTime(2024, 1, 15); Hours = 10.0m }\n    |&gt; Employee.addTimeCard { Date = DateTime(2024, 1, 16); Hours = 8.0m }\nlet bobPay = Payroll.calculatePay bob\n// (8 * 25) + (2 * 25 * 1.5) + (8 * 25) = 200 + 75 + 200 = 475\n\n// \u6b69\u5408\u5236\u5f93\u696d\u54e1\nlet charlie =\n    Employee.createCommissioned \"E003\" \"Charlie\" 2000.0m 0.10m\n    |&gt; Employee.addSalesReceipt { Date = DateTime(2024, 1, 15); Amount = 5000.0m }\nlet charliePay = Payroll.calculatePay charlie\n// 2000 + 5000 * 0.10 = 2500\n\n// \u7d66\u4e0e\u660e\u7d30\u306e\u751f\u6210\nlet payDate = DateTime(2024, 1, 31)\nlet slips = Payslip.generateAll payDate [alice; bob; charlie]\n</code></pre>"},{"location":"fsharp/16-payroll-system/#8","title":"8. \u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1\u306e\u7279\u5fb4","text":""},{"location":"fsharp/16-payroll-system/#_9","title":"\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u306b\u3088\u308b\u5206\u5c90","text":"<pre><code>match employee.Type with\n| EmployeeType.Salaried -&gt; ...\n| EmployeeType.Hourly -&gt; ...\n| EmployeeType.Commissioned -&gt; ...\n</code></pre> <p>\u30b3\u30f3\u30d1\u30a4\u30e9\u304c\u7db2\u7f85\u6027\u3092\u30c1\u30a7\u30c3\u30af\u3059\u308b\u305f\u3081\u3001\u65b0\u3057\u3044\u5f93\u696d\u54e1\u30bf\u30a4\u30d7\u3092\u8ffd\u52a0\u3057\u305f\u5834\u5408\u306b\u3059\u3079\u3066\u306e\u5206\u5c90\u3092\u66f4\u65b0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3053\u3068\u304c\u4fdd\u8a3c\u3055\u308c\u307e\u3059\u3002</p>"},{"location":"fsharp/16-payroll-system/#option","title":"Option \u578b\u306b\u3088\u308b\u5b89\u5168\u306a\u5024\u30a2\u30af\u30bb\u30b9","text":"<pre><code>employee.Salary |&gt; Option.defaultValue 0m\n</code></pre> <p><code>null</code> \u30c1\u30a7\u30c3\u30af\u306e\u4ee3\u308f\u308a\u306b <code>Option</code> \u578b\u3092\u4f7f\u7528\u3057\u3001\u5b89\u5168\u306b\u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u9069\u7528\u3057\u307e\u3059\u3002</p>"},{"location":"fsharp/16-payroll-system/#_10","title":"\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u306a\u30c7\u30fc\u30bf\u64cd\u4f5c","text":"<pre><code>// \u5143\u306e\u30c7\u30fc\u30bf\u306f\u5909\u66f4\u3055\u308c\u305a\u3001\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u304c\u8fd4\u3055\u308c\u308b\nlet updatedEmployee = Employee.addTimeCard timeCard employee\n</code></pre>"},{"location":"fsharp/16-payroll-system/#9","title":"9. \u62e1\u5f35\u30dd\u30a4\u30f3\u30c8","text":"<p>\u3053\u306e\u30b7\u30b9\u30c6\u30e0\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306b\u62e1\u5f35\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u7a0e\u91d1\u8a08\u7b97: \u7d66\u4e0e\u304b\u3089\u7a0e\u91d1\u3092\u63a7\u9664</li> <li>\u798f\u5229\u539a\u751f: \u5065\u5eb7\u4fdd\u967a\u3001\u5e74\u91d1\u306a\u3069\u306e\u63a7\u9664</li> <li>\u652f\u6255\u3044\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb: \u9031\u6255\u3044\u3001\u9694\u9031\u6255\u3044\u3001\u6708\u6255\u3044\u306e\u5bfe\u5fdc</li> <li>\u4f11\u6687\u7ba1\u7406: \u6709\u7d66\u4f11\u6687\u306e\u8ffd\u8de1\u3068\u7d66\u4e0e\u3078\u306e\u53cd\u6620</li> </ul>"},{"location":"fsharp/16-payroll-system/#_11","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u3092\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u5224\u5225\u5171\u7528\u4f53: \u5f93\u696d\u54e1\u30bf\u30a4\u30d7\u306e\u8868\u73fe</li> <li>\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0: \u578b\u306b\u57fa\u3065\u304f\u7d66\u4e0e\u8a08\u7b97\u306e\u5206\u5c90</li> <li>Option \u578b: \u5b89\u5168\u306a\u5024\u30a2\u30af\u30bb\u30b9</li> <li>\u30c7\u30fc\u30bf\u5909\u63db: \u5f93\u696d\u54e1\u60c5\u5831\u304b\u3089\u7d66\u4e0e\u660e\u7d30\u3078\u306e\u5909\u63db</li> </ol>"},{"location":"fsharp/16-payroll-system/#_12","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/fsharp/part5/src/Library.fs</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/fsharp/part5/tests/Tests.fs</code></li> </ul>"},{"location":"fsharp/17-video-rental-system/","title":"\u7b2c17\u7ae0: \u30d3\u30c7\u30aa\u30ec\u30f3\u30bf\u30eb\u30b7\u30b9\u30c6\u30e0","text":""},{"location":"fsharp/17-video-rental-system/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Martin Fowler \u306e\u300c\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u300d\u3067\u6709\u540d\u306a\u30d3\u30c7\u30aa\u30ec\u30f3\u30bf\u30eb\u30b7\u30b9\u30c6\u30e0\u3092 F# \u3067\u5b9f\u88c5\u3057\u307e\u3059\u3002\u3053\u306e\u30b7\u30b9\u30c6\u30e0\u306f\u3001\u7570\u306a\u308b\u7a2e\u985e\u306e\u30d3\u30c7\u30aa\u306b\u5bfe\u3059\u308b\u6599\u91d1\u8a08\u7b97\u3068\u30dd\u30a4\u30f3\u30c8\u8a08\u7b97\u3092\u884c\u3044\u307e\u3059\u3002</p>"},{"location":"fsharp/17-video-rental-system/#1","title":"1. \u554f\u984c\u306e\u8aac\u660e","text":"<p>\u30d3\u30c7\u30aa\u30ec\u30f3\u30bf\u30eb\u30b7\u30b9\u30c6\u30e0\u306f\u4ee5\u4e0b\u306e\u6a5f\u80fd\u3092\u63d0\u4f9b\u3057\u307e\u3059\uff1a</p> <ul> <li>\u6599\u91d1\u8a08\u7b97: \u30d3\u30c7\u30aa\u306e\u7a2e\u985e\u3068\u65e5\u6570\u306b\u57fa\u3065\u3044\u3066\u6599\u91d1\u3092\u8a08\u7b97</li> <li>\u30dd\u30a4\u30f3\u30c8\u8a08\u7b97: \u30ec\u30f3\u30bf\u30eb\u306b\u5fdc\u3058\u305f\u30dd\u30a4\u30f3\u30c8\u3092\u4ed8\u4e0e</li> <li>\u660e\u7d30\u66f8\u751f\u6210: \u9867\u5ba2\u306e\u30ec\u30f3\u30bf\u30eb\u660e\u7d30\u3092\u751f\u6210</li> </ul> <p></p>"},{"location":"fsharp/17-video-rental-system/#2","title":"2. \u30c7\u30fc\u30bf\u30e2\u30c7\u30eb","text":""},{"location":"fsharp/17-video-rental-system/#_2","title":"\u30d3\u30c7\u30aa\u306e\u7a2e\u985e","text":"<pre><code>/// \u30d3\u30c7\u30aa\u306e\u7a2e\u985e\n[&lt;RequireQualifiedAccess&gt;]\ntype MovieType =\n    | Regular       // \u901a\u5e38\n    | NewRelease    // \u65b0\u4f5c\n    | Childrens     // \u5b50\u4f9b\u5411\u3051\n</code></pre>"},{"location":"fsharp/17-video-rental-system/#_3","title":"\u30d3\u30c7\u30aa\u3068\u30ec\u30f3\u30bf\u30eb","text":"<pre><code>/// \u30d3\u30c7\u30aa\ntype Movie =\n    { Title: string\n      Type: MovieType }\n\n/// \u30ec\u30f3\u30bf\u30eb\u8a18\u9332\ntype Rental =\n    { Movie: Movie\n      Days: int }\n\n/// \u9867\u5ba2\ntype Customer =\n    { Name: string\n      Rentals: Rental list }\n</code></pre>"},{"location":"fsharp/17-video-rental-system/#3","title":"3. \u6599\u91d1\u8a08\u7b97","text":""},{"location":"fsharp/17-video-rental-system/#_4","title":"\u6599\u91d1\u8a08\u7b97\u30eb\u30fc\u30eb","text":"\u30d3\u30c7\u30aa\u306e\u7a2e\u985e \u57fa\u672c\u6599\u91d1 \u8ffd\u52a0\u6599\u91d1 \u901a\u5e38 2\u65e5\u307e\u3067 $2 3\u65e5\u76ee\u304b\u3089 $1.5/\u65e5 \u65b0\u4f5c $3/\u65e5 \u306a\u3057 \u5b50\u4f9b\u5411\u3051 3\u65e5\u307e\u3067 $1.5 4\u65e5\u76ee\u304b\u3089 $1.5/\u65e5 <pre><code>module Pricing =\n    /// \u901a\u5e38\u30d3\u30c7\u30aa\u306e\u6599\u91d1\u8a08\u7b97\n    let regularPrice (days: int) : decimal =\n        let baseFee = 2.0m\n        if days &gt; 2 then\n            baseFee + (decimal (days - 2) * 1.5m)\n        else\n            baseFee\n\n    /// \u65b0\u4f5c\u30d3\u30c7\u30aa\u306e\u6599\u91d1\u8a08\u7b97\n    let newReleasePrice (days: int) : decimal =\n        decimal days * 3.0m\n\n    /// \u5b50\u4f9b\u5411\u3051\u30d3\u30c7\u30aa\u306e\u6599\u91d1\u8a08\u7b97\n    let childrensPrice (days: int) : decimal =\n        let baseFee = 1.5m\n        if days &gt; 3 then\n            baseFee + (decimal (days - 3) * 1.5m)\n        else\n            baseFee\n\n    /// \u30ec\u30f3\u30bf\u30eb\u6599\u91d1\u3092\u8a08\u7b97\n    let calculateRentalPrice (rental: Rental) : decimal =\n        match rental.Movie.Type with\n        | MovieType.Regular -&gt; regularPrice rental.Days\n        | MovieType.NewRelease -&gt; newReleasePrice rental.Days\n        | MovieType.Childrens -&gt; childrensPrice rental.Days\n</code></pre>"},{"location":"fsharp/17-video-rental-system/#_5","title":"\u6599\u91d1\u8a08\u7b97\u306e\u56f3\u89e3","text":""},{"location":"fsharp/17-video-rental-system/#4","title":"4. \u30dd\u30a4\u30f3\u30c8\u8a08\u7b97","text":"<pre><code>module Points =\n    /// \u30ec\u30f3\u30bf\u30eb\u30dd\u30a4\u30f3\u30c8\u3092\u8a08\u7b97\n    let calculateRentalPoints (rental: Rental) : int =\n        match rental.Movie.Type with\n        | MovieType.NewRelease when rental.Days &gt; 1 -&gt; 2\n        | _ -&gt; 1\n</code></pre> <p>\u30dd\u30a4\u30f3\u30c8\u30eb\u30fc\u30eb\uff1a - \u901a\u5e38\u306e\u30ec\u30f3\u30bf\u30eb: 1\u30dd\u30a4\u30f3\u30c8 - \u65b0\u4f5c2\u65e5\u4ee5\u4e0a: 2\u30dd\u30a4\u30f3\u30c8\uff08\u30dc\u30fc\u30ca\u30b9\uff09</p>"},{"location":"fsharp/17-video-rental-system/#5","title":"5. \u660e\u7d30\u66f8\u751f\u6210","text":""},{"location":"fsharp/17-video-rental-system/#_6","title":"\u660e\u7d30\u66f8\u306e\u5b9a\u7fa9","text":"<pre><code>/// \u660e\u7d30\u884c\ntype StatementLine =\n    { MovieTitle: string\n      Amount: decimal }\n\n/// \u660e\u7d30\u66f8\ntype Statement =\n    { CustomerName: string\n      Lines: StatementLine list\n      TotalAmount: decimal\n      FrequentRenterPoints: int }\n</code></pre>"},{"location":"fsharp/17-video-rental-system/#_7","title":"\u660e\u7d30\u66f8\u306e\u751f\u6210","text":"<pre><code>module Statement =\n    /// \u660e\u7d30\u884c\u3092\u751f\u6210\n    let createLine (rental: Rental) : StatementLine =\n        { MovieTitle = rental.Movie.Title\n          Amount = Pricing.calculateRentalPrice rental }\n\n    /// \u660e\u7d30\u66f8\u3092\u751f\u6210\n    let generate (customer: Customer) : Statement =\n        let lines = customer.Rentals |&gt; List.map createLine\n        let total = lines |&gt; List.sumBy (fun l -&gt; l.Amount)\n        let points = customer.Rentals |&gt; List.sumBy Points.calculateRentalPoints\n        { CustomerName = customer.Name\n          Lines = lines\n          TotalAmount = total\n          FrequentRenterPoints = points }\n</code></pre>"},{"location":"fsharp/17-video-rental-system/#_8","title":"\u660e\u7d30\u66f8\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8","text":"<pre><code>    /// \u660e\u7d30\u66f8\u3092\u30c6\u30ad\u30b9\u30c8\u5f62\u5f0f\u3067\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\n    let formatText (statement: Statement) : string =\n        let header = sprintf \"Rental Record for %s\\n\" statement.CustomerName\n        let lines =\n            statement.Lines\n            |&gt; List.map (fun l -&gt; sprintf \"\\t%s\\t%.2f\\n\" l.MovieTitle l.Amount)\n            |&gt; String.concat \"\"\n        let footer =\n            sprintf \"Amount owed is %.2f\\nYou earned %d frequent renter points\"\n                statement.TotalAmount\n                statement.FrequentRenterPoints\n        header + lines + footer\n\n    /// \u660e\u7d30\u66f8\u3092HTML\u5f62\u5f0f\u3067\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\n    let formatHtml (statement: Statement) : string =\n        let header = sprintf \"&lt;h1&gt;Rental Record for %s&lt;/h1&gt;\\n&lt;table&gt;\\n\" statement.CustomerName\n        let lines =\n            statement.Lines\n            |&gt; List.map (fun l -&gt; sprintf \"&lt;tr&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%.2f&lt;/td&gt;&lt;/tr&gt;\\n\" l.MovieTitle l.Amount)\n            |&gt; String.concat \"\"\n        let footer =\n            sprintf \"&lt;/table&gt;\\n&lt;p&gt;Amount owed is %.2f&lt;/p&gt;\\n&lt;p&gt;You earned %d frequent renter points&lt;/p&gt;\"\n                statement.TotalAmount\n                statement.FrequentRenterPoints\n        header + lines + footer\n</code></pre>"},{"location":"fsharp/17-video-rental-system/#6","title":"6. \u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u30e2\u30b8\u30e5\u30fc\u30eb","text":"<pre><code>module Movie =\n    let createRegular title = { Title = title; Type = MovieType.Regular }\n    let createNewRelease title = { Title = title; Type = MovieType.NewRelease }\n    let createChildrens title = { Title = title; Type = MovieType.Childrens }\n\nmodule Customer =\n    let create name = { Name = name; Rentals = [] }\n    let addRental rental customer =\n        { customer with Rentals = rental :: customer.Rentals }\n\nmodule Rental =\n    let create movie days = { Movie = movie; Days = days }\n</code></pre>"},{"location":"fsharp/17-video-rental-system/#7","title":"7. \u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"fsharp/17-video-rental-system/#8","title":"8. \u4f7f\u7528\u4f8b","text":"<pre><code>open FunctionalDesign.Part5.VideoRentalSystem\n\n// \u30d3\u30c7\u30aa\u3092\u4f5c\u6210\nlet jaws = Movie.createRegular \"Jaws\"\nlet dune = Movie.createNewRelease \"Dune\"\nlet frozen = Movie.createChildrens \"Frozen\"\n\n// \u9867\u5ba2\u3092\u4f5c\u6210\u3057\u3066\u30ec\u30f3\u30bf\u30eb\u3092\u8ffd\u52a0\nlet customer =\n    Customer.create \"John\"\n    |&gt; Customer.addRental (Rental.create jaws 3)     // \u901a\u5e38: $3.5\n    |&gt; Customer.addRental (Rental.create dune 2)     // \u65b0\u4f5c: $6\n    |&gt; Customer.addRental (Rental.create frozen 4)   // \u5b50\u4f9b: $3\n\n// \u660e\u7d30\u66f8\u3092\u751f\u6210\nlet statement = Statement.generate customer\n\n// \u30c6\u30ad\u30b9\u30c8\u5f62\u5f0f\u3067\u51fa\u529b\nprintfn \"%s\" (Statement.formatText statement)\n// Rental Record for John\n//     Jaws    3.50\n//     Dune    6.00\n//     Frozen  3.00\n// Amount owed is 12.50\n// You earned 4 frequent renter points\n\n// HTML\u5f62\u5f0f\u3067\u51fa\u529b\nprintfn \"%s\" (Statement.formatHtml statement)\n</code></pre>"},{"location":"fsharp/17-video-rental-system/#9","title":"9. \u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1\u306e\u7279\u5fb4","text":""},{"location":"fsharp/17-video-rental-system/#_9","title":"\u30c7\u30fc\u30bf\u3068\u632f\u308b\u821e\u3044\u306e\u5206\u96e2","text":"<pre><code>// \u30c7\u30fc\u30bf\u5b9a\u7fa9\ntype Movie = { Title: string; Type: MovieType }\n\n// \u632f\u308b\u821e\u3044\uff08\u95a2\u6570\uff09\nlet calculateRentalPrice (rental: Rental) : decimal = ...\n</code></pre> <p>\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u3067\u306f <code>Movie</code> \u30af\u30e9\u30b9\u306b <code>calculatePrice</code> \u30e1\u30bd\u30c3\u30c9\u3092\u6301\u305f\u305b\u307e\u3059\u304c\u3001\u95a2\u6570\u578b\u3067\u306f\u7d14\u7c8b\u95a2\u6570\u3068\u3057\u3066\u5206\u96e2\u3057\u307e\u3059\u3002</p>"},{"location":"fsharp/17-video-rental-system/#_10","title":"\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306b\u3088\u308b\u51e6\u7406","text":"<pre><code>let lines = customer.Rentals |&gt; List.map createLine\nlet total = lines |&gt; List.sumBy (fun l -&gt; l.Amount)\nlet points = customer.Rentals |&gt; List.sumBy Points.calculateRentalPoints\n</code></pre>"},{"location":"fsharp/17-video-rental-system/#_11","title":"\u62e1\u5f35\u306e\u5bb9\u6613\u3055","text":"<p>\u65b0\u3057\u3044\u30d3\u30c7\u30aa\u30bf\u30a4\u30d7\u3092\u8ffd\u52a0\u3059\u308b\u5834\u5408\uff1a</p> <ol> <li><code>MovieType</code> \u306b\u65b0\u3057\u3044\u30b1\u30fc\u30b9\u3092\u8ffd\u52a0</li> <li><code>Pricing</code> \u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u65b0\u3057\u3044\u6599\u91d1\u8a08\u7b97\u3092\u8ffd\u52a0</li> <li>\u30b3\u30f3\u30d1\u30a4\u30e9\u304c\u672a\u51e6\u7406\u306e\u30b1\u30fc\u30b9\u3092\u8b66\u544a</li> </ol> <pre><code>// \u65b0\u3057\u3044\u30bf\u30a4\u30d7\u3092\u8ffd\u52a0\ntype MovieType =\n    | Regular\n    | NewRelease\n    | Childrens\n    | Premium  // \u65b0\u898f\u8ffd\u52a0\n\n// \u30b3\u30f3\u30d1\u30a4\u30e9\u304c calculateRentalPrice \u306e\u66f4\u65b0\u3092\u4fc3\u3059\n</code></pre>"},{"location":"fsharp/17-video-rental-system/#10-strategy","title":"10. Strategy \u30d1\u30bf\u30fc\u30f3\u3068\u306e\u95a2\u4fc2","text":"<p>\u3053\u306e\u5b9f\u88c5\u306f\u7b2c10\u7ae0\u306e Strategy \u30d1\u30bf\u30fc\u30f3\u3068\u985e\u4f3c\u3057\u3066\u3044\u307e\u3059\u3002\u6599\u91d1\u8a08\u7b97\u306e\u30ed\u30b8\u30c3\u30af\u3092\u4ea4\u63db\u53ef\u80fd\u306b\u3059\u308b\u5834\u5408\uff1a</p> <pre><code>type PricingStrategy = int -&gt; decimal\n\nlet regularPricing: PricingStrategy = Pricing.regularPrice\nlet newReleasePricing: PricingStrategy = Pricing.newReleasePrice\nlet childrensPricing: PricingStrategy = Pricing.childrensPrice\n\nlet calculateWithStrategy (strategy: PricingStrategy) (days: int) =\n    strategy days\n</code></pre>"},{"location":"fsharp/17-video-rental-system/#_12","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u30d3\u30c7\u30aa\u30ec\u30f3\u30bf\u30eb\u30b7\u30b9\u30c6\u30e0\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u3092\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u5224\u5225\u5171\u7528\u4f53: \u30d3\u30c7\u30aa\u30bf\u30a4\u30d7\u306e\u8868\u73fe</li> <li>\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0: \u30bf\u30a4\u30d7\u306b\u57fa\u3065\u304f\u6599\u91d1\u8a08\u7b97</li> <li>\u30c7\u30fc\u30bf\u5909\u63db: \u30ec\u30f3\u30bf\u30eb\u60c5\u5831\u304b\u3089\u660e\u7d30\u66f8\u3078\u306e\u5909\u63db</li> <li>\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u6226\u7565: \u540c\u3058\u30c7\u30fc\u30bf\u306e\u7570\u306a\u308b\u8868\u73fe\u5f62\u5f0f</li> </ol>"},{"location":"fsharp/17-video-rental-system/#5_1","title":"\u7b2c5\u90e8\u306e\u307e\u3068\u3081","text":"<p>\u7b2c5\u90e8\u3067\u306f\u3001\u5b9f\u8df5\u7684\u306a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3092\u901a\u3058\u3066\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3092\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ul> <li>\u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b: \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3068\u72b6\u614b\u4f1d\u64ad</li> <li>\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0: \u696d\u52d9\u30c9\u30e1\u30a4\u30f3\u306e\u30e2\u30c7\u30ea\u30f3\u30b0</li> <li>\u30d3\u30c7\u30aa\u30ec\u30f3\u30bf\u30eb\u30b7\u30b9\u30c6\u30e0: \u30c7\u30fc\u30bf\u5909\u63db\u3068\u30d5\u30a9\u30fc\u30de\u30c3\u30c8</li> </ul> <p>\u3053\u308c\u3089\u306e\u4f8b\u3092\u901a\u3058\u3066\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u304c\u5b9f\u969b\u306e\u30d3\u30b8\u30cd\u30b9\u554f\u984c\u306b\u3069\u306e\u3088\u3046\u306b\u9069\u7528\u3067\u304d\u308b\u304b\u3092\u5b66\u3073\u307e\u3057\u305f\u3002</p>"},{"location":"fsharp/17-video-rental-system/#_13","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/fsharp/part5/src/Library.fs</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/fsharp/part5/tests/Tests.fs</code></li> </ul>"},{"location":"fsharp/18-concurrency-system/","title":"\u7b2c18\u7ae0: \u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0","text":""},{"location":"fsharp/18-concurrency-system/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001F# \u306e\u4e26\u884c\u51e6\u7406\u6a5f\u80fd\u3092\u4f7f\u3063\u305f\u72b6\u614b\u6a5f\u68b0\u30d1\u30bf\u30fc\u30f3\u3068\u30a4\u30d9\u30f3\u30c8\u99c6\u52d5\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3092\u5b66\u3073\u307e\u3059\u3002\u96fb\u8a71\u901a\u8a71\u30b7\u30b9\u30c6\u30e0\u3092\u4f8b\u306b\u3001\u975e\u540c\u671f\u72b6\u614b\u7ba1\u7406\u306e\u57fa\u790e\u3092\u7406\u89e3\u3057\u307e\u3059\u3002</p> <p>\u3053\u306e\u554f\u984c\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u306e\u6982\u5ff5\u3092\u5b66\u3073\u307e\u3059\uff1a</p> <ul> <li>\u72b6\u614b\u6a5f\u68b0\u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5</li> <li>\u30a4\u30d9\u30f3\u30c8\u99c6\u52d5\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3</li> <li>MailboxProcessor \u306b\u3088\u308b\u975e\u540c\u671f\u51e6\u7406</li> </ul>"},{"location":"fsharp/18-concurrency-system/#1-f","title":"1. F# \u306e\u4e26\u884c\u51e6\u7406\u30e2\u30c7\u30eb","text":"<p>F# \u306f\u8907\u6570\u306e\u4e26\u884c\u51e6\u7406\u6a5f\u80fd\u3092\u63d0\u4f9b\u3057\u307e\u3059\uff1a</p> \u6a5f\u80fd \u7279\u5fb4 \u7528\u9014 async \u975e\u540c\u671f\u30ef\u30fc\u30af\u30d5\u30ed\u30fc I/O \u30d0\u30a6\u30f3\u30c9\u306e\u51e6\u7406 Task .NET Task \u3068\u306e\u4e92\u63db \u975e\u540c\u671f\u64cd\u4f5c MailboxProcessor \u30a2\u30af\u30bf\u30fc\u30e2\u30c7\u30eb \u30e1\u30c3\u30bb\u30fc\u30b8\u30d9\u30fc\u30b9\u306e\u72b6\u614b\u7ba1\u7406 <p></p>"},{"location":"fsharp/18-concurrency-system/#2","title":"2. \u72b6\u614b\u6a5f\u68b0\u30d1\u30bf\u30fc\u30f3","text":""},{"location":"fsharp/18-concurrency-system/#_2","title":"\u96fb\u8a71\u901a\u8a71\u306e\u72b6\u614b\u9077\u79fb","text":""},{"location":"fsharp/18-concurrency-system/#_3","title":"\u72b6\u614b\u3068\u30a4\u30d9\u30f3\u30c8\u306e\u5b9a\u7fa9","text":"<pre><code>/// \u96fb\u8a71\u306e\u72b6\u614b\n[&lt;RequireQualifiedAccess&gt;]\ntype PhoneState =\n    | Idle\n    | Calling\n    | Dialing\n    | WaitingForConnection\n    | Talking\n\n/// \u96fb\u8a71\u30a4\u30d9\u30f3\u30c8\n[&lt;RequireQualifiedAccess&gt;]\ntype PhoneEvent =\n    | Call\n    | Ring\n    | Dialtone\n    | Ringback\n    | Connected\n    | Disconnect\n\n/// \u30e6\u30fc\u30b6\u30fc\u60c5\u5831\ntype User =\n    { Id: string\n      State: PhoneState\n      Peer: string option }\n</code></pre>"},{"location":"fsharp/18-concurrency-system/#_4","title":"\u72b6\u614b\u9077\u79fb\u30c6\u30fc\u30d6\u30eb","text":"<pre><code>module StateMachine =\n    /// \u72b6\u614b\u9077\u79fb\u30c6\u30fc\u30d6\u30eb\n    let transitions : Map&lt;PhoneState * PhoneEvent, PhoneState&gt; =\n        [\n            (PhoneState.Idle, PhoneEvent.Call), PhoneState.Calling\n            (PhoneState.Idle, PhoneEvent.Ring), PhoneState.WaitingForConnection\n            (PhoneState.Idle, PhoneEvent.Disconnect), PhoneState.Idle\n            (PhoneState.Calling, PhoneEvent.Dialtone), PhoneState.Dialing\n            (PhoneState.Dialing, PhoneEvent.Ringback), PhoneState.WaitingForConnection\n            (PhoneState.WaitingForConnection, PhoneEvent.Connected), PhoneState.Talking\n            (PhoneState.Talking, PhoneEvent.Disconnect), PhoneState.Idle\n        ] |&gt; Map.ofList\n\n    /// \u72b6\u614b\u9077\u79fb\u3092\u5b9f\u884c\n    let transition (state: PhoneState) (event: PhoneEvent) : PhoneState option =\n        Map.tryFind (state, event) transitions\n</code></pre>"},{"location":"fsharp/18-concurrency-system/#3","title":"3. \u96fb\u8a71\u64cd\u4f5c","text":"<pre><code>module Phone =\n    /// \u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\n    let createUser (id: string) : User =\n        { Id = id; State = PhoneState.Idle; Peer = None }\n\n    /// \u96fb\u8a71\u3092\u304b\u3051\u308b\n    let makeCall (caller: User) (callee: User) : User * User =\n        let updatedCaller = StateMachine.sendEvent PhoneEvent.Call (Some callee.Id) caller\n        let updatedCallee = StateMachine.sendEvent PhoneEvent.Ring (Some caller.Id) callee\n        (updatedCaller, updatedCallee)\n\n    /// \u96fb\u8a71\u306b\u51fa\u308b\n    let answerCall (caller: User) (callee: User) : User * User =\n        let caller1 = StateMachine.sendEvent PhoneEvent.Dialtone None caller\n        let caller2 = StateMachine.sendEvent PhoneEvent.Ringback None caller1\n        let caller3 = StateMachine.sendEvent PhoneEvent.Connected None caller2\n        let callee1 = StateMachine.sendEvent PhoneEvent.Connected None callee\n        (caller3, callee1)\n\n    /// \u96fb\u8a71\u3092\u5207\u308b\n    let hangUp (caller: User) (callee: User) : User * User =\n        let updatedCaller = StateMachine.sendEvent PhoneEvent.Disconnect None caller\n        let updatedCallee = StateMachine.sendEvent PhoneEvent.Disconnect None callee\n        (updatedCaller, updatedCallee)\n</code></pre>"},{"location":"fsharp/18-concurrency-system/#4","title":"4. \u30a4\u30d9\u30f3\u30c8\u30d0\u30b9","text":""},{"location":"fsharp/18-concurrency-system/#_5","title":"\u30a4\u30d9\u30f3\u30c8\u30d0\u30b9\u306e\u5b9f\u88c5","text":"<pre><code>/// \u30a4\u30d9\u30f3\u30c8\ntype Event&lt;'T&gt; =\n    { Type: string\n      Data: 'T\n      Timestamp: System.DateTime }\n\n/// \u30a4\u30d9\u30f3\u30c8\u30d0\u30b9\ntype EventBus&lt;'T&gt; =\n    { Subscribers: Map&lt;string, (Event&lt;'T&gt; -&gt; unit) list&gt;\n      EventLog: Event&lt;'T&gt; list }\n\nmodule EventBus =\n    /// \u30a4\u30d9\u30f3\u30c8\u30d0\u30b9\u3092\u4f5c\u6210\n    let create&lt;'T&gt; () : EventBus&lt;'T&gt; =\n        { Subscribers = Map.empty; EventLog = [] }\n\n    /// \u8cfc\u8aad\u3092\u8ffd\u52a0\n    let subscribe (eventType: string) (handler: Event&lt;'T&gt; -&gt; unit) (bus: EventBus&lt;'T&gt;) : EventBus&lt;'T&gt; =\n        let handlers = Map.tryFind eventType bus.Subscribers |&gt; Option.defaultValue []\n        { bus with Subscribers = Map.add eventType (handler :: handlers) bus.Subscribers }\n\n    /// \u30a4\u30d9\u30f3\u30c8\u3092\u767a\u884c\n    let publish (eventType: string) (data: 'T) (bus: EventBus&lt;'T&gt;) : EventBus&lt;'T&gt; =\n        let event = { Type = eventType; Data = data; Timestamp = System.DateTime.UtcNow }\n        let handlers = Map.tryFind eventType bus.Subscribers |&gt; Option.defaultValue []\n        handlers |&gt; List.iter (fun handler -&gt; handler event)\n        { bus with EventLog = event :: bus.EventLog }\n</code></pre>"},{"location":"fsharp/18-concurrency-system/#5-mailboxprocessor","title":"5. MailboxProcessor\uff08\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\uff09","text":""},{"location":"fsharp/18-concurrency-system/#_6","title":"\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u5b9f\u88c5","text":"<pre><code>/// \u30e1\u30c3\u30bb\u30fc\u30b8\ntype AgentMessage&lt;'TState, 'TEvent&gt; =\n    | GetState of AsyncReplyChannel&lt;'TState&gt;\n    | SendEvent of 'TEvent\n\n/// \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u4f5c\u6210\nlet createAgent&lt;'TState, 'TEvent&gt; (initialState: 'TState) (update: 'TEvent -&gt; 'TState -&gt; 'TState) =\n    MailboxProcessor.Start(fun inbox -&gt;\n        let rec loop state = async {\n            let! msg = inbox.Receive()\n            match msg with\n            | GetState channel -&gt;\n                channel.Reply state\n                return! loop state\n            | SendEvent event -&gt;\n                let newState = update event state\n                return! loop newState\n        }\n        loop initialState)\n\n/// \u72b6\u614b\u3092\u53d6\u5f97\nlet getAgentState (agent: MailboxProcessor&lt;AgentMessage&lt;'TState, 'TEvent&gt;&gt;) : 'TState =\n    agent.PostAndReply(fun channel -&gt; GetState channel)\n\n/// \u30a4\u30d9\u30f3\u30c8\u3092\u9001\u4fe1\nlet sendAgentEvent (agent: MailboxProcessor&lt;AgentMessage&lt;'TState, 'TEvent&gt;&gt;) (event: 'TEvent) : unit =\n    agent.Post(SendEvent event)\n</code></pre>"},{"location":"fsharp/18-concurrency-system/#_7","title":"\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u5229\u70b9","text":"<ol> <li>\u975e\u540c\u671f\u51e6\u7406: <code>Post</code> \u306f\u5373\u5ea7\u306b\u623b\u308a\u3001\u51e6\u7406\u306f\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u5b9f\u884c</li> <li>\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba: \u540c\u4e00\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3078\u306e\u66f4\u65b0\u306f\u9806\u5e8f\u4fdd\u8a3c</li> <li>\u72b6\u614b\u306e\u9694\u96e2: \u72b6\u614b\u306f\u5916\u90e8\u304b\u3089\u76f4\u63a5\u30a2\u30af\u30bb\u30b9\u4e0d\u53ef</li> </ol>"},{"location":"fsharp/18-concurrency-system/#6","title":"6. \u4f7f\u7528\u4f8b","text":""},{"location":"fsharp/18-concurrency-system/#_8","title":"\u96fb\u8a71\u901a\u8a71\u306e\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3","text":"<pre><code>open FunctionalDesign.Part6.ConcurrencySystem\n\n// \u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\nlet alice = Phone.createUser \"Alice\"\nlet bob = Phone.createUser \"Bob\"\n\n// Alice \u304c Bob \u306b\u96fb\u8a71\u3092\u304b\u3051\u308b\nlet (alice1, bob1) = Phone.makeCall alice bob\nprintfn \"Alice: %A, Bob: %A\" alice1.State bob1.State\n// Alice: Calling, Bob: WaitingForConnection\n\n// Bob \u304c\u96fb\u8a71\u306b\u51fa\u308b\nlet (alice2, bob2) = Phone.answerCall alice1 bob1\nprintfn \"Alice: %A, Bob: %A\" alice2.State bob2.State\n// Alice: Talking, Bob: Talking\n\n// \u96fb\u8a71\u3092\u5207\u308b\nlet (alice3, bob3) = Phone.hangUp alice2 bob2\nprintfn \"Alice: %A, Bob: %A\" alice3.State bob3.State\n// Alice: Idle, Bob: Idle\n</code></pre>"},{"location":"fsharp/18-concurrency-system/#_9","title":"\u30a4\u30d9\u30f3\u30c8\u30d0\u30b9\u306e\u4f7f\u7528","text":"<pre><code>// \u30a4\u30d9\u30f3\u30c8\u30d0\u30b9\u3092\u4f5c\u6210\nlet bus = EventBus.create&lt;string&gt; ()\n\n// \u30cf\u30f3\u30c9\u30e9\u3092\u767b\u9332\nlet bus' =\n    bus\n    |&gt; EventBus.subscribe \"user-logged-in\" (fun event -&gt;\n        printfn \"User logged in: %s\" event.Data)\n    |&gt; EventBus.subscribe \"user-logged-in\" (fun event -&gt;\n        printfn \"Sending welcome email to: %s\" event.Data)\n\n// \u30a4\u30d9\u30f3\u30c8\u3092\u767a\u884c\nlet bus'' = EventBus.publish \"user-logged-in\" \"Alice\" bus'\n// User logged in: Alice\n// Sending welcome email to: Alice\n</code></pre>"},{"location":"fsharp/18-concurrency-system/#7","title":"7. \u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"fsharp/18-concurrency-system/#_10","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u72b6\u614b\u6a5f\u68b0\u30d1\u30bf\u30fc\u30f3: \u72b6\u614b\u3068\u9077\u79fb\u3092\u30c6\u30fc\u30d6\u30eb\u3067\u7ba1\u7406</li> <li>\u30a4\u30d9\u30f3\u30c8\u30d0\u30b9: \u30d1\u30d6\u30ea\u30c3\u30b7\u30e3\u30fc\u3068\u30b5\u30d6\u30b9\u30af\u30e9\u30a4\u30d0\u30fc\u306e\u758e\u7d50\u5408</li> <li>MailboxProcessor: \u30a2\u30af\u30bf\u30fc\u30e2\u30c7\u30eb\u306b\u3088\u308b\u975e\u540c\u671f\u72b6\u614b\u7ba1\u7406</li> </ol>"},{"location":"fsharp/18-concurrency-system/#_11","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/fsharp/part6/src/Library.fs</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/fsharp/part6/tests/Tests.fs</code></li> </ul>"},{"location":"fsharp/19-wator-simulation/","title":"\u7b2c19\u7ae0: Wa-Tor \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3","text":""},{"location":"fsharp/19-wator-simulation/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Wa-Tor\uff08Water Torus\uff09\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u901a\u3058\u3066\u3001\u30bb\u30eb\u30aa\u30fc\u30c8\u30de\u30c8\u30f3\u3068\u5224\u5225\u5171\u7528\u4f53\u3092\u4f7f\u3063\u305f\u6355\u98df\u8005-\u88ab\u98df\u8005\u30e2\u30c7\u30eb\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p> <p>Wa-Tor \u306f1984\u5e74\u306b A.K. Dewdney \u304c Scientific American \u3067\u7d39\u4ecb\u3057\u305f\u53e4\u5178\u7684\u306a\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3067\u3001\u9b5a\uff08\u88ab\u98df\u8005\uff09\u3068\u30b5\u30e1\uff08\u6355\u98df\u8005\uff09\u306e\u751f\u614b\u7cfb\u3092\u30e2\u30c7\u30eb\u5316\u3057\u307e\u3059\u3002</p>"},{"location":"fsharp/19-wator-simulation/#1-wa-tor","title":"1. Wa-Tor \u306e\u4e16\u754c","text":""},{"location":"fsharp/19-wator-simulation/#_2","title":"\u30c8\u30fc\u30e9\u30b9\u578b\u30ef\u30fc\u30eb\u30c9","text":"<p>Wa-Tor \u306e\u4e16\u754c\u306f\u30c8\u30fc\u30e9\u30b9\uff08\u30c9\u30fc\u30ca\u30c4\u578b\uff09\u3067\u3059\u3002\u7aef\u306b\u5230\u9054\u3059\u308b\u3068\u53cd\u5bfe\u5074\u306b\u51fa\u73fe\u3057\u307e\u3059\u3002</p> <p></p>"},{"location":"fsharp/19-wator-simulation/#_3","title":"\u30bb\u30eb\u306e\u7a2e\u985e","text":"<ul> <li>\u6c34\uff08Water\uff09: \u7a7a\u306e\u30bb\u30eb</li> <li>\u9b5a\uff08Fish\uff09: \u88ab\u98df\u8005\u3001\u79fb\u52d5\u3068\u7e41\u6b96\u306e\u307f</li> <li>\u30b5\u30e1\uff08Shark\uff09: \u6355\u98df\u8005\u3001\u79fb\u52d5\u3001\u7e41\u6b96\u3001\u6355\u98df</li> </ul>"},{"location":"fsharp/19-wator-simulation/#2","title":"2. \u30c7\u30fc\u30bf\u30e2\u30c7\u30eb","text":""},{"location":"fsharp/19-wator-simulation/#_4","title":"\u30bb\u30eb\u306e\u5b9a\u7fa9","text":"<pre><code>/// \u30bb\u30eb\u306e\u7a2e\u985e\n[&lt;RequireQualifiedAccess&gt;]\ntype Cell =\n    | Water\n    | Fish of age: int * breedTime: int\n    | Shark of age: int * breedTime: int * energy: int\n\n/// \u5ea7\u6a19\ntype Position = int * int\n\n/// \u30ef\u30fc\u30eb\u30c9\ntype World =\n    { Width: int\n      Height: int\n      Cells: Map&lt;Position, Cell&gt;\n      FishBreedTime: int\n      SharkBreedTime: int\n      SharkInitialEnergy: int\n      SharkEnergyFromFish: int }\n</code></pre> <p>\u5224\u5225\u5171\u7528\u4f53\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u5404\u30bb\u30eb\u306e\u72b6\u614b\u3092\u578b\u5b89\u5168\u306b\u8868\u73fe\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"fsharp/19-wator-simulation/#3","title":"3. \u5ea7\u6a19\u64cd\u4f5c","text":""},{"location":"fsharp/19-wator-simulation/#_5","title":"\u30c8\u30fc\u30e9\u30b9\u4e0a\u3067\u306e\u5ea7\u6a19\u30e9\u30c3\u30d7","text":"<pre><code>module Position =\n    /// \u30c8\u30fc\u30e9\u30b9\u4e0a\u3067\u5ea7\u6a19\u3092\u30e9\u30c3\u30d7\n    let wrap (width: int) (height: int) ((x, y): Position) : Position =\n        ((x % width + width) % width, (y % height + height) % height)\n\n    /// \u96a3\u63a5\u30bb\u30eb\u306e\u5ea7\u6a19\u3092\u53d6\u5f97\uff084\u65b9\u5411\uff09\n    let neighbors (width: int) (height: int) ((x, y): Position) : Position list =\n        [(x - 1, y); (x + 1, y); (x, y - 1); (x, y + 1)]\n        |&gt; List.map (wrap width height)\n</code></pre>"},{"location":"fsharp/19-wator-simulation/#4","title":"4. \u30ef\u30fc\u30eb\u30c9\u64cd\u4f5c","text":"<pre><code>module World =\n    /// \u30ef\u30fc\u30eb\u30c9\u3092\u4f5c\u6210\n    let create (width: int) (height: int) : World =\n        let positions = [ for x in 0..width-1 do for y in 0..height-1 -&gt; (x, y) ]\n        let cells = positions |&gt; List.map (fun pos -&gt; (pos, Cell.Water)) |&gt; Map.ofList\n        { Width = width\n          Height = height\n          Cells = cells\n          FishBreedTime = 3\n          SharkBreedTime = 8\n          SharkInitialEnergy = 5\n          SharkEnergyFromFish = 3 }\n\n    /// \u30bb\u30eb\u3092\u53d6\u5f97\n    let getCell (pos: Position) (world: World) : Cell =\n        Map.tryFind pos world.Cells |&gt; Option.defaultValue Cell.Water\n\n    /// \u30bb\u30eb\u3092\u8a2d\u5b9a\n    let setCell (pos: Position) (cell: Cell) (world: World) : World =\n        { world with Cells = Map.add pos cell world.Cells }\n\n    /// \u7279\u5b9a\u306e\u30bb\u30eb\u7a2e\u985e\u306e\u96a3\u63a5\u30bb\u30eb\u3092\u53d6\u5f97\n    let getNeighborsOfType (pos: Position) (predicate: Cell -&gt; bool) (world: World) : Position list =\n        Position.neighbors world.Width world.Height pos\n        |&gt; List.filter (fun p -&gt; predicate (getCell p world))\n</code></pre>"},{"location":"fsharp/19-wator-simulation/#5","title":"5. \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb","text":""},{"location":"fsharp/19-wator-simulation/#_6","title":"\u9b5a\u306e\u30eb\u30fc\u30eb","text":"<ol> <li>\u96a3\u63a5\u3059\u308b\u7a7a\u306e\u30bb\u30eb\u306b\u30e9\u30f3\u30c0\u30e0\u306b\u79fb\u52d5</li> <li>\u4e00\u5b9a\u6642\u9593\uff08breedTime\uff09\u7d4c\u904e\u5f8c\u3001\u7e41\u6b96\uff08\u73fe\u5728\u4f4d\u7f6e\u306b\u5b50\u3092\u6b8b\u3059\uff09</li> <li>\u79fb\u52d5\u3067\u304d\u306a\u3044\u5834\u5408\u306f\u305d\u306e\u5834\u306b\u7559\u307e\u308b</li> </ol> <pre><code>/// \u9b5a\u306e\u30c6\u30a3\u30c3\u30af\u51e6\u7406\nlet fishTick (pos: Position) (age: int) (breedTime: int) (world: World) : (Position * Cell) list =\n    let emptyNeighbors = World.getNeighborsOfType pos CellOps.isWater world\n    match pickRandom emptyNeighbors with\n    | Some newPos -&gt;\n        if age + 1 &gt;= breedTime then\n            // \u7e41\u6b96: \u73fe\u5728\u4f4d\u7f6e\u306b\u5b50\u3092\u6b8b\u3057\u3001\u65b0\u4f4d\u7f6e\u306b\u79fb\u52d5\n            [ (pos, Cell.Fish(0, world.FishBreedTime))\n              (newPos, Cell.Fish(0, world.FishBreedTime)) ]\n        else\n            // \u79fb\u52d5\u306e\u307f\n            [ (pos, Cell.Water)\n              (newPos, Cell.Fish(age + 1, breedTime)) ]\n    | None -&gt;\n        // \u79fb\u52d5\u3067\u304d\u306a\u3044: \u305d\u306e\u5834\u3067\u5e74\u3092\u53d6\u308b\n        [ (pos, Cell.Fish(age + 1, breedTime)) ]\n</code></pre>"},{"location":"fsharp/19-wator-simulation/#_7","title":"\u30b5\u30e1\u306e\u30eb\u30fc\u30eb","text":"<ol> <li>\u96a3\u63a5\u3059\u308b\u9b5a\u304c\u3044\u308c\u3070\u98df\u3079\u308b\uff08\u30a8\u30cd\u30eb\u30ae\u30fc\u7372\u5f97\uff09</li> <li>\u9b5a\u304c\u3044\u306a\u3051\u308c\u3070\u7a7a\u306e\u30bb\u30eb\u306b\u79fb\u52d5</li> <li>\u6bce\u30bf\u30fc\u30f3\u3001\u30a8\u30cd\u30eb\u30ae\u30fc\u30921\u6d88\u8cbb</li> <li>\u30a8\u30cd\u30eb\u30ae\u30fc\u304c0\u306b\u306a\u308b\u3068\u6b7b\u4ea1</li> <li>\u4e00\u5b9a\u6642\u9593\u7d4c\u904e\u5f8c\u3001\u7e41\u6b96</li> </ol> <pre><code>/// \u30b5\u30e1\u306e\u30c6\u30a3\u30c3\u30af\u51e6\u7406\nlet sharkTick (pos: Position) (age: int) (breedTime: int) (energy: int) (world: World) : (Position * Cell) list =\n    if energy &lt;= 0 then\n        // \u30a8\u30cd\u30eb\u30ae\u30fc\u5207\u308c\u3067\u6b7b\u4ea1\n        [ (pos, Cell.Water) ]\n    else\n        let fishNeighbors = World.getNeighborsOfType pos CellOps.isFish world\n        let emptyNeighbors = World.getNeighborsOfType pos CellOps.isWater world\n\n        match pickRandom fishNeighbors with\n        | Some fishPos -&gt;\n            // \u9b5a\u3092\u98df\u3079\u308b\n            let newEnergy = energy + world.SharkEnergyFromFish\n            if age + 1 &gt;= breedTime then\n                [ (pos, Cell.Shark(0, world.SharkBreedTime, world.SharkInitialEnergy))\n                  (fishPos, Cell.Shark(0, breedTime, newEnergy)) ]\n            else\n                [ (pos, Cell.Water)\n                  (fishPos, Cell.Shark(age + 1, breedTime, newEnergy)) ]\n        | None -&gt;\n            match pickRandom emptyNeighbors with\n            | Some newPos -&gt;\n                // \u79fb\u52d5\n                ...\n            | None -&gt;\n                // \u79fb\u52d5\u3067\u304d\u306a\u3044\n                [ (pos, Cell.Shark(age + 1, breedTime, energy - 1)) ]\n</code></pre>"},{"location":"fsharp/19-wator-simulation/#6","title":"6. \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u5b9f\u884c","text":"<pre><code>module Simulation =\n    /// 1\u30b9\u30c6\u30c3\u30d7\u5b9f\u884c\n    let tick (world: World) : World =\n        let mutable newWorld = world\n\n        // \u9b5a\u3092\u51e6\u7406\n        for pos in Map.toList world.Cells |&gt; List.map fst do\n            match World.getCell pos newWorld with\n            | Cell.Fish(age, breedTime) -&gt;\n                let updates = Rules.fishTick pos age breedTime newWorld\n                for (p, c) in updates do\n                    newWorld &lt;- World.setCell p c newWorld\n            | _ -&gt; ()\n\n        // \u30b5\u30e1\u3092\u51e6\u7406\n        for pos in Map.toList world.Cells |&gt; List.map fst do\n            match World.getCell pos newWorld with\n            | Cell.Shark(age, breedTime, energy) -&gt;\n                let updates = Rules.sharkTick pos age breedTime energy newWorld\n                for (p, c) in updates do\n                    newWorld &lt;- World.setCell p c newWorld\n            | _ -&gt; ()\n\n        newWorld\n\n    /// \u8907\u6570\u30b9\u30c6\u30c3\u30d7\u5b9f\u884c\n    let run (steps: int) (world: World) : World =\n        let rec loop n w =\n            if n &lt;= 0 then w\n            else loop (n - 1) (tick w)\n        loop steps world\n</code></pre>"},{"location":"fsharp/19-wator-simulation/#7","title":"7. \u8868\u793a","text":"<pre><code>module Display =\n    let cellToChar = function\n        | Cell.Water -&gt; '.'\n        | Cell.Fish _ -&gt; 'f'\n        | Cell.Shark _ -&gt; 'S'\n\n    let worldToString (world: World) : string =\n        let sb = System.Text.StringBuilder()\n        for y in 0..world.Height-1 do\n            for x in 0..world.Width-1 do\n                sb.Append(cellToChar (World.getCell (x, y) world)) |&gt; ignore\n            sb.AppendLine() |&gt; ignore\n        sb.ToString()\n</code></pre> <p>\u51fa\u529b\u4f8b\uff1a <pre><code>.....f....\n..S.......\n....f.....\n..f...S...\n..........\n</code></pre></p>"},{"location":"fsharp/19-wator-simulation/#8","title":"8. \u4f7f\u7528\u4f8b","text":"<pre><code>open FunctionalDesign.Part6.WaTorSimulation\n\n// 10x10 \u306e\u30ef\u30fc\u30eb\u30c9\u3092\u4f5c\u6210\nlet world = World.create 10 10\n\n// \u9b5a\u3068\u30b5\u30e1\u3092\u914d\u7f6e\nlet world' =\n    world\n    |&gt; World.placeFish (2, 2)\n    |&gt; World.placeFish (3, 3)\n    |&gt; World.placeFish (4, 4)\n    |&gt; World.placeShark (5, 5)\n    |&gt; World.placeShark (6, 6)\n\n// \u521d\u671f\u72b6\u614b\u3092\u8868\u793a\nprintfn \"%s\" (Display.worldToString world')\n\n// \u7d71\u8a08\u60c5\u5831\nlet (fishCount, sharkCount, waterCount) = World.getStats world'\nprintfn \"Fish: %d, Sharks: %d, Water: %d\" fishCount sharkCount waterCount\n\n// 10\u30b9\u30c6\u30c3\u30d7\u5b9f\u884c\nlet final = Simulation.run 10 world'\n\n// \u6700\u7d42\u72b6\u614b\u3092\u8868\u793a\nprintfn \"%s\" (Display.worldToString final)\n</code></pre>"},{"location":"fsharp/19-wator-simulation/#9","title":"9. \u751f\u614b\u7cfb\u306e\u30c0\u30a4\u30ca\u30df\u30af\u30b9","text":"<p>Wa-Tor \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u751f\u614b\u7cfb\u306e\u30c0\u30a4\u30ca\u30df\u30af\u30b9\u3092\u793a\u3057\u307e\u3059\uff1a</p> <p></p> <p>\u5178\u578b\u7684\u306a\u30b7\u30ca\u30ea\u30aa\uff1a 1. \u9b5a\u306e\u500b\u4f53\u6570\u304c\u5897\u52a0 2. \u30b5\u30e1\u306e\u990c\u304c\u5897\u3048\u3001\u30b5\u30e1\u3082\u5897\u52a0 3. \u30b5\u30e1\u304c\u5897\u3048\u3059\u304e\u3066\u9b5a\u304c\u6e1b\u5c11 4. \u990c\u4e0d\u8db3\u3067\u30b5\u30e1\u304c\u6e1b\u5c11 5. \u9b5a\u304c\u518d\u3073\u5897\u52a0\uff08\u30b5\u30a4\u30af\u30eb\u304c\u7e70\u308a\u8fd4\u3055\u308c\u308b\uff09</p>"},{"location":"fsharp/19-wator-simulation/#_8","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Wa-Tor \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u3092\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30bb\u30eb\u30aa\u30fc\u30c8\u30de\u30c8\u30f3: \u30b0\u30ea\u30c3\u30c9\u30d9\u30fc\u30b9\u306e\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3</li> <li>\u5224\u5225\u5171\u7528\u4f53: \u30bb\u30eb\u306e\u72b6\u614b\u3092\u578b\u5b89\u5168\u306b\u8868\u73fe</li> <li>\u30c8\u30fc\u30e9\u30b9\u5ea7\u6a19: \u30e2\u30b8\u30e5\u30ed\u6f14\u7b97\u306b\u3088\u308b\u30e9\u30c3\u30d7\u30a2\u30e9\u30a6\u30f3\u30c9</li> <li>\u751f\u614b\u7cfb\u30e2\u30c7\u30eb: \u6355\u98df\u8005-\u88ab\u98df\u8005\u30c0\u30a4\u30ca\u30df\u30af\u30b9</li> </ol>"},{"location":"fsharp/19-wator-simulation/#6_1","title":"\u7b2c6\u90e8\u306e\u307e\u3068\u3081","text":"<p>\u7b2c6\u90e8\u3067\u306f\u3001\u4e26\u884c\u51e6\u7406\u3068\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ul> <li>\u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0: \u72b6\u614b\u6a5f\u68b0\u3001\u30a4\u30d9\u30f3\u30c8\u30d0\u30b9\u3001MailboxProcessor</li> <li>Wa-Tor \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3: \u30bb\u30eb\u30aa\u30fc\u30c8\u30de\u30c8\u30f3\u3001\u751f\u614b\u7cfb\u30e2\u30c7\u30eb</li> </ul> <p>\u3053\u308c\u3089\u306e\u6280\u8853\u306f\u3001\u8907\u96d1\u306a\u30b7\u30b9\u30c6\u30e0\u306e\u30e2\u30c7\u30ea\u30f3\u30b0\u3068\u4e26\u884c\u51e6\u7406\u306e\u5b9f\u88c5\u306b\u5fdc\u7528\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"fsharp/19-wator-simulation/#_9","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/fsharp/part6/src/Library.fs</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/fsharp/part6/tests/Tests.fs</code></li> </ul>"},{"location":"fsharp/20-pattern-interactions/","title":"\u7b2c20\u7ae0: \u30d1\u30bf\u30fc\u30f3\u9593\u306e\u76f8\u4e92\u4f5c\u7528","text":""},{"location":"fsharp/20-pattern-interactions/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u306f\u5358\u72ec\u3067\u4f7f\u7528\u3055\u308c\u308b\u3053\u3068\u3082\u3042\u308a\u307e\u3059\u304c\u3001\u5b9f\u969b\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u306f\u8907\u6570\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u4e00\u822c\u7684\u3067\u3059\u3002\u672c\u7ae0\u3067\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u304a\u3051\u308b\u30d1\u30bf\u30fc\u30f3\u306e\u7d44\u307f\u5408\u308f\u305b\u65b9\u3068\u3001\u305d\u306e\u76f8\u4e57\u52b9\u679c\u306b\u3064\u3044\u3066\u89e3\u8aac\u3057\u307e\u3059\u3002</p>"},{"location":"fsharp/20-pattern-interactions/#_2","title":"\u5b66\u7fd2\u76ee\u6a19","text":"<ul> <li>Composite \u3068 Decorator \u30d1\u30bf\u30fc\u30f3\u306e\u7d44\u307f\u5408\u308f\u305b\u3092\u7406\u89e3\u3059\u308b</li> <li>Command \u3068 Observer \u30d1\u30bf\u30fc\u30f3\u306e\u9023\u643a\u3092\u5b9f\u88c5\u3059\u308b</li> <li>Strategy \u3068 Factory \u30d1\u30bf\u30fc\u30f3\u306e\u7d71\u5408\u3092\u5b66\u3076</li> </ul>"},{"location":"fsharp/20-pattern-interactions/#1-composite-decorator","title":"1. Composite + Decorator \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"fsharp/20-pattern-interactions/#_3","title":"\u57fa\u672c\u6982\u5ff5","text":"<p>Composite \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u6728\u69cb\u9020\u3067\u8868\u73fe\u3057\u3001\u500b\u5225\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u8907\u5408\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u540c\u4e00\u8996\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002</p> <p>Decorator \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u52d5\u7684\u306b\u6a5f\u80fd\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002</p> <p>\u3053\u308c\u3089\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u3053\u3068\u3067\u3001\u8907\u5408\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u5bfe\u3057\u3066\u3082\u88c5\u98fe\u3092\u9069\u7528\u3067\u304d\u307e\u3059\u3002</p> <p></p>"},{"location":"fsharp/20-pattern-interactions/#f","title":"F# \u3067\u306e\u5b9f\u88c5","text":"<pre><code>/// \u56f3\u5f62\uff08\u5224\u5225\u5171\u7528\u4f53\u3067 Composite + Decorator \u3092\u8868\u73fe\uff09\ntype Shape =\n    | Circle of x: float * y: float * radius: float\n    | Rectangle of x: float * y: float * width: float * height: float\n    | Composite of shapes: Shape list\n    | Journaled of shape: Shape * journal: string list\n    | Colored of shape: Shape * color: string\n    | Bordered of shape: Shape * borderWidth: float\n\nmodule Shape =\n    /// \u56f3\u5f62\u3092\u79fb\u52d5\uff08\u518d\u5e30\u7684\u306b\u9069\u7528\uff09\n    let rec move dx dy shape =\n        match shape with\n        | Circle(x, y, r) -&gt; Circle(x + dx, y + dy, r)\n        | Rectangle(x, y, w, h) -&gt; Rectangle(x + dx, y + dy, w, h)\n        | Composite shapes -&gt; Composite(shapes |&gt; List.map (move dx dy))\n        | Journaled(s, journal) -&gt;\n            Journaled(move dx dy s, sprintf \"moved(%.1f, %.1f)\" dx dy :: journal)\n        | Colored(s, c) -&gt; Colored(move dx dy s, c)\n        | Bordered(s, w) -&gt; Bordered(move dx dy s, w)\n\n    /// \u9762\u7a4d\u3092\u8a08\u7b97\uff08\u518d\u5e30\u7684\u306b\u9069\u7528\uff09\n    let rec area shape =\n        match shape with\n        | Circle(_, _, r) -&gt; System.Math.PI * r * r\n        | Rectangle(_, _, w, h) -&gt; w * h\n        | Composite shapes -&gt; shapes |&gt; List.sumBy area\n        | Journaled(s, _) -&gt; area s\n        | Colored(s, _) -&gt; area s\n        | Bordered(s, _) -&gt; area s\n</code></pre>"},{"location":"fsharp/20-pattern-interactions/#_4","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// \u8907\u5408\u56f3\u5f62\u3092\u4f5c\u6210\nlet scene = Shape.composite [\n    Shape.circle 0.0 0.0 5.0\n    Shape.rectangle 10.0 10.0 20.0 15.0\n]\n\n// \u30b8\u30e3\u30fc\u30ca\u30eb\u6a5f\u80fd\u3092\u8ffd\u52a0\nlet journaledScene = Shape.journaled scene\n\n// \u79fb\u52d5\u3068\u62e1\u5927\u3092\u5b9f\u884c\nlet final =\n    journaledScene\n    |&gt; Shape.move 5.0 5.0\n    |&gt; Shape.scale 2.0\n\n// \u5c65\u6b74\u3092\u78ba\u8a8d\nlet history = Shape.getJournal final\n// [\"scaled(2.0)\"; \"moved(5.0, 5.0)\"]\n</code></pre>"},{"location":"fsharp/20-pattern-interactions/#2-command-observer","title":"2. Command + Observer \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"fsharp/20-pattern-interactions/#_5","title":"\u57fa\u672c\u6982\u5ff5","text":"<p>Command \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u64cd\u4f5c\u3092\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u30ab\u30d7\u30bb\u30eb\u5316\u3057\u307e\u3059\u3002</p> <p>Observer \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u72b6\u614b\u5909\u66f4\u3092\u8cfc\u8aad\u8005\u306b\u901a\u77e5\u3057\u307e\u3059\u3002</p> <p>\u3053\u308c\u3089\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u3053\u3068\u3067\u3001\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u6642\u306b\u81ea\u52d5\u7684\u306b\u89b3\u5bdf\u8005\u3078\u901a\u77e5\u3067\u304d\u307e\u3059\u3002</p> <p></p>"},{"location":"fsharp/20-pattern-interactions/#f_1","title":"F# \u3067\u306e\u5b9f\u88c5","text":"<pre><code>/// \u30aa\u30d6\u30b6\u30fc\u30d0\u30d6\u30eb\ntype Observable&lt;'T&gt; =\n    { Observers: Observer&lt;'T&gt; list }\n\n/// \u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u5668\ntype CommandExecutor&lt;'TState&gt; =\n    { State: 'TState\n      History: (Command&lt;'TState&gt; * 'TState) list\n      Observable: Observable&lt;'TState&gt; }\n\nmodule CommandExecutor =\n    let execute (command: Command&lt;'TState&gt;) (executor: CommandExecutor&lt;'TState&gt;) =\n        match command with\n        | Execute(exec, _) -&gt;\n            let newState = exec executor.State\n            Observable.notify newState executor.Observable  // \u89b3\u5bdf\u8005\u306b\u901a\u77e5\n            { executor with\n                State = newState\n                History = (command, executor.State) :: executor.History }\n        | _ -&gt; executor\n\n    let subscribe (observer: Observer&lt;'TState&gt;) (executor: CommandExecutor&lt;'TState&gt;) =\n        { executor with Observable = Observable.subscribe observer executor.Observable }\n</code></pre>"},{"location":"fsharp/20-pattern-interactions/#_6","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// \u30ab\u30a6\u30f3\u30bf\u30fc\u306e\u4f8b\nlet mutable lastNotifiedValue = 0\nlet observer = fun v -&gt; lastNotifiedValue &lt;- v\n\nlet executor =\n    CommandExecutor.create 0\n    |&gt; CommandExecutor.subscribe observer\n\nlet addCommand = Execute((fun s -&gt; s + 10), \"add 10\")\nlet executor' = CommandExecutor.execute addCommand executor\n\n// lastNotifiedValue \u306f 10 \u306b\u306a\u308b\uff08\u81ea\u52d5\u901a\u77e5\uff09\n</code></pre>"},{"location":"fsharp/20-pattern-interactions/#3-strategy-factory","title":"3. Strategy + Factory \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"fsharp/20-pattern-interactions/#_7","title":"\u57fa\u672c\u6982\u5ff5","text":"<p>Strategy \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u30ab\u30d7\u30bb\u30eb\u5316\u3057\u3066\u4ea4\u63db\u53ef\u80fd\u306b\u3057\u307e\u3059\u3002</p> <p>Factory \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u751f\u6210\u3092\u30ab\u30d7\u30bb\u30eb\u5316\u3057\u307e\u3059\u3002</p> <p>\u3053\u308c\u3089\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u3053\u3068\u3067\u3001\u6761\u4ef6\u306b\u57fa\u3065\u3044\u3066\u9069\u5207\u306a\u6226\u7565\u3092\u81ea\u52d5\u9078\u629e\u3067\u304d\u307e\u3059\u3002</p> <p></p>"},{"location":"fsharp/20-pattern-interactions/#f_2","title":"F# \u3067\u306e\u5b9f\u88c5","text":"<pre><code>/// \u4fa1\u683c\u8a08\u7b97\u6226\u7565\ntype PricingStrategy =\n    | Regular\n    | Discount of rate: decimal\n    | Member of level: string\n    | Bulk of threshold: decimal * rate: decimal\n\n/// \u6226\u7565\u30d5\u30a1\u30af\u30c8\u30ea\nmodule PricingFactory =\n    let createFromCustomer (customerType: string) (purchaseAmount: decimal) : PricingStrategy =\n        match customerType with\n        | \"guest\" -&gt; Regular\n        | \"member\" -&gt; Member \"bronze\"\n        | \"vip\" -&gt; Member \"gold\"\n        | \"wholesale\" when purchaseAmount &gt; 10000m -&gt; Bulk(10000m, 0.15m)\n        | _ -&gt; Regular\n</code></pre>"},{"location":"fsharp/20-pattern-interactions/#_8","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// VIP \u9867\u5ba2\u306b\u306f\u81ea\u52d5\u7684\u306b\u30b4\u30fc\u30eb\u30c9\u4f1a\u54e1\u6226\u7565\u3092\u9069\u7528\nlet strategy = PricingFactory.createFromCustomer \"vip\" 5000m\nlet price = PricingStrategy.calculate strategy 1000m\n// 800m (20% \u5272\u5f15)\n\n// \u5378\u58f2\u696d\u8005\u3067\u5927\u53e3\u6ce8\u6587\u306b\u306f Bulk \u6226\u7565\u3092\u9069\u7528\nlet bulkStrategy = PricingFactory.createFromCustomer \"wholesale\" 15000m\nlet bulkPrice = PricingStrategy.calculate bulkStrategy 15000m\n// 12750m (15% \u5272\u5f15)\n</code></pre>"},{"location":"fsharp/20-pattern-interactions/#_9","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u30d1\u30bf\u30fc\u30f3\u9593\u306e\u76f8\u4e92\u4f5c\u7528\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>Composite + Decorator: \u8907\u5408\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3078\u306e\u52d5\u7684\u6a5f\u80fd\u8ffd\u52a0</li> <li>Command + Observer: \u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u3068\u81ea\u52d5\u901a\u77e5\u306e\u9023\u643a</li> <li>Strategy + Factory: \u6761\u4ef6\u306b\u57fa\u3065\u304f\u6226\u7565\u306e\u81ea\u52d5\u9078\u629e</li> </ol> <p>\u30d1\u30bf\u30fc\u30f3\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u3053\u3068\u3067\u3001\u3088\u308a\u67d4\u8edf\u3067\u4fdd\u5b88\u6027\u306e\u9ad8\u3044\u30b7\u30b9\u30c6\u30e0\u3092\u69cb\u7bc9\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"fsharp/20-pattern-interactions/#_10","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/fsharp/part7/src/Library.fs</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/fsharp/part7/tests/Tests.fs</code></li> </ul>"},{"location":"fsharp/21-best-practices/","title":"\u7b2c21\u7ae0: \u95a2\u6570\u578b\u30c7\u30b6\u30a4\u30f3\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9","text":""},{"location":"fsharp/21-best-practices/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u304a\u3051\u308b\u8a2d\u8a08\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3092\u4f53\u7cfb\u7684\u306b\u89e3\u8aac\u3057\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u539f\u5247\u306f\u3001\u4fdd\u5b88\u6027\u304c\u9ad8\u304f\u3001\u30c6\u30b9\u30c8\u3057\u3084\u3059\u3044\u3001\u5805\u7262\u306a\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u69cb\u7bc9\u3059\u308b\u305f\u3081\u306e\u6307\u91dd\u3068\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"fsharp/21-best-practices/#_2","title":"\u5b66\u7fd2\u76ee\u6a19","text":"<ul> <li>\u30c7\u30fc\u30bf\u4e2d\u5fc3\u8a2d\u8a08\u306e\u539f\u5247\u3092\u7406\u89e3\u3059\u308b</li> <li>\u7d14\u7c8b\u95a2\u6570\u3068\u526f\u4f5c\u7528\u306e\u5206\u96e2\u65b9\u6cd5\u3092\u5b66\u3076</li> <li>\u30c6\u30b9\u30c8\u53ef\u80fd\u306a\u8a2d\u8a08\u30d1\u30bf\u30fc\u30f3\u3092\u7fd2\u5f97\u3059\u308b</li> </ul>"},{"location":"fsharp/21-best-practices/#1","title":"1. \u30c7\u30fc\u30bf\u4e2d\u5fc3\u8a2d\u8a08","text":""},{"location":"fsharp/21-best-practices/#_3","title":"\u57fa\u672c\u539f\u5247","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u30c7\u30fc\u30bf\u304c\u4e3b\u5f79\u3067\u3059\u3002\u307e\u305a\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u8a2d\u8a08\u3057\u3001\u305d\u306e\u30c7\u30fc\u30bf\u3092\u5909\u63db\u3059\u308b\u95a2\u6570\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002</p> <p></p>"},{"location":"fsharp/21-best-practices/#_4","title":"\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u5b9a\u7fa9","text":"<pre><code>/// \u30e6\u30fc\u30b6\u30fc\ntype User =\n    { Id: string\n      Name: string\n      Email: string\n      CreatedAt: System.DateTime }\n\n/// \u6ce8\u6587\ntype Order =\n    { Id: string\n      UserId: string\n      Items: OrderItem list\n      Status: OrderStatus\n      CreatedAt: System.DateTime }\n\nand OrderItem =\n    { ProductId: string\n      Quantity: int\n      Price: decimal }\n\nand OrderStatus =\n    | Pending\n    | Confirmed\n    | Shipped\n    | Delivered\n    | Cancelled\n</code></pre> <p>\u30dd\u30a4\u30f3\u30c8: - \u30d7\u30ec\u30fc\u30f3\u306a\u30ec\u30b3\u30fc\u30c9\u3092\u4f7f\u7528\uff08\u30af\u30e9\u30b9\u3067\u306f\u306a\u304f\uff09 - \u5fc5\u8981\u6700\u5c0f\u9650\u306e\u30d5\u30a3\u30fc\u30eb\u30c9 - \u660e\u78ba\u306a\u547d\u540d</p>"},{"location":"fsharp/21-best-practices/#_5","title":"\u5c0f\u3055\u306a\u7d14\u7c8b\u95a2\u6570","text":"<pre><code>module Order =\n    // \u5404\u95a2\u6570\u306f\u5358\u4e00\u306e\u8cac\u4efb\u3092\u6301\u3064\n    let calculateItemTotal (item: OrderItem) =\n        decimal item.Quantity * item.Price\n\n    let calculateTotal (order: Order) =\n        order.Items |&gt; List.sumBy calculateItemTotal\n\n    let applyDiscount (rate: decimal) (total: decimal) =\n        total * (1m - rate)\n</code></pre> <p>\u539f\u5247: - 1\u3064\u306e\u95a2\u6570\u306f1\u3064\u306e\u3053\u3068\u3092\u884c\u3046 - \u5165\u529b\u304b\u3089\u51fa\u529b\u3078\u306e\u7d14\u7c8b\u306a\u5909\u63db - \u526f\u4f5c\u7528\u306a\u3057</p>"},{"location":"fsharp/21-best-practices/#2","title":"2. \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u51e6\u7406","text":""},{"location":"fsharp/21-best-practices/#_6","title":"\u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3","text":"<pre><code>module Pipeline =\n    /// \u6ce8\u6587\u51e6\u7406\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\n    let processOrder (discountRate: decimal) (order: Order) =\n        order\n        |&gt; Order.calculateTotal\n        |&gt; Order.applyDiscount discountRate\n\n    /// \u6ce8\u6587\u30b9\u30c6\u30fc\u30bf\u30b9\u306e\u9077\u79fb\n    let confirm (order: Order) =\n        { order with Status = Confirmed }\n\n    let ship (order: Order) =\n        match order.Status with\n        | Confirmed -&gt; { order with Status = Shipped }\n        | _ -&gt; order\n\n    let deliver (order: Order) =\n        match order.Status with\n        | Shipped -&gt; { order with Status = Delivered }\n        | _ -&gt; order\n</code></pre>"},{"location":"fsharp/21-best-practices/#_7","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>let order = Order.create \"O001\" \"U001\" items\n\nlet finalPrice =\n    order\n    |&gt; Pipeline.processOrder 0.10m\n\nlet shippedOrder =\n    order\n    |&gt; Pipeline.confirm\n    |&gt; Pipeline.ship\n</code></pre>"},{"location":"fsharp/21-best-practices/#3-result","title":"3. Result \u578b\u306b\u3088\u308b\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0","text":""},{"location":"fsharp/21-best-practices/#_8","title":"\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3","text":"<pre><code>module Validation =\n    type ValidationError =\n        | InvalidEmail of string\n        | InvalidName of string\n        | InvalidQuantity of string\n        | InvalidPrice of string\n\n    let validateEmail (email: string) : Result&lt;string, ValidationError&gt; =\n        if email.Contains(\"@\") then Ok email\n        else Error (InvalidEmail \"Email must contain @\")\n\n    let validateName (name: string) : Result&lt;string, ValidationError&gt; =\n        if String.length name &gt;= 2 then Ok name\n        else Error (InvalidName \"Name must be at least 2 characters\")\n\n    let validateQuantity (qty: int) : Result&lt;int, ValidationError&gt; =\n        if qty &gt; 0 then Ok qty\n        else Error (InvalidQuantity \"Quantity must be positive\")\n</code></pre>"},{"location":"fsharp/21-best-practices/#result","title":"Result \u306e\u9023\u9396","text":"<pre><code>    /// Result \u3092\u9023\u9396\u3055\u305b\u308b\u30d8\u30eb\u30d1\u30fc\n    let bind (f: 'a -&gt; Result&lt;'b, 'e&gt;) (result: Result&lt;'a, 'e&gt;) : Result&lt;'b, 'e&gt; =\n        match result with\n        | Ok v -&gt; f v\n        | Error e -&gt; Error e\n\n    /// \u8907\u6570\u306e\u691c\u8a3c\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\n    let validateOrderItem (productId: string) (qty: int) (price: decimal) =\n        validateQuantity qty\n        |&gt; bind (fun q -&gt;\n            validatePrice price\n            |&gt; Result.map (fun p -&gt; { ProductId = productId; Quantity = q; Price = p }))\n</code></pre>"},{"location":"fsharp/21-best-practices/#4","title":"4. \u526f\u4f5c\u7528\u306e\u5206\u96e2","text":""},{"location":"fsharp/21-best-practices/#_9","title":"\u7d14\u7c8b\u306a\u8a08\u7b97\u90e8\u5206","text":"<pre><code>/// \u7d14\u7c8b\u95a2\u6570\uff08\u526f\u4f5c\u7528\u306a\u3057\uff09\nmodule Pure =\n    let calculateTax (rate: decimal) (amount: decimal) =\n        amount * rate\n\n    let formatCurrency (amount: decimal) =\n        sprintf \"$%.2f\" amount\n\n    let generateInvoiceText (order: Order) (total: decimal) (tax: decimal) =\n        let lines =\n            order.Items\n            |&gt; List.map (fun item -&gt;\n                sprintf \"%s x %d @ $%.2f = $%.2f\"\n                    item.ProductId item.Quantity item.Price\n                    (decimal item.Quantity * item.Price))\n        let header = sprintf \"Invoice for Order %s\" order.Id\n        let subtotal = sprintf \"Subtotal: $%.2f\" total\n        let taxLine = sprintf \"Tax: $%.2f\" tax\n        let totalLine = sprintf \"Total: $%.2f\" (total + tax)\n        String.concat \"\\n\" (header :: lines @ [subtotal; taxLine; totalLine])\n</code></pre>"},{"location":"fsharp/21-best-practices/#_10","title":"\u526f\u4f5c\u7528\u3092\u6301\u3064\u90e8\u5206\uff08\u5883\u754c\uff09","text":"<pre><code>/// \u526f\u4f5c\u7528\u3092\u6301\u3064\u90e8\u5206\uff08\u30b7\u30b9\u30c6\u30e0\u306e\u5883\u754c\u306b\u914d\u7f6e\uff09\nmodule Effects =\n    /// \u30ed\u30b0\u51fa\u529b\uff08\u526f\u4f5c\u7528\uff09\n    let log (message: string) =\n        printfn \"[LOG] %s\" message\n\n    /// \u901a\u77e5\u9001\u4fe1\uff08\u526f\u4f5c\u7528\uff09\n    type Notification =\n        { Recipient: string\n          Subject: string\n          Body: string }\n\n    let sendNotification (notification: Notification) =\n        printfn \"[NOTIFICATION] To: %s, Subject: %s\"\n            notification.Recipient notification.Subject\n</code></pre>"},{"location":"fsharp/21-best-practices/#_11","title":"\u69cb\u9020\u56f3","text":""},{"location":"fsharp/21-best-practices/#5","title":"5. \u30c6\u30b9\u30c8\u53ef\u80fd\u306a\u8a2d\u8a08","text":""},{"location":"fsharp/21-best-practices/#_12","title":"\u539f\u5247","text":"<ol> <li>\u7d14\u7c8b\u95a2\u6570\u3092\u5897\u3084\u3059: \u30c6\u30b9\u30c8\u304c\u7c21\u5358</li> <li>\u4f9d\u5b58\u6027\u3092\u6ce8\u5165: \u30e2\u30c3\u30af\u53ef\u80fd</li> <li>\u5c0f\u3055\u306a\u95a2\u6570: \u5358\u4f53\u30c6\u30b9\u30c8\u304c\u5bb9\u6613</li> </ol>"},{"location":"fsharp/21-best-practices/#_13","title":"\u30c6\u30b9\u30c8\u4f8b","text":"<pre><code>[&lt;Fact&gt;]\nlet ``\u6ce8\u6587\u306e\u5408\u8a08\u91d1\u984d\u3092\u8a08\u7b97\u3067\u304d\u308b`` () =\n    let items = [\n        { ProductId = \"P001\"; Quantity = 2; Price = 100m }\n        { ProductId = \"P002\"; Quantity = 3; Price = 50m }\n    ]\n    let order = Order.create \"O001\" \"U001\" items\n    let total = Order.calculateTotal order\n    Assert.Equal(350m, total)\n\n[&lt;Fact&gt;]\nlet ``\u6709\u52b9\u306a\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u3092\u691c\u8a3c\u3067\u304d\u308b`` () =\n    let result = Validation.validateEmail \"test@example.com\"\n    Assert.True(Result.isOk result)\n</code></pre>"},{"location":"fsharp/21-best-practices/#_14","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u95a2\u6570\u578b\u30c7\u30b6\u30a4\u30f3\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3092\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30c7\u30fc\u30bf\u4e2d\u5fc3\u8a2d\u8a08: \u30c7\u30fc\u30bf\u69cb\u9020\u3092\u5148\u306b\u3001\u95a2\u6570\u3092\u5f8c\u306b</li> <li>\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u51e6\u7406: <code>|&gt;</code> \u3067\u30c7\u30fc\u30bf\u3092\u5909\u63db</li> <li>Result \u578b: \u30a8\u30e9\u30fc\u3092\u5024\u3068\u3057\u3066\u6271\u3046</li> <li>\u526f\u4f5c\u7528\u306e\u5206\u96e2: \u7d14\u7c8b\u306a\u8a08\u7b97\u3068\u30b7\u30a7\u30eb\u306e\u5206\u96e2</li> <li>\u30c6\u30b9\u30c8\u53ef\u80fd\u306a\u8a2d\u8a08: \u7d14\u7c8b\u95a2\u6570\u3068\u4f9d\u5b58\u6027\u6ce8\u5165</li> </ol> <p>\u3053\u308c\u3089\u306e\u539f\u5247\u306b\u5f93\u3046\u3053\u3068\u3067\u3001\u4fdd\u5b88\u6027\u304c\u9ad8\u304f\u3001\u30c6\u30b9\u30c8\u3057\u3084\u3059\u3044\u30b3\u30fc\u30c9\u3092\u66f8\u304f\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"fsharp/21-best-practices/#_15","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/fsharp/part7/src/Library.fs</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/fsharp/part7/tests/Tests.fs</code></li> </ul>"},{"location":"fsharp/22-oo-to-fp-migration/","title":"\u7b2c22\u7ae0: \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u304b\u3089\u95a2\u6570\u578b\u3078\u306e\u79fb\u884c","text":""},{"location":"fsharp/22-oo-to-fp-migration/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\uff08OO\uff09\u30b9\u30bf\u30a4\u30eb\u306e\u30b3\u30fc\u30c9\u3092\u95a2\u6570\u578b\uff08FP\uff09\u30b9\u30bf\u30a4\u30eb\u306b\u79fb\u884c\u3059\u308b\u305f\u3081\u306e\u6226\u7565\u3068\u30c6\u30af\u30cb\u30c3\u30af\u3092\u89e3\u8aac\u3057\u307e\u3059\u3002\u6bb5\u968e\u7684\u306a\u30a2\u30d7\u30ed\u30fc\u30c1\u306b\u3088\u308a\u3001\u65e2\u5b58\u306e\u30b3\u30fc\u30c9\u30d9\u30fc\u30b9\u3092\u5b89\u5168\u306b\u95a2\u6570\u578b\u306b\u79fb\u884c\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"fsharp/22-oo-to-fp-migration/#_2","title":"\u5b66\u7fd2\u76ee\u6a19","text":"<ul> <li>OO \u3068 FP \u306e\u6839\u672c\u7684\u306a\u9055\u3044\u3092\u7406\u89e3\u3059\u308b</li> <li>\u6bb5\u968e\u7684\u306a\u79fb\u884c\u6226\u7565\u3092\u5b66\u3076</li> <li>\u5b9f\u8df5\u7684\u306a\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u30d1\u30bf\u30fc\u30f3\u3092\u7fd2\u5f97\u3059\u308b</li> </ul>"},{"location":"fsharp/22-oo-to-fp-migration/#1-oo-fp","title":"1. OO \u3068 FP \u306e\u5bfe\u6bd4","text":""},{"location":"fsharp/22-oo-to-fp-migration/#_3","title":"\u30d1\u30e9\u30c0\u30a4\u30e0\u306e\u9055\u3044","text":"\u6982\u5ff5 \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411 \u95a2\u6570\u578b \u57fa\u672c\u5358\u4f4d \u30aa\u30d6\u30b8\u30a7\u30af\u30c8 \u30c7\u30fc\u30bf + \u95a2\u6570 \u72b6\u614b\u7ba1\u7406 \u53ef\u5909\uff08mutable\uff09 \u4e0d\u5909\uff08immutable\uff09 \u591a\u614b\u6027 \u7d99\u627f\u30fb\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9 \u5224\u5225\u5171\u7528\u4f53\u30fb\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0 \u30b3\u30fc\u30c9\u518d\u5229\u7528 \u7d99\u627f \u95a2\u6570\u5408\u6210 \u526f\u4f5c\u7528 \u3069\u3053\u3067\u3082\u53ef\u80fd \u5883\u754c\u306b\u5206\u96e2"},{"location":"fsharp/22-oo-to-fp-migration/#2-oo-fp","title":"2. OO \u30b9\u30bf\u30a4\u30eb \u2192 FP \u30b9\u30bf\u30a4\u30eb","text":""},{"location":"fsharp/22-oo-to-fp-migration/#before-oo","title":"Before: OO \u30b9\u30bf\u30a4\u30eb\uff08\u53ef\u5909\u72b6\u614b\u3092\u6301\u3064\uff09","text":"<pre><code>/// OO \u30b9\u30bf\u30a4\u30eb\u306e\u9280\u884c\u53e3\u5ea7\ntype AccountOO(id: string, initialBalance: decimal) =\n    let mutable balance = initialBalance\n    let mutable transactions: (string * decimal * System.DateTime) list = []\n\n    member _.Id = id\n    member _.Balance = balance\n\n    member _.Deposit(amount: decimal) =\n        if amount &gt; 0m then\n            balance &lt;- balance + amount\n            transactions &lt;- (\"deposit\", amount, System.DateTime.UtcNow) :: transactions\n            true\n        else false\n\n    member _.Withdraw(amount: decimal) =\n        if amount &gt; 0m &amp;&amp; balance &gt;= amount then\n            balance &lt;- balance - amount\n            transactions &lt;- (\"withdrawal\", amount, System.DateTime.UtcNow) :: transactions\n            true\n        else false\n</code></pre> <p>\u554f\u984c\u70b9: - \u5185\u90e8\u72b6\u614b\u304c\u53ef\u5909 - \u30c6\u30b9\u30c8\u304c\u56f0\u96e3\uff08\u72b6\u614b\u306b\u4f9d\u5b58\uff09 - \u5c65\u6b74\u306e\u8ffd\u8de1\u304c\u96e3\u3057\u3044 - \u4e26\u884c\u51e6\u7406\u306b\u5f31\u3044</p>"},{"location":"fsharp/22-oo-to-fp-migration/#after-fp","title":"After: FP \u30b9\u30bf\u30a4\u30eb\uff08\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\uff09","text":"<pre><code>/// \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\ntype Transaction =\n    { Type: TransactionType\n      Amount: decimal\n      Timestamp: System.DateTime }\n\nand TransactionType =\n    | Deposit\n    | Withdrawal\n\n/// \u53e3\u5ea7\uff08\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\uff09\ntype Account =\n    { Id: string\n      Balance: decimal\n      Transactions: Transaction list }\n\nmodule Account =\n    /// \u53e3\u5ea7\u3092\u4f5c\u6210\n    let create (id: string) (initialBalance: decimal) : Account =\n        { Id = id\n          Balance = initialBalance\n          Transactions = [] }\n\n    /// \u5165\u91d1\uff08\u65b0\u3057\u3044\u53e3\u5ea7\u3092\u8fd4\u3059\uff09\n    let deposit (amount: decimal) (account: Account) : Result&lt;Account, string&gt; =\n        if amount &gt; 0m then\n            let tx = { Type = Deposit; Amount = amount; Timestamp = System.DateTime.UtcNow }\n            Ok { account with\n                    Balance = account.Balance + amount\n                    Transactions = tx :: account.Transactions }\n        else Error \"Amount must be positive\"\n\n    /// \u51fa\u91d1\uff08\u65b0\u3057\u3044\u53e3\u5ea7\u3092\u8fd4\u3059\uff09\n    let withdraw (amount: decimal) (account: Account) : Result&lt;Account, string&gt; =\n        if amount &lt;= 0m then\n            Error \"Amount must be positive\"\n        elif amount &gt; account.Balance then\n            Error \"Insufficient balance\"\n        else\n            let tx = { Type = Withdrawal; Amount = amount; Timestamp = System.DateTime.UtcNow }\n            Ok { account with\n                    Balance = account.Balance - amount\n                    Transactions = tx :: account.Transactions }\n</code></pre> <p>\u6539\u5584\u70b9: - \u72b6\u614b\u304c\u4e0d\u5909 - \u5143\u306e\u30c7\u30fc\u30bf\u306f\u5909\u66f4\u3055\u308c\u306a\u3044 - Result \u578b\u3067\u30a8\u30e9\u30fc\u3092\u8868\u73fe - \u30c6\u30b9\u30c8\u304c\u5bb9\u6613 - \u4e26\u884c\u51e6\u7406\u306b\u9069\u3057\u3066\u3044\u308b</p>"},{"location":"fsharp/22-oo-to-fp-migration/#3","title":"3. \u7d99\u627f\u304b\u3089\u30b3\u30f3\u30dd\u30b8\u30b7\u30e7\u30f3\u3078","text":""},{"location":"fsharp/22-oo-to-fp-migration/#before","title":"Before: \u7d99\u627f\u30d9\u30fc\u30b9","text":"<pre><code>// OO \u30b9\u30bf\u30a4\u30eb\uff08\u64ec\u4f3c\u30b3\u30fc\u30c9\uff09\n// abstract class Animal\n//   def speak(): String\n// class Dog extends Animal\n//   override def speak() = \"Woof\"\n// class Cat extends Animal\n//   override def speak() = \"Meow\"\n</code></pre>"},{"location":"fsharp/22-oo-to-fp-migration/#after","title":"After: \u5224\u5225\u5171\u7528\u4f53 + \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0","text":"<pre><code>type Animal =\n    | Dog of name: string\n    | Cat of name: string\n    | Bird of name: string\n\nlet speak (animal: Animal) : string =\n    match animal with\n    | Dog _ -&gt; \"Woof\"\n    | Cat _ -&gt; \"Meow\"\n    | Bird _ -&gt; \"Tweet\"\n\nlet getName (animal: Animal) : string =\n    match animal with\n    | Dog name -&gt; name\n    | Cat name -&gt; name\n    | Bird name -&gt; name\n</code></pre> <p>\u5229\u70b9: - \u65b0\u3057\u3044\u52d5\u7269\u3092\u8ffd\u52a0\u3059\u308b\u3068\u3001\u30b3\u30f3\u30d1\u30a4\u30e9\u304c\u3059\u3079\u3066\u306e <code>match</code> \u3092\u66f4\u65b0\u3059\u308b\u3088\u3046\u8b66\u544a - \u95a2\u6570\u3092\u8ffd\u52a0\u3057\u3066\u3082\u65e2\u5b58\u306e\u30b3\u30fc\u30c9\u306b\u5f71\u97ff\u306a\u3057 - \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u306b\u3088\u308b\u7db2\u7f85\u6027\u30c1\u30a7\u30c3\u30af</p>"},{"location":"fsharp/22-oo-to-fp-migration/#4","title":"4. \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u304b\u3089\u95a2\u6570\u30ec\u30b3\u30fc\u30c9\u3078","text":""},{"location":"fsharp/22-oo-to-fp-migration/#before_1","title":"Before: \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9","text":"<pre><code>// OO \u30b9\u30bf\u30a4\u30eb\n// interface IRepository&lt;T&gt;\n//   def findById(id: String): Option&lt;T&gt;\n//   def save(entity: T): T\n//   def delete(id: String): Boolean\n</code></pre>"},{"location":"fsharp/22-oo-to-fp-migration/#after_1","title":"After: \u95a2\u6570\u306e\u30ec\u30b3\u30fc\u30c9","text":"<pre><code>type Repository&lt;'T&gt; =\n    { FindById: string -&gt; 'T option\n      Save: 'T -&gt; 'T\n      Delete: string -&gt; bool }\n\n/// \u30a4\u30f3\u30e1\u30e2\u30ea\u30ea\u30dd\u30b8\u30c8\u30ea\u3092\u4f5c\u6210\nlet createInMemoryRepo&lt;'T&gt; (getId: 'T -&gt; string) : Repository&lt;'T&gt; =\n    let mutable data: Map&lt;string, 'T&gt; = Map.empty\n    { FindById = fun id -&gt; Map.tryFind id data\n      Save = fun entity -&gt;\n          let id = getId entity\n          data &lt;- Map.add id entity data\n          entity\n      Delete = fun id -&gt;\n          if Map.containsKey id data then\n              data &lt;- Map.remove id data\n              true\n          else false }\n</code></pre> <p>\u5229\u70b9: - \u30c6\u30b9\u30c8\u7528\u306e\u30e2\u30c3\u30af\u304c\u7c21\u5358 - \u90e8\u5206\u7684\u306a\u5b9f\u88c5\u304c\u53ef\u80fd - \u95a2\u6570\u3092\u5f15\u6570\u3068\u3057\u3066\u6e21\u305b\u308b</p>"},{"location":"fsharp/22-oo-to-fp-migration/#5","title":"5. \u30a4\u30d9\u30f3\u30c8\u30bd\u30fc\u30b7\u30f3\u30b0\u3078\u306e\u79fb\u884c","text":""},{"location":"fsharp/22-oo-to-fp-migration/#_4","title":"\u5f93\u6765\u306e\u53ef\u5909\u72b6\u614b","text":"<pre><code>// \u72b6\u614b\u3092\u76f4\u63a5\u5909\u66f4\naccount.Deposit(100m)\naccount.Withdraw(50m)\n// \u4f55\u304c\u8d77\u304d\u305f\u304b\u306e\u5c65\u6b74\u306f\u5931\u308f\u308c\u308b\n</code></pre>"},{"location":"fsharp/22-oo-to-fp-migration/#_5","title":"\u30a4\u30d9\u30f3\u30c8\u30bd\u30fc\u30b7\u30f3\u30b0","text":"<pre><code>/// \u30a4\u30d9\u30f3\u30c8\ntype AccountEvent =\n    | AccountCreated of id: string * initialBalance: decimal\n    | MoneyDeposited of amount: decimal\n    | MoneyWithdrawn of amount: decimal\n\n/// \u30a4\u30d9\u30f3\u30c8\u3092\u9069\u7528\u3057\u3066\u72b6\u614b\u3092\u518d\u69cb\u7bc9\nlet applyEvent (state: Account) (event: AccountEvent) : Account =\n    match event with\n    | AccountCreated(id, balance) -&gt;\n        { Id = id; Balance = balance; Transactions = [] }\n    | MoneyDeposited amount -&gt;\n        let tx = { Type = Deposit; Amount = amount; Timestamp = System.DateTime.UtcNow }\n        { state with Balance = state.Balance + amount; Transactions = tx :: state.Transactions }\n    | MoneyWithdrawn amount -&gt;\n        let tx = { Type = Withdrawal; Amount = amount; Timestamp = System.DateTime.UtcNow }\n        { state with Balance = state.Balance - amount; Transactions = tx :: state.Transactions }\n\n/// \u30a4\u30d9\u30f3\u30c8\u30ea\u30b9\u30c8\u304b\u3089\u72b6\u614b\u3092\u518d\u69cb\u7bc9\nlet replay (events: AccountEvent list) : Account =\n    let initial = { Id = \"\"; Balance = 0m; Transactions = [] }\n    List.fold applyEvent initial events\n</code></pre> <p>\u5229\u70b9: - \u5b8c\u5168\u306a\u5c65\u6b74\u3092\u4fdd\u6301 - \u4efb\u610f\u306e\u6642\u70b9\u306e\u72b6\u614b\u3092\u518d\u69cb\u7bc9\u53ef\u80fd - \u76e3\u67fb\u30ed\u30b0\u3068\u3057\u3066\u4f7f\u7528\u53ef\u80fd - \u30c7\u30d0\u30c3\u30b0\u304c\u5bb9\u6613</p>"},{"location":"fsharp/22-oo-to-fp-migration/#6","title":"6. \u79fb\u884c\u6226\u7565","text":""},{"location":"fsharp/22-oo-to-fp-migration/#_6","title":"\u6bb5\u968e\u7684\u30a2\u30d7\u30ed\u30fc\u30c1","text":"<ol> <li>\u65b0\u3057\u3044\u30b3\u30fc\u30c9\u306f FP \u3067\u66f8\u304f</li> <li>\u65e2\u5b58\u30b3\u30fc\u30c9\u306e\u5883\u754c\u306b\u7d14\u7c8b\u95a2\u6570\u3092\u8ffd\u52a0</li> <li>\u53ef\u5909\u72b6\u614b\u3092\u6e1b\u3089\u3057\u3066\u3044\u304f</li> <li>\u30c6\u30b9\u30c8\u3092\u8ffd\u52a0\u3057\u306a\u304c\u3089\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0</li> </ol>"},{"location":"fsharp/22-oo-to-fp-migration/#_7","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001OO \u304b\u3089 FP \u3078\u306e\u79fb\u884c\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u53ef\u5909\u72b6\u614b \u2192 \u4e0d\u5909\u30c7\u30fc\u30bf: \u30ec\u30b3\u30fc\u30c9\u578b\u3068 <code>with</code> \u30ad\u30fc\u30ef\u30fc\u30c9</li> <li>\u7d99\u627f \u2192 \u5224\u5225\u5171\u7528\u4f53: \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u306b\u3088\u308b\u591a\u614b\u6027</li> <li>\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9 \u2192 \u95a2\u6570\u30ec\u30b3\u30fc\u30c9: \u67d4\u8edf\u306a\u4f9d\u5b58\u6027\u6ce8\u5165</li> <li>\u72b6\u614b\u5909\u66f4 \u2192 \u30a4\u30d9\u30f3\u30c8\u30bd\u30fc\u30b7\u30f3\u30b0: \u5b8c\u5168\u306a\u5c65\u6b74\u4fdd\u6301</li> </ol>"},{"location":"fsharp/22-oo-to-fp-migration/#7","title":"\u7b2c7\u90e8\u306e\u307e\u3068\u3081","text":"<p>\u7b2c7\u90e8\u3067\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u5b9f\u8df5\u7684\u306a\u6280\u8853\u3092\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ul> <li>\u30d1\u30bf\u30fc\u30f3\u9593\u306e\u76f8\u4e92\u4f5c\u7528: \u8907\u6570\u30d1\u30bf\u30fc\u30f3\u306e\u7d44\u307f\u5408\u308f\u305b</li> <li>\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9: \u30c7\u30fc\u30bf\u4e2d\u5fc3\u8a2d\u8a08\u3001\u526f\u4f5c\u7528\u306e\u5206\u96e2</li> <li>OO \u304b\u3089 FP \u3078\u306e\u79fb\u884c: \u6bb5\u968e\u7684\u306a\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0</li> </ul> <p>\u3053\u308c\u3089\u306e\u77e5\u8b58\u3092\u6d3b\u7528\u3057\u3066\u3001\u4fdd\u5b88\u6027\u304c\u9ad8\u304f\u3001\u30c6\u30b9\u30c8\u3057\u3084\u3059\u3044\u3001\u5805\u7262\u306a\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u69cb\u7bc9\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"fsharp/22-oo-to-fp-migration/#_8","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/fsharp/part7/src/Library.fs</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/fsharp/part7/tests/Tests.fs</code></li> </ul>"},{"location":"haskell/","title":"Haskell \u306b\u3088\u308b\u95a2\u6570\u578b\u30c7\u30b6\u30a4\u30f3","text":""},{"location":"haskell/#_1","title":"\u6982\u8981","text":"<p>\u672c\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u306f\u3001Robert C. Martin \u306e\u300cFunctional Design: Principles, Patterns, and Practices\u300d\u3067\u7d39\u4ecb\u3055\u308c\u3066\u3044\u308b\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u539f\u5247\u3068\u30d1\u30bf\u30fc\u30f3\u3092 Haskell \u3067\u5b9f\u88c5\u3057\u307e\u3059\u3002</p> <p>Haskell \u306f\u7d14\u7c8b\u95a2\u6570\u578b\u8a00\u8a9e\u3068\u3057\u3066\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u6982\u5ff5\u3092\u6700\u3082\u76f4\u63a5\u7684\u306b\u8868\u73fe\u3067\u304d\u308b\u8a00\u8a9e\u306e\u4e00\u3064\u3067\u3059\u3002\u9045\u5ef6\u8a55\u4fa1\u3001\u5f37\u3044\u578b\u30b7\u30b9\u30c6\u30e0\u3001\u578b\u30af\u30e9\u30b9\u306a\u3069\u306e\u7279\u5fb4\u306b\u3088\u308a\u3001\u62bd\u8c61\u5ea6\u306e\u9ad8\u3044\u30b3\u30fc\u30c9\u3092\u5b89\u5168\u306b\u8a18\u8ff0\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"haskell/#_2","title":"\u69cb\u6210","text":""},{"location":"haskell/#1chapters-1-3","title":"\u7b2c1\u90e8\uff1a\u57fa\u790e\u539f\u5247\uff08Chapters 1-3\uff09","text":"<ol> <li>\u4e0d\u5909\u6027\u3068\u30c7\u30fc\u30bf\u5909\u63db - \u30ec\u30b3\u30fc\u30c9\u3001\u69cb\u9020\u5171\u6709\u3001\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3</li> <li>\u95a2\u6570\u5408\u6210\u3068\u9ad8\u968e\u95a2\u6570 - (.)\u3001(&gt;&gt;&gt;)\u3001\u30ab\u30ea\u30fc\u5316\u3001\u90e8\u5206\u9069\u7528</li> <li>\u591a\u614b\u6027\u3068\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1 - ADT\u3001\u578b\u30af\u30e9\u30b9\u3001\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1</li> </ol>"},{"location":"haskell/#2chapters-4-6","title":"\u7b2c2\u90e8\uff1a\u4ed5\u69d8\u3068\u30c6\u30b9\u30c8\uff08Chapters 4-6\uff09","text":"<ol> <li>\u30c7\u30fc\u30bf\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3 - \u30ab\u30b9\u30bf\u30e0\u30d0\u30ea\u30c7\u30fc\u30bf\u3001Applicative \u30b9\u30bf\u30a4\u30eb</li> <li>\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8 - QuickCheck</li> <li>TDD \u3068\u95a2\u6570\u578b - HSpec \u306b\u3088\u308b\u30c6\u30b9\u30c8\u99c6\u52d5\u958b\u767a</li> </ol>"},{"location":"haskell/#3chapters-7-9","title":"\u7b2c3\u90e8\uff1a\u69cb\u9020\u30d1\u30bf\u30fc\u30f3\uff08Chapters 7-9\uff09","text":"<ol> <li>Composite \u30d1\u30bf\u30fc\u30f3 - \u518d\u5e30\u7684\u30c7\u30fc\u30bf\u69cb\u9020</li> <li>Decorator \u30d1\u30bf\u30fc\u30f3 - \u95a2\u6570\u30e9\u30c3\u30d1\u30fc</li> <li>Adapter \u30d1\u30bf\u30fc\u30f3 - \u578b\u5909\u63db\u3001newtypes</li> </ol>"},{"location":"haskell/#4chapters-10-14","title":"\u7b2c4\u90e8\uff1a\u632f\u308b\u821e\u3044\u30d1\u30bf\u30fc\u30f3\uff08Chapters 10-14\uff09","text":"<ol> <li>Strategy \u30d1\u30bf\u30fc\u30f3 - \u9ad8\u968e\u95a2\u6570\u306b\u3088\u308b\u6226\u7565\u5207\u308a\u66ff\u3048</li> <li>Command \u30d1\u30bf\u30fc\u30f3 - \u30c7\u30fc\u30bf\u3068\u3057\u3066\u306e\u30b3\u30de\u30f3\u30c9</li> <li>Visitor \u30d1\u30bf\u30fc\u30f3 - Foldable/Traversable</li> <li>Abstract Factory \u30d1\u30bf\u30fc\u30f3 - \u578b\u30af\u30e9\u30b9\u306b\u3088\u308b\u62bd\u8c61\u5316</li> <li>Abstract Server \u30d1\u30bf\u30fc\u30f3 - \u30e2\u30b8\u30e5\u30e9\u30fc\u8a2d\u8a08</li> </ol>"},{"location":"haskell/#5chapters-15-19","title":"\u7b2c5\u90e8\uff1a\u5b9f\u8df5\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\uff08Chapters 15-19\uff09","text":"<ol> <li>\u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b - \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3</li> <li>\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0 - \u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af</li> <li>\u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0 - \u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30ea\u30f3\u30b0</li> <li>\u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0 - STM\u3001async</li> <li>Wa-Tor \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3 - \u30bb\u30eb\u30aa\u30fc\u30c8\u30de\u30c8\u30f3</li> </ol>"},{"location":"haskell/#6chapters-20-22","title":"\u7b2c6\u90e8\uff1a\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\uff08Chapters 20-22\uff09","text":"<ol> <li>\u30d1\u30bf\u30fc\u30f3\u9593\u306e\u76f8\u4e92\u4f5c\u7528 - \u30d1\u30bf\u30fc\u30f3\u306e\u7d44\u307f\u5408\u308f\u305b</li> <li>\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9 - \u30a4\u30c7\u30a3\u30aa\u30e0\u3001\u30b9\u30bf\u30a4\u30eb</li> <li>OO \u304b\u3089 FP \u3078\u306e\u79fb\u884c - \u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u6226\u7565</li> </ol>"},{"location":"haskell/#haskell_1","title":"Haskell \u306e\u7279\u5fb4","text":""},{"location":"haskell/#_3","title":"\u7d14\u7c8b\u6027\u3068\u53c2\u7167\u900f\u904e\u6027","text":"<pre><code>-- \u7d14\u7c8b\u95a2\u6570\uff1a\u540c\u3058\u5165\u529b\u306b\u306f\u5e38\u306b\u540c\u3058\u51fa\u529b\ncalculateArea :: Double -&gt; Double -&gt; Double\ncalculateArea width height = width * height\n\n-- IO \u306f\u30e2\u30ca\u30c9\u3067\u660e\u793a\u7684\u306b\u6271\u3046\nmain :: IO ()\nmain = do\n    putStrLn \"Enter width:\"\n    w &lt;- readLn\n    putStrLn \"Enter height:\"\n    h &lt;- readLn\n    print (calculateArea w h)\n</code></pre>"},{"location":"haskell/#adt","title":"\u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b\uff08ADT\uff09","text":"<pre><code>-- \u76f4\u548c\u578b\uff08Sum Type\uff09\ndata Shape\n    = Circle Double\n    | Rectangle Double Double\n    | Triangle Double Double\n    deriving (Show, Eq)\n\n-- \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u3067\u7db2\u7f85\u7684\u306b\u51e6\u7406\narea :: Shape -&gt; Double\narea (Circle r) = pi * r * r\narea (Rectangle w h) = w * h\narea (Triangle b h) = b * h / 2\n</code></pre>"},{"location":"haskell/#_4","title":"\u578b\u30af\u30e9\u30b9","text":"<pre><code>-- \u30a2\u30c9\u30db\u30c3\u30af\u591a\u76f8\u6027\u3092\u5b9f\u73fe\nclass Drawable a where\n    draw :: a -&gt; String\n    boundingBox :: a -&gt; (Double, Double, Double, Double)\n\ninstance Drawable Shape where\n    draw (Circle r) = \"Circle with radius \" ++ show r\n    draw (Rectangle w h) = \"Rectangle \" ++ show w ++ \"x\" ++ show h\n    draw (Triangle b h) = \"Triangle with base \" ++ show b\n\n    boundingBox (Circle r) = (-r, -r, r, r)\n    boundingBox (Rectangle w h) = (0, 0, w, h)\n    boundingBox (Triangle b h) = (0, 0, b, h)\n</code></pre>"},{"location":"haskell/#_5","title":"\u95a2\u6570\u5408\u6210","text":"<pre><code>-- (.) \u3067\u53f3\u304b\u3089\u5de6\u3078\u5408\u6210\nprocess :: String -&gt; Int\nprocess = length . filter isDigit . map toLower\n\n-- (&gt;&gt;&gt;) \u3067\u5de6\u304b\u3089\u53f3\u3078\u5408\u6210\uff08Control.Arrow\uff09\nprocessArrow :: String -&gt; Int\nprocessArrow = map toLower &gt;&gt;&gt; filter isDigit &gt;&gt;&gt; length\n\n-- \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u6f14\u7b97\u5b50\uff08&amp; from Data.Function\uff09\nresult = \"Hello123\"\n       &amp; map toLower\n       &amp; filter isDigit\n       &amp; length\n</code></pre>"},{"location":"haskell/#_6","title":"\u958b\u767a\u74b0\u5883","text":""},{"location":"haskell/#_7","title":"\u5fc5\u8981\u306a\u30c4\u30fc\u30eb","text":"<ul> <li>GHC 9.4 \u4ee5\u4e0a</li> <li>Cabal \u307e\u305f\u306f Stack</li> <li>HLS\uff08Haskell Language Server\uff09</li> </ul>"},{"location":"haskell/#nix","title":"Nix \u3092\u4f7f\u7528\u3059\u308b\u5834\u5408","text":"<pre><code>nix develop .#haskell\n</code></pre>"},{"location":"haskell/#_8","title":"\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u69cb\u9020","text":"<pre><code>app/haskell/\n\u251c\u2500\u2500 part1/                    # \u7b2c1\u90e8\uff1a\u57fa\u790e\u539f\u5247\n\u2502   \u251c\u2500\u2500 functional-design-part1.cabal\n\u2502   \u251c\u2500\u2500 src/\n\u2502   \u2502   \u251c\u2500\u2500 Immutability.hs\n\u2502   \u2502   \u251c\u2500\u2500 FunctionComposition.hs\n\u2502   \u2502   \u2514\u2500\u2500 Polymorphism.hs\n\u2502   \u2514\u2500\u2500 test/\n\u2502       \u251c\u2500\u2500 Spec.hs\n\u2502       \u251c\u2500\u2500 ImmutabilitySpec.hs\n\u2502       \u251c\u2500\u2500 FunctionCompositionSpec.hs\n\u2502       \u2514\u2500\u2500 PolymorphismSpec.hs\n\u251c\u2500\u2500 part2/                    # \u7b2c2\u90e8\uff1a\u4ed5\u69d8\u3068\u30c6\u30b9\u30c8\n\u251c\u2500\u2500 part3/                    # \u7b2c3\u90e8\uff1a\u69cb\u9020\u30d1\u30bf\u30fc\u30f3\n\u251c\u2500\u2500 part4/                    # \u7b2c4\u90e8\uff1a\u632f\u308b\u821e\u3044\u30d1\u30bf\u30fc\u30f3\n\u251c\u2500\u2500 part5/                    # \u7b2c5\u90e8\uff1a\u5b9f\u8df5\n\u251c\u2500\u2500 part6/                    # \u7b2c6\u90e8\uff1a\u4e26\u884c\u51e6\u7406\n\u2514\u2500\u2500 part7/                    # \u7b2c7\u90e8\uff1a\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\n</code></pre>"},{"location":"haskell/#_9","title":"\u30d3\u30eb\u30c9\u3068\u30c6\u30b9\u30c8","text":"<pre><code>cd app/haskell/part1\ncabal build\ncabal test --test-show-details=streaming\n</code></pre>"},{"location":"haskell/#_10","title":"\u53c2\u8003\u30ea\u30bd\u30fc\u30b9","text":"<ul> <li>Haskell\u516c\u5f0f\u30b5\u30a4\u30c8</li> <li>Learn You a Haskell</li> <li>Real World Haskell</li> <li>Typeclassopedia</li> <li>Haskell Design Patterns</li> </ul>"},{"location":"haskell/01-immutability-and-data-transformation/","title":"\u7b2c1\u7ae0: \u4e0d\u5909\u6027\u3068\u30c7\u30fc\u30bf\u5909\u63db","text":""},{"location":"haskell/01-immutability-and-data-transformation/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u6700\u3082\u91cd\u8981\u306a\u6982\u5ff5\u306e\u4e00\u3064\u304c\u4e0d\u5909\u6027\uff08Immutability\uff09\u3067\u3059\u3002Haskell \u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u4e0d\u5909\u3067\u3042\u308a\u3001\u3059\u3079\u3066\u306e\u5024\u306f\u4e00\u5ea6\u4f5c\u6210\u3055\u308c\u308b\u3068\u5909\u66f4\u3067\u304d\u307e\u305b\u3093\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u4e88\u6e2c\u53ef\u80fd\u6027\u304c\u5411\u4e0a\u3057\u3001\u4e26\u884c\u51e6\u7406\u3067\u306e\u554f\u984c\u3092\u9632\u304e\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001Haskell \u306b\u304a\u3051\u308b\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u57fa\u672c\u304b\u3089\u3001\u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3001\u526f\u4f5c\u7528\u306e\u5206\u96e2\u307e\u3067\u3001\u5b9f\u8df5\u7684\u306a\u4f8b\u3092\u901a\u3058\u3066\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"haskell/01-immutability-and-data-transformation/#1_1","title":"1. \u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u57fa\u672c","text":""},{"location":"haskell/01-immutability-and-data-transformation/#_2","title":"\u30ec\u30b3\u30fc\u30c9\u578b\u306b\u3088\u308b\u4e0d\u5909\u30c7\u30fc\u30bf","text":"<p>Haskell \u306e\u30ec\u30b3\u30fc\u30c9\u69cb\u6587\u3092\u4f7f\u3063\u3066\u30c7\u30fc\u30bf\u578b\u3092\u5b9a\u7fa9\u3057\u307e\u3059\uff1a</p> <pre><code>-- | Person \u30ec\u30b3\u30fc\u30c9\uff08\u4e0d\u5909\uff09\ndata Person = Person\n    { personName :: String\n    , personAge  :: Int\n    } deriving (Show, Eq)\n\n-- | \u5e74\u9f62\u3092\u66f4\u65b0\u3059\u308b\u95a2\u6570\uff08\u65b0\u3057\u3044 Person \u3092\u8fd4\u3059\uff09\nupdateAge :: Person -&gt; Int -&gt; Person\nupdateAge person newAge = person { personAge = newAge }\n\n-- \u4f7f\u7528\u4f8b\nlet original = Person \"\u7530\u4e2d\" 30\nlet updated = updateAge original 31\n\noriginal   -- =&gt; Person {personName = \"\u7530\u4e2d\", personAge = 30}  \u2190 \u5143\u306f\u5909\u308f\u3089\u306a\u3044\nupdated    -- =&gt; Person {personName = \"\u7530\u4e2d\", personAge = 31}  \u2190 \u65b0\u3057\u3044\u5024\n</code></pre>"},{"location":"haskell/01-immutability-and-data-transformation/#_3","title":"\u4e0d\u5909\u6027\u306e\u5229\u70b9","text":"<ol> <li>\u53c2\u7167\u900f\u904e\u6027: \u540c\u3058\u5165\u529b\u306b\u5bfe\u3057\u3066\u5e38\u306b\u540c\u3058\u51fa\u529b</li> <li>\u30b9\u30ec\u30c3\u30c9\u30bb\u30fc\u30d5: \u8907\u6570\u30b9\u30ec\u30c3\u30c9\u304b\u3089\u5b89\u5168\u306b\u30a2\u30af\u30bb\u30b9\u53ef\u80fd</li> <li>\u63a8\u8ad6\u306e\u5bb9\u6613\u3055: \u5024\u304c\u5909\u308f\u3089\u306a\u3044\u305f\u3081\u52d5\u4f5c\u3092\u8ffd\u8de1\u3057\u3084\u3059\u3044</li> <li>\u9045\u5ef6\u8a55\u4fa1\u3068\u306e\u76f8\u6027: \u5fc5\u8981\u306b\u306a\u308b\u307e\u3067\u8a08\u7b97\u3092\u9045\u5ef6\u3067\u304d\u308b</li> </ol>"},{"location":"haskell/01-immutability-and-data-transformation/#2-structural-sharing","title":"2. \u69cb\u9020\u5171\u6709\uff08Structural Sharing\uff09","text":"<p>Haskell \u306e\u30ea\u30b9\u30c8\u3084\u6728\u69cb\u9020\u306f\u69cb\u9020\u5171\u6709\u306b\u3088\u308a\u52b9\u7387\u7684\u306b\u30e1\u30e2\u30ea\u3092\u4f7f\u7528\u3057\u307e\u3059\uff1a</p> <pre><code>-- | \u30c1\u30fc\u30e0\u30e1\u30f3\u30d0\u30fc\ndata Role = Developer | Designer | Manager\n    deriving (Show, Eq)\n\ndata Member = Member\n    { memberName :: String\n    , memberRole :: Role\n    } deriving (Show, Eq)\n\n-- | \u30c1\u30fc\u30e0\ndata Team = Team\n    { teamName    :: String\n    , teamMembers :: [Member]\n    } deriving (Show, Eq)\n\n-- | \u30e1\u30f3\u30d0\u30fc\u3092\u8ffd\u52a0\uff08\u65e2\u5b58\u30ea\u30b9\u30c8\u306f\u5171\u6709\u3055\u308c\u308b\uff09\naddMember :: Team -&gt; Member -&gt; Team\naddMember team newMember = team { teamMembers = teamMembers team ++ [newMember] }\n</code></pre> <p></p>"},{"location":"haskell/01-immutability-and-data-transformation/#3","title":"3. \u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3","text":""},{"location":"haskell/01-immutability-and-data-transformation/#_4","title":"\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u6f14\u7b97\u5b50\u3068\u95a2\u6570\u9069\u7528","text":"<p>Haskell \u3067\u306f <code>$</code> \u3068 <code>&amp;</code>\uff08Data.Function \u304b\u3089\uff09\u3092\u4f7f\u3063\u3066\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u69cb\u7bc9\u3057\u307e\u3059\uff1a</p> <pre><code>import Data.Function ((&amp;))\n\n-- | \u6ce8\u6587\u30a2\u30a4\u30c6\u30e0\ndata Item = Item\n    { itemName     :: String\n    , itemPrice    :: Int\n    , itemQuantity :: Int\n    } deriving (Show, Eq)\n\n-- | \u4f1a\u54e1\u7a2e\u5225\ndata Membership = Gold | Silver | Bronze | Regular\n    deriving (Show, Eq)\n\n-- | \u9867\u5ba2\ndata Customer = Customer\n    { customerName       :: String\n    , customerMembership :: Membership\n    } deriving (Show, Eq)\n\n-- | \u6ce8\u6587\ndata Order = Order\n    { orderItems    :: [Item]\n    , orderCustomer :: Customer\n    } deriving (Show, Eq)\n\n-- | \u30a2\u30a4\u30c6\u30e0\u306e\u5c0f\u8a08\u3092\u8a08\u7b97\ncalculateSubtotal :: Item -&gt; Int\ncalculateSubtotal item = itemPrice item * itemQuantity item\n\n-- | \u4f1a\u54e1\u5272\u5f15\u7387\u3092\u53d6\u5f97\nmembershipDiscount :: Membership -&gt; Double\nmembershipDiscount Gold   = 0.1\nmembershipDiscount Silver = 0.05\nmembershipDiscount Bronze = 0.02\nmembershipDiscount Regular = 0.0\n\n-- | \u6ce8\u6587\u5408\u8a08\u3092\u8a08\u7b97\ncalculateTotal :: Order -&gt; Int\ncalculateTotal order = sum $ map calculateSubtotal (orderItems order)\n\n-- | \u5272\u5f15\u3092\u9069\u7528\napplyDiscount :: Order -&gt; Int -&gt; Double\napplyDiscount order total =\n    let discountRate = membershipDiscount (customerMembership (orderCustomer order))\n    in fromIntegral total * (1 - discountRate)\n\n-- | \u6ce8\u6587\u51e6\u7406\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\nprocessOrder :: Order -&gt; Double\nprocessOrder order =\n    let total = calculateTotal order\n    in applyDiscount order total\n\n-- \u307e\u305f\u306f &amp; \u3092\u4f7f\u3063\u305f\u8a18\u6cd5\nprocessOrderPipe :: Order -&gt; Double\nprocessOrderPipe order =\n    order\n    &amp; calculateTotal\n    &amp; applyDiscount order\n</code></pre>"},{"location":"haskell/01-immutability-and-data-transformation/#4","title":"4. \u526f\u4f5c\u7528\u306e\u5206\u96e2","text":"<p>Haskell \u3067\u306f\u526f\u4f5c\u7528\u306f IO \u30e2\u30ca\u30c9\u3067\u660e\u793a\u7684\u306b\u6271\u3044\u307e\u3059\uff1a</p> <pre><code>-- | \u8acb\u6c42\u66f8\u30c7\u30fc\u30bf\ndata Invoice = Invoice\n    { invoiceSubtotal :: Int\n    , invoiceTax      :: Double\n    , invoiceTotal    :: Double\n    } deriving (Show, Eq)\n\n-- | \u8acb\u6c42\u66f8\u3092\u8a08\u7b97\uff08\u7d14\u7c8b\u95a2\u6570\uff09\ncalculateInvoice :: [Item] -&gt; Double -&gt; Invoice\ncalculateInvoice items taxRate =\n    let subtotal = sum $ map calculateSubtotal items\n        tax = fromIntegral subtotal * taxRate\n        total = fromIntegral subtotal + tax\n    in Invoice subtotal tax total\n\n-- | \u8acb\u6c42\u66f8\u3092\u4fdd\u5b58\uff08IO \u3092\u542b\u3080\u526f\u4f5c\u7528\uff09\nsaveInvoice :: Invoice -&gt; IO ()\nsaveInvoice invoice = do\n    putStrLn $ \"Saving invoice: \" ++ show invoice\n    -- \u5b9f\u969b\u306eDB\u4fdd\u5b58\u51e6\u7406\n\n-- | \u901a\u77e5\u3092\u9001\u4fe1\uff08IO \u3092\u542b\u3080\u526f\u4f5c\u7528\uff09\nsendNotification :: Invoice -&gt; String -&gt; IO ()\nsendNotification invoice email = do\n    putStrLn $ \"Sending to: \" ++ email\n    -- \u5b9f\u969b\u306e\u30e1\u30fc\u30eb\u9001\u4fe1\u51e6\u7406\n\n-- | \u51e6\u7406\u5168\u4f53\u306e\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\nprocessAndSaveInvoice :: [Item] -&gt; Double -&gt; String -&gt; IO ()\nprocessAndSaveInvoice items taxRate email = do\n    let invoice = calculateInvoice items taxRate  -- \u7d14\u7c8b\u306a\u8a08\u7b97\n    saveInvoice invoice                            -- \u526f\u4f5c\u7528\n    sendNotification invoice email                 -- \u526f\u4f5c\u7528\n</code></pre>"},{"location":"haskell/01-immutability-and-data-transformation/#5-undoredo","title":"5. \u6c38\u7d9a\u7684\u30c7\u30fc\u30bf\u69cb\u9020\uff1aUndo/Redo \u306e\u5b9f\u88c5","text":"<p>\u4e0d\u5909\u30c7\u30fc\u30bf\u3092\u6d3b\u7528\u3057\u305f\u5c65\u6b74\u7ba1\u7406\uff1a</p> <pre><code>-- | \u5c65\u6b74\u3092\u4fdd\u6301\u3059\u308b\u30c7\u30fc\u30bf\u69cb\u9020\ndata History a = History\n    { historyCurrent :: Maybe a\n    , historyPast    :: [a]\n    , historyFuture  :: [a]\n    } deriving (Show, Eq)\n\n-- | \u7a7a\u306e\u5c65\u6b74\u3092\u4f5c\u6210\ncreateHistory :: History a\ncreateHistory = History Nothing [] []\n\n-- | \u65b0\u3057\u3044\u72b6\u614b\u3092\u30d7\u30c3\u30b7\u30e5\npushState :: History a -&gt; a -&gt; History a\npushState history newState =\n    History\n        { historyCurrent = Just newState\n        , historyPast = case historyCurrent history of\n            Nothing -&gt; historyPast history\n            Just current -&gt; current : historyPast history\n        , historyFuture = []  -- \u65b0\u72b6\u614b\u3067\u672a\u6765\u306f\u30af\u30ea\u30a2\n        }\n\n-- | Undo \u64cd\u4f5c\nundo :: History a -&gt; History a\nundo history = case historyPast history of\n    [] -&gt; history  -- \u623b\u308b\u5c65\u6b74\u304c\u306a\u3044\n    (prev:rest) -&gt; History\n        { historyCurrent = Just prev\n        , historyPast = rest\n        , historyFuture = case historyCurrent history of\n            Nothing -&gt; historyFuture history\n            Just current -&gt; current : historyFuture history\n        }\n\n-- | Redo \u64cd\u4f5c\nredo :: History a -&gt; History a\nredo history = case historyFuture history of\n    [] -&gt; history  -- \u9032\u3080\u5c65\u6b74\u304c\u306a\u3044\n    (next:rest) -&gt; History\n        { historyCurrent = Just next\n        , historyPast = case historyCurrent history of\n            Nothing -&gt; historyPast history\n            Just current -&gt; current : historyPast history\n        , historyFuture = rest\n        }\n\n-- | \u73fe\u5728\u306e\u72b6\u614b\u3092\u53d6\u5f97\ncurrentState :: History a -&gt; Maybe a\ncurrentState = historyCurrent\n\n-- | Undo \u53ef\u80fd\u304b\ncanUndo :: History a -&gt; Bool\ncanUndo = not . null . historyPast\n\n-- | Redo \u53ef\u80fd\u304b\ncanRedo :: History a -&gt; Bool\ncanRedo = not . null . historyFuture\n</code></pre>"},{"location":"haskell/01-immutability-and-data-transformation/#_5","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>-- \u5c65\u6b74\u306e\u64cd\u4f5c\nlet h1 = createHistory :: History Int\nlet h2 = pushState h1 1\nlet h3 = pushState h2 2\nlet h4 = pushState h3 3\n\ncurrentState h4  -- =&gt; Just 3\ncanUndo h4       -- =&gt; True\n\nlet h5 = undo h4\ncurrentState h5  -- =&gt; Just 2\ncanRedo h5       -- =&gt; True\n\nlet h6 = redo h5\ncurrentState h6  -- =&gt; Just 3\n</code></pre>"},{"location":"haskell/01-immutability-and-data-transformation/#6","title":"6. \u307e\u3068\u3081","text":"<p>Haskell \u306b\u304a\u3051\u308b\u4e0d\u5909\u6027\u306e\u7279\u5fb4\uff1a</p> \u6982\u5ff5 Haskell \u3067\u306e\u5b9f\u73fe \u4e0d\u5909\u30c7\u30fc\u30bf \u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u4e0d\u5909\uff08let \u3067\u675f\u7e1b\uff09 \u30ec\u30b3\u30fc\u30c9\u66f4\u65b0 <code>{ record \\| field = newValue }</code> \u69cb\u6587 \u69cb\u9020\u5171\u6709 \u81ea\u52d5\u7684\u306b\u6700\u9069\u5316\u3055\u308c\u308b \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3 <code>$</code>\u3001<code>&amp;</code>\u3001\u95a2\u6570\u5408\u6210 (.) \u526f\u4f5c\u7528\u5206\u96e2 IO \u30e2\u30ca\u30c9\u3067\u660e\u793a\u7684\u306b"},{"location":"haskell/01-immutability-and-data-transformation/#_6","title":"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7","text":"<ul> <li>\u7b2c2\u7ae0\u3067\u306f\u95a2\u6570\u5408\u6210\u3068\u9ad8\u968e\u95a2\u6570\u3092\u5b66\u3073\u307e\u3059</li> <li>\u7b2c3\u7ae0\u3067\u306f\u578b\u30af\u30e9\u30b9\u306b\u3088\u308b\u591a\u614b\u6027\u3092\u63a2\u308a\u307e\u3059</li> </ul>"},{"location":"haskell/02-function-composition/","title":"\u7b2c2\u7ae0: \u95a2\u6570\u5408\u6210\u3068\u9ad8\u968e\u95a2\u6570","text":""},{"location":"haskell/02-function-composition/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u771f\u9ac4\u306f\u3001\u5c0f\u3055\u306a\u95a2\u6570\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u8907\u96d1\u306a\u51e6\u7406\u3092\u69cb\u7bc9\u3059\u308b\u3053\u3068\u306b\u3042\u308a\u307e\u3059\u3002Haskell \u3067\u306f\u95a2\u6570\u5408\u6210\u304c\u8a00\u8a9e\u306e\u4e2d\u5fc3\u7684\u306a\u6982\u5ff5\u3067\u3042\u308a\u3001\u6f14\u7b97\u5b50\u3084\u30ab\u30ea\u30fc\u5316\u306b\u3088\u308a\u81ea\u7136\u306b\u8868\u73fe\u3067\u304d\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u95a2\u6570\u5408\u6210\u306e\u30c6\u30af\u30cb\u30c3\u30af\u3068\u9ad8\u968e\u95a2\u6570\u306e\u6d3b\u7528\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"haskell/02-function-composition/#1","title":"1. \u95a2\u6570\u5408\u6210\u306e\u57fa\u672c (<code>.</code> \u3068 <code>&gt;&gt;&gt;</code>)","text":""},{"location":"haskell/02-function-composition/#_2","title":"<code>.</code> \u306b\u3088\u308b\u95a2\u6570\u5408\u6210\uff08\u53f3\u304b\u3089\u5de6\uff09","text":"<p><code>.</code> \u6f14\u7b97\u5b50\u306f\u6570\u5b66\u7684\u306a\u95a2\u6570\u5408\u6210 <code>(f \u2218 g)(x) = f(g(x))</code> \u3092\u8868\u73fe\u3057\u307e\u3059\uff1a</p> <pre><code>-- | \u7a0e\u91d1\u3092\u8ffd\u52a0\naddTax :: Double -&gt; Double -&gt; Double\naddTax rate amount = amount * (1 + rate)\n\n-- | \u5272\u5f15\u3092\u9069\u7528\napplyDiscountRate :: Double -&gt; Double -&gt; Double\napplyDiscountRate rate amount = amount * (1 - rate)\n\n-- | \u5186\u5358\u4f4d\u306b\u4e38\u3081\u308b\nroundToYen :: Double -&gt; Integer\nroundToYen = round\n\n-- | (.) \u306b\u3088\u308b\u95a2\u6570\u5408\u6210\uff08\u53f3\u304b\u3089\u5de6\uff09\ncalculateFinalPriceCompose :: Double -&gt; Integer\ncalculateFinalPriceCompose = roundToYen . addTax 0.1 . applyDiscountRate 0.2\n\n-- \u4f7f\u7528\u4f8b\ncalculateFinalPriceCompose 1000  -- =&gt; 880\n-- \u51e6\u7406\u9806\u5e8f: 1000 \u2192 20%\u5272\u5f15(800) \u2192 10%\u7a0e\u8fbc(880) \u2192 \u4e38\u3081(880)\n</code></pre>"},{"location":"haskell/02-function-composition/#_3","title":"<code>&gt;&gt;&gt;</code> \u306b\u3088\u308b\u95a2\u6570\u5408\u6210\uff08\u5de6\u304b\u3089\u53f3\uff09","text":"<p><code>Control.Arrow</code> \u306e <code>&gt;&gt;&gt;</code> \u306f\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u3088\u3046\u306b\u5de6\u304b\u3089\u53f3\u3078\u51e6\u7406\u3092\u6d41\u3057\u307e\u3059\uff1a</p> <pre><code>import Control.Arrow ((&gt;&gt;&gt;))\n\n-- | (&gt;&gt;&gt;) \u306b\u3088\u308b\u95a2\u6570\u5408\u6210\uff08\u5de6\u304b\u3089\u53f3\u3001\u3088\u308a\u76f4\u611f\u7684\uff09\ncalculateFinalPrice :: Double -&gt; Integer\ncalculateFinalPrice = applyDiscountRate 0.2 &gt;&gt;&gt; addTax 0.1 &gt;&gt;&gt; roundToYen\n\n-- \u4f7f\u7528\u4f8b\ncalculateFinalPrice 1000  -- =&gt; 880\n</code></pre>"},{"location":"haskell/02-function-composition/#_4","title":"\u95a2\u6570\u5408\u6210\u306e\u5229\u70b9","text":"<ol> <li>\u5ba3\u8a00\u7684\u306a\u8a18\u8ff0: \u51e6\u7406\u306e\u6d41\u308c\u3092\u95a2\u6570\u306e\u30c1\u30a7\u30fc\u30f3\u3068\u3057\u3066\u8868\u73fe</li> <li>\u518d\u5229\u7528\u6027: \u5408\u6210\u3057\u305f\u95a2\u6570\u3092\u4ed6\u306e\u5834\u6240\u3067\u518d\u5229\u7528\u53ef\u80fd</li> <li>\u30c6\u30b9\u30c8\u5bb9\u6613\u6027: \u5404\u95a2\u6570\u3092\u500b\u5225\u306b\u30c6\u30b9\u30c8\u53ef\u80fd</li> <li>\u30dd\u30a4\u30f3\u30c8\u30d5\u30ea\u30fc\u30b9\u30bf\u30a4\u30eb: \u5f15\u6570\u3092\u660e\u793a\u3057\u306a\u3044\u30a8\u30ec\u30ac\u30f3\u30c8\u306a\u8868\u73fe</li> </ol>"},{"location":"haskell/02-function-composition/#2_1","title":"2. \u30ab\u30ea\u30fc\u5316\u3068\u90e8\u5206\u9069\u7528","text":""},{"location":"haskell/02-function-composition/#haskell","title":"Haskell \u306e\u30ab\u30ea\u30fc\u5316","text":"<p>Haskell \u3067\u306f\u5168\u3066\u306e\u95a2\u6570\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u30ab\u30ea\u30fc\u5316\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u8907\u6570\u5f15\u6570\u306e\u95a2\u6570\u306f\u300c1\u5f15\u6570\u3092\u53d6\u308a\u95a2\u6570\u3092\u8fd4\u3059\u95a2\u6570\u300d\u306e\u30c1\u30a7\u30fc\u30f3\u3067\u3059\uff1a</p> <pre><code>-- | \u30ab\u30ea\u30fc\u5316\u3055\u308c\u305f\u6328\u62f6\u95a2\u6570\ngreet :: String -&gt; String -&gt; String\ngreet greeting name = greeting ++ \", \" ++ name ++ \"!\"\n\n-- \u3053\u308c\u306f\u5b9f\u969b\u306b\u306f\u6b21\u3068\u7b49\u4fa1\uff1a\n-- greet :: String -&gt; (String -&gt; String)\n\n-- | \u90e8\u5206\u9069\u7528\u3067\u7279\u5316\u3057\u305f\u95a2\u6570\u3092\u4f5c\u6210\nsayHello :: String -&gt; String\nsayHello = greet \"Hello\"\n\nsayGoodbye :: String -&gt; String\nsayGoodbye = greet \"Goodbye\"\n\n-- \u4f7f\u7528\u4f8b\nsayHello \"\u7530\u4e2d\"    -- =&gt; \"Hello, \u7530\u4e2d!\"\nsayGoodbye \"\u9234\u6728\"  -- =&gt; \"Goodbye, \u9234\u6728!\"\n</code></pre>"},{"location":"haskell/02-function-composition/#_5","title":"\u8907\u6570\u5f15\u6570\u306e\u90e8\u5206\u9069\u7528","text":"<pre><code>-- | Email \u30ec\u30b3\u30fc\u30c9\ndata Email = Email\n    { emailFrom    :: String\n    , emailTo      :: String\n    , emailSubject :: String\n    , emailBody    :: String\n    } deriving (Show, Eq)\n\n-- | \u30ab\u30ea\u30fc\u5316\u3055\u308c\u305f\u30e1\u30fc\u30eb\u4f5c\u6210\u95a2\u6570\nsendEmail :: String -&gt; String -&gt; String -&gt; String -&gt; Email\nsendEmail from to subject body = Email from to subject body\n\n-- | \u90e8\u5206\u9069\u7528\u3067\u30b7\u30b9\u30c6\u30e0\u30e1\u30fc\u30eb\u9001\u4fe1\u95a2\u6570\u3092\u4f5c\u6210\nsendFromSystem :: String -&gt; String -&gt; String -&gt; Email\nsendFromSystem = sendEmail \"system@example.com\"\n\n-- | \u3055\u3089\u306b\u90e8\u5206\u9069\u7528\nsendNotification :: String -&gt; Email\nsendNotification = sendFromSystem \"user@example.com\" \"\u901a\u77e5\"\n\n-- \u4f7f\u7528\u4f8b\nsendNotification \"\u30e1\u30c3\u30bb\u30fc\u30b8\u672c\u6587\"\n-- =&gt; Email { emailFrom = \"system@example.com\"\n--          , emailTo = \"user@example.com\"\n--          , emailSubject = \"\u901a\u77e5\"\n--          , emailBody = \"\u30e1\u30c3\u30bb\u30fc\u30b8\u672c\u6587\" }\n</code></pre>"},{"location":"haskell/02-function-composition/#3-juxt","title":"3. \u8907\u6570\u306e\u95a2\u6570\u3092\u4e26\u5217\u9069\u7528 (juxt)","text":"<p>Clojure \u306e <code>juxt</code> \u306b\u76f8\u5f53\u3059\u308b\u6a5f\u80fd\u306f\u30bf\u30d7\u30eb\u3067\u8868\u73fe\u3057\u307e\u3059\uff1a</p> <pre><code>-- | 2\u3064\u306e\u95a2\u6570\u3092\u540c\u3058\u5165\u529b\u306b\u9069\u7528\njuxt2 :: (a -&gt; b) -&gt; (a -&gt; c) -&gt; a -&gt; (b, c)\njuxt2 f1 f2 x = (f1 x, f2 x)\n\n-- | 3\u3064\u306e\u95a2\u6570\u3092\u540c\u3058\u5165\u529b\u306b\u9069\u7528\njuxt3 :: (a -&gt; b) -&gt; (a -&gt; c) -&gt; (a -&gt; d) -&gt; a -&gt; (b, c, d)\njuxt3 f1 f2 f3 x = (f1 x, f2 x, f3 x)\n\n-- \u4f7f\u7528\u4f8b\njuxt2 (*2) (+10) 5  -- =&gt; (10, 15)\njuxt3 head last length [1, 2, 3]  -- =&gt; (1, 3, 3)\n</code></pre>"},{"location":"haskell/02-function-composition/#_6","title":"\u5b9f\u7528\u4f8b\uff1a\u7d71\u8a08\u60c5\u5831\u306e\u53d6\u5f97","text":"<pre><code>-- | \u30ea\u30b9\u30c8\u306e\u7d71\u8a08\u60c5\u5831\u3092\u53d6\u5f97\ngetStats :: [Int] -&gt; (Int, Int, Int, Int, Int)\ngetStats numbers =\n    ( head numbers      -- \u6700\u521d\u306e\u5024\n    , last numbers      -- \u6700\u5f8c\u306e\u5024\n    , length numbers    -- \u8981\u7d20\u6570\n    , minimum numbers   -- \u6700\u5c0f\u5024\n    , maximum numbers   -- \u6700\u5927\u5024\n    )\n\ngetStats [3, 1, 4, 1, 5, 9, 2, 6]  -- =&gt; (3, 6, 8, 1, 9)\n</code></pre>"},{"location":"haskell/02-function-composition/#_7","title":"\u5b9f\u7528\u4f8b\uff1a\u4eba\u7269\u5206\u6790","text":"<pre><code>data Category = Adult | Minor deriving (Show, Eq)\n\ndata PersonAnalysis = PersonAnalysis\n    { analysisName     :: String\n    , analysisAge      :: Int\n    , analysisCategory :: Category\n    } deriving (Show, Eq)\n\nanalyzePerson :: String -&gt; Int -&gt; PersonAnalysis\nanalyzePerson name age = PersonAnalysis\n    { analysisName = name\n    , analysisAge = age\n    , analysisCategory = if age &gt;= 18 then Adult else Minor\n    }\n\nanalyzePerson \"\u7530\u4e2d\" 25  -- =&gt; PersonAnalysis {name=\"\u7530\u4e2d\", age=25, category=Adult}\nanalyzePerson \"\u9234\u6728\" 15  -- =&gt; PersonAnalysis {name=\"\u9234\u6728\", age=15, category=Minor}\n</code></pre>"},{"location":"haskell/02-function-composition/#4","title":"4. \u9ad8\u968e\u95a2\u6570","text":"<p>\u9ad8\u968e\u95a2\u6570\u306f\u3001\u95a2\u6570\u3092\u5f15\u6570\u3068\u3057\u3066\u53d7\u3051\u53d6\u308b\u304b\u3001\u95a2\u6570\u3092\u8fd4\u3059\u95a2\u6570\u3067\u3059\u3002</p>"},{"location":"haskell/02-function-composition/#_8","title":"\u30ed\u30b0\u51fa\u529b\u306e\u30e9\u30c3\u30d1\u30fc","text":"<pre><code>-- | \u30d7\u30ed\u30bb\u30b9\u30ed\u30b0\ndata ProcessLog a b = ProcessLog\n    { logInput  :: a\n    , logOutput :: b\n    } deriving (Show, Eq)\n\n-- | \u95a2\u6570\u3092\u30ed\u30ae\u30f3\u30b0\u3067\u30e9\u30c3\u30d7\uff08\u7d14\u7c8b\u30d0\u30fc\u30b8\u30e7\u30f3\uff09\nprocessWithLogging :: (a -&gt; b) -&gt; a -&gt; (b, ProcessLog a b)\nprocessWithLogging f x =\n    let result = f x\n        logEntry = ProcessLog x result\n    in (result, logEntry)\n\n-- \u4f7f\u7528\u4f8b\nlet (result, logEntry) = processWithLogging (*2) 5\nresult      -- =&gt; 10\nlogInput logEntry   -- =&gt; 5\nlogOutput logEntry  -- =&gt; 10\n</code></pre>"},{"location":"haskell/02-function-composition/#_9","title":"\u30ea\u30c8\u30e9\u30a4\u6a5f\u80fd","text":"<pre><code>-- | \u30ea\u30c8\u30e9\u30a4\u7d50\u679c\ndata RetryResult a\n    = Success a\n    | Failure String Int  -- \u30a8\u30e9\u30fc\u30e1\u30c3\u30bb\u30fc\u30b8\u3068\u8a66\u884c\u56de\u6570\n    deriving (Show, Eq)\n\n-- | \u5931\u6557\u3059\u308b\u53ef\u80fd\u6027\u306e\u3042\u308b\u95a2\u6570\u3092\u30ea\u30c8\u30e9\u30a4\nwithRetry :: Int -&gt; (a -&gt; Either String b) -&gt; a -&gt; RetryResult b\nwithRetry maxRetries f x = go 0\n  where\n    go attempts\n        | attempts &gt;= maxRetries = Failure \"Max retries exceeded\" attempts\n        | otherwise = case f x of\n            Right result -&gt; Success result\n            Left _ -&gt; go (attempts + 1)\n\n-- \u4f7f\u7528\u4f8b\nlet alwaysSucceed x = Right (x * 2)\nwithRetry 3 alwaysSucceed 5  -- =&gt; Success 10\n\nlet alwaysFail _ = Left \"error\" :: Either String Int\nwithRetry 3 alwaysFail 5  -- =&gt; Failure \"Max retries exceeded\" 3\n</code></pre>"},{"location":"haskell/02-function-composition/#5","title":"5. \u30d0\u30ea\u30c7\u30fc\u30bf\u30fc\uff08\u5408\u6210\u53ef\u80fd\u306a\u95a2\u6570\uff09","text":"<pre><code>-- | \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u7d50\u679c\ndata ValidationResult\n    = Valid\n    | Invalid String\n    deriving (Show, Eq)\n\n-- | \u30d0\u30ea\u30c7\u30fc\u30bf\u30fc\u578b\ntype Validator a = a -&gt; ValidationResult\n\n-- | \u7a7a\u3067\u306a\u3044\u3053\u3068\u3092\u691c\u8a3c\nvalidateNonEmpty :: Validator String\nvalidateNonEmpty s\n    | null s    = Invalid \"Value cannot be empty\"\n    | otherwise = Valid\n\n-- | \u6700\u5c0f\u9577\u3092\u691c\u8a3c\nvalidateMinLength :: Int -&gt; Validator String\nvalidateMinLength minLen s\n    | length s &lt; minLen = Invalid $ \"Must be at least \" ++ show minLen ++ \" characters\"\n    | otherwise = Valid\n\n-- | \u6700\u5927\u9577\u3092\u691c\u8a3c\nvalidateMaxLength :: Int -&gt; Validator String\nvalidateMaxLength maxLen s\n    | length s &gt; maxLen = Invalid $ \"Must be at most \" ++ show maxLen ++ \" characters\"\n    | otherwise = Valid\n\n-- | \u30e1\u30fc\u30eb\u5f62\u5f0f\u3092\u691c\u8a3c\nvalidateEmail :: Validator String\nvalidateEmail s\n    | '@' `elem` s &amp;&amp; '.' `elem` s = Valid\n    | otherwise = Invalid \"Invalid email format\"\n\n-- | 2\u3064\u306e\u30d0\u30ea\u30c7\u30fc\u30bf\u30fc\u3092\u7d50\u5408\uff08AND\u8ad6\u7406\uff09\ncombineValidators :: Validator a -&gt; Validator a -&gt; Validator a\ncombineValidators v1 v2 x = case v1 x of\n    Valid -&gt; v2 x\n    invalid -&gt; invalid\n\n-- | \u3059\u3079\u3066\u306e\u30d0\u30ea\u30c7\u30fc\u30bf\u30fc\u3067\u691c\u8a3c\uff08\u30a8\u30e9\u30fc\u3092\u53ce\u96c6\uff09\nvalidateAll :: [Validator a] -&gt; a -&gt; [ValidationResult]\nvalidateAll validators x = filter isInvalid $ map ($ x) validators\n  where\n    isInvalid Valid = False\n    isInvalid (Invalid _) = True\n\n-- \u4f7f\u7528\u4f8b\nlet combined = combineValidators validateNonEmpty (validateMinLength 3)\ncombined \"hello\"  -- =&gt; Valid\ncombined \"\"       -- =&gt; Invalid \"Value cannot be empty\"\ncombined \"hi\"     -- =&gt; Invalid \"Must be at least 3 characters\"\n</code></pre>"},{"location":"haskell/02-function-composition/#6","title":"6. \u307e\u3068\u3081","text":"\u6982\u5ff5 Haskell \u3067\u306e\u5b9f\u73fe \u95a2\u6570\u5408\u6210 <code>.</code> (\u53f3\u2192\u5de6)\u3001<code>&gt;&gt;&gt;</code> (\u5de6\u2192\u53f3) \u30ab\u30ea\u30fc\u5316 \u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u5168\u95a2\u6570\u304c\u30ab\u30ea\u30fc\u5316 \u90e8\u5206\u9069\u7528 \u5f15\u6570\u3092\u5de6\u304b\u3089\u9806\u306b\u9069\u7528 \u9ad8\u968e\u95a2\u6570 \u95a2\u6570\u3092\u5f15\u6570/\u623b\u308a\u5024\u3068\u3057\u3066\u6271\u3046 \u578b\u30b7\u30b0\u30cd\u30c1\u30e3 <code>a -&gt; b -&gt; c</code> \u306f <code>a -&gt; (b -&gt; c)</code>"},{"location":"haskell/02-function-composition/#_10","title":"\u30dd\u30a4\u30f3\u30c8\u30d5\u30ea\u30fc\u30b9\u30bf\u30a4\u30eb","text":"<pre><code>-- \u30dd\u30a4\u30f3\u30c8\u3042\u308a\uff08\u5f15\u6570\u3092\u660e\u793a\uff09\nsumOfSquares xs = sum (map (^2) xs)\n\n-- \u30dd\u30a4\u30f3\u30c8\u30d5\u30ea\u30fc\uff08\u5f15\u6570\u3092\u7701\u7565\uff09\nsumOfSquares = sum . map (^2)\n</code></pre>"},{"location":"haskell/02-function-composition/#_11","title":"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7","text":"<ul> <li>\u7b2c3\u7ae0\u3067\u306f\u578b\u30af\u30e9\u30b9\u306b\u3088\u308b\u591a\u614b\u6027\u3092\u5b66\u3073\u307e\u3059</li> </ul>"},{"location":"haskell/03-polymorphism/","title":"\u7b2c3\u7ae0: \u591a\u614b\u6027\u3068\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1","text":""},{"location":"haskell/03-polymorphism/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u591a\u614b\u6027\uff08\u30dd\u30ea\u30e2\u30fc\u30d5\u30a3\u30ba\u30e0\uff09\u306f\u3001\u540c\u3058\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u7570\u306a\u308b\u632f\u308b\u821e\u3044\u3092\u5b9f\u73fe\u3059\u308b\u5f37\u529b\u306a\u6982\u5ff5\u3067\u3059\u3002Haskell \u3067\u306f\u3001\u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b\uff08ADT\uff09\u3001\u578b\u30af\u30e9\u30b9\u3001\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u3068\u3044\u3046\u8907\u6570\u306e\u30e1\u30ab\u30cb\u30ba\u30e0\u3067\u591a\u614b\u6027\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u3053\u308c\u3089\u306e\u30e1\u30ab\u30cb\u30ba\u30e0\u3092\u4f7f\u3044\u5206\u3051\u3066\u3001\u67d4\u8edf\u3067\u62e1\u5f35\u6027\u306e\u9ad8\u3044\u30b3\u30fc\u30c9\u3092\u66f8\u304f\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"haskell/03-polymorphism/#1-adt","title":"1. \u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b\uff08ADT\uff09\u306b\u3088\u308b\u591a\u614b\u6027","text":""},{"location":"haskell/03-polymorphism/#_2","title":"\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9","text":"<p>Haskell \u306e\u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b\u306f\u6709\u9650\u306e\u30d0\u30ea\u30a8\u30fc\u30b7\u30e7\u30f3\u3092\u5b9a\u7fa9\u3059\u308b\u306e\u306b\u6700\u9069\u3067\u3059\uff1a</p> <pre><code>-- | \u56f3\u5f62\u3092\u8868\u3059\u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b\ndata Shape\n    = Rectangle' { rectWidth :: Double, rectHeight :: Double }\n    | Circle' { circleRadius :: Double }\n    | Triangle' { triBase :: Double, triHeight :: Double }\n    | Square' { squareSide :: Double }\n    deriving (Show, Eq)\n\n-- | \u9762\u7a4d\u3092\u8a08\u7b97\uff08\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\uff09\ncalculateArea :: Shape -&gt; Double\ncalculateArea shape = case shape of\n    Rectangle' w h -&gt; w * h\n    Circle' r      -&gt; pi * r * r\n    Triangle' b h  -&gt; b * h / 2\n    Square' s      -&gt; s * s\n\n-- | \u5468\u56f2\u9577\u3092\u8a08\u7b97\ncalculatePerimeter :: Shape -&gt; Double\ncalculatePerimeter shape = case shape of\n    Rectangle' w h -&gt; 2 * (w + h)\n    Circle' r      -&gt; 2 * pi * r\n    Triangle' b h  -&gt; b + 2 * sqrt ((b/2)^2 + h^2)\n    Square' s      -&gt; 4 * s\n\n-- \u4f7f\u7528\u4f8b\ncalculateArea (Rectangle' 4 5)  -- =&gt; 20.0\ncalculateArea (Circle' 3)       -- =&gt; 28.27...\ncalculateArea (Triangle' 6 5)   -- =&gt; 15.0\n</code></pre>"},{"location":"haskell/03-polymorphism/#adt","title":"ADT \u306e\u5229\u70b9","text":"<ol> <li>\u7db2\u7f85\u6027\u30c1\u30a7\u30c3\u30af: \u30b3\u30f3\u30d1\u30a4\u30e9\u304c\u3059\u3079\u3066\u306e\u30b1\u30fc\u30b9\u3092\u30ab\u30d0\u30fc\u3057\u3066\u3044\u308b\u304b\u78ba\u8a8d</li> <li>\u578b\u5b89\u5168\u6027: \u4e0d\u6b63\u306a\u578b\u306e\u5024\u3092\u6e21\u305b\u306a\u3044</li> <li>\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1: \u5206\u5c90\u3092\u7c21\u6f54\u306b\u8a18\u8ff0\u53ef\u80fd</li> </ol>"},{"location":"haskell/03-polymorphism/#2","title":"2. \u8907\u5408\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1","text":"<p>\u30bf\u30d7\u30eb\u3092\u4f7f\u3063\u305f\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u3067\u3001\u8907\u6570\u306e\u5024\u306b\u57fa\u3065\u304f\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u3092\u5b9f\u73fe\u3067\u304d\u307e\u3059\uff1a</p> <pre><code>-- | \u652f\u6255\u3044\u65b9\u6cd5\ndata PaymentMethod\n    = CreditCard\n    | BankTransfer\n    | Cash\n    | Cryptocurrency\n    deriving (Show, Eq)\n\n-- | \u901a\u8ca8\ndata Currency = JPY | USD | EUR\n    deriving (Show, Eq)\n\n-- | \u652f\u6255\u3044\u60c5\u5831\ndata Payment = Payment\n    { paymentMethod   :: PaymentMethod\n    , paymentCurrency :: Currency\n    , paymentAmount   :: Int\n    } deriving (Show, Eq)\n\n-- | \u652f\u6255\u3044\u7d50\u679c\ndata PaymentResult = PaymentResult\n    { resultStatus    :: String\n    , resultMessage   :: String\n    , resultAmount    :: Int\n    , resultConverted :: Maybe Int\n    } deriving (Show, Eq)\n\n-- | \u652f\u6255\u3044\u51e6\u7406\uff08\u8907\u5408\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\uff09\nprocessPayment :: Payment -&gt; PaymentResult\nprocessPayment payment = case (paymentMethod payment, paymentCurrency payment) of\n    (CreditCard, JPY) -&gt; PaymentResult\n        { resultStatus = \"processed\"\n        , resultMessage = \"\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\uff08\u5186\uff09\u3067\u51e6\u7406\u3057\u307e\u3057\u305f\"\n        , resultAmount = paymentAmount payment\n        , resultConverted = Nothing\n        }\n    (CreditCard, USD) -&gt; PaymentResult\n        { resultStatus = \"processed\"\n        , resultMessage = \"Credit card (USD) processed\"\n        , resultAmount = paymentAmount payment\n        , resultConverted = Just (paymentAmount payment * 150)\n        }\n    (BankTransfer, JPY) -&gt; PaymentResult\n        { resultStatus = \"pending\"\n        , resultMessage = \"\u9280\u884c\u632f\u8fbc\u3092\u53d7\u3051\u4ed8\u3051\u307e\u3057\u305f\"\n        , resultAmount = paymentAmount payment\n        , resultConverted = Nothing\n        }\n    (Cash, _) -&gt; PaymentResult\n        { resultStatus = \"processed\"\n        , resultMessage = \"\u73fe\u91d1\u3067\u51e6\u7406\u3057\u307e\u3057\u305f\"\n        , resultAmount = paymentAmount payment\n        , resultConverted = Nothing\n        }\n    _ -&gt; PaymentResult\n        { resultStatus = \"error\"\n        , resultMessage = \"\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u652f\u6255\u3044\u65b9\u6cd5\u3067\u3059\"\n        , resultAmount = paymentAmount payment\n        , resultConverted = Nothing\n        }\n</code></pre>"},{"location":"haskell/03-polymorphism/#3_1","title":"3. \u968e\u5c64\u7684\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1","text":"<p>ADT \u3092\u4f7f\u3063\u3066\u578b\u968e\u5c64\u3092\u8868\u73fe\u3067\u304d\u307e\u3059\uff1a</p> <pre><code>-- | \u53e3\u5ea7\u30bf\u30a4\u30d7\ndata AccountType\n    = Savings\n    | PremiumSavings  -- Savings \u306e\u7279\u5316\u578b\n    | Checking\n    deriving (Show, Eq)\n\n-- | \u53e3\u5ea7\ndata Account = Account\n    { accountType    :: AccountType\n    , accountBalance :: Int\n    } deriving (Show, Eq)\n\n-- | \u5229\u7387\u3092\u53d6\u5f97\ngetInterestRate :: AccountType -&gt; Double\ngetInterestRate Savings        = 0.02\ngetInterestRate PremiumSavings = 0.05\ngetInterestRate Checking       = 0.001\n\n-- | \u5229\u606f\u3092\u8a08\u7b97\ncalculateInterest :: Account -&gt; Double\ncalculateInterest account =\n    fromIntegral (accountBalance account) * getInterestRate (accountType account)\n\n-- \u4f7f\u7528\u4f8b\ncalculateInterest (Account Savings 10000)        -- =&gt; 200.0\ncalculateInterest (Account PremiumSavings 10000) -- =&gt; 500.0\ncalculateInterest (Account Checking 10000)       -- =&gt; 10.0\n</code></pre>"},{"location":"haskell/03-polymorphism/#4","title":"4. \u578b\u30af\u30e9\u30b9\uff08\u30a2\u30c9\u30db\u30c3\u30af\u591a\u76f8\u6027\uff09","text":"<p>\u578b\u30af\u30e9\u30b9\u306f\u3001\u7570\u306a\u308b\u578b\u306b\u5171\u901a\u306e\u64cd\u4f5c\u3092\u5b9a\u7fa9\u3059\u308b Haskell \u306e\u4e3b\u8981\u306a\u591a\u614b\u6027\u30e1\u30ab\u30cb\u30ba\u30e0\u3067\u3059\uff1a</p>"},{"location":"haskell/03-polymorphism/#_3","title":"\u578b\u30af\u30e9\u30b9\u306e\u5b9a\u7fa9","text":"<pre><code>-- | 2D\u5ea7\u6a19\ndata Point = Point\n    { pointX :: Double\n    , pointY :: Double\n    } deriving (Show, Eq)\n\n-- | \u63cf\u753b\u53ef\u80fd\u306a\u578b\u30af\u30e9\u30b9\nclass Drawable a where\n    draw :: a -&gt; String\n    boundingBox :: a -&gt; (Point, Point)  -- (\u6700\u5c0f\u70b9, \u6700\u5927\u70b9)\n\n-- | \u5909\u63db\u53ef\u80fd\u306a\u578b\u30af\u30e9\u30b9\nclass Transformable a where\n    translate :: Double -&gt; Double -&gt; a -&gt; a\n    scale :: Double -&gt; a -&gt; a\n</code></pre>"},{"location":"haskell/03-polymorphism/#_4","title":"\u578b\u30af\u30e9\u30b9\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9","text":"<pre><code>-- | \u77e9\u5f62\ndata Rectangle = Rectangle\n    { rectangleX      :: Double\n    , rectangleY      :: Double\n    , rectangleWidth  :: Double\n    , rectangleHeight :: Double\n    } deriving (Show, Eq)\n\n-- | \u5186\ndata Circle = Circle\n    { circleCenterX :: Double\n    , circleCenterY :: Double\n    , circleR       :: Double\n    } deriving (Show, Eq)\n\n-- Drawable \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\ninstance Drawable Rectangle where\n    draw r = \"Rectangle at (\" ++ show (rectangleX r) ++ \", \" ++ show (rectangleY r) ++ \n             \") with size \" ++ show (rectangleWidth r) ++ \"x\" ++ show (rectangleHeight r)\n    boundingBox r = \n        ( Point (rectangleX r) (rectangleY r)\n        , Point (rectangleX r + rectangleWidth r) (rectangleY r + rectangleHeight r)\n        )\n\ninstance Drawable Circle where\n    draw c = \"Circle at (\" ++ show (circleCenterX c) ++ \", \" ++ show (circleCenterY c) ++ \n             \") with radius \" ++ show (circleR c)\n    boundingBox c =\n        ( Point (circleCenterX c - circleR c) (circleCenterY c - circleR c)\n        , Point (circleCenterX c + circleR c) (circleCenterY c + circleR c)\n        )\n\n-- Transformable \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\ninstance Transformable Rectangle where\n    translate dx dy r = r { rectangleX = rectangleX r + dx, rectangleY = rectangleY r + dy }\n    scale factor r = r { rectangleWidth = rectangleWidth r * factor\n                       , rectangleHeight = rectangleHeight r * factor }\n\ninstance Transformable Circle where\n    translate dx dy c = c { circleCenterX = circleCenterX c + dx\n                          , circleCenterY = circleCenterY c + dy }\n    scale factor c = c { circleR = circleR c * factor }\n</code></pre>"},{"location":"haskell/03-polymorphism/#_5","title":"\u578b\u30af\u30e9\u30b9\u306e\u5229\u70b9","text":"<ol> <li>\u30aa\u30fc\u30d7\u30f3\u306a\u62e1\u5f35: \u65b0\u3057\u3044\u578b\u306b\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8ffd\u52a0\u53ef\u80fd</li> <li>\u578b\u5b89\u5168: \u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u306b\u578b\u30c1\u30a7\u30c3\u30af</li> <li>\u65e2\u5b58\u578b\u306e\u62e1\u5f35: \u81ea\u5206\u3067\u5b9a\u7fa9\u3057\u3066\u3044\u306a\u3044\u578b\u306b\u3082\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u5b9a\u7fa9\u53ef\u80fd</li> </ol>"},{"location":"haskell/03-polymorphism/#5","title":"5. \u5b58\u5728\u578b\u306b\u3088\u308b\u7570\u7a2e\u30b3\u30ec\u30af\u30b7\u30e7\u30f3","text":"<p>\u7570\u306a\u308b\u578b\u3092\u540c\u3058\u30ea\u30b9\u30c8\u306b\u683c\u7d0d\u3059\u308b\u306b\u306f\u5b58\u5728\u578b\u3092\u4f7f\u7528\u3057\u307e\u3059\uff1a</p> <pre><code>-- | \u63cf\u753b\u53ef\u80fd\u306a\u56f3\u5f62\u306e\u30e9\u30c3\u30d1\u30fc\ndata DrawableShape\n    = DrawableRect Rectangle\n    | DrawableCircle Circle\n    deriving (Show, Eq)\n\ninstance Drawable DrawableShape where\n    draw (DrawableRect r) = draw r\n    draw (DrawableCircle c) = draw c\n    boundingBox (DrawableRect r) = boundingBox r\n    boundingBox (DrawableCircle c) = boundingBox c\n\n-- \u7570\u7a2e\u30ea\u30b9\u30c8\u306e\u4f7f\u7528\nshapes :: [DrawableShape]\nshapes = \n    [ DrawableRect (Rectangle 0 0 10 10)\n    , DrawableCircle (Circle 5 5 3)\n    ]\n\n-- \u3059\u3079\u3066\u306e\u56f3\u5f62\u3092\u63cf\u753b\ndrawAll :: [DrawableShape] -&gt; [String]\ndrawAll = map draw\n</code></pre>"},{"location":"haskell/03-polymorphism/#6-expression-problem","title":"6. \u5f0f\u306e\u8a55\u4fa1\uff08Expression Problem\uff09","text":"<p>ADT \u306f\u9589\u3058\u305f\u578b\u306e\u30bb\u30c3\u30c8\u306b\u5bfe\u3059\u308b\u64cd\u4f5c\u306e\u8ffd\u52a0\u306b\u9069\u3057\u3066\u3044\u307e\u3059\uff1a</p> <pre><code>-- | \u5f0f\u3092\u8868\u3059ADT\ndata Expr\n    = Lit Int\n    | Add Expr Expr\n    | Mul Expr Expr\n    | Neg Expr\n    deriving (Show, Eq)\n\n-- | \u5f0f\u3092\u8a55\u4fa1\neval :: Expr -&gt; Int\neval expr = case expr of\n    Lit n     -&gt; n\n    Add e1 e2 -&gt; eval e1 + eval e2\n    Mul e1 e2 -&gt; eval e1 * eval e2\n    Neg e     -&gt; negate (eval e)\n\n-- | \u5f0f\u3092\u6574\u5f62\u8868\u793a\nprettyPrint :: Expr -&gt; String\nprettyPrint expr = case expr of\n    Lit n     -&gt; show n\n    Add e1 e2 -&gt; \"(\" ++ prettyPrint e1 ++ \" + \" ++ prettyPrint e2 ++ \")\"\n    Mul e1 e2 -&gt; \"(\" ++ prettyPrint e1 ++ \" * \" ++ prettyPrint e2 ++ \")\"\n    Neg e     -&gt; \"(-\" ++ prettyPrint e ++ \")\"\n\n-- \u4f7f\u7528\u4f8b\nlet expr = Add (Mul (Lit 2) (Lit 3)) (Neg (Lit 1))\neval expr        -- =&gt; 5\nprettyPrint expr -- =&gt; \"(2 * 3) + (-1)\"\n</code></pre>"},{"location":"haskell/03-polymorphism/#7","title":"7. \u52d5\u7269\u306e\u9cf4\u304d\u58f0\uff08\u53e4\u5178\u7684\u306a\u4f8b\uff09","text":"<pre><code>-- | \u52d5\u7269\u306eADT\ndata Animal\n    = Dog { dogName :: String }\n    | Cat { catName :: String }\n    | Bird { birdName :: String, birdCanFly :: Bool }\n    deriving (Show, Eq)\n\n-- | \u9cf4\u304d\u58f0\nspeak :: Animal -&gt; String\nspeak animal = case animal of\n    Dog name   -&gt; name ++ \" says: Woof!\"\n    Cat name   -&gt; name ++ \" says: Meow!\"\n    Bird name _ -&gt; name ++ \" says: Tweet!\"\n\n-- | \u79fb\u52d5\u65b9\u6cd5\nmove :: Animal -&gt; String\nmove animal = case animal of\n    Dog name      -&gt; name ++ \" runs on four legs\"\n    Cat name      -&gt; name ++ \" prowls silently\"\n    Bird name True -&gt; name ++ \" flies through the air\"\n    Bird name False -&gt; name ++ \" hops on the ground\"\n\n-- \u4f7f\u7528\u4f8b\nspeak (Dog \"Pochi\")      -- =&gt; \"Pochi says: Woof!\"\nmove (Bird \"Kiwi\" False) -- =&gt; \"Kiwi hops on the ground\"\n</code></pre>"},{"location":"haskell/03-polymorphism/#8","title":"8. \u307e\u3068\u3081","text":"\u65b9\u6cd5 \u7528\u9014 \u5229\u70b9 ADT + \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1 \u9589\u3058\u305f\u578b\u30bb\u30c3\u30c8 \u7db2\u7f85\u6027\u30c1\u30a7\u30c3\u30af\u3001\u64cd\u4f5c\u8ffd\u52a0\u304c\u5bb9\u6613 \u578b\u30af\u30e9\u30b9 \u30aa\u30fc\u30d7\u30f3\u306a\u62e1\u5f35 \u65b0\u3057\u3044\u578b\u306e\u8ffd\u52a0\u304c\u5bb9\u6613 \u8907\u5408\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1 \u8907\u6570\u6761\u4ef6\u3067\u306e\u5206\u5c90 \u67d4\u8edf\u306a\u30de\u30c3\u30c1\u30f3\u30b0"},{"location":"haskell/03-polymorphism/#_6","title":"\u6b21\u306e\u30b9\u30c6\u30c3\u30d7","text":"<ul> <li>\u7b2c4\u7ae0\u3067\u306f\u30c7\u30fc\u30bf\u691c\u8a3c\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059</li> <li>\u7b2c5\u7ae0\u3067\u306f\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\uff08QuickCheck\uff09\u3092\u63a2\u308a\u307e\u3059</li> </ul>"},{"location":"haskell/04-data-validation/","title":"\u7b2c4\u7ae0: \u30c7\u30fc\u30bf\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3","text":""},{"location":"haskell/04-data-validation/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Haskell \u3067\u306f\u578b\u30b7\u30b9\u30c6\u30e0\u3068\u7d44\u307f\u5408\u308f\u305b\u3066\u3001\u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u3068\u5b9f\u884c\u6642\u306e\u4e21\u65b9\u3067\u30c7\u30fc\u30bf\u306e\u6574\u5408\u6027\u3092\u4fdd\u8a3c\u3067\u304d\u307e\u3059\u3002\u672c\u7ae0\u3067\u306f\u3001<code>Either</code>\u3001<code>Validated</code> \u30d1\u30bf\u30fc\u30f3\u3001\u30b9\u30de\u30fc\u30c8\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3092\u4f7f\u3063\u305f\u30c7\u30fc\u30bf\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u306e\u624b\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"haskell/04-data-validation/#1-either","title":"1. \u57fa\u672c\u7684\u306a\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\uff08Either \u3092\u4f7f\u7528\uff09","text":""},{"location":"haskell/04-data-validation/#either","title":"Either \u306b\u3088\u308b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3","text":"<p><code>Either a b</code> \u306f\u5931\u6557\u6642\u306b <code>Left</code>\u3001\u6210\u529f\u6642\u306b <code>Right</code> \u3092\u8fd4\u3059\u578b\u3067\u3059\uff1a</p> <pre><code>-- | \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30a8\u30e9\u30fc\u578b\ndata ValidationError\n    = EmptyValue String\n    | TooShort String Int Int  -- field, actual, minimum\n    | TooLong String Int Int   -- field, actual, maximum\n    | OutOfRange String Int Int Int\n    | InvalidFormat String String\n    deriving (Show, Eq)\n\n-- | \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u7d50\u679c\ntype ValidationResult a = Either ValidationError a\n\n-- | \u540d\u524d\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\nvalidateNonEmpty :: String -&gt; String -&gt; ValidationResult String\nvalidateNonEmpty field value\n    | null value = Left (EmptyValue field)\n    | otherwise = Right value\n\n-- | \u5e74\u9f62\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\nvalidateRange :: String -&gt; Int -&gt; Int -&gt; Int -&gt; ValidationResult Int\nvalidateRange field minVal maxVal value\n    | value &lt; minVal || value &gt; maxVal = Left (OutOfRange field value minVal maxVal)\n    | otherwise = Right value\n\n-- \u4f7f\u7528\u4f8b\nvalidateNonEmpty \"name\" \"\u7530\u4e2d\"  -- =&gt; Right \"\u7530\u4e2d\"\nvalidateNonEmpty \"name\" \"\"      -- =&gt; Left (EmptyValue \"name\")\nvalidateRange \"age\" 0 150 25    -- =&gt; Right 25\nvalidateRange \"age\" 0 150 (-1)  -- =&gt; Left (OutOfRange \"age\" (-1) 0 150)\n</code></pre>"},{"location":"haskell/04-data-validation/#2","title":"2. \u30b9\u30de\u30fc\u30c8\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf","text":""},{"location":"haskell/04-data-validation/#_2","title":"\u30c9\u30e1\u30a4\u30f3\u30d7\u30ea\u30df\u30c6\u30a3\u30d6","text":"<p>newtypes \u3068\u30b9\u30de\u30fc\u30c8\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u3001\u4e0d\u6b63\u306a\u5024\u3092\u578b\u30ec\u30d9\u30eb\u3067\u9632\u304e\u307e\u3059\uff1a</p> <pre><code>-- | Name \u30c9\u30e1\u30a4\u30f3\u578b\nnewtype Name = Name { unName :: String }\n    deriving (Show, Eq)\n\n-- | \u30b9\u30de\u30fc\u30c8\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\nmkName :: String -&gt; ValidationResult Name\nmkName value = do\n    _ &lt;- validateNonEmpty \"name\" value\n    _ &lt;- validateMaxLength \"name\" 100 value\n    Right (Name value)\n\n-- | Age \u30c9\u30e1\u30a4\u30f3\u578b\nnewtype Age = Age { unAge :: Int }\n    deriving (Show, Eq)\n\nmkAge :: Int -&gt; ValidationResult Age\nmkAge value = do\n    _ &lt;- validateRange \"age\" 0 150 value\n    Right (Age value)\n\n-- | Email \u30c9\u30e1\u30a4\u30f3\u578b\nnewtype Email = Email { unEmail :: String }\n    deriving (Show, Eq)\n\nmkEmail :: String -&gt; ValidationResult Email\nmkEmail value = do\n    _ &lt;- validateNonEmpty \"email\" value\n    _ &lt;- validateEmail value\n    Right (Email value)\n\n-- \u4f7f\u7528\u4f8b\nmkName \"\u7530\u4e2d\u592a\u90ce\"  -- =&gt; Right (Name \"\u7530\u4e2d\u592a\u90ce\")\nmkName \"\"          -- =&gt; Left (EmptyValue \"name\")\nmkAge 25           -- =&gt; Right (Age 25)\nmkAge 200          -- =&gt; Left (OutOfRange \"age\" 200 0 150)\n</code></pre>"},{"location":"haskell/04-data-validation/#3-validated","title":"3. Validated \u30d1\u30bf\u30fc\u30f3\uff08\u30a8\u30e9\u30fc\u84c4\u7a4d\uff09","text":"<p><code>Either</code> \u306f\u6700\u521d\u306e\u30a8\u30e9\u30fc\u3067\u505c\u6b62\u3057\u307e\u3059\u304c\u3001\u3059\u3079\u3066\u306e\u30a8\u30e9\u30fc\u3092\u53ce\u96c6\u3057\u305f\u3044\u5834\u5408\u306f <code>Validated</code> \u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u7528\uff1a</p> <pre><code>-- | Validated \u578b\ndata Validated a\n    = Valid a\n    | Invalid [ValidationError]\n    deriving (Show, Eq)\n\ninstance Functor Validated where\n    fmap f (Valid a) = Valid (f a)\n    fmap _ (Invalid es) = Invalid es\n\ninstance Applicative Validated where\n    pure = Valid\n    Valid f &lt;*&gt; Valid a = Valid (f a)\n    Invalid es1 &lt;*&gt; Invalid es2 = Invalid (es1 ++ es2)  -- \u30a8\u30e9\u30fc\u3092\u84c4\u7a4d\n    Invalid es &lt;*&gt; _ = Invalid es\n    _ &lt;*&gt; Invalid es = Invalid es\n\n-- | Either \u304b\u3089 Validated \u3078\u306e\u5909\u63db\nfromResult :: ValidationResult a -&gt; Validated a\nfromResult (Right a) = Valid a\nfromResult (Left e) = Invalid [e]\n\n-- \u4f7f\u7528\u4f8b\uff1a\u8907\u6570\u30d5\u30a3\u30fc\u30eb\u30c9\u306e\u691c\u8a3c\nvalidatePersonV :: String -&gt; Int -&gt; String -&gt; Validated (Name, Age, Email)\nvalidatePersonV name age email =\n    (,,) &lt;$&gt; fromResult (mkName name)\n         &lt;*&gt; fromResult (mkAge age)\n         &lt;*&gt; fromResult (mkEmail email)\n\n-- \u6709\u52b9\u306a\u30c7\u30fc\u30bf\nvalidatePersonV \"\u7530\u4e2d\" 30 \"tanaka@example.com\"\n-- =&gt; Valid (Name \"\u7530\u4e2d\", Age 30, Email \"tanaka@example.com\")\n\n-- \u8907\u6570\u306e\u30a8\u30e9\u30fc\nvalidatePersonV \"\" (-5) \"invalid\"\n-- =&gt; Invalid [EmptyValue \"name\", OutOfRange \"age\" (-5) 0 150, InvalidFormat \"email\" \"invalid\"]\n</code></pre>"},{"location":"haskell/04-data-validation/#4_1","title":"4. \u5217\u6319\u578b\u3068\u30d1\u30fc\u30b5\u30fc","text":"<pre><code>-- | \u4f1a\u54e1\u7a2e\u5225\ndata Membership = Bronze | Silver | Gold | Platinum\n    deriving (Show, Eq, Ord, Enum, Bounded)\n\n-- | \u6587\u5b57\u5217\u304b\u3089\u30d1\u30fc\u30b9\nparseMembership :: String -&gt; ValidationResult Membership\nparseMembership s = case map toLower s of\n    \"bronze\" -&gt; Right Bronze\n    \"silver\" -&gt; Right Silver\n    \"gold\" -&gt; Right Gold\n    \"platinum\" -&gt; Right Platinum\n    _ -&gt; Left (InvalidValue \"membership\" (\"unknown: \" ++ s))\n\n-- | \u6587\u5b57\u5217\u3078\u5909\u63db\nmembershipToString :: Membership -&gt; String\nmembershipToString Bronze = \"bronze\"\nmembershipToString Silver = \"silver\"\nmembershipToString Gold = \"gold\"\nmembershipToString Platinum = \"platinum\"\n</code></pre>"},{"location":"haskell/04-data-validation/#5","title":"5. \u8907\u5408\u30c7\u30fc\u30bf\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3","text":""},{"location":"haskell/04-data-validation/#person","title":"Person \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3","text":"<pre><code>-- | Person \u30ec\u30b3\u30fc\u30c9\ndata Person = Person\n    { personName :: Name\n    , personAge  :: Age\n    , personEmail :: Maybe Email\n    , personMembership :: Maybe Membership\n    } deriving (Show, Eq)\n\n-- | \u5165\u529b\u30c7\u30fc\u30bf\ndata PersonInput = PersonInput\n    { inputName :: String\n    , inputAge :: Int\n    , inputEmail :: Maybe String\n    , inputMembership :: Maybe String\n    } deriving (Show, Eq)\n\n-- | \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\uff08do \u8a18\u6cd5\u3067\u9023\u9396\uff09\nvalidatePerson :: PersonInput -&gt; ValidationResult Person\nvalidatePerson input = do\n    name &lt;- mkName (inputName input)\n    age &lt;- mkAge (inputAge input)\n    email &lt;- traverse mkEmail (inputEmail input)\n    membership &lt;- traverse parseMembership (inputMembership input)\n    Right Person\n        { personName = name\n        , personAge = age\n        , personEmail = email\n        , personMembership = membership\n        }\n</code></pre>"},{"location":"haskell/04-data-validation/#_3","title":"\u6ce8\u6587\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3","text":"<pre><code>-- | \u5546\u54c1ID\uff08PROD-XXXXX\u5f62\u5f0f\uff09\nnewtype ProductId = ProductId { unProductId :: String }\n    deriving (Show, Eq)\n\nmkProductId :: String -&gt; ValidationResult ProductId\nmkProductId value\n    | length value == 10 &amp;&amp;\n      take 5 value == \"PROD-\" &amp;&amp;\n      all isDigit (drop 5 value) = Right (ProductId value)\n    | otherwise = Left (InvalidFormat \"product ID\" value)\n\n-- | \u5546\u54c1\ndata Product = Product\n    { productId :: ProductId\n    , productName :: String\n    , productPrice :: Int\n    } deriving (Show, Eq)\n\n-- | \u6ce8\u6587\u30a2\u30a4\u30c6\u30e0\ndata OrderItem = OrderItem\n    { orderItemProduct :: Product\n    , orderItemQuantity :: Int\n    } deriving (Show, Eq)\n\n-- | \u6ce8\u6587\ndata Order = Order\n    { orderItems :: [OrderItem]\n    , orderCustomer :: Person\n    } deriving (Show, Eq)\n</code></pre>"},{"location":"haskell/04-data-validation/#6","title":"6. \u307e\u3068\u3081","text":"\u30d1\u30bf\u30fc\u30f3 \u7528\u9014 \u7279\u5fb4 Either \u9806\u6b21\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3 \u6700\u521d\u306e\u30a8\u30e9\u30fc\u3067\u505c\u6b62 Validated \u4e26\u5217\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3 \u3059\u3079\u3066\u306e\u30a8\u30e9\u30fc\u3092\u53ce\u96c6 Smart Constructor \u30c9\u30e1\u30a4\u30f3\u30d7\u30ea\u30df\u30c6\u30a3\u30d6 \u578b\u5b89\u5168\u306a\u5024\u306e\u4f5c\u6210 newtype \u578b\u306e\u533a\u5225 \u30e9\u30f3\u30bf\u30a4\u30e0\u30b3\u30b9\u30c8\u306a\u3057"},{"location":"haskell/05-property-based-testing/","title":"\u7b2c5\u7ae0: \u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8","text":""},{"location":"haskell/05-property-based-testing/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u5f93\u6765\u306e\u5358\u4f53\u30c6\u30b9\u30c8\u3067\u306f\u7279\u5b9a\u306e\u5165\u529b\u306b\u5bfe\u3059\u308b\u51fa\u529b\u3092\u691c\u8a3c\u3057\u307e\u3059\u304c\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u3067\u306f\u3001\u3059\u3079\u3066\u306e\u5165\u529b\u306b\u5bfe\u3057\u3066\u6210\u308a\u7acb\u3064\u3079\u304d\u300c\u6027\u8cea\uff08\u30d7\u30ed\u30d1\u30c6\u30a3\uff09\u300d\u3092\u5b9a\u7fa9\u3057\u3001\u30e9\u30f3\u30c0\u30e0\u306b\u751f\u6210\u3055\u308c\u305f\u591a\u6570\u306e\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u3067\u691c\u8a3c\u3057\u307e\u3059\u3002</p> <p>Haskell \u3067\u306f QuickCheck \u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u7528\u3057\u3066\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u3092\u884c\u3044\u307e\u3059\u3002</p>"},{"location":"haskell/05-property-based-testing/#1","title":"1. \u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u3068\u306f","text":""},{"location":"haskell/05-property-based-testing/#_2","title":"\u5f93\u6765\u306e\u30c6\u30b9\u30c8\u3068\u306e\u9055\u3044","text":"<pre><code>-- \u5f93\u6765\u306e\u30c6\u30b9\u30c8\uff1a\u7279\u5b9a\u306e\u5165\u529b\u306b\u5bfe\u3059\u308b\u51fa\u529b\u3092\u691c\u8a3c\nspec :: Spec\nspec = do\n    it \"reverses 'hello' to 'olleh'\" $\n        reverseString \"hello\" `shouldBe` \"olleh\"\n    it \"reverses empty string\" $\n        reverseString \"\" `shouldBe` \"\"\n\n-- \u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\uff1a\u6027\u8cea\u3092\u691c\u8a3c\nspec :: Spec\nspec = do\n    it \"reversing twice returns original\" $ property $\n        \\s -&gt; reverseString (reverseString s) == (s :: String)\n</code></pre>"},{"location":"haskell/05-property-based-testing/#_3","title":"\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u306e\u5229\u70b9","text":"<ol> <li>\u7db2\u7f85\u6027: \u624b\u52d5\u3067\u306f\u601d\u3044\u3064\u304b\u306a\u3044\u30a8\u30c3\u30b8\u30b1\u30fc\u30b9\u3092\u767a\u898b</li> <li>\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u6027: \u30b3\u30fc\u30c9\u306e\u6027\u8cea\u3092\u660e\u78ba\u306b\u8868\u73fe</li> <li>\u56de\u5e30\u9632\u6b62: \u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u6642\u306e\u5b89\u5168\u7db2</li> <li>\u30b7\u30e5\u30ea\u30f3\u30ad\u30f3\u30b0: \u5931\u6557\u6642\u306b\u6700\u5c0f\u306e\u53cd\u4f8b\u3092\u63d0\u793a</li> </ol>"},{"location":"haskell/05-property-based-testing/#2-quickcheck","title":"2. QuickCheck \u306e\u57fa\u672c","text":""},{"location":"haskell/05-property-based-testing/#_4","title":"\u57fa\u672c\u7684\u306a\u30d7\u30ed\u30d1\u30c6\u30a3","text":"<pre><code>import Test.QuickCheck\n\n-- \u6587\u5b57\u5217\u306e\u53cd\u8ee2\nprop_reverseInvolutory :: String -&gt; Bool\nprop_reverseInvolutory s = reverse (reverse s) == s\n\n-- \u9577\u3055\u306e\u4fdd\u5b58\nprop_reversePreservesLength :: String -&gt; Bool\nprop_reversePreservesLength s = length (reverse s) == length s\n\n-- \u30c6\u30b9\u30c8\u5b9f\u884c\nmain = do\n    quickCheck prop_reverseInvolutory\n    -- +++ OK, passed 100 tests.\n</code></pre>"},{"location":"haskell/05-property-based-testing/#_5","title":"\u6761\u4ef6\u4ed8\u304d\u30d7\u30ed\u30d1\u30c6\u30a3\uff08==&gt;\uff09","text":"<pre><code>-- \u6b63\u306e\u6570\u306b\u5bfe\u3057\u3066\u306e\u307f\u30c6\u30b9\u30c8\nprop_sqrtPositive :: Int -&gt; Property\nprop_sqrtPositive n = n &gt; 0 ==&gt; sqrt (fromIntegral n) &gt;= 0\n\n-- FizzBuzz: 3\u306e\u500d\u6570\u306e\u307f\nprop_fizzForMultiplesOf3Only :: Positive Int -&gt; Property\nprop_fizzForMultiplesOf3Only (Positive n) =\n    let num = n * 3\n    in num `mod` 5 /= 0 ==&gt; fizzBuzz num == \"Fizz\"\n</code></pre>"},{"location":"haskell/05-property-based-testing/#3","title":"3. \u30ea\u30b9\u30c8\u95a2\u6570\u306e\u30d7\u30ed\u30d1\u30c6\u30a3","text":""},{"location":"haskell/05-property-based-testing/#_6","title":"\u30bd\u30fc\u30c8\u306e\u30d7\u30ed\u30d1\u30c6\u30a3","text":"<pre><code>-- \u30bd\u30fc\u30c8\u7d50\u679c\u306f\u6574\u5217\u6e08\u307f\nprop_sortedIsSorted :: [Int] -&gt; Bool\nprop_sortedIsSorted xs = isSorted (sort xs)\n  where\n    isSorted [] = True\n    isSorted [_] = True\n    isSorted (x:y:rest) = x &lt;= y &amp;&amp; isSorted (y:rest)\n\n-- \u30bd\u30fc\u30c8\u7d50\u679c\u306f\u540c\u3058\u9577\u3055\nprop_sortPreservesLength :: [Int] -&gt; Bool\nprop_sortPreservesLength xs = length (sort xs) == length xs\n\n-- \u30bd\u30fc\u30c8\u306f\u51aa\u7b49\nprop_sortIdempotent :: [Int] -&gt; Bool\nprop_sortIdempotent xs = sort (sort xs) == sort xs\n\n-- \u30bd\u30fc\u30c8\u7d50\u679c\u306f\u540c\u3058\u8981\u7d20\u3092\u6301\u3064\nprop_sortSameElements :: [Int] -&gt; Bool\nprop_sortSameElements xs = sort (sort xs) == sort xs\n</code></pre>"},{"location":"haskell/05-property-based-testing/#_7","title":"\u30d5\u30a3\u30eb\u30bf\u30fc\u306e\u30d7\u30ed\u30d1\u30c6\u30a3","text":"<pre><code>-- \u30d5\u30a3\u30eb\u30bf\u30fc\u7d50\u679c\u306f\u3059\u3079\u3066\u8ff0\u8a9e\u3092\u6e80\u305f\u3059\nprop_filterAllSatisfy :: [Int] -&gt; Bool\nprop_filterAllSatisfy xs = all even (filter even xs)\n\n-- const True \u3067\u30d5\u30a3\u30eb\u30bf\u30fc\u306f\u6052\u7b49\nprop_filterTrue :: [Int] -&gt; Bool\nprop_filterTrue xs = filter (const True) xs == xs\n\n-- const False \u3067\u30d5\u30a3\u30eb\u30bf\u30fc\u306f\u7a7a\nprop_filterFalse :: [Int] -&gt; Bool\nprop_filterFalse xs = null (filter (const False) xs)\n</code></pre>"},{"location":"haskell/05-property-based-testing/#4","title":"4. \u6570\u5b66\u95a2\u6570\u306e\u30d7\u30ed\u30d1\u30c6\u30a3","text":""},{"location":"haskell/05-property-based-testing/#_8","title":"\u7d76\u5bfe\u5024","text":"<pre><code>-- \u7d76\u5bfe\u5024\u306f\u975e\u8ca0\nprop_absNonNegative :: Int -&gt; Bool\nprop_absNonNegative n = abs n &gt;= 0\n\n-- \u7d76\u5bfe\u5024\u306f\u51aa\u7b49\nprop_absIdempotent :: Int -&gt; Bool\nprop_absIdempotent n = abs (abs n) == abs n\n\n-- \u8ca0\u6570\u306e\u7d76\u5bfe\u5024\nprop_absOfNegative :: Positive Int -&gt; Bool\nprop_absOfNegative (Positive n) = abs (-n) == n\n</code></pre>"},{"location":"haskell/05-property-based-testing/#_9","title":"\u968e\u4e57","text":"<pre><code>-- \u968e\u4e57\u306f\u6b63\uff08\u975e\u8ca0\u5165\u529b\u306b\u5bfe\u3057\u3066\uff09\nprop_factorialPositive :: NonNegative Int -&gt; Bool\nprop_factorialPositive (NonNegative n) =\n    let n' = min n 20  -- \u5927\u304d\u3044\u6570\u3092\u907f\u3051\u308b\n    in factorial n' &gt; 0\n\n-- \u30d5\u30a3\u30dc\u30ca\u30c3\u30c1\u306e\u6f38\u5316\u5f0f\nprop_fibRecurrence :: NonNegative Int -&gt; Bool\nprop_fibRecurrence (NonNegative n) =\n    let n' = min n 20\n    in n' &lt; 2 || fibonacci n' == fibonacci (n' - 1) + fibonacci (n' - 2)\n</code></pre>"},{"location":"haskell/05-property-based-testing/#5_1","title":"5. \u4ee3\u6570\u7684\u6027\u8cea","text":""},{"location":"haskell/05-property-based-testing/#money","title":"Money \u578b\u306e\u6f14\u7b97","text":"<pre><code>data Money = Money { amount :: Int, currency :: String }\n    deriving (Show, Eq)\n\n-- \u52a0\u7b97\u306e\u53ef\u63db\u6027\nprop_addCommutative :: Int -&gt; Int -&gt; Bool\nprop_addCommutative a1 a2 =\n    let m1 = Money a1 \"JPY\"\n        m2 = Money a2 \"JPY\"\n    in addMoney m1 m2 == addMoney m2 m1\n\n-- \u52a0\u7b97\u306e\u7d50\u5408\u6027\nprop_addAssociative :: Int -&gt; Int -&gt; Int -&gt; Bool\nprop_addAssociative a1 a2 a3 =\n    let m1 = Money a1 \"JPY\"\n        m2 = Money a2 \"JPY\"\n        m3 = Money a3 \"JPY\"\n        left = addMoney m1 m2 &gt;&gt;= \\s -&gt; addMoney s m3\n        right = addMoney m2 m3 &gt;&gt;= \\s -&gt; addMoney m1 s\n    in left == right\n\n-- \u4e57\u7b97\u306e\u5358\u4f4d\u5143\nprop_multiplyIdentity :: Int -&gt; Bool\nprop_multiplyIdentity a =\n    let m = Money a \"JPY\"\n    in multiplyMoney m 1 == m\n\n-- \u4e57\u7b97\u306e\u96f6\u5143\nprop_multiplyZero :: Int -&gt; Bool\nprop_multiplyZero a =\n    let m = Money a \"JPY\"\n    in multiplyMoney m 0 == Money 0 \"JPY\"\n</code></pre>"},{"location":"haskell/05-property-based-testing/#6","title":"6. \u30b9\u30bf\u30c3\u30af\u64cd\u4f5c\u306e\u30d7\u30ed\u30d1\u30c6\u30a3","text":"<pre><code>-- push \u3057\u3066 pop \u3059\u308b\u3068\u5143\u306e\u8981\u7d20\u304c\u8fd4\u308b\nprop_pushPop :: Int -&gt; Bool\nprop_pushPop x =\n    let s = push x emptyStack\n    in pop s == Just (x, emptyStack)\n\n-- push \u3059\u308b\u3068\u30b5\u30a4\u30ba\u304c\u5897\u3048\u308b\nprop_pushIncreasesSize :: Int -&gt; [Int] -&gt; Bool\nprop_pushIncreasesSize x xs =\n    let s = foldr push emptyStack xs\n        s' = push x s\n    in size s' == size s + 1\n\n-- isEmpty \u306f\u7a7a\u30b9\u30bf\u30c3\u30af\u3067\u306e\u307f True\nprop_isEmptyAfterPush :: Int -&gt; Bool\nprop_isEmptyAfterPush x = not (isEmpty (push x emptyStack))\n\n-- peek \u306f pop \u3068\u540c\u3058\u8981\u7d20\u3092\u8fd4\u3059\nprop_peekEqualsPopFirst :: Int -&gt; Bool\nprop_peekEqualsPopFirst x =\n    let s = push x emptyStack\n    in peek s == fmap fst (pop s)\n</code></pre>"},{"location":"haskell/05-property-based-testing/#7","title":"7. \u30e9\u30a6\u30f3\u30c9\u30c8\u30ea\u30c3\u30d7\u30d7\u30ed\u30d1\u30c6\u30a3","text":"<pre><code>-- Roman numerals: toRoman \u3068 fromRoman \u306e\u5f80\u5fa9\nprop_romanRoundtrip :: Positive Int -&gt; Bool\nprop_romanRoundtrip (Positive n) =\n    let num = (n `mod` 3999) + 1  -- \u6709\u52b9\u7bc4\u56f2 1-3999\n    in fromRoman (toRoman num) == num\n\n-- \u7d20\u56e0\u6570\u5206\u89e3: \u7a4d\u306f\u5143\u306e\u6570\nprop_primeFactorsProduct :: Positive Int -&gt; Bool\nprop_primeFactorsProduct (Positive n) =\n    let n' = max 2 (n `mod` 1000)\n    in product (primeFactors n') == n'\n</code></pre>"},{"location":"haskell/05-property-based-testing/#8","title":"8. \u307e\u3068\u3081","text":"\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u7a2e\u985e \u4f8b \u51aa\u7b49\u6027 <code>f (f x) == f x</code> \u6052\u7b49\u6027 <code>reverse (reverse x) == x</code> \u53ef\u63db\u6027 <code>f x y == f y x</code> \u7d50\u5408\u6027 <code>f (f x y) z == f x (f y z)</code> \u9577\u3055\u4fdd\u5b58 <code>length (f xs) == length xs</code> \u7bc4\u56f2\u5236\u7d04 <code>f x &gt;= 0</code> \u30e9\u30a6\u30f3\u30c9\u30c8\u30ea\u30c3\u30d7 <code>decode (encode x) == x</code>"},{"location":"haskell/05-property-based-testing/#quickcheck","title":"QuickCheck \u306e\u30d2\u30f3\u30c8","text":"<pre><code>-- \u30ab\u30b9\u30bf\u30e0\u751f\u6210\u5668\ngenAge :: Gen Int\ngenAge = choose (0, 150)\n\n-- \u30b5\u30a4\u30ba\u5236\u9650\ngenSmallList :: Gen [Int]\ngenSmallList = resize 10 (listOf arbitrary)\n\n-- NonNegative, Positive \u306a\u3069\u306e\u578b\u30e9\u30c3\u30d1\u30fc\nprop_example :: NonNegative Int -&gt; Positive Int -&gt; Bool\nprop_example (NonNegative n) (Positive p) = ...\n</code></pre>"},{"location":"haskell/06-tdd-functional/","title":"\u7b2c6\u7ae0: \u30c6\u30b9\u30c8\u99c6\u52d5\u958b\u767a\u3068\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0","text":""},{"location":"haskell/06-tdd-functional/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u30c6\u30b9\u30c8\u99c6\u52d5\u958b\u767a\uff08TDD\uff09\u306f\u3001\u30c6\u30b9\u30c8\u3092\u5148\u306b\u66f8\u3044\u3066\u304b\u3089\u5b9f\u88c5\u3092\u884c\u3046\u958b\u767a\u624b\u6cd5\u3067\u3059\u3002\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3068 TDD \u306f\u76f8\u6027\u304c\u826f\u304f\u3001\u7d14\u7c8b\u95a2\u6570\u306f\u30c6\u30b9\u30c8\u304c\u5bb9\u6613\u3067\u3001\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u306f\u4e88\u6e2c\u53ef\u80fd\u306a\u52d5\u4f5c\u3092\u4fdd\u8a3c\u3057\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001Red-Green-Refactor \u30b5\u30a4\u30af\u30eb\u3092 Haskell \u3067\u5b9f\u8df5\u3059\u308b\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"haskell/06-tdd-functional/#1-tdd","title":"1. TDD \u306e\u57fa\u672c\u30b5\u30a4\u30af\u30eb","text":"<ol> <li>Red\uff08\u8d64\uff09: \u5931\u6557\u3059\u308b\u30c6\u30b9\u30c8\u3092\u66f8\u304f</li> <li>Green\uff08\u7dd1\uff09: \u30c6\u30b9\u30c8\u3092\u901a\u3059\u6700\u5c0f\u9650\u306e\u30b3\u30fc\u30c9\u3092\u66f8\u304f</li> <li>Refactor\uff08\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\uff09: \u30b3\u30fc\u30c9\u3092\u6539\u5584\u3059\u308b</li> </ol>"},{"location":"haskell/06-tdd-functional/#2-fizzbuzz-tdd","title":"2. FizzBuzz - TDD \u306e\u5178\u578b\u4f8b","text":""},{"location":"haskell/06-tdd-functional/#step-1-red","title":"Step 1: Red\uff08\u6700\u521d\u306e\u30c6\u30b9\u30c8\uff09","text":"<pre><code>-- test/TddFunctionalSpec.hs\nspec :: Spec\nspec = do\n    describe \"FizzBuzz\" $ do\n        it \"1 returns \\\"1\\\"\" $\n            fizzBuzz 1 `shouldBe` \"1\"\n</code></pre>"},{"location":"haskell/06-tdd-functional/#step-2-green","title":"Step 2: Green\uff08\u6700\u5c0f\u9650\u306e\u5b9f\u88c5\uff09","text":"<pre><code>-- src/TddFunctional.hs\nfizzBuzz :: Int -&gt; String\nfizzBuzz _ = \"1\"\n</code></pre>"},{"location":"haskell/06-tdd-functional/#step-3","title":"Step 3: \u6b21\u306e\u30c6\u30b9\u30c8\u3092\u8ffd\u52a0","text":"<pre><code>it \"2 returns \\\"2\\\"\" $\n    fizzBuzz 2 `shouldBe` \"2\"\n</code></pre>"},{"location":"haskell/06-tdd-functional/#_2","title":"\u6bb5\u968e\u7684\u306b\u5b9f\u88c5\u3092\u767a\u5c55","text":"<pre><code>-- \u5c0f\u3055\u306a\u30d8\u30eb\u30d1\u30fc\u95a2\u6570\u306b\u5206\u5272\nfizz :: Int -&gt; Bool\nfizz n = n `mod` 3 == 0\n\nbuzz :: Int -&gt; Bool\nbuzz n = n `mod` 5 == 0\n\nfizzBuzz :: Int -&gt; String\nfizzBuzz n\n    | fizz n &amp;&amp; buzz n = \"FizzBuzz\"\n    | fizz n = \"Fizz\"\n    | buzz n = \"Buzz\"\n    | otherwise = show n\n</code></pre>"},{"location":"haskell/06-tdd-functional/#_3","title":"\u6700\u7d42\u30c6\u30b9\u30c8\u30b9\u30a4\u30fc\u30c8","text":"<pre><code>describe \"FizzBuzz (Basic TDD)\" $ do\n    it \"1 returns \\\"1\\\"\" $\n        fizzBuzz 1 `shouldBe` \"1\"\n    it \"2 returns \\\"2\\\"\" $\n        fizzBuzz 2 `shouldBe` \"2\"\n    it \"3 returns \\\"Fizz\\\"\" $\n        fizzBuzz 3 `shouldBe` \"Fizz\"\n    it \"5 returns \\\"Buzz\\\"\" $\n        fizzBuzz 5 `shouldBe` \"Buzz\"\n    it \"15 returns \\\"FizzBuzz\\\"\" $\n        fizzBuzz 15 `shouldBe` \"FizzBuzz\"\n</code></pre>"},{"location":"haskell/06-tdd-functional/#3","title":"3. \u30ed\u30fc\u30de\u6570\u5b57\u5909\u63db","text":""},{"location":"haskell/06-tdd-functional/#tdd","title":"TDD \u3067\u6bb5\u968e\u7684\u306b\u5b9f\u88c5","text":"<pre><code>-- Step 1: \u6700\u521d\u306e\u30c6\u30b9\u30c8\nit \"converts 1 to I\" $\n    toRoman 1 `shouldBe` \"I\"\n\n-- Step 2: \u6700\u5c0f\u9650\u306e\u5b9f\u88c5\ntoRoman :: Int -&gt; String\ntoRoman 1 = \"I\"\ntoRoman _ = \"\"\n\n-- Step 3: \u30c6\u30b9\u30c8\u3092\u8ffd\u52a0\u3057\u306a\u304c\u3089\u767a\u5c55\nit \"converts 4 to IV\" $\n    toRoman 4 `shouldBe` \"IV\"\nit \"converts 5 to V\" $\n    toRoman 5 `shouldBe` \"V\"\n</code></pre>"},{"location":"haskell/06-tdd-functional/#_4","title":"\u5b8c\u6210\u3057\u305f\u5b9f\u88c5","text":"<pre><code>toRoman :: Int -&gt; String\ntoRoman n\n    | n &lt;= 0 = \"\"\n    | n &gt;= 1000 = \"M\" ++ toRoman (n - 1000)\n    | n &gt;= 900 = \"CM\" ++ toRoman (n - 900)\n    | n &gt;= 500 = \"D\" ++ toRoman (n - 500)\n    | n &gt;= 400 = \"CD\" ++ toRoman (n - 400)\n    | n &gt;= 100 = \"C\" ++ toRoman (n - 100)\n    | n &gt;= 90 = \"XC\" ++ toRoman (n - 90)\n    | n &gt;= 50 = \"L\" ++ toRoman (n - 50)\n    | n &gt;= 40 = \"XL\" ++ toRoman (n - 40)\n    | n &gt;= 10 = \"X\" ++ toRoman (n - 10)\n    | n &gt;= 9 = \"IX\" ++ toRoman (n - 9)\n    | n &gt;= 5 = \"V\" ++ toRoman (n - 5)\n    | n &gt;= 4 = \"IV\" ++ toRoman (n - 4)\n    | otherwise = \"I\" ++ toRoman (n - 1)\n\nfromRoman :: String -&gt; Int\nfromRoman = go 0\n  where\n    go acc [] = acc\n    go acc [x] = acc + romanCharValue x\n    go acc (x:y:rest)\n        | romanCharValue x &lt; romanCharValue y = go (acc - romanCharValue x) (y:rest)\n        | otherwise = go (acc + romanCharValue x) (y:rest)\n\n    romanCharValue 'I' = 1\n    romanCharValue 'V' = 5\n    romanCharValue 'X' = 10\n    romanCharValue 'L' = 50\n    romanCharValue 'C' = 100\n    romanCharValue 'D' = 500\n    romanCharValue 'M' = 1000\n    romanCharValue _ = 0\n</code></pre>"},{"location":"haskell/06-tdd-functional/#4","title":"4. \u30dc\u30a6\u30ea\u30f3\u30b0\u30b9\u30b3\u30a2","text":""},{"location":"haskell/06-tdd-functional/#_5","title":"\u30b2\u30fc\u30e0\u306e\u72b6\u614b","text":"<pre><code>type Game = ([Int], Int)  -- (rolls, current frame)\n\nnewGame :: Game\nnewGame = ([], 1)\n\nroll :: Int -&gt; Game -&gt; Game\nroll pins (rolls, frame) = (rolls ++ [pins], frame)\n</code></pre>"},{"location":"haskell/06-tdd-functional/#_6","title":"\u30b9\u30b3\u30a2\u8a08\u7b97","text":"<pre><code>score :: Game -&gt; Int\nscore (rolls, _) = scoreFrames rolls 1 0\n\nscoreFrames :: [Int] -&gt; Int -&gt; Int -&gt; Int\nscoreFrames _ 11 acc = acc  -- 10\u30d5\u30ec\u30fc\u30e0\u8d85\u3048\u305f\u3089\u7d42\u4e86\nscoreFrames [] _ acc = acc\nscoreFrames rolls@(r1:rest) frame acc\n    | frame == 10 = acc + sum rolls  -- 10\u30d5\u30ec\u30fc\u30e0\u76ee\n    | r1 == 10 = scoreFrames rest (frame + 1) (acc + 10 + bonus2 rest)  -- Strike\n    | otherwise = case rest of\n        [] -&gt; acc + r1\n        (r2:rest2)\n            | r1 + r2 == 10 -&gt; scoreFrames rest2 (frame + 1) (acc + 10 + bonus1 rest2)  -- Spare\n            | otherwise -&gt; scoreFrames rest2 (frame + 1) (acc + r1 + r2)\n  where\n    bonus1 (x:_) = x\n    bonus1 [] = 0\n    bonus2 (x:y:_) = x + y\n    bonus2 (x:_) = x\n    bonus2 [] = 0\n</code></pre>"},{"location":"haskell/06-tdd-functional/#_7","title":"\u30c6\u30b9\u30c8","text":"<pre><code>describe \"Bowling Game\" $ do\n    it \"starts with score 0\" $\n        score newGame `shouldBe` 0\n\n    it \"scores 0 for all zeros\" $ do\n        let game = foldr roll newGame (replicate 20 0)\n        score game `shouldBe` 0\n\n    it \"scores 20 for all ones\" $ do\n        let game = foldr roll newGame (replicate 20 1)\n        score game `shouldBe` 20\n\n    it \"spare adds next roll bonus\" $ do\n        let rolls = [5, 5, 3] ++ replicate 17 0\n        let game = foldr roll newGame (reverse rolls)\n        score game `shouldBe` 16\n</code></pre>"},{"location":"haskell/06-tdd-functional/#5-string-calculator-kata","title":"5. String Calculator Kata","text":"<pre><code>add :: String -&gt; Int\nadd \"\" = 0\nadd s = sum $ parseNumbers s\n\nparseNumbers :: String -&gt; [Int]\nparseNumbers s = map read $ splitOn ',' $ map replaceNewline s\n  where\n    replaceNewline '\\n' = ','\n    replaceNewline c = c\n\n    splitOn _ [] = []\n    splitOn delim str = \n        let (before, after) = break (== delim) str\n        in before : case after of\n            [] -&gt; []\n            (_:rest) -&gt; splitOn delim rest\n</code></pre>"},{"location":"haskell/06-tdd-functional/#6_1","title":"6. \u7d20\u56e0\u6570\u5206\u89e3","text":"<pre><code>primeFactors :: Int -&gt; [Int]\nprimeFactors n = factorize n 2\n  where\n    factorize 1 _ = []\n    factorize num factor\n        | factor * factor &gt; num = [num]\n        | num `mod` factor == 0 = factor : factorize (num `div` factor) factor\n        | otherwise = factorize num (factor + 1)\n</code></pre>"},{"location":"haskell/06-tdd-functional/#_8","title":"\u30c6\u30b9\u30c8","text":"<pre><code>describe \"Prime Factors\" $ do\n    it \"returns empty for 1\" $\n        primeFactors 1 `shouldBe` []\n    it \"returns [2] for 2\" $\n        primeFactors 2 `shouldBe` [2]\n    it \"returns [2,2] for 4\" $\n        primeFactors 4 `shouldBe` [2, 2]\n    it \"returns [2,3] for 6\" $\n        primeFactors 6 `shouldBe` [2, 3]\n\n    -- \u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\n    it \"product of factors equals original\" $ property $\n        \\(Positive n) -&gt;\n            let n' = max 2 (n `mod` 1000)\n            in product (primeFactors n') == n'\n</code></pre>"},{"location":"haskell/06-tdd-functional/#7","title":"7. \u307e\u3068\u3081","text":""},{"location":"haskell/06-tdd-functional/#tdd-fp","title":"TDD \u3068 FP \u306e\u76f8\u6027","text":"\u7279\u5fb4 \u30e1\u30ea\u30c3\u30c8 \u7d14\u7c8b\u95a2\u6570 \u5165\u51fa\u529b\u304c\u660e\u78ba\u3067\u30c6\u30b9\u30c8\u3057\u3084\u3059\u3044 \u4e0d\u5909\u30c7\u30fc\u30bf \u72b6\u614b\u7ba1\u7406\u306e\u8907\u96d1\u3055\u304c\u306a\u3044 \u578b\u30b7\u30b9\u30c6\u30e0 \u591a\u304f\u306e\u30d0\u30b0\u3092\u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u306b\u691c\u51fa \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1 \u7db2\u7f85\u7684\u306a\u30b1\u30fc\u30b9\u51e6\u7406"},{"location":"haskell/06-tdd-functional/#tdd_1","title":"TDD \u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9","text":"<ol> <li>\u5c0f\u3055\u306a\u30b9\u30c6\u30c3\u30d7\u3067\u9032\u3081\u308b: \u4e00\u5ea6\u306b\u5927\u304d\u306a\u5909\u66f4\u3092\u3057\u306a\u3044</li> <li>\u6700\u521d\u306b\u5931\u6557\u3059\u308b\u30c6\u30b9\u30c8\u3092\u66f8\u304f: \u30c6\u30b9\u30c8\u304c\u672c\u5f53\u306b\u6a5f\u80fd\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d</li> <li>\u6700\u5c0f\u9650\u306e\u30b3\u30fc\u30c9\u3067\u901a\u3059: \u904e\u5ea6\u306a\u4e00\u822c\u5316\u3092\u907f\u3051\u308b</li> <li>\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u306f\u30b0\u30ea\u30fc\u30f3\u306e\u5f8c: \u30c6\u30b9\u30c8\u304c\u901a\u3063\u305f\u72b6\u614b\u3067\u306e\u307f\u6539\u5584</li> <li>\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u3092\u4f75\u7528: \u30a8\u30c3\u30b8\u30b1\u30fc\u30b9\u306e\u767a\u898b</li> </ol>"},{"location":"haskell/07-composite-pattern/","title":"\u7b2c7\u7ae0: Composite \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"haskell/07-composite-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Composite \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u30c4\u30ea\u30fc\u69cb\u9020\u3067\u69cb\u6210\u3057\u3001\u500b\u3005\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u96c6\u5408\u3092\u540c\u3058\u3088\u3046\u306b\u6271\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u3053\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306f\u500b\u3005\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u305d\u306e\u7d44\u307f\u5408\u308f\u305b\u3092\u533a\u5225\u305b\u305a\u306b\u64cd\u4f5c\u3067\u304d\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u56f3\u5f62\uff08Shape\uff09\u3001\u30b9\u30a4\u30c3\u30c1\uff08Switchable\uff09\u3001\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3001\u30e1\u30cb\u30e5\u30fc\u3001\u6570\u5f0f\u3001\u7d44\u7e54\u69cb\u9020\u306a\u3069\u3001\u69d8\u3005\u306a\u4f8b\u3092\u901a\u3058\u3066 Composite \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"haskell/07-composite-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Composite \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Component: \u5168\u3066\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u5171\u901a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>Leaf: \u5b50\u8981\u7d20\u3092\u6301\u305f\u306a\u3044\u672b\u7aef\u30aa\u30d6\u30b8\u30a7\u30af\u30c8</li> <li>Composite: \u5b50\u8981\u7d20\u3092\u6301\u3064\u30b3\u30f3\u30c6\u30ca\u30aa\u30d6\u30b8\u30a7\u30af\u30c8</li> </ul> <p></p>"},{"location":"haskell/07-composite-pattern/#2-shape-composite","title":"2. Shape - \u56f3\u5f62\u306e Composite \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"haskell/07-composite-pattern/#_2","title":"\u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b\u306b\u3088\u308b\u5b9f\u88c5","text":"<p>Haskell \u3067\u306f\u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b\uff08ADT\uff09\u3092\u4f7f\u3063\u3066 Component \u3092\u8868\u73fe\u3057\u307e\u3059\uff1a</p> <pre><code>-- | 2D Point\ndata Point = Point\n  { pointX :: Double\n  , pointY :: Double\n  } deriving (Show, Eq)\n\n-- | Shape - Composite pattern for geometric shapes\ndata Shape\n  = Circle Point Double           -- ^ Circle with center and radius\n  | Square Point Double           -- ^ Square with top-left corner and side length\n  | Rectangle Point Double Double -- ^ Rectangle with top-left, width, and height\n  | CompositeShape [Shape]        -- ^ Composite containing multiple shapes\n  deriving (Show, Eq)\n</code></pre>"},{"location":"haskell/07-composite-pattern/#_3","title":"\u518d\u5e30\u7684\u306a\u64cd\u4f5c","text":"<pre><code>-- | Translate a shape by (dx, dy)\ntranslateShape :: Double -&gt; Double -&gt; Shape -&gt; Shape\ntranslateShape dx dy shape = case shape of\n  Circle (Point x y) r -&gt; Circle (Point (x + dx) (y + dy)) r\n  Square (Point x y) s -&gt; Square (Point (x + dx) (y + dy)) s\n  Rectangle (Point x y) w h -&gt; Rectangle (Point (x + dx) (y + dy)) w h\n  CompositeShape shapes -&gt; CompositeShape (map (translateShape dx dy) shapes)\n\n-- | Scale a shape by a factor\nscaleShape :: Double -&gt; Shape -&gt; Shape\nscaleShape factor shape = case shape of\n  Circle c r -&gt; Circle c (r * factor)\n  Square tl s -&gt; Square tl (s * factor)\n  Rectangle tl w h -&gt; Rectangle tl (w * factor) (h * factor)\n  CompositeShape shapes -&gt; CompositeShape (map (scaleShape factor) shapes)\n\n-- | Calculate the area of a shape\nshapeArea :: Shape -&gt; Double\nshapeArea shape = case shape of\n  Circle _ r -&gt; pi * r * r\n  Square _ s -&gt; s * s\n  Rectangle _ w h -&gt; w * h\n  CompositeShape shapes -&gt; sum (map shapeArea shapes)\n</code></pre>"},{"location":"haskell/07-composite-pattern/#_4","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>-- \u500b\u3005\u306e\u56f3\u5f62\u3092\u4f5c\u6210\nlet circle = Circle (Point 10 10) 5\nlet square = Square (Point 0 0) 10\n\n-- \u8907\u5408\u56f3\u5f62\u3092\u4f5c\u6210\nlet group = addShape square (addShape circle emptyComposite)\n-- CompositeShape [Circle (Point 10 10) 5, Square (Point 0 0) 10]\n\n-- \u8907\u5408\u56f3\u5f62\u3092\u79fb\u52d5\uff08\u5168\u3066\u306e\u5b50\u8981\u7d20\u304c\u79fb\u52d5\u3059\u308b\uff09\nlet moved = translateShape 5 5 group\n-- CompositeShape [Circle (Point 15 15) 5, Square (Point 5 5) 10]\n\n-- \u8907\u5408\u56f3\u5f62\u3092\u62e1\u5927\uff08\u5168\u3066\u306e\u5b50\u8981\u7d20\u304c\u62e1\u5927\u3059\u308b\uff09\nlet scaled = scaleShape 2 group\n-- CompositeShape [Circle (Point 10 10) 10, Square (Point 0 0) 20]\n\n-- \u9762\u7a4d\u306f\u5168\u3066\u306e\u5b50\u8981\u7d20\u306e\u5408\u8a08\nlet totalArea = shapeArea group  -- pi * 25 + 100\n</code></pre>"},{"location":"haskell/07-composite-pattern/#3-switchable-composite","title":"3. Switchable - \u30b9\u30a4\u30c3\u30c1\u306e Composite \u30d1\u30bf\u30fc\u30f3","text":"<pre><code>-- | Switchable - Composite pattern for switchable devices\ndata Switchable\n  = Light String Bool             -- ^ Light with name and on/off state\n  | DimmableLight String Int      -- ^ Dimmable light with name and intensity (0-100)\n  | Fan String Bool Int           -- ^ Fan with name, on/off state, and speed\n  | CompositeSwitchable String [Switchable]  -- ^ Composite with name and list\n  deriving (Show, Eq)\n\n-- | Turn on a switchable\nturnOn :: Switchable -&gt; Switchable\nturnOn switchable = case switchable of\n  Light name _ -&gt; Light name True\n  DimmableLight name _ -&gt; DimmableLight name 100\n  Fan name _ speed -&gt; Fan name True (max speed 1)\n  CompositeSwitchable name items -&gt; CompositeSwitchable name (map turnOn items)\n\n-- | Check if a switchable is on\nisOn :: Switchable -&gt; Bool\nisOn switchable = case switchable of\n  Light _ on -&gt; on\n  DimmableLight _ intensity -&gt; intensity &gt; 0\n  Fan _ on _ -&gt; on\n  CompositeSwitchable _ items -&gt; any isOn items\n</code></pre>"},{"location":"haskell/07-composite-pattern/#_5","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>-- \u90e8\u5c4b\u306e\u30b9\u30a4\u30c3\u30c1\u30b0\u30eb\u30fc\u30d7\u3092\u4f5c\u6210\nlet bedroom = emptySwitchableComposite \"Bedroom\"\n            |&gt; addSwitchable (Light \"Ceiling\" False)\n            |&gt; addSwitchable (DimmableLight \"Bedside\" 0)\n\nlet livingRoom = emptySwitchableComposite \"LivingRoom\"\n               |&gt; addSwitchable (Light \"Main\" False)\n               |&gt; addSwitchable (Fan \"CeilingFan\" False 0)\n\n-- \u5bb6\u5168\u4f53\u306e\u30b0\u30eb\u30fc\u30d7\nlet house = emptySwitchableComposite \"House\"\n          |&gt; addSwitchable bedroom\n          |&gt; addSwitchable livingRoom\n\n-- \u5bb6\u4e2d\u306e\u5168\u3066\u306e\u30b9\u30a4\u30c3\u30c1\u3092\u30aa\u30f3\nlet allOn = turnOn house\n</code></pre>"},{"location":"haskell/07-composite-pattern/#4-filesystem-composite","title":"4. FileSystem - \u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306e Composite \u30d1\u30bf\u30fc\u30f3","text":"<pre><code>-- | FileSystemEntry - Composite pattern for file system\ndata FileSystemEntry\n  = File String Int String        -- ^ File with name, size, and extension\n  | Directory String [FileSystemEntry]  -- ^ Directory with name and children\n  deriving (Show, Eq)\n\n-- | Get the total size of a file system entry\nfileSize :: FileSystemEntry -&gt; Int\nfileSize entry = case entry of\n  File _ size _ -&gt; size\n  Directory _ children -&gt; sum (map fileSize children)\n\n-- | Find files by extension\nfindByExtension :: String -&gt; FileSystemEntry -&gt; [FileSystemEntry]\nfindByExtension ext entry = case entry of\n  File _ _ fileExt | fileExt == ext -&gt; [entry]\n  File {} -&gt; []\n  Directory _ children -&gt; concatMap (findByExtension ext) children\n</code></pre>"},{"location":"haskell/07-composite-pattern/#_6","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>-- \u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u69cb\u9020\u3092\u69cb\u7bc9\nlet readme = File \"readme.txt\" 1024 \".txt\"\nlet config = File \"config.json\" 512 \".json\"\nlet src = Directory \"src\" \n      [ File \"main.fs\" 2048 \".fs\"\n      , File \"util.fs\" 1024 \".fs\"\n      ]\nlet root = Directory \"project\" [readme, config, src]\n\n-- \u7dcf\u30b5\u30a4\u30ba\u3092\u53d6\u5f97\nlet totalSize = fileSize root  -- 4608\n\n-- .fs \u30d5\u30a1\u30a4\u30eb\u3092\u691c\u7d22\nlet fsFiles = findByExtension \".fs\" root  -- 2 files\n</code></pre>"},{"location":"haskell/07-composite-pattern/#5-menuitem-composite","title":"5. MenuItem - \u30e1\u30cb\u30e5\u30fc\u306e Composite \u30d1\u30bf\u30fc\u30f3","text":"<pre><code>-- | MenuItem - Composite pattern for menu items\ndata MenuItem\n  = Item String Double String     -- ^ Item with name, price, and category\n  | SetMenu String [MenuItem] Double  -- ^ Set menu with name, items, and discount rate\n  deriving (Show, Eq)\n\n-- | Calculate the price of a menu item\nmenuPrice :: MenuItem -&gt; Double\nmenuPrice item = case item of\n  Item _ price _ -&gt; price\n  SetMenu _ items discountRate -&gt; \n    let totalPrice = sum (map menuPrice items)\n    in totalPrice * (1 - discountRate)\n</code></pre>"},{"location":"haskell/07-composite-pattern/#_7","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>-- \u5358\u54c1\u30e1\u30cb\u30e5\u30fc\nlet burger = Item \"Hamburger\" 500 \"Main\"\nlet fries = Item \"Fries\" 200 \"Side\"\nlet drink = Item \"Cola\" 150 \"Drink\"\n\n-- \u30bb\u30c3\u30c8\u30e1\u30cb\u30e5\u30fc\uff0810%\u5272\u5f15\uff09\nlet lunchSet = SetMenu \"Lunch Set\" [burger, fries, drink] 0.1\n\n-- \u30bb\u30c3\u30c8\u4fa1\u683c = (500 + 200 + 150) * 0.9 = 765\nlet setPrice = menuPrice lunchSet\n</code></pre>"},{"location":"haskell/07-composite-pattern/#6-expression-composite","title":"6. Expression - \u6570\u5f0f\u306e Composite \u30d1\u30bf\u30fc\u30f3","text":"<pre><code>-- | Expression - Composite pattern for mathematical expressions\ndata Expr\n  = Number Double                 -- ^ Numeric literal\n  | Variable String (Maybe Double)  -- ^ Variable with optional bound value\n  | Add Expr Expr                 -- ^ Addition\n  | Subtract Expr Expr            -- ^ Subtraction\n  | Multiply Expr Expr            -- ^ Multiplication\n  | Divide Expr Expr              -- ^ Division\n  | Negate Expr                   -- ^ Negation\n  deriving (Show, Eq)\n\n-- | Evaluate an expression\nevaluate :: Expr -&gt; Maybe Double\nevaluate expr = case expr of\n  Number n -&gt; Just n\n  Variable _ (Just v) -&gt; Just v\n  Variable _ Nothing -&gt; Nothing  -- Unbound variable\n  Add l r -&gt; (+) &lt;$&gt; evaluate l &lt;*&gt; evaluate r\n  Subtract l r -&gt; (-) &lt;$&gt; evaluate l &lt;*&gt; evaluate r\n  Multiply l r -&gt; (*) &lt;$&gt; evaluate l &lt;*&gt; evaluate r\n  Divide l r -&gt; do\n    lv &lt;- evaluate l\n    rv &lt;- evaluate r\n    if rv == 0 then Nothing else Just (lv / rv)\n  Negate e -&gt; negate &lt;$&gt; evaluate e\n\n-- | Simplify an expression\nsimplify :: Expr -&gt; Expr\nsimplify expr = case expr of\n  Add l r -&gt; case (simplify l, simplify r) of\n    (Number 0, r') -&gt; r'\n    (l', Number 0) -&gt; l'\n    (Number a, Number b) -&gt; Number (a + b)\n    (l', r') -&gt; Add l' r'\n  -- ... other cases\n</code></pre>"},{"location":"haskell/07-composite-pattern/#_8","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>-- (2 + 3) * 4 = 20\nlet expr = Multiply (Add (Number 2) (Number 3)) (Number 4)\nlet result = evaluate expr  -- Just 20\n\n-- \u5909\u6570\u3092\u542b\u3080\u5f0f\nlet exprWithVars = Add (Variable \"x\" Nothing) (Variable \"y\" Nothing)\nlet bound = bindVars [(\"x\", 10), (\"y\", 20)] exprWithVars\nlet value = evaluate bound  -- Just 30\n\n-- \u5f0f\u306e\u7c21\u7565\u5316\nlet simplified = simplify (Add (Variable \"x\" Nothing) (Number 0))\n-- =&gt; Variable \"x\" Nothing\n</code></pre>"},{"location":"haskell/07-composite-pattern/#7-organization-composite","title":"7. Organization - \u7d44\u7e54\u69cb\u9020\u306e Composite \u30d1\u30bf\u30fc\u30f3","text":"<pre><code>-- | OrganizationMember - Composite pattern for organizational structure\ndata OrganizationMember\n  = Employee String Double String  -- ^ Employee with name, salary, and role\n  | Department String (Maybe String) [OrganizationMember]  \n      -- ^ Department with name, manager, and members\n  deriving (Show, Eq)\n\n-- | Calculate the total salary\ntotalSalary :: OrganizationMember -&gt; Double\ntotalSalary member = case member of\n  Employee _ salary _ -&gt; salary\n  Department _ _ members -&gt; sum (map totalSalary members)\n\n-- | Find employees by role\nfindByRole :: String -&gt; OrganizationMember -&gt; [OrganizationMember]\nfindByRole role member = case member of\n  Employee _ _ r | r == role -&gt; [member]\n  Employee {} -&gt; []\n  Department _ _ members -&gt; concatMap (findByRole role) members\n</code></pre>"},{"location":"haskell/07-composite-pattern/#_9","title":"\u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u7d71\u4e00\u7684\u306a\u64cd\u4f5c: \u500b\u3005\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u30b0\u30eb\u30fc\u30d7\u3092\u540c\u3058\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u64cd\u4f5c\u53ef\u80fd</li> <li>\u968e\u5c64\u69cb\u9020: \u30cd\u30b9\u30c8\u3057\u305f\u69cb\u9020\u3092\u81ea\u7136\u306b\u8868\u73fe\u53ef\u80fd</li> <li>\u62e1\u5f35\u6027: \u65b0\u3057\u3044 Leaf \u3084 Composite \u3092\u8ffd\u52a0\u3057\u3084\u3059\u3044</li> <li>\u518d\u5e30\u7684\u306a\u69cb\u9020: Composite \u306f\u4ed6\u306e Composite \u3092\u542b\u3080\u3053\u3068\u3082\u53ef\u80fd</li> </ol>"},{"location":"haskell/07-composite-pattern/#haskell","title":"Haskell \u3067\u306e\u7279\u5fb4","text":""},{"location":"haskell/07-composite-pattern/#_10","title":"\u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b\u306b\u3088\u308b\u578b\u5b89\u5168\u6027","text":"<pre><code>-- \u5168\u3066\u306e\u30b1\u30fc\u30b9\u3092\u7db2\u7f85\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\nshapeArea :: Shape -&gt; Double\nshapeArea shape = case shape of\n  Circle _ r -&gt; pi * r * r\n  Square _ s -&gt; s * s\n  Rectangle _ w h -&gt; w * h\n  CompositeShape shapes -&gt; sum (map shapeArea shapes)\n  -- \u65b0\u3057\u3044\u30b1\u30fc\u30b9\u3092\u8ffd\u52a0\u3059\u308b\u3068\u3001\u30b3\u30f3\u30d1\u30a4\u30e9\u304c\u8b66\u544a\u3092\u51fa\u3059\n</code></pre>"},{"location":"haskell/07-composite-pattern/#_11","title":"\u4e0d\u5909\u6027\u306b\u3088\u308b\u5b89\u5168\u306a\u64cd\u4f5c","text":"<pre><code>-- \u5143\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u5909\u66f4\u3055\u308c\u306a\u3044\nlet original = addShape (Circle (Point 0 0) 5) emptyComposite\nlet moved = translateShape 10 10 original\n-- original \u306f\u5909\u66f4\u3055\u308c\u3066\u3044\u306a\u3044\n</code></pre>"},{"location":"haskell/07-composite-pattern/#_12","title":"\u518d\u5e30\u95a2\u6570\u3068\u9ad8\u968e\u95a2\u6570","text":"<pre><code>-- \u518d\u5e30\u7684\u306a\u51e6\u7406\u3082\u7c21\u6f54\u306b\nlet result = emptyComposite\n           &amp; addShape circle\n           &amp; addShape square\n           &amp; translateShape 5 5\n           &amp; scaleShape 2\n           &amp; shapeArea\n</code></pre>"},{"location":"haskell/07-composite-pattern/#clojuref","title":"Clojure/F# \u3068\u306e\u6bd4\u8f03","text":"\u6982\u5ff5 Clojure F# Haskell \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9 \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9 \u5224\u5225\u5171\u7528\u4f53 ADT Leaf defmethod Union case Constructor Composite defmethod + mapv Union case with list Constructor with list \u64cd\u4f5c\u306e\u59d4\u8b72 mapv List.map map \u4e0d\u5909\u6027 \u30c7\u30d5\u30a9\u30eb\u30c8 \u30c7\u30d5\u30a9\u30eb\u30c8 \u5f37\u5236 \u7db2\u7f85\u6027\u30c1\u30a7\u30c3\u30af \u306a\u3057 \u5b8c\u5168\u30c1\u30a7\u30c3\u30af \u5b8c\u5168\u30c1\u30a7\u30c3\u30af"},{"location":"haskell/07-composite-pattern/#_13","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Composite \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>Shape \u306e\u4f8b: \u56f3\u5f62\u306e\u79fb\u52d5\u3068\u62e1\u5927\u3092\u7d71\u4e00\u7684\u306b\u64cd\u4f5c</li> <li>Switchable \u306e\u4f8b: \u8907\u6570\u306e\u30b9\u30a4\u30c3\u30c1\u3092\u30b0\u30eb\u30fc\u30d7\u5316\u3057\u3066\u64cd\u4f5c</li> <li>FileSystem \u306e\u4f8b: \u30d5\u30a1\u30a4\u30eb\u3068\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u968e\u5c64\u69cb\u9020</li> <li>Menu \u306e\u4f8b: \u5358\u54c1\u3068\u30bb\u30c3\u30c8\u30e1\u30cb\u30e5\u30fc\u306e\u4fa1\u683c\u8a08\u7b97</li> <li>Expression \u306e\u4f8b: \u6570\u5f0f\u306e\u8a55\u4fa1\u3068\u7c21\u7565\u5316</li> <li>Organization \u306e\u4f8b: \u7d44\u7e54\u69cb\u9020\u306e\u7d66\u4e0e\u8a08\u7b97</li> </ol> <p>Composite \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30c4\u30ea\u30fc\u69cb\u9020\u306e\u30c7\u30fc\u30bf\u3092\u6271\u3046\u969b\u306b\u975e\u5e38\u306b\u6709\u52b9\u306a\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002Haskell \u306e\u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b\u3068\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u3092\u4f7f\u3046\u3053\u3068\u3067\u3001\u578b\u5b89\u5168\u3067\u4e0d\u5909\u306a\u30c4\u30ea\u30fc\u69cb\u9020\u3092\u7c21\u6f54\u306b\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"haskell/07-composite-pattern/#_14","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/haskell/part3/src/CompositePattern.hs</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/haskell/part3/test/CompositePatternSpec.hs</code></li> </ul>"},{"location":"haskell/07-composite-pattern/#_15","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Decorator \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u65e2\u5b58\u306e\u6a5f\u80fd\u306b\u65b0\u3057\u3044\u6a5f\u80fd\u3092\u52d5\u7684\u306b\u8ffd\u52a0\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"haskell/08-decorator-pattern/","title":"\u7b2c8\u7ae0: Decorator \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"haskell/08-decorator-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Decorator \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u65e2\u5b58\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u65b0\u3057\u3044\u6a5f\u80fd\u3092\u52d5\u7684\u306b\u8ffd\u52a0\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u3053\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u30b5\u30d6\u30af\u30e9\u30b9\u5316\u306b\u3088\u308b\u7d99\u627f\u3088\u308a\u3082\u67d4\u8edf\u306a\u65b9\u6cd5\u3067\u6a5f\u80fd\u3092\u62e1\u5f35\u3067\u304d\u307e\u3059\u3002</p> <p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u9ad8\u968e\u95a2\u6570\u3092\u4f7f\u3063\u3066\u95a2\u6570\u3092\u30e9\u30c3\u30d7\u3057\u3001\u6a2a\u65ad\u7684\u95a2\u5fc3\u4e8b\uff08\u30ed\u30b0\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u3001\u8a8d\u8a3c\u306a\u3069\uff09\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\u672c\u7ae0\u3067\u306f\u3001\u5f62\u72b6\u306e\u30b8\u30e3\u30fc\u30ca\u30ea\u30f3\u30b0\u3068\u95a2\u6570\u30c7\u30b3\u30ec\u30fc\u30bf\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"haskell/08-decorator-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Decorator \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Component: \u30c7\u30b3\u30ec\u30fc\u30c8\u5bfe\u8c61\u306e\u5171\u901a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>ConcreteComponent: \u5177\u4f53\u7684\u306a\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8</li> <li>Decorator: Component \u3092\u30e9\u30c3\u30d7\u3057\u3001\u8ffd\u52a0\u6a5f\u80fd\u3092\u63d0\u4f9b</li> </ul> <p></p>"},{"location":"haskell/08-decorator-pattern/#2-journaledshape","title":"2. JournaledShape \u306e\u4f8b","text":""},{"location":"haskell/08-decorator-pattern/#_2","title":"\u30c7\u30fc\u30bf\u578b\u306e\u5b9a\u7fa9","text":"<p>\u5f62\u72b6\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u64cd\u4f5c\u306e\u5c65\u6b74\u3092\u8a18\u9332\u3059\u308b\u6a5f\u80fd\u3092\u8ffd\u52a0\u3059\u308b\u30c7\u30b3\u30ec\u30fc\u30bf\u3067\u3059\u3002</p> <pre><code>-- | Journal entry for shape operations\ndata JournalEntry\n  = TranslateEntry Double Double  -- ^ Translation by (dx, dy)\n  | ScaleEntry Double             -- ^ Scale by factor\n  deriving (Show, Eq)\n\n-- | Shape with operation history\ndata JournaledShape = JournaledShape\n  { jsJournal :: [JournalEntry]   -- ^ History of operations\n  , jsShape :: Shape              -- ^ The wrapped shape\n  } deriving (Show, Eq)\n\n-- | Wrap a shape with journaling\njournalShape :: Shape -&gt; JournaledShape\njournalShape shape = JournaledShape\n  { jsJournal = []\n  , jsShape = shape\n  }\n\n-- | Get the journal entries\ngetJournal :: JournaledShape -&gt; [JournalEntry]\ngetJournal = jsJournal\n\n-- | Get the underlying shape\ngetShape :: JournaledShape -&gt; Shape\ngetShape = jsShape\n</code></pre>"},{"location":"haskell/08-decorator-pattern/#_3","title":"\u30c7\u30b3\u30ec\u30fc\u30c8\u3055\u308c\u305f\u64cd\u4f5c","text":"<pre><code>-- | Translate a journaled shape\ntranslateJournaled :: Double -&gt; Double -&gt; JournaledShape -&gt; JournaledShape\ntranslateJournaled dx dy js = JournaledShape\n  { jsJournal = jsJournal js ++ [TranslateEntry dx dy]\n  , jsShape = translateShape dx dy (jsShape js)\n  }\n\n-- | Scale a journaled shape\nscaleJournaled :: Double -&gt; JournaledShape -&gt; JournaledShape\nscaleJournaled factor js = JournaledShape\n  { jsJournal = jsJournal js ++ [ScaleEntry factor]\n  , jsShape = scaleShape factor (jsShape js)\n  }\n</code></pre>"},{"location":"haskell/08-decorator-pattern/#_4","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>-- \u5f62\u72b6\u3092\u30c7\u30b3\u30ec\u30fc\u30c8\nlet journaledSquare = journalShape (Square (Point 0 0) 1)\n                    &amp; translateJournaled 2 3\n                    &amp; scaleJournaled 5\n\n-- \u30b8\u30e3\u30fc\u30ca\u30eb\u3092\u78ba\u8a8d\ngetJournal journaledSquare\n-- [TranslateEntry 2 3, ScaleEntry 5]\n\n-- \u5b9f\u969b\u306e\u5f62\u72b6\u3092\u78ba\u8a8d\ngetShape journaledSquare\n-- Square (Point 2 3) 5\n</code></pre>"},{"location":"haskell/08-decorator-pattern/#3","title":"3. \u95a2\u6570\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u9ad8\u968e\u95a2\u6570\u3092\u4f7f\u3063\u3066\u95a2\u6570\u3092\u30c7\u30b3\u30ec\u30fc\u30c8\u3057\u307e\u3059\u3002</p>"},{"location":"haskell/08-decorator-pattern/#_5","title":"\u30ed\u30b0\u51fa\u529b\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>-- | Add logging to a function (collects log entries)\nwithLogging :: String -&gt; (a -&gt; b) -&gt; (a -&gt; (b, [String]))\nwithLogging name f = \\x -&gt; \n  let result = f x\n  in (result, [\"[LOG] \" ++ name ++ \" called\", \"[LOG] \" ++ name ++ \" returned\"])\n\n-- \u4f7f\u7528\u4f8b\nlet addLogged = withLogging \"double\" (* 2)\nlet (result, logs) = addLogged 5\n-- result = 10\n-- logs = [\"[LOG] double called\", \"[LOG] double returned\"]\n</code></pre>"},{"location":"haskell/08-decorator-pattern/#_6","title":"\u30ea\u30c8\u30e9\u30a4\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>-- | Add retry logic to a function that might fail\nwithRetry :: Int -&gt; (a -&gt; Either String b) -&gt; (a -&gt; Either String b)\nwithRetry maxRetries f = go 0\n  where\n    go attempts x\n      | attempts &gt;= maxRetries = Left \"Max retries exceeded\"\n      | otherwise = case f x of\n          Right result -&gt; Right result\n          Left _ -&gt; go (attempts + 1) x\n\n-- \u4f7f\u7528\u4f8b\nlet unreliable _ = Left \"error\" :: Either String String\nlet withRetries = withRetry 3 unreliable\nwithRetries ()  -- Left \"Max retries exceeded\"\n</code></pre>"},{"location":"haskell/08-decorator-pattern/#_7","title":"\u30ad\u30e3\u30c3\u30b7\u30e5\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>-- | Add caching to a function (using a Map for pure memoization)\nwithCache :: Ord a =&gt; (a -&gt; b) -&gt; (Map a b -&gt; a -&gt; (b, Map a b))\nwithCache f = \\cache x -&gt;\n  case Map.lookup x cache of\n    Just cached -&gt; (cached, cache)\n    Nothing -&gt; \n      let result = f x\n      in (result, Map.insert x result cache)\n\n-- \u4f7f\u7528\u4f8b\nlet expensiveFn x = x * x  -- expensive computation\nlet cached = withCache expensiveFn\nlet (result1, cache1) = cached Map.empty 5    -- computes\nlet (result2, cache2) = cached cache1 5       -- cache hit\n</code></pre>"},{"location":"haskell/08-decorator-pattern/#_8","title":"\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>-- | Add validation to a function\nwithValidation :: (a -&gt; Bool) -&gt; String -&gt; (a -&gt; Either String b) -&gt; (a -&gt; Either String b)\nwithValidation validator errMsg f = \\x -&gt;\n  if validator x\n    then f x\n    else Left errMsg\n\n-- \u4f7f\u7528\u4f8b\nlet positiveOnly = withValidation (&gt; 0) \"Must be positive\" (\\x -&gt; Right (x * 2))\npositiveOnly 5   -- Right 10\npositiveOnly (-5) -- Left \"Must be positive\"\n</code></pre>"},{"location":"haskell/08-decorator-pattern/#4","title":"4. \u30c7\u30b3\u30ec\u30fc\u30bf\u306e\u7d44\u307f\u5408\u308f\u305b","text":"<p>\u8907\u6570\u306e\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002</p> <pre><code>-- | Compose multiple function transformations\ncomposeDecorators :: [a -&gt; a] -&gt; a -&gt; a\ncomposeDecorators = foldr (.) id\n\n-- \u4f7f\u7528\u4f8b\nlet add1 = (+ 1) :: Int -&gt; Int\nlet mul2 = (* 2)\nlet decorators = [add1, mul2]  -- (x * 2) + 1\nlet composed = composeDecorators decorators\ncomposed 5  -- 11 = (5 * 2) + 1\n</code></pre>"},{"location":"haskell/08-decorator-pattern/#_9","title":"\u7d44\u307f\u5408\u308f\u305b\u306e\u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"haskell/08-decorator-pattern/#5","title":"5. \u30ab\u30a6\u30f3\u30bf\u4ed8\u304d\u64cd\u4f5c","text":"<pre><code>-- | Result with call count\ndata CountedResult a = CountedResult\n  { crResult :: a\n  , crCount :: Int\n  } deriving (Show, Eq)\n\n-- | Wrap a function to count calls\nwithCounter :: (a -&gt; b) -&gt; ([a] -&gt; [CountedResult b])\nwithCounter f = zipWith (\\i x -&gt; CountedResult (f x) i) [1..]\n\n-- \u4f7f\u7528\u4f8b\nlet counted = withCounter (* 2)\ncounted [1, 2, 3]\n-- [CountedResult 2 1, CountedResult 4 2, CountedResult 6 3]\n</code></pre>"},{"location":"haskell/08-decorator-pattern/#6","title":"6. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u5358\u4e00\u8cac\u4efb\u306e\u539f\u5247: \u5404\u30c7\u30b3\u30ec\u30fc\u30bf\u306f\u4e00\u3064\u306e\u6a5f\u80fd\u306e\u307f\u3092\u8ffd\u52a0</li> <li>\u958b\u653e/\u9589\u9396\u306e\u539f\u5247: \u65e2\u5b58\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u305b\u305a\u306b\u6a5f\u80fd\u3092\u8ffd\u52a0</li> <li>\u67d4\u8edf\u306a\u7d44\u307f\u5408\u308f\u305b: \u5fc5\u8981\u306a\u6a5f\u80fd\u3060\u3051\u3092\u9078\u629e\u3057\u3066\u7d44\u307f\u5408\u308f\u305b\u53ef\u80fd</li> <li>\u5b9f\u884c\u6642\u306e\u6c7a\u5b9a: \u3069\u306e\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u9069\u7528\u3059\u308b\u304b\u5b9f\u884c\u6642\u306b\u6c7a\u5b9a\u53ef\u80fd</li> </ol>"},{"location":"haskell/08-decorator-pattern/#7-haskell","title":"7. Haskell \u3067\u306e\u7279\u5fb4","text":"<p>Haskell \u3067\u306e Decorator \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u306b\u306f\u4ee5\u4e0b\u306e\u7279\u5fb4\u304c\u3042\u308a\u307e\u3059\uff1a</p> <ol> <li>\u9ad8\u968e\u95a2\u6570: \u95a2\u6570\u3092\u5f15\u6570\u306b\u53d6\u308a\u3001\u65b0\u3057\u3044\u95a2\u6570\u3092\u8fd4\u3059</li> <li>\u7d14\u7c8b\u6027: \u526f\u4f5c\u7528\u3092\u907f\u3051\u3001\u72b6\u614b\u306f\u30c7\u30fc\u30bf\u69cb\u9020\u3067\u660e\u793a\u7684\u306b\u7ba1\u7406</li> <li>\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u306a\u30c7\u30fc\u30bf: \u30c7\u30b3\u30ec\u30fc\u30c8\u5f8c\u3082\u5143\u306e\u30c7\u30fc\u30bf\u306f\u5909\u66f4\u3055\u308c\u306a\u3044</li> <li>\u5408\u6210\u306e\u3057\u3084\u3059\u3055: <code>(.)</code> \u6f14\u7b97\u5b50\u3084 <code>foldr</code> \u3067\u7c21\u5358\u306b\u7d44\u307f\u5408\u308f\u305b\u53ef\u80fd</li> <li>\u578b\u5b89\u5168\u6027: \u578b\u30b7\u30b9\u30c6\u30e0\u306b\u3088\u308a\u30c7\u30b3\u30ec\u30fc\u30bf\u306e\u9069\u7528\u30df\u30b9\u3092\u9632\u6b62</li> </ol>"},{"location":"haskell/08-decorator-pattern/#haskell","title":"Haskell \u7279\u6709\u306e\u8003\u616e\u4e8b\u9805","text":"<pre><code>-- Haskell \u3067\u306f\u526f\u4f5c\u7528\u3092\u6301\u3064\u64cd\u4f5c\u306f IO \u30e2\u30ca\u30c9\u3092\u4f7f\u7528\n-- \u7d14\u7c8b\u306a\u30c7\u30b3\u30ec\u30fc\u30bf\u3067\u306f\u72b6\u614b\u3092\u660e\u793a\u7684\u306b\u6e21\u3059\u5fc5\u8981\u304c\u3042\u308b\n\n-- \u7d14\u7c8b\u306a\u30ad\u30e3\u30c3\u30b7\u30e5\uff08\u72b6\u614b\u3092\u660e\u793a\u7684\u306b\u6e21\u3059\uff09\nwithCache :: Ord a =&gt; (a -&gt; b) -&gt; (Map a b -&gt; a -&gt; (b, Map a b))\n\n-- IO \u30e2\u30ca\u30c9\u3092\u4f7f\u3063\u305f\u30ad\u30e3\u30c3\u30b7\u30e5\uff08\u5185\u90e8\u72b6\u614b\u3092\u6301\u3064\uff09\nwithCacheIO :: Ord a =&gt; (a -&gt; b) -&gt; IO (a -&gt; IO b)\nwithCacheIO f = do\n  ref &lt;- newIORef Map.empty\n  return $ \\x -&gt; do\n    cache &lt;- readIORef ref\n    case Map.lookup x cache of\n      Just v -&gt; return v\n      Nothing -&gt; do\n        let v = f x\n        modifyIORef ref (Map.insert x v)\n        return v\n</code></pre>"},{"location":"haskell/08-decorator-pattern/#_10","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Decorator \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>JournaledShape: \u5f62\u72b6\u64cd\u4f5c\u306e\u5c65\u6b74\u3092\u8a18\u9332\u3059\u308b\u30c7\u30b3\u30ec\u30fc\u30bf</li> <li>\u95a2\u6570\u30c7\u30b3\u30ec\u30fc\u30bf: \u30ed\u30b0\u3001\u30ea\u30c8\u30e9\u30a4\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u306a\u3069\u306e\u6a2a\u65ad\u7684\u95a2\u5fc3\u4e8b</li> <li>\u30c7\u30b3\u30ec\u30fc\u30bf\u306e\u7d44\u307f\u5408\u308f\u305b: \u8907\u6570\u306e\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u67d4\u8edf\u306b\u7d44\u307f\u5408\u308f\u305b</li> </ol> <p>Decorator \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u65e2\u5b58\u306e\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u305b\u305a\u306b\u6a5f\u80fd\u3092\u62e1\u5f35\u3059\u308b\u5f37\u529b\u306a\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002Haskell \u3067\u306f\u9ad8\u968e\u95a2\u6570\u3068\u7d14\u7c8b\u95a2\u6570\u3092\u6d3b\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u578b\u5b89\u5168\u3067\u5408\u6210\u3057\u3084\u3059\u3044\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"haskell/08-decorator-pattern/#_11","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/haskell/part3/src/DecoratorPattern.hs</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/haskell/part3/test/DecoratorPatternSpec.hs</code></li> </ul>"},{"location":"haskell/08-decorator-pattern/#_12","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Adapter \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u7570\u306a\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u9593\u306e\u5909\u63db\u3068\u30ec\u30ac\u30b7\u30fc\u30b7\u30b9\u30c6\u30e0\u3068\u306e\u7d71\u5408\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"haskell/09-adapter-pattern/","title":"\u7b2c9\u7ae0: Adapter \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"haskell/09-adapter-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Adapter \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u65e2\u5b58\u306e\u30af\u30e9\u30b9\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u671f\u5f85\u3059\u308b\u5225\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306b\u5909\u63db\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u3053\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u4e92\u63db\u6027\u306e\u306a\u3044\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u6301\u3064\u30af\u30e9\u30b9\u540c\u58eb\u3092\u9023\u643a\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u53ef\u5909\u5f37\u5ea6\u30e9\u30a4\u30c8\u306e\u30a2\u30c0\u30d7\u30bf\u30fc\u3001\u30c7\u30fc\u30bf\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u5909\u63db\u3001\u6e29\u5ea6\u30fb\u901a\u8ca8\u5909\u63db\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"haskell/09-adapter-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Adapter \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Target: \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u671f\u5f85\u3059\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>Adaptee: \u65e2\u5b58\u306e\u30af\u30e9\u30b9\uff08\u9069\u5fdc\u3055\u308c\u308b\u5074\uff09</li> <li>Adapter: Target \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u5b9f\u88c5\u3057\u3001Adaptee \u3092\u4f7f\u7528</li> </ul> <p></p>"},{"location":"haskell/09-adapter-pattern/#2-variablelight","title":"2. VariableLight \u306e\u4f8b","text":""},{"location":"haskell/09-adapter-pattern/#switchable-target","title":"Switchable \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9 (Target)","text":"<pre><code>-- | Result of a switch operation\ndata SwitchResult = SwitchResult\n  { srOn :: Bool\n  , srIntensity :: Maybe Int\n  } deriving (Show, Eq)\n\n-- | Switchable interface - the target interface\nclass Switchable a where\n  switchTurnOn :: a -&gt; (a, SwitchResult)\n  switchTurnOff :: a -&gt; (a, SwitchResult)\n</code></pre>"},{"location":"haskell/09-adapter-pattern/#variablelight-adaptee","title":"VariableLight (Adaptee)","text":"<p>\u53ef\u5909\u5f37\u5ea6\u3092\u6301\u3064\u30e9\u30a4\u30c8\u306f\u3001\u5358\u7d14\u306a\u30aa\u30f3/\u30aa\u30d5\u3067\u306f\u306a\u304f\u3001\u5f37\u5ea6\u3092\u6307\u5b9a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p> <pre><code>-- | Variable light with intensity control\ndata VariableLight = VariableLight\n  { vlIntensity :: Int  -- ^ 0-100\n  } deriving (Show, Eq)\n\n-- | Set the light intensity (the adaptee's specific method)\nsetLightIntensity :: Int -&gt; VariableLight -&gt; VariableLight\nsetLightIntensity intensity vl = vl { vlIntensity = max 0 (min 100 intensity) }\n</code></pre>"},{"location":"haskell/09-adapter-pattern/#variablelightadapter-adapter","title":"VariableLightAdapter (Adapter)","text":"<pre><code>-- | Adapter that wraps VariableLight and provides Switchable interface\ndata VariableLightAdapter = VariableLightAdapter\n  { vlaLight :: VariableLight\n  , vlaMinIntensity :: Int\n  , vlaMaxIntensity :: Int\n  } deriving (Show, Eq)\n\n-- | Create a variable light adapter\nmakeVariableLightAdapter :: Int -&gt; Int -&gt; VariableLightAdapter\nmakeVariableLightAdapter minI maxI = VariableLightAdapter\n  { vlaLight = VariableLight 0\n  , vlaMinIntensity = minI\n  , vlaMaxIntensity = maxI\n  }\n\n-- | Turn on through the adapter\nadaptedTurnOn :: VariableLightAdapter -&gt; (VariableLightAdapter, SwitchResult)\nadaptedTurnOn adapter =\n  let newLight = setLightIntensity (vlaMaxIntensity adapter) (vlaLight adapter)\n      newAdapter = adapter { vlaLight = newLight }\n      result = SwitchResult True (Just $ vlIntensity newLight)\n  in (newAdapter, result)\n\n-- | Turn off through the adapter\nadaptedTurnOff :: VariableLightAdapter -&gt; (VariableLightAdapter, SwitchResult)\nadaptedTurnOff adapter =\n  let newLight = setLightIntensity (vlaMinIntensity adapter) (vlaLight adapter)\n      newAdapter = adapter { vlaLight = newLight }\n      result = SwitchResult False (Just $ vlIntensity newLight)\n  in (newAdapter, result)\n\n-- Make VariableLightAdapter an instance of Switchable\ninstance Switchable VariableLightAdapter where\n  switchTurnOn = adaptedTurnOn\n  switchTurnOff = adaptedTurnOff\n</code></pre>"},{"location":"haskell/09-adapter-pattern/#_2","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>-- \u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u4f5c\u6210\uff08\u6700\u5c0f0\u3001\u6700\u5927100\uff09\nlet adapter = makeVariableLightAdapter 0 100\n\n-- \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306fSwitchable\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u64cd\u4f5c\nlet (onAdapter, onResult) = switchTurnOn adapter\n-- onResult = SwitchResult True (Just 100)\n\nlet (offAdapter, offResult) = switchTurnOff onAdapter\n-- offResult = SwitchResult False (Just 0)\n</code></pre>"},{"location":"haskell/09-adapter-pattern/#3","title":"3. \u30c7\u30fc\u30bf\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u30a2\u30c0\u30d7\u30bf\u30fc","text":""},{"location":"haskell/09-adapter-pattern/#_3","title":"\u30e6\u30fc\u30b6\u30fc\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u5909\u63db","text":"<p>\u7570\u306a\u308b\u30b7\u30b9\u30c6\u30e0\u9593\u3067\u30c7\u30fc\u30bf\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u304c\u7570\u306a\u308b\u5834\u5408\u3001\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u4f7f\u3063\u3066\u5909\u63db\u3057\u307e\u3059\u3002</p> <pre><code>-- | Old user format (legacy system)\ndata OldUserFormat = OldUserFormat\n  { oufFirstName :: String\n  , oufLastName :: String\n  , oufEmailAddress :: String\n  , oufPhoneNumber :: String\n  } deriving (Show, Eq)\n\n-- | Metadata for converted users\ndata UserMetadata = UserMetadata\n  { umMigrated :: Bool\n  , umOriginalFormat :: String\n  } deriving (Show, Eq)\n\n-- | New user format (modern system)\ndata NewUserFormat = NewUserFormat\n  { nufName :: String\n  , nufEmail :: String\n  , nufPhone :: String\n  , nufMetadata :: Maybe UserMetadata\n  } deriving (Show, Eq)\n\n-- | Adapt old user format to new format\nadaptOldToNew :: OldUserFormat -&gt; NewUserFormat\nadaptOldToNew old = NewUserFormat\n  { nufName = oufLastName old ++ \" \" ++ oufFirstName old\n  , nufEmail = oufEmailAddress old\n  , nufPhone = oufPhoneNumber old\n  , nufMetadata = Just UserMetadata\n      { umMigrated = True\n      , umOriginalFormat = \"old\"\n      }\n  }\n\n-- | Adapt new user format to old format\nadaptNewToOld :: NewUserFormat -&gt; OldUserFormat\nadaptNewToOld new =\n  case nonEmpty (words (nufName new)) of\n    Nothing -&gt; OldUserFormat \"\" \"\" (nufEmail new) (nufPhone new)\n    Just ne -&gt; OldUserFormat\n      { oufFirstName = unwords (NE.tail ne)\n      , oufLastName = NE.head ne\n      , oufEmailAddress = nufEmail new\n      , oufPhoneNumber = nufPhone new\n      }\n</code></pre>"},{"location":"haskell/09-adapter-pattern/#_4","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>-- \u65e7\u30d5\u30a9\u30fc\u30de\u30c3\u30c8 \u2192 \u65b0\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\nlet oldUser = OldUserFormat \"Taro\" \"Yamada\" \"taro@example.com\" \"090-1234-5678\"\nlet newUser = adaptOldToNew oldUser\n-- newUser = NewUserFormat \n--   { nufName = \"Yamada Taro\"\n--   , nufEmail = \"taro@example.com\"\n--   , nufPhone = \"090-1234-5678\"\n--   , nufMetadata = Just UserMetadata {umMigrated = True, umOriginalFormat = \"old\"}\n--   }\n\n-- \u65b0\u30d5\u30a9\u30fc\u30de\u30c3\u30c8 \u2192 \u65e7\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\nlet back = adaptNewToOld newUser\n-- back = OldUserFormat \"Taro\" \"Yamada\" \"taro@example.com\" \"090-1234-5678\"\n</code></pre>"},{"location":"haskell/09-adapter-pattern/#4","title":"4. \u6e29\u5ea6\u30a2\u30c0\u30d7\u30bf\u30fc","text":"<pre><code>-- | Temperature in Celsius\nnewtype Celsius = Celsius { getCelsius :: Double }\n  deriving (Show, Eq)\n\n-- | Temperature in Fahrenheit\nnewtype Fahrenheit = Fahrenheit { getFahrenheit :: Double }\n  deriving (Show, Eq)\n\n-- | Convert Celsius to Fahrenheit\ncelsiusToFahrenheit :: Celsius -&gt; Fahrenheit\ncelsiusToFahrenheit (Celsius c) = Fahrenheit (c * 9/5 + 32)\n\n-- | Convert Fahrenheit to Celsius\nfahrenheitToCelsius :: Fahrenheit -&gt; Celsius\nfahrenheitToCelsius (Fahrenheit f) = Celsius ((f - 32) * 5/9)\n</code></pre>"},{"location":"haskell/09-adapter-pattern/#_5","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>let freezing = Celsius 0\nlet boiling = Celsius 100\n\ncelsiusToFahrenheit freezing  -- Fahrenheit 32\ncelsiusToFahrenheit boiling   -- Fahrenheit 212\n\n-- \u5f80\u5fa9\u5909\u63db\nlet temp = Celsius 25\nlet converted = fahrenheitToCelsius (celsiusToFahrenheit temp)\n-- converted \u2248 Celsius 25\n</code></pre>"},{"location":"haskell/09-adapter-pattern/#5","title":"5. \u901a\u8ca8\u30a2\u30c0\u30d7\u30bf\u30fc","text":"<pre><code>-- | US Dollars\nnewtype USD = USD { getUsd :: Double }\n  deriving (Show, Eq)\n\n-- | Euros\nnewtype EUR = EUR { getEur :: Double }\n  deriving (Show, Eq)\n\n-- | Japanese Yen\nnewtype JPY = JPY { getJpy :: Double }\n  deriving (Show, Eq)\n\n-- | Convert USD to EUR (simplified rate)\nconvertUsdToEur :: USD -&gt; EUR\nconvertUsdToEur (USD usd) = EUR (usd * 0.85)\n\n-- | Convert USD to JPY (simplified rate)\nconvertUsdToJpy :: USD -&gt; JPY\nconvertUsdToJpy (USD usd) = JPY (usd * 110)\n\n-- | Convert EUR to USD\nconvertEurToUsd :: EUR -&gt; USD\nconvertEurToUsd (EUR eur) = USD (eur / 0.85)\n\n-- | Convert JPY to USD\nconvertJpyToUsd :: JPY -&gt; USD\nconvertJpyToUsd (JPY jpy) = USD (jpy / 110)\n</code></pre>"},{"location":"haskell/09-adapter-pattern/#6","title":"6. \u6c4e\u7528\u30a2\u30c0\u30d7\u30bf\u30fc","text":"<pre><code>-- | Generic bidirectional adapter\ndata Adapter a b = Adapter\n  { adapterTo :: a -&gt; b    -- ^ Convert from A to B\n  , adapterFrom :: b -&gt; a  -- ^ Convert from B to A\n  }\n\n-- | Apply adapter to convert from A to B\nadapt :: Adapter a b -&gt; a -&gt; b\nadapt = adapterTo\n\n-- | Apply adapter to convert from B to A\nadaptBack :: Adapter a b -&gt; b -&gt; a\nadaptBack = adapterFrom\n</code></pre>"},{"location":"haskell/09-adapter-pattern/#_6","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>-- \u6e29\u5ea6\u5909\u63db\u30a2\u30c0\u30d7\u30bf\u30fc\nlet tempAdapter = Adapter\n  { adapterTo = \\(Celsius c) -&gt; Fahrenheit (c * 9/5 + 32)\n  , adapterFrom = \\(Fahrenheit f) -&gt; Celsius ((f - 32) * 5/9)\n  }\n\nadapt tempAdapter (Celsius 0)      -- Fahrenheit 32\nadaptBack tempAdapter (Fahrenheit 32)  -- Celsius 0\n\n-- Int &lt;-&gt; String \u30a2\u30c0\u30d7\u30bf\u30fc\nlet intStringAdapter = Adapter\n  { adapterTo = show :: Int -&gt; String\n  , adapterFrom = read\n  }\n\nadapt intStringAdapter 42      -- \"42\"\nadaptBack intStringAdapter \"42\"  -- 42\n</code></pre>"},{"location":"haskell/09-adapter-pattern/#7","title":"7. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u65e2\u5b58\u30b3\u30fc\u30c9\u306e\u518d\u5229\u7528: \u65e2\u5b58\u306e\u30af\u30e9\u30b9\u3092\u5909\u66f4\u305b\u305a\u306b\u65b0\u3057\u3044\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u4f7f\u7528</li> <li>\u5358\u4e00\u8cac\u4efb\u306e\u539f\u5247: \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u5909\u63db\u306e\u30ed\u30b8\u30c3\u30af\u3092\u5206\u96e2</li> <li>\u958b\u653e/\u9589\u9396\u306e\u539f\u5247: \u65b0\u3057\u3044\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u8ffd\u52a0\u3057\u3066\u3082\u65e2\u5b58\u30b3\u30fc\u30c9\u306f\u5909\u66f4\u4e0d\u8981</li> <li>\u30ec\u30ac\u30b7\u30fc\u30b7\u30b9\u30c6\u30e0\u3068\u306e\u7d71\u5408: \u53e4\u3044\u30b7\u30b9\u30c6\u30e0\u3068\u65b0\u3057\u3044\u30b7\u30b9\u30c6\u30e0\u3092\u9023\u643a</li> </ol>"},{"location":"haskell/09-adapter-pattern/#8-haskell","title":"8. Haskell \u3067\u306e\u7279\u5fb4","text":"<p>Haskell \u3067\u306e Adapter \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u306b\u306f\u4ee5\u4e0b\u306e\u7279\u5fb4\u304c\u3042\u308a\u307e\u3059\uff1a</p> <ol> <li>\u578b\u30af\u30e9\u30b9: \u30bf\u30fc\u30b2\u30c3\u30c8\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u578b\u30af\u30e9\u30b9\u3068\u3057\u3066\u5b9a\u7fa9</li> <li>newtype: \u7570\u306a\u308b\u30c9\u30e1\u30a4\u30f3\u306e\u5024\u3092\u578b\u3067\u533a\u5225\uff08Celsius, Fahrenheit \u306a\u3069\uff09</li> <li>\u95a2\u6570\u306b\u3088\u308b\u5909\u63db: \u5358\u7d14\u306a\u30c7\u30fc\u30bf\u5909\u63db\u306f\u7d14\u7c8b\u95a2\u6570\u3067\u76f4\u63a5\u5b9f\u88c5</li> <li>\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u306a\u30c7\u30fc\u30bf: \u5909\u63db\u5f8c\u3082\u5143\u306e\u30c7\u30fc\u30bf\u306f\u5909\u66f4\u3055\u308c\u306a\u3044</li> <li>\u5408\u6210\u306e\u3057\u3084\u3059\u3055: \u8907\u6570\u306e\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u7d44\u307f\u5408\u308f\u305b\u53ef\u80fd</li> </ol>"},{"location":"haskell/09-adapter-pattern/#_7","title":"\u578b\u30af\u30e9\u30b9\u306b\u3088\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9","text":"<pre><code>-- \u578b\u30af\u30e9\u30b9\u3067\u30bf\u30fc\u30b2\u30c3\u30c8\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u5b9a\u7fa9\nclass Switchable a where\n  switchTurnOn :: a -&gt; (a, SwitchResult)\n  switchTurnOff :: a -&gt; (a, SwitchResult)\n\n-- \u4efb\u610f\u306e\u578b\u3092\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u3067\u304d\u308b\ninstance Switchable VariableLightAdapter where\n  switchTurnOn = adaptedTurnOn\n  switchTurnOff = adaptedTurnOff\n\n-- \u30b8\u30a7\u30cd\u30ea\u30c3\u30af\u306a\u95a2\u6570\u3067\u4f7f\u7528\nengageSwitch :: Switchable a =&gt; a -&gt; (a, SwitchResult, SwitchResult)\nengageSwitch s = \n  let (s1, onResult) = switchTurnOn s\n      (s2, offResult) = switchTurnOff s1\n  in (s2, onResult, offResult)\n</code></pre>"},{"location":"haskell/09-adapter-pattern/#newtype","title":"newtype \u306b\u3088\u308b\u578b\u5b89\u5168\u6027","text":"<pre><code>-- newtype \u3092\u4f7f\u3046\u3053\u3068\u3067\u3001\u540c\u3058\u5185\u90e8\u8868\u73fe\u3067\u3082\u7570\u306a\u308b\u578b\u3068\u3057\u3066\u6271\u3048\u308b\nnewtype Celsius = Celsius Double\nnewtype Fahrenheit = Fahrenheit Double\n\n-- \u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u306b\u578b\u30c1\u30a7\u30c3\u30af\u3055\u308c\u308b\nadd :: Celsius -&gt; Celsius -&gt; Celsius\nadd (Celsius a) (Celsius b) = Celsius (a + b)\n\n-- \u3053\u308c\u306f\u30b3\u30f3\u30d1\u30a4\u30eb\u30a8\u30e9\u30fc\u306b\u306a\u308b\n-- add (Celsius 10) (Fahrenheit 50)  -- \u578b\u4e0d\u4e00\u81f4\n</code></pre>"},{"location":"haskell/09-adapter-pattern/#_8","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Adapter \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>VariableLightAdapter: \u53ef\u5909\u5f37\u5ea6\u30e9\u30a4\u30c8\u3092\u5358\u7d14\u306a\u30aa\u30f3/\u30aa\u30d5\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306b\u9069\u5fdc</li> <li>\u30c7\u30fc\u30bf\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u30a2\u30c0\u30d7\u30bf\u30fc: \u7570\u306a\u308b\u30c7\u30fc\u30bf\u5f62\u5f0f\u9593\u306e\u5909\u63db</li> <li>\u6e29\u5ea6\u30fb\u901a\u8ca8\u30a2\u30c0\u30d7\u30bf\u30fc: \u5358\u4f4d\u5909\u63db\u306e\u5b9f\u88c5</li> <li>\u6c4e\u7528\u30a2\u30c0\u30d7\u30bf\u30fc: \u53cc\u65b9\u5411\u5909\u63db\u3092\u62bd\u8c61\u5316</li> </ol> <p>Adapter \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u65e2\u5b58\u306e\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u305b\u305a\u306b\u7570\u306a\u308b\u30b7\u30b9\u30c6\u30e0\u3092\u9023\u643a\u3055\u305b\u308b\u969b\u306b\u975e\u5e38\u306b\u6709\u52b9\u3067\u3059\u3002Haskell \u3067\u306f\u578b\u30af\u30e9\u30b9\u3068 newtype \u3092\u6d3b\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u578b\u5b89\u5168\u3067\u518d\u5229\u7528\u6027\u306e\u9ad8\u3044\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"haskell/09-adapter-pattern/#_9","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/haskell/part3/src/AdapterPattern.hs</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/haskell/part3/test/AdapterPatternSpec.hs</code></li> </ul>"},{"location":"haskell/09-adapter-pattern/#_10","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Strategy \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u30ab\u30d7\u30bb\u30eb\u5316\u3057\u3001\u5b9f\u884c\u6642\u306b\u5207\u308a\u66ff\u3048\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"haskell/10-strategy-pattern/","title":"\u7b2c10\u7ae0: Strategy \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"haskell/10-strategy-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Strategy \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u500b\u5225\u306b\u5b9a\u7fa9\u3057\u3001\u305d\u308c\u3089\u3092\u4ea4\u63db\u53ef\u80fd\u306b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u72ec\u7acb\u3057\u3066\u5909\u66f4\u3067\u304d\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u4fa1\u683c\u8a08\u7b97\u6226\u7565\u3001\u914d\u9001\u6226\u7565\u3001\u30b7\u30e7\u30c3\u30d4\u30f3\u30b0\u30ab\u30fc\u30c8\u3001\u6226\u7565\u306e\u5408\u6210\u3001\u30bd\u30fc\u30c8\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306a\u3069\u3092\u901a\u3058\u3066 Strategy \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"haskell/10-strategy-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Strategy \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Strategy: \u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u5171\u901a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>ConcreteStrategy: \u5177\u4f53\u7684\u306a\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u5b9f\u88c5</li> <li>Context: Strategy \u3092\u4f7f\u7528\u3059\u308b\u30af\u30e9\u30b9</li> </ul> <p></p>"},{"location":"haskell/10-strategy-pattern/#2","title":"2. \u4fa1\u683c\u8a08\u7b97\u6226\u7565","text":""},{"location":"haskell/10-strategy-pattern/#newtype","title":"newtype \u306b\u3088\u308b\u6226\u7565\u306e\u5b9a\u7fa9","text":"<p>Haskell \u3067\u306f\u95a2\u6570\u3092 <code>newtype</code> \u3067\u30e9\u30c3\u30d7\u3057\u3066\u6226\u7565\u3092\u8868\u73fe\u3057\u307e\u3059\uff1a</p> <pre><code>-- | Pricing strategy is a function from amount to final price\nnewtype PricingStrategy = PricingStrategy\n  { runPricing :: Double -&gt; Double\n  }\n\n-- | Apply pricing strategy\ncalculatePrice :: PricingStrategy -&gt; Double -&gt; Double\ncalculatePrice = runPricing\n</code></pre>"},{"location":"haskell/10-strategy-pattern/#_2","title":"\u5177\u4f53\u7684\u306a\u6226\u7565\u306e\u5b9f\u88c5","text":"<pre><code>-- | Regular pricing (no change)\nregularPricing :: PricingStrategy\nregularPricing = PricingStrategy id\n\n-- | Percentage discount\ndiscountPricing :: Double -&gt; PricingStrategy\ndiscountPricing percentage = PricingStrategy $ \\amount -&gt;\n  amount * (1 - percentage)\n\n-- | Fixed discount\nfixedDiscountPricing :: Double -&gt; PricingStrategy\nfixedDiscountPricing discount = PricingStrategy $ \\amount -&gt;\n  max 0 (amount - discount)\n\n-- | Bulk discount: apply percentage if amount exceeds threshold\nbulkDiscountPricing :: Double -&gt; Double -&gt; PricingStrategy\nbulkDiscountPricing threshold percentage = PricingStrategy $ \\amount -&gt;\n  if amount &gt;= threshold\n    then amount * (1 - percentage)\n    else amount\n</code></pre>"},{"location":"haskell/10-strategy-pattern/#_3","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>-- 10% \u30c7\u30a3\u30b9\u30ab\u30a6\u30f3\u30c8\nlet strategy = discountPricing 0.10\ncalculatePrice strategy 1000  -- 900.0\n\n-- 5000\u5186\u4ee5\u4e0a\u306720%\u30c7\u30a3\u30b9\u30ab\u30a6\u30f3\u30c8\nlet bulkStrategy = bulkDiscountPricing 5000 0.20\ncalculatePrice bulkStrategy 6000  -- 4800.0\ncalculatePrice bulkStrategy 4000  -- 4000.0\n</code></pre>"},{"location":"haskell/10-strategy-pattern/#3","title":"3. \u914d\u9001\u6226\u7565","text":""},{"location":"haskell/10-strategy-pattern/#_4","title":"\u91cd\u91cf\u3068\u8ddd\u96e2\u306b\u57fa\u3065\u304f\u914d\u9001\u6599\u91d1","text":"<pre><code>-- | Shipping strategy takes weight and distance, returns shipping cost\nnewtype ShippingStrategy = ShippingStrategy\n  { runShipping :: Double -&gt; Double -&gt; Double\n  }\n\n-- | Calculate shipping cost\ncalculateShipping :: ShippingStrategy -&gt; Double -&gt; Double -&gt; Double\ncalculateShipping = runShipping\n\n-- | Standard shipping: $0.05 per kg per km\nstandardShipping :: ShippingStrategy\nstandardShipping = ShippingStrategy $ \\weight distance -&gt;\n  weight * distance * 0.05\n\n-- | Express shipping: 2x standard\nexpressShipping :: ShippingStrategy\nexpressShipping = ShippingStrategy $ \\weight distance -&gt;\n  weight * distance * 0.10\n\n-- | Free shipping\nfreeShipping :: ShippingStrategy\nfreeShipping = ShippingStrategy $ \\_ _ -&gt; 0\n</code></pre>"},{"location":"haskell/10-strategy-pattern/#4","title":"4. \u30b7\u30e7\u30c3\u30d4\u30f3\u30b0\u30ab\u30fc\u30c8","text":""},{"location":"haskell/10-strategy-pattern/#_5","title":"\u6226\u7565\u3092\u6301\u3064\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8","text":"<pre><code>-- | Cart item\ndata CartItem = CartItem\n  { itemName :: String\n  , itemPrice :: Double\n  , itemQuantity :: Int\n  } deriving (Show, Eq)\n\n-- | Shopping cart with pricing strategy\ndata ShoppingCart = ShoppingCart\n  { cartItems :: [CartItem]\n  , cartPricingStrategy :: PricingStrategy\n  }\n\n-- | Create an empty cart with regular pricing\nmakeCart :: ShoppingCart\nmakeCart = ShoppingCart [] regularPricing\n\n-- | Add item to cart\naddItem :: CartItem -&gt; ShoppingCart -&gt; ShoppingCart\naddItem item cart = cart { cartItems = item : cartItems cart }\n\n-- | Calculate subtotal\ncartSubtotal :: ShoppingCart -&gt; Double\ncartSubtotal cart = sum [itemPrice i * fromIntegral (itemQuantity i) \n                        | i &lt;- cartItems cart]\n\n-- | Calculate total with pricing strategy\ncartTotal :: ShoppingCart -&gt; Double\ncartTotal cart = calculatePrice (cartPricingStrategy cart) (cartSubtotal cart)\n\n-- | Change pricing strategy\nchangeStrategy :: PricingStrategy -&gt; ShoppingCart -&gt; ShoppingCart\nchangeStrategy strategy cart = cart { cartPricingStrategy = strategy }\n</code></pre>"},{"location":"haskell/10-strategy-pattern/#5","title":"5. \u6226\u7565\u306e\u5408\u6210","text":""},{"location":"haskell/10-strategy-pattern/#_6","title":"\u6226\u7565\u3092\u30e2\u30ce\u30a4\u30c9\u3068\u3057\u3066\u5408\u6210","text":"<pre><code>-- | Compose multiple pricing strategies (apply left to right)\ncomposeStrategies :: [PricingStrategy] -&gt; PricingStrategy\ncomposeStrategies strategies = PricingStrategy $ \\amount -&gt;\n  foldl (flip runPricing) amount strategies\n\n-- | Conditional strategy\nconditionalStrategy :: (Double -&gt; Bool) -&gt; PricingStrategy -&gt; PricingStrategy -&gt; PricingStrategy\nconditionalStrategy predicate thenStrategy elseStrategy = PricingStrategy $ \\amount -&gt;\n  if predicate amount\n    then runPricing thenStrategy amount\n    else runPricing elseStrategy amount\n\n-- | Tax strategy\ntaxStrategy :: Double -&gt; PricingStrategy\ntaxStrategy rate = PricingStrategy $ \\amount -&gt; amount * (1 + rate)\n</code></pre>"},{"location":"haskell/10-strategy-pattern/#_7","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>-- 10%\u30c7\u30a3\u30b9\u30ab\u30a6\u30f3\u30c8\u5f8c\u306b8%\u306e\u7a0e\u91d1\nlet discount = discountPricing 0.10\n    tax = taxStrategy 0.08\n    composed = composeStrategies [discount, tax]\ncalculatePrice composed 1000  -- 972.0\n</code></pre>"},{"location":"haskell/10-strategy-pattern/#6","title":"6. \u30bd\u30fc\u30c8\u6226\u7565","text":""},{"location":"haskell/10-strategy-pattern/#_8","title":"\u8907\u6570\u306e\u30bd\u30fc\u30c8\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0","text":"<pre><code>-- | Sorting strategy\nnewtype SortStrategy a = SortStrategy\n  { runSort :: [a] -&gt; [a]\n  }\n\n-- | Sort with a strategy\nsortWith :: Ord a =&gt; SortStrategy a -&gt; [a] -&gt; [a]\nsortWith strategy = runSort strategy\n\n-- | Bubble sort\nbubbleSort :: Ord a =&gt; SortStrategy a\nbubbleSort = SortStrategy bubble\n  where\n    bubble [] = []\n    bubble xs = let (sorted, rest) = bubblePass xs\n                in if null rest then sorted else bubble sorted\n    bubblePass [] = ([], [])\n    bubblePass [x] = ([x], [])\n    bubblePass (x:y:xs)\n      | x &gt; y = let (sorted, rest) = bubblePass (x:xs) in (y:sorted, rest)\n      | otherwise = let (sorted, rest) = bubblePass (y:xs) in (x:sorted, rest)\n\n-- | Quick sort\nquickSort :: Ord a =&gt; SortStrategy a\nquickSort = SortStrategy qsort\n  where\n    qsort [] = []\n    qsort (x:xs) = qsort [y | y &lt;- xs, y &lt; x] \n                   ++ [x] \n                   ++ qsort [y | y &lt;- xs, y &gt;= x]\n\n-- | Merge sort\nmergeSort :: Ord a =&gt; SortStrategy a\nmergeSort = SortStrategy msort\n  where\n    msort [] = []\n    msort [x] = [x]\n    msort xs = merge (msort left) (msort right)\n      where\n        (left, right) = splitAt (length xs `div` 2) xs\n    merge xs [] = xs\n    merge [] ys = ys\n    merge (x:xs) (y:ys)\n      | x &lt;= y    = x : merge xs (y:ys)\n      | otherwise = y : merge (x:xs) ys\n</code></pre>"},{"location":"haskell/10-strategy-pattern/#7","title":"7. \u30c6\u30b9\u30c8","text":"<pre><code>describe \"Pricing Strategies\" $ do\n  it \"applies regular pricing\" $ do\n    calculatePrice regularPricing 100 `shouldBe` 100\n\n  it \"applies percentage discount\" $ do\n    calculatePrice (discountPricing 0.20) 100 `shouldBe` 80\n\n  it \"applies bulk discount when threshold met\" $ do\n    calculatePrice (bulkDiscountPricing 5000 0.20) 6000 `shouldBe` 4800\n\ndescribe \"Shopping Cart\" $ do\n  it \"calculates total with strategy\" $ do\n    let cart = addItem (CartItem \"Book\" 1000 2) \n             $ changeStrategy (discountPricing 0.10) makeCart\n    cartTotal cart `shouldBe` 1800\n\ndescribe \"Sorting Strategies\" $ do\n  it \"all strategies produce same result\" $ property $ \\xs -&gt;\n    let sorted = sort (xs :: [Int])\n    in sortWith quickSort xs == sorted \n       &amp;&amp; sortWith mergeSort xs == sorted\n</code></pre>"},{"location":"haskell/10-strategy-pattern/#_9","title":"\u307e\u3068\u3081","text":"<p>Strategy \u30d1\u30bf\u30fc\u30f3\u306e Haskell \u306b\u304a\u3051\u308b\u5b9f\u88c5\u306e\u30dd\u30a4\u30f3\u30c8\uff1a</p> <ol> <li>\u95a2\u6570\u30d5\u30a1\u30fc\u30b9\u30c8: \u6226\u7565\u3092\u95a2\u6570\u3068\u3057\u3066\u8868\u73fe\u3057\u3001<code>newtype</code> \u3067\u30e9\u30c3\u30d7</li> <li>\u578b\u5b89\u5168\u6027: \u7570\u306a\u308b\u6226\u7565\u306e\u578b\u3092\u5206\u96e2\uff08<code>PricingStrategy</code> vs <code>ShippingStrategy</code>\uff09</li> <li>\u5408\u6210\u53ef\u80fd\u6027: \u6226\u7565\u3092\u5408\u6210\u3057\u3066\u8907\u96d1\u306a\u632f\u308b\u821e\u3044\u3092\u69cb\u7bc9</li> <li>\u30c6\u30b9\u30c8\u5bb9\u6613\u6027: \u7d14\u7c8b\u95a2\u6570\u3068\u3057\u3066\u6226\u7565\u3092\u30c6\u30b9\u30c8\u53ef\u80fd</li> <li>QuickCheck: \u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u3067\u6226\u7565\u306e\u6b63\u5f53\u6027\u3092\u691c\u8a3c</li> </ol>"},{"location":"haskell/11-command-pattern/","title":"\u7b2c11\u7ae0: Command \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"haskell/11-command-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Command \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u30ab\u30d7\u30bb\u30eb\u5316\u3057\u3001\u7570\u306a\u308b\u30ea\u30af\u30a8\u30b9\u30c8\u3067\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u30d1\u30e9\u30e1\u30fc\u30bf\u5316\u3057\u305f\u308a\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u30ad\u30e5\u30fc\u306b\u5165\u308c\u305f\u308a\u3001\u64cd\u4f5c\u306e\u5c65\u6b74\u3092\u8a18\u9332\u3057\u305f\u308a\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u30c6\u30ad\u30b9\u30c8\u7de8\u96c6\u30b3\u30de\u30f3\u30c9\u3001\u30ad\u30e3\u30f3\u30d0\u30b9\u64cd\u4f5c\u30b3\u30de\u30f3\u30c9\u3001Undo/Redo \u6a5f\u80fd\u3001\u30d0\u30c3\u30c1\u51e6\u7406\u3001\u30de\u30af\u30ed\u30b3\u30de\u30f3\u30c9\u306a\u3069\u3092\u901a\u3058\u3066 Command \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"haskell/11-command-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Command \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Command: \u30b3\u30de\u30f3\u30c9\u306e\u5171\u901a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>ConcreteCommand: \u5177\u4f53\u7684\u306a\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u88c5</li> <li>Invoker: \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\u3059\u308b\u30af\u30e9\u30b9</li> <li>Receiver: \u30b3\u30de\u30f3\u30c9\u304c\u64cd\u4f5c\u3059\u308b\u5bfe\u8c61</li> </ul> <p></p>"},{"location":"haskell/11-command-pattern/#2","title":"2. \u30c6\u30ad\u30b9\u30c8\u7de8\u96c6\u30b3\u30de\u30f3\u30c9","text":""},{"location":"haskell/11-command-pattern/#adt","title":"ADT \u306b\u3088\u308b\u30b3\u30de\u30f3\u30c9\u306e\u5b9a\u7fa9","text":"<pre><code>-- | Text editing commands\ndata TextCommand\n  = InsertCommand Int String    -- ^ Insert text at position\n  | DeleteCommand Int Int       -- ^ Delete from position with length\n  | ReplaceCommand Int String String  -- ^ Replace old with new at position\n  deriving (Show, Eq)\n\n-- | Execute a text command on a string\nexecuteTextCommand :: TextCommand -&gt; String -&gt; String\nexecuteTextCommand cmd text = case cmd of\n  InsertCommand pos str -&gt;\n    let (before, after) = splitAt pos text\n    in before ++ str ++ after\n\n  DeleteCommand pos len -&gt;\n    let (before, rest) = splitAt pos text\n        (_, after) = splitAt len rest\n    in before ++ after\n\n  ReplaceCommand pos old new -&gt;\n    let (before, rest) = splitAt pos text\n        (_, after) = splitAt (length old) rest\n    in before ++ new ++ after\n</code></pre>"},{"location":"haskell/11-command-pattern/#undo","title":"Undo \u306e\u5b9f\u88c5","text":"<pre><code>-- | Undo a text command\nundoTextCommand :: TextCommand -&gt; String -&gt; String\nundoTextCommand cmd text = case cmd of\n  InsertCommand pos str -&gt;\n    let (before, rest) = splitAt pos text\n        (_, after) = splitAt (length str) rest\n    in before ++ after\n\n  DeleteCommand pos len -&gt;\n    -- Note: needs original deleted text for proper undo\n    text\n\n  ReplaceCommand pos old new -&gt;\n    let (before, rest) = splitAt pos text\n        (_, after) = splitAt (length new) rest\n    in before ++ old ++ after\n</code></pre>"},{"location":"haskell/11-command-pattern/#3","title":"3. \u30ad\u30e3\u30f3\u30d0\u30b9\u30b3\u30de\u30f3\u30c9","text":""},{"location":"haskell/11-command-pattern/#_2","title":"\u56f3\u5f62\u64cd\u4f5c\u306e\u30b3\u30de\u30f3\u30c9","text":"<pre><code>-- | Canvas shape\ndata CanvasShape = CanvasShape\n  { shapeId :: Int\n  , shapeType :: String\n  , shapeX :: Double\n  , shapeY :: Double\n  } deriving (Show, Eq)\n\n-- | Canvas state\ntype Canvas = [CanvasShape]\n\n-- | Canvas commands\ndata CanvasCommand\n  = AddShapeCommand CanvasShape\n  | MoveShapeCommand Int Double Double  -- ^ id, dx, dy\n  | DeleteShapeCommand Int\n  deriving (Show, Eq)\n\n-- | Execute canvas command\nexecuteCanvasCommand :: CanvasCommand -&gt; Canvas -&gt; Canvas\nexecuteCanvasCommand cmd canvas = case cmd of\n  AddShapeCommand shape -&gt; shape : canvas\n\n  MoveShapeCommand shapeId dx dy -&gt;\n    map (\\s -&gt; if shapeId == CanvasShape.shapeId s\n               then s { shapeX = shapeX s + dx, shapeY = shapeY s + dy }\n               else s) canvas\n\n  DeleteShapeCommand shapeId -&gt;\n    filter (\\s -&gt; CanvasShape.shapeId s /= shapeId) canvas\n</code></pre>"},{"location":"haskell/11-command-pattern/#4","title":"4. \u6c4e\u7528\u7684\u306a\u30b3\u30de\u30f3\u30c9\u30a8\u30b0\u30bc\u30ad\u30e5\u30fc\u30bf","text":""},{"location":"haskell/11-command-pattern/#undoredo","title":"Undo/Redo \u30b9\u30bf\u30c3\u30af\u306e\u5b9f\u88c5","text":"<pre><code>-- | Command executor with undo/redo support\ndata CommandExecutor cmd state = CommandExecutor\n  { executorState :: state\n  , executorUndoStack :: [(cmd, state)]  -- ^ (command, state before execution)\n  , executorRedoStack :: [(cmd, state)]\n  }\n\n-- | Create a new executor\nmakeExecutor :: state -&gt; CommandExecutor cmd state\nmakeExecutor initialState = CommandExecutor\n  { executorState = initialState\n  , executorUndoStack = []\n  , executorRedoStack = []\n  }\n\n-- | Execute a command\nexecuteCommand :: (cmd -&gt; state -&gt; state) \n               -&gt; cmd \n               -&gt; CommandExecutor cmd state \n               -&gt; CommandExecutor cmd state\nexecuteCommand exec cmd executor = CommandExecutor\n  { executorState = exec cmd (executorState executor)\n  , executorUndoStack = (cmd, executorState executor) : executorUndoStack executor\n  , executorRedoStack = []  -- Clear redo stack on new command\n  }\n</code></pre>"},{"location":"haskell/11-command-pattern/#undo-redo","title":"Undo \u3068 Redo","text":"<pre><code>-- | Undo the last command\nundoCommand :: (cmd -&gt; state -&gt; state)\n            -&gt; CommandExecutor cmd state\n            -&gt; CommandExecutor cmd state\nundoCommand undoFn executor = case executorUndoStack executor of\n  [] -&gt; executor  -- Nothing to undo\n  ((cmd, prevState) : rest) -&gt; CommandExecutor\n    { executorState = prevState\n    , executorUndoStack = rest\n    , executorRedoStack = (cmd, executorState executor) : executorRedoStack executor\n    }\n\n-- | Redo the last undone command\nredoCommand :: (cmd -&gt; state -&gt; state)\n            -&gt; CommandExecutor cmd state\n            -&gt; CommandExecutor cmd state\nredoCommand exec executor = case executorRedoStack executor of\n  [] -&gt; executor  -- Nothing to redo\n  ((cmd, _) : rest) -&gt; CommandExecutor\n    { executorState = exec cmd (executorState executor)\n    , executorUndoStack = (cmd, executorState executor) : executorUndoStack executor\n    , executorRedoStack = rest\n    }\n</code></pre>"},{"location":"haskell/11-command-pattern/#5","title":"5. \u30d0\u30c3\u30c1\u51e6\u7406","text":"<pre><code>-- | Execute multiple commands in sequence\nexecuteBatch :: (cmd -&gt; state -&gt; state)\n             -&gt; [cmd]\n             -&gt; CommandExecutor cmd state\n             -&gt; CommandExecutor cmd state\nexecuteBatch exec commands executor =\n  foldl (flip (executeCommand exec)) executor commands\n\n-- | Undo all commands\nundoAll :: (cmd -&gt; state -&gt; state)\n        -&gt; CommandExecutor cmd state\n        -&gt; CommandExecutor cmd state\nundoAll undoFn executor =\n  iterate (undoCommand undoFn) executor !! length (executorUndoStack executor)\n</code></pre>"},{"location":"haskell/11-command-pattern/#6","title":"6. \u30de\u30af\u30ed\u30b3\u30de\u30f3\u30c9","text":"<pre><code>-- | Macro command (composite of commands)\nnewtype MacroCommand cmd = MacroCommand { macroCommands :: [cmd] }\n  deriving (Show, Eq)\n\n-- | Create a macro from commands\nmakeMacro :: [cmd] -&gt; MacroCommand cmd\nmakeMacro = MacroCommand\n\n-- | Execute a macro command\nexecuteMacro :: (cmd -&gt; state -&gt; state)\n             -&gt; MacroCommand cmd\n             -&gt; state\n             -&gt; state\nexecuteMacro exec (MacroCommand cmds) state =\n  foldl (flip exec) state cmds\n\n-- | Undo a macro command (in reverse order)\nundoMacro :: (cmd -&gt; state -&gt; state)\n          -&gt; MacroCommand cmd\n          -&gt; state\n          -&gt; state\nundoMacro undoFn (MacroCommand cmds) state =\n  foldl (flip undoFn) state (reverse cmds)\n</code></pre>"},{"location":"haskell/11-command-pattern/#7","title":"7. \u4f7f\u7528\u4f8b","text":"<pre><code>-- \u30c6\u30ad\u30b9\u30c8\u7de8\u96c6\u306e\u4f8b\nlet initial = \"Hello World\"\n    executor = makeExecutor initial\n\n-- \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\nlet executor' = executeCommand executeTextCommand \n                              (InsertCommand 5 \",\") executor\n-- \"Hello, World\"\n\n-- Undo\nlet executor'' = undoCommand undoTextCommand executor'\n-- \"Hello World\"\n\n-- \u30d0\u30c3\u30c1\u5b9f\u884c\nlet commands = [ InsertCommand 0 \"&gt;&gt;&gt; \"\n               , InsertCommand 15 \" &lt;&lt;&lt;\"\n               ]\n    result = executeBatch executeTextCommand commands executor\n-- \"&gt;&gt;&gt; Hello World &lt;&lt;&lt;\"\n</code></pre>"},{"location":"haskell/11-command-pattern/#8","title":"8. \u30c6\u30b9\u30c8","text":"<pre><code>describe \"Text Commands\" $ do\n  describe \"InsertCommand\" $ do\n    it \"inserts text at position\" $ do\n      executeTextCommand (InsertCommand 5 \", \") \"HelloWorld\" \n        `shouldBe` \"Hello, World\"\n\n    it \"undoes insert\" $ do\n      let cmd = InsertCommand 5 \", \"\n          result = executeTextCommand cmd \"HelloWorld\"\n      undoTextCommand cmd result `shouldBe` \"HelloWorld\"\n\ndescribe \"CommandExecutor\" $ do\n  it \"supports undo/redo\" $ do\n    let executor = makeExecutor \"Hello\"\n        executor' = executeCommand executeTextCommand \n                                  (InsertCommand 5 \" World\") executor\n        executor'' = undoCommand undoTextCommand executor'\n        executor''' = redoCommand executeTextCommand executor''\n    executorState executor' `shouldBe` \"Hello World\"\n    executorState executor'' `shouldBe` \"Hello\"\n    executorState executor''' `shouldBe` \"Hello World\"\n</code></pre>"},{"location":"haskell/11-command-pattern/#_3","title":"\u307e\u3068\u3081","text":"<p>Command \u30d1\u30bf\u30fc\u30f3\u306e Haskell \u306b\u304a\u3051\u308b\u5b9f\u88c5\u306e\u30dd\u30a4\u30f3\u30c8\uff1a</p> <ol> <li>ADT \u306b\u3088\u308b\u30b3\u30de\u30f3\u30c9\u8868\u73fe: \u30b3\u30de\u30f3\u30c9\u3092\u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b\u3067\u5b9a\u7fa9</li> <li>\u7d14\u7c8b\u95a2\u6570\u3068\u3057\u3066\u306e\u5b9f\u884c: \u72b6\u614b\u3092\u5f15\u6570\u3068\u3057\u3066\u53d7\u3051\u53d6\u308a\u3001\u65b0\u3057\u3044\u72b6\u614b\u3092\u8fd4\u3059</li> <li>\u5c65\u6b74\u7ba1\u7406: Undo/Redo \u30b9\u30bf\u30c3\u30af\u3092\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u3067\u7ba1\u7406</li> <li>\u5408\u6210\u53ef\u80fd\u6027: \u30de\u30af\u30ed\u30b3\u30de\u30f3\u30c9\u306b\u3088\u308b\u30b3\u30de\u30f3\u30c9\u306e\u7d44\u307f\u5408\u308f\u305b</li> <li>\u578b\u5b89\u5168\u6027: \u7570\u306a\u308b\u30c9\u30e1\u30a4\u30f3\u306e\u30b3\u30de\u30f3\u30c9\u3092\u578b\u3067\u5206\u96e2</li> </ol>"},{"location":"haskell/12-visitor-pattern/","title":"\u7b2c12\u7ae0: Visitor \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"haskell/12-visitor-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Visitor \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u69cb\u9020\u306e\u8981\u7d20\u306b\u5bfe\u3057\u3066\u5b9f\u884c\u3059\u308b\u64cd\u4f5c\u3092\u5206\u96e2\u3057\u3001\u69cb\u9020\u3092\u5909\u66f4\u305b\u305a\u306b\u65b0\u3057\u3044\u64cd\u4f5c\u3092\u8ffd\u52a0\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u56f3\u5f62\u306e\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba\u3001\u6570\u5f0f\u306e\u8a55\u4fa1\u3068\u7c21\u7d04\u3001\u30c4\u30ea\u30fc\u69cb\u9020\u306e\u64cd\u4f5c\u306a\u3069\u3092\u901a\u3058\u3066 Visitor \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"haskell/12-visitor-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Visitor \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Visitor: \u5404\u8981\u7d20\u578b\u306b\u5bfe\u3059\u308b\u64cd\u4f5c\u3092\u5b9a\u7fa9</li> <li>Element: accept \u30e1\u30bd\u30c3\u30c9\u3092\u6301\u3064\u8981\u7d20</li> <li>ConcreteElement: \u5177\u4f53\u7684\u306a\u8981\u7d20\u306e\u5b9f\u88c5</li> </ul> <p></p>"},{"location":"haskell/12-visitor-pattern/#2-haskell-visitor","title":"2. Haskell \u306b\u304a\u3051\u308b Visitor \u30d1\u30bf\u30fc\u30f3","text":"<p>Haskell \u3067\u306f ADT \u3068\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u306b\u3088\u308a\u3001Visitor \u30d1\u30bf\u30fc\u30f3\u3092\u81ea\u7136\u306b\u8868\u73fe\u3067\u304d\u307e\u3059\u3002Visitor \u306f\u5358\u306a\u308b\u95a2\u6570\u3068\u3057\u3066\u5b9f\u88c5\u3055\u308c\u307e\u3059\u3002</p>"},{"location":"haskell/12-visitor-pattern/#_2","title":"\u56f3\u5f62\u306e\u5b9a\u7fa9","text":"<pre><code>-- | 2D Point\ndata Point = Point Double Double\n  deriving (Show, Eq)\n\n-- | Shape ADT\ndata Shape\n  = Circle Point Double           -- ^ Circle with center and radius\n  | Square Point Double           -- ^ Square with top-left and side\n  | Rectangle Point Double Double -- ^ Rectangle with top-left, width, height\n  deriving (Show, Eq)\n</code></pre>"},{"location":"haskell/12-visitor-pattern/#3-visitor","title":"3. \u56f3\u5f62\u3078\u306e Visitor","text":""},{"location":"haskell/12-visitor-pattern/#json","title":"JSON \u30b7\u30ea\u30a2\u30e9\u30a4\u30ba","text":"<pre><code>-- | Convert shape to JSON string\nshapeToJson :: Shape -&gt; String\nshapeToJson shape = case shape of\n  Circle (Point x y) r -&gt;\n    \"{\\\"type\\\":\\\"circle\\\",\\\"center\\\":[\" ++ show x ++ \",\" ++ show y \n    ++ \"],\\\"radius\\\":\" ++ show r ++ \"}\"\n\n  Square (Point x y) s -&gt;\n    \"{\\\"type\\\":\\\"square\\\",\\\"topLeft\\\":[\" ++ show x ++ \",\" ++ show y \n    ++ \"],\\\"side\\\":\" ++ show s ++ \"}\"\n\n  Rectangle (Point x y) w h -&gt;\n    \"{\\\"type\\\":\\\"rectangle\\\",\\\"topLeft\\\":[\" ++ show x ++ \",\" ++ show y \n    ++ \"],\\\"width\\\":\" ++ show w ++ \",\\\"height\\\":\" ++ show h ++ \"}\"\n</code></pre>"},{"location":"haskell/12-visitor-pattern/#xml","title":"XML \u30b7\u30ea\u30a2\u30e9\u30a4\u30ba","text":"<pre><code>-- | Convert shape to XML string\nshapeToXml :: Shape -&gt; String\nshapeToXml shape = case shape of\n  Circle (Point x y) r -&gt;\n    \"&lt;circle&gt;&lt;center x=\\\"\" ++ show x ++ \"\\\" y=\\\"\" ++ show y \n    ++ \"\\\"/&gt;&lt;radius&gt;\" ++ show r ++ \"&lt;/radius&gt;&lt;/circle&gt;\"\n\n  Square (Point x y) s -&gt;\n    \"&lt;square&gt;&lt;topLeft x=\\\"\" ++ show x ++ \"\\\" y=\\\"\" ++ show y \n    ++ \"\\\"/&gt;&lt;side&gt;\" ++ show s ++ \"&lt;/side&gt;&lt;/square&gt;\"\n\n  Rectangle (Point x y) w h -&gt;\n    \"&lt;rectangle&gt;&lt;topLeft x=\\\"\" ++ show x ++ \"\\\" y=\\\"\" ++ show y \n    ++ \"\\\"/&gt;&lt;width&gt;\" ++ show w ++ \"&lt;/width&gt;&lt;height&gt;\" \n    ++ show h ++ \"&lt;/height&gt;&lt;/rectangle&gt;\"\n</code></pre>"},{"location":"haskell/12-visitor-pattern/#_3","title":"\u9762\u7a4d\u3068\u5468\u56f2\u9577\u306e\u8a08\u7b97","text":"<pre><code>-- | Calculate shape area\nshapeArea :: Shape -&gt; Double\nshapeArea shape = case shape of\n  Circle _ r -&gt; pi * r * r\n  Square _ s -&gt; s * s\n  Rectangle _ w h -&gt; w * h\n\n-- | Calculate shape perimeter\nshapePerimeter :: Shape -&gt; Double\nshapePerimeter shape = case shape of\n  Circle _ r -&gt; 2 * pi * r\n  Square _ s -&gt; 4 * s\n  Rectangle _ w h -&gt; 2 * (w + h)\n\n-- | Calculate bounding box (minX, minY, maxX, maxY)\nshapeBoundingBox :: Shape -&gt; (Double, Double, Double, Double)\nshapeBoundingBox shape = case shape of\n  Circle (Point x y) r -&gt; (x - r, y - r, x + r, y + r)\n  Square (Point x y) s -&gt; (x, y, x + s, y + s)\n  Rectangle (Point x y) w h -&gt; (x, y, x + w, y + h)\n</code></pre>"},{"location":"haskell/12-visitor-pattern/#4-visitor","title":"4. Visitor \u306e\u5408\u6210","text":"<pre><code>-- | Visit multiple shapes with a visitor function\nvisitShapes :: (Shape -&gt; a) -&gt; [Shape] -&gt; [a]\nvisitShapes = map\n\n-- | Calculate total area of shapes\ntotalArea :: [Shape] -&gt; Double\ntotalArea = sum . visitShapes shapeArea\n\n-- | Calculate total perimeter of shapes\ntotalPerimeter :: [Shape] -&gt; Double\ntotalPerimeter = sum . visitShapes shapePerimeter\n</code></pre>"},{"location":"haskell/12-visitor-pattern/#5-visitor","title":"5. \u6570\u5f0f\u3078\u306e Visitor","text":""},{"location":"haskell/12-visitor-pattern/#adt","title":"\u6570\u5f0f ADT","text":"<pre><code>-- | Expression ADT\ndata Expr\n  = Num Double                    -- ^ Numeric literal\n  | Var String                    -- ^ Variable\n  | Add Expr Expr                 -- ^ Addition\n  | Sub Expr Expr                 -- ^ Subtraction\n  | Mul Expr Expr                 -- ^ Multiplication\n  | Div Expr Expr                 -- ^ Division\n  | Neg Expr                      -- ^ Negation\n  deriving (Show, Eq)\n</code></pre>"},{"location":"haskell/12-visitor-pattern/#visitor","title":"\u8a55\u4fa1 Visitor","text":"<pre><code>-- | Evaluate an expression with variable bindings\nevaluate :: [(String, Double)] -&gt; Expr -&gt; Maybe Double\nevaluate env expr = case expr of\n  Num n -&gt; Just n\n  Var name -&gt; lookup name env\n  Add l r -&gt; (+) &lt;$&gt; evaluate env l &lt;*&gt; evaluate env r\n  Sub l r -&gt; (-) &lt;$&gt; evaluate env l &lt;*&gt; evaluate env r\n  Mul l r -&gt; (*) &lt;$&gt; evaluate env l &lt;*&gt; evaluate env r\n  Div l r -&gt; do\n    lv &lt;- evaluate env l\n    rv &lt;- evaluate env r\n    if rv == 0 then Nothing else Just (lv / rv)\n  Neg e -&gt; negate &lt;$&gt; evaluate env e\n</code></pre>"},{"location":"haskell/12-visitor-pattern/#pretty-print-visitor","title":"Pretty Print Visitor","text":"<pre><code>-- | Pretty print an expression\nprettyPrint :: Expr -&gt; String\nprettyPrint expr = case expr of\n  Num n -&gt; show n\n  Var name -&gt; name\n  Add l r -&gt; \"(\" ++ prettyPrint l ++ \" + \" ++ prettyPrint r ++ \")\"\n  Sub l r -&gt; \"(\" ++ prettyPrint l ++ \" - \" ++ prettyPrint r ++ \")\"\n  Mul l r -&gt; \"(\" ++ prettyPrint l ++ \" * \" ++ prettyPrint r ++ \")\"\n  Div l r -&gt; \"(\" ++ prettyPrint l ++ \" / \" ++ prettyPrint r ++ \")\"\n  Neg e -&gt; \"-\" ++ prettyPrint e\n</code></pre>"},{"location":"haskell/12-visitor-pattern/#visitor_1","title":"\u5909\u6570\u62bd\u51fa Visitor","text":"<pre><code>-- | Get all variable names in an expression\nexprVariables :: Expr -&gt; [String]\nexprVariables expr = nub $ go expr\n  where\n    go (Num _) = []\n    go (Var name) = [name]\n    go (Add l r) = go l ++ go r\n    go (Sub l r) = go l ++ go r\n    go (Mul l r) = go l ++ go r\n    go (Div l r) = go l ++ go r\n    go (Neg e) = go e\n</code></pre>"},{"location":"haskell/12-visitor-pattern/#visitor_2","title":"\u7c21\u7d04 Visitor","text":"<pre><code>-- | Simplify an expression\nsimplify :: Expr -&gt; Expr\nsimplify expr = case expr of\n  Add l r -&gt; case (simplify l, simplify r) of\n    (Num 0, r') -&gt; r'\n    (l', Num 0) -&gt; l'\n    (Num a, Num b) -&gt; Num (a + b)\n    (l', r') -&gt; Add l' r'\n\n  Sub l r -&gt; case (simplify l, simplify r) of\n    (l', Num 0) -&gt; l'\n    (Num a, Num b) -&gt; Num (a - b)\n    (l', r') | l' == r' -&gt; Num 0\n    (l', r') -&gt; Sub l' r'\n\n  Mul l r -&gt; case (simplify l, simplify r) of\n    (Num 0, _) -&gt; Num 0\n    (_, Num 0) -&gt; Num 0\n    (Num 1, r') -&gt; r'\n    (l', Num 1) -&gt; l'\n    (Num a, Num b) -&gt; Num (a * b)\n    (l', r') -&gt; Mul l' r'\n\n  Neg e -&gt; case simplify e of\n    Num n -&gt; Num (-n)\n    Neg e' -&gt; e'\n    e' -&gt; Neg e'\n\n  e -&gt; e\n</code></pre>"},{"location":"haskell/12-visitor-pattern/#6-visitor","title":"6. \u30c4\u30ea\u30fc\u3078\u306e Visitor","text":""},{"location":"haskell/12-visitor-pattern/#_4","title":"\u30b8\u30a7\u30cd\u30ea\u30c3\u30af\u306a\u30c4\u30ea\u30fc\u69cb\u9020","text":"<pre><code>-- | Generic tree\ndata Tree a\n  = Leaf a\n  | Node a [Tree a]\n  deriving (Show, Eq)\n</code></pre>"},{"location":"haskell/12-visitor-pattern/#fold-visitor","title":"Fold Visitor","text":"<pre><code>-- | Fold a tree with functions for leaf and node\ntreeFold :: (a -&gt; b) -&gt; (a -&gt; [b] -&gt; b) -&gt; Tree a -&gt; b\ntreeFold leafFn nodeFn tree = case tree of\n  Leaf x -&gt; leafFn x\n  Node x children -&gt; nodeFn x (map (treeFold leafFn nodeFn) children)\n\n-- | Map a function over tree values\ntreeMap :: (a -&gt; b) -&gt; Tree a -&gt; Tree b\ntreeMap f tree = case tree of\n  Leaf x -&gt; Leaf (f x)\n  Node x children -&gt; Node (f x) (map (treeMap f) children)\n</code></pre>"},{"location":"haskell/12-visitor-pattern/#visitor_3","title":"\u6d3e\u751f\u3059\u308b Visitor","text":"<pre><code>-- | Count nodes in tree\ntreeSize :: Tree a -&gt; Int\ntreeSize = treeFold (const 1) (\\_ sizes -&gt; 1 + sum sizes)\n\n-- | Calculate tree depth\ntreeDepth :: Tree a -&gt; Int\ntreeDepth = treeFold (const 1) (\\_ depths -&gt; 1 + maximum (0 : depths))\n\n-- | Convert tree to list (preorder)\ntreeToList :: Tree a -&gt; [a]\ntreeToList = treeFold (: []) (\\x childLists -&gt; x : concat childLists)\n</code></pre>"},{"location":"haskell/12-visitor-pattern/#7","title":"7. \u30c6\u30b9\u30c8","text":"<pre><code>describe \"Shape Visitors\" $ do\n  it \"converts to JSON\" $ do\n    shapeToJson (Circle (Point 10 20) 5) \n      `shouldBe` \"{\\\"type\\\":\\\"circle\\\",\\\"center\\\":[10.0,20.0],\\\"radius\\\":5.0}\"\n\n  it \"calculates area\" $ do\n    shapeArea (Square (Point 0 0) 4) `shouldBe` 16\n\ndescribe \"Expression Visitors\" $ do\n  it \"evaluates expression\" $ do\n    evaluate [(\"x\", 2)] (Add (Var \"x\") (Num 3)) `shouldBe` Just 5\n\n  it \"simplifies expression\" $ do\n    simplify (Add (Var \"x\") (Num 0)) `shouldBe` Var \"x\"\n\ndescribe \"Tree Visitors\" $ do\n  it \"counts nodes\" $ do\n    let tree = Node 1 [Leaf 2, Node 3 [Leaf 4, Leaf 5]]\n    treeSize tree `shouldBe` 5\n</code></pre>"},{"location":"haskell/12-visitor-pattern/#_5","title":"\u307e\u3068\u3081","text":"<p>Visitor \u30d1\u30bf\u30fc\u30f3\u306e Haskell \u306b\u304a\u3051\u308b\u5b9f\u88c5\u306e\u30dd\u30a4\u30f3\u30c8\uff1a</p> <ol> <li>\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0: ADT \u306b\u5bfe\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3067\u81ea\u7136\u306b Visitor \u3092\u5b9f\u88c5</li> <li>\u95a2\u6570\u3068\u3057\u3066\u306e Visitor: \u5404 Visitor \u306f\u5358\u306a\u308b\u95a2\u6570\u3068\u3057\u3066\u8868\u73fe</li> <li>\u5408\u6210\u53ef\u80fd\u6027: <code>map</code> \u3084 <code>fold</code> \u3092\u4f7f\u3063\u3066 Visitor \u3092\u5408\u6210</li> <li>\u518d\u5e30\u7684\u69cb\u9020: \u30c4\u30ea\u30fc\u3084\u6570\u5f0f\u306a\u3069\u306e\u518d\u5e30\u7684\u30c7\u30fc\u30bf\u69cb\u9020\u306b\u5bfe\u5fdc</li> <li>\u65b0\u3057\u3044\u64cd\u4f5c\u306e\u8ffd\u52a0: \u65e2\u5b58\u306e\u578b\u3092\u5909\u66f4\u305b\u305a\u306b\u65b0\u3057\u3044 Visitor \u3092\u8ffd\u52a0\u53ef\u80fd</li> </ol>"},{"location":"haskell/13-abstract-factory-pattern/","title":"\u7b2c13\u7ae0: Abstract Factory \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"haskell/13-abstract-factory-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u95a2\u9023\u3059\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u5bb6\u65cf\u3092\u3001\u305d\u306e\u5177\u4f53\u7684\u306a\u30af\u30e9\u30b9\u3092\u6307\u5b9a\u305b\u305a\u306b\u751f\u6210\u3059\u308b\u305f\u3081\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u63d0\u4f9b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u56f3\u5f62\u30d5\u30a1\u30af\u30c8\u30ea\u30fc\uff08\u6a19\u6e96\u3001\u30a2\u30a6\u30c8\u30e9\u30a4\u30f3\u3001\u5857\u308a\u3064\u3076\u3057\uff09\u3068 UI \u30d5\u30a1\u30af\u30c8\u30ea\u30fc\uff08Windows\u3001MacOS\u3001Linux\uff09\u3092\u901a\u3058\u3066 Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"haskell/13-abstract-factory-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>AbstractFactory: \u88fd\u54c1\u7fa4\u3092\u751f\u6210\u3059\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>ConcreteFactory: \u5177\u4f53\u7684\u306a\u88fd\u54c1\u7fa4\u3092\u751f\u6210\u3059\u308b\u30d5\u30a1\u30af\u30c8\u30ea\u30fc</li> <li>AbstractProduct: \u88fd\u54c1\u306e\u62bd\u8c61\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>ConcreteProduct: \u5177\u4f53\u7684\u306a\u88fd\u54c1</li> </ul> <p></p>"},{"location":"haskell/13-abstract-factory-pattern/#2","title":"2. \u56f3\u5f62\u30d5\u30a1\u30af\u30c8\u30ea\u30fc","text":""},{"location":"haskell/13-abstract-factory-pattern/#_2","title":"\u88fd\u54c1\u306e\u5b9a\u7fa9","text":"<pre><code>-- | 2D Point\ndata Point = Point Double Double\n  deriving (Show, Eq)\n\n-- | Shape style\ndata ShapeStyle = ShapeStyle\n  { styleOutlineColor :: Maybe String\n  , styleOutlineWidth :: Maybe Double\n  , styleFillColor :: Maybe String\n  } deriving (Show, Eq)\n\n-- | Default (empty) style\ndefaultStyle :: ShapeStyle\ndefaultStyle = ShapeStyle Nothing Nothing Nothing\n\n-- | Shape with style\ndata Shape\n  = Circle Point Double ShapeStyle\n  | Square Point Double ShapeStyle\n  | Rectangle Point Double Double ShapeStyle\n  deriving (Show, Eq)\n</code></pre>"},{"location":"haskell/13-abstract-factory-pattern/#_3","title":"\u578b\u30af\u30e9\u30b9\u306b\u3088\u308b\u30d5\u30a1\u30af\u30c8\u30ea\u30fc\u306e\u5b9a\u7fa9","text":"<pre><code>-- | Abstract factory for creating shapes\nclass ShapeFactory f where\n  createCircle :: f -&gt; Point -&gt; Double -&gt; Shape\n  createSquare :: f -&gt; Point -&gt; Double -&gt; Shape\n  createRectangle :: f -&gt; Point -&gt; Double -&gt; Double -&gt; Shape\n</code></pre>"},{"location":"haskell/13-abstract-factory-pattern/#_4","title":"\u6a19\u6e96\u30d5\u30a1\u30af\u30c8\u30ea\u30fc","text":"<pre><code>-- | Standard shape factory (no styling)\ndata StandardFactory = StandardFactory\n  deriving (Show, Eq)\n\ninstance ShapeFactory StandardFactory where\n  createCircle _ center radius = Circle center radius defaultStyle\n  createSquare _ topLeft side = Square topLeft side defaultStyle\n  createRectangle _ topLeft width height = Rectangle topLeft width height defaultStyle\n</code></pre>"},{"location":"haskell/13-abstract-factory-pattern/#_5","title":"\u30a2\u30a6\u30c8\u30e9\u30a4\u30f3\u30d5\u30a1\u30af\u30c8\u30ea\u30fc","text":"<pre><code>-- | Factory that creates shapes with outline\ndata OutlinedFactory = OutlinedFactory\n  { ofOutlineColor :: String\n  , ofOutlineWidth :: Double\n  } deriving (Show, Eq)\n\n-- | Create an outlined factory\nmakeOutlinedFactory :: String -&gt; Double -&gt; OutlinedFactory\nmakeOutlinedFactory = OutlinedFactory\n\ninstance ShapeFactory OutlinedFactory where\n  createCircle f center radius = Circle center radius style\n    where style = defaultStyle { styleOutlineColor = Just (ofOutlineColor f)\n                                , styleOutlineWidth = Just (ofOutlineWidth f) }\n\n  createSquare f topLeft side = Square topLeft side style\n    where style = defaultStyle { styleOutlineColor = Just (ofOutlineColor f)\n                                , styleOutlineWidth = Just (ofOutlineWidth f) }\n\n  createRectangle f topLeft width height = Rectangle topLeft width height style\n    where style = defaultStyle { styleOutlineColor = Just (ofOutlineColor f)\n                                , styleOutlineWidth = Just (ofOutlineWidth f) }\n</code></pre>"},{"location":"haskell/13-abstract-factory-pattern/#_6","title":"\u5857\u308a\u3064\u3076\u3057\u30d5\u30a1\u30af\u30c8\u30ea\u30fc","text":"<pre><code>-- | Factory that creates shapes with fill color\ndata FilledFactory = FilledFactory\n  { ffFillColor :: String\n  } deriving (Show, Eq)\n\n-- | Create a filled factory\nmakeFilledFactory :: String -&gt; FilledFactory\nmakeFilledFactory = FilledFactory\n\ninstance ShapeFactory FilledFactory where\n  createCircle f center radius = Circle center radius style\n    where style = defaultStyle { styleFillColor = Just (ffFillColor f) }\n\n  createSquare f topLeft side = Square topLeft side style\n    where style = defaultStyle { styleFillColor = Just (ffFillColor f) }\n\n  createRectangle f topLeft width height = Rectangle topLeft width height style\n    where style = defaultStyle { styleFillColor = Just (ffFillColor f) }\n</code></pre>"},{"location":"haskell/13-abstract-factory-pattern/#3-ui","title":"3. UI \u30d5\u30a1\u30af\u30c8\u30ea\u30fc","text":""},{"location":"haskell/13-abstract-factory-pattern/#ui","title":"UI \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u5b9a\u7fa9","text":"<pre><code>-- | Button component\ndata Button = Button\n  { buttonLabel :: String\n  , buttonPlatform :: String\n  } deriving (Show, Eq)\n\n-- | Text field component\ndata TextField = TextField\n  { textFieldPlaceholder :: String\n  , textFieldPlatform :: String\n  } deriving (Show, Eq)\n\n-- | Check box component\ndata CheckBox = CheckBox\n  { checkBoxLabel :: String\n  , checkBoxChecked :: Bool\n  , checkBoxPlatform :: String\n  } deriving (Show, Eq)\n</code></pre>"},{"location":"haskell/13-abstract-factory-pattern/#ui_1","title":"UI \u30d5\u30a1\u30af\u30c8\u30ea\u30fc\u306e\u578b\u30af\u30e9\u30b9","text":"<pre><code>-- | Abstract factory for creating UI components\nclass UIFactory f where\n  createButton :: f -&gt; String -&gt; Button\n  createTextField :: f -&gt; String -&gt; TextField\n  createCheckBox :: f -&gt; String -&gt; Bool -&gt; CheckBox\n</code></pre>"},{"location":"haskell/13-abstract-factory-pattern/#_7","title":"\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u5225\u30d5\u30a1\u30af\u30c8\u30ea\u30fc","text":"<pre><code>-- | Windows UI factory\ndata WindowsFactory = WindowsFactory\n  deriving (Show, Eq)\n\ninstance UIFactory WindowsFactory where\n  createButton _ label = Button label \"windows\"\n  createTextField _ placeholder = TextField placeholder \"windows\"\n  createCheckBox _ label checked = CheckBox label checked \"windows\"\n\n-- | MacOS UI factory\ndata MacOSFactory = MacOSFactory\n  deriving (Show, Eq)\n\ninstance UIFactory MacOSFactory where\n  createButton _ label = Button label \"macos\"\n  createTextField _ placeholder = TextField placeholder \"macos\"\n  createCheckBox _ label checked = CheckBox label checked \"macos\"\n\n-- | Linux UI factory\ndata LinuxFactory = LinuxFactory\n  deriving (Show, Eq)\n\ninstance UIFactory LinuxFactory where\n  createButton _ label = Button label \"linux\"\n  createTextField _ placeholder = TextField placeholder \"linux\"\n  createCheckBox _ label checked = CheckBox label checked \"linux\"\n</code></pre>"},{"location":"haskell/13-abstract-factory-pattern/#4","title":"4. \u30ec\u30f3\u30c0\u30ea\u30f3\u30b0","text":"<pre><code>-- | Render a button to string\nrenderButton :: Button -&gt; String\nrenderButton btn = case buttonPlatform btn of\n  \"windows\" -&gt; \"[\" ++ buttonLabel btn ++ \"]\"\n  \"macos\"   -&gt; \"(\" ++ buttonLabel btn ++ \")\"\n  \"linux\"   -&gt; \"&lt;\" ++ buttonLabel btn ++ \"&gt;\"\n  _         -&gt; buttonLabel btn\n\n-- | Render a text field to string\nrenderTextField :: TextField -&gt; String\nrenderTextField tf = case textFieldPlatform tf of\n  \"windows\" -&gt; \"[____\" ++ textFieldPlaceholder tf ++ \"____]\"\n  \"macos\"   -&gt; \"(____\" ++ textFieldPlaceholder tf ++ \"____)\"\n  \"linux\"   -&gt; \"&lt;____\" ++ textFieldPlaceholder tf ++ \"____&gt;\"\n  _         -&gt; textFieldPlaceholder tf\n\n-- | Render a check box to string\nrenderCheckBox :: CheckBox -&gt; String\nrenderCheckBox cb = \n  let mark = if checkBoxChecked cb then \"X\" else \" \"\n  in case checkBoxPlatform cb of\n    \"windows\" -&gt; \"[\" ++ mark ++ \"] \" ++ checkBoxLabel cb\n    \"macos\"   -&gt; \"(\" ++ mark ++ \") \" ++ checkBoxLabel cb\n    \"linux\"   -&gt; \"&lt;\" ++ mark ++ \"&gt; \" ++ checkBoxLabel cb\n    _         -&gt; \"[\" ++ mark ++ \"] \" ++ checkBoxLabel cb\n</code></pre>"},{"location":"haskell/13-abstract-factory-pattern/#5","title":"5. \u30d5\u30a1\u30af\u30c8\u30ea\u30fc\u3092\u4f7f\u7528\u3059\u308b\u30b3\u30fc\u30c9","text":"<pre><code>-- | Form containing UI components\ndata Form = Form\n  { formButton :: Button\n  , formTextField :: TextField\n  , formCheckBox :: CheckBox\n  } deriving (Show, Eq)\n\n-- | Create a form using a factory\ncreateForm :: UIFactory f =&gt; f -&gt; Form\ncreateForm factory = Form\n  { formButton = createButton factory \"Submit\"\n  , formTextField = createTextField factory \"Email\"\n  , formCheckBox = createCheckBox factory \"Subscribe\" False\n  }\n</code></pre>"},{"location":"haskell/13-abstract-factory-pattern/#_8","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>-- Windows \u30d5\u30a9\u30fc\u30e0\nlet windowsForm = createForm WindowsFactory\nrenderButton (formButton windowsForm)  -- \"[Submit]\"\n\n-- MacOS \u30d5\u30a9\u30fc\u30e0\nlet macForm = createForm MacOSFactory\nrenderButton (formButton macForm)  -- \"(Submit)\"\n\n-- Linux \u30d5\u30a9\u30fc\u30e0\nlet linuxForm = createForm LinuxFactory\nrenderButton (formButton linuxForm)  -- \"&lt;Submit&gt;\"\n</code></pre>"},{"location":"haskell/13-abstract-factory-pattern/#6","title":"6. \u30c6\u30b9\u30c8","text":"<pre><code>describe \"Shape Factory\" $ do\n  describe \"StandardFactory\" $ do\n    it \"creates shapes without style\" $ do\n      let factory = StandardFactory\n          circle = createCircle factory (Point 0 0) 10\n      case circle of\n        Circle _ _ style -&gt; do\n          styleOutlineColor style `shouldBe` Nothing\n          styleFillColor style `shouldBe` Nothing\n        _ -&gt; expectationFailure \"Expected Circle\"\n\n  describe \"OutlinedFactory\" $ do\n    it \"creates shapes with outline\" $ do\n      let factory = makeOutlinedFactory \"black\" 2.0\n          circle = createCircle factory (Point 0 0) 10\n      case circle of\n        Circle _ _ style -&gt; do\n          styleOutlineColor style `shouldBe` Just \"black\"\n          styleOutlineWidth style `shouldBe` Just 2.0\n        _ -&gt; expectationFailure \"Expected Circle\"\n\ndescribe \"UI Factory\" $ do\n  it \"creates platform-specific components\" $ do\n    let form = createForm WindowsFactory\n    buttonPlatform (formButton form) `shouldBe` \"windows\"\n\n    let macForm = createForm MacOSFactory\n    buttonPlatform (formButton macForm) `shouldBe` \"macos\"\n</code></pre>"},{"location":"haskell/13-abstract-factory-pattern/#_9","title":"\u307e\u3068\u3081","text":"<p>Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306e Haskell \u306b\u304a\u3051\u308b\u5b9f\u88c5\u306e\u30dd\u30a4\u30f3\u30c8\uff1a</p> <ol> <li>\u578b\u30af\u30e9\u30b9\u306b\u3088\u308b\u62bd\u8c61\u5316: \u30d5\u30a1\u30af\u30c8\u30ea\u30fc\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u578b\u30af\u30e9\u30b9\u3067\u5b9a\u7fa9</li> <li>\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u306b\u3088\u308b\u5177\u8c61\u5316: \u5404\u5177\u8c61\u30d5\u30a1\u30af\u30c8\u30ea\u30fc\u3092\u578b\u30af\u30e9\u30b9\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3068\u3057\u3066\u5b9f\u88c5</li> <li>\u591a\u614b\u7684\u306a\u4f7f\u7528: <code>UIFactory f =&gt; f -&gt; ...</code> \u306e\u3088\u3046\u306a\u5236\u7d04\u4ed8\u304d\u306e\u578b\u3067\u62bd\u8c61\u30d5\u30a1\u30af\u30c8\u30ea\u30fc\u3092\u4f7f\u7528</li> <li>\u88fd\u54c1\u306e\u4e00\u8cab\u6027: \u540c\u3058\u30d5\u30a1\u30af\u30c8\u30ea\u30fc\u304b\u3089\u751f\u6210\u3055\u308c\u308b\u88fd\u54c1\u306f\u4e00\u8cab\u3057\u305f\u30b9\u30bf\u30a4\u30eb/\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3092\u6301\u3064</li> <li>\u30c6\u30b9\u30c8\u5bb9\u6613\u6027: \u30d5\u30a1\u30af\u30c8\u30ea\u30fc\u3092\u5dee\u3057\u66ff\u3048\u308b\u3053\u3068\u3067\u30c6\u30b9\u30c8\u304c\u5bb9\u6613</li> </ol>"},{"location":"haskell/14-abstract-server-pattern/","title":"\u7b2c14\u7ae0: Abstract Server \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"haskell/14-abstract-server-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Abstract Server \u30d1\u30bf\u30fc\u30f3\u306f\u3001Dependency Inversion Principle\uff08DIP\uff09\u306e\u9069\u7528\u4f8b\u3067\u3042\u308a\u3001\u9ad8\u30ec\u30d9\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u4f4e\u30ec\u30d9\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u4f9d\u5b58\u305b\u305a\u3001\u4e21\u8005\u304c\u62bd\u8c61\u306b\u4f9d\u5b58\u3059\u308b\u3088\u3046\u306b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u30b9\u30a4\u30c3\u30c1\u30e3\u30d6\u30eb\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\uff08Light, Fan, Motor\uff09\u3001\u30ea\u30dd\u30b8\u30c8\u30ea\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3001\u30ed\u30ac\u30fc\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u901a\u3058\u3066 Abstract Server \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"haskell/14-abstract-server-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Abstract Server \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Client: \u62bd\u8c61\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306b\u4f9d\u5b58\u3059\u308b\u30af\u30e9\u30a4\u30a2\u30f3\u30c8</li> <li>Abstract Server: \u30b5\u30fc\u30d0\u30fc\u306e\u62bd\u8c61\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>Concrete Server: \u5177\u4f53\u7684\u306a\u30b5\u30fc\u30d0\u30fc\u306e\u5b9f\u88c5</li> </ul> <p></p>"},{"location":"haskell/14-abstract-server-pattern/#2-switchable","title":"2. Switchable \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9","text":""},{"location":"haskell/14-abstract-server-pattern/#_2","title":"\u62bd\u8c61\u30b5\u30fc\u30d0\u30fc\u306e\u5b9a\u7fa9","text":"<pre><code>-- | State of a switchable device\ndata SwitchState = On | Off\n  deriving (Show, Eq)\n\n-- | Switchable interface (Abstract Server)\nclass Switchable a where\n  turnOn :: a -&gt; a\n  turnOff :: a -&gt; a\n  isOn :: a -&gt; Bool\n</code></pre>"},{"location":"haskell/14-abstract-server-pattern/#light","title":"Light \u306e\u5b9f\u88c5","text":"<pre><code>-- | Light device\ndata Light = Light\n  { lightState :: SwitchState\n  , lightName :: String\n  } deriving (Show, Eq)\n\n-- | Create a light (off by default)\nmakeLight :: String -&gt; Light\nmakeLight name = Light Off name\n\n-- | Create a light that is on\nmakeLightOn :: String -&gt; Light\nmakeLightOn name = Light On name\n\ninstance Switchable Light where\n  turnOn light = light { lightState = On }\n  turnOff light = light { lightState = Off }\n  isOn light = lightState light == On\n</code></pre>"},{"location":"haskell/14-abstract-server-pattern/#fan","title":"Fan \u306e\u5b9f\u88c5","text":"<pre><code>-- | Fan speed levels\ndata FanSpeed = Low | Medium | High\n  deriving (Show, Eq, Ord)\n\n-- | Fan device\ndata Fan = Fan\n  { fanState :: SwitchState\n  , fanSpeed :: FanSpeed\n  , fanName :: String\n  } deriving (Show, Eq)\n\n-- | Create a fan\nmakeFan :: String -&gt; Fan\nmakeFan name = Fan Off Low name\n\n-- | Set fan speed (only works when on)\nsetFanSpeed :: FanSpeed -&gt; Fan -&gt; Fan\nsetFanSpeed speed fan\n  | isOn fan = fan { fanSpeed = speed }\n  | otherwise = fan\n\ninstance Switchable Fan where\n  turnOn fan = fan { fanState = On }\n  turnOff fan = fan { fanState = Off }\n  isOn fan = fanState fan == On\n</code></pre>"},{"location":"haskell/14-abstract-server-pattern/#motor","title":"Motor \u306e\u5b9f\u88c5","text":"<pre><code>-- | Motor direction\ndata MotorDirection = Forward | Reverse\n  deriving (Show, Eq)\n\n-- | Motor device\ndata Motor = Motor\n  { motorState :: SwitchState\n  , motorDirection :: MotorDirection\n  , motorName :: String\n  } deriving (Show, Eq)\n\n-- | Create a motor\nmakeMotor :: String -&gt; Motor\nmakeMotor name = Motor Off Forward name\n\n-- | Reverse motor direction (only works when on)\nreverseMotor :: Motor -&gt; Motor\nreverseMotor motor\n  | isOn motor = motor { motorDirection = flipDir (motorDirection motor) }\n  | otherwise = motor\n  where\n    flipDir Forward = Reverse\n    flipDir Reverse = Forward\n\ninstance Switchable Motor where\n  turnOn motor = motor { motorState = On }\n  turnOff motor = motor { motorState = Off }\n  isOn motor = motorState motor == On\n</code></pre>"},{"location":"haskell/14-abstract-server-pattern/#3","title":"3. \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b3\u30fc\u30c9","text":"<pre><code>-- | Engage a switch (turn on)\nengage :: Switchable a =&gt; a -&gt; a\nengage = turnOn\n\n-- | Disengage a switch (turn off)\ndisengage :: Switchable a =&gt; a -&gt; a\ndisengage = turnOff\n\n-- | Toggle a switch\ntoggle :: Switchable a =&gt; a -&gt; a\ntoggle device\n  | isOn device = turnOff device\n  | otherwise = turnOn device\n\n-- | Get switch status\nswitchStatus :: Switchable a =&gt; a -&gt; SwitchState\nswitchStatus device\n  | isOn device = On\n  | otherwise = Off\n</code></pre>"},{"location":"haskell/14-abstract-server-pattern/#4-repository","title":"4. Repository \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9","text":""},{"location":"haskell/14-abstract-server-pattern/#associated-type","title":"Associated Type \u3092\u4f7f\u7528\u3057\u305f\u5b9a\u7fa9","text":"<pre><code>{-# LANGUAGE TypeFamilies #-}\n\n-- | Entity with ID\nclass Entity a where\n  entityId :: a -&gt; String\n  setEntityId :: String -&gt; a -&gt; a\n\n-- | Repository interface (Abstract Server)\nclass Repository r where\n  type Item r\n  findById :: r -&gt; String -&gt; Maybe (Item r)\n  findAll :: r -&gt; [Item r]\n  save :: r -&gt; Item r -&gt; (r, Item r)\n  delete :: r -&gt; String -&gt; (r, Maybe (Item r))\n</code></pre>"},{"location":"haskell/14-abstract-server-pattern/#memory-repository","title":"Memory Repository \u306e\u5b9f\u88c5","text":"<pre><code>import qualified Data.Map.Strict as Map\n\n-- | In-memory repository\ndata MemoryRepository a = MemoryRepository\n  { memData :: Map String a\n  , memNextId :: Int\n  } deriving (Show, Eq)\n\n-- | Create an empty memory repository\nmakeMemoryRepo :: MemoryRepository a\nmakeMemoryRepo = MemoryRepository Map.empty 1\n\ninstance Entity a =&gt; Repository (MemoryRepository a) where\n  type Item (MemoryRepository a) = a\n\n  findById repo idVal = Map.lookup idVal (memData repo)\n\n  findAll repo = Map.elems (memData repo)\n\n  save repo entity = \n    let id' = entityId entity\n        newId = if null id' then show (memNextId repo) else id'\n        entity' = setEntityId newId entity\n        newData = Map.insert newId entity' (memData repo)\n        newNextId = if null id' then memNextId repo + 1 else memNextId repo\n    in (repo { memData = newData, memNextId = newNextId }, entity')\n\n  delete repo idVal =\n    let entity = Map.lookup idVal (memData repo)\n        newData = Map.delete idVal (memData repo)\n    in (repo { memData = newData }, entity)\n</code></pre>"},{"location":"haskell/14-abstract-server-pattern/#mock-repository","title":"Mock Repository \u306e\u5b9f\u88c5","text":"<pre><code>-- | Mock repository for testing\ndata MockRepository a = MockRepository\n  { mockData :: [a]\n  } deriving (Show, Eq)\n\n-- | Create a mock repository with predefined data\nmakeMockRepo :: [a] -&gt; MockRepository a\nmakeMockRepo = MockRepository\n\ninstance Entity a =&gt; Repository (MockRepository a) where\n  type Item (MockRepository a) = a\n\n  findById repo idVal = \n    case filter (\\x -&gt; entityId x == idVal) (mockData repo) of\n      (x:_) -&gt; Just x\n      [] -&gt; Nothing\n\n  findAll repo = mockData repo\n\n  save repo entity =\n    let id' = entityId entity\n        newId = if null id' then show (length (mockData repo) + 1) else id'\n        entity' = setEntityId newId entity\n        newData = mockData repo ++ [entity']\n    in (repo { mockData = newData }, entity')\n\n  delete repo idVal =\n    let (deleted, remaining) = partition (\\x -&gt; entityId x == idVal) (mockData repo)\n    in (repo { mockData = remaining }, listToMaybe deleted)\n</code></pre>"},{"location":"haskell/14-abstract-server-pattern/#5","title":"5. \u30b5\u30fc\u30d3\u30b9\u5c64","text":"<pre><code>-- | User entity\ndata User = User\n  { userId :: String\n  , userName :: String\n  , userEmail :: String\n  } deriving (Show, Eq)\n\ninstance Entity User where\n  entityId = userId\n  setEntityId idVal user = user { userId = idVal }\n\n-- | Create a new user\ncreateUser :: (Repository r, Item r ~ User) =&gt; r -&gt; String -&gt; String -&gt; (r, User)\ncreateUser repo name email = \n  let user = User \"\" name email\n  in save repo user\n\n-- | Get a user by ID\ngetUser :: Repository r =&gt; r -&gt; String -&gt; Maybe (Item r)\ngetUser = findById\n\n-- | Get all users\ngetAllUsers :: Repository r =&gt; r -&gt; [Item r]\ngetAllUsers = findAll\n\n-- | Delete a user\ndeleteUser :: Repository r =&gt; r -&gt; String -&gt; (r, Maybe (Item r))\ndeleteUser = delete\n</code></pre>"},{"location":"haskell/14-abstract-server-pattern/#6-logger","title":"6. Logger \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9","text":"<pre><code>-- | Log levels\ndata LogLevel = Debug | Info | Warning | Error\n  deriving (Show, Eq, Ord)\n\n-- | Logger interface (Abstract Server)\nclass Logger l where\n  logMessage :: l -&gt; LogLevel -&gt; String -&gt; (l, String)\n\n-- | Console logger\ndata ConsoleLogger = ConsoleLogger\n  { clMinLevel :: LogLevel\n  } deriving (Show, Eq)\n\ninstance Logger ConsoleLogger where\n  logMessage logger level msg\n    | level &gt;= clMinLevel logger = \n        let output = \"[\" ++ show level ++ \"] \" ++ msg\n        in (logger, output)\n    | otherwise = (logger, \"\")\n\n-- | Null logger (discards all messages)\ndata NullLogger = NullLogger\n  deriving (Show, Eq)\n\ninstance Logger NullLogger where\n  logMessage logger _ _ = (logger, \"\")\n\n-- | File logger (stores messages in a list)\ndata FileLogger = FileLogger\n  { flPath :: String\n  , flMessages :: [String]\n  } deriving (Show, Eq)\n\ninstance Logger FileLogger where\n  logMessage logger level msg =\n    let formatted = \"[\" ++ show level ++ \"] \" ++ msg\n        newMessages = flMessages logger ++ [formatted]\n    in (logger { flMessages = newMessages }, formatted)\n</code></pre>"},{"location":"haskell/14-abstract-server-pattern/#7","title":"7. \u30c6\u30b9\u30c8","text":"<pre><code>describe \"Switchable\" $ do\n  it \"can toggle any switchable device\" $ do\n    let light = toggle (makeLight \"Test\")\n        fan = toggle (makeFan \"Test\")\n    isOn light `shouldBe` True\n    isOn fan `shouldBe` True\n\ndescribe \"Repository\" $ do\n  it \"works with memory repository\" $ do\n    let repo = makeMemoryRepo :: MemoryRepository User\n        (repo', user) = createUser repo \"John\" \"john@test.com\"\n    getUser repo' (entityId user) `shouldBe` Just user\n\n  it \"works with mock repository\" $ do\n    let user1 = User \"1\" \"Alice\" \"alice@test.com\"\n        repo = makeMockRepo [user1]\n    findById repo \"1\" `shouldBe` Just user1\n\ndescribe \"Logger\" $ do\n  it \"console logger filters by level\" $ do\n    let logger = ConsoleLogger Warning\n        (_, output1) = logMessage logger Info \"Info\"\n        (_, output2) = logMessage logger Error \"Error\"\n    output1 `shouldBe` \"\"\n    output2 `shouldBe` \"[Error] Error\"\n\n  it \"null logger discards all\" $ do\n    let (_, output) = logMessage NullLogger Error \"Error\"\n    output `shouldBe` \"\"\n</code></pre>"},{"location":"haskell/14-abstract-server-pattern/#_3","title":"\u307e\u3068\u3081","text":"<p>Abstract Server \u30d1\u30bf\u30fc\u30f3\u306e Haskell \u306b\u304a\u3051\u308b\u5b9f\u88c5\u306e\u30dd\u30a4\u30f3\u30c8\uff1a</p> <ol> <li>\u578b\u30af\u30e9\u30b9\u306b\u3088\u308b\u62bd\u8c61\u5316: \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u578b\u30af\u30e9\u30b9\u3067\u5b9a\u7fa9</li> <li>Associated Types: \u30ea\u30dd\u30b8\u30c8\u30ea\u306e\u3088\u3046\u306b\u95a2\u9023\u3059\u308b\u578b\u304c\u3042\u308b\u5834\u5408\u306f Associated Types \u3092\u4f7f\u7528</li> <li>\u591a\u614b\u7684\u306a\u30af\u30e9\u30a4\u30a2\u30f3\u30c8: \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30b3\u30fc\u30c9\u306f\u578b\u30af\u30e9\u30b9\u5236\u7d04\u306e\u307f\u306b\u4f9d\u5b58</li> <li>\u30c6\u30b9\u30c8\u5bb9\u6613\u6027: Mock \u5b9f\u88c5\u3092\u4f7f\u3063\u3066\u30c6\u30b9\u30c8\u304c\u5bb9\u6613</li> <li>DIP \u306e\u5b9f\u73fe: \u9ad8\u30ec\u30d9\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\uff08\u30b5\u30fc\u30d3\u30b9\u5c64\uff09\u304c\u4f4e\u30ec\u30d9\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\uff08\u30ea\u30dd\u30b8\u30c8\u30ea\u5b9f\u88c5\uff09\u306b\u4f9d\u5b58\u3057\u306a\u3044</li> <li>\u62e1\u5f35\u6027: \u65b0\u3057\u3044\u5b9f\u88c5\u3092\u8ffd\u52a0\u3057\u3066\u3082\u65e2\u5b58\u30b3\u30fc\u30c9\u306b\u5f71\u97ff\u3057\u306a\u3044</li> </ol>"},{"location":"haskell/15-gossiping-bus-drivers/","title":"\u7b2c15\u7ae0: \u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b","text":""},{"location":"haskell/15-gossiping-bus-drivers/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u300c\u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b\u300d\u3068\u3044\u3046\u554f\u984c\u3092\u901a\u3058\u3066\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u5b9f\u8df5\u7684\u306a\u30a2\u30d7\u30ed\u30fc\u30c1\u3092\u5b66\u3073\u307e\u3059\u3002\u3053\u306e\u554f\u984c\u306f\u3001\u30d0\u30b9\u904b\u8ee2\u624b\u304c\u505c\u7559\u6240\u3067\u51fa\u4f1a\u3063\u305f\u3068\u304d\u306b\u5642\u3092\u5171\u6709\u3059\u308b\u3068\u3044\u3046\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3067\u3059\u3002</p> <p>\u3053\u306e\u554f\u984c\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u306e\u6982\u5ff5\u3092\u5b66\u3073\u307e\u3059\uff1a</p> <ul> <li>\u7121\u9650\u30b7\u30fc\u30b1\u30f3\u30b9\uff08<code>cycle</code>\uff09\u306b\u3088\u308b\u5faa\u74b0\u30c7\u30fc\u30bf\u306e\u8868\u73fe</li> <li>\u96c6\u5408\u6f14\u7b97\u306b\u3088\u308b\u72b6\u614b\u306e\u4f1d\u64ad</li> <li>\u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u8a2d\u8a08</li> </ul>"},{"location":"haskell/15-gossiping-bus-drivers/#1","title":"1. \u554f\u984c\u306e\u8aac\u660e","text":"<p>\u8907\u6570\u306e\u30d0\u30b9\u904b\u8ee2\u624b\u304c\u305d\u308c\u305e\u308c\u306e\u30eb\u30fc\u30c8\u3092\u5de1\u56de\u3057\u3066\u3044\u307e\u3059\u3002\u5404\u904b\u8ee2\u624b\u306f\u6700\u521d\u306b1\u3064\u306e\u5642\uff08\u81ea\u5206\u306eID\uff09\u3092\u77e5\u3063\u3066\u3044\u307e\u3059\u3002\u540c\u3058\u505c\u7559\u6240\u306b\u8907\u6570\u306e\u904b\u8ee2\u624b\u304c\u3044\u308b\u3068\u3001\u5f7c\u3089\u306f\u77e5\u3063\u3066\u3044\u308b\u5642\u3092\u3059\u3079\u3066\u5171\u6709\u3057\u307e\u3059\u3002</p> <p>\u30b4\u30fc\u30eb: \u5168\u3066\u306e\u904b\u8ee2\u624b\u304c\u5168\u3066\u306e\u5642\u3092\u77e5\u308b\u307e\u3067\u306b\u4f55\u5206\u304b\u304b\u308b\u304b\uff1f</p>"},{"location":"haskell/15-gossiping-bus-drivers/#2","title":"2. \u30c7\u30fc\u30bf\u30e2\u30c7\u30eb","text":""},{"location":"haskell/15-gossiping-bus-drivers/#_2","title":"\u30c9\u30e9\u30a4\u30d0\u30fc\u306e\u8868\u73fe","text":"<pre><code>-- | A stop identifier\ntype Stop = Int\n\n-- | A gossip piece (unique per driver)\ntype Gossip = Int\n\n-- | A bus driver with their route and known gossip\ndata Driver = Driver\n  { driverId :: Int\n  , driverRoute :: [Stop]     -- ^ Infinite cyclic route\n  , driverGossip :: Set Gossip\n  } deriving (Show, Eq)\n\n-- | The world state is a list of drivers\ntype World = [Driver]\n</code></pre>"},{"location":"haskell/15-gossiping-bus-drivers/#_3","title":"\u30c9\u30e9\u30a4\u30d0\u30fc\u306e\u4f5c\u6210","text":"<pre><code>-- | Create a driver with a route (cycles infinitely) and initial gossip\nmakeDriver :: Int -&gt; [Stop] -&gt; Driver\nmakeDriver dId route = Driver\n  { driverId = dId\n  , driverRoute = cycle route\n  , driverGossip = Set.singleton dId\n  }\n\n-- | Create multiple drivers from routes\nmakeDrivers :: [[Stop]] -&gt; [Driver]\nmakeDrivers routes = zipWith makeDriver [0..] routes\n</code></pre> <p>\u30dd\u30a4\u30f3\u30c8: - <code>cycle</code> \u95a2\u6570\u3067\u6709\u9650\u306e\u30eb\u30fc\u30c8\u3092\u7121\u9650\u306e\u5faa\u74b0\u30b7\u30fc\u30b1\u30f3\u30b9\u306b\u5909\u63db - \u5642\u306f\u96c6\u5408\uff08Set\uff09\u3068\u3057\u3066\u7ba1\u7406 - \u5404\u30c9\u30e9\u30a4\u30d0\u30fc\u306f\u81ea\u5206\u306eID\u3092\u521d\u671f\u306e\u5642\u3068\u3057\u3066\u6301\u3064</p>"},{"location":"haskell/15-gossiping-bus-drivers/#3","title":"3. \u79fb\u52d5\u3068\u5642\u306e\u4f1d\u64ad","text":""},{"location":"haskell/15-gossiping-bus-drivers/#_4","title":"\u30c9\u30e9\u30a4\u30d0\u30fc\u306e\u79fb\u52d5","text":"<pre><code>-- | Get the current stop of a driver\ncurrentStop :: Driver -&gt; Stop\ncurrentStop driver = head (driverRoute driver)\n\n-- | Move a driver to their next stop\nmoveDriver :: Driver -&gt; Driver\nmoveDriver driver = driver { driverRoute = tail (driverRoute driver) }\n\n-- | Move all drivers to their next stops\nmoveDrivers :: World -&gt; World\nmoveDrivers = map moveDriver\n</code></pre>"},{"location":"haskell/15-gossiping-bus-drivers/#_5","title":"\u505c\u7559\u6240\u3054\u3068\u306e\u30c9\u30e9\u30a4\u30d0\u30fc\u96c6\u8a08","text":"<pre><code>-- | Group drivers by their current stop\ndriversAtStops :: World -&gt; Map Stop [Driver]\ndriversAtStops = foldr addDriver Map.empty\n  where\n    addDriver driver acc = \n      let stop = currentStop driver\n      in Map.insertWith (++) stop [driver] acc\n</code></pre>"},{"location":"haskell/15-gossiping-bus-drivers/#_6","title":"\u5642\u306e\u5171\u6709","text":"<pre><code>-- | Merge gossip among a group of drivers\nmergeGossip :: [Driver] -&gt; [Driver]\nmergeGossip drivers =\n  let allGossips = Set.unions (map driverGossip drivers)\n  in map (\\d -&gt; d { driverGossip = allGossips }) drivers\n\n-- | Spread gossip at all stops\nspreadGossip :: World -&gt; World\nspreadGossip world =\n  let byStop = driversAtStops world\n      merged = Map.map mergeGossip byStop\n  in concatMap snd (Map.toList merged)\n</code></pre>"},{"location":"haskell/15-gossiping-bus-drivers/#4","title":"4. \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3","text":""},{"location":"haskell/15-gossiping-bus-drivers/#1_1","title":"1\u30b9\u30c6\u30c3\u30d7\u306e\u51e6\u7406","text":"<pre><code>-- | One step of simulation: move then spread gossip\ndrive :: World -&gt; World\ndrive = spreadGossip . moveDrivers\n</code></pre>"},{"location":"haskell/15-gossiping-bus-drivers/#_7","title":"\u5b8c\u4e86\u5224\u5b9a","text":"<pre><code>-- | Check if all drivers know all gossip\nallGossipShared :: World -&gt; Bool\nallGossipShared [] = True\nallGossipShared (d:ds) = all (\\driver -&gt; driverGossip driver == driverGossip d) ds\n\n-- | Get the total set of all gossip in the world\ntotalGossip :: World -&gt; Set Gossip\ntotalGossip = Set.unions . map driverGossip\n</code></pre>"},{"location":"haskell/15-gossiping-bus-drivers/#5","title":"5. \u30bd\u30eb\u30d0\u30fc","text":"<pre><code>-- | Solve the problem: find minutes until all gossip is shared\n-- Returns Nothing if it takes more than 480 minutes (8 hours)\nsolve :: [[Stop]] -&gt; Maybe Int\nsolve = solveWithLimit 480\n\n-- | Solve with a custom time limit\nsolveWithLimit :: Int -&gt; [[Stop]] -&gt; Maybe Int\nsolveWithLimit limit routes = go 0 (makeDrivers routes)\n  where\n    go minutes world\n      | minutes &gt; limit = Nothing\n      | allGossipShared world = Just minutes\n      | otherwise = go (minutes + 1) (drive world)\n</code></pre>"},{"location":"haskell/15-gossiping-bus-drivers/#6","title":"6. \u30c6\u30b9\u30c8","text":"<pre><code>describe \"Solver\" $ do\n  it \"solves case requiring multiple steps\" $ do\n    -- d0: 1 -&gt; 2 -&gt; 3\n    -- d1: 3 -&gt; 2 -&gt; 1\n    -- Initial: d0 at 1, d1 at 3\n    -- After 1: d0 at 2, d1 at 2 - they meet!\n    let routes = [[1, 2, 3], [3, 2, 1]]\n    solve routes `shouldBe` Just 1\n\n  it \"returns Nothing when drivers never meet\" $ do\n    let routes = [[1, 2], [3, 4]]\n    solve routes `shouldBe` Nothing\n</code></pre>"},{"location":"haskell/15-gossiping-bus-drivers/#_8","title":"\u307e\u3068\u3081","text":"<p>\u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b\u554f\u984c\u306e Haskell \u5b9f\u88c5\u306e\u30dd\u30a4\u30f3\u30c8\uff1a</p> <ol> <li>\u7121\u9650\u30ea\u30b9\u30c8: <code>cycle</code> \u3067\u6709\u9650\u30eb\u30fc\u30c8\u3092\u7121\u9650\u5316</li> <li>\u4e0d\u5909\u30c7\u30fc\u30bf: \u5404\u30b9\u30c6\u30c3\u30d7\u3067\u65b0\u3057\u3044 World \u3092\u751f\u6210</li> <li>\u96c6\u5408\u6f14\u7b97: <code>Set.unions</code> \u3067\u5642\u3092\u52b9\u7387\u7684\u306b\u30de\u30fc\u30b8</li> <li>\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3: <code>drive = spreadGossip . moveDrivers</code> \u3067\u51e6\u7406\u3092\u5408\u6210</li> <li>\u7d42\u4e86\u6761\u4ef6: \u5168\u30c9\u30e9\u30a4\u30d0\u30fc\u306e\u5642\u304c\u7b49\u3057\u3051\u308c\u3070\u5b8c\u4e86</li> </ol>"},{"location":"haskell/16-payroll-system/","title":"\u7b2c16\u7ae0: \u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0","text":""},{"location":"haskell/16-payroll-system/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0\u3092\u984c\u6750\u306b\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u304a\u3051\u308b\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30ea\u30f3\u30b0\u3068\u591a\u614b\u6027\u306e\u5b9f\u73fe\u3092\u5b66\u3073\u307e\u3059\u3002</p> <p>\u3053\u306e\u554f\u984c\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u306e\u6982\u5ff5\u3092\u5b66\u3073\u307e\u3059\uff1a</p> <ul> <li>ADT \u306b\u3088\u308b\u30c7\u30fc\u30bf\u4ed5\u69d8\u5b9a\u7fa9</li> <li>\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u306b\u3088\u308b\u7d66\u4e0e\u30bf\u30a4\u30d7\u5225\u306e\u8a08\u7b97</li> <li>\u652f\u6255\u3044\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u306e\u30e2\u30c7\u30ea\u30f3\u30b0</li> </ul>"},{"location":"haskell/16-payroll-system/#1","title":"1. \u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30eb","text":""},{"location":"haskell/16-payroll-system/#_2","title":"\u5f93\u696d\u54e1\u306e\u7d66\u4e0e\u30bf\u30a4\u30d7","text":"<p>\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0\u3067\u306f\u3001\u4ee5\u4e0b\u306e3\u7a2e\u985e\u306e\u7d66\u4e0e\u30bf\u30a4\u30d7\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u307e\u3059\uff1a</p> <ul> <li>\u6708\u7d66\u5236\uff08Salaried\uff09: \u56fa\u5b9a\u6708\u7d66</li> <li>\u6642\u7d66\u5236\uff08Hourly\uff09: \u52b4\u50cd\u6642\u9593\u306b\u57fa\u3065\u304f\u7d66\u4e0e\uff08\u6b8b\u696d\u306f1.5\u500d\uff09</li> <li>\u6b69\u5408\u5236\uff08Commissioned\uff09: \u57fa\u672c\u7d66 + \u58f2\u4e0a\u306b\u5fdc\u3058\u305f\u30b3\u30df\u30c3\u30b7\u30e7\u30f3</li> </ul>"},{"location":"haskell/16-payroll-system/#2","title":"2. \u578b\u5b9a\u7fa9","text":""},{"location":"haskell/16-payroll-system/#_3","title":"\u7d66\u4e0e\u5206\u985e","text":"<pre><code>-- | Pay classification determines how pay is calculated\ndata PayClass\n  = Salaried Double                    -- ^ Fixed salary\n  | Hourly Double                      -- ^ Hourly rate\n  | Commissioned Double Double         -- ^ Base pay, commission rate\n  deriving (Show, Eq)\n</code></pre>"},{"location":"haskell/16-payroll-system/#_4","title":"\u652f\u6255\u3044\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3068\u65b9\u6cd5","text":"<pre><code>-- | Payment schedule\ndata PaySchedule\n  = Monthly    -- ^ Paid monthly (last day of month)\n  | Weekly     -- ^ Paid weekly (every Friday)\n  | BiWeekly   -- ^ Paid every two weeks\n  deriving (Show, Eq)\n\n-- | Payment method\ndata PaymentMethod\n  = Hold            -- ^ Hold for pickup\n  | DirectDeposit String  -- ^ Direct deposit to account\n  | Mail String     -- ^ Mail to address\n  deriving (Show, Eq)\n</code></pre>"},{"location":"haskell/16-payroll-system/#_5","title":"\u5f93\u696d\u54e1\u30ec\u30b3\u30fc\u30c9","text":"<pre><code>-- | Employee record\ndata Employee = Employee\n  { employeeId :: EmployeeId\n  , employeeName :: String\n  , employeePayClass :: PayClass\n  , employeeSchedule :: PaySchedule\n  , employeePaymentMethod :: PaymentMethod\n  } deriving (Show, Eq)\n</code></pre>"},{"location":"haskell/16-payroll-system/#3","title":"3. \u5f93\u696d\u54e1\u306e\u4f5c\u6210","text":"<pre><code>-- | Create a salaried employee\nmakeSalariedEmployee :: EmployeeId -&gt; String -&gt; Double -&gt; Employee\nmakeSalariedEmployee eid name salary = Employee\n  { employeeId = eid\n  , employeeName = name\n  , employeePayClass = Salaried salary\n  , employeeSchedule = Monthly\n  , employeePaymentMethod = Hold\n  }\n\n-- | Create an hourly employee\nmakeHourlyEmployee :: EmployeeId -&gt; String -&gt; Double -&gt; Employee\nmakeHourlyEmployee eid name hourlyRate = Employee\n  { employeeId = eid\n  , employeeName = name\n  , employeePayClass = Hourly hourlyRate\n  , employeeSchedule = Weekly\n  , employeePaymentMethod = Hold\n  }\n\n-- | Create a commissioned employee\nmakeCommissionedEmployee :: EmployeeId -&gt; String -&gt; Double -&gt; Double -&gt; Employee\nmakeCommissionedEmployee eid name basePay commissionRate = Employee\n  { employeeId = eid\n  , employeeName = name\n  , employeePayClass = Commissioned basePay commissionRate\n  , employeeSchedule = BiWeekly\n  , employeePaymentMethod = Hold\n  }\n</code></pre>"},{"location":"haskell/16-payroll-system/#4","title":"4. \u30bf\u30a4\u30e0\u30ab\u30fc\u30c9\u3068\u58f2\u4e0a\u30c7\u30fc\u30bf","text":"<pre><code>-- | Time card for hourly employees\ndata TimeCard = TimeCard\n  { tcDate :: Day\n  , tcHours :: Double\n  } deriving (Show, Eq)\n\n-- | Sales receipt for commissioned employees\ndata SalesReceipt = SalesReceipt\n  { srDate :: Day\n  , srAmount :: Double\n  } deriving (Show, Eq)\n\n-- | Context for pay calculation\ndata PayContext = PayContext\n  { ctxTimeCards :: Map EmployeeId [TimeCard]\n  , ctxSalesReceipts :: Map EmployeeId [SalesReceipt]\n  , ctxPayDate :: Day\n  } deriving (Show, Eq)\n</code></pre>"},{"location":"haskell/16-payroll-system/#5","title":"5. \u7d66\u4e0e\u8a08\u7b97","text":""},{"location":"haskell/16-payroll-system/#_6","title":"\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u306b\u3088\u308b\u8a08\u7b97","text":"<pre><code>-- | Calculate pay for an employee\ncalculatePay :: Employee -&gt; PayContext -&gt; Double\ncalculatePay emp ctx = case employeePayClass emp of\n  Salaried salary -&gt; salary\n  Hourly rate -&gt; calculateHourlyPay rate (getTimeCards emp ctx)\n  Commissioned basePay commRate -&gt; \n    calculateCommissionedPay basePay commRate (getSalesReceipts emp ctx)\n</code></pre>"},{"location":"haskell/16-payroll-system/#_7","title":"\u6642\u7d66\u5236\u306e\u8a08\u7b97","text":"<pre><code>-- | Calculate hourly pay with overtime (1.5x for hours over 40)\ncalculateHourlyPay :: Double -&gt; [TimeCard] -&gt; Double\ncalculateHourlyPay rate cards =\n  let totalHours = sum (map tcHours cards)\n      regularHours = min totalHours 40\n      overtimeHours = max 0 (totalHours - 40)\n  in regularHours * rate + overtimeHours * rate * 1.5\n</code></pre>"},{"location":"haskell/16-payroll-system/#_8","title":"\u6b69\u5408\u5236\u306e\u8a08\u7b97","text":"<pre><code>-- | Calculate commissioned pay\ncalculateCommissionedPay :: Double -&gt; Double -&gt; [SalesReceipt] -&gt; Double\ncalculateCommissionedPay basePay commRate receipts =\n  let totalSales = sum (map srAmount receipts)\n  in basePay + totalSales * commRate\n</code></pre>"},{"location":"haskell/16-payroll-system/#6","title":"6. \u7d66\u4e0e\u652f\u6255\u3044\u51e6\u7406","text":"<pre><code>-- | Pay check issued to an employee\ndata PayCheck = PayCheck\n  { checkEmployeeId :: EmployeeId\n  , checkEmployeeName :: String\n  , checkAmount :: Double\n  , checkMethod :: PaymentMethod\n  } deriving (Show, Eq)\n\n-- | Process a single employee\nprocessEmployee :: Employee -&gt; PayContext -&gt; PayCheck\nprocessEmployee emp ctx = PayCheck\n  { checkEmployeeId = employeeId emp\n  , checkEmployeeName = employeeName emp\n  , checkAmount = calculatePay emp ctx\n  , checkMethod = employeePaymentMethod emp\n  }\n\n-- | Run payroll for all employees\nrunPayroll :: [Employee] -&gt; PayContext -&gt; [PayCheck]\nrunPayroll employees ctx = map (`processEmployee` ctx) employees\n</code></pre>"},{"location":"haskell/16-payroll-system/#7","title":"7. \u30c6\u30b9\u30c8","text":"<pre><code>describe \"calculatePay\" $ do\n  it \"calculates salaried pay\" $ do\n    let emp = makeSalariedEmployee \"E001\" \"John\" 5000\n        ctx = emptyContext (fromGregorian 2026 1 31)\n    calculatePay emp ctx `shouldBe` 5000\n\n  it \"calculates hourly pay with overtime\" $ do\n    let emp = makeHourlyEmployee \"E001\" \"Jane\" 20.0\n        ctx = emptyContext (fromGregorian 2026 1 7)\n        cards = [TimeCard (fromGregorian 2026 1 d) 10.0 | d &lt;- [1..5]]\n        ctx' = foldr (addTimeCard \"E001\") ctx cards\n    -- 40 * 20 + 10 * 20 * 1.5 = 800 + 300 = 1100\n    calculatePay emp ctx' `shouldBe` 1100.0\n\n  it \"calculates commissioned pay\" $ do\n    let emp = makeCommissionedEmployee \"E001\" \"Bob\" 1500 0.10\n        ctx = emptyContext (fromGregorian 2026 1 14)\n        sr1 = SalesReceipt (fromGregorian 2026 1 10) 5000.0\n        ctx' = addSalesReceipt \"E001\" sr1 ctx\n    -- 1500 + 5000 * 0.10 = 1500 + 500 = 2000\n    calculatePay emp ctx' `shouldBe` 2000.0\n</code></pre>"},{"location":"haskell/16-payroll-system/#_9","title":"\u307e\u3068\u3081","text":"<p>\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0\u306e Haskell \u5b9f\u88c5\u306e\u30dd\u30a4\u30f3\u30c8\uff1a</p> <ol> <li>ADT \u306b\u3088\u308b\u5206\u985e: <code>PayClass</code> \u3067\u7d66\u4e0e\u30bf\u30a4\u30d7\u3092\u8868\u73fe</li> <li>\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0: <code>case</code> \u5f0f\u3067\u7d66\u4e0e\u30bf\u30a4\u30d7\u5225\u306b\u51e6\u7406</li> <li>\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u30d1\u30bf\u30fc\u30f3: <code>PayContext</code> \u3067\u8a08\u7b97\u306b\u5fc5\u8981\u306a\u30c7\u30fc\u30bf\u3092\u6e21\u3059</li> <li>\u7d14\u7c8b\u95a2\u6570: \u526f\u4f5c\u7528\u306e\u306a\u3044\u8a08\u7b97\u3067\u4e88\u6e2c\u53ef\u80fd\u306a\u52d5\u4f5c</li> <li>\u30b9\u30de\u30fc\u30c8\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf: <code>makeSalariedEmployee</code> \u7b49\u3067\u4e00\u8cab\u3057\u305f\u521d\u671f\u5316</li> </ol>"},{"location":"haskell/17-video-rental-system/","title":"\u7b2c17\u7ae0: \u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0","text":""},{"location":"haskell/17-video-rental-system/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Martin Fowler \u306e\u300c\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u300d\u3067\u6709\u540d\u306a\u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0\u3092\u984c\u6750\u306b\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u3088\u308b\u6599\u91d1\u8a08\u7b97\u30ed\u30b8\u30c3\u30af\u306e\u8a2d\u8a08\u3092\u5b66\u3073\u307e\u3059\u3002</p> <p>\u3053\u306e\u554f\u984c\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u306e\u6982\u5ff5\u3092\u5b66\u3073\u307e\u3059\uff1a</p> <ul> <li>ADT \u306b\u3088\u308b\u30ab\u30c6\u30b4\u30ea\u5225\u30dd\u30ea\u30b7\u30fc\u30d1\u30bf\u30fc\u30f3</li> <li>\u660e\u7d30\u66f8\u30d5\u30a9\u30fc\u30de\u30c3\u30bf\u30fc\u306e\u5b9f\u88c5</li> <li>\u30c7\u30fc\u30bf\u3068\u51e6\u7406\u306e\u5206\u96e2</li> </ul>"},{"location":"haskell/17-video-rental-system/#1","title":"1. \u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30eb","text":""},{"location":"haskell/17-video-rental-system/#_2","title":"\u6620\u753b\u306e\u30ab\u30c6\u30b4\u30ea","text":"<p>\u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0\u3067\u306f\u3001\u4ee5\u4e0b\u306e3\u7a2e\u985e\u306e\u6620\u753b\u30ab\u30c6\u30b4\u30ea\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u307e\u3059\uff1a</p> <ul> <li>\u901a\u5e38\uff08Regular\uff09: 2\u65e5\u307e\u3067$2.0\u3001\u4ee5\u964d1\u65e5\u3054\u3068\u306b$1.5\u8ffd\u52a0</li> <li>\u65b0\u4f5c\uff08New Release\uff09: 1\u65e5\u3054\u3068\u306b$3.0</li> <li>\u5b50\u4f9b\u5411\u3051\uff08Children's\uff09: 3\u65e5\u307e\u3067$1.5\u3001\u4ee5\u964d1\u65e5\u3054\u3068\u306b$1.5\u8ffd\u52a0</li> </ul>"},{"location":"haskell/17-video-rental-system/#2","title":"2. \u578b\u5b9a\u7fa9","text":""},{"location":"haskell/17-video-rental-system/#_3","title":"\u6620\u753b\u3068\u30ab\u30c6\u30b4\u30ea","text":"<pre><code>-- | Movie category determines pricing rules\ndata Category\n  = Regular       -- ^ 2 days for $2, then $1.5/day\n  | NewRelease    -- ^ $3/day\n  | Childrens     -- ^ 3 days for $1.5, then $1.5/day\n  deriving (Show, Eq)\n\n-- | A movie with title and category\ndata Movie = Movie\n  { movieTitle :: String\n  , movieCategory :: Category\n  } deriving (Show, Eq)\n</code></pre>"},{"location":"haskell/17-video-rental-system/#_4","title":"\u6620\u753b\u4f5c\u6210\u306e\u30d8\u30eb\u30d1\u30fc","text":"<pre><code>-- | Create a movie\nmakeMovie :: String -&gt; Category -&gt; Movie\nmakeMovie = Movie\n\n-- | Create a regular movie\nmakeRegular :: String -&gt; Movie\nmakeRegular title = makeMovie title Regular\n\n-- | Create a new release movie\nmakeNewRelease :: String -&gt; Movie\nmakeNewRelease title = makeMovie title NewRelease\n\n-- | Create a children's movie\nmakeChildrens :: String -&gt; Movie\nmakeChildrens title = makeMovie title Childrens\n</code></pre>"},{"location":"haskell/17-video-rental-system/#_5","title":"\u30ec\u30f3\u30bf\u30eb","text":"<pre><code>-- | A rental of a movie for a number of days\ndata Rental = Rental\n  { rentalMovie :: Movie\n  , rentalDays :: Int\n  } deriving (Show, Eq)\n\n-- | Create a rental\nmakeRental :: Movie -&gt; Int -&gt; Rental\nmakeRental = Rental\n</code></pre>"},{"location":"haskell/17-video-rental-system/#3","title":"3. \u6599\u91d1\u8a08\u7b97","text":""},{"location":"haskell/17-video-rental-system/#_6","title":"\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u306b\u3088\u308b\u6599\u91d1\u8a08\u7b97","text":"<pre><code>-- | Calculate the rental amount based on movie category and days\ncalculateAmount :: Rental -&gt; Double\ncalculateAmount rental = case movieCategory (rentalMovie rental) of\n  Regular -&gt;\n    if days &gt; 2\n    then 2.0 + fromIntegral (days - 2) * 1.5\n    else 2.0\n\n  NewRelease -&gt;\n    fromIntegral days * 3.0\n\n  Childrens -&gt;\n    if days &gt; 3\n    then 1.5 + fromIntegral (days - 3) * 1.5\n    else 1.5\n  where\n    days = rentalDays rental\n</code></pre>"},{"location":"haskell/17-video-rental-system/#_7","title":"\u30dd\u30a4\u30f3\u30c8\u8a08\u7b97","text":"<pre><code>-- | Calculate frequent renter points\ncalculatePoints :: Rental -&gt; Int\ncalculatePoints rental = case movieCategory (rentalMovie rental) of\n  NewRelease -&gt; if rentalDays rental &gt; 1 then 2 else 1\n  _ -&gt; 1\n</code></pre>"},{"location":"haskell/17-video-rental-system/#4","title":"4. \u9867\u5ba2\u30e2\u30c7\u30eb","text":"<pre><code>-- | A customer with name and rentals\ndata Customer = Customer\n  { customerName :: String\n  , customerRentals :: [Rental]\n  } deriving (Show, Eq)\n\n-- | Create a customer with no rentals\nmakeCustomer :: String -&gt; Customer\nmakeCustomer name = Customer name []\n\n-- | Add a rental to a customer\naddRental :: Rental -&gt; Customer -&gt; Customer\naddRental rental customer = customer\n  { customerRentals = rental : customerRentals customer\n  }\n</code></pre>"},{"location":"haskell/17-video-rental-system/#_8","title":"\u96c6\u8a08\u95a2\u6570","text":"<pre><code>-- | Calculate total amount for all rentals\ntotalAmount :: Customer -&gt; Double\ntotalAmount = sum . map calculateAmount . customerRentals\n\n-- | Calculate total points for all rentals\ntotalPoints :: Customer -&gt; Int\ntotalPoints = sum . map calculatePoints . customerRentals\n</code></pre>"},{"location":"haskell/17-video-rental-system/#5","title":"5. \u660e\u7d30\u66f8\u30d5\u30a9\u30fc\u30de\u30c3\u30bf\u30fc","text":""},{"location":"haskell/17-video-rental-system/#_9","title":"\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u7a2e\u5225","text":"<pre><code>-- | Statement format\ndata StatementFormat = TextFormat | HtmlFormat\n  deriving (Show, Eq)\n\n-- | Generate a rental statement in the specified format\ngenerateStatement :: StatementFormat -&gt; Customer -&gt; String\ngenerateStatement format = case format of\n  TextFormat -&gt; generateTextStatement\n  HtmlFormat -&gt; generateHtmlStatement\n</code></pre>"},{"location":"haskell/17-video-rental-system/#_10","title":"\u30c6\u30ad\u30b9\u30c8\u30d5\u30a9\u30fc\u30de\u30c3\u30c8","text":"<pre><code>-- | Generate a plain text statement\ngenerateTextStatement :: Customer -&gt; String\ngenerateTextStatement customer = unlines\n  [ \"Rental Record for \" ++ customerName customer\n  , \"\"\n  ] ++ rentalLines ++ unlines\n  [ \"\"\n  , \"Amount owed is \" ++ show (totalAmount customer)\n  , \"You earned \" ++ show (totalPoints customer) ++ \" frequent renter points\"\n  ]\n  where\n    rentalLines = unlines $ map formatRentalLine (customerRentals customer)\n    formatRentalLine rental = \n      \"\\t\" ++ movieTitle (rentalMovie rental) ++ \"\\t\" ++ show (calculateAmount rental)\n</code></pre>"},{"location":"haskell/17-video-rental-system/#html","title":"HTML \u30d5\u30a9\u30fc\u30de\u30c3\u30c8","text":"<pre><code>-- | Generate an HTML statement\ngenerateHtmlStatement :: Customer -&gt; String\ngenerateHtmlStatement customer = unlines\n  [ \"&lt;html&gt;\"\n  , \"&lt;head&gt;&lt;title&gt;Rental Statement&lt;/title&gt;&lt;/head&gt;\"\n  , \"&lt;body&gt;\"\n  , \"&lt;h1&gt;Rental Record for \" ++ customerName customer ++ \"&lt;/h1&gt;\"\n  , \"&lt;table&gt;\"\n  , \"&lt;tr&gt;&lt;th&gt;Movie&lt;/th&gt;&lt;th&gt;Amount&lt;/th&gt;&lt;/tr&gt;\"\n  ] ++ rentalRows ++ unlines\n  [ \"&lt;/table&gt;\"\n  , \"&lt;p&gt;Amount owed is &lt;strong&gt;\" ++ show (totalAmount customer) ++ \"&lt;/strong&gt;&lt;/p&gt;\"\n  , \"&lt;p&gt;You earned &lt;strong&gt;\" ++ show (totalPoints customer) \n    ++ \"&lt;/strong&gt; frequent renter points&lt;/p&gt;\"\n  , \"&lt;/body&gt;\"\n  , \"&lt;/html&gt;\"\n  ]\n  where\n    rentalRows = unlines $ map formatRentalRow (customerRentals customer)\n    formatRentalRow rental =\n      \"&lt;tr&gt;&lt;td&gt;\" ++ movieTitle (rentalMovie rental) \n      ++ \"&lt;/td&gt;&lt;td&gt;\" ++ show (calculateAmount rental) ++ \"&lt;/td&gt;&lt;/tr&gt;\"\n</code></pre>"},{"location":"haskell/17-video-rental-system/#6","title":"6. \u30c6\u30b9\u30c8","text":"<pre><code>describe \"calculateAmount\" $ do\n  it \"charges $2 for 1-2 day regular rental\" $ do\n    let rental = makeRental (makeRegular \"Test\") 2\n    calculateAmount rental `shouldBe` 2.0\n\n  it \"charges extra for regular rental over 2 days\" $ do\n    let rental = makeRental (makeRegular \"Test\") 5\n    -- 2 + 3 * 1.5 = 6.5\n    calculateAmount rental `shouldBe` 6.5\n\n  it \"charges $3/day for new release\" $ do\n    let rental = makeRental (makeNewRelease \"Test\") 5\n    calculateAmount rental `shouldBe` 15.0\n\ndescribe \"calculatePoints\" $ do\n  it \"earns bonus points for new release over 1 day\" $ do\n    let rental = makeRental (makeNewRelease \"Test\") 2\n    calculatePoints rental `shouldBe` 2\n\ndescribe \"generateStatement\" $ do\n  it \"generates correct text statement\" $ do\n    let customer = addRental (makeRental (makeRegular \"The Matrix\") 3)\n                 $ makeCustomer \"John\"\n    let statement = generateTextStatement customer\n    statement `shouldContain` \"Rental Record for John\"\n    statement `shouldContain` \"The Matrix\"\n</code></pre>"},{"location":"haskell/17-video-rental-system/#_11","title":"\u307e\u3068\u3081","text":"<p>\u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0\u306e Haskell \u5b9f\u88c5\u306e\u30dd\u30a4\u30f3\u30c8\uff1a</p> <ol> <li>ADT \u3067\u30ab\u30c6\u30b4\u30ea\u3092\u8868\u73fe: <code>Category</code> \u578b\u3067\u30d3\u30b8\u30cd\u30b9\u30eb\u30fc\u30eb\u3092\u578b\u306b\u57cb\u3081\u8fbc\u3080</li> <li>\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3067\u6599\u91d1\u8a08\u7b97: \u5404\u30ab\u30c6\u30b4\u30ea\u306e\u8a08\u7b97\u30eb\u30fc\u30eb\u3092\u660e\u793a\u7684\u306b\u8a18\u8ff0</li> <li>\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020: <code>addRental</code> \u306f\u65b0\u3057\u3044 <code>Customer</code> \u3092\u8fd4\u3059</li> <li>\u95a2\u6570\u5408\u6210\u3067\u96c6\u8a08: <code>totalAmount = sum . map calculateAmount . customerRentals</code></li> <li>\u30d5\u30a9\u30fc\u30de\u30c3\u30bf\u30fc\u5206\u96e2: \u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u3068\u8868\u793a\u30ed\u30b8\u30c3\u30af\u3092\u5206\u96e2</li> <li>\u62e1\u5f35\u6027: \u65b0\u3057\u3044\u30ab\u30c6\u30b4\u30ea\u3084\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u8ffd\u52a0\u3057\u3084\u3059\u3044\u8a2d\u8a08</li> </ol>"},{"location":"haskell/18-concurrency-system/","title":"\u7b2c18\u7ae0 \u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0 - \u72b6\u614b\u6a5f\u68b0\u30d1\u30bf\u30fc\u30f3","text":""},{"location":"haskell/18-concurrency-system/#_1","title":"\u6982\u8981","text":"<p>\u3053\u306e\u7ae0\u3067\u306f\u3001Software Transactional Memory (STM) \u3092\u4f7f\u7528\u3057\u305f\u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\u96fb\u8a71\u547c\u3073\u51fa\u3057\u306e\u72b6\u614b\u6a5f\u68b0\u3092\u30e2\u30c7\u30eb\u5316\u3057\u3001\u8907\u6570\u306e\u30e6\u30fc\u30b6\u30fc\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304c\u5b89\u5168\u306b\u72b6\u614b\u3092\u7ba1\u7406\u3067\u304d\u308b\u30b7\u30b9\u30c6\u30e0\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002</p>"},{"location":"haskell/18-concurrency-system/#_2","title":"\u5b66\u7fd2\u76ee\u6a19","text":"<ul> <li>STM \u306b\u3088\u308b\u5b89\u5168\u306a\u4e26\u884c\u72b6\u614b\u7ba1\u7406</li> <li>\u72b6\u614b\u6a5f\u68b0\u30d1\u30bf\u30fc\u30f3\u306e\u95a2\u6570\u578b\u5b9f\u88c5</li> <li>\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u7684\u306a\u72b6\u614b\u9077\u79fb</li> <li>\u7d14\u7c8b\u95a2\u6570\u3068\u526f\u4f5c\u7528\u306e\u5206\u96e2</li> </ul>"},{"location":"haskell/18-concurrency-system/#_3","title":"\u72b6\u614b\u6a5f\u68b0\u306e\u57fa\u790e","text":""},{"location":"haskell/18-concurrency-system/#_4","title":"\u72b6\u614b\u306e\u5b9a\u7fa9","text":"<pre><code>-- | \u901a\u8a71\u72b6\u614b\ndata CallState\n  = Idle                    -- \u5f85\u6a5f\u4e2d\n  | Calling                 -- \u767a\u4fe1\u4e2d\n  | Dialing                 -- \u30c0\u30a4\u30e4\u30eb\u4e2d\n  | WaitingForConnection    -- \u63a5\u7d9a\u5f85\u3061\n  | Talking                 -- \u901a\u8a71\u4e2d\n  deriving (Show, Eq, Ord)\n</code></pre>"},{"location":"haskell/18-concurrency-system/#_5","title":"\u30a4\u30d9\u30f3\u30c8\u306e\u5b9a\u7fa9","text":"<pre><code>-- | \u72b6\u614b\u9077\u79fb\u3092\u5f15\u304d\u8d77\u3053\u3059\u30a4\u30d9\u30f3\u30c8\ndata Event\n  = Call        -- \u767a\u4fe1\n  | Ring        -- \u7740\u4fe1\n  | Dialtone    -- \u30c0\u30a4\u30e4\u30eb\u30c8\u30fc\u30f3\n  | Ringback    -- \u547c\u3073\u51fa\u3057\u97f3\n  | Connected   -- \u63a5\u7d9a\u5b8c\u4e86\n  | Disconnect  -- \u5207\u65ad\n  deriving (Show, Eq, Ord)\n</code></pre>"},{"location":"haskell/18-concurrency-system/#_6","title":"\u30a2\u30af\u30b7\u30e7\u30f3\u306e\u5b9a\u7fa9","text":"<pre><code>-- | \u9077\u79fb\u6642\u306b\u5b9f\u884c\u3059\u308b\u30a2\u30af\u30b7\u30e7\u30f3\ndata Action\n  = CallerOffHook   -- \u767a\u4fe1\u8005\u304c\u53d7\u8a71\u5668\u3092\u53d6\u308b\n  | CalleeOffHook   -- \u7740\u4fe1\u8005\u304c\u53d7\u8a71\u5668\u3092\u53d6\u308b\n  | Dial            -- \u30c0\u30a4\u30e4\u30eb\n  | Talk            -- \u901a\u8a71\u958b\u59cb\n  | NoAction        -- \u30a2\u30af\u30b7\u30e7\u30f3\u306a\u3057\n  deriving (Show, Eq)\n</code></pre>"},{"location":"haskell/18-concurrency-system/#_7","title":"\u72b6\u614b\u6a5f\u68b0\u306e\u5b9f\u88c5","text":""},{"location":"haskell/18-concurrency-system/#_8","title":"\u9077\u79fb\u306e\u5b9a\u7fa9","text":"<pre><code>-- | \u72b6\u614b\u9077\u79fb\ndata Transition = Transition\n  { transNextState :: CallState  -- \u6b21\u306e\u72b6\u614b\n  , transAction :: Action        -- \u5b9f\u884c\u3059\u308b\u30a2\u30af\u30b7\u30e7\u30f3\n  } deriving (Show, Eq)\n\n-- | \u72b6\u614b\u6a5f\u68b0: (\u72b6\u614b, \u30a4\u30d9\u30f3\u30c8) \u2192 \u9077\u79fb\ntype StateMachine = Map (CallState, Event) Transition\n</code></pre>"},{"location":"haskell/18-concurrency-system/#_9","title":"\u96fb\u8a71\u72b6\u614b\u6a5f\u68b0","text":"<pre><code>phoneStateMachine :: StateMachine\nphoneStateMachine = Map.fromList\n  [ ((Idle, Call), Transition Calling CallerOffHook)\n  , ((Idle, Ring), Transition WaitingForConnection CalleeOffHook)\n  , ((Idle, Disconnect), Transition Idle NoAction)\n  , ((Calling, Dialtone), Transition Dialing Dial)\n  , ((Dialing, Ringback), Transition WaitingForConnection NoAction)\n  , ((WaitingForConnection, Connected), Transition Talking Talk)\n  , ((Talking, Disconnect), Transition Idle NoAction)\n  ]\n</code></pre>"},{"location":"haskell/18-concurrency-system/#_10","title":"\u7d14\u7c8b\u306a\u9077\u79fb\u95a2\u6570","text":"<pre><code>-- | \u9077\u79fb\u306e\u53d6\u5f97\ngetTransition :: StateMachine -&gt; CallState -&gt; Event -&gt; Maybe Transition\ngetTransition sm state event = Map.lookup (state, event) sm\n\n-- | \u7d14\u7c8b\u306a\u72b6\u614b\u9077\u79fb\ntransition :: StateMachine -&gt; CallState -&gt; Event -&gt; Maybe CallState\ntransition sm state event = transNextState &lt;$&gt; getTransition sm state event\n</code></pre>"},{"location":"haskell/18-concurrency-system/#stm","title":"STM \u306b\u3088\u308b\u30e6\u30fc\u30b6\u30fc\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8","text":""},{"location":"haskell/18-concurrency-system/#_11","title":"\u30e6\u30fc\u30b6\u30fc\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u72b6\u614b","text":"<pre><code>-- | \u30e6\u30fc\u30b6\u30fc\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u5185\u90e8\u72b6\u614b\ndata UserAgentState = UserAgentState\n  { uasUserId :: String       -- \u30e6\u30fc\u30b6\u30fcID\n  , uasState :: CallState     -- \u73fe\u5728\u306e\u901a\u8a71\u72b6\u614b\n  , uasPeer :: Maybe String   -- \u901a\u8a71\u76f8\u624b\n  } deriving (Show, Eq)\n\n-- | STM \u30d9\u30fc\u30b9\u306e\u30e6\u30fc\u30b6\u30fc\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\ndata UserAgent = UserAgent\n  { uaState :: TVar UserAgentState  -- STM\u5909\u6570\n  , uaMachine :: StateMachine       -- \u72b6\u614b\u6a5f\u68b0\n  }\n</code></pre>"},{"location":"haskell/18-concurrency-system/#_12","title":"\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u4f5c\u6210","text":"<pre><code>-- | \u65b0\u3057\u3044\u30e6\u30fc\u30b6\u30fc\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u4f5c\u6210\nmakeUserAgent :: String -&gt; STM UserAgent\nmakeUserAgent userId = do\n  state &lt;- newTVar UserAgentState\n    { uasUserId = userId\n    , uasState = Idle\n    , uasPeer = Nothing\n    }\n  return UserAgent\n    { uaState = state\n    , uaMachine = phoneStateMachine\n    }\n</code></pre>"},{"location":"haskell/18-concurrency-system/#_13","title":"\u72b6\u614b\u306e\u8aad\u307f\u53d6\u308a","text":"<pre><code>-- | \u73fe\u5728\u306e\u72b6\u614b\u3092\u53d6\u5f97\ngetUserState :: UserAgent -&gt; STM CallState\ngetUserState ua = uasState &lt;$&gt; readTVar (uaState ua)\n\n-- | \u30e6\u30fc\u30b6\u30fcID\u3092\u53d6\u5f97\ngetUserId :: UserAgent -&gt; STM String\ngetUserId ua = uasUserId &lt;$&gt; readTVar (uaState ua)\n\n-- | \u901a\u8a71\u76f8\u624b\u3092\u53d6\u5f97\ngetPeer :: UserAgent -&gt; STM (Maybe String)\ngetPeer ua = uasPeer &lt;$&gt; readTVar (uaState ua)\n</code></pre>"},{"location":"haskell/18-concurrency-system/#_14","title":"\u72b6\u614b\u9077\u79fb\u306e\u51e6\u7406","text":""},{"location":"haskell/18-concurrency-system/#_15","title":"\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u7684\u306a\u9077\u79fb","text":"<pre><code>-- | \u9077\u79fb\u3092\u51e6\u7406\u3057\u3066\u30a2\u30af\u30b7\u30e7\u30f3\u3092\u8fd4\u3059\nprocessTransition :: UserAgent -&gt; Event -&gt; Maybe String -&gt; STM (Maybe Action)\nprocessTransition ua event peer = do\n  currentState &lt;- readTVar (uaState ua)\n  case getTransition (uaMachine ua) (uasState currentState) event of\n    Nothing -&gt; return Nothing\n    Just trans -&gt; do\n      writeTVar (uaState ua) currentState\n        { uasState = transNextState trans\n        , uasPeer = peer &lt;|&gt; uasPeer currentState\n        }\n      return (Just (transAction trans))\n\n-- | \u30a4\u30d9\u30f3\u30c8\u3092\u9001\u4fe1\nsendEvent :: UserAgent -&gt; Event -&gt; STM (Maybe Action)\nsendEvent ua event = processTransition ua event Nothing\n\n-- | \u76f8\u624b\u60c5\u5831\u4ed8\u304d\u3067\u30a4\u30d9\u30f3\u30c8\u3092\u9001\u4fe1\nsendEventWithPeer :: UserAgent -&gt; Event -&gt; String -&gt; STM (Maybe Action)\nsendEventWithPeer ua event peer = processTransition ua event (Just peer)\n</code></pre>"},{"location":"haskell/18-concurrency-system/#_16","title":"\u4f7f\u7528\u4f8b","text":""},{"location":"haskell/18-concurrency-system/#_17","title":"\u767a\u4fe1\u8005\u306e\u30d5\u30ed\u30fc","text":"<pre><code>-- \u767a\u4fe1\u8005\u306e\u30d5\u30ed\u30fc\u3092\u30b7\u30df\u30e5\u30ec\u30fc\u30c8\ncallerFlow :: IO ()\ncallerFlow = atomically $ do\n  alice &lt;- makeUserAgent \"alice\"\n\n  -- \u767a\u4fe1\n  _ &lt;- sendEventWithPeer alice Call \"bob\"\n  s1 &lt;- getUserState alice  -- Calling\n\n  -- \u30c0\u30a4\u30e4\u30eb\u30c8\u30fc\u30f3\u53d7\u4fe1\n  _ &lt;- sendEvent alice Dialtone\n  s2 &lt;- getUserState alice  -- Dialing\n\n  -- \u547c\u3073\u51fa\u3057\u97f3\u53d7\u4fe1\n  _ &lt;- sendEvent alice Ringback\n  s3 &lt;- getUserState alice  -- WaitingForConnection\n\n  -- \u63a5\u7d9a\u5b8c\u4e86\n  _ &lt;- sendEvent alice Connected\n  s4 &lt;- getUserState alice  -- Talking\n\n  -- \u5207\u65ad\n  _ &lt;- sendEvent alice Disconnect\n  s5 &lt;- getUserState alice  -- Idle\n\n  return ()\n</code></pre>"},{"location":"haskell/18-concurrency-system/#_18","title":"\u7740\u4fe1\u8005\u306e\u30d5\u30ed\u30fc","text":"<pre><code>-- \u7740\u4fe1\u8005\u306e\u30d5\u30ed\u30fc\u3092\u30b7\u30df\u30e5\u30ec\u30fc\u30c8\ncalleeFlow :: IO ()\ncalleeFlow = atomically $ do\n  bob &lt;- makeUserAgent \"bob\"\n\n  -- \u7740\u4fe1\n  _ &lt;- sendEventWithPeer bob Ring \"alice\"\n  s1 &lt;- getUserState bob  -- WaitingForConnection\n\n  -- \u63a5\u7d9a\u5b8c\u4e86\n  _ &lt;- sendEvent bob Connected\n  s2 &lt;- getUserState bob  -- Talking\n\n  -- \u5207\u65ad\n  _ &lt;- sendEvent bob Disconnect\n  s3 &lt;- getUserState bob  -- Idle\n\n  return ()\n</code></pre>"},{"location":"haskell/18-concurrency-system/#_19","title":"\u8907\u6570\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u72ec\u7acb\u52d5\u4f5c","text":"<pre><code>-- \u8907\u6570\u306e\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u304c\u72ec\u7acb\u3057\u3066\u52d5\u4f5c\nmultipleAgents :: IO ()\nmultipleAgents = do\n  (aliceState, bobState) &lt;- atomically $ do\n    alice &lt;- makeUserAgent \"alice\"\n    bob &lt;- makeUserAgent \"bob\"\n\n    -- \u305d\u308c\u305e\u308c\u72ec\u7acb\u3057\u3066\u72b6\u614b\u9077\u79fb\n    _ &lt;- sendEvent alice Call\n    _ &lt;- sendEvent bob Ring\n\n    as &lt;- getUserState alice\n    bs &lt;- getUserState bob\n    return (as, bs)\n\n  print aliceState  -- Calling\n  print bobState    -- WaitingForConnection\n</code></pre>"},{"location":"haskell/18-concurrency-system/#_20","title":"\u30a2\u30af\u30b7\u30e7\u30f3\u306e\u5b9f\u884c","text":"<pre><code>-- | \u30a2\u30af\u30b7\u30e7\u30f3\u306e\u8aac\u660e\u3092\u751f\u6210\nexecuteAction :: Action -&gt; String -&gt; Maybe String -&gt; String\nexecuteAction action userId peer = case action of\n  CallerOffHook -&gt; userId ++ \" picked up the phone to call \" ++ peerStr\n  CalleeOffHook -&gt; userId ++ \" answered the phone from \" ++ peerStr\n  Dial -&gt; userId ++ \" is dialing \" ++ peerStr\n  Talk -&gt; userId ++ \" is talking to \" ++ peerStr\n  NoAction -&gt; \"\"\n  where\n    peerStr = maybe \"unknown\" id peer\n</code></pre>"},{"location":"haskell/18-concurrency-system/#stm_1","title":"STM \u306e\u5229\u70b9","text":""},{"location":"haskell/18-concurrency-system/#1","title":"1. \u539f\u5b50\u6027","text":"<pre><code>-- \u8907\u6570\u306e\u72b6\u614b\u66f4\u65b0\u304c\u539f\u5b50\u7684\u306b\u5b9f\u884c\u3055\u308c\u308b\natomicUpdate :: IO ()\natomicUpdate = atomically $ do\n  ua &lt;- makeUserAgent \"test\"\n  -- \u3053\u306e2\u3064\u306e\u64cd\u4f5c\u306f\u4e00\u7dd2\u306b\u6210\u529f\u307e\u305f\u306f\u5931\u6557\n  _ &lt;- sendEvent ua Call\n  _ &lt;- sendEvent ua Dialtone\n  return ()\n</code></pre>"},{"location":"haskell/18-concurrency-system/#2","title":"2. \u7af6\u5408\u306e\u81ea\u52d5\u89e3\u6c7a","text":"<p>STM \u306f\u7af6\u5408\u3092\u691c\u51fa\u3057\u3001\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3092\u81ea\u52d5\u7684\u306b\u518d\u8a66\u884c\u3057\u307e\u3059\u3002</p>"},{"location":"haskell/18-concurrency-system/#3","title":"3. \u30c7\u30c3\u30c9\u30ed\u30c3\u30af\u306e\u56de\u907f","text":"<p>\u30ed\u30c3\u30af\u30d9\u30fc\u30b9\u306e\u4e26\u884c\u51e6\u7406\u3068\u7570\u306a\u308a\u3001STM \u306f\u30c7\u30c3\u30c9\u30ed\u30c3\u30af\u3092\u56de\u907f\u3057\u307e\u3059\u3002</p>"},{"location":"haskell/18-concurrency-system/#4","title":"4. \u5408\u6210\u53ef\u80fd\u6027","text":"<pre><code>-- \u8907\u6570\u306eSTM\u64cd\u4f5c\u3092\u5408\u6210\u3067\u304d\u308b\ncomposedTransaction :: STM ()\ncomposedTransaction = do\n  alice &lt;- makeUserAgent \"alice\"\n  bob &lt;- makeUserAgent \"bob\"\n  _ &lt;- sendEvent alice Call\n  _ &lt;- sendEvent bob Ring\n  return ()\n</code></pre>"},{"location":"haskell/18-concurrency-system/#_21","title":"\u30c6\u30b9\u30c8","text":"<pre><code>spec :: Spec\nspec = do\n  describe \"Pure State Machine\" $ do\n    it \"transitions from Idle to Calling on Call event\" $ do\n      transition phoneStateMachine Idle Call `shouldBe` Just Calling\n\n    it \"returns Nothing for invalid transitions\" $ do\n      transition phoneStateMachine Idle Dialtone `shouldBe` Nothing\n\n  describe \"UserAgent (STM)\" $ do\n    it \"creates agent in Idle state\" $ do\n      state &lt;- atomically $ do\n        ua &lt;- makeUserAgent \"alice\"\n        getUserState ua\n      state `shouldBe` Idle\n\n    it \"transitions through full caller flow\" $ do\n      states &lt;- atomically $ do\n        ua &lt;- makeUserAgent \"alice\"\n        _ &lt;- sendEvent ua Call\n        s1 &lt;- getUserState ua\n        _ &lt;- sendEvent ua Dialtone\n        s2 &lt;- getUserState ua\n        _ &lt;- sendEvent ua Ringback\n        s3 &lt;- getUserState ua\n        _ &lt;- sendEvent ua Connected\n        s4 &lt;- getUserState ua\n        return [s1, s2, s3, s4]\n      states `shouldBe` [Calling, Dialing, WaitingForConnection, Talking]\n</code></pre>"},{"location":"haskell/18-concurrency-system/#_22","title":"\u8a2d\u8a08\u306e\u30dd\u30a4\u30f3\u30c8","text":""},{"location":"haskell/18-concurrency-system/#_23","title":"\u7d14\u7c8b\u95a2\u6570\u3068\u526f\u4f5c\u7528\u306e\u5206\u96e2","text":"<ul> <li>\u72b6\u614b\u6a5f\u68b0\u306e\u5b9a\u7fa9\u306f\u7d14\u7c8b\u306a\u30c7\u30fc\u30bf</li> <li>\u9077\u79fb\u95a2\u6570\u306f\u7d14\u7c8b\uff08<code>transition</code>\uff09</li> <li>STM\u64cd\u4f5c\u306e\u307f\u304c\u526f\u4f5c\u7528\u3092\u6301\u3064</li> </ul>"},{"location":"haskell/18-concurrency-system/#_24","title":"\u578b\u5b89\u5168\u6027","text":"<ul> <li>\u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b\u3067\u72b6\u614b\u3068\u30a4\u30d9\u30f3\u30c8\u3092\u8868\u73fe</li> <li>\u4e0d\u6b63\u306a\u72b6\u614b\u9077\u79fb\u306f\u578b\u30ec\u30d9\u30eb\u3067\u9632\u6b62</li> </ul>"},{"location":"haskell/18-concurrency-system/#_25","title":"\u5408\u6210\u53ef\u80fd\u6027","text":"<ul> <li>\u5c0f\u3055\u306aSTM\u64cd\u4f5c\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u5927\u304d\u306a\u64cd\u4f5c\u3092\u69cb\u7bc9</li> <li>\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u5883\u754c\u3092\u67d4\u8edf\u306b\u8a2d\u5b9a</li> </ul>"},{"location":"haskell/18-concurrency-system/#_26","title":"\u307e\u3068\u3081","text":"<ul> <li>\u72b6\u614b\u6a5f\u68b0\u306f\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u81ea\u7136\u306b\u8868\u73fe\u3067\u304d\u308b</li> <li>STM \u306f\u5b89\u5168\u306a\u4e26\u884c\u72b6\u614b\u7ba1\u7406\u3092\u63d0\u4f9b\u3059\u308b</li> <li>\u7d14\u7c8b\u95a2\u6570\u3068\u526f\u4f5c\u7528\u3092\u5206\u96e2\u3059\u308b\u3053\u3068\u3067\u3001\u30c6\u30b9\u30c8\u3068\u63a8\u8ad6\u304c\u5bb9\u6613\u306b\u306a\u308b</li> <li>\u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b\u306b\u3088\u308a\u3001\u72b6\u614b\u7a7a\u9593\u3092\u660e\u78ba\u306b\u5b9a\u7fa9\u3067\u304d\u308b</li> </ul>"},{"location":"haskell/19-wator-simulation/","title":"\u7b2c19\u7ae0 Wa-Tor \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3 - \u30bb\u30eb\u30aa\u30fc\u30c8\u30de\u30c8\u30f3","text":""},{"location":"haskell/19-wator-simulation/#_1","title":"\u6982\u8981","text":"<p>\u3053\u306e\u7ae0\u3067\u306f\u3001Wa-Tor\uff08Water Torus\uff09\u3068\u547c\u3070\u308c\u308b\u6355\u98df\u8005-\u88ab\u98df\u8005\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\u9b5a\uff08\u88ab\u98df\u8005\uff09\u3068\u30b5\u30e1\uff08\u6355\u98df\u8005\uff09\u304c\u30c8\u30fc\u30e9\u30b9\u72b6\u306e\u4e16\u754c\u3067\u76f8\u4e92\u4f5c\u7528\u3059\u308b\u751f\u614b\u7cfb\u3092\u30e2\u30c7\u30eb\u5316\u3057\u307e\u3059\u3002</p>"},{"location":"haskell/19-wator-simulation/#_2","title":"\u5b66\u7fd2\u76ee\u6a19","text":"<ul> <li>\u30bb\u30eb\u30aa\u30fc\u30c8\u30de\u30c8\u30f3\u306e\u95a2\u6570\u578b\u5b9f\u88c5</li> <li>\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u306b\u3088\u308b\u72b6\u614b\u7ba1\u7406</li> <li>\u30c8\u30fc\u30e9\u30b9\u4f4d\u76f8\u306e\u5ea7\u6a19\u7cfb</li> <li>\u4e71\u6570\u3092\u4f7f\u7528\u3057\u305f\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3</li> </ul>"},{"location":"haskell/19-wator-simulation/#_3","title":"\u30bb\u30eb\u306e\u5b9a\u7fa9","text":""},{"location":"haskell/19-wator-simulation/#_4","title":"\u30bb\u30eb\u306e\u7a2e\u985e","text":"<pre><code>-- | \u30bb\u30eb\u30bf\u30a4\u30d7\u306e\u8b58\u5225\u5b50\ndata CellType = Water | Fish | Shark\n  deriving (Show, Eq, Ord)\n\n-- | \u30bb\u30eb\ndata Cell\n  = WaterCell                           -- \u6c34\n  | FishCell\n    { fishAge :: Int                    -- \u5e74\u9f62\n    , fishReproductionAge :: Int        -- \u7e41\u6b96\u53ef\u80fd\u5e74\u9f62\n    }\n  | SharkCell\n    { sharkAge :: Int                   -- \u5e74\u9f62\n    , sharkReproductionAge :: Int       -- \u7e41\u6b96\u53ef\u80fd\u5e74\u9f62\n    , sharkEnergy :: Int                -- \u30a8\u30cd\u30eb\u30ae\u30fc\n    }\n  deriving (Show, Eq)\n</code></pre>"},{"location":"haskell/19-wator-simulation/#_5","title":"\u30bb\u30eb\u306e\u8b58\u5225\u95a2\u6570","text":"<pre><code>-- | \u6c34\u304b\u3069\u3046\u304b\nisWater :: Cell -&gt; Bool\nisWater WaterCell = True\nisWater _ = False\n\n-- | \u9b5a\u304b\u3069\u3046\u304b\nisFish :: Cell -&gt; Bool\nisFish (FishCell _ _) = True\nisFish _ = False\n\n-- | \u30b5\u30e1\u304b\u3069\u3046\u304b\nisShark :: Cell -&gt; Bool\nisShark (SharkCell _ _ _) = True\nisShark _ = False\n</code></pre>"},{"location":"haskell/19-wator-simulation/#_6","title":"\u30bb\u30eb\u306e\u4f5c\u6210","text":"<pre><code>-- | \u6c34\u30bb\u30eb\u3092\u4f5c\u6210\nmakeWater :: Cell\nmakeWater = WaterCell\n\n-- | \u9b5a\u30bb\u30eb\u3092\u4f5c\u6210\nmakeFish :: Int -&gt; Cell\nmakeFish reproAge = FishCell 0 reproAge\n\n-- | \u30b5\u30e1\u30bb\u30eb\u3092\u4f5c\u6210\nmakeShark :: Int -&gt; Int -&gt; Cell\nmakeShark reproAge energy = SharkCell 0 reproAge energy\n</code></pre>"},{"location":"haskell/19-wator-simulation/#_7","title":"\u4e16\u754c\u306e\u69cb\u7bc9","text":""},{"location":"haskell/19-wator-simulation/#_8","title":"\u4e16\u754c\u306e\u5b9a\u7fa9","text":"<pre><code>-- | \u4f4d\u7f6e\ntype Location = (Int, Int)\n\n-- | \u4e16\u754c\ndata World = World\n  { worldWidth :: Int                   -- \u5e45\n  , worldHeight :: Int                  -- \u9ad8\u3055\n  , worldCells :: Map Location Cell     -- \u30bb\u30eb\u306e\u30de\u30c3\u30d7\n  , worldFishReproAge :: Int            -- \u9b5a\u306e\u7e41\u6b96\u5e74\u9f62\n  , worldSharkReproAge :: Int           -- \u30b5\u30e1\u306e\u7e41\u6b96\u5e74\u9f62\n  , worldSharkInitialEnergy :: Int      -- \u30b5\u30e1\u306e\u521d\u671f\u30a8\u30cd\u30eb\u30ae\u30fc\n  , worldSharkEnergyFromFish :: Int     -- \u9b5a\u3092\u98df\u3079\u305f\u6642\u306e\u30a8\u30cd\u30eb\u30ae\u30fc\u7372\u5f97\u91cf\n  } deriving (Show, Eq)\n</code></pre>"},{"location":"haskell/19-wator-simulation/#_9","title":"\u4e16\u754c\u306e\u4f5c\u6210","text":"<pre><code>-- | \u7a7a\u306e\u4e16\u754c\u3092\u4f5c\u6210\uff08\u5168\u3066\u6c34\uff09\nmakeWorld :: Width -&gt; Height -&gt; Int -&gt; Int -&gt; Int -&gt; Int -&gt; World\nmakeWorld w h fishRepro sharkRepro sharkEnergy sharkEnergyGain = World\n  { worldWidth = w\n  , worldHeight = h\n  , worldCells = Map.fromList [((x, y), WaterCell) | x &lt;- [0..w-1], y &lt;- [0..h-1]]\n  , worldFishReproAge = fishRepro\n  , worldSharkReproAge = sharkRepro\n  , worldSharkInitialEnergy = sharkEnergy\n  , worldSharkEnergyFromFish = sharkEnergyGain\n  }\n\n-- | \u7279\u5b9a\u306e\u30bb\u30eb\u3092\u914d\u7f6e\u3057\u3066\u4e16\u754c\u3092\u4f5c\u6210\nmakeWorldWithCells :: Width -&gt; Height -&gt; Int -&gt; Int -&gt; Int -&gt; Int \n                   -&gt; [(Location, Cell)] -&gt; World\nmakeWorldWithCells w h fishRepro sharkRepro sharkEnergy sharkEnergyGain cells =\n  let baseWorld = makeWorld w h fishRepro sharkRepro sharkEnergy sharkEnergyGain\n  in baseWorld { worldCells = Map.union (Map.fromList cells) (worldCells baseWorld) }\n</code></pre>"},{"location":"haskell/19-wator-simulation/#_10","title":"\u30c8\u30fc\u30e9\u30b9\u4f4d\u76f8","text":""},{"location":"haskell/19-wator-simulation/#_11","title":"\u5ea7\u6a19\u306e\u30e9\u30c3\u30d7","text":"<pre><code>-- | \u30c8\u30fc\u30e9\u30b9\u4f4d\u76f8\u306e\u305f\u3081\u306e\u5ea7\u6a19\u30e9\u30c3\u30d7\nwrapCoord :: World -&gt; Location -&gt; Location\nwrapCoord world (x, y) = (x `mod` worldWidth world, y `mod` worldHeight world)\n</code></pre> <p>\u3053\u306e\u95a2\u6570\u306b\u3088\u308a\u3001\u4e16\u754c\u306e\u7aef\u3092\u8d85\u3048\u305f\u5ea7\u6a19\u306f\u53cd\u5bfe\u5074\u306b\u30e9\u30c3\u30d7\u3055\u308c\u307e\u3059\uff1a</p> <pre><code>x = -1 \u2192 x = width - 1\ny = height \u2192 y = 0\n</code></pre>"},{"location":"haskell/19-wator-simulation/#_12","title":"\u8fd1\u508d\u306e\u53d6\u5f97","text":"<pre><code>-- | \u8fd1\u508d\u30aa\u30d5\u30bb\u30c3\u30c8\uff088\u65b9\u5411\uff09\nneighborOffsets :: [Location]\nneighborOffsets = \n  [ (-1, -1), (0, -1), (1, -1)\n  , (-1, 0),          (1, 0)\n  , (-1, 1),  (0, 1),  (1, 1)\n  ]\n\n-- | \u8fd1\u508d\u4f4d\u7f6e\u3092\u53d6\u5f97\nneighbors :: World -&gt; Location -&gt; [Location]\nneighbors world (x, y) = \n  map (\\(dx, dy) -&gt; wrapCoord world (x + dx, y + dy)) neighborOffsets\n\n-- | \u7279\u5b9a\u30bf\u30a4\u30d7\u306e\u8fd1\u508d\u3092\u53d6\u5f97\nneighborsOf :: World -&gt; Location -&gt; (Cell -&gt; Bool) -&gt; [Location]\nneighborsOf world loc predicate =\n  filter (\\l -&gt; predicate (getCell world l)) (neighbors world loc)\n</code></pre>"},{"location":"haskell/19-wator-simulation/#_13","title":"\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb","text":""},{"location":"haskell/19-wator-simulation/#_14","title":"\u30c6\u30a3\u30c3\u30af\u7d50\u679c","text":"<pre><code>-- | \u30bb\u30eb\u306e\u30c6\u30a3\u30c3\u30af\u7d50\u679c\ndata TickResult\n  = Stay Cell                    -- \u305d\u306e\u5834\u306b\u7559\u307e\u308b\n  | Move Location Cell Cell      -- \u79fb\u52d5\uff08\u79fb\u52d5\u5148, \u65b0\u30bb\u30eb, \u6b8b\u3059\u30bb\u30eb\uff09\n  | Die                          -- \u6b7b\u4ea1\n  deriving (Show, Eq)\n</code></pre>"},{"location":"haskell/19-wator-simulation/#_15","title":"\u9b5a\u306e\u30eb\u30fc\u30eb","text":"<ol> <li>\u7a7a\u306e\u8fd1\u508d\u30bb\u30eb\u304c\u3042\u308c\u3070\u79fb\u52d5</li> <li>\u7e41\u6b96\u5e74\u9f62\u306b\u9054\u3057\u305f\u3089\u7e41\u6b96\uff08\u5143\u306e\u4f4d\u7f6e\u306b\u5b50\u3092\u6b8b\u3059\uff09</li> <li>\u79fb\u52d5\u3067\u304d\u306a\u3051\u308c\u3070\u305d\u306e\u5834\u306b\u7559\u307e\u308b</li> </ol>"},{"location":"haskell/19-wator-simulation/#_16","title":"\u30b5\u30e1\u306e\u30eb\u30fc\u30eb","text":"<ol> <li>\u30a8\u30cd\u30eb\u30ae\u30fc\u304c0\u4ee5\u4e0b\u306b\u306a\u308b\u3068\u6b7b\u4ea1</li> <li>\u96a3\u63a5\u3059\u308b\u9b5a\u304c\u3044\u308c\u3070\u98df\u3079\u3066\u79fb\u52d5\uff08\u30a8\u30cd\u30eb\u30ae\u30fc\u7372\u5f97\uff09</li> <li>\u9b5a\u304c\u3044\u306a\u3051\u308c\u3070\u7a7a\u306e\u30bb\u30eb\u306b\u79fb\u52d5</li> <li>\u7e41\u6b96\u5e74\u9f62\u306b\u9054\u3057\u305f\u3089\u7e41\u6b96</li> <li>\u79fb\u52d5\u3067\u304d\u306a\u3051\u308c\u3070\u305d\u306e\u5834\u306b\u7559\u307e\u308b</li> </ol>"},{"location":"haskell/19-wator-simulation/#_17","title":"\u30bb\u30eb\u306e\u30c6\u30a3\u30c3\u30af\u51e6\u7406","text":"<pre><code>-- | \u5358\u4e00\u30bb\u30eb\u3092\u30c6\u30a3\u30c3\u30af\ntickCell :: World -&gt; Location -&gt; StdGen -&gt; (TickResult, StdGen)\ntickCell world loc gen = case getCell world loc of\n  WaterCell -&gt; (Stay WaterCell, gen)\n\n  FishCell age reproAge -&gt;\n    let emptyNeighbors = neighborsOf world loc isWater\n        newAge = age + 1\n        canReproduce = newAge &gt;= reproAge\n    in if null emptyNeighbors\n       then (Stay (FishCell newAge reproAge), gen)\n       else\n         let (idx, gen') = randomR (0, length emptyNeighbors - 1) gen\n             moveTo = emptyNeighbors !! idx\n         in if canReproduce\n            then (Move moveTo (FishCell 0 reproAge) (FishCell 0 reproAge), gen')\n            else (Move moveTo (FishCell newAge reproAge) WaterCell, gen')\n\n  SharkCell age reproAge energy -&gt;\n    let newEnergy = energy - 1\n    in if newEnergy &lt;= 0\n       then (Die, gen)\n       else\n         let fishNeighbors = neighborsOf world loc isFish\n             emptyNeighbors = neighborsOf world loc isWater\n             newAge = age + 1\n             canReproduce = newAge &gt;= reproAge\n         in if not (null fishNeighbors)\n            then -- \u9b5a\u3092\u98df\u3079\u308b\n              let (idx, gen') = randomR (0, length fishNeighbors - 1) gen\n                  moveTo = fishNeighbors !! idx\n                  gainedEnergy = worldSharkEnergyFromFish world\n              in if canReproduce\n                 then (Move moveTo (SharkCell 0 reproAge (newEnergy + gainedEnergy)) \n                                  (SharkCell 0 reproAge (worldSharkInitialEnergy world)), gen')\n                 else (Move moveTo (SharkCell newAge reproAge (newEnergy + gainedEnergy)) WaterCell, gen')\n            else if not (null emptyNeighbors)\n            then -- \u7a7a\u306e\u30bb\u30eb\u306b\u79fb\u52d5\n              let (idx, gen') = randomR (0, length emptyNeighbors - 1) gen\n                  moveTo = emptyNeighbors !! idx\n              in if canReproduce\n                 then (Move moveTo (SharkCell 0 reproAge newEnergy) \n                                  (SharkCell 0 reproAge (worldSharkInitialEnergy world)), gen')\n                 else (Move moveTo (SharkCell newAge reproAge newEnergy) WaterCell, gen')\n            else (Stay (SharkCell newAge reproAge newEnergy), gen)\n</code></pre>"},{"location":"haskell/19-wator-simulation/#_18","title":"\u4e16\u754c\u306e\u66f4\u65b0","text":""},{"location":"haskell/19-wator-simulation/#_19","title":"\u30c6\u30a3\u30c3\u30af\u7d50\u679c\u306e\u9069\u7528","text":"<pre><code>-- | \u30c6\u30a3\u30c3\u30af\u7d50\u679c\u3092\u4e16\u754c\u306b\u9069\u7528\napplyTickResult :: World -&gt; Location -&gt; TickResult -&gt; World\napplyTickResult world loc result = case result of\n  Stay cell -&gt; setCell world loc cell\n  Move newLoc newCell leftBehind -&gt;\n    setCell (setCell world loc leftBehind) newLoc newCell\n  Die -&gt; setCell world loc WaterCell\n</code></pre>"},{"location":"haskell/19-wator-simulation/#_20","title":"\u4e16\u754c\u5168\u4f53\u306e\u30c6\u30a3\u30c3\u30af","text":"<pre><code>-- | \u4e16\u754c\u5168\u4f53\u3092\u30c6\u30a3\u30c3\u30af\ntickWorld :: World -&gt; StdGen -&gt; (World, StdGen)\ntickWorld world gen =\n  let allLocs = [(x, y) | x &lt;- [0..worldWidth world - 1], y &lt;- [0..worldHeight world - 1]]\n  in foldl' tickLoc (world, gen) allLocs\n  where\n    tickLoc (w, g) loc =\n      let (result, g') = tickCell w loc g\n      in (applyTickResult w loc result, g')\n</code></pre>"},{"location":"haskell/19-wator-simulation/#_21","title":"\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u306e\u5b9f\u884c","text":"<pre><code>-- | n \u30b9\u30c6\u30c3\u30d7\u306e\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u5b9f\u884c\nrunSimulation :: Int -&gt; World -&gt; StdGen -&gt; [(World, WorldStats)]\nrunSimulation 0 _ _ = []\nrunSimulation n world gen =\n  let (world', gen') = tickWorld world gen\n      stats = getStats world'\n  in (world', stats) : runSimulation (n - 1) world' gen'\n</code></pre>"},{"location":"haskell/19-wator-simulation/#_22","title":"\u8868\u793a\u3068\u7d71\u8a08","text":""},{"location":"haskell/19-wator-simulation/#_23","title":"\u30bb\u30eb\u306e\u8868\u793a","text":"<pre><code>-- | \u30bb\u30eb\u306e\u8868\u793a\u6587\u5b57\ndisplayCell :: Cell -&gt; Char\ndisplayCell WaterCell = '.'\ndisplayCell (FishCell _ _) = 'f'\ndisplayCell (SharkCell _ _ _) = 'S'\n\n-- | \u4e16\u754c\u306e\u8868\u793a\ndisplayWorld :: World -&gt; String\ndisplayWorld world = unlines\n  [ [displayCell (getCell world (x, y)) | x &lt;- [0..worldWidth world - 1]]\n  | y &lt;- [0..worldHeight world - 1]\n  ]\n</code></pre>"},{"location":"haskell/19-wator-simulation/#_24","title":"\u7d71\u8a08\u60c5\u5831","text":"<pre><code>-- | \u4e16\u754c\u306e\u7d71\u8a08\ndata WorldStats = WorldStats\n  { statsWater :: Int\n  , statsFish :: Int\n  , statsSharks :: Int\n  } deriving (Show, Eq)\n\n-- | \u7d71\u8a08\u3092\u53d6\u5f97\ngetStats :: World -&gt; WorldStats\ngetStats world =\n  let cells = Map.elems (worldCells world)\n  in WorldStats\n    { statsWater = length (filter isWater cells)\n    , statsFish = length (filter isFish cells)\n    , statsSharks = length (filter isShark cells)\n    }\n</code></pre>"},{"location":"haskell/19-wator-simulation/#_25","title":"\u4f7f\u7528\u4f8b","text":""},{"location":"haskell/19-wator-simulation/#_26","title":"\u57fa\u672c\u7684\u306a\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3","text":"<pre><code>import System.Random (mkStdGen)\n\nmain :: IO ()\nmain = do\n  let cells = [ ((10, 10), makeFish 3)\n              , ((15, 15), makeFish 3)\n              , ((20, 20), makeShark 5 10)\n              ]\n      world = makeWorldWithCells 30 30 3 5 10 3 cells\n      gen = mkStdGen 42\n      results = runSimulation 100 world gen\n\n  mapM_ (\\(w, stats) -&gt; do\n    putStrLn $ displayWorld w\n    print stats\n    putStrLn \"---\"\n    ) results\n</code></pre>"},{"location":"haskell/19-wator-simulation/#_27","title":"\u751f\u614b\u7cfb\u306e\u30c0\u30a4\u30ca\u30df\u30af\u30b9","text":"<pre><code>-- \u751f\u614b\u7cfb\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\necosystem :: IO ()\necosystem = do\n  -- \u9b5a\u3092\u305f\u304f\u3055\u3093\u3001\u30b5\u30e1\u3092\u5c11\u6570\u914d\u7f6e\n  let fishLocs = [(x, y) | x &lt;- [5,10..45], y &lt;- [5,10..45]]\n      sharkLocs = [(25, 25), (10, 40)]\n      cells = [(loc, makeFish 3) | loc &lt;- fishLocs] ++\n              [(loc, makeShark 5 10) | loc &lt;- sharkLocs]\n      world = makeWorldWithCells 50 50 3 5 10 3 cells\n      gen = mkStdGen 12345\n      results = runSimulation 200 world gen\n\n  -- \u7d71\u8a08\u306e\u5909\u5316\u3092\u89b3\u5bdf\n  let statsHistory = map snd results\n  mapM_ print statsHistory\n</code></pre>"},{"location":"haskell/19-wator-simulation/#_28","title":"\u30c6\u30b9\u30c8","text":"<pre><code>spec :: Spec\nspec = do\n  describe \"Cell Types\" $ do\n    it \"identifies water cells\" $ do\n      isWater makeWater `shouldBe` True\n      isWater (makeFish 3) `shouldBe` False\n\n  describe \"Coordinate Operations\" $ do\n    it \"wraps coordinates correctly\" $ do\n      let world = makeWorld 5 5 3 5 10 3\n      wrapCoord world (5, 2) `shouldBe` (0, 2)\n      wrapCoord world (-1, 2) `shouldBe` (4, 2)\n\n  describe \"Cell Ticking\" $ do\n    it \"fish moves to empty neighbor\" $ do\n      let cells = [((2, 2), makeFish 3)]\n          world = makeWorldWithCells 5 5 3 5 10 3 cells\n          gen = mkStdGen 42\n          (result, _) = tickCell world (2, 2) gen\n      case result of\n        Move loc cell _ -&gt; do\n          isFish cell `shouldBe` True\n          loc `elem` neighbors world (2, 2) `shouldBe` True\n        _ -&gt; expectationFailure \"Expected Move\"\n\n    it \"shark dies when energy reaches 0\" $ do\n      let shark = SharkCell 0 5 1\n          cells = [((2, 2), shark)]\n          world = makeWorldWithCells 5 5 3 5 10 3 cells\n          gen = mkStdGen 42\n          (result, _) = tickCell world (2, 2) gen\n      result `shouldBe` Die\n\n  describe \"World Ticking\" $ do\n    it \"handles fish reproduction\" $ do\n      let fish = FishCell 2 3  -- Will reproduce at age 3\n          cells = [((2, 2), fish)]\n          world = makeWorldWithCells 5 5 3 5 10 3 cells\n          gen = mkStdGen 42\n          (world', _) = tickWorld world gen\n          stats = getStats world'\n      statsFish stats `shouldBe` 2\n</code></pre>"},{"location":"haskell/19-wator-simulation/#_29","title":"\u8a2d\u8a08\u306e\u30dd\u30a4\u30f3\u30c8","text":""},{"location":"haskell/19-wator-simulation/#_30","title":"\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020","text":"<ul> <li><code>World</code> \u306f\u4e0d\u5909\u3067\u3001\u66f4\u65b0\u6642\u306b\u65b0\u3057\u3044 <code>World</code> \u3092\u8fd4\u3059</li> <li><code>Map</code> \u3092\u4f7f\u7528\u3057\u305f\u52b9\u7387\u7684\u306a\u30bb\u30eb\u7ba1\u7406</li> </ul>"},{"location":"haskell/19-wator-simulation/#_31","title":"\u7d14\u7c8b\u95a2\u6570\u3068\u526f\u4f5c\u7528\u306e\u5206\u96e2","text":"<ul> <li>\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u30ed\u30b8\u30c3\u30af\u306f\u7d14\u7c8b\uff08\u4e71\u6570\u751f\u6210\u5668\u3092\u5f15\u6570\u3067\u53d7\u3051\u53d6\u308b\uff09</li> <li>IO \u306f\u8868\u793a\u3068\u521d\u671f\u5316\u306e\u307f</li> </ul>"},{"location":"haskell/19-wator-simulation/#_32","title":"\u30c8\u30fc\u30e9\u30b9\u4f4d\u76f8","text":"<ul> <li>\u7aef\u3092\u8d85\u3048\u305f\u5ea7\u6a19\u304c\u53cd\u5bfe\u5074\u306b\u30e9\u30c3\u30d7</li> <li>\u6709\u9650\u30b5\u30a4\u30ba\u3067\u7121\u9650\u306e\u4e16\u754c\u3092\u30b7\u30df\u30e5\u30ec\u30fc\u30c8</li> </ul>"},{"location":"haskell/19-wator-simulation/#_33","title":"\u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b","text":"<ul> <li><code>Cell</code> \u306e\u7570\u306a\u308b\u7a2e\u985e\u3092\u5b89\u5168\u306b\u8868\u73fe</li> <li><code>TickResult</code> \u3067\u9077\u79fb\u306e\u7d50\u679c\u3092\u660e\u793a\u7684\u306b\u8868\u73fe</li> </ul>"},{"location":"haskell/19-wator-simulation/#_34","title":"\u62e1\u5f35\u306e\u30a2\u30a4\u30c7\u30a2","text":"<ol> <li>\u74b0\u5883\u8981\u56e0: \u6c34\u6e29\u3084\u5b63\u7bc0\u306e\u5f71\u97ff\u3092\u8ffd\u52a0</li> <li>\u8907\u6570\u7a2e: \u3088\u308a\u591a\u304f\u306e\u751f\u7269\u7a2e\u3092\u8ffd\u52a0</li> <li>\u53ef\u8996\u5316: \u30b0\u30e9\u30d5\u30a3\u30ab\u30eb\u306a\u8868\u793a</li> <li>\u4e26\u5217\u51e6\u7406: \u5927\u304d\u306a\u4e16\u754c\u3067\u306e\u4e26\u5217\u66f4\u65b0</li> <li>\u7d71\u8a08\u5206\u6790: \u500b\u4f53\u6570\u306e\u6642\u7cfb\u5217\u5206\u6790</li> </ol>"},{"location":"haskell/19-wator-simulation/#_35","title":"\u307e\u3068\u3081","text":"<ul> <li>\u30bb\u30eb\u30aa\u30fc\u30c8\u30de\u30c8\u30f3\u306f\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u81ea\u7136\u306b\u8868\u73fe\u3067\u304d\u308b</li> <li>\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u306b\u3088\u308a\u3001\u72b6\u614b\u306e\u5909\u5316\u3092\u8ffd\u8de1\u3057\u3084\u3059\u3044</li> <li>\u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b\u3067\u30bb\u30eb\u306e\u7a2e\u985e\u3092\u5b89\u5168\u306b\u8868\u73fe</li> <li>\u7d14\u7c8b\u95a2\u6570\u306b\u3088\u308b\u4e71\u6570\u4f7f\u7528\u3067\u30c6\u30b9\u30c8\u304c\u5bb9\u6613</li> </ul>"},{"location":"haskell/20-pattern-interactions/","title":"\u7b2c20\u7ae0 \u30d1\u30bf\u30fc\u30f3\u306e\u76f8\u4e92\u4f5c\u7528 - \u8907\u5408\u30d1\u30bf\u30fc\u30f3\u306e\u6d3b\u7528","text":""},{"location":"haskell/20-pattern-interactions/#_1","title":"\u6982\u8981","text":"<p>\u3053\u306e\u7ae0\u3067\u306f\u3001\u8907\u6570\u306e\u95a2\u6570\u578b\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u3001\u8907\u96d1\u306a\u554f\u984c\u3092\u89e3\u6c7a\u3059\u308b\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002EC\u30b5\u30a4\u30c8\u306e\u30b7\u30e7\u30c3\u30d4\u30f3\u30b0\u30ab\u30fc\u30c8\u30b7\u30b9\u30c6\u30e0\u3092\u4f8b\u306b\u3001Strategy\u3001Decorator\u3001Command\u3001Composite\u3001Visitor \u30d1\u30bf\u30fc\u30f3\u306e\u7d71\u5408\u3092\u793a\u3057\u307e\u3059\u3002</p>"},{"location":"haskell/20-pattern-interactions/#_2","title":"\u5b66\u7fd2\u76ee\u6a19","text":"<ul> <li>\u8907\u6570\u30d1\u30bf\u30fc\u30f3\u306e\u52b9\u679c\u7684\u306a\u7d44\u307f\u5408\u308f\u305b\u65b9</li> <li>\u30d1\u30bf\u30fc\u30f3\u9593\u306e\u5354\u8abf\u52d5\u4f5c\u306e\u8a2d\u8a08</li> <li>\u5b9f\u7528\u7684\u306a\u30b7\u30b9\u30c6\u30e0\u3067\u306e\u30d1\u30bf\u30fc\u30f3\u9069\u7528</li> <li>\u95a2\u6570\u578b\u3067\u306e\u67d4\u8edf\u306a\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u69cb\u7bc9</li> </ul>"},{"location":"haskell/20-pattern-interactions/#_3","title":"\u5546\u54c1\u3068\u4fa1\u683c\u8a2d\u5b9a","text":""},{"location":"haskell/20-pattern-interactions/#_4","title":"\u5546\u54c1\u306e\u5b9a\u7fa9","text":"<pre><code>-- | \u5546\u54c1\ndata Product = Product\n  { productId :: String\n  , productName :: String\n  , productBasePrice :: Double\n  , productCategory :: String\n  } deriving (Show, Eq)\n\n-- | \u5546\u54c1\u306e\u4f5c\u6210\nmakeProduct :: String -&gt; String -&gt; Double -&gt; String -&gt; Product\nmakeProduct = Product\n</code></pre>"},{"location":"haskell/20-pattern-interactions/#strategy","title":"\u4fa1\u683c\u8a2d\u5b9a\u6226\u7565 (Strategy \u30d1\u30bf\u30fc\u30f3)","text":"<pre><code>-- | \u4fa1\u683c\u8a2d\u5b9a\u6226\u7565\nnewtype PricingStrategy = PricingStrategy\n  { applyPricing :: Product -&gt; Int -&gt; Double\n  }\n\n-- | \u901a\u5e38\u4fa1\u683c\nregularPricing :: PricingStrategy\nregularPricing = PricingStrategy $ \\prod qty -&gt;\n  productBasePrice prod * fromIntegral qty\n\n-- | \u5272\u5f15\u4fa1\u683c\ndiscountPricing :: Double -&gt; PricingStrategy\ndiscountPricing percent = PricingStrategy $ \\prod qty -&gt;\n  productBasePrice prod * fromIntegral qty * (1 - percent / 100)\n\n-- | \u307e\u3068\u3081\u8cb7\u3044\u4fa1\u683c\nbulkPricing :: Int -&gt; Double -&gt; PricingStrategy\nbulkPricing threshold percent = PricingStrategy $ \\prod qty -&gt;\n  let basePrice = productBasePrice prod * fromIntegral qty\n  in if qty &gt;= threshold\n     then basePrice * (1 - percent / 100)\n     else basePrice\n</code></pre>"},{"location":"haskell/20-pattern-interactions/#decorator","title":"\u5272\u5f15\u30c7\u30b3\u30ec\u30fc\u30bf (Decorator \u30d1\u30bf\u30fc\u30f3)","text":"<pre><code>-- | \u5272\u5f15\u30c7\u30b3\u30ec\u30fc\u30bf\ntype DiscountDecorator = Double -&gt; Double\n\n-- | \u30d1\u30fc\u30bb\u30f3\u30c8\u5272\u5f15\npercentageDiscount :: Double -&gt; DiscountDecorator\npercentageDiscount percent price = price * (1 - percent / 100)\n\n-- | \u56fa\u5b9a\u984d\u5272\u5f15\nfixedDiscount :: Double -&gt; DiscountDecorator\nfixedDiscount amount price = max 0 (price - amount)\n\n-- | \u5b63\u7bc0\u5272\u5f15\nseasonalDiscount :: Double -&gt; DiscountDecorator\nseasonalDiscount multiplier price = price * multiplier\n\n-- | \u8907\u6570\u5272\u5f15\u306e\u9069\u7528\napplyDiscounts :: [DiscountDecorator] -&gt; Double -&gt; Double\napplyDiscounts decorators price = foldl' (\\p d -&gt; d p) price decorators\n</code></pre>"},{"location":"haskell/20-pattern-interactions/#command","title":"\u6ce8\u6587\u30b3\u30de\u30f3\u30c9 (Command \u30d1\u30bf\u30fc\u30f3)","text":"<pre><code>-- | \u6ce8\u6587\u30b3\u30de\u30f3\u30c9\u578b\u30af\u30e9\u30b9\nclass OrderCommand cmd where\n  execute :: cmd -&gt; ShoppingCart -&gt; ShoppingCart\n\n-- | \u5546\u54c1\u8ffd\u52a0\u30b3\u30de\u30f3\u30c9\ndata AddItem = AddItem Product Int\n\ninstance OrderCommand AddItem where\n  execute (AddItem prod qty) cart =\n    let item = CartItem prod qty (productBasePrice prod)\n        newItems = item : scItems cart\n    in cart { scItems = newItems }\n\n-- | \u5546\u54c1\u524a\u9664\u30b3\u30de\u30f3\u30c9\ndata RemoveItem = RemoveItem String\n\ninstance OrderCommand RemoveItem where\n  execute (RemoveItem prodId) cart =\n    let newItems = filter (\\item -&gt; productId (ciProduct item) /= prodId) (scItems cart)\n    in cart { scItems = newItems }\n\n-- | \u5272\u5f15\u9069\u7528\u30b3\u30de\u30f3\u30c9\ndata ApplyDiscount = ApplyDiscount DiscountDecorator\n\ninstance OrderCommand ApplyDiscount where\n  execute (ApplyDiscount discount) cart =\n    cart { scDiscount = Just discount }\n</code></pre>"},{"location":"haskell/20-pattern-interactions/#composite","title":"\u30b7\u30e7\u30c3\u30d4\u30f3\u30b0\u30ab\u30fc\u30c8 (Composite \u30d1\u30bf\u30fc\u30f3)","text":"<pre><code>-- | \u30ab\u30fc\u30c8\u30a2\u30a4\u30c6\u30e0\ndata CartItem = CartItem\n  { ciProduct :: Product\n  , ciQuantity :: Int\n  , ciUnitPrice :: Double\n  } deriving (Show, Eq)\n\n-- | \u30b7\u30e7\u30c3\u30d4\u30f3\u30b0\u30ab\u30fc\u30c8\ndata ShoppingCart = ShoppingCart\n  { scItems :: [CartItem]\n  , scDiscount :: Maybe DiscountDecorator\n  }\n\n-- | \u7a7a\u306e\u30ab\u30fc\u30c8\nemptyCart :: ShoppingCart\nemptyCart = ShoppingCart [] Nothing\n\n-- | \u30ab\u30fc\u30c8\u5408\u8a08\ncartTotal :: ShoppingCart -&gt; Double\ncartTotal cart =\n  let subtotal = sum [ciUnitPrice item * fromIntegral (ciQuantity item) \n                     | item &lt;- scItems cart]\n  in case scDiscount cart of\n       Nothing -&gt; subtotal\n       Just discount -&gt; discount subtotal\n</code></pre>"},{"location":"haskell/20-pattern-interactions/#_5","title":"\u6ce8\u6587\u51e6\u7406\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3","text":"<pre><code>-- | \u6ce8\u6587\u51e6\u7406\u7d50\u679c\ndata OrderResult\n  = OrderSuccess ShoppingCart\n  | OrderFailure String\n\n-- | \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u30b9\u30c6\u30c3\u30d7\ntype OrderPipeline = ShoppingCart -&gt; OrderResult\n\n-- | \u691c\u8a3c\u30b9\u30c6\u30c3\u30d7\nvalidationStep :: OrderPipeline\nvalidationStep cart =\n  if null (scItems cart)\n  then OrderFailure \"Cart is empty\"\n  else OrderSuccess cart\n\n-- | \u5272\u5f15\u30b9\u30c6\u30c3\u30d7\ndiscountStep :: Double -&gt; OrderPipeline\ndiscountStep percent cart =\n  OrderSuccess cart { scDiscount = Just (percentageDiscount percent) }\n\n-- | \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u5b9f\u884c\nrunPipeline :: [OrderPipeline] -&gt; ShoppingCart -&gt; OrderResult\nrunPipeline [] cart = OrderSuccess cart\nrunPipeline (step:steps) cart =\n  case step cart of\n    OrderFailure msg -&gt; OrderFailure msg\n    OrderSuccess cart' -&gt; runPipeline steps cart'\n</code></pre>"},{"location":"haskell/20-pattern-interactions/#visitor","title":"\u30ab\u30fc\u30c8\u5206\u6790\u30d3\u30b8\u30bf\u30fc (Visitor \u30d1\u30bf\u30fc\u30f3)","text":"<pre><code>-- | \u30ab\u30fc\u30c8\u30d3\u30b8\u30bf\u30fc\nnewtype CartVisitor a = CartVisitor\n  { runVisitor :: ShoppingCart -&gt; a\n  }\n\n-- | \u30a2\u30a4\u30c6\u30e0\u6570\u30ab\u30a6\u30f3\u30c8\nitemCountVisitor :: CartVisitor Int\nitemCountVisitor = CartVisitor $ \\cart -&gt;\n  sum [ciQuantity item | item &lt;- scItems cart]\n\n-- | \u5408\u8a08\u91d1\u984d\ntotalValueVisitor :: CartVisitor Double\ntotalValueVisitor = CartVisitor cartTotal\n\n-- | \u5e73\u5747\u5358\u4fa1\naverageItemPriceVisitor :: CartVisitor Double\naverageItemPriceVisitor = CartVisitor $ \\cart -&gt;\n  let items = scItems cart\n      count = length items\n  in if count == 0\n     then 0\n     else sum [ciUnitPrice item | item &lt;- items] / fromIntegral count\n\n-- | \u30d3\u30b8\u30bf\u30fc\u306e\u9069\u7528\nvisitCart :: CartVisitor a -&gt; ShoppingCart -&gt; a\nvisitCart visitor cart = runVisitor visitor cart\n</code></pre>"},{"location":"haskell/20-pattern-interactions/#_6","title":"\u4f7f\u7528\u4f8b","text":""},{"location":"haskell/20-pattern-interactions/#_7","title":"\u5b8c\u5168\u306a\u6ce8\u6587\u30d5\u30ed\u30fc","text":"<pre><code>-- \u5546\u54c1\u306e\u5b9a\u7fa9\nlaptop = makeProduct \"P001\" \"Laptop\" 1000.0 \"Electronics\"\nmouse = makeProduct \"P002\" \"Mouse\" 50.0 \"Electronics\"\n\n-- \u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u3063\u3066\u30ab\u30fc\u30c8\u3092\u69cb\u7bc9\ncart1 = executeCommand (AddItem laptop 1) emptyCart\ncart2 = executeCommand (AddItem mouse 2) cart1\ncart3 = executeCommand (ApplyDiscount (percentageDiscount 5)) cart2\n\n-- \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3067\u51e6\u7406\npipeline = [validationStep]\nresult = runPipeline pipeline cart3\n\n-- \u30d3\u30b8\u30bf\u30fc\u3067\u5206\u6790\ncase result of\n  OrderSuccess cart -&gt; do\n    putStrLn $ \"Items: \" ++ show (visitCart itemCountVisitor cart)\n    putStrLn $ \"Total: $\" ++ show (visitCart totalValueVisitor cart)\n  OrderFailure msg -&gt; putStrLn $ \"Error: \" ++ msg\n\n-- \u51fa\u529b:\n-- Items: 3\n-- Total: $1045.0 (1100 * 0.95)\n</code></pre>"},{"location":"haskell/20-pattern-interactions/#_8","title":"\u30d1\u30bf\u30fc\u30f3\u306e\u5354\u8abf","text":"<pre><code>-- Strategy: \u4fa1\u683c\u6226\u7565\u3092\u9078\u629e\nstrategy = if isBulkOrder then bulkPricing 10 15 else regularPricing\n\n-- Decorator: \u5272\u5f15\u3092\u7a4d\u307f\u91cd\u306d\ndiscounts = [percentageDiscount 10, fixedDiscount 50]\nfinalPrice = applyDiscounts discounts basePrice\n\n-- Command: \u64cd\u4f5c\u3092\u30c7\u30fc\u30bf\u5316\ncommands = [AddItem prod1 1, AddItem prod2 2, ApplyDiscount (percentageDiscount 5)]\ncart = foldl (\\c cmd -&gt; executeCommand cmd c) emptyCart commands\n\n-- Visitor: \u30ab\u30fc\u30c8\u3092\u5206\u6790\nstats = (visitCart itemCountVisitor cart, visitCart totalValueVisitor cart)\n</code></pre>"},{"location":"haskell/20-pattern-interactions/#_9","title":"\u30c6\u30b9\u30c8","text":"<pre><code>spec :: Spec\nspec = do\n  describe \"Pattern Integration\" $ do\n    it \"processes complete order with multiple patterns\" $ do\n      let product1 = makeProduct \"P001\" \"Laptop\" 1000.0 \"Electronics\"\n          product2 = makeProduct \"P002\" \"Mouse\" 50.0 \"Electronics\"\n\n          -- \u30b3\u30de\u30f3\u30c9\u3067\u30ab\u30fc\u30c8\u3092\u69cb\u7bc9\n          cart1 = executeCommand (AddItem product1 1) emptyCart\n          cart2 = executeCommand (AddItem product2 2) cart1\n          cart3 = executeCommand (ApplyDiscount (percentageDiscount 5)) cart2\n\n          -- \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3067\u51e6\u7406\n          pipeline' = [validationStep]\n\n      case runPipeline pipeline' cart3 of\n        OrderSuccess cart' -&gt; do\n          visitCart itemCountVisitor cart' `shouldBe` 3\n          cartTotal cart' `shouldBe` 1045.0\n        OrderFailure _ -&gt; expectationFailure \"Order should succeed\"\n</code></pre>"},{"location":"haskell/20-pattern-interactions/#_10","title":"\u30d1\u30bf\u30fc\u30f3\u7d44\u307f\u5408\u308f\u305b\u306e\u539f\u5247","text":""},{"location":"haskell/20-pattern-interactions/#1","title":"1. \u8cac\u4efb\u306e\u5206\u96e2","text":"<p>\u5404\u30d1\u30bf\u30fc\u30f3\u306f\u5358\u4e00\u306e\u8cac\u4efb\u3092\u6301\u3064\uff1a - Strategy: \u4fa1\u683c\u8a08\u7b97\u65b9\u6cd5 - Decorator: \u4fa1\u683c\u4fee\u98fe - Command: \u64cd\u4f5c\u306e\u30ab\u30d7\u30bb\u30eb\u5316 - Composite: \u69cb\u9020\u306e\u7ba1\u7406 - Visitor: \u6a2a\u65ad\u7684\u306a\u51e6\u7406</p>"},{"location":"haskell/20-pattern-interactions/#2","title":"2. \u5408\u6210\u53ef\u80fd\u6027","text":"<p>\u30d1\u30bf\u30fc\u30f3\u306f\u4e92\u3044\u306b\u5e72\u6e09\u305b\u305a\u3001\u7d44\u307f\u5408\u308f\u305b\u53ef\u80fd\uff1a</p> <pre><code>-- \u3069\u306e\u30d1\u30bf\u30fc\u30f3\u3082\u72ec\u7acb\u3057\u3066\u4f7f\u7528\u53ef\u80fd\nprice1 = applyPricing regularPricing product 1\nprice2 = percentageDiscount 10 price1\ncart = executeCommand (AddItem product 1) emptyCart\ncount = visitCart itemCountVisitor cart\n</code></pre>"},{"location":"haskell/20-pattern-interactions/#3","title":"3. \u578b\u306b\u3088\u308b\u5b89\u5168\u6027","text":"<p>\u578b\u30b7\u30b9\u30c6\u30e0\u304c\u4e0d\u6b63\u306a\u7d44\u307f\u5408\u308f\u305b\u3092\u9632\u6b62\uff1a</p> <pre><code>-- \u578b\u30af\u30e9\u30b9\u3067\u64cd\u4f5c\u3092\u7d71\u4e00\nclass OrderCommand cmd where\n  execute :: cmd -&gt; ShoppingCart -&gt; ShoppingCart\n\n-- \u65b0\u3057\u3044\u30b3\u30de\u30f3\u30c9\u306e\u8ffd\u52a0\u304c\u5b89\u5168\ndata NewCommand = ...\ninstance OrderCommand NewCommand where\n  execute = ...\n</code></pre>"},{"location":"haskell/20-pattern-interactions/#_11","title":"\u307e\u3068\u3081","text":"<ul> <li>\u8907\u6570\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u3053\u3068\u3067\u3001\u8907\u96d1\u306a\u554f\u984c\u3092\u5206\u5272\u7d71\u6cbb\u3067\u304d\u308b</li> <li>\u5404\u30d1\u30bf\u30fc\u30f3\u306f\u72ec\u7acb\u3057\u3066\u9032\u5316\u30fb\u30c6\u30b9\u30c8\u53ef\u80fd</li> <li>\u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1\u306b\u3088\u308a\u3001\u30d1\u30bf\u30fc\u30f3\u306e\u5408\u6210\u304c\u81ea\u7136\u306b\u306a\u308b</li> <li>\u578b\u30b7\u30b9\u30c6\u30e0\u306b\u3088\u308a\u3001\u5b89\u5168\u306a\u30d1\u30bf\u30fc\u30f3\u306e\u7d44\u307f\u5408\u308f\u305b\u304c\u4fdd\u8a3c\u3055\u308c\u308b</li> </ul>"},{"location":"haskell/21-best-practices/","title":"\u7b2c21\u7ae0 \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9","text":""},{"location":"haskell/21-best-practices/#_1","title":"\u6982\u8981","text":"<p>\u3053\u306e\u7ae0\u3067\u306f\u3001Haskell \u3067\u306e\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u304a\u3051\u308b\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3092\u5b66\u3073\u307e\u3059\u3002\u4e0d\u5909\u6027\u3001\u95a2\u6570\u5408\u6210\u3001\u7d14\u7c8b\u95a2\u6570\u3001\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u3001\u578b\u5b89\u5168\u6027\u306a\u3069\u306e\u91cd\u8981\u306a\u539f\u5247\u3092\u5b9f\u8df5\u7684\u306b\u793a\u3057\u307e\u3059\u3002</p>"},{"location":"haskell/21-best-practices/#_2","title":"\u5b66\u7fd2\u76ee\u6a19","text":"<ul> <li>\u4e0d\u5909\u6027\u3092\u6d3b\u7528\u3057\u305f\u30b3\u30fc\u30c9\u8a2d\u8a08</li> <li>\u95a2\u6570\u5408\u6210\u306b\u3088\u308b\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u69cb\u7bc9</li> <li>\u7d14\u7c8b\u95a2\u6570\u3068\u53c2\u7167\u900f\u904e\u6027\u306e\u7dad\u6301</li> <li>\u5b89\u5168\u306a\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0</li> <li>\u578b\u30b7\u30b9\u30c6\u30e0\u306b\u3088\u308b\u5805\u7262\u6027\u5411\u4e0a</li> </ul>"},{"location":"haskell/21-best-practices/#_3","title":"\u4e0d\u5909\u6027\u306e\u5b9f\u8df5","text":""},{"location":"haskell/21-best-practices/#_4","title":"\u30ec\u30b3\u30fc\u30c9\u306e\u4e0d\u5909\u66f4\u65b0","text":"<pre><code>-- | \u30e6\u30fc\u30b6\u30fc\u30ec\u30b3\u30fc\u30c9\ndata User = User\n  { userName :: String\n  , userEmail :: String\n  , userAge :: Int\n  } deriving (Show, Eq)\n\n-- | \u540d\u524d\u306e\u66f4\u65b0\uff08\u5143\u306e\u30c7\u30fc\u30bf\u306f\u5909\u66f4\u3057\u306a\u3044\uff09\nupdateUserName :: String -&gt; User -&gt; User\nupdateUserName newName user = user { userName = newName }\n\n-- | \u30e1\u30fc\u30eb\u306e\u66f4\u65b0\nupdateUserEmail :: String -&gt; User -&gt; User\nupdateUserEmail newEmail user = user { userEmail = newEmail }\n\n-- | \u5e74\u9f62\u306e\u66f4\u65b0\nupdateUserAge :: Int -&gt; User -&gt; User\nupdateUserAge newAge user = user { userAge = newAge }\n\n-- \u4f7f\u7528\u4f8b\nlet alice = User \"Alice\" \"alice@example.com\" 30\nlet bob = updateUserName \"Bob\" alice\n-- alice \u306f\u5909\u66f4\u3055\u308c\u306a\u3044\n-- bob \u306f\u65b0\u3057\u3044 User\n</code></pre>"},{"location":"haskell/21-best-practices/#_5","title":"\u6c4e\u7528\u66f4\u65b0\u95a2\u6570","text":"<pre><code>-- | \u4efb\u610f\u306e\u66f4\u65b0\u95a2\u6570\u3092\u9069\u7528\nupdateUser :: (User -&gt; User) -&gt; User -&gt; User\nupdateUser f = f\n\n-- \u8907\u6570\u306e\u66f4\u65b0\u3092\u5408\u6210\nupdateAll :: User -&gt; User\nupdateAll = updateUserName \"Charlie\" \n          . updateUserEmail \"charlie@example.com\"\n          . updateUserAge 25\n</code></pre>"},{"location":"haskell/21-best-practices/#_6","title":"\u95a2\u6570\u5408\u6210","text":""},{"location":"haskell/21-best-practices/#_7","title":"\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u6f14\u7b97\u5b50","text":"<pre><code>-- | \u524d\u65b9\u30d1\u30a4\u30d7\n(|&gt;) :: a -&gt; (a -&gt; b) -&gt; b\nx |&gt; f = f x\ninfixl 1 |&gt;\n\n-- | \u5f8c\u65b9\u30d1\u30a4\u30d7\n(&lt;|) :: (a -&gt; b) -&gt; a -&gt; b\nf &lt;| x = f x\ninfixr 0 &lt;|\n\n-- \u4f7f\u7528\u4f8b\nresult = \"  HELLO WORLD  \"\n       |&gt; trim\n       |&gt; toLowerCase\n       |&gt; removeSpaces\n-- \"helloworld\"\n</code></pre>"},{"location":"haskell/21-best-practices/#_8","title":"\u95a2\u6570\u306e\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u5316","text":"<pre><code>-- | \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u4f5c\u6210\npipeline :: [a -&gt; a] -&gt; a -&gt; a\npipeline = foldl' (flip (.)) id\n\n-- \u4f7f\u7528\u4f8b\nsanitize = pipeline [trim, toLowerCase, removeSpaces]\nresult = sanitize \"  Hello World  \"  -- \"helloworld\"\n</code></pre>"},{"location":"haskell/21-best-practices/#_9","title":"\u6587\u5b57\u5217\u5909\u63db\u95a2\u6570","text":"<pre><code>-- | \u7a7a\u767d\u306e\u30c8\u30ea\u30e0\ntrim :: String -&gt; String\ntrim = dropWhile isSpace . reverse . dropWhile isSpace . reverse\n\n-- | \u5c0f\u6587\u5b57\u5316\ntoLowerCase :: String -&gt; String\ntoLowerCase = map toLower\n\n-- | \u7a7a\u767d\u9664\u53bb\nremoveSpaces :: String -&gt; String\nremoveSpaces = filter (not . isSpace)\n\n-- | \u5165\u529b\u306e\u30b5\u30cb\u30bf\u30a4\u30ba\nsanitizeInput :: String -&gt; String\nsanitizeInput = toLowerCase . trim\n</code></pre>"},{"location":"haskell/21-best-practices/#_10","title":"\u7d14\u7c8b\u95a2\u6570","text":""},{"location":"haskell/21-best-practices/#_11","title":"\u53c2\u7167\u900f\u904e\u6027","text":"<pre><code>-- | \u7d14\u7c8b\u306a\u52a0\u7b97\npureAdd :: Num a =&gt; a -&gt; a -&gt; a\npureAdd x y = x + y\n\n-- | \u7d14\u7c8b\u306a\u4e57\u7b97\npureMultiply :: Num a =&gt; a -&gt; a -&gt; a\npureMultiply x y = x * y\n\n-- | \u7d14\u7c8b\u306a\u8a08\u7b97\npureCompute :: Int -&gt; Int -&gt; Int -&gt; Int\npureCompute x y z = (x + y) * z\n\n-- \u540c\u3058\u5165\u529b\u306b\u306f\u5e38\u306b\u540c\u3058\u51fa\u529b\npureCompute 2 3 4  -- \u5e38\u306b 20\npureCompute 2 3 4  -- \u5e38\u306b 20\n</code></pre>"},{"location":"haskell/21-best-practices/#_12","title":"\u526f\u4f5c\u7528\u306e\u5206\u96e2","text":"<pre><code>-- | \u8a08\u7b97\u306e\u62bd\u8c61\u5316\ndata Computation a\n  = Pure a\n  | Effect (IO a)\n\ninstance Functor Computation where\n  fmap f (Pure a) = Pure (f a)\n  fmap f (Effect io) = Effect (fmap f io)\n\n-- | \u7d14\u7c8b\u306a\u8a08\u7b97\u30b9\u30c6\u30c3\u30d7\npureStep :: a -&gt; Computation a\npureStep = Pure\n\n-- | \u8a08\u7b97\u306e\u5b9f\u884c\nrunComputation :: Computation a -&gt; IO a\nrunComputation (Pure a) = return a\nrunComputation (Effect io) = io\n</code></pre>"},{"location":"haskell/21-best-practices/#_13","title":"\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0","text":""},{"location":"haskell/21-best-practices/#result","title":"Result \u578b","text":"<pre><code>-- | \u7d50\u679c\u578b\ndata Result e a\n  = Success a\n  | Failure e\n  deriving (Show, Eq)\n\n-- | \u7d50\u679c\u306e\u30de\u30c3\u30d7\nmapResult :: (a -&gt; b) -&gt; Result e a -&gt; Result e b\nmapResult f (Success a) = Success (f a)\nmapResult _ (Failure e) = Failure e\n\n-- | \u7d50\u679c\u306e\u30d5\u30e9\u30c3\u30c8\u30de\u30c3\u30d7\nflatMapResult :: (a -&gt; Result e b) -&gt; Result e a -&gt; Result e b\nflatMapResult f (Success a) = f a\nflatMapResult _ (Failure e) = Failure e\n\n-- | Maybe \u304b\u3089 Result \u3078\u306e\u5909\u63db\nfromMaybe' :: e -&gt; Maybe a -&gt; Result e a\nfromMaybe' _ (Just a) = Success a\nfromMaybe' e Nothing = Failure e\n</code></pre>"},{"location":"haskell/21-best-practices/#_14","title":"\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3","text":"<pre><code>-- | \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u7d50\u679c\ndata Validation e a\n  = Valid a\n  | Invalid [e]\n  deriving (Show, Eq)\n\n-- | \u5358\u4e00\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\nvalidate :: (a -&gt; Bool) -&gt; e -&gt; a -&gt; Validation e a\nvalidate predicate err value =\n  if predicate value\n  then Valid value\n  else Invalid [err]\n\n-- | \u8907\u6570\u30eb\u30fc\u30eb\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\nvalidateAll :: [(a -&gt; Bool, e)] -&gt; a -&gt; Validation e a\nvalidateAll rules value =\n  let errors = [err | (predicate, err) &lt;- rules, not (predicate value)]\n  in if null errors\n     then Valid value\n     else Invalid errors\n\n-- \u4f7f\u7528\u4f8b\nvalidateAge :: Int -&gt; Validation String Int\nvalidateAge = validateAll \n  [ ((&gt;= 0), \"Age must be non-negative\")\n  , ((&lt;= 150), \"Age must be realistic\")\n  ]\n\nvalidateAge 25   -- Valid 25\nvalidateAge (-5) -- Invalid [\"Age must be non-negative\"]\nvalidateAge 200  -- Invalid [\"Age must be realistic\"]\n</code></pre>"},{"location":"haskell/21-best-practices/#_15","title":"\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u306e\u5408\u6210","text":"<pre><code>-- | \u8907\u6570\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u306e\u7d50\u5408\ncombineValidations :: [Validation e a] -&gt; Validation e [a]\ncombineValidations validations =\n  let (valids, invalids) = partitionValidations validations\n  in if null invalids\n     then Valid valids\n     else Invalid (concat invalids)\n\n-- \u4f7f\u7528\u4f8b\nlet v1 = validate (&gt; 0) \"must be positive\" 5\n    v2 = validate (&lt; 100) \"must be &lt; 100\" 50\ncombineValidations [v1, v2]  -- Valid [5, 50]\n</code></pre>"},{"location":"haskell/21-best-practices/#_16","title":"\u30c7\u30fc\u30bf\u5909\u63db","text":""},{"location":"haskell/21-best-practices/#mapfilterreduce","title":"Map/Filter/Reduce","text":"<pre><code>-- | \u30de\u30c3\u30d7\nmapOver :: (a -&gt; b) -&gt; [a] -&gt; [b]\nmapOver = map\n\n-- | \u30d5\u30a3\u30eb\u30bf\u30fc\nfilterBy :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\nfilterBy = filter\n\n-- | \u30ea\u30c7\u30e5\u30fc\u30b9\nreduceWith :: (b -&gt; a -&gt; b) -&gt; b -&gt; [a] -&gt; b\nreduceWith = foldl'\n\n-- | \u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\ntransformPipeline :: (a -&gt; b) -&gt; (b -&gt; Bool) -&gt; (c -&gt; b -&gt; c) -&gt; c -&gt; [a] -&gt; c\ntransformPipeline mapF filterF reduceF initial xs =\n  reduceWith reduceF initial (filterBy filterF (mapOver mapF xs))\n\n-- \u4f7f\u7528\u4f8b\uff1a\u5076\u6570\u30922\u500d\u3057\u3066\u5408\u8a08\nresult = transformPipeline (*2) even (+) 0 [1..5]  -- 12\n</code></pre>"},{"location":"haskell/21-best-practices/#_17","title":"\u9045\u5ef6\u8a55\u4fa1","text":"<pre><code>-- | \u9045\u5ef6\u30ec\u30f3\u30b8\nlazyRange :: Int -&gt; Int -&gt; [Int]\nlazyRange start end = [start..end]\n\n-- | \u6761\u4ef6\u4ed8\u304d\u53d6\u5f97\ntakeWhile' :: (a -&gt; Bool) -&gt; [a] -&gt; [a]\ntakeWhile' = takeWhile\n\n-- | \u7121\u9650\u30b7\u30fc\u30b1\u30f3\u30b9\ninfiniteSequence :: a -&gt; (a -&gt; a) -&gt; [a]\ninfiniteSequence start next = iterate next start\n\n-- \u4f7f\u7528\u4f8b\ntake 5 (infiniteSequence 1 (+1))   -- [1, 2, 3, 4, 5]\ntake 5 (infiniteSequence 2 (*2))   -- [2, 4, 8, 16, 32]\ntakeWhile' (&lt; 100) (infiniteSequence 1 (*2))  -- [1, 2, 4, 8, 16, 32, 64]\n</code></pre>"},{"location":"haskell/21-best-practices/#_18","title":"\u578b\u5b89\u5168\u6027","text":""},{"location":"haskell/21-best-practices/#newtype","title":"Newtype \u30d1\u30bf\u30fc\u30f3","text":"<pre><code>-- | Email newtype\nnewtype Email = Email { unEmail :: String }\n  deriving (Show, Eq)\n\n-- | \u30b9\u30de\u30fc\u30c8\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\nmkEmail :: String -&gt; Maybe Email\nmkEmail s\n  | '@' `elem` s &amp;&amp; '.' `elem` dropWhile (/= '@') s = Just (Email s)\n  | otherwise = Nothing\n\n-- | Username newtype\nnewtype Username = Username { unUsername :: String }\n  deriving (Show, Eq)\n\nmkUsername :: String -&gt; Maybe Username\nmkUsername s\n  | length s &gt;= 3 &amp;&amp; length s &lt;= 20 = Just (Username s)\n  | otherwise = Nothing\n\n-- | Age newtype\nnewtype Age = Age { unAge :: Int }\n  deriving (Show, Eq)\n\nmkAge :: Int -&gt; Maybe Age\nmkAge n\n  | n &gt;= 0 &amp;&amp; n &lt;= 150 = Just (Age n)\n  | otherwise = Nothing\n</code></pre>"},{"location":"haskell/21-best-practices/#_19","title":"\u6b63\u306e\u6574\u6570","text":"<pre><code>-- | \u6b63\u306e\u6574\u6570\nnewtype PositiveInt = PositiveInt { unPositiveInt :: Int }\n  deriving (Show, Eq)\n\nmkPositiveInt :: Int -&gt; Maybe PositiveInt\nmkPositiveInt n\n  | n &gt; 0 = Just (PositiveInt n)\n  | otherwise = Nothing\n\n-- | \u7a7a\u3067\u306a\u3044\u6587\u5b57\u5217\nnewtype NonEmptyString = NonEmptyString { unNonEmptyString :: String }\n  deriving (Show, Eq)\n\nmkNonEmptyString :: String -&gt; Maybe NonEmptyString\nmkNonEmptyString s\n  | null s = Nothing\n  | otherwise = Just (NonEmptyString s)\n</code></pre>"},{"location":"haskell/21-best-practices/#_20","title":"\u30c6\u30b9\u30c8\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9","text":""},{"location":"haskell/21-best-practices/#_21","title":"\u4ee3\u6570\u7684\u6027\u8cea\u306e\u30c6\u30b9\u30c8","text":"<pre><code>-- | \u7d50\u5408\u5f8b\u306e\u30c6\u30b9\u30c8\nassociative :: Eq a =&gt; (a -&gt; a -&gt; a) -&gt; a -&gt; a -&gt; a -&gt; Bool\nassociative f a b c = f (f a b) c == f a (f b c)\n\n-- | \u4ea4\u63db\u5f8b\u306e\u30c6\u30b9\u30c8\ncommutative :: Eq b =&gt; (a -&gt; a -&gt; b) -&gt; a -&gt; a -&gt; Bool\ncommutative f a b = f a b == f b a\n\n-- | \u5358\u4f4d\u5143\u306e\u30c6\u30b9\u30c8\nidentity' :: Eq a =&gt; (a -&gt; a -&gt; a) -&gt; a -&gt; a -&gt; Bool\nidentity' f identity a = f a identity == a &amp;&amp; f identity a == a\n\n-- | \u9006\u5143\u306e\u30c6\u30b9\u30c8\ninverse :: Eq a =&gt; (a -&gt; a -&gt; a) -&gt; (a -&gt; a) -&gt; a -&gt; a -&gt; Bool\ninverse f inv identity a = f a (inv a) == identity\n</code></pre>"},{"location":"haskell/21-best-practices/#_22","title":"\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8","text":"<pre><code>spec :: Spec\nspec = do\n  it \"addition is associative\" $ property $\n    \\(x :: Int) y z -&gt; associative (+) x y z\n\n  it \"addition is commutative\" $ property $\n    \\(x :: Int) y -&gt; commutative (+) x y\n\n  it \"0 is identity for addition\" $ property $\n    \\(x :: Int) -&gt; identity' (+) 0 x\n</code></pre>"},{"location":"haskell/21-best-practices/#_23","title":"\u307e\u3068\u3081","text":""},{"location":"haskell/21-best-practices/#_24","title":"\u4e0d\u5909\u6027\u306e\u5229\u70b9","text":"<ul> <li>\u4e88\u6e2c\u53ef\u80fd\u306a\u52d5\u4f5c</li> <li>\u4e26\u884c\u51e6\u7406\u306e\u5b89\u5168\u6027</li> <li>\u30c7\u30d0\u30c3\u30b0\u306e\u5bb9\u6613\u3055</li> </ul>"},{"location":"haskell/21-best-practices/#_25","title":"\u95a2\u6570\u5408\u6210\u306e\u5229\u70b9","text":"<ul> <li>\u30b3\u30fc\u30c9\u306e\u518d\u5229\u7528\u6027</li> <li>\u8aad\u307f\u3084\u3059\u3044\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3</li> <li>\u30c6\u30b9\u30c8\u306e\u5bb9\u6613\u3055</li> </ul>"},{"location":"haskell/21-best-practices/#_26","title":"\u578b\u5b89\u5168\u6027\u306e\u5229\u70b9","text":"<ul> <li>\u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u306e\u30a8\u30e9\u30fc\u691c\u51fa</li> <li>\u4e0d\u6b63\u306a\u72b6\u614b\u306e\u9632\u6b62</li> <li>\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3068\u3057\u3066\u306e\u578b</li> </ul>"},{"location":"haskell/21-best-practices/#_27","title":"\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u306e\u539f\u5247","text":"<ul> <li>\u4f8b\u5916\u3088\u308a\u623b\u308a\u5024</li> <li>\u578b\u3067\u30a8\u30e9\u30fc\u3092\u8868\u73fe</li> <li>\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u306e\u5408\u6210</li> </ul>"},{"location":"haskell/22-oo-to-fp-migration/","title":"\u7b2c22\u7ae0 \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u304b\u3089\u95a2\u6570\u578b\u3078\u306e\u79fb\u884c","text":""},{"location":"haskell/22-oo-to-fp-migration/#_1","title":"\u6982\u8981","text":"<p>\u3053\u306e\u7ae0\u3067\u306f\u3001\u4e00\u822c\u7684\u306a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u30d1\u30bf\u30fc\u30f3\u3092\u95a2\u6570\u578b\u306e\u540c\u7b49\u7269\u306b\u79fb\u884c\u3059\u308b\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002\u7d99\u627f\u304b\u3089\u30b3\u30f3\u30dd\u30b8\u30b7\u30e7\u30f3\u3001\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u30b9\u30c6\u30fc\u30c8\u304b\u3089\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u66f4\u65b0\u3001\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u306e\u95a2\u6570\u578b\u8868\u73fe\u307e\u3067\u3001\u5b9f\u8df5\u7684\u306a\u5909\u63db\u30d1\u30bf\u30fc\u30f3\u3092\u793a\u3057\u307e\u3059\u3002</p>"},{"location":"haskell/22-oo-to-fp-migration/#_2","title":"\u5b66\u7fd2\u76ee\u6a19","text":"<ul> <li>\u30af\u30e9\u30b9\u968e\u5c64\u304b\u3089\u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b\u3078\u306e\u5909\u63db</li> <li>\u7d99\u627f\u304b\u3089\u30b3\u30f3\u30dd\u30b8\u30b7\u30e7\u30f3\u3078\u306e\u79fb\u884c</li> <li>\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u30b9\u30c6\u30fc\u30c8\u306e\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u5316</li> <li>OO \u30d1\u30bf\u30fc\u30f3\u306e\u95a2\u6570\u578b\u7b49\u4fa1\u7269</li> </ul>"},{"location":"haskell/22-oo-to-fp-migration/#_3","title":"\u30af\u30e9\u30b9\u304b\u3089\u30c7\u30fc\u30bf\u578b\u3078\u306e\u79fb\u884c","text":""},{"location":"haskell/22-oo-to-fp-migration/#oo-fp","title":"OO: \u7d99\u627f\u968e\u5c64 \u2192 FP: \u76f4\u548c\u578b","text":"<pre><code>-- OO \u306e\u30af\u30e9\u30b9\u968e\u5c64\u306e\u4ee3\u308f\u308a\u306b\u76f4\u548c\u578b\u3092\u4f7f\u7528\ndata Animal\n  = Dog { dogName :: String, dogBreed :: String }\n  | Cat { catName :: String, catColor :: String }\n  | Bird { birdName :: String, birdCanFly :: Bool }\n  deriving (Show, Eq)\n\n-- \u30dd\u30ea\u30e2\u30fc\u30d5\u30a3\u30ba\u30e0\u306f\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u3067\u5b9f\u73fe\nmakeSound :: Animal -&gt; String\nmakeSound (Dog name _) = name ++ \" says: Woof!\"\nmakeSound (Cat name _) = name ++ \" says: Meow!\"\nmakeSound (Bird name _) = name ++ \" says: Tweet!\"\n\nmove :: Animal -&gt; String\nmove (Dog name _) = name ++ \" runs on four legs\"\nmove (Cat name _) = name ++ \" prowls silently\"\nmove (Bird name canFly)\n  | canFly = name ++ \" flies through the air\"\n  | otherwise = name ++ \" hops on the ground\"\n\ndescribeAnimal :: Animal -&gt; String\ndescribeAnimal animal = makeSound animal ++ \" and \" ++ move animal\n</code></pre>"},{"location":"haskell/22-oo-to-fp-migration/#oo-fp_1","title":"OO: \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9 \u2192 FP: \u578b\u30af\u30e9\u30b9","text":"<pre><code>-- OO \u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306e\u4ee3\u308f\u308a\u306b\u578b\u30af\u30e9\u30b9\u3092\u4f7f\u7528\nclass Shape a where\n  area :: a -&gt; Double\n  perimeter :: a -&gt; Double\n\n-- \u5404\u5f62\u72b6\u306e\u5b9f\u88c5\ndata Circle = Circle { circleRadius :: Double }\n  deriving (Show, Eq)\n\ninstance Shape Circle where\n  area (Circle r) = pi * r * r\n  perimeter (Circle r) = 2 * pi * r\n\ndata Rectangle = Rectangle { rectWidth :: Double, rectHeight :: Double }\n  deriving (Show, Eq)\n\ninstance Shape Rectangle where\n  area (Rectangle w h) = w * h\n  perimeter (Rectangle w h) = 2 * (w + h)\n</code></pre>"},{"location":"haskell/22-oo-to-fp-migration/#_4","title":"\u7d99\u627f\u304b\u3089\u30b3\u30f3\u30dd\u30b8\u30b7\u30e7\u30f3\u3078","text":""},{"location":"haskell/22-oo-to-fp-migration/#oo-fp_2","title":"OO: \u7d99\u627f\u968e\u5c64 \u2192 FP: \u30b3\u30f3\u30dd\u30b8\u30b7\u30e7\u30f3","text":"<pre><code>-- \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\ndata Engine\n  = NoEngine\n  | GasEngine { horsepower :: Int }\n  | ElectricEngine { batteryKwh :: Int }\n  deriving (Show, Eq)\n\ndata Wheels = Wheels { wheelCount :: Int, wheelSize :: Int }\n  deriving (Show, Eq)\n\n-- \u30b3\u30f3\u30dd\u30b8\u30b7\u30e7\u30f3\u306b\u3088\u308b Vehicle\ndata Vehicle = Vehicle\n  { vehicleName :: String\n  , vehicleEngine :: Engine\n  , vehicleWheels :: Wheels\n  } deriving (Show, Eq)\n\n-- \u30d5\u30a1\u30af\u30c8\u30ea\u30fc\u95a2\u6570\ncar :: Vehicle\ncar = Vehicle \"Car\" (GasEngine 200) (Wheels 4 17)\n\nmotorcycle :: Vehicle\nmotorcycle = Vehicle \"Motorcycle\" (GasEngine 80) (Wheels 2 18)\n\nbicycle :: Vehicle\nbicycle = Vehicle \"Bicycle\" NoEngine (Wheels 2 26)\n\n-- \u632f\u308b\u821e\u3044\u306f\u95a2\u6570\u3067\u5b9a\u7fa9\ndescribeVehicle :: Vehicle -&gt; String\ndescribeVehicle v = vehicleName v ++ \" with \" ++ engineDesc ++ \" and \" ++ wheelsDesc\n  where\n    engineDesc = case vehicleEngine v of\n      NoEngine -&gt; \"no engine\"\n      GasEngine hp -&gt; show hp ++ \"hp gas engine\"\n      ElectricEngine kw -&gt; show kw ++ \"kWh electric engine\"\n    wheelsDesc = show (wheelCount (vehicleWheels v)) ++ \" wheels\"\n</code></pre>"},{"location":"haskell/22-oo-to-fp-migration/#_5","title":"\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u30b9\u30c6\u30fc\u30c8\u304b\u3089\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u66f4\u65b0\u3078","text":""},{"location":"haskell/22-oo-to-fp-migration/#oo-fp_3","title":"OO: \u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 \u2192 FP: \u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u30ec\u30b3\u30fc\u30c9","text":"<pre><code>-- \u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u306a\u9280\u884c\u53e3\u5ea7\ndata BankAccount = BankAccount\n  { accountId :: String\n  , accountBalance :: Double\n  , accountOwner :: String\n  } deriving (Show, Eq)\n\n-- \u4f5c\u6210\nmakeAccount :: String -&gt; String -&gt; Double -&gt; BankAccount\nmakeAccount aid owner initial = BankAccount aid initial owner\n\n-- \u9810\u91d1\uff08\u65b0\u3057\u3044\u53e3\u5ea7\u3092\u8fd4\u3059\uff09\ndeposit :: Double -&gt; BankAccount -&gt; BankAccount\ndeposit amount account\n  | amount &gt; 0 = account { accountBalance = accountBalance account + amount }\n  | otherwise = account\n\n-- \u5f15\u304d\u51fa\u3057\uff08\u5931\u6557\u3059\u308b\u53ef\u80fd\u6027\u3092Maybe\u3067\u8868\u73fe\uff09\nwithdraw :: Double -&gt; BankAccount -&gt; Maybe BankAccount\nwithdraw amount account\n  | amount &gt; 0 &amp;&amp; accountBalance account &gt;= amount =\n      Just account { accountBalance = accountBalance account - amount }\n  | otherwise = Nothing\n\n-- \u9001\u91d1\ntransfer :: Double -&gt; BankAccount -&gt; BankAccount -&gt; Maybe (BankAccount, BankAccount)\ntransfer amount from to = do\n  from' &lt;- withdraw amount from\n  let to' = deposit amount to\n  return (from', to')\n\n-- \u4f7f\u7528\u4f8b\nlet alice = makeAccount \"A001\" \"Alice\" 1000\n    bob = makeAccount \"B001\" \"Bob\" 500\ncase transfer 200 alice bob of\n  Just (alice', bob') -&gt; do\n    putStrLn $ \"Alice: \" ++ show (accountBalance alice')  -- 800\n    putStrLn $ \"Bob: \" ++ show (accountBalance bob')      -- 700\n  Nothing -&gt; putStrLn \"Transfer failed\"\n</code></pre>"},{"location":"haskell/22-oo-to-fp-migration/#strategy","title":"Strategy \u30d1\u30bf\u30fc\u30f3\u306e\u79fb\u884c","text":""},{"location":"haskell/22-oo-to-fp-migration/#oo-strategy-fp","title":"OO: Strategy \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9 \u2192 FP: \u95a2\u6570","text":"<pre><code>-- Strategy \u3092\u95a2\u6570\u3068\u3057\u3066\u8868\u73fe\ntype PaymentMethod = Double -&gt; String -&gt; Either String String\n\n-- \u5177\u4f53\u7684\u306a Strategy\ncreditCard :: String -&gt; PaymentMethod\ncreditCard cardNumber amount merchant =\n  Right $ \"Paid $\" ++ show amount ++ \" to \" ++ merchant ++ \n          \" via credit card \" ++ take 4 cardNumber ++ \"****\"\n\npaypal :: String -&gt; PaymentMethod\npaypal email amount merchant =\n  Right $ \"Paid $\" ++ show amount ++ \" to \" ++ merchant ++ \n          \" via PayPal (\" ++ email ++ \")\"\n\nbitcoin :: String -&gt; PaymentMethod\nbitcoin wallet amount merchant =\n  Right $ \"Paid $\" ++ show amount ++ \" to \" ++ merchant ++ \n          \" via Bitcoin wallet \" ++ take 8 wallet ++ \"...\"\n\n-- Strategy \u3092\u4f7f\u7528\nprocessPayment :: PaymentMethod -&gt; Double -&gt; String -&gt; Either String String\nprocessPayment method amount merchant = method amount merchant\n\n-- \u4f7f\u7528\u4f8b\nlet strategy = creditCard \"1234567890123456\"\nprocessPayment strategy 100.0 \"Amazon\"\n-- Right \"Paid $100.0 to Amazon via credit card 1234****\"\n</code></pre>"},{"location":"haskell/22-oo-to-fp-migration/#observer","title":"Observer \u30d1\u30bf\u30fc\u30f3\u306e\u79fb\u884c","text":""},{"location":"haskell/22-oo-to-fp-migration/#oo-observer-fp","title":"OO: Observer \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9 \u2192 FP: \u95a2\u6570\u30ea\u30b9\u30c8","text":"<pre><code>-- \u30a4\u30d9\u30f3\u30c8\ndata Event\n  = UserCreated String\n  | UserDeleted String\n  | OrderPlaced String Double\n  | OrderCancelled String\n  deriving (Show, Eq)\n\n-- \u30b5\u30d6\u30b9\u30af\u30ea\u30d7\u30b7\u30e7\u30f3\uff08\u30a4\u30d9\u30f3\u30c8\u3092\u53d7\u3051\u53d6\u308b\u95a2\u6570\uff09\ntype Subscription = Event -&gt; String\n\n-- \u30b5\u30d6\u30b9\u30af\u30e9\u30a4\u30d6\nsubscribe :: String -&gt; Subscription\nsubscribe subscriberName event = case event of\n  UserCreated user -&gt; subscriberName ++ \" notified: User \" ++ user ++ \" created\"\n  OrderPlaced orderId amount -&gt; \n    subscriberName ++ \" notified: Order \" ++ orderId ++ \" placed for $\" ++ show amount\n  _ -&gt; subscriberName ++ \" notified of event\"\n\n-- \u30d1\u30d6\u30ea\u30c3\u30b7\u30e5\npublish :: [Subscription] -&gt; Event -&gt; [String]\npublish subscribers event = map ($ event) subscribers\n\n-- \u30a4\u30d9\u30f3\u30c8\u30ed\u30b0\uff08\u7d14\u7c8b\u95a2\u6570\uff09\ntype EventLog = [Event]\n\nlogEvent :: Event -&gt; EventLog -&gt; EventLog\nlogEvent event log' = event : log'\n\n-- \u4f7f\u7528\u4f8b\nlet emailSub = subscribe \"EmailService\"\n    smsSub = subscribe \"SMSService\"\n    notifications = publish [emailSub, smsSub] (OrderPlaced \"ORD001\" 99.99)\n-- [\"EmailService notified: Order ORD001 placed for $99.99\",\n--  \"SMSService notified: Order ORD001 placed for $99.99\"]\n</code></pre>"},{"location":"haskell/22-oo-to-fp-migration/#factory","title":"Factory \u30d1\u30bf\u30fc\u30f3\u306e\u79fb\u884c","text":""},{"location":"haskell/22-oo-to-fp-migration/#oo-factory-fp","title":"OO: Factory \u30af\u30e9\u30b9 \u2192 FP: \u30b9\u30de\u30fc\u30c8\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf","text":"<pre><code>-- \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u578b\ndata Document\n  = PDFDocument String\n  | WordDocument String\n  | HTMLDocument String\n  deriving (Show, Eq)\n\n-- \u30b9\u30de\u30fc\u30c8\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\ncreatePDF :: String -&gt; Document\ncreatePDF = PDFDocument\n\ncreateWord :: String -&gt; Document\ncreateWord = WordDocument\n\ncreateHTML :: String -&gt; Document\ncreateHTML = HTMLDocument\n\n-- \u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\nrenderDocument :: Document -&gt; String\nrenderDocument (PDFDocument content) = \"&lt;PDF&gt;\" ++ content ++ \"&lt;/PDF&gt;\"\nrenderDocument (WordDocument content) = \"&lt;WORD&gt;\" ++ content ++ \"&lt;/WORD&gt;\"\nrenderDocument (HTMLDocument content) = \"&lt;html&gt;&lt;body&gt;\" ++ content ++ \"&lt;/body&gt;&lt;/html&gt;\"\n</code></pre>"},{"location":"haskell/22-oo-to-fp-migration/#singleton","title":"Singleton \u306e\u79fb\u884c","text":""},{"location":"haskell/22-oo-to-fp-migration/#oo-singleton-fp","title":"OO: Singleton \u30af\u30e9\u30b9 \u2192 FP: \u30e2\u30b8\u30e5\u30fc\u30eb\u30ec\u30d9\u30eb\u5024","text":"<pre><code>-- \u8a2d\u5b9a\u578b\ndata Config = Config\n  { configDbHost :: String\n  , configDbPort :: Int\n  , configLogLevel :: String\n  } deriving (Show, Eq)\n\n-- \u30e2\u30b8\u30e5\u30fc\u30eb\u30ec\u30d9\u30eb\u306e\u5024\uff08Singleton \u306e\u4ee3\u308f\u308a\uff09\ndefaultConfig :: Config\ndefaultConfig = Config \"localhost\" 5432 \"INFO\"\n\ntestConfig :: Config\ntestConfig = Config \"localhost\" 5433 \"DEBUG\"\n\nproductionConfig :: Config\nproductionConfig = Config \"prod.db.example.com\" 5432 \"WARN\"\n\n-- \u4f7f\u7528\u6642\u306b\u660e\u793a\u7684\u306b\u6e21\u3059\nrunApp :: Config -&gt; IO ()\nrunApp config = do\n  putStrLn $ \"Connecting to \" ++ configDbHost config\n  -- ...\n</code></pre>"},{"location":"haskell/22-oo-to-fp-migration/#null-object","title":"Null Object \u306e\u79fb\u884c","text":""},{"location":"haskell/22-oo-to-fp-migration/#oo-null-object-fp-maybe","title":"OO: Null Object \u30d1\u30bf\u30fc\u30f3 \u2192 FP: Maybe","text":"<pre><code>-- \u30e6\u30fc\u30b6\u30fc\u691c\u7d22\uff08Maybe \u3092\u8fd4\u3059\uff09\nfindUser :: String -&gt; Maybe SimpleUser\nfindUser userId = Map.lookup userId userDatabase\n\n-- \u5b89\u5168\u306a\u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3\ngetUserName :: String -&gt; Maybe String\ngetUserName userId = simpleUserName &lt;$&gt; findUser userId\n\n-- \u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u4ed8\u304d\ngetUserNameOrDefault :: String -&gt; String -&gt; String\ngetUserNameOrDefault userId defaultName =\n  maybe defaultName simpleUserName (findUser userId)\n\n-- \u4f7f\u7528\u4f8b\ngetUserName \"1\"                      -- Just \"Alice\"\ngetUserName \"999\"                    -- Nothing\ngetUserNameOrDefault \"999\" \"Unknown\" -- \"Unknown\"\n</code></pre>"},{"location":"haskell/22-oo-to-fp-migration/#template-method","title":"Template Method \u306e\u79fb\u884c","text":""},{"location":"haskell/22-oo-to-fp-migration/#oo-template-method-fp","title":"OO: Template Method \u2192 FP: \u9ad8\u968e\u95a2\u6570","text":"<pre><code>-- \u30c7\u30fc\u30bf\u30d7\u30ed\u30bb\u30c3\u30b5\uff08\u95a2\u6570\u3068\u3057\u3066\u8868\u73fe\uff09\ntype DataProcessor = String -&gt; String\n\n-- \u5177\u4f53\u7684\u306a\u30d7\u30ed\u30bb\u30c3\u30b5\ncsvProcessor :: DataProcessor\ncsvProcessor input = \"CSV[\" ++ input ++ \"]\"\n\njsonProcessor :: DataProcessor\njsonProcessor input = \"{\\\"data\\\": \\\"\" ++ input ++ \"\\\"}\"\n\nxmlProcessor :: DataProcessor\nxmlProcessor input = \"&lt;data&gt;\" ++ input ++ \"&lt;/data&gt;\"\n\n-- \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u30e1\u30bd\u30c3\u30c9\u306e\u7b49\u4fa1\u7269\uff08\u9ad8\u968e\u95a2\u6570\uff09\nprocessData :: DataProcessor -&gt; String -&gt; String\nprocessData processor input =\n  let validated = \"validated:\" ++ input\n      transformed = processor validated\n      output = \"output:\" ++ transformed\n  in output\n\n-- \u4f7f\u7528\u4f8b\nprocessData csvProcessor \"test\"   -- \"output:CSV[validated:test]\"\nprocessData jsonProcessor \"test\"  -- \"output:{\\\"data\\\": \\\"validated:test\\\"}\"\n</code></pre>"},{"location":"haskell/22-oo-to-fp-migration/#chain-of-responsibility","title":"Chain of Responsibility \u306e\u79fb\u884c","text":""},{"location":"haskell/22-oo-to-fp-migration/#oo-handler-fp","title":"OO: Handler \u30c1\u30a7\u30fc\u30f3 \u2192 FP: \u95a2\u6570\u5408\u6210","text":"<pre><code>-- \u30ea\u30af\u30a8\u30b9\u30c8\ndata Request = Request\n  { reqPath :: String\n  , reqMethod :: String\n  , reqHeaders :: Map String String\n  , reqBody :: String\n  } deriving (Show, Eq)\n\n-- \u30cf\u30f3\u30c9\u30e9\u30fc\uff08\u95a2\u6570\u3068\u3057\u3066\u8868\u73fe\uff09\ntype Handler = Request -&gt; Either String Request\n\n-- \u5177\u4f53\u7684\u306a\u30cf\u30f3\u30c9\u30e9\u30fc\nauthHandler :: Handler\nauthHandler req =\n  case Map.lookup \"Authorization\" (reqHeaders req) of\n    Nothing -&gt; Left \"Unauthorized: No auth header\"\n    Just _ -&gt; Right req\n\nvalidationHandler :: Handler\nvalidationHandler req\n  | null (reqBody req) &amp;&amp; reqMethod req == \"POST\" = Left \"Bad Request: Empty body\"\n  | otherwise = Right req\n\nloggingHandler :: Handler\nloggingHandler req = Right req\n\n-- \u30cf\u30f3\u30c9\u30e9\u30fc\u306e\u9023\u7d50\nchainHandlers :: [Handler] -&gt; Handler\nchainHandlers [] req = Right req\nchainHandlers (h:hs) req = case h req of\n  Left err -&gt; Left err\n  Right req' -&gt; chainHandlers hs req'\n\n-- \u4f7f\u7528\u4f8b\nlet handlers = chainHandlers [authHandler, loggingHandler, validationHandler]\n    request = Request \"/api/users\" \"POST\" \n              (Map.fromList [(\"Authorization\", \"Bearer token\")]) \n              \"{\\\"name\\\":\\\"test\\\"}\"\nhandlers request  -- Right Request {...}\n</code></pre>"},{"location":"haskell/22-oo-to-fp-migration/#_6","title":"\u30c6\u30b9\u30c8","text":"<pre><code>spec :: Spec\nspec = do\n  describe \"Class to Data Type Migration\" $ do\n    it \"animals make sounds\" $ do\n      let dog = Dog \"Rex\" \"German Shepherd\"\n      makeSound dog `shouldBe` \"Rex says: Woof!\"\n\n  describe \"Immutable Updates\" $ do\n    it \"deposit creates new account\" $ do\n      let account = makeAccount \"A001\" \"Alice\" 1000\n          account' = deposit 500 account\n      getBalance account' `shouldBe` 1500\n      getBalance account `shouldBe` 1000  -- \u5143\u306e\u30c7\u30fc\u30bf\u306f\u5909\u66f4\u3055\u308c\u306a\u3044\n\n  describe \"Strategy Migration\" $ do\n    it \"uses payment strategy\" $ do\n      let strategy = creditCard \"1234567890123456\"\n      case processPayment strategy 100.0 \"Store\" of\n        Right msg -&gt; \"credit card\" `isInfixOf` msg `shouldBe` True\n        Left _ -&gt; expectationFailure \"Should succeed\"\n\n  describe \"Chain of Responsibility\" $ do\n    it \"chains handlers\" $ do\n      let handlers = chainHandlers [authHandler, validationHandler]\n          validReq = Request \"/api\" \"POST\" \n                     (Map.fromList [(\"Authorization\", \"token\")]) \n                     \"body\"\n      case handlers validReq of\n        Right _ -&gt; return ()\n        Left _ -&gt; expectationFailure \"Should pass\"\n</code></pre>"},{"location":"haskell/22-oo-to-fp-migration/#_7","title":"\u79fb\u884c\u306e\u30ac\u30a4\u30c9\u30e9\u30a4\u30f3","text":""},{"location":"haskell/22-oo-to-fp-migration/#1","title":"1. \u7d99\u627f\u3088\u308a\u30b3\u30f3\u30dd\u30b8\u30b7\u30e7\u30f3","text":"<pre><code>-- \u60aa\u3044\u4f8b\uff08\u7d99\u627f\u306e\u6a21\u5023\uff09\n-- \u826f\u3044\u4f8b\uff08\u30b3\u30f3\u30dd\u30b8\u30b7\u30e7\u30f3\uff09\ndata Component = Component { ... }\ndata Entity = Entity { entityComponents :: [Component] }\n</code></pre>"},{"location":"haskell/22-oo-to-fp-migration/#2","title":"2. \u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u30b9\u30c6\u30fc\u30c8\u306e\u6392\u9664","text":"<pre><code>-- \u60aa\u3044\u4f8b\uff1aIORef \u3092\u591a\u7528\n-- \u826f\u3044\u4f8b\uff1a\u7d14\u7c8b\u95a2\u6570\u3067\u72b6\u614b\u3092\u5909\u63db\nupdate :: State -&gt; Action -&gt; State\n</code></pre>"},{"location":"haskell/22-oo-to-fp-migration/#3","title":"3. \u4f8b\u5916\u3088\u308a\u623b\u308a\u5024","text":"<pre><code>-- \u60aa\u3044\u4f8b\uff1a\u4f8b\u5916\u3092\u30b9\u30ed\u30fc\n-- \u826f\u3044\u4f8b\uff1aMaybe/Either \u3067\u5931\u6557\u3092\u8868\u73fe\nfindUser :: String -&gt; Maybe User\nprocessOrder :: Order -&gt; Either OrderError Receipt\n</code></pre>"},{"location":"haskell/22-oo-to-fp-migration/#4","title":"4. \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3088\u308a\u95a2\u6570","text":"<pre><code>-- \u60aa\u3044\u4f8b\uff1a\u578b\u30af\u30e9\u30b9\u306e\u4e71\u7528\n-- \u826f\u3044\u4f8b\uff1a\u95a2\u6570\u3092\u76f4\u63a5\u6e21\u3059\ntype Strategy a = a -&gt; a\napplyStrategy :: Strategy a -&gt; a -&gt; a\n</code></pre>"},{"location":"haskell/22-oo-to-fp-migration/#_8","title":"\u307e\u3068\u3081","text":"<ul> <li>\u7d99\u627f\u968e\u5c64\u306f\u76f4\u548c\u578b\u3067\u8868\u73fe</li> <li>\u30dd\u30ea\u30e2\u30fc\u30d5\u30a3\u30ba\u30e0\u306f\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u307e\u305f\u306f\u578b\u30af\u30e9\u30b9</li> <li>\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u30b9\u30c6\u30fc\u30c8\u306f\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u30ec\u30b3\u30fc\u30c9\u306e\u5909\u63db</li> <li>OO \u30d1\u30bf\u30fc\u30f3\u306e\u591a\u304f\u306f\u95a2\u6570\u3068\u9ad8\u968e\u95a2\u6570\u3067\u7c21\u6f54\u306b\u8868\u73fe\u53ef\u80fd</li> <li>\u578b\u30b7\u30b9\u30c6\u30e0\u306b\u3088\u308a\u3001\u3088\u308a\u5b89\u5168\u306a\u8a2d\u8a08\u304c\u53ef\u80fd</li> </ul>"},{"location":"rust/","title":"Rust \u3067\u5b66\u3076\u95a2\u6570\u578b\u30c7\u30b6\u30a4\u30f3","text":""},{"location":"rust/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u8a18\u4e8b\u30b7\u30ea\u30fc\u30ba\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u304a\u3051\u308b\u8a2d\u8a08\u539f\u5247\u3068\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u3092 Rust \u3092\u4f7f\u3063\u3066\u5b9f\u8df5\u7684\u306b\u5b66\u3076\u305f\u3081\u306e\u30ac\u30a4\u30c9\u3067\u3059\u3002Rust \u306e\u6240\u6709\u6a29\u30b7\u30b9\u30c6\u30e0\u3068\u578b\u30b7\u30b9\u30c6\u30e0\u3092\u6d3b\u304b\u3057\u3001\u5f93\u6765\u306e\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u3092\u95a2\u6570\u578b\u30d1\u30e9\u30c0\u30a4\u30e0\u3067\u3069\u306e\u3088\u3046\u306b\u8868\u73fe\u3057\u3001\u6d3b\u7528\u3067\u304d\u308b\u304b\u3092\u63a2\u6c42\u3057\u307e\u3059\u3002</p>"},{"location":"rust/#_2","title":"\u8a18\u4e8b\u69cb\u6210","text":""},{"location":"rust/#1","title":"\u7b2c1\u90e8: \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u57fa\u790e\u539f\u5247","text":"<ol> <li>\u4e0d\u5909\u6027\u3068\u30c7\u30fc\u30bf\u5909\u63db</li> <li>\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u4e0d\u5909\u6027\u3068\u6240\u6709\u6a29</li> <li>\u30a4\u30c6\u30ec\u30fc\u30bf\u3068\u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3</li> <li> <p>\u526f\u4f5c\u7528\u306e\u5206\u96e2</p> </li> <li> <p>\u95a2\u6570\u5408\u6210\u3068\u9ad8\u968e\u95a2\u6570</p> </li> <li>\u30af\u30ed\u30fc\u30b8\u30e3\u306b\u3088\u308b\u95a2\u6570\u5408\u6210</li> <li>\u30ab\u30ea\u30fc\u5316\u3068\u90e8\u5206\u9069\u7528</li> <li> <p>\u9ad8\u968e\u95a2\u6570\u306e\u6d3b\u7528</p> </li> <li> <p>\u591a\u614b\u6027\u306e\u5b9f\u73fe\u65b9\u6cd5</p> </li> <li>enum \u3068\u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b</li> <li>trait \u306b\u3088\u308b\u62bd\u8c61\u5316</li> <li>\u30b8\u30a7\u30cd\u30ea\u30af\u30b9\u3068 trait bounds</li> </ol>"},{"location":"rust/#2","title":"\u7b2c2\u90e8: \u4ed5\u69d8\u3068\u30c6\u30b9\u30c8","text":"<ol> <li>\u30c7\u30fc\u30bf\u691c\u8a3c</li> <li>\u578b\u306b\u3088\u308b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3</li> <li>Result \u306b\u3088\u308b\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0</li> <li> <p>\u30ab\u30b9\u30bf\u30e0\u30d0\u30ea\u30c7\u30fc\u30bf\u306e\u4f5c\u6210</p> </li> <li> <p>\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8</p> </li> <li>proptest \u306e\u57fa\u672c</li> <li>\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u306e\u4f5c\u6210</li> <li> <p>\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u5b9a\u7fa9\u3068\u691c\u8a3c</p> </li> <li> <p>TDD \u3068\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0</p> </li> <li>Rust \u7d44\u307f\u8fbc\u307f\u30c6\u30b9\u30c8\u306e\u6d3b\u7528</li> <li>Red-Green-Refactor \u30b5\u30a4\u30af\u30eb</li> <li>\u30c6\u30b9\u30c8\u30d5\u30a1\u30fc\u30b9\u30c8\u306e\u95a2\u6570\u8a2d\u8a08</li> </ol>"},{"location":"rust/#3","title":"\u7b2c3\u90e8: \u69cb\u9020\u30d1\u30bf\u30fc\u30f3","text":"<ol> <li>Composite \u30d1\u30bf\u30fc\u30f3</li> <li>\u518d\u5e30\u7684\u306a\u30c7\u30fc\u30bf\u69cb\u9020</li> <li>enum \u306b\u3088\u308b\u30c4\u30ea\u30fc\u69cb\u9020</li> <li> <p>fold \u306b\u3088\u308b\u8d70\u67fb</p> </li> <li> <p>Decorator \u30d1\u30bf\u30fc\u30f3</p> </li> <li>\u95a2\u6570\u5408\u6210\u306b\u3088\u308b\u30c7\u30b3\u30ec\u30fc\u30b7\u30e7\u30f3</li> <li>\u30af\u30ed\u30fc\u30b8\u30e3\u3067\u306e\u30e9\u30c3\u30d4\u30f3\u30b0</li> <li> <p>\u632f\u308b\u821e\u3044\u306e\u52d5\u7684\u8ffd\u52a0</p> </li> <li> <p>Adapter \u30d1\u30bf\u30fc\u30f3</p> </li> <li>\u95a2\u6570\u30a2\u30c0\u30d7\u30bf\u30fc</li> <li>\u30d7\u30ed\u30c8\u30b3\u30eb\u5909\u63db</li> <li>\u30ec\u30ac\u30b7\u30fc\u30b3\u30fc\u30c9\u3068\u306e\u7d71\u5408</li> </ol>"},{"location":"rust/#4","title":"\u7b2c4\u90e8: \u632f\u308b\u821e\u3044\u30d1\u30bf\u30fc\u30f3","text":"<ol> <li> <p>Strategy \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>\u30af\u30ed\u30fc\u30b8\u30e3\u3068\u3057\u3066\u306e\u6226\u7565</li> <li>\u52d5\u7684\u306a\u6226\u7565\u5207\u308a\u66ff\u3048</li> <li>\u6226\u7565\u306e\u5408\u6210</li> </ul> </li> <li> <p>Command \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>\u4e0d\u5909\u30b3\u30de\u30f3\u30c9\u69cb\u9020\u4f53</li> <li>\u30b3\u30de\u30f3\u30c9\u306e\u5c65\u6b74\u3068 Undo</li> <li>\u30de\u30af\u30ed\u30b3\u30de\u30f3\u30c9</li> </ul> </li> <li> <p>Visitor \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>match \u306b\u3088\u308b\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1</li> <li>fold \u30d9\u30fc\u30b9\u306e\u30d3\u30b8\u30bf\u30fc</li> <li>\u62e1\u5f35\u53ef\u80fd\u306a\u30d3\u30b8\u30bf\u30fc</li> </ul> </li> </ol>"},{"location":"rust/#5","title":"\u7b2c5\u90e8: \u751f\u6210\u30d1\u30bf\u30fc\u30f3","text":"<ol> <li> <p>Abstract Factory \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>\u95a2\u6570\u30d5\u30a1\u30af\u30c8\u30ea\u30fc</li> <li>trait \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u3088\u308b\u751f\u6210</li> <li>\u4f9d\u5b58\u6027\u6ce8\u5165</li> </ul> </li> <li> <p>Abstract Server \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>trait \u306b\u3088\u308b\u62bd\u8c61\u5316</li> <li>\u5b9f\u88c5\u306e\u5dee\u3057\u66ff\u3048</li> <li>\u30c6\u30b9\u30bf\u30d6\u30eb\u306a\u8a2d\u8a08</li> </ul> </li> </ol>"},{"location":"rust/#6","title":"\u7b2c6\u90e8: \u30b1\u30fc\u30b9\u30b9\u30bf\u30c7\u30a3","text":"<ol> <li> <p>\u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b</p> <ul> <li>\u4e0d\u5909\u72b6\u614b\u306e\u7ba1\u7406</li> <li>\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u306e\u5b9f\u88c5</li> <li>\u518d\u5e30\u7684\u306a\u51e6\u7406</li> </ul> </li> <li> <p>\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0</p> <ul> <li>\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30ea\u30f3\u30b0</li> <li>\u591a\u614b\u7684\u306a\u8a08\u7b97</li> <li>\u30ec\u30dd\u30fc\u30c8\u751f\u6210</li> </ul> </li> <li> <p>\u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0</p> <ul> <li>\u72b6\u614b\u9077\u79fb\u306e\u7ba1\u7406</li> <li>\u30a4\u30d9\u30f3\u30c8\u30bd\u30fc\u30b7\u30f3\u30b0</li> <li>\u30d3\u30b8\u30cd\u30b9\u30eb\u30fc\u30eb\u306e\u5b9f\u88c5</li> </ul> </li> <li> <p>\u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0</p> <ul> <li>Mutex \u3068 RwLock \u306b\u3088\u308b\u72b6\u614b\u7ba1\u7406</li> <li>\u30c1\u30e3\u30cd\u30eb\u306b\u3088\u308b\u30e1\u30c3\u30bb\u30fc\u30b8\u30d1\u30c3\u30b7\u30f3\u30b0</li> <li>async/await \u3068 Tokio</li> </ul> </li> <li> <p>Wa-Tor \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3</p> <ul> <li>\u30bb\u30eb\u30aa\u30fc\u30c8\u30de\u30c8\u30f3</li> <li>\u4e0d\u5909\u30b0\u30ea\u30c3\u30c9\u306e\u66f4\u65b0</li> <li>\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30d7</li> </ul> </li> </ol>"},{"location":"rust/#7","title":"\u7b2c7\u90e8: \u307e\u3068\u3081\u3068\u5fdc\u7528","text":"<ol> <li> <p>\u30d1\u30bf\u30fc\u30f3\u9593\u306e\u76f8\u4e92\u4f5c\u7528</p> <ul> <li>Composite + Decorator</li> <li>Command + Observer</li> <li>\u30d1\u30bf\u30fc\u30f3\u306e\u7d44\u307f\u5408\u308f\u305b</li> </ul> </li> <li> <p>\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9</p> <ul> <li>\u30c7\u30fc\u30bf\u4e2d\u5fc3\u8a2d\u8a08</li> <li>\u6240\u6709\u6a29\u3068\u501f\u7528\u306e\u6d3b\u7528</li> <li>\u95a2\u6570\u30c7\u30b3\u30ec\u30fc\u30bf\u30fc</li> <li>\u30c6\u30b9\u30bf\u30d6\u30eb\u306a\u8a2d\u8a08</li> </ul> </li> <li> <p>OO \u304b\u3089 FP \u3078\u306e\u79fb\u884c</p> <ul> <li>\u79fb\u884c\u6226\u7565\uff08Strangler Fig\u3001\u30a2\u30c0\u30d7\u30bf\u30fc\uff09</li> <li>\u30a4\u30d9\u30f3\u30c8\u30bd\u30fc\u30b7\u30f3\u30b0</li> <li>\u6bb5\u968e\u7684\u306a\u95a2\u6570\u62bd\u51fa</li> <li>enum \u306b\u3088\u308b\u591a\u614b\u6027</li> </ul> </li> </ol>"},{"location":"rust/#_3","title":"\u672c\u30b7\u30ea\u30fc\u30ba\u306e\u7279\u5fb4","text":""},{"location":"rust/#rust_1","title":"Rust \u306e\u7279\u6027\u3092\u6d3b\u304b\u3057\u305f\u5b9f\u88c5","text":"<p>Rust \u306e\u6240\u6709\u6a29\u30b7\u30b9\u30c6\u30e0\u3001\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3001enum\uff08\u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b\uff09\u3092\u6d3b\u7528\u3057\u3001\u5b89\u5168\u304b\u3064\u52b9\u7387\u7684\u306a\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"rust/#_4","title":"\u5b9f\u8df5\u91cd\u8996","text":"<p>\u3059\u3079\u3066\u306e\u30d1\u30bf\u30fc\u30f3\u306f Rust \u7d44\u307f\u8fbc\u307f\u306e\u30c6\u30b9\u30c8\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306b\u3088\u308b\u5b9f\u969b\u306b\u52d5\u4f5c\u3059\u308b\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u3092\u542b\u307f\u307e\u3059\u3002\u7406\u8ad6\u3060\u3051\u3067\u306a\u304f\u3001\u5b9f\u88c5\u3092\u901a\u3058\u3066\u7406\u89e3\u3092\u6df1\u3081\u308b\u3053\u3068\u3092\u91cd\u8996\u3057\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"rust/#_5","title":"\u6bb5\u968e\u7684\u306a\u5b66\u7fd2","text":"<p>\u57fa\u790e\u304b\u3089\u5fdc\u7528\u3078\u3068\u6bb5\u968e\u7684\u306b\u5185\u5bb9\u304c\u9032\u884c\u3057\u307e\u3059\u3002\u5404\u7ae0\u306f\u72ec\u7acb\u3057\u3066\u8aad\u3080\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u304c\u3001\u9806\u756a\u306b\u8aad\u3080\u3053\u3068\u3067\u3088\u308a\u6df1\u3044\u7406\u89e3\u304c\u5f97\u3089\u308c\u307e\u3059\u3002</p>"},{"location":"rust/#_6","title":"\u5bfe\u8c61\u8aad\u8005","text":"<ul> <li>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u8208\u5473\u304c\u3042\u308b Rust \u958b\u767a\u8005</li> <li>Rust \u3092\u5b66\u7fd2\u4e2d\u306e\u958b\u767a\u8005</li> <li>\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u306e\u77e5\u8b58\u304c\u3042\u308a\u3001\u95a2\u6570\u578b\u3067\u306e\u8868\u73fe\u3092\u5b66\u3073\u305f\u3044\u958b\u767a\u8005</li> <li>Clojure \u7248\u3084 Scala \u7248\u3068\u6bd4\u8f03\u3057\u3066\u5b66\u7fd2\u3057\u305f\u3044\u958b\u767a\u8005</li> </ul>"},{"location":"rust/#_7","title":"\u524d\u63d0\u77e5\u8b58","text":"<ul> <li>\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u57fa\u790e\u77e5\u8b58</li> <li>Rust \u306e\u57fa\u672c\u7684\u306a\u6587\u6cd5\uff08struct\u3001enum\u3001trait\u3001\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u306a\u3069\uff09</li> <li>\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u306e\u57fa\u672c\u6982\u5ff5\uff08\u63a8\u5968\uff09</li> </ul>"},{"location":"rust/#_8","title":"\u958b\u767a\u74b0\u5883","text":"<p>\u672c\u30b7\u30ea\u30fc\u30ba\u306e\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u306e\u74b0\u5883\u3067\u52d5\u4f5c\u78ba\u8a8d\u3057\u3066\u3044\u307e\u3059\uff1a</p> <ul> <li>Rust 1.75.0+</li> <li>Cargo\uff08Rust \u30d1\u30c3\u30b1\u30fc\u30b8\u30de\u30cd\u30fc\u30b8\u30e3\uff09</li> <li>proptest 1.4\uff08\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\uff09</li> <li>Nix \u306b\u3088\u308b\u74b0\u5883\u7ba1\u7406</li> </ul>"},{"location":"rust/#_9","title":"\u74b0\u5883\u69cb\u7bc9","text":"<pre><code># Nix \u3092\u4f7f\u7528\u3057\u305f\u958b\u767a\u74b0\u5883\u306e\u8d77\u52d5\nnix develop .#rust\n\n# \u30c6\u30b9\u30c8\u306e\u5b9f\u884c\ncd app/rust/part1\ncargo test\n</code></pre>"},{"location":"rust/#_10","title":"\u53c2\u8003\u66f8\u7c4d","text":"<p>\u672c\u30b7\u30ea\u30fc\u30ba\u306f\u4ee5\u4e0b\u306e\u66f8\u7c4d\u306e\u5185\u5bb9\u3092\u53c2\u8003\u306b\u3057\u3066\u3044\u307e\u3059\uff1a</p> <ul> <li>\u300cFunctional Design: Principles, Patterns, and Practices\u300dRobert C. Martin</li> <li>\u300cProgramming Rust\u300dJim Blandy, Jason Orendorff, Leonora F.S. Tindall</li> <li>\u300cThe Rust Programming Language\u300dSteve Klabnik, Carol Nichols</li> <li>\u300cRust Design Patterns\u300d</li> </ul>"},{"location":"rust/01-immutability-and-data-transformation/","title":"\u7b2c1\u7ae0: \u4e0d\u5909\u6027\u3068\u30c7\u30fc\u30bf\u5909\u63db","text":""},{"location":"rust/01-immutability-and-data-transformation/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u6700\u3082\u91cd\u8981\u306a\u6982\u5ff5\u306e\u4e00\u3064\u304c\u4e0d\u5909\u6027\uff08Immutability\uff09\u3067\u3059\u3002\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u4e88\u6e2c\u53ef\u80fd\u6027\u304c\u5411\u4e0a\u3057\u3001\u4e26\u884c\u51e6\u7406\u3067\u306e\u30d0\u30b0\u3092\u9632\u304e\u3001\u30b3\u30fc\u30c9\u306e\u7406\u89e3\u3068\u4fdd\u5b88\u304c\u5bb9\u6613\u306b\u306a\u308a\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001Rust \u306b\u304a\u3051\u308b\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u57fa\u672c\u304b\u3089\u3001\u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3001\u526f\u4f5c\u7528\u306e\u5206\u96e2\u307e\u3067\u3001\u5b9f\u8df5\u7684\u306a\u4f8b\u3092\u901a\u3058\u3066\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"rust/01-immutability-and-data-transformation/#1_1","title":"1. \u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u57fa\u672c","text":""},{"location":"rust/01-immutability-and-data-transformation/#_2","title":"\u306a\u305c\u4e0d\u5909\u6027\u304c\u91cd\u8981\u306a\u306e\u304b","text":"<p>\u5f93\u6765\u306e\u547d\u4ee4\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u5909\u6570\u3084\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u72b6\u614b\u3092\u76f4\u63a5\u5909\u66f4\u3057\u307e\u3059\uff1a</p> <pre><code>// Java\uff08\u53ef\u5909\uff09\nperson.setAge(31);  // \u5143\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u5909\u66f4\u3055\u308c\u308b\n</code></pre> <p>\u3053\u308c\u306b\u5bfe\u3057\u3001Rust \u306e\u5909\u6570\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u4e0d\u5909\u3067\u3059\u3002\u30c7\u30fc\u30bf\u3092\u300c\u5909\u66f4\u300d\u3059\u308b\u3068\u3001\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u69cb\u9020\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\uff1a</p> <pre><code>#[derive(Debug, Clone, PartialEq)]\npub struct Person {\n    pub name: String,\n    pub age: u32,\n}\n\nimpl Person {\n    pub fn new(name: &amp;str, age: u32) -&gt; Self {\n        Person {\n            name: name.to_string(),\n            age,\n        }\n    }\n\n    /// \u5e74\u9f62\u3092\u66f4\u65b0\u3057\u305f\u65b0\u3057\u3044 Person \u3092\u8fd4\u3059\uff08\u5143\u306e\u30c7\u30fc\u30bf\u306f\u5909\u66f4\u3057\u306a\u3044\uff09\n    pub fn with_age(&amp;self, new_age: u32) -&gt; Self {\n        Person {\n            name: self.name.clone(),\n            age: new_age,\n        }\n    }\n}\n\n// \u4f7f\u7528\u4f8b\nlet original_person = Person::new(\"\u7530\u4e2d\", 30);\nlet updated_person = original_person.with_age(31);\n\n// original_person.age =&gt; 30  \u2190 \u5143\u306e\u30c7\u30fc\u30bf\u306f\u5909\u308f\u3089\u306a\u3044\n// updated_person.age =&gt; 31   \u2190 \u65b0\u3057\u3044\u30c7\u30fc\u30bf\n</code></pre>"},{"location":"rust/01-immutability-and-data-transformation/#_3","title":"\u4e0d\u5909\u6027\u306e\u5229\u70b9","text":"<ol> <li>\u4e88\u6e2c\u53ef\u80fd\u6027: \u30c7\u30fc\u30bf\u304c\u5909\u66f4\u3055\u308c\u306a\u3044\u305f\u3081\u3001\u95a2\u6570\u306e\u52d5\u4f5c\u3092\u4e88\u6e2c\u3057\u3084\u3059\u3044</li> <li>\u30b9\u30ec\u30c3\u30c9\u30bb\u30fc\u30d5: \u8907\u6570\u306e\u30b9\u30ec\u30c3\u30c9\u304b\u3089\u5b89\u5168\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b</li> <li>\u5c65\u6b74\u306e\u4fdd\u6301: \u5909\u66f4\u524d\u306e\u30c7\u30fc\u30bf\u3092\u4fdd\u6301\u3067\u304d\u308b\uff08Undo/Redo \u306e\u5b9f\u88c5\u304c\u5bb9\u6613\uff09</li> <li>\u30c7\u30d0\u30c3\u30b0\u306e\u5bb9\u6613\u3055: \u30c7\u30fc\u30bf\u306e\u5909\u66f4\u5c65\u6b74\u3092\u8ffd\u8de1\u3057\u3084\u3059\u3044</li> </ol>"},{"location":"rust/01-immutability-and-data-transformation/#rust","title":"Rust \u306e\u6240\u6709\u6a29\u30b7\u30b9\u30c6\u30e0\u3068\u4e0d\u5909\u6027","text":"<p>Rust \u306f\u6240\u6709\u6a29\u30b7\u30b9\u30c6\u30e0\u306b\u3088\u308a\u3001\u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u306b\u30e1\u30e2\u30ea\u5b89\u5168\u6027\u3092\u4fdd\u8a3c\u3057\u307e\u3059\uff1a</p> <ul> <li>\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u5909\u6570\u306f\u4e0d\u5909\uff08<code>let</code> \u3067\u5ba3\u8a00\uff09</li> <li>\u53ef\u5909\u306b\u3059\u308b\u306b\u306f\u660e\u793a\u7684\u306b <code>mut</code> \u3092\u4ed8\u3051\u308b</li> <li>\u501f\u7528\uff08<code>&amp;</code>\uff09\u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u4e0d\u5909\u3001\u53ef\u5909\u501f\u7528\u306f <code>&amp;mut</code></li> </ul> <pre><code>let person = Person::new(\"\u7530\u4e2d\", 30);  // \u4e0d\u5909\n// person.age = 31;  // \u30b3\u30f3\u30d1\u30a4\u30eb\u30a8\u30e9\u30fc\uff01\n\nlet mut mutable_person = Person::new(\"\u7530\u4e2d\", 30);  // \u53ef\u5909\nmutable_person.age = 31;  // OK\n</code></pre>"},{"location":"rust/01-immutability-and-data-transformation/#2-structural-sharing","title":"2. \u69cb\u9020\u5171\u6709\uff08Structural Sharing\uff09","text":"<p>\u300c\u6bce\u56de\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u4f5c\u6210\u3059\u308b\u3068\u975e\u52b9\u7387\u3067\u306f\uff1f\u300d\u3068\u601d\u3046\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002Rust \u3067\u306f <code>Clone</code> \u30c8\u30ec\u30a4\u30c8\u306b\u3088\u308a\u3001\u52b9\u7387\u7684\u306b\u30c7\u30fc\u30bf\u3092\u30b3\u30d4\u30fc\u3067\u304d\u307e\u3059\u3002</p> <pre><code>#[derive(Debug, Clone, PartialEq)]\npub struct Member {\n    pub name: String,\n    pub role: String,\n}\n\n#[derive(Debug, Clone, PartialEq)]\npub struct Team {\n    pub name: String,\n    pub members: Vec&lt;Member&gt;,\n}\n\nimpl Team {\n    pub fn add_member(&amp;self, member: Member) -&gt; Self {\n        let mut new_members = self.members.clone();\n        new_members.push(member);\n        Team {\n            name: self.name.clone(),\n            members: new_members,\n        }\n    }\n}\n\nlet team = Team::new(\"\u958b\u767a\u30c1\u30fc\u30e0\", vec![\n    Member::new(\"\u7530\u4e2d\", \"developer\"),\n    Member::new(\"\u9234\u6728\", \"designer\"),\n    Member::new(\"\u4f50\u85e4\", \"manager\"),\n]);\n\nlet new_team = team.add_member(Member::new(\"\u5c71\u7530\", \"developer\"));\n</code></pre> <p><code>new_team</code> \u306f\u65b0\u3057\u3044 Team \u3067\u3059\u304c\u3001\u5143\u306e <code>team</code> \u306f\u5909\u66f4\u3055\u308c\u307e\u305b\u3093\u3002</p> <p></p>"},{"location":"rust/01-immutability-and-data-transformation/#3","title":"3. \u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u30c7\u30fc\u30bf\u3092\u5909\u63db\u3059\u308b\u4e00\u9023\u306e\u51e6\u7406\u3092\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3068\u3057\u3066\u8868\u73fe\u3057\u307e\u3059\u3002Rust \u3067\u306f\u30a4\u30c6\u30ec\u30fc\u30bf\u306e\u30e1\u30bd\u30c3\u30c9\u30c1\u30a7\u30fc\u30f3\u3092\u4f7f\u7528\u3057\u3066\u3001\u8aad\u307f\u3084\u3059\u3044\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u69cb\u7bc9\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"rust/01-immutability-and-data-transformation/#_4","title":"\u5b9f\u8df5\u4f8b\uff1a\u6ce8\u6587\u51e6\u7406\u30b7\u30b9\u30c6\u30e0","text":"<pre><code>#[derive(Debug, Clone, PartialEq)]\npub struct Item {\n    pub name: String,\n    pub price: i32,\n    pub quantity: i32,\n}\n\nimpl Item {\n    /// \u5c0f\u8a08\u3092\u8a08\u7b97\u3059\u308b\n    pub fn subtotal(&amp;self) -&gt; i32 {\n        self.price * self.quantity\n    }\n}\n\n#[derive(Debug, Clone, PartialEq)]\npub struct Customer {\n    pub name: String,\n    pub membership: String,\n}\n\n#[derive(Debug, Clone, PartialEq)]\npub struct Order {\n    pub items: Vec&lt;Item&gt;,\n    pub customer: Customer,\n}\n\n/// \u4f1a\u54e1\u7a2e\u5225\u306b\u5fdc\u3058\u305f\u5272\u5f15\u7387\u3092\u53d6\u5f97\u3059\u308b\npub fn membership_discount(membership: &amp;str) -&gt; f64 {\n    match membership {\n        \"gold\" =&gt; 0.1,\n        \"silver\" =&gt; 0.05,\n        \"bronze\" =&gt; 0.02,\n        _ =&gt; 0.0,\n    }\n}\n\nimpl Order {\n    /// \u6ce8\u6587\u306e\u5408\u8a08\u91d1\u984d\u3092\u8a08\u7b97\u3059\u308b\n    pub fn calculate_total(&amp;self) -&gt; i32 {\n        self.items.iter().map(|item| item.subtotal()).sum()\n    }\n\n    /// \u5272\u5f15\u5f8c\u306e\u91d1\u984d\u3092\u8a08\u7b97\u3059\u308b\n    pub fn apply_discount(&amp;self, total: i32) -&gt; f64 {\n        let discount_rate = membership_discount(&amp;self.customer.membership);\n        total as f64 * (1.0 - discount_rate)\n    }\n\n    /// \u6ce8\u6587\u3092\u51e6\u7406\u3057\u3001\u5272\u5f15\u5f8c\u306e\u5408\u8a08\u91d1\u984d\u3092\u8fd4\u3059\n    pub fn process(&amp;self) -&gt; f64 {\n        let total = self.calculate_total();\n        self.apply_discount(total)\n    }\n}\n</code></pre>"},{"location":"rust/01-immutability-and-data-transformation/#rust_1","title":"Rust \u306e\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u8a18\u6cd5","text":"<p>Rust \u3067\u306f\u30a4\u30c6\u30ec\u30fc\u30bf\u306e\u30e1\u30bd\u30c3\u30c9\u30c1\u30a7\u30fc\u30f3\u3067\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u8868\u73fe\u3057\u307e\u3059\uff1a</p> <pre><code>// \u30e1\u30bd\u30c3\u30c9\u30c1\u30a7\u30fc\u30f3\nself.items.iter().map(|item| item.subtotal()).sum()\n\n// \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\nmatch membership {\n    \"gold\" =&gt; 0.1,\n    \"silver\" =&gt; 0.05,\n    _ =&gt; 0.0,\n}\n\n// filter \u3068 map \u306e\u7d44\u307f\u5408\u308f\u305b\nitems\n    .iter()\n    .filter(|item| item.quantity &gt; 0)\n    .map(|item| item.subtotal())\n    .sum::&lt;i32&gt;()\n</code></pre>"},{"location":"rust/01-immutability-and-data-transformation/#4","title":"4. \u526f\u4f5c\u7528\u306e\u5206\u96e2","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u7d14\u7c8b\u95a2\u6570\u3068\u526f\u4f5c\u7528\u3092\u6301\u3064\u95a2\u6570\u3092\u660e\u78ba\u306b\u5206\u96e2\u3059\u308b\u3053\u3068\u304c\u91cd\u8981\u3067\u3059\u3002</p>"},{"location":"rust/01-immutability-and-data-transformation/#_5","title":"\u7d14\u7c8b\u95a2\u6570\u3068\u306f","text":"<ul> <li>\u540c\u3058\u5165\u529b\u306b\u5bfe\u3057\u3066\u5e38\u306b\u540c\u3058\u51fa\u529b\u3092\u8fd4\u3059</li> <li>\u5916\u90e8\u306e\u72b6\u614b\u3092\u5909\u66f4\u3057\u306a\u3044\uff08\u526f\u4f5c\u7528\u304c\u306a\u3044\uff09</li> </ul> <pre><code>/// \u7d14\u7c8b\u95a2\u6570\uff1a\u7a0e\u984d\u3092\u8a08\u7b97\u3059\u308b\npub fn pure_calculate_tax(amount: i32, tax_rate: f64) -&gt; f64 {\n    amount as f64 * tax_rate\n}\n\n// \u4f55\u5ea6\u547c\u3093\u3067\u3082\u540c\u3058\u7d50\u679c\npure_calculate_tax(1000, 0.1)  // =&gt; 100.0\npure_calculate_tax(1000, 0.1)  // =&gt; 100.0\n</code></pre>"},{"location":"rust/01-immutability-and-data-transformation/#_6","title":"\u526f\u4f5c\u7528\u306e\u5206\u96e2\u30d1\u30bf\u30fc\u30f3","text":"<p>\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\uff08\u7d14\u7c8b\u95a2\u6570\uff09\u3068\u526f\u4f5c\u7528\uff08I/O\uff09\u3092\u5206\u96e2\u3057\u307e\u3059\uff1a</p> <pre><code>#[derive(Debug, Clone, PartialEq)]\npub struct Invoice {\n    pub subtotal: i32,\n    pub tax: f64,\n    pub total: f64,\n}\n\n/// \u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\uff08\u7d14\u7c8b\u95a2\u6570\uff09\uff1a\u8acb\u6c42\u66f8\u3092\u8a08\u7b97\u3059\u308b\npub fn calculate_invoice(items: &amp;[Item], tax_rate: f64) -&gt; Invoice {\n    let subtotal: i32 = items.iter().map(|item| item.subtotal()).sum();\n    let tax = pure_calculate_tax(subtotal, tax_rate);\n    let total = subtotal as f64 + tax;\n    Invoice::new(subtotal, tax, total)\n}\n\n/// \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u306e\u4fdd\u5b58\uff08\u526f\u4f5c\u7528\uff09\npub fn save_invoice(invoice: Invoice) -&gt; Invoice {\n    println!(\"Saving invoice: {:?}\", invoice);\n    invoice\n}\n\n/// \u30e1\u30fc\u30eb\u9001\u4fe1\uff08\u526f\u4f5c\u7528\uff09\npub fn send_notification(invoice: Invoice, customer_email: &amp;str) -&gt; Invoice {\n    println!(\"Sending notification to: {}\", customer_email);\n    invoice\n}\n\n/// \u51e6\u7406\u5168\u4f53\u306e\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\npub fn process_and_save_invoice(items: &amp;[Item], tax_rate: f64, customer_email: &amp;str) -&gt; Invoice {\n    let invoice = calculate_invoice(items, tax_rate);\n    let saved = save_invoice(invoice);\n    send_notification(saved, customer_email)\n}\n</code></pre> <p>Rust \u3067\u306f\u526f\u4f5c\u7528\u3092\u6301\u3064\u95a2\u6570\u306b\u7279\u5225\u306a\u30b5\u30d5\u30a3\u30c3\u30af\u30b9\u3092\u4ed8\u3051\u308b\u6163\u4f8b\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u578b\u30b7\u30b0\u30cd\u30c1\u30e3\uff08<code>Result&lt;T, E&gt;</code> \u306a\u3069\uff09\u3084\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u660e\u793a\u3059\u308b\u3053\u3068\u304c\u63a8\u5968\u3055\u308c\u307e\u3059\u3002</p>"},{"location":"rust/01-immutability-and-data-transformation/#5-undoredo","title":"5. \u6c38\u7d9a\u7684\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u6d3b\u7528\uff1aUndo/Redo \u306e\u5b9f\u88c5","text":"<p>\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u6d3b\u7528\u3059\u308b\u3068\u3001\u5c65\u6b74\u7ba1\u7406\u304c\u975e\u5e38\u306b\u7c21\u5358\u306b\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p> <pre><code>/// \u5c65\u6b74\u3092\u4fdd\u6301\u3059\u308b\u30c7\u30fc\u30bf\u69cb\u9020\n#[derive(Debug, Clone, PartialEq)]\npub struct History&lt;T: Clone&gt; {\n    pub current: Option&lt;T&gt;,\n    pub past: Vec&lt;T&gt;,\n    pub future: Vec&lt;T&gt;,\n}\n\nimpl&lt;T: Clone&gt; History&lt;T&gt; {\n    /// \u7a7a\u306e\u5c65\u6b74\u3092\u4f5c\u6210\u3059\u308b\n    pub fn new() -&gt; Self {\n        History {\n            current: None,\n            past: Vec::new(),\n            future: Vec::new(),\n        }\n    }\n\n    /// \u65b0\u3057\u3044\u72b6\u614b\u3092\u5c65\u6b74\u306b\u30d7\u30c3\u30b7\u30e5\u3059\u308b\n    pub fn push_state(&amp;self, new_state: T) -&gt; Self {\n        let mut new_past = Vec::new();\n        if let Some(ref current) = self.current {\n            new_past.push(current.clone());\n        }\n        new_past.extend(self.past.clone());\n\n        History {\n            current: Some(new_state),\n            past: new_past,\n            future: Vec::new(),\n        }\n    }\n\n    /// \u76f4\u524d\u306e\u72b6\u614b\u306b\u623b\u3059\n    pub fn undo(&amp;self) -&gt; Self {\n        match self.past.first() {\n            None =&gt; self.clone(),\n            Some(previous) =&gt; {\n                let mut new_future = Vec::new();\n                if let Some(ref current) = self.current {\n                    new_future.push(current.clone());\n                }\n                new_future.extend(self.future.clone());\n\n                History {\n                    current: Some(previous.clone()),\n                    past: self.past[1..].to_vec(),\n                    future: new_future,\n                }\n            }\n        }\n    }\n\n    /// \u3084\u308a\u76f4\u3057\u64cd\u4f5c\n    pub fn redo(&amp;self) -&gt; Self {\n        match self.future.first() {\n            None =&gt; self.clone(),\n            Some(next_state) =&gt; {\n                let mut new_past = Vec::new();\n                if let Some(ref current) = self.current {\n                    new_past.push(current.clone());\n                }\n                new_past.extend(self.past.clone());\n\n                History {\n                    current: Some(next_state.clone()),\n                    past: new_past,\n                    future: self.future[1..].to_vec(),\n                }\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"rust/01-immutability-and-data-transformation/#_7","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>use std::collections::HashMap;\n\nlet history: History&lt;HashMap&lt;String, String&gt;&gt; = History::new();\nlet history = history.push_state(HashMap::from([(\"text\".to_string(), \"Hello\".to_string())]));\nlet history = history.push_state(HashMap::from([(\"text\".to_string(), \"Hello World\".to_string())]));\nlet history = history.push_state(HashMap::from([(\"text\".to_string(), \"Hello World!\".to_string())]));\n\n// history.current =&gt; Some({\"text\": \"Hello World!\"})\n\nlet after_undo = history.undo();\n// after_undo.current =&gt; Some({\"text\": \"Hello World\"})\n\nlet after_redo = after_undo.redo();\n// after_redo.current =&gt; Some({\"text\": \"Hello World!\"})\n</code></pre>"},{"location":"rust/01-immutability-and-data-transformation/#6-iterator","title":"6. Iterator \u306b\u3088\u308b\u52b9\u7387\u7684\u306a\u5909\u63db","text":"<p>\u8907\u6570\u306e\u5909\u63db\u3092\u884c\u3046\u5834\u5408\u3001Rust \u306e\u30a4\u30c6\u30ec\u30fc\u30bf\u306f\u9045\u5ef6\u8a55\u4fa1\u3055\u308c\u308b\u305f\u3081\u3001\u4e2d\u9593\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3057\u307e\u305b\u3093\u3002</p> <pre><code>#[derive(Debug, Clone, PartialEq)]\npub struct ProcessedItem {\n    pub name: String,\n    pub price: i32,\n    pub quantity: i32,\n    pub subtotal: i32,\n}\n\n/// \u8907\u6570\u306e\u5909\u63db\u3092\u5408\u6210\u3057\u305f\u51e6\u7406\npub fn process_items_efficiently(items: &amp;[Item]) -&gt; Vec&lt;ProcessedItem&gt; {\n    items\n        .iter()\n        .filter(|item| item.quantity &gt; 0)           // \u6570\u91cf\u304c0\u3088\u308a\u5927\u304d\u3044\u3082\u306e\u3092\u30d5\u30a3\u30eb\u30bf\n        .map(ProcessedItem::from_item)              // ProcessedItem \u306b\u5909\u63db\n        .filter(|item| item.subtotal &gt; 100)         // \u5c0f\u8a08\u304c100\u3088\u308a\u5927\u304d\u3044\u3082\u306e\u3092\u30d5\u30a3\u30eb\u30bf\n        .collect()                                  // Vec \u306b\u53ce\u96c6\n}\n</code></pre> <p>Rust \u30a4\u30c6\u30ec\u30fc\u30bf\u306e\u5229\u70b9\uff1a - \u9045\u5ef6\u8a55\u4fa1: <code>collect()</code> \u304c\u547c\u3070\u308c\u308b\u307e\u3067\u5b9f\u969b\u306e\u51e6\u7406\u306f\u884c\u308f\u308c\u306a\u3044 - \u4e2d\u9593\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u306a\u3057: \u5404\u8981\u7d20\u304c\u4e00\u5ea6\u306e\u30d1\u30b9\u3067\u51e6\u7406\u3055\u308c\u308b - \u30bc\u30ed\u30b3\u30b9\u30c8\u62bd\u8c61\u5316: \u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u306b\u6700\u9069\u5316\u3055\u308c\u3001\u624b\u66f8\u304d\u306e\u30eb\u30fc\u30d7\u3068\u540c\u7b49\u306e\u6027\u80fd</p>"},{"location":"rust/01-immutability-and-data-transformation/#_8","title":"\u9045\u5ef6\u8a55\u4fa1\u306e\u4f8b","text":"<pre><code>let numbers: Vec&lt;i32&gt; = (1..)           // \u7121\u9650\u30a4\u30c6\u30ec\u30fc\u30bf\n    .filter(|n| n % 2 == 0)              // \u5076\u6570\u3092\u30d5\u30a3\u30eb\u30bf\n    .take(10)                            // \u6700\u521d\u306e10\u500b\u3092\u53d6\u5f97\n    .collect();                          // Vec \u306b\u53ce\u96c6\n// =&gt; [2, 4, 6, 8, 10, 12, 14, 16, 18, 20]\n</code></pre>"},{"location":"rust/01-immutability-and-data-transformation/#_9","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u57fa\u790e\u3067\u3042\u308b\u4e0d\u5909\u6027\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020: Rust \u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u4e0d\u5909\u6027\u3068 <code>Clone</code> \u306b\u3088\u308b\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u306e\u4f5c\u6210</li> <li>\u69cb\u9020\u5171\u6709: \u52b9\u7387\u7684\u306a\u30e1\u30e2\u30ea\u4f7f\u7528\u3092\u5b9f\u73fe\u3059\u308b <code>Clone</code> \u30c8\u30ec\u30a4\u30c8</li> <li>\u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3: \u30a4\u30c6\u30ec\u30fc\u30bf\u306e\u30e1\u30bd\u30c3\u30c9\u30c1\u30a7\u30fc\u30f3\u306b\u3088\u308b\u8aad\u307f\u3084\u3059\u3044\u5909\u63db\u51e6\u7406</li> <li>\u526f\u4f5c\u7528\u306e\u5206\u96e2: \u7d14\u7c8b\u95a2\u6570\u3068 I/O \u51e6\u7406\u306e\u660e\u78ba\u306a\u5206\u96e2</li> <li>\u5c65\u6b74\u7ba1\u7406: \u4e0d\u5909\u6027\u3092\u6d3b\u7528\u3057\u305f Undo/Redo \u306e\u7c21\u6f54\u306a\u5b9f\u88c5</li> <li>Iterator: \u9045\u5ef6\u8a55\u4fa1\u306b\u3088\u308b\u52b9\u7387\u7684\u306a\u8907\u5408\u5909\u63db</li> </ol> <p>\u3053\u308c\u3089\u306e\u6982\u5ff5\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u4ed6\u306e\u3059\u3079\u3066\u306e\u30d1\u30bf\u30fc\u30f3\u306e\u57fa\u76e4\u3068\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"rust/01-immutability-and-data-transformation/#_10","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/rust/part1/src/chapter01.rs</code></li> </ul>"},{"location":"rust/01-immutability-and-data-transformation/#_11","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001\u95a2\u6570\u5408\u6210\u3068\u9ad8\u968e\u95a2\u6570\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u5c0f\u3055\u306a\u95a2\u6570\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u8907\u96d1\u306a\u51e6\u7406\u3092\u69cb\u7bc9\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"rust/02-function-composition/","title":"\u7b2c2\u7ae0: \u95a2\u6570\u5408\u6210\u3068\u9ad8\u968e\u95a2\u6570","text":""},{"location":"rust/02-function-composition/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u771f\u9ac4\u306f\u3001\u5c0f\u3055\u306a\u95a2\u6570\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u8907\u96d1\u306a\u51e6\u7406\u3092\u69cb\u7bc9\u3059\u308b\u3053\u3068\u306b\u3042\u308a\u307e\u3059\u3002\u672c\u7ae0\u3067\u306f\u3001Rust \u306b\u304a\u3051\u308b\u95a2\u6570\u5408\u6210\u306e\u30c6\u30af\u30cb\u30c3\u30af\u3068\u9ad8\u968e\u95a2\u6570\u306e\u6d3b\u7528\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"rust/02-function-composition/#1","title":"1. \u95a2\u6570\u5408\u6210\u306e\u57fa\u672c","text":""},{"location":"rust/02-function-composition/#_2","title":"\u30af\u30ed\u30fc\u30b8\u30e3\u306b\u3088\u308b\u95a2\u6570\u306e\u9023\u7d50","text":"<p>Rust \u3067\u306f\u30af\u30ed\u30fc\u30b8\u30e3\u3092\u8fd4\u3059\u95a2\u6570\u3092\u4f7f\u7528\u3057\u3066\u95a2\u6570\u3092\u5408\u6210\u3067\u304d\u307e\u3059\u3002</p> <pre><code>/// \u7a0e\u91d1\u3092\u8ffd\u52a0\u3059\u308b\npub fn add_tax(rate: f64) -&gt; impl Fn(f64) -&gt; f64 {\n    move |amount| amount * (1.0 + rate)\n}\n\n/// \u5272\u5f15\u3092\u9069\u7528\u3059\u308b\npub fn apply_discount_rate(rate: f64) -&gt; impl Fn(f64) -&gt; f64 {\n    move |amount| amount * (1.0 - rate)\n}\n\n/// \u5186\u5358\u4f4d\u306b\u4e38\u3081\u308b\npub fn round_to_yen(amount: f64) -&gt; i64 {\n    amount.round() as i64\n}\n\n/// \u6700\u7d42\u4fa1\u683c\u3092\u8a08\u7b97\u3059\u308b\uff08\u95a2\u6570\u5408\u6210\uff09\npub fn calculate_final_price(amount: f64) -&gt; i64 {\n    let discounted = apply_discount_rate(0.2)(amount);\n    let with_tax = add_tax(0.1)(discounted);\n    round_to_yen(with_tax)\n}\n\n// \u4f7f\u7528\u4f8b\ncalculate_final_price(1000.0)\n// =&gt; 880\n// \u51e6\u7406\u9806\u5e8f: 1000 \u2192 20%\u5272\u5f15(800) \u2192 10%\u7a0e\u8fbc(880) \u2192 \u4e38\u3081(880)\n</code></pre>"},{"location":"rust/02-function-composition/#compose","title":"compose \u30d8\u30eb\u30d1\u30fc\u95a2\u6570","text":"<p>2\u3064\u306e\u95a2\u6570\u3092\u5408\u6210\u3059\u308b\u30d8\u30eb\u30d1\u30fc\u95a2\u6570\u3092\u4f5c\u6210\u3067\u304d\u307e\u3059\uff1a</p> <pre><code>/// \u95a2\u6570\u3092\u5408\u6210\u3059\u308b\u30d8\u30eb\u30d1\u30fc\npub fn compose&lt;A, B, C, F, G&gt;(f: F, g: G) -&gt; impl Fn(A) -&gt; C\nwhere\n    F: Fn(A) -&gt; B,\n    G: Fn(B) -&gt; C,\n{\n    move |x| g(f(x))\n}\n</code></pre>"},{"location":"rust/02-function-composition/#_3","title":"\u95a2\u6570\u5408\u6210\u306e\u5229\u70b9","text":"<ol> <li>\u5ba3\u8a00\u7684\u306a\u8a18\u8ff0: \u51e6\u7406\u306e\u6d41\u308c\u3092\u95a2\u6570\u306e\u30c1\u30a7\u30fc\u30f3\u3068\u3057\u3066\u8868\u73fe</li> <li>\u518d\u5229\u7528\u6027: \u5408\u6210\u3057\u305f\u95a2\u6570\u3092\u5225\u306e\u5834\u6240\u3067\u518d\u5229\u7528\u53ef\u80fd</li> <li>\u30c6\u30b9\u30c8\u5bb9\u6613\u6027: \u5404\u95a2\u6570\u3092\u500b\u5225\u306b\u30c6\u30b9\u30c8\u53ef\u80fd</li> </ol>"},{"location":"rust/02-function-composition/#2_1","title":"2. \u30ab\u30ea\u30fc\u5316\u3068\u90e8\u5206\u9069\u7528","text":""},{"location":"rust/02-function-composition/#_4","title":"\u30ab\u30ea\u30fc\u5316\u306b\u3088\u308b\u5f15\u6570\u306e\u56fa\u5b9a","text":"<p>Rust \u3067\u306f\u30af\u30ed\u30fc\u30b8\u30e3\u3092\u8fd4\u3059\u95a2\u6570\u3067\u30ab\u30ea\u30fc\u5316\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p> <pre><code>/// \u6328\u62f6\u3059\u308b\uff08\u30ab\u30ea\u30fc\u5316\u7248\uff09\npub fn greet_curried(greeting: &amp;str) -&gt; impl Fn(&amp;str) -&gt; String + '_ {\n    move |name| format!(\"{}, {}!\", greeting, name)\n}\n\npub fn say_hello(name: &amp;str) -&gt; String {\n    greet_curried(\"Hello\")(name)\n}\n\npub fn say_goodbye(name: &amp;str) -&gt; String {\n    greet_curried(\"Goodbye\")(name)\n}\n\nsay_hello(\"\u7530\u4e2d\")    // =&gt; \"Hello, \u7530\u4e2d!\"\nsay_goodbye(\"\u9234\u6728\")  // =&gt; \"Goodbye, \u9234\u6728!\"\n</code></pre>"},{"location":"rust/02-function-composition/#_5","title":"\u8907\u6570\u5f15\u6570\u306e\u90e8\u5206\u9069\u7528","text":"<pre><code>#[derive(Debug, Clone, PartialEq)]\npub struct Email {\n    pub from: String,\n    pub to: String,\n    pub subject: String,\n    pub body: String,\n}\n\n/// \u30e1\u30fc\u30eb\u9001\u4fe1\u95a2\u6570\uff08\u30ab\u30ea\u30fc\u5316\uff09\npub fn send_email(from: &amp;str) -&gt; impl Fn(&amp;str) -&gt; Box&lt;dyn Fn(&amp;str) -&gt; Box&lt;dyn Fn(&amp;str) -&gt; Email&gt;&gt; + '_ {\n    let from = from.to_string();\n    move |to: &amp;str| {\n        let from = from.clone();\n        let to = to.to_string();\n        Box::new(move |subject: &amp;str| {\n            let from = from.clone();\n            let to = to.clone();\n            let subject = subject.to_string();\n            Box::new(move |body: &amp;str| Email::new(&amp;from, &amp;to, &amp;subject, body))\n        })\n    }\n}\n\n// \u4f7f\u7528\u4f8b\nlet send_from_system = send_email(\"system@example.com\");\nlet send_to_user = send_from_system(\"user@example.com\");\nlet send_notification = send_to_user(\"\u901a\u77e5\");\nlet email = send_notification(\"\u30e1\u30c3\u30bb\u30fc\u30b8\u672c\u6587\");\n</code></pre>"},{"location":"rust/02-function-composition/#3","title":"3. \u8907\u6570\u306e\u95a2\u6570\u3092\u4e26\u5217\u9069\u7528","text":"<p>Clojure \u306e <code>juxt</code> \u306b\u76f8\u5f53\u3059\u308b\u6a5f\u80fd\u306f\u3001Rust \u3067\u306f\u30bf\u30d7\u30eb\u3084\u69cb\u9020\u4f53\u3092\u4f7f\u3063\u3066\u8868\u73fe\u3057\u307e\u3059\u3002</p> <pre><code>/// \u6570\u5024\u30ea\u30b9\u30c8\u306e\u7d71\u8a08\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\npub fn get_stats(numbers: &amp;[i32]) -&gt; (i32, i32, usize, i32, i32) {\n    (\n        *numbers.first().unwrap_or(&amp;0),\n        *numbers.last().unwrap_or(&amp;0),\n        numbers.len(),\n        *numbers.iter().min().unwrap_or(&amp;0),\n        *numbers.iter().max().unwrap_or(&amp;0),\n    )\n}\n\nget_stats(&amp;[3, 1, 4, 1, 5, 9, 2, 6])\n// =&gt; (3, 6, 8, 1, 9)\n// (\u6700\u521d\u306e\u5024, \u6700\u5f8c\u306e\u5024, \u8981\u7d20\u6570, \u6700\u5c0f\u5024, \u6700\u5927\u5024)\n</code></pre>"},{"location":"rust/02-function-composition/#_6","title":"\u5b9f\u7528\u4f8b\uff1a\u30c7\u30fc\u30bf\u5206\u6790","text":"<pre><code>#[derive(Debug, Clone, PartialEq)]\npub struct PersonAnalysis {\n    pub name: String,\n    pub age: i32,\n    pub category: String,\n}\n\npub fn analyze_person(name: &amp;str, age: i32) -&gt; PersonAnalysis {\n    let category = if age &gt;= 18 { \"adult\" } else { \"minor\" };\n    PersonAnalysis {\n        name: name.to_string(),\n        age,\n        category: category.to_string(),\n    }\n}\n\nanalyze_person(\"\u7530\u4e2d\", 25)\n// =&gt; PersonAnalysis { name: \"\u7530\u4e2d\", age: 25, category: \"adult\" }\n</code></pre>"},{"location":"rust/02-function-composition/#4","title":"4. \u9ad8\u968e\u95a2\u6570\u306b\u3088\u308b\u30c7\u30fc\u30bf\u51e6\u7406","text":"<p>\u9ad8\u968e\u95a2\u6570\u3068\u306f\u3001\u95a2\u6570\u3092\u5f15\u6570\u3068\u3057\u3066\u53d7\u3051\u53d6\u308b\u304b\u3001\u95a2\u6570\u3092\u8fd4\u3059\u95a2\u6570\u306e\u3053\u3068\u3067\u3059\u3002</p>"},{"location":"rust/02-function-composition/#_7","title":"\u30ed\u30b0\u51fa\u529b\u306e\u30e9\u30c3\u30d1\u30fc","text":"<pre><code>pub fn process_with_logging&lt;A: std::fmt::Debug, B: std::fmt::Debug&gt;(\n    f: impl Fn(A) -&gt; B,\n) -&gt; impl Fn(A) -&gt; B {\n    move |input| {\n        println!(\"\u5165\u529b: {:?}\", input);\n        let result = f(input);\n        println!(\"\u51fa\u529b: {:?}\", result);\n        result\n    }\n}\n\nlet double_with_log = process_with_logging(|x: i32| x * 2);\ndouble_with_log(5)\n// \u5165\u529b: 5\n// \u51fa\u529b: 10\n// =&gt; 10\n</code></pre>"},{"location":"rust/02-function-composition/#_8","title":"\u30ea\u30c8\u30e9\u30a4\u6a5f\u80fd\u306e\u8ffd\u52a0","text":"<pre><code>pub fn retry&lt;A: Clone, B, E, F&gt;(f: F, max_retries: u32) -&gt; impl Fn(A) -&gt; Result&lt;B, E&gt;\nwhere\n    F: Fn(A) -&gt; Result&lt;B, E&gt;,\n{\n    move |input: A| {\n        let mut attempts = 0;\n        loop {\n            match f(input.clone()) {\n                Ok(result) =&gt; return Ok(result),\n                Err(e) =&gt; {\n                    if attempts &lt; max_retries {\n                        attempts += 1;\n                    } else {\n                        return Err(e);\n                    }\n                }\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"rust/02-function-composition/#ttl","title":"TTL \u4ed8\u304d\u30e1\u30e2\u5316","text":"<pre><code>use std::cell::RefCell;\nuse std::collections::HashMap;\nuse std::hash::Hash;\nuse std::time::{Duration, Instant};\n\npub fn memoize_with_ttl&lt;A, B, F&gt;(f: F, ttl: Duration) -&gt; impl Fn(A) -&gt; B\nwhere\n    A: Eq + Hash + Clone,\n    B: Clone,\n    F: Fn(A) -&gt; B,\n{\n    let cache: RefCell&lt;HashMap&lt;A, (B, Instant)&gt;&gt; = RefCell::new(HashMap::new());\n\n    move |input: A| {\n        let now = Instant::now();\n        let mut cache_ref = cache.borrow_mut();\n\n        if let Some((value, time)) = cache_ref.get(&amp;input) {\n            if now.duration_since(*time) &lt; ttl {\n                return value.clone();\n            }\n        }\n\n        let result = f(input.clone());\n        cache_ref.insert(input, (result.clone(), now));\n        result\n    }\n}\n</code></pre>"},{"location":"rust/02-function-composition/#5","title":"5. \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u51e6\u7406","text":"<p>\u8907\u6570\u306e\u95a2\u6570\u3092\u9806\u6b21\u9069\u7528\u3059\u308b\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002</p> <pre><code>#[derive(Debug, Clone, PartialEq)]\npub struct Order {\n    pub items: Vec&lt;OrderItem&gt;,\n    pub customer: OrderCustomer,\n    pub total: f64,\n    pub shipping: i32,\n}\n\npub fn validate_order(order: Order) -&gt; Result&lt;Order, String&gt; {\n    if order.items.is_empty() {\n        Err(\"\u6ce8\u6587\u306b\u30a2\u30a4\u30c6\u30e0\u304c\u3042\u308a\u307e\u305b\u3093\".to_string())\n    } else {\n        Ok(order)\n    }\n}\n\npub fn calculate_order_total(mut order: Order) -&gt; Order {\n    let total: i32 = order.items.iter()\n        .map(|item| item.price * item.quantity)\n        .sum();\n    order.total = total as f64;\n    order\n}\n\npub fn apply_order_discount(mut order: Order) -&gt; Order {\n    let discount_rate = match order.customer.membership.as_str() {\n        \"gold\" =&gt; 0.1,\n        \"silver\" =&gt; 0.05,\n        \"bronze\" =&gt; 0.02,\n        _ =&gt; 0.0,\n    };\n    order.total *= 1.0 - discount_rate;\n    order\n}\n\npub fn add_shipping(mut order: Order) -&gt; Order {\n    let shipping = if order.total &gt;= 5000.0 { 0 } else { 500 };\n    order.shipping = shipping;\n    order.total += shipping as f64;\n    order\n}\n\n/// \u6ce8\u6587\u51e6\u7406\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\npub fn process_order_pipeline(order: Order) -&gt; Result&lt;Order, String&gt; {\n    validate_order(order).map(|o| {\n        let o = calculate_order_total(o);\n        let o = apply_order_discount(o);\n        add_shipping(o)\n    })\n}\n</code></pre>"},{"location":"rust/02-function-composition/#6","title":"6. \u95a2\u6570\u5408\u6210\u306b\u3088\u308b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3","text":"<p>\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30ed\u30b8\u30c3\u30af\u3092\u95a2\u6570\u5408\u6210\u3067\u8868\u73fe\u3057\u307e\u3059\u3002</p> <pre><code>#[derive(Debug, Clone, PartialEq)]\npub struct ValidationResult&lt;T&gt; {\n    pub valid: bool,\n    pub value: T,\n    pub error: Option&lt;String&gt;,\n}\n\npub fn validator&lt;T: Clone&gt;(\n    pred: impl Fn(&amp;T) -&gt; bool + 'static,\n    error_msg: &amp;str,\n) -&gt; Box&lt;dyn Fn(T) -&gt; ValidationResult&lt;T&gt;&gt; {\n    let error_msg = error_msg.to_string();\n    Box::new(move |value: T| {\n        if pred(&amp;value) {\n            ValidationResult::ok(value)\n        } else {\n            ValidationResult::err(value, &amp;error_msg)\n        }\n    })\n}\n\npub fn combine_validators&lt;T: Clone + 'static&gt;(\n    validators: Vec&lt;Box&lt;dyn Fn(T) -&gt; ValidationResult&lt;T&gt;&gt;&gt;,\n) -&gt; Box&lt;dyn Fn(T) -&gt; ValidationResult&lt;T&gt;&gt; {\n    Box::new(move |value: T| {\n        validators.iter().fold(ValidationResult::ok(value), |result, v| {\n            if result.valid { v(result.value) } else { result }\n        })\n    })\n}\n\n// \u4f7f\u7528\u4f8b\nlet validate_positive = validator(|&amp;x: &amp;i32| x &gt; 0, \"\u5024\u306f\u6b63\u306e\u6570\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\");\nlet validate_under_100 = validator(|&amp;x: &amp;i32| x &lt; 100, \"\u5024\u306f100\u672a\u6e80\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\");\n\nvalidate_quantity(50)   // =&gt; ValidationResult { valid: true, value: 50, error: None }\nvalidate_quantity(-1)   // =&gt; ValidationResult { valid: false, value: -1, error: Some(\"\u5024\u306f\u6b63\u306e\u6570\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\") }\n</code></pre>"},{"location":"rust/02-function-composition/#7","title":"7. \u95a2\u6570\u306e\u5909\u63db","text":"<p>\u95a2\u6570\u81ea\u4f53\u3092\u5909\u63db\u3059\u308b\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u95a2\u6570\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002</p>"},{"location":"rust/02-function-composition/#_9","title":"\u5f15\u6570\u306e\u9806\u5e8f\u3092\u53cd\u8ee2","text":"<pre><code>pub fn flip&lt;A, B, C, F&gt;(f: F) -&gt; impl Fn(B, A) -&gt; C\nwhere\n    F: Fn(A, B) -&gt; C,\n{\n    move |b, a| f(a, b)\n}\n\nlet subtract = |a: i32, b: i32| a - b;\nflip(subtract)(3, 5)  // =&gt; 2  (5 - 3)\n</code></pre>"},{"location":"rust/02-function-composition/#complement","title":"\u88dc\u95a2\u6570\uff08complement\uff09","text":"<pre><code>pub fn complement&lt;A, F&gt;(pred: F) -&gt; impl Fn(A) -&gt; bool\nwhere\n    F: Fn(A) -&gt; bool,\n{\n    move |a| !pred(a)\n}\n\nlet is_even = |x: i32| x % 2 == 0;\nlet is_odd = complement(is_even);\nis_odd(3)  // =&gt; true\n</code></pre>"},{"location":"rust/02-function-composition/#_10","title":"\u30ab\u30ea\u30fc\u5316","text":"<pre><code>pub fn curry&lt;A: Clone + 'static, B: 'static, C: 'static, F: Fn(A, B) -&gt; C + Clone + 'static&gt;(\n    f: F,\n) -&gt; impl Fn(A) -&gt; Box&lt;dyn Fn(B) -&gt; C&gt; {\n    move |a: A| {\n        let f = f.clone();\n        let a = a.clone();\n        Box::new(move |b: B| f(a.clone(), b))\n    }\n}\n\nlet add = |a: i32, b: i32| a + b;\nlet curried_add = curry(add);\nlet add_5 = curried_add(5);\nadd_5(3)  // =&gt; 8\n</code></pre>"},{"location":"rust/02-function-composition/#8","title":"8. \u95a2\u6570\u5408\u6210\u306e\u30d1\u30bf\u30fc\u30f3","text":""},{"location":"rust/02-function-composition/#_11","title":"\u8ff0\u8a9e\u306e\u5408\u6210","text":"<pre><code>pub fn compose_predicates&lt;T: Clone&gt;(preds: Vec&lt;Box&lt;dyn Fn(&amp;T) -&gt; bool&gt;&gt;) -&gt; impl Fn(&amp;T) -&gt; bool {\n    move |x| preds.iter().all(|p| p(x))\n}\n\npub fn compose_predicates_or&lt;T: Clone&gt;(preds: Vec&lt;Box&lt;dyn Fn(&amp;T) -&gt; bool&gt;&gt;) -&gt; impl Fn(&amp;T) -&gt; bool {\n    move |x| preds.iter().any(|p| p(x))\n}\n\n// \u6709\u52b9\u306a\u5e74\u9f62\u30c1\u30a7\u30c3\u30af\npub fn valid_age(age: &amp;i32) -&gt; bool {\n    let preds: Vec&lt;Box&lt;dyn Fn(&amp;i32) -&gt; bool&gt;&gt; = vec![\n        Box::new(|&amp;x| x &gt; 0),\n        Box::new(|&amp;x| x &lt;= 150),\n    ];\n    compose_predicates(preds)(age)\n}\n\nvalid_age(&amp;25)   // =&gt; true\nvalid_age(&amp;-1)   // =&gt; false\nvalid_age(&amp;200)  // =&gt; false\n\n// \u30d7\u30ec\u30df\u30a2\u30e0\u9867\u5ba2\u30c1\u30a7\u30c3\u30af\npub fn premium_customer(customer: &amp;CustomerInfo) -&gt; bool {\n    let preds: Vec&lt;Box&lt;dyn Fn(&amp;CustomerInfo) -&gt; bool&gt;&gt; = vec![\n        Box::new(|c| c.membership == \"gold\"),\n        Box::new(|c| c.purchase_count &gt;= 100),\n        Box::new(|c| c.total_spent &gt;= 100000),\n    ];\n    compose_predicates_or(preds)(customer)\n}\n\npremium_customer(&amp;CustomerInfo::new(\"gold\", 0, 0))           // =&gt; true\npremium_customer(&amp;CustomerInfo::new(\"bronze\", 100, 0))       // =&gt; true\npremium_customer(&amp;CustomerInfo::new(\"bronze\", 10, 1000))     // =&gt; false\n</code></pre>"},{"location":"rust/02-function-composition/#_12","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u95a2\u6570\u5408\u6210\u3068\u9ad8\u968e\u95a2\u6570\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30af\u30ed\u30fc\u30b8\u30e3\u306b\u3088\u308b\u5408\u6210: \u30af\u30ed\u30fc\u30b8\u30e3\u3092\u8fd4\u3059\u95a2\u6570\u3067\u95a2\u6570\u3092\u5408\u6210</li> <li>\u30ab\u30ea\u30fc\u5316: \u5f15\u6570\u3092\u90e8\u5206\u9069\u7528\u3057\u3066\u7279\u5316\u3057\u305f\u95a2\u6570\u3092\u4f5c\u6210</li> <li>\u30bf\u30d7\u30eb/\u69cb\u9020\u4f53: \u8907\u6570\u306e\u95a2\u6570\u3092\u4e26\u5217\u9069\u7528\u3057\u3066\u7d50\u679c\u3092\u53d6\u5f97</li> <li>\u9ad8\u968e\u95a2\u6570: \u30ed\u30b0\u3001\u30ea\u30c8\u30e9\u30a4\u3001\u30e1\u30e2\u5316\u306a\u3069\u306e\u6a2a\u65ad\u7684\u95a2\u5fc3\u4e8b\u3092\u62bd\u8c61\u5316</li> <li>\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3: \u51e6\u7406\u306e\u6d41\u308c\u3092\u95a2\u6570\u306e\u30c1\u30a7\u30fc\u30f3\u3068\u3057\u3066\u8868\u73fe</li> <li>\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3: \u95a2\u6570\u5408\u6210\u306b\u3088\u308b\u67d4\u8edf\u306a\u691c\u8a3c\u30ed\u30b8\u30c3\u30af</li> <li>\u8ff0\u8a9e\u5408\u6210: AND/OR \u3067\u8907\u6570\u306e\u6761\u4ef6\u3092\u7d44\u307f\u5408\u308f\u305b</li> </ol> <p>\u3053\u308c\u3089\u306e\u30c6\u30af\u30cb\u30c3\u30af\u306b\u3088\u308a\u3001\u5c0f\u3055\u304f\u518d\u5229\u7528\u53ef\u80fd\u306a\u95a2\u6570\u304b\u3089\u8907\u96d1\u306a\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u3092\u69cb\u7bc9\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"rust/02-function-composition/#_13","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/rust/part1/src/chapter02.rs</code></li> </ul>"},{"location":"rust/02-function-composition/#_14","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001\u591a\u614b\u6027\u3068\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002trait\u3001enum\u3001\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3092\u6d3b\u7528\u3057\u305f\u67d4\u8edf\u306a\u8a2d\u8a08\u30d1\u30bf\u30fc\u30f3\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"rust/03-polymorphism/","title":"\u7b2c3\u7ae0: \u591a\u614b\u6027\u3068\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1","text":""},{"location":"rust/03-polymorphism/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u591a\u614b\u6027\uff08\u30dd\u30ea\u30e2\u30fc\u30d5\u30a3\u30ba\u30e0\uff09\u306f\u3001\u540c\u3058\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u7570\u306a\u308b\u632f\u308b\u821e\u3044\u3092\u5b9f\u73fe\u3059\u308b\u5f37\u529b\u306a\u6982\u5ff5\u3067\u3059\u3002Rust \u3067\u306f\u3001enum\u3001trait\u3001\u30b8\u30a7\u30cd\u30ea\u30af\u30b9\u3068\u3044\u3046\u8907\u6570\u306e\u30e1\u30ab\u30cb\u30ba\u30e0\u3067\u591a\u614b\u6027\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u3053\u308c\u3089\u306e\u30e1\u30ab\u30cb\u30ba\u30e0\u3092\u4f7f\u3044\u5206\u3051\u3066\u3001\u67d4\u8edf\u3067\u62e1\u5f35\u6027\u306e\u9ad8\u3044\u30b3\u30fc\u30c9\u3092\u66f8\u304f\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"rust/03-polymorphism/#1-enum","title":"1. Enum \u306b\u3088\u308b\u591a\u614b\u6027\uff08\u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b\uff09","text":"<p>Rust \u306e <code>enum</code> \u306f\u3001\u6709\u9650\u306e\u578b\u306e\u30d0\u30ea\u30a8\u30fc\u30b7\u30e7\u30f3\u3092\u5b9a\u7fa9\u3059\u308b\u306e\u306b\u6700\u9069\u3067\u3059\u3002\u30b3\u30f3\u30d1\u30a4\u30e9\u304c\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u306e\u7db2\u7f85\u6027\u3092\u30c1\u30a7\u30c3\u30af\u3057\u3066\u304f\u308c\u307e\u3059\u3002</p>"},{"location":"rust/03-polymorphism/#_2","title":"\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9","text":"<pre><code>/// \u56f3\u5f62\u3092\u8868\u3059 enum\n#[derive(Debug, Clone, PartialEq)]\npub enum Shape {\n    Rectangle { width: f64, height: f64 },\n    Circle { radius: f64 },\n    Triangle { base: f64, height: f64 },\n}\n\nimpl Shape {\n    /// \u56f3\u5f62\u306e\u9762\u7a4d\u3092\u8a08\u7b97\u3059\u308b\n    pub fn area(&amp;self) -&gt; f64 {\n        match self {\n            Shape::Rectangle { width, height } =&gt; width * height,\n            Shape::Circle { radius } =&gt; std::f64::consts::PI * radius * radius,\n            Shape::Triangle { base, height } =&gt; base * height / 2.0,\n        }\n    }\n}\n\n// \u4f7f\u7528\u4f8b\nlet rect = Shape::Rectangle { width: 4.0, height: 5.0 };\nrect.area()  // =&gt; 20.0\n\nlet circle = Shape::Circle { radius: 3.0 };\ncircle.area()  // =&gt; 28.27...\n</code></pre>"},{"location":"rust/03-polymorphism/#enum","title":"Enum \u306e\u5229\u70b9","text":"<ol> <li>\u7db2\u7f85\u6027\u30c1\u30a7\u30c3\u30af: \u30b3\u30f3\u30d1\u30a4\u30e9\u304c\u3059\u3079\u3066\u306e\u30b1\u30fc\u30b9\u304c\u30ab\u30d0\u30fc\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d</li> <li>\u578b\u5b89\u5168\u6027: \u4e0d\u6b63\u306a\u578b\u306e\u5024\u3092\u6e21\u305b\u306a\u3044</li> <li>\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0: \u5206\u5c90\u3092\u7c21\u6f54\u306b\u8a18\u8ff0\u53ef\u80fd</li> </ol>"},{"location":"rust/03-polymorphism/#2","title":"2. \u8907\u5408\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1","text":"<p>\u30bf\u30d7\u30eb\u3092\u4f7f\u3063\u305f\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3067\u3001\u8907\u6570\u306e\u5024\u306b\u57fa\u3065\u304f\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u3092\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002</p> <pre><code>#[derive(Debug, Clone, PartialEq)]\npub enum PaymentMethod {\n    CreditCard,\n    BankTransfer,\n    Cash,\n}\n\n#[derive(Debug, Clone, PartialEq)]\npub enum Currency {\n    JPY,\n    USD,\n    EUR,\n}\n\nimpl Payment {\n    /// \u652f\u6255\u3044\u3092\u51e6\u7406\u3059\u308b\uff08\u8907\u5408\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\uff09\n    pub fn process(&amp;self) -&gt; PaymentResult {\n        match (&amp;self.method, &amp;self.currency) {\n            (PaymentMethod::CreditCard, Currency::JPY) =&gt; PaymentResult {\n                status: \"processed\".to_string(),\n                message: \"\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\uff08\u5186\uff09\u3067\u51e6\u7406\u3057\u307e\u3057\u305f\".to_string(),\n                amount: self.amount,\n                converted: None,\n            },\n            (PaymentMethod::CreditCard, Currency::USD) =&gt; PaymentResult {\n                status: \"processed\".to_string(),\n                message: \"Credit card (USD) processed\".to_string(),\n                amount: self.amount,\n                converted: Some(self.amount * 150),\n            },\n            (PaymentMethod::BankTransfer, Currency::JPY) =&gt; PaymentResult {\n                status: \"pending\".to_string(),\n                message: \"\u9280\u884c\u632f\u8fbc\u3092\u53d7\u3051\u4ed8\u3051\u307e\u3057\u305f\".to_string(),\n                amount: self.amount,\n                converted: None,\n            },\n            _ =&gt; PaymentResult {\n                status: \"error\".to_string(),\n                message: \"\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u652f\u6255\u3044\u65b9\u6cd5\u3067\u3059\".to_string(),\n                amount: self.amount,\n                converted: None,\n            },\n        }\n    }\n}\n</code></pre>"},{"location":"rust/03-polymorphism/#3-trait","title":"3. Trait \u306b\u3088\u308b\u968e\u5c64\u7684\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1","text":"<p>Rust \u3067\u306f trait \u3092\u4f7f\u3063\u3066\u578b\u306e\u5171\u901a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u5b9a\u7fa9\u3057\u3001\u5404\u578b\u306b\u56fa\u6709\u306e\u632f\u308b\u821e\u3044\u3092\u6301\u305f\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</p> <pre><code>/// \u53e3\u5ea7\u306e\u5171\u901a\u30c8\u30ec\u30a4\u30c8\npub trait Account {\n    fn balance(&amp;self) -&gt; i32;\n    fn interest_rate(&amp;self) -&gt; f64;\n\n    fn calculate_interest(&amp;self) -&gt; f64 {\n        self.balance() as f64 * self.interest_rate()\n    }\n}\n\n/// \u666e\u901a\u9810\u91d1\u53e3\u5ea7\n#[derive(Debug, Clone, PartialEq)]\npub struct SavingsAccount {\n    pub balance: i32,\n}\n\nimpl Account for SavingsAccount {\n    fn balance(&amp;self) -&gt; i32 { self.balance }\n    fn interest_rate(&amp;self) -&gt; f64 { 0.02 }\n}\n\n/// \u30d7\u30ec\u30df\u30a2\u30e0\u666e\u901a\u9810\u91d1\u53e3\u5ea7\n#[derive(Debug, Clone, PartialEq)]\npub struct PremiumSavingsAccount {\n    pub balance: i32,\n}\n\nimpl Account for PremiumSavingsAccount {\n    fn balance(&amp;self) -&gt; i32 { self.balance }\n    fn interest_rate(&amp;self) -&gt; f64 { 0.05 }\n}\n\n// \u4f7f\u7528\u4f8b\nlet savings = SavingsAccount { balance: 10000 };\nsavings.calculate_interest()  // =&gt; 200.0\n\nlet premium = PremiumSavingsAccount { balance: 10000 };\npremium.calculate_interest()  // =&gt; 500.0\n</code></pre>"},{"location":"rust/03-polymorphism/#4-traitprotocol","title":"4. Trait\uff08Protocol \u306b\u76f8\u5f53\uff09","text":"<p>Trait \u306f\u3001\u7279\u5b9a\u306e\u64cd\u4f5c\u30bb\u30c3\u30c8\u3092\u5b9a\u7fa9\u3059\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u3059\u3002</p>"},{"location":"rust/03-polymorphism/#trait","title":"Trait \u306e\u5b9a\u7fa9","text":"<pre><code>/// \u30d0\u30a6\u30f3\u30c7\u30a3\u30f3\u30b0\u30dc\u30c3\u30af\u30b9\n#[derive(Debug, Clone, PartialEq)]\npub struct BoundingBox {\n    pub x: f64,\n    pub y: f64,\n    pub width: f64,\n    pub height: f64,\n}\n\n/// \u63cf\u753b\u53ef\u80fd\u306a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30c8\u30ec\u30a4\u30c8\npub trait Drawable {\n    fn draw(&amp;self) -&gt; String;\n    fn bounding_box(&amp;self) -&gt; BoundingBox;\n}\n\n/// \u5909\u63db\u53ef\u80fd\u306a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30c8\u30ec\u30a4\u30c8\npub trait Transformable: Sized {\n    fn translate(&amp;self, dx: f64, dy: f64) -&gt; Self;\n    fn scale(&amp;self, factor: f64) -&gt; Self;\n    fn rotate(&amp;self, angle: f64) -&gt; Self;\n}\n</code></pre>"},{"location":"rust/03-polymorphism/#trait_1","title":"Trait \u306e\u5229\u70b9","text":"<ol> <li>\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9: \u9759\u7684\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u306b\u3088\u308b\u9ad8\u901f\u306a\u5b9f\u884c</li> <li>\u660e\u78ba\u306a\u30b3\u30f3\u30c8\u30e9\u30af\u30c8: \u5b9f\u88c5\u3059\u3079\u304d\u30e1\u30bd\u30c3\u30c9\u304c\u660e\u793a\u7684</li> <li>\u8907\u6570\u5b9f\u88c5: \u4e00\u3064\u306e\u578b\u304c\u8907\u6570\u306e trait \u3092\u5b9f\u88c5\u53ef\u80fd</li> </ol>"},{"location":"rust/03-polymorphism/#5-trait","title":"5. Trait \u3092\u5b9f\u88c5\u3059\u308b\u69cb\u9020\u4f53","text":"<pre><code>#[derive(Debug, Clone, PartialEq)]\npub struct DrawableRectangle {\n    pub x: f64,\n    pub y: f64,\n    pub width: f64,\n    pub height: f64,\n}\n\nimpl Drawable for DrawableRectangle {\n    fn draw(&amp;self) -&gt; String {\n        format!(\n            \"Rectangle at ({},{}) with size {}x{}\",\n            self.x, self.y, self.width, self.height\n        )\n    }\n\n    fn bounding_box(&amp;self) -&gt; BoundingBox {\n        BoundingBox {\n            x: self.x,\n            y: self.y,\n            width: self.width,\n            height: self.height,\n        }\n    }\n}\n\nimpl Transformable for DrawableRectangle {\n    fn translate(&amp;self, dx: f64, dy: f64) -&gt; Self {\n        DrawableRectangle {\n            x: self.x + dx,\n            y: self.y + dy,\n            ..*self\n        }\n    }\n\n    fn scale(&amp;self, factor: f64) -&gt; Self {\n        DrawableRectangle {\n            width: self.width * factor,\n            height: self.height * factor,\n            ..*self\n        }\n    }\n\n    fn rotate(&amp;self, _angle: f64) -&gt; Self {\n        self.clone()\n    }\n}\n\n// \u4f7f\u7528\u4f8b\nlet rect = DrawableRectangle::new(10.0, 20.0, 100.0, 50.0);\nrect.draw()           // =&gt; \"Rectangle at (10,20) with size 100x50\"\nrect.translate(5.0, 10.0)  // =&gt; DrawableRectangle { x: 15.0, y: 30.0, ... }\n</code></pre>"},{"location":"rust/03-polymorphism/#6-extension-trait","title":"6. \u65e2\u5b58\u578b\u3078\u306e\u62e1\u5f35\uff08Extension Trait\uff09","text":"<p>Rust \u3067\u306f\u65e2\u5b58\u306e\u578b\u306b\u5f8c\u304b\u3089\u632f\u308b\u821e\u3044\u3092\u8ffd\u52a0\u3067\u304d\u307e\u3059\u3002</p> <pre><code>/// \u6587\u5b57\u5217\u306b\u5909\u63db\u53ef\u80fd\u306a\u30c8\u30ec\u30a4\u30c8\npub trait Stringable {\n    fn to_custom_string(&amp;self) -&gt; String;\n}\n\nimpl&lt;T: std::fmt::Display&gt; Stringable for Vec&lt;T&gt; {\n    fn to_custom_string(&amp;self) -&gt; String {\n        let parts: Vec&lt;String&gt; = self.iter().map(|x| x.to_string()).collect();\n        format!(\"[{}]\", parts.join(\", \"))\n    }\n}\n\nimpl Stringable for i32 {\n    fn to_custom_string(&amp;self) -&gt; String {\n        self.to_string()\n    }\n}\n\nimpl&lt;T: Stringable&gt; Stringable for Option&lt;T&gt; {\n    fn to_custom_string(&amp;self) -&gt; String {\n        match self {\n            Some(v) =&gt; v.to_custom_string(),\n            None =&gt; \"nil\".to_string(),\n        }\n    }\n}\n\n// \u4f7f\u7528\u4f8b\nlet v = vec![1, 2, 3];\nv.to_custom_string()  // =&gt; \"[1, 2, 3]\"\n\nlet opt: Option&lt;i32&gt; = Some(42);\nopt.to_custom_string()  // =&gt; \"42\"\n\nlet none: Option&lt;i32&gt; = None;\nnone.to_custom_string()  // =&gt; \"nil\"\n</code></pre>"},{"location":"rust/03-polymorphism/#7","title":"7. \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u30d1\u30bf\u30fc\u30f3","text":"<p>Trait \u3092\u4f7f\u3063\u3066\u3001\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u7ba1\u7406\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p> <pre><code>/// \u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u7ba1\u7406\u30c8\u30ec\u30a4\u30c8\npub trait Lifecycle: Sized {\n    fn start(self) -&gt; Self;\n    fn stop(self) -&gt; Self;\n}\n\n#[derive(Debug, Clone, PartialEq)]\npub struct DatabaseConnection {\n    pub host: String,\n    pub port: u16,\n    pub connected: bool,\n}\n\nimpl Lifecycle for DatabaseConnection {\n    fn start(mut self) -&gt; Self {\n        println!(\"\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u63a5\u7d9a\u4e2d: {} : {}\", self.host, self.port);\n        self.connected = true;\n        self\n    }\n\n    fn stop(mut self) -&gt; Self {\n        println!(\"\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\u3092\u5207\u65ad\u4e2d\");\n        self.connected = false;\n        self\n    }\n}\n\n// \u4f7f\u7528\u4f8b\nlet db = DatabaseConnection::new(\"localhost\", 5432);\nlet db = db.start();   // \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u63a5\u7d9a\u4e2d\nlet db = db.stop();    // \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\u3092\u5207\u65ad\u4e2d\n</code></pre>"},{"location":"rust/03-polymorphism/#8-strategy","title":"8. \u6761\u4ef6\u5206\u5c90\u306e\u7f6e\u304d\u63db\u3048\uff08Strategy \u30d1\u30bf\u30fc\u30f3\uff09","text":"<p>\u591a\u614b\u6027\u3092\u4f7f\u3063\u3066\u3001switch/case \u6587\u306b\u3088\u308b\u578b\u5224\u5b9a\u3092\u6392\u9664\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"rust/03-polymorphism/#before","title":"Before\uff08\u6761\u4ef6\u5206\u5c90\uff09","text":"<pre><code>// \u60aa\u3044\u4f8b\uff1a\u578b\u306b\u3088\u308b\u6761\u4ef6\u5206\u5c90\nfn send_notification_bad(notification_type: &amp;str, message: &amp;str, to: &amp;str) -&gt; Result&lt;(), String&gt; {\n    match notification_type {\n        \"email\" =&gt; { /* \u30e1\u30fc\u30eb\u9001\u4fe1 */ Ok(()) }\n        \"sms\" =&gt; { /* SMS\u9001\u4fe1 */ Ok(()) }\n        \"push\" =&gt; { /* \u30d7\u30c3\u30b7\u30e5\u901a\u77e5 */ Ok(()) }\n        _ =&gt; Err(\"\u672a\u77e5\u306e\u901a\u77e5\u30bf\u30a4\u30d7\".to_string())\n    }\n}\n</code></pre>"},{"location":"rust/03-polymorphism/#after","title":"After\uff08\u591a\u614b\u6027\uff09","text":"<pre><code>/// \u901a\u77e5\u9001\u4fe1\u30c8\u30ec\u30a4\u30c8\npub trait NotificationSender {\n    fn send_notification(&amp;self, message: &amp;str) -&gt; NotificationResult;\n    fn delivery_time(&amp;self) -&gt; &amp;str;\n}\n\n#[derive(Debug, Clone, PartialEq)]\npub struct EmailNotification {\n    pub to: String,\n    pub subject: String,\n}\n\nimpl NotificationSender for EmailNotification {\n    fn send_notification(&amp;self, message: &amp;str) -&gt; NotificationResult {\n        NotificationResult {\n            notification_type: \"email\".to_string(),\n            to: self.to.clone(),\n            body: message.to_string(),\n            status: \"sent\".to_string(),\n            subject: Some(self.subject.clone()),\n        }\n    }\n\n    fn delivery_time(&amp;self) -&gt; &amp;str {\n        \"1-2\u5206\"\n    }\n}\n\n// \u30d5\u30a1\u30af\u30c8\u30ea\u95a2\u6570\npub fn create_notification(\n    notification_type: &amp;str,\n    to: &amp;str,\n    subject: Option&lt;&amp;str&gt;,\n) -&gt; Result&lt;Box&lt;dyn NotificationSender&gt;, String&gt; {\n    match notification_type {\n        \"email\" =&gt; Ok(Box::new(EmailNotification::new(to, subject.unwrap_or(\"\u901a\u77e5\")))),\n        \"sms\" =&gt; Ok(Box::new(SMSNotification::new(to))),\n        \"push\" =&gt; Ok(Box::new(PushNotification::new(to))),\n        _ =&gt; Err(format!(\"\u672a\u77e5\u306e\u901a\u77e5\u30bf\u30a4\u30d7: {}\", notification_type)),\n    }\n}\n\n// \u4f7f\u7528\u4f8b\nlet email = create_notification(\"email\", \"user@example.com\", Some(\"\u304a\u77e5\u3089\u305b\")).unwrap();\nemail.send_notification(\"\u91cd\u8981\u306a\u304a\u77e5\u3089\u305b\")\n</code></pre>"},{"location":"rust/03-polymorphism/#9-enumtrait","title":"9. Enum\u3001Trait\u3001\u30b8\u30a7\u30cd\u30ea\u30af\u30b9\u306e\u4f7f\u3044\u5206\u3051","text":"\u7279\u5fb4 Enum Trait \u30b8\u30a7\u30cd\u30ea\u30af\u30b9 \u30c7\u30a3\u30b9\u30d1\u30c3\u30c1 \u5024\u306b\u57fa\u3065\u304f \u578b\u306b\u57fa\u3065\u304f \u30b3\u30f3\u30d1\u30a4\u30eb\u6642 \u62e1\u5f35\u6027 \u30af\u30ed\u30fc\u30ba\u30c9 \u30aa\u30fc\u30d7\u30f3 \u30aa\u30fc\u30d7\u30f3 \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9 \u826f\u3044 \u826f\u3044\u301c\u6700\u826f \u6700\u826f \u7528\u9014 \u6709\u9650\u306e\u578b\u30d0\u30ea\u30a8\u30fc\u30b7\u30e7\u30f3 \u5171\u901a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9 \u6c4e\u7528\u7684\u306a\u51e6\u7406"},{"location":"rust/03-polymorphism/#_3","title":"\u4f7f\u3044\u5206\u3051\u306e\u6307\u91dd","text":"<ul> <li>Enum: \u6709\u9650\u3067\u56fa\u5b9a\u3055\u308c\u305f\u578b\u306e\u30d0\u30ea\u30a8\u30fc\u30b7\u30e7\u30f3\uff08Option\u3001Result \u306a\u3069\uff09</li> <li>Trait: \u65b0\u3057\u3044\u578b\u304c\u8ffd\u52a0\u3055\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u5834\u5408\u3001\u5171\u901a\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u304c\u5fc5\u8981\u306a\u5834\u5408</li> <li>Trait + dyn: \u5b9f\u884c\u6642\u306b\u7570\u306a\u308b\u578b\u3092\u6271\u3046\u5fc5\u8981\u304c\u3042\u308b\u5834\u5408\uff08\u52d5\u7684\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\uff09</li> <li>\u30b8\u30a7\u30cd\u30ea\u30af\u30b9 + Trait bounds: \u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u306b\u578b\u304c\u6c7a\u307e\u308a\u3001\u6700\u5927\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u304c\u5fc5\u8981\u306a\u5834\u5408</li> </ul>"},{"location":"rust/03-polymorphism/#_4","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Rust \u306b\u304a\u3051\u308b\u591a\u614b\u6027\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>Enum: \u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b\u306b\u3088\u308b\u6709\u9650\u306e\u578b\u30d0\u30ea\u30a8\u30fc\u30b7\u30e7\u30f3</li> <li>\u8907\u5408\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1: \u30bf\u30d7\u30eb\u306b\u3088\u308b\u8907\u6570\u306e\u5024\u306b\u57fa\u3065\u304f\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0</li> <li>Trait: \u5171\u901a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306e\u5b9a\u7fa9</li> <li>Extension Trait: \u65e2\u5b58\u578b\u3078\u306e\u632f\u308b\u821e\u3044\u306e\u8ffd\u52a0</li> <li>\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u30d1\u30bf\u30fc\u30f3: \u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u7ba1\u7406</li> <li>Strategy \u30d1\u30bf\u30fc\u30f3: \u6761\u4ef6\u5206\u5c90\u306e\u7f6e\u304d\u63db\u3048</li> </ol> <p>\u3053\u308c\u3089\u306e\u30e1\u30ab\u30cb\u30ba\u30e0\u3092\u9069\u5207\u306b\u4f7f\u3044\u5206\u3051\u308b\u3053\u3068\u3067\u3001\u62e1\u5f35\u6027\u304c\u9ad8\u304f\u4fdd\u5b88\u3057\u3084\u3059\u3044\u30b3\u30fc\u30c9\u3092\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"rust/03-polymorphism/#_5","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/rust/part1/src/chapter03.rs</code></li> </ul>"},{"location":"rust/03-polymorphism/#_6","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u304b\u3089\u7b2c2\u90e8\u300c\u4ed5\u69d8\u3068\u30c6\u30b9\u30c8\u300d\u306b\u5165\u308a\u307e\u3059\u3002Rust \u306e\u30c7\u30fc\u30bf\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3068\u4ed5\u69d8\u5b9a\u7fa9\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"rust/04-data-validation/","title":"\u7b2c4\u7ae0: \u30c7\u30fc\u30bf\u691c\u8a3c","text":""},{"location":"rust/04-data-validation/#_1","title":"\u6982\u8981","text":"<p>\u3053\u306e\u7ae0\u3067\u306f\u3001Rust \u306e\u578b\u30b7\u30b9\u30c6\u30e0\u3068 Result/Option \u3092\u4f7f\u3063\u305f\u30c7\u30fc\u30bf\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u306e\u5b9f\u88c5\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002Newtype \u30d1\u30bf\u30fc\u30f3\u3001\u30b9\u30de\u30fc\u30c8\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3001\u30a8\u30e9\u30fc\u84c4\u7a4d\u30d1\u30bf\u30fc\u30f3\u306a\u3069\u3001\u5805\u7262\u306a\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30eb\u3092\u69cb\u7bc9\u3059\u308b\u305f\u3081\u306e\u6280\u6cd5\u3092\u6271\u3044\u307e\u3059\u3002</p>"},{"location":"rust/04-data-validation/#_2","title":"\u5b66\u7fd2\u76ee\u6a19","text":"<ol> <li>\u57fa\u672c\u7684\u306a\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u95a2\u6570\u306e\u5b9f\u88c5</li> <li>Validated \u578b\u306b\u3088\u308b\u30a8\u30e9\u30fc\u84c4\u7a4d\u30d1\u30bf\u30fc\u30f3</li> <li>Newtype \u30d1\u30bf\u30fc\u30f3\u306b\u3088\u308b\u578b\u5b89\u5168\u306a\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30eb</li> <li>\u5217\u6319\u578b\u3068\u30b9\u30de\u30fc\u30c8\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf</li> <li>\u6761\u4ef6\u4ed8\u304d\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3</li> </ol>"},{"location":"rust/04-data-validation/#_3","title":"\u57fa\u672c\u6982\u5ff5","text":""},{"location":"rust/04-data-validation/#1","title":"1. \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u7d50\u679c\u578b","text":"<p>Rust \u306e <code>Result</code> \u578b\u3092\u4f7f\u3063\u3066\u3001\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u306e\u6210\u529f\u30fb\u5931\u6557\u3092\u8868\u73fe\u3057\u307e\u3059\uff1a</p> <pre><code>pub type ValidationResult&lt;T&gt; = Result&lt;T, Vec&lt;String&gt;&gt;;\n\npub fn validate_name(name: &amp;str) -&gt; ValidationResult&lt;String&gt; {\n    if name.is_empty() {\n        Err(vec![\"\u540d\u524d\u306f\u7a7a\u306b\u3067\u304d\u307e\u305b\u3093\".to_string()])\n    } else if name.len() &gt; 100 {\n        Err(vec![\"\u540d\u524d\u306f100\u6587\u5b57\u4ee5\u5185\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\".to_string()])\n    } else {\n        Ok(name.to_string())\n    }\n}\n</code></pre>"},{"location":"rust/04-data-validation/#2-validated","title":"2. Validated \u578b\uff08\u30a8\u30e9\u30fc\u84c4\u7a4d\uff09","text":"<p><code>Result</code> \u306f\u6700\u521d\u306e\u30a8\u30e9\u30fc\u3067\u505c\u6b62\u3057\u307e\u3059\u304c\u3001<code>Validated</code> \u578b\u3092\u4f7f\u3046\u3068\u5168\u3066\u306e\u30a8\u30e9\u30fc\u3092\u84c4\u7a4d\u3067\u304d\u307e\u3059\uff1a</p> <pre><code>#[derive(Debug, Clone, PartialEq)]\npub enum Validated&lt;E, A&gt; {\n    Valid(A),\n    Invalid(Vec&lt;E&gt;),\n}\n\nimpl&lt;E: Clone, A&gt; Validated&lt;E, A&gt; {\n    pub fn combine&lt;B, C, F&gt;(self, other: Validated&lt;E, B&gt;, f: F) -&gt; Validated&lt;E, C&gt;\n    where\n        F: FnOnce(A, B) -&gt; C,\n    {\n        match (self, other) {\n            (Validated::Valid(a), Validated::Valid(b)) =&gt; Validated::Valid(f(a, b)),\n            (Validated::Invalid(e1), Validated::Invalid(e2)) =&gt; {\n                let mut errors = e1;\n                errors.extend(e2);\n                Validated::Invalid(errors)\n            }\n            (Validated::Invalid(e), _) =&gt; Validated::Invalid(e),\n            (_, Validated::Invalid(e)) =&gt; Validated::Invalid(e),\n        }\n    }\n}\n</code></pre>"},{"location":"rust/04-data-validation/#3-newtype","title":"3. Newtype \u30d1\u30bf\u30fc\u30f3","text":"<p>\u30d7\u30ea\u30df\u30c6\u30a3\u30d6\u578b\u3092\u30e9\u30c3\u30d7\u3057\u3066\u578b\u5b89\u5168\u6027\u3092\u9ad8\u3081\u307e\u3059\uff1a</p> <pre><code>#[derive(Debug, Clone, PartialEq, Eq)]\npub struct ProductId(String);\n\nimpl ProductId {\n    pub fn new(id: &amp;str) -&gt; Validated&lt;String, ProductId&gt; {\n        let pattern = regex::Regex::new(r\"^PROD-\\d{5}$\").unwrap();\n        if pattern.is_match(id) {\n            Validated::valid(ProductId(id.to_string()))\n        } else {\n            Validated::invalid(vec![format!(\n                \"\u7121\u52b9\u306a\u5546\u54c1ID\u5f62\u5f0f: {} (PROD-XXXXX\u306e\u5f62\u5f0f\u304c\u5fc5\u8981)\",\n                id\n            )])\n        }\n    }\n\n    pub fn value(&amp;self) -&gt; &amp;str {\n        &amp;self.0\n    }\n}\n</code></pre>"},{"location":"rust/04-data-validation/#4_1","title":"4. \u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30eb\u306e\u69cb\u7bc9","text":"<p>Newtype \u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u3001\u5b89\u5168\u306a\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30eb\u3092\u69cb\u7bc9\u3057\u307e\u3059\uff1a</p> <pre><code>#[derive(Debug, Clone, PartialEq)]\npub struct Product {\n    pub id: ProductId,\n    pub name: ProductName,\n    pub price: Price,\n    pub description: Option&lt;String&gt;,\n    pub category: Option&lt;String&gt;,\n}\n\nimpl Product {\n    pub fn create(\n        id: &amp;str,\n        name: &amp;str,\n        price: f64,\n        description: Option&lt;String&gt;,\n        category: Option&lt;String&gt;,\n    ) -&gt; Validated&lt;String, Product&gt; {\n        ProductId::new(id).combine3(\n            ProductName::new(name),\n            Price::new(price),\n            |pid, pname, pprice| Product {\n                id: pid,\n                name: pname,\n                price: pprice,\n                description,\n                category,\n            },\n        )\n    }\n}\n</code></pre>"},{"location":"rust/04-data-validation/#_4","title":"\u5b9f\u88c5\u30d1\u30bf\u30fc\u30f3","text":""},{"location":"rust/04-data-validation/#_5","title":"\u5217\u6319\u578b\u3068\u30b9\u30de\u30fc\u30c8\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf","text":"<pre><code>#[derive(Debug, Clone, Copy, PartialEq, Eq)]\npub enum Membership {\n    Bronze,\n    Silver,\n    Gold,\n    Platinum,\n}\n\nimpl Membership {\n    pub fn from_str(s: &amp;str) -&gt; ValidationResult&lt;Membership&gt; {\n        match s.to_lowercase().as_str() {\n            \"bronze\" =&gt; Ok(Membership::Bronze),\n            \"silver\" =&gt; Ok(Membership::Silver),\n            \"gold\" =&gt; Ok(Membership::Gold),\n            \"platinum\" =&gt; Ok(Membership::Platinum),\n            _ =&gt; Err(vec![format!(\"\u7121\u52b9\u306a\u4f1a\u54e1\u7a2e\u5225: {}\", s)]),\n        }\n    }\n}\n</code></pre>"},{"location":"rust/04-data-validation/#adt","title":"\u6761\u4ef6\u4ed8\u304d\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\uff08ADT\uff09","text":"<p>\u901a\u77e5\u30bf\u30a4\u30d7\u306b\u3088\u3063\u3066\u7570\u306a\u308b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u3092\u9069\u7528\uff1a</p> <pre><code>#[derive(Debug, Clone, PartialEq)]\npub enum Notification {\n    Email { to: String, subject: String, body: String },\n    SMS { phone_number: String, body: String },\n    Push { device_token: String, body: String },\n}\n\nimpl Notification {\n    pub fn create_email(to: &amp;str, subject: &amp;str, body: &amp;str) -&gt; Validated&lt;String, Notification&gt; {\n        let mut errors = Vec::new();\n\n        if !to.contains('@') || !to.contains('.') {\n            errors.push(\"\u7121\u52b9\u306a\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u5f62\u5f0f\u3067\u3059\".to_string());\n        }\n        if subject.is_empty() {\n            errors.push(\"\u4ef6\u540d\u306f\u7a7a\u306b\u3067\u304d\u307e\u305b\u3093\".to_string());\n        }\n        if body.is_empty() {\n            errors.push(\"\u672c\u6587\u306f\u7a7a\u306b\u3067\u304d\u307e\u305b\u3093\".to_string());\n        }\n\n        if errors.is_empty() {\n            Validated::valid(Notification::Email {\n                to: to.to_string(),\n                subject: subject.to_string(),\n                body: body.to_string(),\n            })\n        } else {\n            Validated::invalid(errors)\n        }\n    }\n}\n</code></pre>"},{"location":"rust/04-data-validation/#_6","title":"\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30ec\u30b9\u30dd\u30f3\u30b9","text":"<p>API \u30ec\u30b9\u30dd\u30f3\u30b9\u5411\u3051\u306e\u69cb\u9020\u5316\u3055\u308c\u305f\u7d50\u679c\uff1a</p> <pre><code>#[derive(Debug, Clone, PartialEq)]\npub struct ValidationResponse&lt;A&gt; {\n    pub valid: bool,\n    pub data: Option&lt;A&gt;,\n    pub errors: Vec&lt;String&gt;,\n}\n\nimpl&lt;A&gt; ValidationResponse&lt;A&gt; {\n    pub fn from_validated(validated: Validated&lt;String, A&gt;) -&gt; Self {\n        match validated {\n            Validated::Valid(a) =&gt; ValidationResponse {\n                valid: true,\n                data: Some(a),\n                errors: Vec::new(),\n            },\n            Validated::Invalid(errors) =&gt; ValidationResponse {\n                valid: false,\n                data: None,\n                errors,\n            },\n        }\n    }\n}\n</code></pre>"},{"location":"rust/04-data-validation/#_7","title":"\u4ed6\u8a00\u8a9e\u3068\u306e\u6bd4\u8f03","text":"\u6982\u5ff5 Rust Scala F# \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u7d50\u679c <code>Result&lt;T, Vec&lt;E&gt;&gt;</code> <code>Validated[E, A]</code> <code>Result&lt;'a, 'e&gt;</code> \u30a8\u30e9\u30fc\u84c4\u7a4d \u30ab\u30b9\u30bf\u30e0 <code>Validated</code> \u578b cats <code>Validated</code> \u30ab\u30b9\u30bf\u30e0\u5b9f\u88c5 Newtype <code>struct Name(Type)</code> <code>case class</code> / opaque type \u5358\u4e00\u30b1\u30fc\u30b9 DU \u30b9\u30de\u30fc\u30c8\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf <code>impl</code> \u30d6\u30ed\u30c3\u30af\u5185 <code>apply</code> \u30e1\u30bd\u30c3\u30c9 \u30e2\u30b8\u30e5\u30fc\u30eb\u5185\u95a2\u6570"},{"location":"rust/04-data-validation/#_8","title":"\u30c6\u30b9\u30c8\u4f8b","text":"<pre><code>#[test]\nfn test_product_create_all_invalid() {\n    let result = Product::create(\"INVALID\", \"\", -100.0, None, None);\n    match result {\n        Validated::Invalid(errors) =&gt; {\n            assert_eq!(errors.len(), 3);  // 3\u3064\u306e\u30a8\u30e9\u30fc\u304c\u84c4\u7a4d\u3055\u308c\u308b\n        }\n        _ =&gt; panic!(\"Expected Invalid\"),\n    }\n}\n\n#[test]\nfn test_validated_combine_both_invalid() {\n    let v1: Validated&lt;String, i32&gt; = Validated::invalid(vec![\"error1\".to_string()]);\n    let v2: Validated&lt;String, i32&gt; = Validated::invalid(vec![\"error2\".to_string()]);\n    let result = v1.combine(v2, |a, b| a + b);\n    match result {\n        Validated::Invalid(errors) =&gt; {\n            assert_eq!(errors.len(), 2);\n            assert!(errors.contains(&amp;\"error1\".to_string()));\n            assert!(errors.contains(&amp;\"error2\".to_string()));\n        }\n        _ =&gt; panic!(\"Expected Invalid\"),\n    }\n}\n</code></pre>"},{"location":"rust/04-data-validation/#_9","title":"\u307e\u3068\u3081","text":"<ul> <li>Result vs Validated: <code>Result</code> \u306f fail-fast\u3001<code>Validated</code> \u306f\u30a8\u30e9\u30fc\u84c4\u7a4d</li> <li>Newtype \u30d1\u30bf\u30fc\u30f3: \u30d7\u30ea\u30df\u30c6\u30a3\u30d6\u578b\u306b\u610f\u5473\u3068\u5236\u7d04\u3092\u4ed8\u4e0e</li> <li>\u30b9\u30de\u30fc\u30c8\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf: \u4e0d\u6b63\u306a\u5024\u306e\u751f\u6210\u3092\u578b\u30ec\u30d9\u30eb\u3067\u9632\u6b62</li> <li>combine/combine3: \u8907\u6570\u306e\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u5408\u6210</li> <li>ADT: \u30bf\u30a4\u30d7\u3054\u3068\u306b\u7570\u306a\u308b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u3092\u9069\u7528</li> </ul>"},{"location":"rust/04-data-validation/#_10","title":"\u6b21\u306e\u7ae0","text":"<p>\u7b2c5\u7ae0: \u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8 \u3067\u306f\u3001proptest \u30af\u30ec\u30fc\u30c8\u3092\u4f7f\u3063\u305f\u81ea\u52d5\u30c6\u30b9\u30c8\u751f\u6210\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"rust/05-property-based-testing/","title":"\u7b2c5\u7ae0: \u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8","text":""},{"location":"rust/05-property-based-testing/#_1","title":"\u6982\u8981","text":"<p>\u3053\u306e\u7ae0\u3067\u306f\u3001Rust \u306e <code>proptest</code> \u30af\u30ec\u30fc\u30c8\u3092\u4f7f\u3063\u305f\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u3092\u5b66\u3073\u307e\u3059\u3002\u5f93\u6765\u306e\u30b5\u30f3\u30d7\u30eb\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u3068\u306f\u7570\u306a\u308a\u3001\u30c7\u30fc\u30bf\u306e\u6027\u8cea\uff08\u30d7\u30ed\u30d1\u30c6\u30a3\uff09\u3092\u691c\u8a3c\u3059\u308b\u3053\u3068\u3067\u3001\u3088\u308a\u5805\u7262\u306a\u30c6\u30b9\u30c8\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p>"},{"location":"rust/05-property-based-testing/#_2","title":"\u5b66\u7fd2\u76ee\u6a19","text":"<ol> <li>\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u306e\u6982\u5ff5\u7406\u89e3</li> <li>proptest \u30af\u30ec\u30fc\u30c8\u306e\u4f7f\u3044\u65b9</li> <li>\u6570\u5b66\u7684\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u691c\u8a3c</li> <li>\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30eb\u306e\u30d7\u30ed\u30d1\u30c6\u30a3</li> <li>\u30ab\u30b9\u30bf\u30e0\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u306e\u4f5c\u6210</li> </ol>"},{"location":"rust/05-property-based-testing/#_3","title":"\u57fa\u672c\u6982\u5ff5","text":""},{"location":"rust/05-property-based-testing/#_4","title":"\u30b5\u30f3\u30d7\u30eb\u30d9\u30fc\u30b9\u3068\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u306e\u9055\u3044","text":"<p>\u30b5\u30f3\u30d7\u30eb\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\uff1a\u7279\u5b9a\u306e\u5165\u529b\u306b\u5bfe\u3059\u308b\u51fa\u529b\u3092\u691c\u8a3c <pre><code>#[test]\nfn test_reverse_specific() {\n    assert_eq!(reverse(&amp;[1, 2, 3]), vec![3, 2, 1]);\n}\n</code></pre></p> <p>\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\uff1a\u4efb\u610f\u306e\u5165\u529b\u306b\u5bfe\u3059\u308b\u6027\u8cea\u3092\u691c\u8a3c <pre><code>proptest! {\n    #[test]\n    fn prop_reverse_involutive(xs: Vec&lt;i32&gt;) {\n        prop_assert_eq!(reverse(&amp;reverse(&amp;xs)), xs);\n    }\n}\n</code></pre></p>"},{"location":"rust/05-property-based-testing/#_5","title":"\u5b9f\u88c5\u30d1\u30bf\u30fc\u30f3","text":""},{"location":"rust/05-property-based-testing/#_6","title":"\u30ea\u30b9\u30c8\u64cd\u4f5c\u306e\u30d7\u30ed\u30d1\u30c6\u30a3","text":"<pre><code>use proptest::prelude::*;\n\npub fn reverse&lt;T: Clone&gt;(list: &amp;[T]) -&gt; Vec&lt;T&gt; {\n    list.iter().rev().cloned().collect()\n}\n\npub fn concat&lt;T: Clone&gt;(list1: &amp;[T], list2: &amp;[T]) -&gt; Vec&lt;T&gt; {\n    let mut result = list1.to_vec();\n    result.extend(list2.iter().cloned());\n    result\n}\n\nproptest! {\n    /// reverse \u306e\u81ea\u5df1\u9006\u5143\u6027: reverse(reverse(xs)) == xs\n    #[test]\n    fn prop_reverse_involutive(xs: Vec&lt;i32&gt;) {\n        prop_assert_eq!(reverse(&amp;reverse(&amp;xs)), xs);\n    }\n\n    /// reverse \u306f\u9577\u3055\u3092\u4fdd\u5b58\u3059\u308b\n    #[test]\n    fn prop_reverse_preserves_length(xs: Vec&lt;i32&gt;) {\n        prop_assert_eq!(reverse(&amp;xs).len(), xs.len());\n    }\n\n    /// concat \u306e\u9577\u3055\u306f\u5404\u30ea\u30b9\u30c8\u306e\u9577\u3055\u306e\u548c\n    #[test]\n    fn prop_concat_length(xs: Vec&lt;i32&gt;, ys: Vec&lt;i32&gt;) {\n        prop_assert_eq!(concat(&amp;xs, &amp;ys).len(), xs.len() + ys.len());\n    }\n\n    /// \u7a7a\u30ea\u30b9\u30c8\u3068\u306e\u9023\u7d50\u306f\u6052\u7b49\u64cd\u4f5c\n    #[test]\n    fn prop_concat_identity(xs: Vec&lt;i32&gt;) {\n        prop_assert_eq!(concat(&amp;xs, &amp;[]), xs);\n        prop_assert_eq!(concat(&amp;[], &amp;xs), xs);\n    }\n}\n</code></pre>"},{"location":"rust/05-property-based-testing/#_7","title":"\u6570\u5b66\u7684\u30d7\u30ed\u30d1\u30c6\u30a3","text":"<pre><code>proptest! {\n    /// \u52a0\u7b97\u306e\u53ef\u63db\u6cd5\u5247: a + b == b + a\n    #[test]\n    fn prop_add_commutative(a: i64, b: i64) {\n        prop_assert_eq!(a + b, b + a);\n    }\n\n    /// \u52a0\u7b97\u306e\u7d50\u5408\u6cd5\u5247: (a + b) + c == a + (b + c)\n    #[test]\n    fn prop_add_associative(a: i32, b: i32, c: i32) {\n        let a = a as i64;\n        let b = b as i64;\n        let c = c as i64;\n        prop_assert_eq!((a + b) + c, a + (b + c));\n    }\n\n    /// max \u306f\u53ef\u63db\u304b\u3064\u7d50\u679c\u306f\u4e21\u65b9\u4ee5\u4e0a\n    #[test]\n    fn prop_max_properties(a: i32, b: i32) {\n        let m = std::cmp::max(a, b);\n        prop_assert_eq!(m, std::cmp::max(b, a));\n        prop_assert!(m &gt;= a &amp;&amp; m &gt;= b);\n    }\n}\n</code></pre>"},{"location":"rust/05-property-based-testing/#_8","title":"\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30eb\u306e\u30d7\u30ed\u30d1\u30c6\u30a3","text":"<pre><code>#[derive(Debug, Clone, PartialEq)]\npub struct Money {\n    pub amount: i64,\n    pub currency: Currency,\n}\n\nimpl Money {\n    pub fn add(&amp;self, other: &amp;Money) -&gt; Option&lt;Money&gt; {\n        if self.currency == other.currency {\n            Some(Money::new(self.amount + other.amount, self.currency))\n        } else {\n            None\n        }\n    }\n}\n\nproptest! {\n    /// Money \u306e\u52a0\u7b97\u306f\u53ef\u63db\n    #[test]\n    fn prop_money_add_commutative(a: i32, b: i32) {\n        let m1 = Money::new(a as i64, Currency::JPY);\n        let m2 = Money::new(b as i64, Currency::JPY);\n        prop_assert_eq!(m1.add(&amp;m2), m2.add(&amp;m1));\n    }\n\n    /// \u30bc\u30ed\u306f\u52a0\u7b97\u306e\u5358\u4f4d\u5143\n    #[test]\n    fn prop_money_add_identity(a: i64) {\n        let m = Money::new(a, Currency::JPY);\n        let zero = Money::new(0, Currency::JPY);\n        prop_assert_eq!(m.add(&amp;zero), Some(m));\n    }\n\n    /// \u7570\u306a\u308b\u901a\u8ca8\u306e\u52a0\u7b97\u306f None\n    #[test]\n    fn prop_money_different_currency_fails(a: i64, b: i64) {\n        let m1 = Money::new(a, Currency::JPY);\n        let m2 = Money::new(b, Currency::USD);\n        prop_assert!(m1.add(&amp;m2).is_none());\n    }\n}\n</code></pre>"},{"location":"rust/05-property-based-testing/#_9","title":"\u30ab\u30b9\u30bf\u30e0\u30b9\u30c8\u30e9\u30c6\u30b8\u30fc","text":"<pre><code>proptest! {\n    /// \u30ab\u30b9\u30bf\u30e0\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u3092\u4f7f\u7528\n    #[test]\n    fn prop_order_total(\n        prices in prop::collection::vec(1i64..1000, 1..5),\n        quantities in prop::collection::vec(1u32..100, 1..5)\n    ) {\n        let items: Vec&lt;OrderItem&gt; = prices.iter()\n            .zip(quantities.iter())\n            .enumerate()\n            .map(|(i, (&amp;p, &amp;q))| OrderItem::new(&amp;format!(\"PROD-{}\", i), p, q))\n            .collect();\n\n        let order = Order::new(\"ORD-001\", items.clone());\n        let expected: i64 = items.iter().map(|i| i.subtotal()).sum();\n        prop_assert_eq!(order.total(), expected);\n    }\n}\n</code></pre>"},{"location":"rust/05-property-based-testing/#_10","title":"\u524d\u63d0\u6761\u4ef6\u306e\u6307\u5b9a","text":"<pre><code>proptest! {\n    /// abs(n) &gt;= 0 (i32::MIN \u306f\u9664\u5916)\n    #[test]\n    fn prop_abs_non_negative(n: i32) {\n        prop_assume!(n != i32::MIN);  // \u30aa\u30fc\u30d0\u30fc\u30d5\u30ed\u30fc\u56de\u907f\n        prop_assert!(n.abs() &gt;= 0);\n    }\n}\n</code></pre>"},{"location":"rust/05-property-based-testing/#_11","title":"\u4e3b\u8981\u306a\u30d7\u30ed\u30d1\u30c6\u30a3\u30d1\u30bf\u30fc\u30f3","text":"\u30d1\u30bf\u30fc\u30f3 \u8aac\u660e \u4f8b \u51aa\u7b49\u6027 2\u56de\u9069\u7528\u3057\u3066\u3082\u7d50\u679c\u304c\u5909\u308f\u3089\u306a\u3044 <code>sort(sort(x)) == sort(x)</code> \u81ea\u5df1\u9006\u5143 2\u56de\u9069\u7528\u3059\u308b\u3068\u5143\u306b\u623b\u308b <code>reverse(reverse(x)) == x</code> \u53ef\u63db\u6cd5\u5247 \u9806\u5e8f\u3092\u5909\u3048\u3066\u3082\u7d50\u679c\u304c\u540c\u3058 <code>a + b == b + a</code> \u7d50\u5408\u6cd5\u5247 \u62ec\u5f27\u306e\u4f4d\u7f6e\u3092\u5909\u3048\u3066\u3082\u540c\u3058 <code>(a+b)+c == a+(b+c)</code> \u5358\u4f4d\u5143 \u7279\u5b9a\u306e\u5024\u3068\u306e\u6f14\u7b97\u3067\u5909\u5316\u306a\u3057 <code>a + 0 == a</code> \u4fdd\u5b58\u5247 \u7279\u5b9a\u306e\u6027\u8cea\u304c\u4fdd\u5b58\u3055\u308c\u308b <code>len(reverse(x)) == len(x)</code>"},{"location":"rust/05-property-based-testing/#_12","title":"\u4ed6\u8a00\u8a9e\u3068\u306e\u6bd4\u8f03","text":"\u6a5f\u80fd Rust (proptest) Scala (ScalaCheck) Haskell (QuickCheck) \u30de\u30af\u30ed <code>proptest!</code> <code>forAll</code> <code>property</code> \u524d\u63d0\u6761\u4ef6 <code>prop_assume!</code> <code>whenever</code> <code>==&gt;</code> \u7e2e\u5c0f \u81ea\u52d5 \u81ea\u52d5 \u81ea\u52d5 \u30ab\u30b9\u30bf\u30e0\u751f\u6210 <code>Strategy</code> trait <code>Gen</code>/<code>Arbitrary</code> <code>Gen</code>/<code>Arbitrary</code>"},{"location":"rust/05-property-based-testing/#_13","title":"\u30c6\u30b9\u30c8\u4f8b","text":"<pre><code>#[cfg(test)]\nmod tests {\n    use super::*;\n    use proptest::prelude::*;\n\n    proptest! {\n        /// head \u3068 tail \u3067\u5143\u306e\u30ea\u30b9\u30c8\u3092\u518d\u69cb\u7bc9\u3067\u304d\u308b\n        #[test]\n        fn prop_head_tail_reconstruction(xs: Vec&lt;i32&gt;) {\n            if !xs.is_empty() {\n                let h = xs[0];\n                let t = &amp;xs[1..];\n                let mut reconstructed = vec![h];\n                reconstructed.extend_from_slice(t);\n                prop_assert_eq!(reconstructed, xs);\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"rust/05-property-based-testing/#_14","title":"\u307e\u3068\u3081","text":"<ul> <li>\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8: \u5177\u4f53\u7684\u306a\u5024\u3067\u306f\u306a\u304f\u3001\u30c7\u30fc\u30bf\u306e\u6027\u8cea\u3092\u691c\u8a3c</li> <li>proptest: Rust \u3067\u306e\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u306e\u6a19\u6e96\u30e9\u30a4\u30d6\u30e9\u30ea</li> <li>\u81ea\u52d5\u7e2e\u5c0f: \u5931\u6557\u6642\u306b\u6700\u5c0f\u306e\u53cd\u4f8b\u3092\u767a\u898b</li> <li>\u6570\u5b66\u7684\u6027\u8cea: \u53ef\u63db\u3001\u7d50\u5408\u3001\u51aa\u7b49\u6027\u306a\u3069\u306e\u666e\u904d\u7684\u306a\u6027\u8cea\u3092\u691c\u8a3c</li> <li>\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30eb: \u30d3\u30b8\u30cd\u30b9\u30eb\u30fc\u30eb\u306e\u4e0d\u5909\u6761\u4ef6\u3092\u691c\u8a3c</li> </ul>"},{"location":"rust/05-property-based-testing/#_15","title":"\u6b21\u306e\u7ae0","text":"<p>\u7b2c6\u7ae0: TDD \u3068\u95a2\u6570\u578b \u3067\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3068 TDD \u3092\u7d44\u307f\u5408\u308f\u305b\u305f\u958b\u767a\u624b\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"rust/06-tdd-and-functional/","title":"\u7b2c6\u7ae0: TDD \u3068\u95a2\u6570\u578b","text":""},{"location":"rust/06-tdd-and-functional/#_1","title":"\u6982\u8981","text":"<p>\u3053\u306e\u7ae0\u3067\u306f\u3001Rust \u306b\u304a\u3051\u308b TDD\uff08\u30c6\u30b9\u30c8\u99c6\u52d5\u958b\u767a\uff09\u3068\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u5b9f\u8df5\u3092\u5b66\u3073\u307e\u3059\u3002\u7d14\u7c8b\u95a2\u6570\u3001\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u30c7\u30fc\u30bf\u3001\u4f9d\u5b58\u6027\u6ce8\u5165\u306a\u3069\u3001\u30c6\u30b9\u30c8\u3057\u3084\u3059\u3044\u30b3\u30fc\u30c9\u3092\u66f8\u304f\u305f\u3081\u306e\u6280\u6cd5\u3092\u6271\u3044\u307e\u3059\u3002</p>"},{"location":"rust/06-tdd-and-functional/#_2","title":"\u5b66\u7fd2\u76ee\u6a19","text":"<ol> <li>\u7d14\u7c8b\u95a2\u6570\u306b\u3088\u308b\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u306e\u5b9f\u88c5</li> <li>\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u8a2d\u8a08</li> <li>\u4f9d\u5b58\u6027\u6ce8\u5165\u30d1\u30bf\u30fc\u30f3</li> <li>\u30c6\u30b9\u30c8\u30c0\u30d6\u30eb\u306e\u6d3b\u7528</li> <li>\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30eb\u306e\u30c6\u30b9\u30c8\u6226\u7565</li> </ol>"},{"location":"rust/06-tdd-and-functional/#_3","title":"\u57fa\u672c\u6982\u5ff5","text":""},{"location":"rust/06-tdd-and-functional/#_4","title":"\u7d14\u7c8b\u95a2\u6570\u306e\u7279\u5fb4","text":"<p>\u7d14\u7c8b\u95a2\u6570\u306f\u4ee5\u4e0b\u306e\u7279\u6027\u3092\u6301\u3061\u307e\u3059\uff1a</p> <ol> <li>\u540c\u3058\u5165\u529b\u306b\u5bfe\u3057\u3066\u5e38\u306b\u540c\u3058\u51fa\u529b</li> <li>\u526f\u4f5c\u7528\u304c\u306a\u3044\uff08\u5916\u90e8\u72b6\u614b\u306e\u5909\u66f4\u306a\u3057\uff09</li> <li>\u53c2\u7167\u900f\u904e\u6027\uff08\u5f0f\u3092\u305d\u306e\u7d50\u679c\u3067\u7f6e\u304d\u63db\u3048\u53ef\u80fd\uff09</li> </ol> <pre><code>// \u7d14\u7c8b\u95a2\u6570\uff1a\u30c6\u30b9\u30c8\u3057\u3084\u3059\u3044\npub fn calculate_tax(amount: i64, tax_type: TaxType) -&gt; i64 {\n    (amount as f64 * tax_type.rate()).round() as i64\n}\n\n// \u975e\u7d14\u7c8b\u95a2\u6570\uff1a\u30c6\u30b9\u30c8\u3057\u306b\u304f\u3044\npub fn save_to_database(data: &amp;Data) -&gt; Result&lt;(), Error&gt; {\n    // \u5916\u90e8\u30b7\u30b9\u30c6\u30e0\u3078\u306e\u526f\u4f5c\u7528\n}\n</code></pre>"},{"location":"rust/06-tdd-and-functional/#_5","title":"\u5b9f\u88c5\u30d1\u30bf\u30fc\u30f3","text":""},{"location":"rust/06-tdd-and-functional/#1","title":"1. \u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u306a\u30b7\u30e7\u30c3\u30d4\u30f3\u30b0\u30ab\u30fc\u30c8","text":"<pre><code>#[derive(Debug, Clone, PartialEq)]\npub struct Cart {\n    pub items: Vec&lt;CartItem&gt;,\n}\n\nimpl Cart {\n    pub fn new() -&gt; Cart {\n        Cart { items: Vec::new() }\n    }\n\n    /// \u30a2\u30a4\u30c6\u30e0\u3092\u8ffd\u52a0\uff08\u5143\u306e\u30ab\u30fc\u30c8\u306f\u5909\u66f4\u3057\u306a\u3044\uff09\n    pub fn add_item(&amp;self, item: CartItem) -&gt; Cart {\n        let mut new_items = self.items.clone();\n        new_items.push(item);\n        Cart { items: new_items }\n    }\n\n    /// \u5408\u8a08\u91d1\u984d\uff08\u7d14\u7c8b\u95a2\u6570\uff09\n    pub fn total(&amp;self) -&gt; i64 {\n        self.items.iter().map(|item| item.subtotal()).sum()\n    }\n}\n</code></pre>"},{"location":"rust/06-tdd-and-functional/#2","title":"2. \u30d3\u30b8\u30cd\u30b9\u30eb\u30fc\u30eb\u306e\u5206\u96e2","text":"<p>\u5272\u5f15\u30eb\u30fc\u30eb\u3092\u72ec\u7acb\u3057\u305f\u7d14\u7c8b\u95a2\u6570\u3068\u3057\u3066\u5b9f\u88c5\uff1a</p> <pre><code>#[derive(Debug, Clone)]\npub enum DiscountType {\n    Percentage(f64),\n    FixedAmount(i64),\n}\n\n#[derive(Debug, Clone)]\npub struct DiscountRule {\n    pub name: String,\n    pub discount_type: DiscountType,\n    pub min_amount: Option&lt;i64&gt;,\n}\n\nimpl DiscountRule {\n    /// \u9069\u7528\u53ef\u80fd\u304b\u3069\u3046\u304b\u3092\u5224\u5b9a\uff08\u7d14\u7c8b\u95a2\u6570\uff09\n    pub fn is_applicable(&amp;self, cart: &amp;Cart) -&gt; bool {\n        self.min_amount.map_or(true, |min| cart.total() &gt;= min)\n    }\n\n    /// \u5272\u5f15\u984d\u3092\u8a08\u7b97\uff08\u7d14\u7c8b\u95a2\u6570\uff09\n    pub fn calculate_discount(&amp;self, cart: &amp;Cart) -&gt; i64 {\n        if !self.is_applicable(cart) {\n            return 0;\n        }\n\n        match &amp;self.discount_type {\n            DiscountType::Percentage(rate) =&gt; (cart.total() as f64 * rate) as i64,\n            DiscountType::FixedAmount(amount) =&gt; *amount,\n        }\n    }\n}\n</code></pre>"},{"location":"rust/06-tdd-and-functional/#3","title":"3. \u4f9d\u5b58\u6027\u6ce8\u5165","text":"<p>\u5916\u90e8\u4f9d\u5b58\uff08ID\u751f\u6210\u306a\u3069\uff09\u3092\u95a2\u6570\u3068\u3057\u3066\u6ce8\u5165\uff1a</p> <pre><code>/// ID \u751f\u6210\u95a2\u6570\u306e\u578b\npub type IdGenerator = fn() -&gt; String;\n\n/// \u6ce8\u6587\u3092\u4f5c\u6210\uff08ID\u751f\u6210\u3092\u5916\u90e8\u304b\u3089\u6ce8\u5165\uff09\npub fn create_order(\n    cart: &amp;Cart,\n    discount_rules: &amp;[DiscountRule],\n    id_gen: IdGenerator,\n) -&gt; Order {\n    let summary = calculate_order_summary(cart, discount_rules);\n\n    Order {\n        id: id_gen(),\n        cart: cart.clone(),\n        subtotal: summary.subtotal,\n        tax: summary.tax,\n        discount: summary.discount,\n        total: summary.total,\n    }\n}\n\n// \u672c\u756a\u7528\nfn production_id_generator() -&gt; String {\n    uuid::Uuid::new_v4().to_string()\n}\n\n// \u30c6\u30b9\u30c8\u7528\nfn test_id_generator() -&gt; String {\n    \"TEST-ORDER-001\".to_string()\n}\n</code></pre>"},{"location":"rust/06-tdd-and-functional/#4","title":"4. \u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u306a\u5728\u5eab\u7ba1\u7406","text":"<pre><code>#[derive(Debug, Clone)]\npub struct Inventory {\n    pub stocks: HashMap&lt;String, u32&gt;,\n}\n\nimpl Inventory {\n    /// \u5728\u5eab\u3092\u8ffd\u52a0\uff08\u65b0\u3057\u3044\u30a4\u30f3\u30d9\u30f3\u30c8\u30ea\u3092\u8fd4\u3059\uff09\n    pub fn add_stock(&amp;self, product_id: &amp;str, quantity: u32) -&gt; Inventory {\n        let mut new_stocks = self.stocks.clone();\n        *new_stocks.entry(product_id.to_string()).or_insert(0) += quantity;\n        Inventory { stocks: new_stocks }\n    }\n\n    /// \u5728\u5eab\u3092\u6e1b\u3089\u3059\uff08Result \u3067\u5931\u6557\u3092\u8868\u73fe\uff09\n    pub fn remove_stock(&amp;self, product_id: &amp;str, quantity: u32) -&gt; Result&lt;Inventory, String&gt; {\n        let current = self.stocks.get(product_id).copied().unwrap_or(0);\n        if current &lt; quantity {\n            Err(format!(\"\u5728\u5eab\u4e0d\u8db3: {}\", product_id))\n        } else {\n            let mut new_stocks = self.stocks.clone();\n            new_stocks.insert(product_id.to_string(), current - quantity);\n            Ok(Inventory { stocks: new_stocks })\n        }\n    }\n}\n</code></pre>"},{"location":"rust/06-tdd-and-functional/#_6","title":"\u30c6\u30b9\u30c8\u6226\u7565","text":""},{"location":"rust/06-tdd-and-functional/#_7","title":"\u7d14\u7c8b\u95a2\u6570\u306e\u30c6\u30b9\u30c8","text":"<pre><code>#[test]\nfn test_calculate_tax() {\n    assert_eq!(calculate_tax(1000, TaxType::Standard), 100);  // 10%\n    assert_eq!(calculate_tax(1000, TaxType::Reduced), 80);    // 8%\n    assert_eq!(calculate_tax(1000, TaxType::TaxFree), 0);     // 0%\n}\n</code></pre>"},{"location":"rust/06-tdd-and-functional/#_8","title":"\u30a4\u30df\u30e5\u30fc\u30bf\u30d3\u30ea\u30c6\u30a3\u306e\u691c\u8a3c","text":"<pre><code>#[test]\nfn test_cart_immutability() {\n    let cart1 = Cart::new();\n    let product = test_product(\"P1\", \"\u5546\u54c11\", 1000, \"general\");\n\n    let cart2 = cart1.add_item(CartItem::new(product, 1));\n\n    // cart1 \u306f\u5909\u66f4\u3055\u308c\u3066\u3044\u306a\u3044\n    assert_eq!(cart1.item_count(), 0);\n    assert_eq!(cart2.item_count(), 1);\n}\n\n#[test]\nfn test_inventory_immutability() {\n    let inv1 = Inventory::new();\n    let inv2 = inv1.add_stock(\"P1\", 10);\n    let inv3 = inv2.remove_stock(\"P1\", 3).unwrap();\n\n    // \u5404\u30d0\u30fc\u30b8\u30e7\u30f3\u306f\u72ec\u7acb\n    assert_eq!(inv1.get_stock(\"P1\"), 0);\n    assert_eq!(inv2.get_stock(\"P1\"), 10);\n    assert_eq!(inv3.get_stock(\"P1\"), 7);\n}\n</code></pre>"},{"location":"rust/06-tdd-and-functional/#_9","title":"\u4f9d\u5b58\u6027\u6ce8\u5165\u306e\u30c6\u30b9\u30c8","text":"<pre><code>#[test]\nfn test_create_order_with_injected_id() {\n    let cart = test_cart_with_items(vec![\n        (test_product(\"P1\", \"\u5546\u54c11\", 1000, \"general\"), 1),\n    ]);\n\n    // \u30c6\u30b9\u30c8\u7528\u306eID\u751f\u6210\u5668\u3092\u6ce8\u5165\n    let order = create_order(&amp;cart, &amp;[], test_id_generator);\n\n    assert_eq!(order.id, \"TEST-ORDER-001\");\n}\n</code></pre>"},{"location":"rust/06-tdd-and-functional/#_10","title":"\u30c6\u30b9\u30c8\u30d8\u30eb\u30d1\u30fc\u95a2\u6570","text":"<pre><code>/// \u30c6\u30b9\u30c8\u7528\u306e\u5546\u54c1\u3092\u4f5c\u6210\npub fn test_product(id: &amp;str, name: &amp;str, price: i64, category: &amp;str) -&gt; Product {\n    Product {\n        id: id.to_string(),\n        name: name.to_string(),\n        price,\n        category: category.to_string(),\n    }\n}\n\n/// \u30c6\u30b9\u30c8\u7528\u306e\u30ab\u30fc\u30c8\u3092\u4f5c\u6210\npub fn test_cart_with_items(items: Vec&lt;(Product, u32)&gt;) -&gt; Cart {\n    let cart_items: Vec&lt;CartItem&gt; = items\n        .into_iter()\n        .map(|(product, quantity)| CartItem::new(product, quantity))\n        .collect();\n    Cart { items: cart_items }\n}\n</code></pre>"},{"location":"rust/06-tdd-and-functional/#tdd","title":"TDD \u30b5\u30a4\u30af\u30eb\u306e\u4f8b","text":""},{"location":"rust/06-tdd-and-functional/#red","title":"Red: \u5931\u6557\u3059\u308b\u30c6\u30b9\u30c8\u3092\u66f8\u304f","text":"<pre><code>#[test]\nfn test_percentage_discount() {\n    let cart = test_cart_with_items(vec![\n        (test_product(\"P1\", \"\u5546\u54c11\", 1000, \"general\"), 10),\n    ]);\n\n    let rule = DiscountRule {\n        name: \"10%\u30aa\u30d5\".to_string(),\n        discount_type: DiscountType::Percentage(0.1),\n        min_amount: None,\n    };\n\n    assert_eq!(rule.calculate_discount(&amp;cart), 1000);\n}\n</code></pre>"},{"location":"rust/06-tdd-and-functional/#green","title":"Green: \u30c6\u30b9\u30c8\u3092\u901a\u3059\u6700\u5c0f\u9650\u306e\u5b9f\u88c5","text":"<pre><code>pub fn calculate_discount(&amp;self, cart: &amp;Cart) -&gt; i64 {\n    match &amp;self.discount_type {\n        DiscountType::Percentage(rate) =&gt; (cart.total() as f64 * rate) as i64,\n        DiscountType::FixedAmount(amount) =&gt; *amount,\n    }\n}\n</code></pre>"},{"location":"rust/06-tdd-and-functional/#refactor","title":"Refactor: \u30b3\u30fc\u30c9\u3092\u6539\u5584","text":"<pre><code>pub fn calculate_discount(&amp;self, cart: &amp;Cart) -&gt; i64 {\n    if !self.is_applicable(cart) {\n        return 0;  // \u9069\u7528\u6761\u4ef6\u3092\u8ffd\u52a0\n    }\n\n    match &amp;self.discount_type {\n        DiscountType::Percentage(rate) =&gt; (cart.total() as f64 * rate) as i64,\n        DiscountType::FixedAmount(amount) =&gt; *amount,\n    }\n}\n</code></pre>"},{"location":"rust/06-tdd-and-functional/#_11","title":"\u4ed6\u8a00\u8a9e\u3068\u306e\u6bd4\u8f03","text":"\u6982\u5ff5 Rust Scala F# \u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb \u30c7\u30d5\u30a9\u30eb\u30c8 <code>val</code> / case class \u30c7\u30d5\u30a9\u30eb\u30c8 \u4f9d\u5b58\u6027\u6ce8\u5165 \u95a2\u6570\u578b / trait \u6697\u9ed9\u7684\u30d1\u30e9\u30e1\u30fc\u30bf \u95a2\u6570\u30d1\u30e9\u30e1\u30fc\u30bf \u30c6\u30b9\u30c8\u30c0\u30d6\u30eb \u95a2\u6570 / mock crate ScalaMock \u95a2\u6570 \u526f\u4f5c\u7528\u306e\u5206\u96e2 <code>Result</code> / <code>Option</code> <code>IO</code> / <code>Future</code> <code>Async</code> / <code>Result</code>"},{"location":"rust/06-tdd-and-functional/#_12","title":"\u307e\u3068\u3081","text":"<ul> <li>\u7d14\u7c8b\u95a2\u6570: \u526f\u4f5c\u7528\u306a\u3057\u3001\u30c6\u30b9\u30c8\u5bb9\u6613\u3001\u518d\u5229\u7528\u6027\u9ad8</li> <li>\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb: \u72b6\u614b\u5909\u66f4\u306a\u3057\u3001\u4e26\u884c\u5b89\u5168\u3001\u5c65\u6b74\u8ffd\u8de1\u53ef\u80fd</li> <li>\u4f9d\u5b58\u6027\u6ce8\u5165: \u5916\u90e8\u4f9d\u5b58\u3092\u62bd\u8c61\u5316\u3001\u30c6\u30b9\u30c8\u7528\u5b9f\u88c5\u3092\u6ce8\u5165\u53ef\u80fd</li> <li>TDD: Red-Green-Refactor \u30b5\u30a4\u30af\u30eb\u3067\u8a2d\u8a08\u3092\u5c0e\u304f</li> <li>\u30c6\u30b9\u30c8\u30d8\u30eb\u30d1\u30fc: \u5171\u901a\u306e\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u30b3\u30fc\u30c9\u3092\u95a2\u6570\u5316</li> </ul>"},{"location":"rust/06-tdd-and-functional/#_13","title":"\u6b21\u306e\u7ae0","text":"<p>\u7b2c7\u7ae0: FP \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u30d1\u30bf\u30fc\u30f3 \u3067\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3092\u6d3b\u7528\u3057\u305f\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"rust/07-composite-pattern/","title":"\u7b2c7\u7ae0: Composite \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"rust/07-composite-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Composite \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u30c4\u30ea\u30fc\u69cb\u9020\u3067\u69cb\u6210\u3057\u3001\u500b\u3005\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u96c6\u5408\u3092\u540c\u3058\u3088\u3046\u306b\u6271\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u3053\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306f\u500b\u3005\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u305d\u306e\u7d44\u307f\u5408\u308f\u305b\u3092\u533a\u5225\u305b\u305a\u306b\u64cd\u4f5c\u3067\u304d\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u56f3\u5f62\uff08Shape\uff09\u3001\u30b9\u30a4\u30c3\u30c1\uff08Switchable\uff09\u3001\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3001\u30e1\u30cb\u30e5\u30fc\u3001\u6570\u5f0f\u306a\u3069\u3001\u69d8\u3005\u306a\u4f8b\u3092\u901a\u3058\u3066 Composite \u30d1\u30bf\u30fc\u30f3\u306e Rust \u3067\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"rust/07-composite-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Composite \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Component: \u5168\u3066\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u5171\u901a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\uff08Rust \u3067\u306f <code>enum</code> \u307e\u305f\u306f <code>trait</code>\uff09</li> <li>Leaf: \u5b50\u8981\u7d20\u3092\u6301\u305f\u306a\u3044\u672b\u7aef\u30aa\u30d6\u30b8\u30a7\u30af\u30c8</li> <li>Composite: \u5b50\u8981\u7d20\u3092\u6301\u3064\u30b3\u30f3\u30c6\u30ca\u30aa\u30d6\u30b8\u30a7\u30af\u30c8</li> </ul> <p></p>"},{"location":"rust/07-composite-pattern/#2-shape-composite","title":"2. Shape \u306e\u4f8b - \u56f3\u5f62\u306e Composite \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"rust/07-composite-pattern/#enum","title":"enum \u306b\u3088\u308b\u5171\u901a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9","text":"<pre><code>/// 2D\u5ea7\u6a19\n#[derive(Debug, Clone, Copy, PartialEq)]\npub struct Point {\n    pub x: f64,\n    pub y: f64,\n}\n\nimpl Point {\n    pub fn new(x: f64, y: f64) -&gt; Point {\n        Point { x, y }\n    }\n\n    pub fn add(&amp;self, other: &amp;Point) -&gt; Point {\n        Point::new(self.x + other.x, self.y + other.y)\n    }\n\n    pub fn scale(&amp;self, factor: f64) -&gt; Point {\n        Point::new(self.x * factor, self.y * factor)\n    }\n}\n\n/// \u56f3\u5f62\uff08enum \u306b\u3088\u308b ADT\uff09\n#[derive(Debug, Clone, PartialEq)]\npub enum Shape {\n    Circle {\n        center: Point,\n        radius: f64,\n    },\n    Square {\n        top_left: Point,\n        side: f64,\n    },\n    Rectangle {\n        top_left: Point,\n        width: f64,\n        height: f64,\n    },\n    Triangle {\n        p1: Point,\n        p2: Point,\n        p3: Point,\n    },\n    Composite {\n        shapes: Vec&lt;Shape&gt;,\n    },\n}\n</code></pre>"},{"location":"rust/07-composite-pattern/#_2","title":"\u56f3\u5f62\u64cd\u4f5c\u306e\u5b9f\u88c5","text":"<pre><code>impl Shape {\n    /// \u56f3\u5f62\u3092\u79fb\u52d5\n    pub fn translate(&amp;self, dx: f64, dy: f64) -&gt; Shape {\n        match self {\n            Shape::Circle { center, radius } =&gt; Shape::Circle {\n                center: Point::new(center.x + dx, center.y + dy),\n                radius: *radius,\n            },\n            Shape::Square { top_left, side } =&gt; Shape::Square {\n                top_left: Point::new(top_left.x + dx, top_left.y + dy),\n                side: *side,\n            },\n            Shape::Composite { shapes } =&gt; Shape::Composite {\n                shapes: shapes.iter().map(|s| s.translate(dx, dy)).collect(),\n            },\n            // ... \u4ed6\u306e\u56f3\u5f62\n        }\n    }\n\n    /// \u56f3\u5f62\u3092\u62e1\u5927\u7e2e\u5c0f\n    pub fn scale(&amp;self, factor: f64) -&gt; Shape {\n        match self {\n            Shape::Circle { center, radius } =&gt; Shape::Circle {\n                center: *center,\n                radius: radius * factor,\n            },\n            Shape::Square { top_left, side } =&gt; Shape::Square {\n                top_left: *top_left,\n                side: side * factor,\n            },\n            Shape::Composite { shapes } =&gt; Shape::Composite {\n                shapes: shapes.iter().map(|s| s.scale(factor)).collect(),\n            },\n            // ... \u4ed6\u306e\u56f3\u5f62\n        }\n    }\n\n    /// \u9762\u7a4d\u3092\u8a08\u7b97\n    pub fn area(&amp;self) -&gt; f64 {\n        match self {\n            Shape::Circle { radius, .. } =&gt; PI * radius * radius,\n            Shape::Square { side, .. } =&gt; side * side,\n            Shape::Rectangle { width, height, .. } =&gt; width * height,\n            Shape::Triangle { p1, p2, p3 } =&gt; {\n                ((p2.x - p1.x) * (p3.y - p1.y) - (p3.x - p1.x) * (p2.y - p1.y)).abs() / 2.0\n            }\n            Shape::Composite { shapes } =&gt; shapes.iter().map(|s| s.area()).sum(),\n        }\n    }\n}\n</code></pre>"},{"location":"rust/07-composite-pattern/#_3","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// \u500b\u3005\u306e\u56f3\u5f62\u3092\u4f5c\u6210\nlet circle = Shape::Circle {\n    center: Point::new(10.0, 10.0),\n    radius: 5.0,\n};\nlet square = Shape::Square {\n    top_left: Point::new(0.0, 0.0),\n    side: 10.0,\n};\n\n// \u8907\u5408\u56f3\u5f62\u3092\u4f5c\u6210\nlet group = Shape::Composite {\n    shapes: vec![circle.clone(), square.clone()],\n};\n\n// \u8907\u5408\u56f3\u5f62\u3092\u79fb\u52d5\uff08\u5168\u3066\u306e\u5b50\u8981\u7d20\u304c\u79fb\u52d5\u3059\u308b\uff09\nlet moved = group.translate(5.0, 5.0);\n\n// \u9762\u7a4d\u306f\u5168\u3066\u306e\u5b50\u8981\u7d20\u306e\u5408\u8a08\nlet total_area = group.area();\n</code></pre>"},{"location":"rust/07-composite-pattern/#3-switchable-composite","title":"3. Switchable \u306e\u4f8b - \u30b9\u30a4\u30c3\u30c1\u306e Composite \u30d1\u30bf\u30fc\u30f3","text":"<pre><code>/// \u30b9\u30a4\u30c3\u30c1\u53ef\u80fd\u306a\u30c7\u30d0\u30a4\u30b9\n#[derive(Debug, Clone, PartialEq)]\npub enum Switchable {\n    Light {\n        on: bool,\n        name: String,\n    },\n    DimmableLight {\n        intensity: u8,\n        name: String,\n    },\n    Fan {\n        speed: u8,\n        name: String,\n    },\n    Composite {\n        switchables: Vec&lt;Switchable&gt;,\n        name: String,\n    },\n}\n\nimpl Switchable {\n    pub fn turn_on(&amp;self) -&gt; Switchable {\n        match self {\n            Switchable::Light { name, .. } =&gt; Switchable::Light {\n                on: true,\n                name: name.clone(),\n            },\n            Switchable::DimmableLight { name, .. } =&gt; Switchable::DimmableLight {\n                intensity: 100,\n                name: name.clone(),\n            },\n            Switchable::Composite { switchables, name } =&gt; Switchable::Composite {\n                switchables: switchables.iter().map(|s| s.turn_on()).collect(),\n                name: name.clone(),\n            },\n            // ... \u4ed6\u306e\u30c7\u30d0\u30a4\u30b9\n        }\n    }\n\n    pub fn is_on(&amp;self) -&gt; bool {\n        match self {\n            Switchable::Light { on, .. } =&gt; *on,\n            Switchable::DimmableLight { intensity, .. } =&gt; *intensity &gt; 0,\n            Switchable::Composite { switchables, .. } =&gt; switchables.iter().any(|s| s.is_on()),\n            // ... \u4ed6\u306e\u30c7\u30d0\u30a4\u30b9\n        }\n    }\n}\n</code></pre>"},{"location":"rust/07-composite-pattern/#4-filesystem","title":"4. FileSystem \u306e\u4f8b","text":"<pre><code>/// \u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u30a8\u30f3\u30c8\u30ea\n#[derive(Debug, Clone, PartialEq)]\npub enum FileSystemEntry {\n    File {\n        name: String,\n        size: u64,\n        parent_path: String,\n    },\n    Directory {\n        name: String,\n        children: Vec&lt;FileSystemEntry&gt;,\n        parent_path: String,\n    },\n}\n\nimpl FileSystemEntry {\n    pub fn size(&amp;self) -&gt; u64 {\n        match self {\n            FileSystemEntry::File { size, .. } =&gt; *size,\n            FileSystemEntry::Directory { children, .. } =&gt; {\n                children.iter().map(|c| c.size()).sum()\n            }\n        }\n    }\n\n    pub fn file_count(&amp;self) -&gt; usize {\n        match self {\n            FileSystemEntry::File { .. } =&gt; 1,\n            FileSystemEntry::Directory { children, .. } =&gt; {\n                children.iter().map(|c| c.file_count()).sum()\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"rust/07-composite-pattern/#5-expression-composite","title":"5. Expression \u306e\u4f8b - \u6570\u5f0f\u306e Composite \u30d1\u30bf\u30fc\u30f3","text":"<pre><code>/// \u6570\u5f0f\n#[derive(Debug, Clone, PartialEq)]\npub enum Expression {\n    Number(f64),\n    Variable { name: String, value: Option&lt;f64&gt; },\n    Add(Box&lt;Expression&gt;, Box&lt;Expression&gt;),\n    Subtract(Box&lt;Expression&gt;, Box&lt;Expression&gt;),\n    Multiply(Box&lt;Expression&gt;, Box&lt;Expression&gt;),\n    Divide(Box&lt;Expression&gt;, Box&lt;Expression&gt;),\n}\n\nimpl Expression {\n    pub fn evaluate(&amp;self) -&gt; Result&lt;f64, String&gt; {\n        match self {\n            Expression::Number(n) =&gt; Ok(*n),\n            Expression::Variable { name, value } =&gt; {\n                value.ok_or_else(|| format!(\"Variable {} has no value\", name))\n            }\n            Expression::Add(left, right) =&gt; {\n                Ok(left.evaluate()? + right.evaluate()?)\n            }\n            Expression::Multiply(left, right) =&gt; {\n                Ok(left.evaluate()? * right.evaluate()?)\n            }\n            // ... \u4ed6\u306e\u6f14\u7b97\n        }\n    }\n\n    pub fn simplify(&amp;self) -&gt; Expression {\n        match self {\n            Expression::Add(left, right) =&gt; {\n                let l = left.simplify();\n                let r = right.simplify();\n                match (&amp;l, &amp;r) {\n                    (Expression::Number(0.0), _) =&gt; r,\n                    (_, Expression::Number(0.0)) =&gt; l,\n                    (Expression::Number(a), Expression::Number(b)) =&gt; {\n                        Expression::Number(a + b)\n                    }\n                    _ =&gt; Expression::Add(Box::new(l), Box::new(r)),\n                }\n            }\n            // ... \u4ed6\u306e\u6f14\u7b97\n            _ =&gt; self.clone(),\n        }\n    }\n}\n</code></pre>"},{"location":"rust/07-composite-pattern/#6","title":"6. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u7d71\u4e00\u7684\u306a\u64cd\u4f5c: \u500b\u3005\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u30b0\u30eb\u30fc\u30d7\u3092\u540c\u3058\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u64cd\u4f5c\u53ef\u80fd</li> <li>\u968e\u5c64\u69cb\u9020: \u30cd\u30b9\u30c8\u3057\u305f\u69cb\u9020\u3092\u81ea\u7136\u306b\u8868\u73fe\u53ef\u80fd</li> <li>\u62e1\u5f35\u6027: enum \u306b\u30d0\u30ea\u30a2\u30f3\u30c8\u3092\u8ffd\u52a0\u3059\u308b\u3053\u3068\u3067\u65b0\u3057\u3044\u578b\u3092\u8ffd\u52a0\u53ef\u80fd</li> <li>\u578b\u5b89\u5168\u6027: Rust \u306e enum \u306b\u3088\u308b\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u3067\u7db2\u7f85\u6027\u30c1\u30a7\u30c3\u30af</li> </ol>"},{"location":"rust/07-composite-pattern/#7-rust","title":"7. Rust \u3067\u306e\u7279\u5fb4","text":""},{"location":"rust/07-composite-pattern/#enum_1","title":"enum \u306b\u3088\u308b\u7db2\u7f85\u6027\u30c1\u30a7\u30c3\u30af","text":"<pre><code>fn process(shape: &amp;Shape) {\n    match shape {\n        Shape::Circle { .. } =&gt; { /* ... */ }\n        Shape::Square { .. } =&gt; { /* ... */ }\n        Shape::Rectangle { .. } =&gt; { /* ... */ }\n        Shape::Triangle { .. } =&gt; { /* ... */ }\n        Shape::Composite { .. } =&gt; { /* ... */ }\n        // \u5168\u30b1\u30fc\u30b9\u3092\u30ab\u30d0\u30fc\u3057\u306a\u3044\u3068\u30b3\u30f3\u30d1\u30a4\u30eb\u30a8\u30e9\u30fc\n    }\n}\n</code></pre>"},{"location":"rust/07-composite-pattern/#_4","title":"\u6240\u6709\u6a29\u306b\u3088\u308b\u5b89\u5168\u6027","text":"<pre><code>// \u5168\u3066\u306e\u64cd\u4f5c\u304c\u65b0\u3057\u3044\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u8fd4\u3059\uff08\u5143\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u5909\u66f4\u3055\u308c\u306a\u3044\uff09\nlet original = Shape::Composite {\n    shapes: vec![Shape::Circle {\n        center: Point::new(0.0, 0.0),\n        radius: 5.0,\n    }],\n};\nlet moved = original.translate(10.0, 10.0);\n// original \u306f\u5909\u66f4\u3055\u308c\u3066\u3044\u306a\u3044\n</code></pre>"},{"location":"rust/07-composite-pattern/#scala","title":"Scala \u3068\u306e\u6bd4\u8f03","text":"\u6982\u5ff5 Scala Rust \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9 sealed trait enum Leaf/Composite case class extends trait enum variant \u30c7\u30fc\u30bf\u69cb\u9020 case class struct / enum variant \u64cd\u4f5c\u306e\u59d4\u8b72 shapes.map(...) shapes.iter().map(...).collect() \u4e0d\u5909\u6027 \u30c7\u30d5\u30a9\u30eb\u30c8 \u30c7\u30d5\u30a9\u30eb\u30c8\uff08mut \u3067\u53ef\u5909\uff09 \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1 match match"},{"location":"rust/07-composite-pattern/#_5","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Composite \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>Shape \u306e\u4f8b: \u56f3\u5f62\u306e\u79fb\u52d5\u3068\u62e1\u5927\u3092\u7d71\u4e00\u7684\u306b\u64cd\u4f5c</li> <li>Switchable \u306e\u4f8b: \u8907\u6570\u306e\u30b9\u30a4\u30c3\u30c1\u3092\u30b0\u30eb\u30fc\u30d7\u5316\u3057\u3066\u64cd\u4f5c</li> <li>FileSystem \u306e\u4f8b: \u30d5\u30a1\u30a4\u30eb\u3068\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u968e\u5c64\u69cb\u9020</li> <li>Menu \u306e\u4f8b: \u5358\u54c1\u3068\u30bb\u30c3\u30c8\u30e1\u30cb\u30e5\u30fc\u306e\u4fa1\u683c\u8a08\u7b97</li> <li>Expression \u306e\u4f8b: \u6570\u5f0f\u306e\u8a55\u4fa1\u3068\u7c21\u7565\u5316</li> </ol> <p>Composite \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30c4\u30ea\u30fc\u69cb\u9020\u306e\u30c7\u30fc\u30bf\u3092\u6271\u3046\u969b\u306b\u975e\u5e38\u306b\u6709\u52b9\u306a\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002Rust \u306e enum \u3092\u4f7f\u3046\u3053\u3068\u3067\u3001\u578b\u5b89\u5168\u3067\u4e0d\u5909\u306a\u30c4\u30ea\u30fc\u69cb\u9020\u3092\u7c21\u6f54\u306b\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"rust/07-composite-pattern/#_6","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/rust/part3/src/chapter07.rs</code></li> </ul>"},{"location":"rust/07-composite-pattern/#_7","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Decorator \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u65e2\u5b58\u306e\u6a5f\u80fd\u306b\u65b0\u3057\u3044\u6a5f\u80fd\u3092\u52d5\u7684\u306b\u8ffd\u52a0\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"rust/08-decorator-pattern/","title":"\u7b2c8\u7ae0: Decorator \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"rust/08-decorator-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Decorator \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u65e2\u5b58\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u65b0\u3057\u3044\u6a5f\u80fd\u3092\u52d5\u7684\u306b\u8ffd\u52a0\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u9ad8\u968e\u95a2\u6570\u3092\u4f7f\u3063\u3066\u95a2\u6570\u3092\u30e9\u30c3\u30d7\u3057\u3001\u6a2a\u65ad\u7684\u95a2\u5fc3\u4e8b\uff08\u30ed\u30ae\u30f3\u30b0\u3001\u30ad\u30e3\u30c3\u30b7\u30f3\u30b0\u3001\u30bf\u30a4\u30df\u30f3\u30b0\u8a08\u6e2c\u306a\u3069\uff09\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u56f3\u5f62\u306e\u64cd\u4f5c\u5c65\u6b74\u3001\u95a2\u6570\u306e\u30c7\u30b3\u30ec\u30fc\u30b7\u30e7\u30f3\u3001\u30c6\u30ad\u30b9\u30c8\u51e6\u7406\u306a\u3069\u3001\u69d8\u3005\u306a\u4f8b\u3092\u901a\u3058\u3066 Decorator \u30d1\u30bf\u30fc\u30f3\u306e Rust \u3067\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"rust/08-decorator-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":""},{"location":"rust/08-decorator-pattern/#2-journaledshape-","title":"2. JournaledShape - \u5f62\u72b6\u30c7\u30b3\u30ec\u30fc\u30bf","text":""},{"location":"rust/08-decorator-pattern/#_2","title":"\u57fa\u672c\u5b9f\u88c5","text":"<pre><code>/// \u30b8\u30e3\u30fc\u30ca\u30eb\u30a8\u30f3\u30c8\u30ea\n#[derive(Debug, Clone, PartialEq)]\npub enum JournalEntry {\n    Translate { dx: f64, dy: f64 },\n    Scale { factor: f64 },\n    Rotate { angle: f64 },\n}\n\n/// \u57fa\u672c\u7684\u306a\u5f62\u72b6 trait\npub trait Shape: Clone {\n    fn translate(&amp;self, dx: f64, dy: f64) -&gt; Self;\n    fn scale(&amp;self, factor: f64) -&gt; Self;\n    fn area(&amp;self) -&gt; f64;\n}\n\n/// \u5186\n#[derive(Debug, Clone, PartialEq)]\npub struct Circle {\n    pub center_x: f64,\n    pub center_y: f64,\n    pub radius: f64,\n}\n\nimpl Shape for Circle {\n    fn translate(&amp;self, dx: f64, dy: f64) -&gt; Circle {\n        Circle {\n            center_x: self.center_x + dx,\n            center_y: self.center_y + dy,\n            radius: self.radius,\n        }\n    }\n\n    fn scale(&amp;self, factor: f64) -&gt; Circle {\n        Circle {\n            center_x: self.center_x,\n            center_y: self.center_y,\n            radius: self.radius * factor,\n        }\n    }\n\n    fn area(&amp;self) -&gt; f64 {\n        std::f64::consts::PI * self.radius * self.radius\n    }\n}\n</code></pre>"},{"location":"rust/08-decorator-pattern/#_3","title":"\u30b8\u30e3\u30fc\u30ca\u30eb\u4ed8\u304d\u5f62\u72b6","text":"<pre><code>/// \u64cd\u4f5c\u5c65\u6b74\u3092\u8a18\u9332\u3059\u308b\u30c7\u30b3\u30ec\u30fc\u30bf\n#[derive(Debug, Clone, PartialEq)]\npub struct JournaledShape&lt;S: Shape&gt; {\n    pub shape: S,\n    pub journal: Vec&lt;JournalEntry&gt;,\n}\n\nimpl&lt;S: Shape&gt; JournaledShape&lt;S&gt; {\n    pub fn new(shape: S) -&gt; JournaledShape&lt;S&gt; {\n        JournaledShape {\n            shape,\n            journal: Vec::new(),\n        }\n    }\n\n    pub fn translate(&amp;self, dx: f64, dy: f64) -&gt; JournaledShape&lt;S&gt; {\n        JournaledShape {\n            shape: self.shape.translate(dx, dy),\n            journal: {\n                let mut j = self.journal.clone();\n                j.push(JournalEntry::Translate { dx, dy });\n                j\n            },\n        }\n    }\n\n    pub fn scale(&amp;self, factor: f64) -&gt; JournaledShape&lt;S&gt; {\n        JournaledShape {\n            shape: self.shape.scale(factor),\n            journal: {\n                let mut j = self.journal.clone();\n                j.push(JournalEntry::Scale { factor });\n                j\n            },\n        }\n    }\n\n    pub fn operation_count(&amp;self) -&gt; usize {\n        self.journal.len()\n    }\n}\n</code></pre>"},{"location":"rust/08-decorator-pattern/#_4","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>let circle = Circle::new(0.0, 0.0, 10.0);\nlet journaled = JournaledShape::new(circle);\n\nlet moved = journaled.translate(5.0, 5.0);\nlet scaled = moved.scale(2.0);\n\nassert_eq!(scaled.operation_count(), 2);\nassert_eq!(scaled.shape.radius, 20.0);\n</code></pre>"},{"location":"rust/08-decorator-pattern/#3","title":"3. \u95a2\u6570\u30c7\u30b3\u30ec\u30fc\u30bf","text":""},{"location":"rust/08-decorator-pattern/#_5","title":"\u30ed\u30ae\u30f3\u30b0\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>/// \u30ed\u30ae\u30f3\u30b0\u30c7\u30b3\u30ec\u30fc\u30bf\npub fn with_logging&lt;A, B, F&gt;(\n    f: F,\n    name: &amp;str,\n    logs: Rc&lt;RefCell&lt;Vec&lt;String&gt;&gt;&gt;,\n) -&gt; impl Fn(A) -&gt; B\nwhere\n    F: Fn(A) -&gt; B,\n    A: std::fmt::Debug,\n    B: std::fmt::Debug,\n{\n    let name = name.to_string();\n    move |arg: A| {\n        logs.borrow_mut()\n            .push(format!(\"{} called with {:?}\", name, arg));\n        let result = f(arg);\n        logs.borrow_mut()\n            .push(format!(\"{} returned {:?}\", name, result));\n        result\n    }\n}\n</code></pre>"},{"location":"rust/08-decorator-pattern/#_6","title":"\u30bf\u30a4\u30df\u30f3\u30b0\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>/// \u5b9f\u884c\u6642\u9593\u3092\u8a08\u6e2c\u3059\u308b\u30c7\u30b3\u30ec\u30fc\u30bf\npub fn with_timing&lt;A, B, F&gt;(\n    f: F,\n    timings: Arc&lt;Mutex&lt;Vec&lt;Duration&gt;&gt;&gt;,\n) -&gt; impl Fn(A) -&gt; B\nwhere\n    F: Fn(A) -&gt; B,\n{\n    move |arg: A| {\n        let start = Instant::now();\n        let result = f(arg);\n        let elapsed = start.elapsed();\n        timings.lock().unwrap().push(elapsed);\n        result\n    }\n}\n</code></pre>"},{"location":"rust/08-decorator-pattern/#_7","title":"\u30ad\u30e3\u30c3\u30b7\u30e5\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>/// \u7d50\u679c\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3059\u308b\u30c7\u30b3\u30ec\u30fc\u30bf\npub fn with_memoization&lt;A, B, F&gt;(f: F) -&gt; impl Fn(A) -&gt; B\nwhere\n    F: Fn(A) -&gt; B,\n    A: Clone + std::hash::Hash + Eq,\n    B: Clone,\n{\n    let cache = Rc::new(RefCell::new(HashMap::new()));\n    move |arg: A| {\n        let mut cache = cache.borrow_mut();\n        if let Some(result) = cache.get(&amp;arg) {\n            return result.clone();\n        }\n        let result = f(arg.clone());\n        cache.insert(arg, result.clone());\n        result\n    }\n}\n</code></pre>"},{"location":"rust/08-decorator-pattern/#_8","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// \u30ed\u30ae\u30f3\u30b0\u4ed8\u304d\u95a2\u6570\nlet logs = Rc::new(RefCell::new(Vec::new()));\nlet add_one = |x: i32| x + 1;\nlet logged_add = with_logging(add_one, \"add_one\", logs.clone());\n\nlet result = logged_add(5);\nassert_eq!(result, 6);\nassert_eq!(logs.borrow().len(), 2);\n\n// \u30e1\u30e2\u5316\u4ed8\u304d\u30d5\u30a3\u30dc\u30ca\u30c3\u30c1\nlet fib = with_memoization(|n: u64| {\n    if n &lt;= 1 { n } else { /* recursive call */ n }\n});\n</code></pre>"},{"location":"rust/08-decorator-pattern/#4","title":"4. \u30c6\u30ad\u30b9\u30c8\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>/// \u30c6\u30ad\u30b9\u30c8\u5909\u63db\u30bf\u30a4\u30d7\npub type TextTransformer = Box&lt;dyn Fn(&amp;str) -&gt; String&gt;;\n\n/// \u5927\u6587\u5b57\u5909\u63db\npub fn uppercase() -&gt; TextTransformer {\n    Box::new(|s: &amp;str| s.to_uppercase())\n}\n\n/// \u30c8\u30ea\u30e0\npub fn trim() -&gt; TextTransformer {\n    Box::new(|s: &amp;str| s.trim().to_string())\n}\n\n/// \u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u8ffd\u52a0\npub fn add_prefix(prefix: &amp;str) -&gt; TextTransformer {\n    let prefix = prefix.to_string();\n    Box::new(move |s: &amp;str| format!(\"{}{}\", prefix, s))\n}\n\n/// \u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u5408\u6210\npub fn compose_transformers(transformers: Vec&lt;TextTransformer&gt;) -&gt; TextTransformer {\n    Box::new(move |s: &amp;str| {\n        transformers\n            .iter()\n            .fold(s.to_string(), |acc, t| t(&amp;acc))\n    })\n}\n</code></pre>"},{"location":"rust/08-decorator-pattern/#_9","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>let transform = compose_transformers(vec![\n    trim(),\n    uppercase(),\n    add_prefix(\"&gt;&gt;&gt; \"),\n]);\n\nlet result = transform(\"  hello world  \");\nassert_eq!(result, \"&gt;&gt;&gt; HELLO WORLD\");\n</code></pre>"},{"location":"rust/08-decorator-pattern/#5","title":"5. \u30ea\u30c8\u30e9\u30a4\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>/// \u30ea\u30c8\u30e9\u30a4\u30c7\u30b3\u30ec\u30fc\u30bf\npub fn with_retry&lt;A, B, E, F&gt;(\n    f: F,\n    max_retries: usize,\n) -&gt; impl Fn(A) -&gt; Result&lt;B, E&gt;\nwhere\n    F: Fn(A) -&gt; Result&lt;B, E&gt;,\n    A: Clone,\n{\n    move |arg: A| {\n        let mut attempts = 0;\n        loop {\n            match f(arg.clone()) {\n                Ok(result) =&gt; return Ok(result),\n                Err(e) if attempts &lt; max_retries =&gt; {\n                    attempts += 1;\n                    continue;\n                }\n                Err(e) =&gt; return Err(e),\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"rust/08-decorator-pattern/#6","title":"6. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u95a2\u5fc3\u306e\u5206\u96e2: \u672c\u8cea\u7684\u306a\u30ed\u30b8\u30c3\u30af\u3068\u6a2a\u65ad\u7684\u95a2\u5fc3\u4e8b\u3092\u5206\u96e2</li> <li>\u518d\u5229\u7528\u6027: \u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u69d8\u3005\u306a\u95a2\u6570/\u578b\u306b\u9069\u7528\u53ef\u80fd</li> <li>\u5408\u6210\u53ef\u80fd: \u8907\u6570\u306e\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u7d44\u307f\u5408\u308f\u305b\u53ef\u80fd</li> <li>\u30c6\u30b9\u30c8\u5bb9\u6613\u6027: \u5404\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u72ec\u7acb\u3057\u3066\u30c6\u30b9\u30c8\u53ef\u80fd</li> </ol>"},{"location":"rust/08-decorator-pattern/#7-rust","title":"7. Rust \u3067\u306e\u7279\u5fb4","text":""},{"location":"rust/08-decorator-pattern/#_10","title":"\u30b8\u30a7\u30cd\u30ea\u30af\u30b9\u3068\u30c8\u30ec\u30a4\u30c8\u5883\u754c","text":"<pre><code>pub fn with_logging&lt;A, B, F&gt;(f: F, ...) -&gt; impl Fn(A) -&gt; B\nwhere\n    F: Fn(A) -&gt; B,\n    A: std::fmt::Debug,\n    B: std::fmt::Debug,\n</code></pre>"},{"location":"rust/08-decorator-pattern/#_11","title":"\u30af\u30ed\u30fc\u30b8\u30e3\u306b\u3088\u308b\u30ab\u30d7\u30bb\u30eb\u5316","text":"<pre><code>// \u72b6\u614b\u3092\u30af\u30ed\u30fc\u30b8\u30e3\u5185\u306b\u30ad\u30e3\u30d7\u30c1\u30e3\nlet cache = Rc::new(RefCell::new(HashMap::new()));\nmove |arg: A| {\n    // cache \u3092\u4f7f\u7528\n}\n</code></pre>"},{"location":"rust/08-decorator-pattern/#_12","title":"\u6240\u6709\u6a29\u3068\u501f\u7528","text":"<pre><code>// Rc&lt;RefCell&lt;T&gt;&gt; \u3067\u5171\u6709\u53ef\u5909\u72b6\u614b\u3092\u7ba1\u7406\nlet logs = Rc::new(RefCell::new(Vec::new()));\nlet logged_fn = with_logging(f, \"name\", logs.clone());\n</code></pre>"},{"location":"rust/08-decorator-pattern/#scala","title":"Scala \u3068\u306e\u6bd4\u8f03","text":"\u6982\u5ff5 Scala Rust \u9ad8\u968e\u95a2\u6570 <code>(A =&gt; B) =&gt; (A =&gt; B)</code> <code>Fn(A) -&gt; B</code> \u72b6\u614b\u7ba1\u7406 var / mutable collection Rc&gt; \u578b\u5236\u7d04 \u6697\u9ed9\u7684\u306a\u578b\u63a8\u8ad6 where \u53e5\u3067\u30c8\u30ec\u30a4\u30c8\u5883\u754c \u30af\u30ed\u30fc\u30b8\u30e3 \u81ea\u52d5\u30ad\u30e3\u30d7\u30c1\u30e3 move \u3067\u6240\u6709\u6a29\u79fb\u52d5"},{"location":"rust/08-decorator-pattern/#_13","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Decorator \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>JournaledShape: \u64cd\u4f5c\u5c65\u6b74\u3092\u8a18\u9332\u3059\u308b\u56f3\u5f62\u30c7\u30b3\u30ec\u30fc\u30bf</li> <li>\u30ed\u30ae\u30f3\u30b0\u30c7\u30b3\u30ec\u30fc\u30bf: \u95a2\u6570\u547c\u3073\u51fa\u3057\u3092\u30ed\u30b0\u306b\u8a18\u9332</li> <li>\u30bf\u30a4\u30df\u30f3\u30b0\u30c7\u30b3\u30ec\u30fc\u30bf: \u5b9f\u884c\u6642\u9593\u3092\u8a08\u6e2c</li> <li>\u30ad\u30e3\u30c3\u30b7\u30e5\u30c7\u30b3\u30ec\u30fc\u30bf: \u7d50\u679c\u3092\u30e1\u30e2\u5316</li> <li>\u30c6\u30ad\u30b9\u30c8\u30c7\u30b3\u30ec\u30fc\u30bf: \u6587\u5b57\u5217\u5909\u63db\u306e\u5408\u6210</li> </ol> <p>Rust \u3067\u306f\u3001\u30b8\u30a7\u30cd\u30ea\u30af\u30b9\u3001\u30c8\u30ec\u30a4\u30c8\u5883\u754c\u3001\u30af\u30ed\u30fc\u30b8\u30e3\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u3053\u3068\u3067\u3001\u578b\u5b89\u5168\u3067\u67d4\u8edf\u306a\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"rust/08-decorator-pattern/#_14","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/rust/part3/src/chapter08.rs</code></li> </ul>"},{"location":"rust/08-decorator-pattern/#_15","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Adapter \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u7570\u306a\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u9593\u306e\u5909\u63db\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"rust/09-adapter-pattern/","title":"\u7b2c9\u7ae0: Adapter \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"rust/09-adapter-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Adapter \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u4e92\u63db\u6027\u306e\u306a\u3044\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u6301\u3064\u30af\u30e9\u30b9\u3092\u5354\u8abf\u3057\u3066\u52d5\u4f5c\u3055\u305b\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u30c7\u30fc\u30bf\u5909\u63db\u95a2\u6570\u3092\u4f7f\u3063\u3066\u7570\u306a\u308b\u30c7\u30fc\u30bf\u5f62\u5f0f\u9593\u306e\u5909\u63db\u3092\u884c\u3044\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u6e29\u5ea6\u5909\u63db\u3001\u30c7\u30fc\u30bf\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u5909\u63db\u3001\u30ec\u30ac\u30b7\u30fc\u30b7\u30b9\u30c6\u30e0\u3068\u306e\u7d71\u5408\u306a\u3069\u3001\u69d8\u3005\u306a\u4f8b\u3092\u901a\u3058\u3066 Adapter \u30d1\u30bf\u30fc\u30f3\u306e Rust \u3067\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"rust/09-adapter-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":""},{"location":"rust/09-adapter-pattern/#2","title":"2. \u6e29\u5ea6\u5909\u63db\u30a2\u30c0\u30d7\u30bf","text":"<pre><code>/// \u6442\u6c0f\u6e29\u5ea6\n#[derive(Debug, Clone, PartialEq)]\npub struct Celsius(pub f64);\n\n/// \u83ef\u6c0f\u6e29\u5ea6\n#[derive(Debug, Clone, PartialEq)]\npub struct Fahrenheit(pub f64);\n\n/// \u30b1\u30eb\u30d3\u30f3\u6e29\u5ea6\n#[derive(Debug, Clone, PartialEq)]\npub struct Kelvin(pub f64);\n\n/// \u6e29\u5ea6\u5909\u63db\u30c8\u30ec\u30a4\u30c8\npub trait TemperatureConverter {\n    fn to_celsius(&amp;self) -&gt; Celsius;\n    fn to_fahrenheit(&amp;self) -&gt; Fahrenheit;\n    fn to_kelvin(&amp;self) -&gt; Kelvin;\n}\n\nimpl TemperatureConverter for Celsius {\n    fn to_celsius(&amp;self) -&gt; Celsius {\n        self.clone()\n    }\n\n    fn to_fahrenheit(&amp;self) -&gt; Fahrenheit {\n        Fahrenheit(self.0 * 9.0 / 5.0 + 32.0)\n    }\n\n    fn to_kelvin(&amp;self) -&gt; Kelvin {\n        Kelvin(self.0 + 273.15)\n    }\n}\n\nimpl TemperatureConverter for Fahrenheit {\n    fn to_celsius(&amp;self) -&gt; Celsius {\n        Celsius((self.0 - 32.0) * 5.0 / 9.0)\n    }\n\n    fn to_fahrenheit(&amp;self) -&gt; Fahrenheit {\n        self.clone()\n    }\n\n    fn to_kelvin(&amp;self) -&gt; Kelvin {\n        self.to_celsius().to_kelvin()\n    }\n}\n</code></pre>"},{"location":"rust/09-adapter-pattern/#_2","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>let celsius = Celsius(100.0);\nlet fahrenheit = celsius.to_fahrenheit();\nassert_eq!(fahrenheit.0, 212.0);\n\nlet kelvin = celsius.to_kelvin();\nassert_eq!(kelvin.0, 373.15);\n</code></pre>"},{"location":"rust/09-adapter-pattern/#3","title":"3. \u30c7\u30fc\u30bf\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u30a2\u30c0\u30d7\u30bf","text":"<pre><code>/// \u30ec\u30ac\u30b7\u30fc\u30e6\u30fc\u30b6\u30fc\u30c7\u30fc\u30bf\n#[derive(Debug, Clone)]\npub struct LegacyUser {\n    pub first_name: String,\n    pub last_name: String,\n    pub email_address: String,\n    pub phone_number: String,\n}\n\n/// \u65b0\u3057\u3044\u30e6\u30fc\u30b6\u30fc\u30c7\u30fc\u30bf\n#[derive(Debug, Clone)]\npub struct NewUser {\n    pub name: String,\n    pub email: String,\n    pub contacts: Vec&lt;Contact&gt;,\n}\n\n#[derive(Debug, Clone)]\npub struct Contact {\n    pub contact_type: String,\n    pub value: String,\n}\n\n/// \u30ec\u30ac\u30b7\u30fc\u304b\u3089\u65b0\u5f62\u5f0f\u3078\u306e\u5909\u63db\nimpl From&lt;LegacyUser&gt; for NewUser {\n    fn from(legacy: LegacyUser) -&gt; NewUser {\n        NewUser {\n            name: format!(\"{} {}\", legacy.first_name, legacy.last_name),\n            email: legacy.email_address,\n            contacts: vec![Contact {\n                contact_type: \"phone\".to_string(),\n                value: legacy.phone_number,\n            }],\n        }\n    }\n}\n\n/// \u65b0\u5f62\u5f0f\u304b\u3089\u30ec\u30ac\u30b7\u30fc\u3078\u306e\u5909\u63db\nimpl From&lt;NewUser&gt; for LegacyUser {\n    fn from(new_user: NewUser) -&gt; LegacyUser {\n        let name_parts: Vec&lt;&amp;str&gt; = new_user.name.split_whitespace().collect();\n        let phone = new_user\n            .contacts\n            .iter()\n            .find(|c| c.contact_type == \"phone\")\n            .map(|c| c.value.clone())\n            .unwrap_or_default();\n\n        LegacyUser {\n            first_name: name_parts.first().unwrap_or(&amp;\"\").to_string(),\n            last_name: name_parts.get(1).unwrap_or(&amp;\"\").to_string(),\n            email_address: new_user.email,\n            phone_number: phone,\n        }\n    }\n}\n</code></pre>"},{"location":"rust/09-adapter-pattern/#4-api","title":"4. \u5916\u90e8 API \u30a2\u30c0\u30d7\u30bf","text":"<pre><code>/// \u5916\u90e8 API \u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u5f62\u5f0f\n#[derive(Debug, Clone)]\npub struct ExternalApiResponse {\n    pub status_code: i32,\n    pub body: String,\n    pub headers: HashMap&lt;String, String&gt;,\n}\n\n/// \u5185\u90e8\u5f62\u5f0f\n#[derive(Debug, Clone)]\npub struct InternalResponse {\n    pub success: bool,\n    pub data: String,\n    pub metadata: ResponseMetadata,\n}\n\n#[derive(Debug, Clone)]\npub struct ResponseMetadata {\n    pub content_type: String,\n    pub timestamp: i64,\n}\n\n/// \u30a2\u30c0\u30d7\u30bf\u95a2\u6570\npub fn adapt_external_response(external: ExternalApiResponse) -&gt; InternalResponse {\n    InternalResponse {\n        success: external.status_code &gt;= 200 &amp;&amp; external.status_code &lt; 300,\n        data: external.body,\n        metadata: ResponseMetadata {\n            content_type: external\n                .headers\n                .get(\"Content-Type\")\n                .cloned()\n                .unwrap_or_else(|| \"application/json\".to_string()),\n            timestamp: std::time::SystemTime::now()\n                .duration_since(std::time::UNIX_EPOCH)\n                .unwrap()\n                .as_secs() as i64,\n        },\n    }\n}\n</code></pre>"},{"location":"rust/09-adapter-pattern/#5","title":"5. \u95a2\u6570\u30a2\u30c0\u30d7\u30bf","text":"<pre><code>/// \u7570\u306a\u308b\u5f15\u6570\u306e\u9806\u5e8f\u3092\u9069\u5fdc\npub fn swap_args&lt;A, B, C, F&gt;(f: F) -&gt; impl Fn(B, A) -&gt; C\nwhere\n    F: Fn(A, B) -&gt; C,\n{\n    move |b, a| f(a, b)\n}\n\n/// \u30ab\u30ea\u30fc\u5316\npub fn curry&lt;A, B, C, F&gt;(f: F) -&gt; impl Fn(A) -&gt; Box&lt;dyn Fn(B) -&gt; C&gt;\nwhere\n    F: Fn(A, B) -&gt; C + Clone + 'static,\n    A: Clone + 'static,\n{\n    move |a: A| {\n        let f = f.clone();\n        let a = a.clone();\n        Box::new(move |b: B| f(a.clone(), b))\n    }\n}\n\n/// \u90e8\u5206\u9069\u7528\npub fn partial&lt;A, B, C, F&gt;(f: F, a: A) -&gt; impl Fn(B) -&gt; C\nwhere\n    F: Fn(A, B) -&gt; C,\n    A: Clone,\n{\n    move |b: B| f(a.clone(), b)\n}\n</code></pre>"},{"location":"rust/09-adapter-pattern/#_3","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>let divide = |a: f64, b: f64| a / b;\nlet swapped = swap_args(divide);\n\nassert_eq!(divide(10.0, 2.0), 5.0);\nassert_eq!(swapped(2.0, 10.0), 5.0);\n\nlet add = |a: i32, b: i32| a + b;\nlet add_5 = partial(add, 5);\nassert_eq!(add_5(3), 8);\n</code></pre>"},{"location":"rust/09-adapter-pattern/#6","title":"6. \u30a4\u30c6\u30ec\u30fc\u30bf\u30a2\u30c0\u30d7\u30bf","text":"<pre><code>/// \u30ab\u30b9\u30bf\u30e0\u30a4\u30c6\u30ec\u30fc\u30bf\u30a2\u30c0\u30d7\u30bf\npub trait IteratorAdapter: Iterator {\n    /// \u8981\u7d20\u3092\u30b0\u30eb\u30fc\u30d7\u5316\n    fn group_by_key&lt;K, F&gt;(self, key_fn: F) -&gt; HashMap&lt;K, Vec&lt;Self::Item&gt;&gt;\n    where\n        Self: Sized,\n        K: Eq + std::hash::Hash,\n        F: Fn(&amp;Self::Item) -&gt; K,\n    {\n        let mut groups = HashMap::new();\n        for item in self {\n            let key = key_fn(&amp;item);\n            groups.entry(key).or_insert_with(Vec::new).push(item);\n        }\n        groups\n    }\n\n    /// \u30a6\u30a3\u30f3\u30c9\u30a6\u3092\u4f5c\u6210\n    fn windowed(self, size: usize) -&gt; Vec&lt;Vec&lt;Self::Item&gt;&gt;\n    where\n        Self: Sized,\n        Self::Item: Clone,\n    {\n        let items: Vec&lt;_&gt; = self.collect();\n        items.windows(size).map(|w| w.to_vec()).collect()\n    }\n}\n\nimpl&lt;I: Iterator&gt; IteratorAdapter for I {}\n</code></pre>"},{"location":"rust/09-adapter-pattern/#7","title":"7. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u4e92\u63db\u6027: \u7570\u306a\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u9593\u306e\u6a4b\u6e21\u3057</li> <li>\u518d\u5229\u7528: \u65e2\u5b58\u30b3\u30fc\u30c9\u3092\u65b0\u3057\u3044\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3067\u5229\u7528\u53ef\u80fd</li> <li>\u5206\u96e2: \u5909\u63db\u30ed\u30b8\u30c3\u30af\u3092\u4e00\u7b87\u6240\u306b\u96c6\u7d04</li> <li>\u30c6\u30b9\u30c8\u5bb9\u6613\u6027: \u5909\u63db\u30ed\u30b8\u30c3\u30af\u3092\u72ec\u7acb\u3057\u3066\u30c6\u30b9\u30c8\u53ef\u80fd</li> </ol>"},{"location":"rust/09-adapter-pattern/#rust","title":"Rust \u3067\u306e\u7279\u5fb4","text":""},{"location":"rust/09-adapter-pattern/#frominto","title":"From/Into \u30c8\u30ec\u30a4\u30c8","text":"<pre><code>impl From&lt;LegacyUser&gt; for NewUser {\n    fn from(legacy: LegacyUser) -&gt; NewUser {\n        // \u5909\u63db\u30ed\u30b8\u30c3\u30af\n    }\n}\n\n// \u4f7f\u7528\nlet new_user: NewUser = legacy_user.into();\n</code></pre>"},{"location":"rust/09-adapter-pattern/#_4","title":"\u578b\u5b89\u5168\u306a\u5909\u63db","text":"<pre><code>// \u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u306b\u578b\u30c1\u30a7\u30c3\u30af\nlet celsius = Celsius(100.0);\nlet fahrenheit: Fahrenheit = celsius.to_fahrenheit();\n// \u578b\u304c\u7570\u306a\u308b\u306e\u3067\u76f4\u63a5\u4ee3\u5165\u3067\u304d\u306a\u3044\n</code></pre>"},{"location":"rust/09-adapter-pattern/#_5","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Adapter \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u6e29\u5ea6\u5909\u63db\u30a2\u30c0\u30d7\u30bf: \u7570\u306a\u308b\u6e29\u5ea6\u5358\u4f4d\u9593\u306e\u5909\u63db</li> <li>\u30c7\u30fc\u30bf\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u30a2\u30c0\u30d7\u30bf: \u30ec\u30ac\u30b7\u30fc\u5f62\u5f0f\u3068\u65b0\u5f62\u5f0f\u306e\u76f8\u4e92\u5909\u63db</li> <li>\u5916\u90e8 API \u30a2\u30c0\u30d7\u30bf: \u5916\u90e8\u30c7\u30fc\u30bf\u3092\u5185\u90e8\u5f62\u5f0f\u306b\u9069\u5408</li> <li>\u95a2\u6570\u30a2\u30c0\u30d7\u30bf: \u5f15\u6570\u306e\u9806\u5e8f\u3084\u6570\u3092\u8abf\u6574</li> <li>\u30a4\u30c6\u30ec\u30fc\u30bf\u30a2\u30c0\u30d7\u30bf: \u30a4\u30c6\u30ec\u30fc\u30bf\u306b\u8ffd\u52a0\u6a5f\u80fd\u3092\u63d0\u4f9b</li> </ol> <p>Rust \u306e From/Into \u30c8\u30ec\u30a4\u30c8\u3068\u5f37\u3044\u578b\u30b7\u30b9\u30c6\u30e0\u3092\u6d3b\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u578b\u5b89\u5168\u306a\u5909\u63db\u3092\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"rust/09-adapter-pattern/#_6","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/rust/part3/src/chapter09.rs</code></li> </ul>"},{"location":"rust/09-adapter-pattern/#_7","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Strategy \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u30ab\u30d7\u30bb\u30eb\u5316\u3057\u3066\u4ea4\u63db\u53ef\u80fd\u306b\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"rust/10-strategy-pattern/","title":"\u7b2c10\u7ae0: Strategy \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"rust/10-strategy-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Strategy \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u30ab\u30d7\u30bb\u30eb\u5316\u3057\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u72ec\u7acb\u3057\u3066\u4ea4\u63db\u53ef\u80fd\u306b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u95a2\u6570\u3092\u7b2c\u4e00\u7d1a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u6271\u3046\u3053\u3068\u3067\u3001\u3053\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u81ea\u7136\u306b\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u30bd\u30fc\u30c8\u6226\u7565\u3001\u4fa1\u683c\u8a08\u7b97\u3001\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3001\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u6226\u7565\u306a\u3069\u3001\u69d8\u3005\u306a\u4f8b\u3092\u901a\u3058\u3066 Strategy \u30d1\u30bf\u30fc\u30f3\u306e Rust \u3067\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"rust/10-strategy-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":""},{"location":"rust/10-strategy-pattern/#2","title":"2. \u30bd\u30fc\u30c8\u6226\u7565","text":""},{"location":"rust/10-strategy-pattern/#_2","title":"\u30c8\u30ec\u30a4\u30c8\u30d9\u30fc\u30b9\u306e\u5b9f\u88c5","text":"<pre><code>/// \u30bd\u30fc\u30c8\u6226\u7565\u30c8\u30ec\u30a4\u30c8\npub trait SortStrategy&lt;T&gt; {\n    fn sort(&amp;self, items: &amp;mut Vec&lt;T&gt;);\n}\n\n/// \u6607\u9806\u30bd\u30fc\u30c8\npub struct AscendingSort;\n\nimpl&lt;T: Ord&gt; SortStrategy&lt;T&gt; for AscendingSort {\n    fn sort(&amp;self, items: &amp;mut Vec&lt;T&gt;) {\n        items.sort();\n    }\n}\n\n/// \u964d\u9806\u30bd\u30fc\u30c8\npub struct DescendingSort;\n\nimpl&lt;T: Ord&gt; SortStrategy&lt;T&gt; for DescendingSort {\n    fn sort(&amp;self, items: &amp;mut Vec&lt;T&gt;) {\n        items.sort_by(|a, b| b.cmp(a));\n    }\n}\n\n/// \u30ab\u30b9\u30bf\u30e0\u30bd\u30fc\u30c8\npub struct CustomSort&lt;T, F: Fn(&amp;T, &amp;T) -&gt; std::cmp::Ordering&gt; {\n    comparator: F,\n    _marker: std::marker::PhantomData&lt;T&gt;,\n}\n\nimpl&lt;T, F: Fn(&amp;T, &amp;T) -&gt; std::cmp::Ordering&gt; SortStrategy&lt;T&gt; for CustomSort&lt;T, F&gt; {\n    fn sort(&amp;self, items: &amp;mut Vec&lt;T&gt;) {\n        items.sort_by(&amp;self.comparator);\n    }\n}\n</code></pre>"},{"location":"rust/10-strategy-pattern/#_3","title":"\u95a2\u6570\u30d9\u30fc\u30b9\u306e\u5b9f\u88c5","text":"<pre><code>/// \u30bd\u30fc\u30c8\u6226\u7565\uff08\u95a2\u6570\u578b\uff09\npub type SortFn&lt;T&gt; = Box&lt;dyn Fn(&amp;mut Vec&lt;T&gt;)&gt;;\n\npub fn ascending_sort&lt;T: Ord + 'static&gt;() -&gt; SortFn&lt;T&gt; {\n    Box::new(|items| items.sort())\n}\n\npub fn descending_sort&lt;T: Ord + 'static&gt;() -&gt; SortFn&lt;T&gt; {\n    Box::new(|items| items.sort_by(|a, b| b.cmp(a)))\n}\n\npub fn sort_by_key&lt;T: 'static, K: Ord&gt;(key_fn: impl Fn(&amp;T) -&gt; K + 'static) -&gt; SortFn&lt;T&gt; {\n    Box::new(move |items| items.sort_by_key(|x| key_fn(x)))\n}\n</code></pre>"},{"location":"rust/10-strategy-pattern/#_4","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>let mut numbers = vec![3, 1, 4, 1, 5, 9, 2, 6];\n\n// \u30c8\u30ec\u30a4\u30c8\u30d9\u30fc\u30b9\nAscendingSort.sort(&amp;mut numbers);\nassert_eq!(numbers, vec![1, 1, 2, 3, 4, 5, 6, 9]);\n\n// \u95a2\u6570\u30d9\u30fc\u30b9\nlet sort_desc = descending_sort::&lt;i32&gt;();\nsort_desc(&amp;mut numbers);\nassert_eq!(numbers, vec![9, 6, 5, 4, 3, 2, 1, 1]);\n</code></pre>"},{"location":"rust/10-strategy-pattern/#3","title":"3. \u4fa1\u683c\u8a08\u7b97\u6226\u7565","text":"<pre><code>/// \u4fa1\u683c\u8a08\u7b97\u6226\u7565\npub trait PricingStrategy {\n    fn calculate(&amp;self, base_price: f64) -&gt; f64;\n}\n\n/// \u901a\u5e38\u4fa1\u683c\npub struct RegularPricing;\n\nimpl PricingStrategy for RegularPricing {\n    fn calculate(&amp;self, base_price: f64) -&gt; f64 {\n        base_price\n    }\n}\n\n/// \u5272\u5f15\u4fa1\u683c\npub struct DiscountPricing {\n    pub discount_rate: f64,\n}\n\nimpl PricingStrategy for DiscountPricing {\n    fn calculate(&amp;self, base_price: f64) -&gt; f64 {\n        base_price * (1.0 - self.discount_rate)\n    }\n}\n\n/// \u4f1a\u54e1\u4fa1\u683c\npub struct MemberPricing {\n    pub member_discount: f64,\n    pub points_discount: f64,\n}\n\nimpl PricingStrategy for MemberPricing {\n    fn calculate(&amp;self, base_price: f64) -&gt; f64 {\n        base_price * (1.0 - self.member_discount) - self.points_discount\n    }\n}\n\n/// \u4fa1\u683c\u8a08\u7b97\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\npub struct PriceCalculator {\n    strategy: Box&lt;dyn PricingStrategy&gt;,\n}\n\nimpl PriceCalculator {\n    pub fn new(strategy: Box&lt;dyn PricingStrategy&gt;) -&gt; Self {\n        PriceCalculator { strategy }\n    }\n\n    pub fn calculate(&amp;self, base_price: f64) -&gt; f64 {\n        self.strategy.calculate(base_price)\n    }\n}\n</code></pre>"},{"location":"rust/10-strategy-pattern/#_5","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>let regular = PriceCalculator::new(Box::new(RegularPricing));\nassert_eq!(regular.calculate(100.0), 100.0);\n\nlet discount = PriceCalculator::new(Box::new(DiscountPricing { discount_rate: 0.2 }));\nassert_eq!(discount.calculate(100.0), 80.0);\n\nlet member = PriceCalculator::new(Box::new(MemberPricing {\n    member_discount: 0.1,\n    points_discount: 5.0,\n}));\nassert_eq!(member.calculate(100.0), 85.0);\n</code></pre>"},{"location":"rust/10-strategy-pattern/#4","title":"4. \u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u6226\u7565","text":"<pre><code>/// \u30d5\u30a3\u30eb\u30bf\u6226\u7565\npub type FilterFn&lt;T&gt; = Box&lt;dyn Fn(&amp;T) -&gt; bool&gt;;\n\n/// \u30d5\u30a3\u30eb\u30bf\u3092\u5408\u6210\npub fn and_filter&lt;T: 'static&gt;(\n    f1: FilterFn&lt;T&gt;,\n    f2: FilterFn&lt;T&gt;,\n) -&gt; FilterFn&lt;T&gt; {\n    Box::new(move |item| f1(item) &amp;&amp; f2(item))\n}\n\npub fn or_filter&lt;T: 'static&gt;(\n    f1: FilterFn&lt;T&gt;,\n    f2: FilterFn&lt;T&gt;,\n) -&gt; FilterFn&lt;T&gt; {\n    Box::new(move |item| f1(item) || f2(item))\n}\n\npub fn not_filter&lt;T: 'static&gt;(f: FilterFn&lt;T&gt;) -&gt; FilterFn&lt;T&gt; {\n    Box::new(move |item| !f(item))\n}\n</code></pre>"},{"location":"rust/10-strategy-pattern/#_6","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>let is_positive: FilterFn&lt;i32&gt; = Box::new(|&amp;x| x &gt; 0);\nlet is_even: FilterFn&lt;i32&gt; = Box::new(|&amp;x| x % 2 == 0);\n\nlet is_positive_and_even = and_filter(is_positive, is_even);\n\nlet numbers = vec![-4, -2, 0, 2, 4, 6];\nlet filtered: Vec&lt;_&gt; = numbers.iter().filter(|x| is_positive_and_even(x)).collect();\nassert_eq!(filtered, vec![&amp;2, &amp;4, &amp;6]);\n</code></pre>"},{"location":"rust/10-strategy-pattern/#5","title":"5. \u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u6226\u7565","text":"<pre><code>/// \u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u6226\u7565\npub trait FormatStrategy {\n    fn format(&amp;self, data: &amp;Data) -&gt; String;\n}\n\n#[derive(Debug)]\npub struct Data {\n    pub name: String,\n    pub value: f64,\n}\n\n/// JSON \u30d5\u30a9\u30fc\u30de\u30c3\u30c8\npub struct JsonFormat;\n\nimpl FormatStrategy for JsonFormat {\n    fn format(&amp;self, data: &amp;Data) -&gt; String {\n        format!(r#\"{{\"name\":\"{}\",\"value\":{}}}\"#, data.name, data.value)\n    }\n}\n\n/// XML \u30d5\u30a9\u30fc\u30de\u30c3\u30c8\npub struct XmlFormat;\n\nimpl FormatStrategy for XmlFormat {\n    fn format(&amp;self, data: &amp;Data) -&gt; String {\n        format!(\n            \"&lt;data&gt;&lt;name&gt;{}&lt;/name&gt;&lt;value&gt;{}&lt;/value&gt;&lt;/data&gt;\",\n            data.name, data.value\n        )\n    }\n}\n\n/// CSV \u30d5\u30a9\u30fc\u30de\u30c3\u30c8\npub struct CsvFormat;\n\nimpl FormatStrategy for CsvFormat {\n    fn format(&amp;self, data: &amp;Data) -&gt; String {\n        format!(\"{},{}\", data.name, data.value)\n    }\n}\n</code></pre>"},{"location":"rust/10-strategy-pattern/#6","title":"6. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u67d4\u8edf\u6027: \u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u5b9f\u884c\u6642\u306b\u5207\u308a\u66ff\u3048\u53ef\u80fd</li> <li>\u5206\u96e2: \u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u5b9f\u88c5\u3068\u4f7f\u7528\u3092\u5206\u96e2</li> <li>\u30c6\u30b9\u30c8\u5bb9\u6613\u6027: \u5404\u6226\u7565\u3092\u72ec\u7acb\u3057\u3066\u30c6\u30b9\u30c8\u53ef\u80fd</li> <li>\u62e1\u5f35\u6027: \u65b0\u3057\u3044\u6226\u7565\u3092\u7c21\u5358\u306b\u8ffd\u52a0\u53ef\u80fd</li> </ol>"},{"location":"rust/10-strategy-pattern/#7-rust","title":"7. Rust \u3067\u306e\u7279\u5fb4","text":""},{"location":"rust/10-strategy-pattern/#_7","title":"\u30af\u30ed\u30fc\u30b8\u30e3\u306b\u3088\u308b\u7c21\u6f54\u306a\u5b9f\u88c5","text":"<pre><code>// \u95a2\u6570\u3068\u3057\u3066\u6226\u7565\u3092\u6e21\u3059\nfn process_with_strategy&lt;T, F&gt;(items: &amp;[T], strategy: F) -&gt; Vec&lt;T&gt;\nwhere\n    F: Fn(&amp;T) -&gt; T,\n    T: Clone,\n{\n    items.iter().map(|x| strategy(x)).collect()\n}\n\n// \u4f7f\u7528\nlet doubled = process_with_strategy(&amp;[1, 2, 3], |x| x * 2);\n</code></pre>"},{"location":"rust/10-strategy-pattern/#vs","title":"\u30c8\u30ec\u30a4\u30c8\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 vs \u30b8\u30a7\u30cd\u30ea\u30af\u30b9","text":"<pre><code>// \u30c8\u30ec\u30a4\u30c8\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\uff08\u52d5\u7684\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\uff09\nfn with_dyn(strategy: &amp;dyn PricingStrategy, price: f64) -&gt; f64 {\n    strategy.calculate(price)\n}\n\n// \u30b8\u30a7\u30cd\u30ea\u30af\u30b9\uff08\u9759\u7684\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\uff09\nfn with_generic&lt;S: PricingStrategy&gt;(strategy: &amp;S, price: f64) -&gt; f64 {\n    strategy.calculate(price)\n}\n</code></pre>"},{"location":"rust/10-strategy-pattern/#scala","title":"Scala \u3068\u306e\u6bd4\u8f03","text":"\u6982\u5ff5 Scala Rust \u6226\u7565\u5b9a\u7fa9 trait trait \u95a2\u6570\u6226\u7565 <code>A =&gt; B</code> <code>Fn(A) -&gt; B</code> \u52d5\u7684\u9078\u629e Any / type test Box \u5408\u6210 andThen/compose \u30ab\u30b9\u30bf\u30e0\u95a2\u6570"},{"location":"rust/10-strategy-pattern/#_8","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Strategy \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30bd\u30fc\u30c8\u6226\u7565: \u7570\u306a\u308b\u30bd\u30fc\u30c8\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u5207\u308a\u66ff\u3048</li> <li>\u4fa1\u683c\u8a08\u7b97\u6226\u7565: \u69d8\u3005\u306a\u4fa1\u683c\u8a08\u7b97\u30eb\u30fc\u30eb\u3092\u9069\u7528</li> <li>\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u6226\u7565: \u30d5\u30a3\u30eb\u30bf\u3092\u5408\u6210\u3057\u3066\u8907\u96d1\u306a\u6761\u4ef6\u3092\u8868\u73fe</li> <li>\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u6226\u7565: \u7570\u306a\u308b\u51fa\u529b\u5f62\u5f0f\u306b\u5bfe\u5fdc</li> </ol> <p>Rust \u3067\u306f\u3001\u30c8\u30ec\u30a4\u30c8\u3068\u30af\u30ed\u30fc\u30b8\u30e3\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u3053\u3068\u3067\u3001\u578b\u5b89\u5168\u3067\u67d4\u8edf\u306a Strategy \u30d1\u30bf\u30fc\u30f3\u3092\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"rust/10-strategy-pattern/#_9","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/rust/part4/src/chapter10.rs</code></li> </ul>"},{"location":"rust/10-strategy-pattern/#_10","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Command \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u64cd\u4f5c\u3092\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u30ab\u30d7\u30bb\u30eb\u5316\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"rust/11-command-pattern/","title":"\u7b2c11\u7ae0: Command \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"rust/11-command-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Command \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u64cd\u4f5c\u3092\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u30ab\u30d7\u30bb\u30eb\u5316\u3057\u3001\u5b9f\u884c\u3001\u53d6\u308a\u6d88\u3057\u3001\u518d\u5b9f\u884c\u3092\u53ef\u80fd\u306b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u30b3\u30de\u30f3\u30c9\u3092\u30c7\u30fc\u30bf\u3068\u3057\u3066\u8868\u73fe\u3057\u3001\u7d14\u7c8b\u95a2\u6570\u3067\u64cd\u4f5c\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u7de8\u96c6\u3001\u30b0\u30e9\u30d5\u30a3\u30c3\u30af\u30b9\u64cd\u4f5c\u3001\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u51e6\u7406\u306a\u3069\u3001\u69d8\u3005\u306a\u4f8b\u3092\u901a\u3058\u3066 Command \u30d1\u30bf\u30fc\u30f3\u306e Rust \u3067\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"rust/11-command-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":""},{"location":"rust/11-command-pattern/#2","title":"2. \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u7de8\u96c6\u30b3\u30de\u30f3\u30c9","text":""},{"location":"rust/11-command-pattern/#_2","title":"\u30b3\u30de\u30f3\u30c9\u30c8\u30ec\u30a4\u30c8","text":"<pre><code>/// \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u72b6\u614b\n#[derive(Debug, Clone, PartialEq)]\npub struct Document {\n    pub content: String,\n    pub cursor: usize,\n}\n\nimpl Document {\n    pub fn new() -&gt; Document {\n        Document {\n            content: String::new(),\n            cursor: 0,\n        }\n    }\n}\n\n/// \u30b3\u30de\u30f3\u30c9\u30c8\u30ec\u30a4\u30c8\npub trait Command: CloneCommand {\n    fn execute(&amp;self, doc: &amp;Document) -&gt; Document;\n    fn undo(&amp;self, doc: &amp;Document) -&gt; Document;\n}\n\n/// \u30b3\u30de\u30f3\u30c9\u3092\u8907\u88fd\u53ef\u80fd\u306b\u3059\u308b\u30c8\u30ec\u30a4\u30c8\npub trait CloneCommand {\n    fn clone_box(&amp;self) -&gt; Box&lt;dyn Command&gt;;\n}\n\nimpl&lt;T: Command + Clone + 'static&gt; CloneCommand for T {\n    fn clone_box(&amp;self) -&gt; Box&lt;dyn Command&gt; {\n        Box::new(self.clone())\n    }\n}\n</code></pre>"},{"location":"rust/11-command-pattern/#_3","title":"\u5177\u4f53\u7684\u306a\u30b3\u30de\u30f3\u30c9","text":"<pre><code>/// \u30c6\u30ad\u30b9\u30c8\u633f\u5165\u30b3\u30de\u30f3\u30c9\n#[derive(Clone)]\npub struct InsertCommand {\n    pub text: String,\n    pub position: usize,\n}\n\nimpl Command for InsertCommand {\n    fn execute(&amp;self, doc: &amp;Document) -&gt; Document {\n        let mut content = doc.content.clone();\n        content.insert_str(self.position, &amp;self.text);\n        Document {\n            content,\n            cursor: self.position + self.text.len(),\n        }\n    }\n\n    fn undo(&amp;self, doc: &amp;Document) -&gt; Document {\n        let mut content = doc.content.clone();\n        content.replace_range(self.position..self.position + self.text.len(), \"\");\n        Document {\n            content,\n            cursor: self.position,\n        }\n    }\n}\n\n/// \u30c6\u30ad\u30b9\u30c8\u524a\u9664\u30b3\u30de\u30f3\u30c9\n#[derive(Clone)]\npub struct DeleteCommand {\n    pub start: usize,\n    pub end: usize,\n    pub deleted_text: String,\n}\n\nimpl Command for DeleteCommand {\n    fn execute(&amp;self, doc: &amp;Document) -&gt; Document {\n        let mut content = doc.content.clone();\n        content.replace_range(self.start..self.end, \"\");\n        Document {\n            content,\n            cursor: self.start,\n        }\n    }\n\n    fn undo(&amp;self, doc: &amp;Document) -&gt; Document {\n        let mut content = doc.content.clone();\n        content.insert_str(self.start, &amp;self.deleted_text);\n        Document {\n            content,\n            cursor: self.start + self.deleted_text.len(),\n        }\n    }\n}\n</code></pre>"},{"location":"rust/11-command-pattern/#_4","title":"\u30b3\u30de\u30f3\u30c9\u5c65\u6b74\u7ba1\u7406","text":"<pre><code>/// \u30b3\u30de\u30f3\u30c9\u5c65\u6b74\npub struct CommandHistory {\n    history: Vec&lt;Box&lt;dyn Command&gt;&gt;,\n    current: usize,\n}\n\nimpl CommandHistory {\n    pub fn new() -&gt; CommandHistory {\n        CommandHistory {\n            history: Vec::new(),\n            current: 0,\n        }\n    }\n\n    pub fn execute(&amp;mut self, cmd: Box&lt;dyn Command&gt;, doc: &amp;Document) -&gt; Document {\n        // \u73fe\u5728\u4f4d\u7f6e\u4ee5\u964d\u306e\u5c65\u6b74\u3092\u524a\u9664\n        self.history.truncate(self.current);\n        self.history.push(cmd.clone_box());\n        self.current += 1;\n        cmd.execute(doc)\n    }\n\n    pub fn undo(&amp;mut self, doc: &amp;Document) -&gt; Option&lt;Document&gt; {\n        if self.current &gt; 0 {\n            self.current -= 1;\n            Some(self.history[self.current].undo(doc))\n        } else {\n            None\n        }\n    }\n\n    pub fn redo(&amp;mut self, doc: &amp;Document) -&gt; Option&lt;Document&gt; {\n        if self.current &lt; self.history.len() {\n            let result = self.history[self.current].execute(doc);\n            self.current += 1;\n            Some(result)\n        } else {\n            None\n        }\n    }\n}\n</code></pre>"},{"location":"rust/11-command-pattern/#_5","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>let mut doc = Document::new();\nlet mut history = CommandHistory::new();\n\n// \u30c6\u30ad\u30b9\u30c8\u3092\u633f\u5165\nlet insert = InsertCommand {\n    text: \"Hello\".to_string(),\n    position: 0,\n};\ndoc = history.execute(Box::new(insert), &amp;doc);\nassert_eq!(doc.content, \"Hello\");\n\n// \u5143\u306b\u623b\u3059\ndoc = history.undo(&amp;doc).unwrap();\nassert_eq!(doc.content, \"\");\n\n// \u3084\u308a\u76f4\u3059\ndoc = history.redo(&amp;doc).unwrap();\nassert_eq!(doc.content, \"Hello\");\n</code></pre>"},{"location":"rust/11-command-pattern/#3","title":"3. \u30de\u30af\u30ed\u30b3\u30de\u30f3\u30c9","text":"<pre><code>/// \u8907\u6570\u306e\u30b3\u30de\u30f3\u30c9\u3092\u307e\u3068\u3081\u3066\u5b9f\u884c\n#[derive(Clone)]\npub struct MacroCommand {\n    pub commands: Vec&lt;Box&lt;dyn Command&gt;&gt;,\n}\n\nimpl Command for MacroCommand {\n    fn execute(&amp;self, doc: &amp;Document) -&gt; Document {\n        self.commands\n            .iter()\n            .fold(doc.clone(), |d, cmd| cmd.execute(&amp;d))\n    }\n\n    fn undo(&amp;self, doc: &amp;Document) -&gt; Document {\n        self.commands\n            .iter()\n            .rev()\n            .fold(doc.clone(), |d, cmd| cmd.undo(&amp;d))\n    }\n}\n</code></pre>"},{"location":"rust/11-command-pattern/#4","title":"4. \u95a2\u6570\u578b\u30b3\u30de\u30f3\u30c9","text":"<pre><code>/// \u95a2\u6570\u578b\u30b3\u30de\u30f3\u30c9\npub type CommandFn&lt;S&gt; = Box&lt;dyn Fn(&amp;S) -&gt; S&gt;;\n\n/// \u30b3\u30de\u30f3\u30c9\u3092\u5408\u6210\npub fn compose_commands&lt;S: Clone + 'static&gt;(\n    commands: Vec&lt;CommandFn&lt;S&gt;&gt;,\n) -&gt; CommandFn&lt;S&gt; {\n    Box::new(move |state| {\n        commands.iter().fold(state.clone(), |s, cmd| cmd(&amp;s))\n    })\n}\n\n/// \u53ef\u9006\u30b3\u30de\u30f3\u30c9\npub struct ReversibleCommand&lt;S&gt; {\n    pub execute: Box&lt;dyn Fn(&amp;S) -&gt; S&gt;,\n    pub undo: Box&lt;dyn Fn(&amp;S) -&gt; S&gt;,\n}\n\nimpl&lt;S&gt; ReversibleCommand&lt;S&gt; {\n    pub fn new&lt;E, U&gt;(execute: E, undo: U) -&gt; Self\n    where\n        E: Fn(&amp;S) -&gt; S + 'static,\n        U: Fn(&amp;S) -&gt; S + 'static,\n    {\n        ReversibleCommand {\n            execute: Box::new(execute),\n            undo: Box::new(undo),\n        }\n    }\n}\n</code></pre>"},{"location":"rust/11-command-pattern/#5","title":"5. \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u30b3\u30de\u30f3\u30c9","text":"<pre><code>/// \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u7d50\u679c\npub enum TransactionResult&lt;T&gt; {\n    Success(T),\n    Failure(String),\n    Rollback(T),\n}\n\n/// \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u30b3\u30de\u30f3\u30c9\npub struct TransactionCommand&lt;S&gt; {\n    pub commands: Vec&lt;ReversibleCommand&lt;S&gt;&gt;,\n}\n\nimpl&lt;S: Clone&gt; TransactionCommand&lt;S&gt; {\n    pub fn execute(&amp;self, state: &amp;S) -&gt; TransactionResult&lt;S&gt; {\n        let mut current = state.clone();\n        let mut executed = Vec::new();\n\n        for cmd in &amp;self.commands {\n            let new_state = (cmd.execute)(&amp;current);\n            executed.push(cmd);\n            current = new_state;\n        }\n\n        TransactionResult::Success(current)\n    }\n\n    pub fn rollback(&amp;self, state: &amp;S, executed: &amp;[&amp;ReversibleCommand&lt;S&gt;]) -&gt; S {\n        executed\n            .iter()\n            .rev()\n            .fold(state.clone(), |s, cmd| (cmd.undo)(&amp;s))\n    }\n}\n</code></pre>"},{"location":"rust/11-command-pattern/#6","title":"6. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u5143\u306b\u623b\u3059/\u3084\u308a\u76f4\u3059: \u64cd\u4f5c\u306e\u5c65\u6b74\u3092\u7ba1\u7406</li> <li>\u9045\u5ef6\u5b9f\u884c: \u30b3\u30de\u30f3\u30c9\u3092\u30ad\u30e5\u30fc\u306b\u5165\u308c\u3066\u5f8c\u3067\u5b9f\u884c</li> <li>\u30ed\u30b0\u8a18\u9332: \u64cd\u4f5c\u3092\u30ed\u30b0\u3068\u3057\u3066\u4fdd\u5b58</li> <li>\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3: \u8907\u6570\u306e\u64cd\u4f5c\u3092\u30a2\u30c8\u30df\u30c3\u30af\u306b\u5b9f\u884c</li> </ol>"},{"location":"rust/11-command-pattern/#7-rust","title":"7. Rust \u3067\u306e\u7279\u5fb4","text":""},{"location":"rust/11-command-pattern/#_6","title":"\u30c8\u30ec\u30a4\u30c8\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u30af\u30ed\u30fc\u30f3","text":"<pre><code>// Box&lt;dyn Command&gt; \u3092\u30af\u30ed\u30fc\u30f3\u53ef\u80fd\u306b\u3059\u308b\npub trait CloneCommand {\n    fn clone_box(&amp;self) -&gt; Box&lt;dyn Command&gt;;\n}\n</code></pre>"},{"location":"rust/11-command-pattern/#_7","title":"\u6240\u6709\u6a29\u3068\u4e0d\u5909\u6027","text":"<pre><code>// \u30b3\u30de\u30f3\u30c9\u306f\u72b6\u614b\u3092\u5909\u66f4\u305b\u305a\u3001\u65b0\u3057\u3044\u72b6\u614b\u3092\u8fd4\u3059\nfn execute(&amp;self, doc: &amp;Document) -&gt; Document {\n    // doc \u306f\u501f\u7528\u3001\u65b0\u3057\u3044 Document \u3092\u8fd4\u3059\n}\n</code></pre>"},{"location":"rust/11-command-pattern/#scala","title":"Scala \u3068\u306e\u6bd4\u8f03","text":"\u6982\u5ff5 Scala Rust \u30b3\u30de\u30f3\u30c9\u5b9a\u7fa9 case class struct + trait \u5c65\u6b74\u7ba1\u7406 List Vec \u4e0d\u5909\u66f4\u65b0 copy() Clone + \u624b\u52d5\u69cb\u7bc9 \u591a\u614b\u6027 trait trait object"},{"location":"rust/11-command-pattern/#_8","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Command \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u7de8\u96c6: \u633f\u5165\u3001\u524a\u9664\u3001\u7f6e\u63db\u30b3\u30de\u30f3\u30c9</li> <li>\u5c65\u6b74\u7ba1\u7406: Undo/Redo \u6a5f\u80fd</li> <li>\u30de\u30af\u30ed\u30b3\u30de\u30f3\u30c9: \u8907\u6570\u30b3\u30de\u30f3\u30c9\u306e\u5408\u6210</li> <li>\u95a2\u6570\u578b\u30b3\u30de\u30f3\u30c9: \u95a2\u6570\u3068\u3057\u3066\u306e\u30b3\u30de\u30f3\u30c9</li> <li>\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3: \u30a2\u30c8\u30df\u30c3\u30af\u306a\u64cd\u4f5c\u5b9f\u884c</li> </ol> <p>Rust \u3067\u306f\u3001\u30c8\u30ec\u30a4\u30c8\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u6240\u6709\u6a29\u30b7\u30b9\u30c6\u30e0\u3092\u6d3b\u7528\u3057\u3066\u3001\u578b\u5b89\u5168\u306a\u30b3\u30de\u30f3\u30c9\u30d1\u30bf\u30fc\u30f3\u3092\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"rust/11-command-pattern/#_9","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/rust/part4/src/chapter11.rs</code></li> </ul>"},{"location":"rust/11-command-pattern/#_10","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Visitor \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u8d70\u67fb\u3057\u3066\u64cd\u4f5c\u3092\u9069\u7528\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"rust/12-visitor-pattern/","title":"\u7b2c12\u7ae0: Visitor \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"rust/12-visitor-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Visitor \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u8981\u7d20\u306b\u5bfe\u3059\u308b\u64cd\u4f5c\u3092\u3001\u30c7\u30fc\u30bf\u69cb\u9020\u304b\u3089\u5206\u96e2\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3092\u4f7f\u3063\u3066\u3053\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u81ea\u7136\u306b\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u5f0f\u306e\u8a55\u4fa1\u3001AST \u5909\u63db\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u51e6\u7406\u306a\u3069\u3001\u69d8\u3005\u306a\u4f8b\u3092\u901a\u3058\u3066 Visitor \u30d1\u30bf\u30fc\u30f3\u306e Rust \u3067\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"rust/12-visitor-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":""},{"location":"rust/12-visitor-pattern/#2-visitor","title":"2. \u5f0f\u306e Visitor","text":""},{"location":"rust/12-visitor-pattern/#_2","title":"\u5f0f\u306e\u5b9a\u7fa9","text":"<pre><code>/// \u6570\u5f0f AST\n#[derive(Debug, Clone, PartialEq)]\npub enum Expr {\n    Number(f64),\n    Variable(String),\n    Add(Box&lt;Expr&gt;, Box&lt;Expr&gt;),\n    Subtract(Box&lt;Expr&gt;, Box&lt;Expr&gt;),\n    Multiply(Box&lt;Expr&gt;, Box&lt;Expr&gt;),\n    Divide(Box&lt;Expr&gt;, Box&lt;Expr&gt;),\n}\n\nimpl Expr {\n    pub fn number(n: f64) -&gt; Expr {\n        Expr::Number(n)\n    }\n\n    pub fn add(left: Expr, right: Expr) -&gt; Expr {\n        Expr::Add(Box::new(left), Box::new(right))\n    }\n\n    pub fn multiply(left: Expr, right: Expr) -&gt; Expr {\n        Expr::Multiply(Box::new(left), Box::new(right))\n    }\n}\n</code></pre>"},{"location":"rust/12-visitor-pattern/#visitor","title":"Visitor \u30c8\u30ec\u30a4\u30c8","text":"<pre><code>/// Visitor \u30c8\u30ec\u30a4\u30c8\npub trait ExprVisitor&lt;R&gt; {\n    fn visit_number(&amp;mut self, n: f64) -&gt; R;\n    fn visit_variable(&amp;mut self, name: &amp;str) -&gt; R;\n    fn visit_add(&amp;mut self, left: R, right: R) -&gt; R;\n    fn visit_subtract(&amp;mut self, left: R, right: R) -&gt; R;\n    fn visit_multiply(&amp;mut self, left: R, right: R) -&gt; R;\n    fn visit_divide(&amp;mut self, left: R, right: R) -&gt; R;\n}\n\n/// \u5f0f\u3092\u8a2a\u554f\npub fn visit&lt;R&gt;(expr: &amp;Expr, visitor: &amp;mut dyn ExprVisitor&lt;R&gt;) -&gt; R {\n    match expr {\n        Expr::Number(n) =&gt; visitor.visit_number(*n),\n        Expr::Variable(name) =&gt; visitor.visit_variable(name),\n        Expr::Add(left, right) =&gt; {\n            let l = visit(left, visitor);\n            let r = visit(right, visitor);\n            visitor.visit_add(l, r)\n        }\n        Expr::Subtract(left, right) =&gt; {\n            let l = visit(left, visitor);\n            let r = visit(right, visitor);\n            visitor.visit_subtract(l, r)\n        }\n        Expr::Multiply(left, right) =&gt; {\n            let l = visit(left, visitor);\n            let r = visit(right, visitor);\n            visitor.visit_multiply(l, r)\n        }\n        Expr::Divide(left, right) =&gt; {\n            let l = visit(left, visitor);\n            let r = visit(right, visitor);\n            visitor.visit_divide(l, r)\n        }\n    }\n}\n</code></pre>"},{"location":"rust/12-visitor-pattern/#visitor_1","title":"\u8a55\u4fa1 Visitor","text":"<pre><code>/// \u8a55\u4fa1 Visitor\npub struct Evaluator {\n    pub variables: HashMap&lt;String, f64&gt;,\n}\n\nimpl ExprVisitor&lt;f64&gt; for Evaluator {\n    fn visit_number(&amp;mut self, n: f64) -&gt; f64 {\n        n\n    }\n\n    fn visit_variable(&amp;mut self, name: &amp;str) -&gt; f64 {\n        self.variables.get(name).copied().unwrap_or(0.0)\n    }\n\n    fn visit_add(&amp;mut self, left: f64, right: f64) -&gt; f64 {\n        left + right\n    }\n\n    fn visit_subtract(&amp;mut self, left: f64, right: f64) -&gt; f64 {\n        left - right\n    }\n\n    fn visit_multiply(&amp;mut self, left: f64, right: f64) -&gt; f64 {\n        left * right\n    }\n\n    fn visit_divide(&amp;mut self, left: f64, right: f64) -&gt; f64 {\n        if right != 0.0 { left / right } else { f64::NAN }\n    }\n}\n</code></pre>"},{"location":"rust/12-visitor-pattern/#visitor_2","title":"\u51fa\u529b Visitor","text":"<pre><code>/// \u5f0f\u3092\u6587\u5b57\u5217\u306b\u5909\u63db\u3059\u308b Visitor\npub struct Printer;\n\nimpl ExprVisitor&lt;String&gt; for Printer {\n    fn visit_number(&amp;mut self, n: f64) -&gt; String {\n        n.to_string()\n    }\n\n    fn visit_variable(&amp;mut self, name: &amp;str) -&gt; String {\n        name.to_string()\n    }\n\n    fn visit_add(&amp;mut self, left: String, right: String) -&gt; String {\n        format!(\"({} + {})\", left, right)\n    }\n\n    fn visit_subtract(&amp;mut self, left: String, right: String) -&gt; String {\n        format!(\"({} - {})\", left, right)\n    }\n\n    fn visit_multiply(&amp;mut self, left: String, right: String) -&gt; String {\n        format!(\"({} * {})\", left, right)\n    }\n\n    fn visit_divide(&amp;mut self, left: String, right: String) -&gt; String {\n        format!(\"({} / {})\", left, right)\n    }\n}\n</code></pre>"},{"location":"rust/12-visitor-pattern/#_3","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// (2 + 3) * 4\nlet expr = Expr::multiply(\n    Expr::add(Expr::number(2.0), Expr::number(3.0)),\n    Expr::number(4.0),\n);\n\n// \u8a55\u4fa1\nlet mut evaluator = Evaluator { variables: HashMap::new() };\nlet result = visit(&amp;expr, &amp;mut evaluator);\nassert_eq!(result, 20.0);\n\n// \u6587\u5b57\u5217\u5909\u63db\nlet mut printer = Printer;\nlet string = visit(&amp;expr, &amp;mut printer);\nassert_eq!(string, \"((2 + 3) * 4)\");\n</code></pre>"},{"location":"rust/12-visitor-pattern/#3-visitor","title":"3. \u95a2\u6570\u578b Visitor","text":"<p>\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3092\u4f7f\u3063\u305f\u76f4\u63a5\u7684\u306a\u5b9f\u88c5\uff1a</p> <pre><code>/// \u95a2\u6570\u578b\u8a55\u4fa1\npub fn evaluate(expr: &amp;Expr, vars: &amp;HashMap&lt;String, f64&gt;) -&gt; f64 {\n    match expr {\n        Expr::Number(n) =&gt; *n,\n        Expr::Variable(name) =&gt; vars.get(name).copied().unwrap_or(0.0),\n        Expr::Add(l, r) =&gt; evaluate(l, vars) + evaluate(r, vars),\n        Expr::Subtract(l, r) =&gt; evaluate(l, vars) - evaluate(r, vars),\n        Expr::Multiply(l, r) =&gt; evaluate(l, vars) * evaluate(r, vars),\n        Expr::Divide(l, r) =&gt; {\n            let r_val = evaluate(r, vars);\n            if r_val != 0.0 {\n                evaluate(l, vars) / r_val\n            } else {\n                f64::NAN\n            }\n        }\n    }\n}\n\n/// \u5909\u6570\u3092\u53ce\u96c6\npub fn collect_variables(expr: &amp;Expr) -&gt; HashSet&lt;String&gt; {\n    match expr {\n        Expr::Number(_) =&gt; HashSet::new(),\n        Expr::Variable(name) =&gt; {\n            let mut set = HashSet::new();\n            set.insert(name.clone());\n            set\n        }\n        Expr::Add(l, r) | Expr::Subtract(l, r) | Expr::Multiply(l, r) | Expr::Divide(l, r) =&gt; {\n            let mut vars = collect_variables(l);\n            vars.extend(collect_variables(r));\n            vars\n        }\n    }\n}\n\n/// \u5f0f\u3092\u7c21\u7565\u5316\npub fn simplify(expr: &amp;Expr) -&gt; Expr {\n    match expr {\n        Expr::Add(l, r) =&gt; {\n            let l = simplify(l);\n            let r = simplify(r);\n            match (&amp;l, &amp;r) {\n                (Expr::Number(0.0), _) =&gt; r,\n                (_, Expr::Number(0.0)) =&gt; l,\n                (Expr::Number(a), Expr::Number(b)) =&gt; Expr::Number(a + b),\n                _ =&gt; Expr::Add(Box::new(l), Box::new(r)),\n            }\n        }\n        Expr::Multiply(l, r) =&gt; {\n            let l = simplify(l);\n            let r = simplify(r);\n            match (&amp;l, &amp;r) {\n                (Expr::Number(0.0), _) | (_, Expr::Number(0.0)) =&gt; Expr::Number(0.0),\n                (Expr::Number(1.0), _) =&gt; r,\n                (_, Expr::Number(1.0)) =&gt; l,\n                (Expr::Number(a), Expr::Number(b)) =&gt; Expr::Number(a * b),\n                _ =&gt; Expr::Multiply(Box::new(l), Box::new(r)),\n            }\n        }\n        _ =&gt; expr.clone(),\n    }\n}\n</code></pre>"},{"location":"rust/12-visitor-pattern/#4-visitor","title":"4. \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 Visitor","text":"<pre><code>/// \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u8981\u7d20\n#[derive(Debug, Clone)]\npub enum DocElement {\n    Text(String),\n    Bold(Box&lt;DocElement&gt;),\n    Italic(Box&lt;DocElement&gt;),\n    Link { text: Box&lt;DocElement&gt;, url: String },\n    Paragraph(Vec&lt;DocElement&gt;),\n    Document(Vec&lt;DocElement&gt;),\n}\n\n/// HTML \u5909\u63db\npub fn to_html(element: &amp;DocElement) -&gt; String {\n    match element {\n        DocElement::Text(text) =&gt; text.clone(),\n        DocElement::Bold(inner) =&gt; format!(\"&lt;strong&gt;{}&lt;/strong&gt;\", to_html(inner)),\n        DocElement::Italic(inner) =&gt; format!(\"&lt;em&gt;{}&lt;/em&gt;\", to_html(inner)),\n        DocElement::Link { text, url } =&gt; {\n            format!(r#\"&lt;a href=\"{}\"&gt;{}&lt;/a&gt;\"#, url, to_html(text))\n        }\n        DocElement::Paragraph(elements) =&gt; {\n            let content: String = elements.iter().map(to_html).collect();\n            format!(\"&lt;p&gt;{}&lt;/p&gt;\", content)\n        }\n        DocElement::Document(elements) =&gt; {\n            elements.iter().map(to_html).collect()\n        }\n    }\n}\n\n/// Markdown \u5909\u63db\npub fn to_markdown(element: &amp;DocElement) -&gt; String {\n    match element {\n        DocElement::Text(text) =&gt; text.clone(),\n        DocElement::Bold(inner) =&gt; format!(\"**{}**\", to_markdown(inner)),\n        DocElement::Italic(inner) =&gt; format!(\"*{}*\", to_markdown(inner)),\n        DocElement::Link { text, url } =&gt; {\n            format!(\"[{}]({})\", to_markdown(text), url)\n        }\n        DocElement::Paragraph(elements) =&gt; {\n            let content: String = elements.iter().map(to_markdown).collect();\n            format!(\"{}\\n\\n\", content)\n        }\n        DocElement::Document(elements) =&gt; {\n            elements.iter().map(to_markdown).collect()\n        }\n    }\n}\n</code></pre>"},{"location":"rust/12-visitor-pattern/#5","title":"5. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u5206\u96e2: \u30c7\u30fc\u30bf\u69cb\u9020\u3068\u64cd\u4f5c\u3092\u5206\u96e2</li> <li>\u62e1\u5f35\u6027: \u65b0\u3057\u3044\u64cd\u4f5c\u3092\u8ffd\u52a0\u3057\u3084\u3059\u3044</li> <li>\u5358\u4e00\u8cac\u4efb: \u5404 Visitor \u306f\u5358\u4e00\u306e\u64cd\u4f5c\u306b\u96c6\u4e2d</li> <li>\u578b\u5b89\u5168\u6027: \u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u306b\u578b\u30c1\u30a7\u30c3\u30af</li> </ol>"},{"location":"rust/12-visitor-pattern/#6-rust","title":"6. Rust \u3067\u306e\u7279\u5fb4","text":""},{"location":"rust/12-visitor-pattern/#_4","title":"\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u306b\u3088\u308b\u7db2\u7f85\u6027","text":"<pre><code>// \u5168\u3066\u306e\u30b1\u30fc\u30b9\u3092\u30ab\u30d0\u30fc\u3057\u306a\u3044\u3068\u30b3\u30f3\u30d1\u30a4\u30eb\u30a8\u30e9\u30fc\nmatch expr {\n    Expr::Number(n) =&gt; { /* ... */ }\n    Expr::Variable(name) =&gt; { /* ... */ }\n    Expr::Add(l, r) =&gt; { /* ... */ }\n    // \u4ed6\u306e\u30b1\u30fc\u30b9\u3092\u5fd8\u308c\u308b\u3068\u8b66\u544a\n}\n</code></pre>"},{"location":"rust/12-visitor-pattern/#enum","title":"enum \u306b\u3088\u308b\u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b","text":"<pre><code>// \u76f4\u548c\u578b\u3068\u3057\u3066\u81ea\u7136\u306b\u8868\u73fe\npub enum Expr {\n    Number(f64),\n    Add(Box&lt;Expr&gt;, Box&lt;Expr&gt;),\n    // ...\n}\n</code></pre>"},{"location":"rust/12-visitor-pattern/#scala","title":"Scala \u3068\u306e\u6bd4\u8f03","text":"\u6982\u5ff5 Scala Rust \u30c7\u30fc\u30bf\u5b9a\u7fa9 sealed trait + case class enum \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1 match match \u518d\u5e30\u578b \u76f4\u63a5\u53c2\u7167 Box \u3067\u5305\u3080 Visitor trait trait"},{"location":"rust/12-visitor-pattern/#_5","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Visitor \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u5f0f\u306e Visitor: \u8a55\u4fa1\u3001\u51fa\u529b\u3001\u5909\u6570\u53ce\u96c6</li> <li>\u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1: \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u306b\u3088\u308b\u76f4\u63a5\u5b9f\u88c5</li> <li>AST \u5909\u63db: \u5f0f\u306e\u7c21\u7565\u5316</li> <li>\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 Visitor: HTML/Markdown \u5909\u63db</li> </ol> <p>Rust \u306e enum \u3068\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3092\u4f7f\u3046\u3053\u3068\u3067\u3001Visitor \u30d1\u30bf\u30fc\u30f3\u3092\u578b\u5b89\u5168\u304b\u3064\u7c21\u6f54\u306b\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"rust/12-visitor-pattern/#_6","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/rust/part4/src/chapter12.rs</code></li> </ul>"},{"location":"rust/12-visitor-pattern/#_7","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u95a2\u9023\u3059\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u7fa4\u3092\u751f\u6210\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"rust/13-abstract-factory-pattern/","title":"\u7b2c13\u7ae0: Abstract Factory \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"rust/13-abstract-factory-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u95a2\u9023\u3059\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u7fa4\u3092\u3001\u305d\u306e\u5177\u4f53\u7684\u306a\u30af\u30e9\u30b9\u3092\u6307\u5b9a\u305b\u305a\u306b\u751f\u6210\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u30d5\u30a1\u30af\u30c8\u30ea\u95a2\u6570\u3092\u4f7f\u3063\u3066\u3053\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001UI \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3001\u30b2\u30fc\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\u306a\u3069\u3001\u69d8\u3005\u306a\u4f8b\u3092\u901a\u3058\u3066 Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306e Rust \u3067\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"rust/13-abstract-factory-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":""},{"location":"rust/13-abstract-factory-pattern/#2-ui","title":"2. UI \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u30d5\u30a1\u30af\u30c8\u30ea","text":""},{"location":"rust/13-abstract-factory-pattern/#_2","title":"\u30c8\u30ec\u30a4\u30c8\u5b9a\u7fa9","text":"<pre><code>/// \u30dc\u30bf\u30f3\u30c8\u30ec\u30a4\u30c8\npub trait Button {\n    fn render(&amp;self) -&gt; String;\n    fn click(&amp;self) -&gt; String;\n}\n\n/// \u30c1\u30a7\u30c3\u30af\u30dc\u30c3\u30af\u30b9\u30c8\u30ec\u30a4\u30c8\npub trait Checkbox {\n    fn render(&amp;self) -&gt; String;\n    fn toggle(&amp;self, checked: bool) -&gt; bool;\n}\n\n/// \u30c6\u30ad\u30b9\u30c8\u30d5\u30a3\u30fc\u30eb\u30c9\u30c8\u30ec\u30a4\u30c8\npub trait TextField {\n    fn render(&amp;self) -&gt; String;\n    fn set_value(&amp;self, value: &amp;str) -&gt; String;\n}\n\n/// GUI \u30d5\u30a1\u30af\u30c8\u30ea\u30c8\u30ec\u30a4\u30c8\npub trait GUIFactory {\n    fn create_button(&amp;self, label: &amp;str) -&gt; Box&lt;dyn Button&gt;;\n    fn create_checkbox(&amp;self, label: &amp;str, checked: bool) -&gt; Box&lt;dyn Checkbox&gt;;\n    fn create_text_field(&amp;self, placeholder: &amp;str) -&gt; Box&lt;dyn TextField&gt;;\n}\n</code></pre>"},{"location":"rust/13-abstract-factory-pattern/#windows","title":"Windows \u30b9\u30bf\u30a4\u30eb\u5b9f\u88c5","text":"<pre><code>pub struct WindowsButton {\n    label: String,\n}\n\nimpl Button for WindowsButton {\n    fn render(&amp;self) -&gt; String {\n        format!(\"[WIN Button: {}]\", self.label)\n    }\n\n    fn click(&amp;self) -&gt; String {\n        format!(\"Windows button '{}' clicked\", self.label)\n    }\n}\n\npub struct WindowsCheckbox {\n    label: String,\n    checked: bool,\n}\n\nimpl Checkbox for WindowsCheckbox {\n    fn render(&amp;self) -&gt; String {\n        let check = if self.checked { \"X\" } else { \" \" };\n        format!(\"[WIN Checkbox: [{}] {}]\", check, self.label)\n    }\n\n    fn toggle(&amp;self, checked: bool) -&gt; bool {\n        checked\n    }\n}\n\npub struct WindowsFactory;\n\nimpl GUIFactory for WindowsFactory {\n    fn create_button(&amp;self, label: &amp;str) -&gt; Box&lt;dyn Button&gt; {\n        Box::new(WindowsButton {\n            label: label.to_string(),\n        })\n    }\n\n    fn create_checkbox(&amp;self, label: &amp;str, checked: bool) -&gt; Box&lt;dyn Checkbox&gt; {\n        Box::new(WindowsCheckbox {\n            label: label.to_string(),\n            checked,\n        })\n    }\n\n    fn create_text_field(&amp;self, placeholder: &amp;str) -&gt; Box&lt;dyn TextField&gt; {\n        Box::new(WindowsTextField {\n            placeholder: placeholder.to_string(),\n        })\n    }\n}\n</code></pre>"},{"location":"rust/13-abstract-factory-pattern/#mac","title":"Mac \u30b9\u30bf\u30a4\u30eb\u5b9f\u88c5","text":"<pre><code>pub struct MacButton {\n    label: String,\n}\n\nimpl Button for MacButton {\n    fn render(&amp;self) -&gt; String {\n        format!(\"(MAC Button: {})\", self.label)\n    }\n\n    fn click(&amp;self) -&gt; String {\n        format!(\"Mac button '{}' clicked\", self.label)\n    }\n}\n\npub struct MacFactory;\n\nimpl GUIFactory for MacFactory {\n    fn create_button(&amp;self, label: &amp;str) -&gt; Box&lt;dyn Button&gt; {\n        Box::new(MacButton {\n            label: label.to_string(),\n        })\n    }\n    // ... \u4ed6\u306e\u30e1\u30bd\u30c3\u30c9\n}\n</code></pre>"},{"location":"rust/13-abstract-factory-pattern/#_3","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>fn create_ui(factory: &amp;dyn GUIFactory) -&gt; String {\n    let button = factory.create_button(\"Submit\");\n    let checkbox = factory.create_checkbox(\"Accept Terms\", false);\n    let text_field = factory.create_text_field(\"Enter name\");\n\n    format!(\n        \"{}\\n{}\\n{}\",\n        button.render(),\n        checkbox.render(),\n        text_field.render()\n    )\n}\n\n// Windows UI\nlet windows_factory = WindowsFactory;\nlet windows_ui = create_ui(&amp;windows_factory);\n\n// Mac UI\nlet mac_factory = MacFactory;\nlet mac_ui = create_ui(&amp;mac_factory);\n</code></pre>"},{"location":"rust/13-abstract-factory-pattern/#3","title":"3. \u95a2\u6570\u578b\u30d5\u30a1\u30af\u30c8\u30ea","text":"<pre><code>/// \u30d5\u30a1\u30af\u30c8\u30ea\u95a2\u6570\u578b\npub type ButtonFactory = Box&lt;dyn Fn(&amp;str) -&gt; Box&lt;dyn Button&gt;&gt;;\npub type CheckboxFactory = Box&lt;dyn Fn(&amp;str, bool) -&gt; Box&lt;dyn Checkbox&gt;&gt;;\n\n/// \u30d5\u30a1\u30af\u30c8\u30ea\u95a2\u6570\u3092\u4f5c\u6210\npub fn windows_button_factory() -&gt; ButtonFactory {\n    Box::new(|label| {\n        Box::new(WindowsButton {\n            label: label.to_string(),\n        })\n    })\n}\n\npub fn mac_button_factory() -&gt; ButtonFactory {\n    Box::new(|label| {\n        Box::new(MacButton {\n            label: label.to_string(),\n        })\n    })\n}\n\n/// \u30d5\u30a1\u30af\u30c8\u30ea\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\npub struct FactoryContext {\n    pub button_factory: ButtonFactory,\n    pub checkbox_factory: CheckboxFactory,\n}\n\nimpl FactoryContext {\n    pub fn windows() -&gt; FactoryContext {\n        FactoryContext {\n            button_factory: windows_button_factory(),\n            checkbox_factory: windows_checkbox_factory(),\n        }\n    }\n\n    pub fn mac() -&gt; FactoryContext {\n        FactoryContext {\n            button_factory: mac_button_factory(),\n            checkbox_factory: mac_checkbox_factory(),\n        }\n    }\n}\n</code></pre>"},{"location":"rust/13-abstract-factory-pattern/#4","title":"4. \u30b2\u30fc\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u30d5\u30a1\u30af\u30c8\u30ea","text":"<pre><code>/// \u30b2\u30fc\u30e0\u30ad\u30e3\u30e9\u30af\u30bf\u30fc\npub trait Character {\n    fn name(&amp;self) -&gt; &amp;str;\n    fn health(&amp;self) -&gt; i32;\n    fn attack(&amp;self) -&gt; String;\n}\n\n/// \u6b66\u5668\npub trait Weapon {\n    fn name(&amp;self) -&gt; &amp;str;\n    fn damage(&amp;self) -&gt; i32;\n}\n\n/// \u30b2\u30fc\u30e0\u30d5\u30a1\u30af\u30c8\u30ea\npub trait GameFactory {\n    fn create_warrior(&amp;self, name: &amp;str) -&gt; Box&lt;dyn Character&gt;;\n    fn create_mage(&amp;self, name: &amp;str) -&gt; Box&lt;dyn Character&gt;;\n    fn create_sword(&amp;self) -&gt; Box&lt;dyn Weapon&gt;;\n    fn create_staff(&amp;self) -&gt; Box&lt;dyn Weapon&gt;;\n}\n\n/// \u30d5\u30a1\u30f3\u30bf\u30b8\u30fc\u30c6\u30fc\u30de\npub struct FantasyFactory;\n\nimpl GameFactory for FantasyFactory {\n    fn create_warrior(&amp;self, name: &amp;str) -&gt; Box&lt;dyn Character&gt; {\n        Box::new(Knight { name: name.to_string(), health: 100 })\n    }\n    // ... \u4ed6\u306e\u30e1\u30bd\u30c3\u30c9\n}\n\n/// SF \u30c6\u30fc\u30de\npub struct SciFiFactory;\n\nimpl GameFactory for SciFiFactory {\n    fn create_warrior(&amp;self, name: &amp;str) -&gt; Box&lt;dyn Character&gt; {\n        Box::new(SpaceMarine { name: name.to_string(), health: 120 })\n    }\n    // ... \u4ed6\u306e\u30e1\u30bd\u30c3\u30c9\n}\n</code></pre>"},{"location":"rust/13-abstract-factory-pattern/#5","title":"5. \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\u30d5\u30a1\u30af\u30c8\u30ea","text":"<pre><code>/// \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\npub trait Connection {\n    fn execute(&amp;self, query: &amp;str) -&gt; Result&lt;String, String&gt;;\n    fn close(&amp;self) -&gt; String;\n}\n\n/// \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30d5\u30a1\u30af\u30c8\u30ea\npub trait DatabaseFactory {\n    fn create_connection(&amp;self, config: &amp;ConnectionConfig) -&gt; Box&lt;dyn Connection&gt;;\n}\n\npub struct ConnectionConfig {\n    pub host: String,\n    pub port: u16,\n    pub database: String,\n}\n\n/// PostgreSQL \u30d5\u30a1\u30af\u30c8\u30ea\npub struct PostgresFactory;\n\nimpl DatabaseFactory for PostgresFactory {\n    fn create_connection(&amp;self, config: &amp;ConnectionConfig) -&gt; Box&lt;dyn Connection&gt; {\n        Box::new(PostgresConnection {\n            connection_string: format!(\n                \"postgres://{}:{}/{}\",\n                config.host, config.port, config.database\n            ),\n        })\n    }\n}\n</code></pre>"},{"location":"rust/13-abstract-factory-pattern/#6","title":"6. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u4e00\u8cab\u6027: \u95a2\u9023\u3059\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u7fa4\u3092\u4e00\u8cab\u3057\u3066\u751f\u6210</li> <li>\u5207\u308a\u66ff\u3048\u5bb9\u6613: \u30d5\u30a1\u30af\u30c8\u30ea\u3092\u5207\u308a\u66ff\u3048\u308b\u3060\u3051\u3067\u5168\u4f53\u3092\u5909\u66f4</li> <li>\u30c6\u30b9\u30c8\u5bb9\u6613\u6027: \u30e2\u30c3\u30af\u30d5\u30a1\u30af\u30c8\u30ea\u3092\u4f7f\u3063\u3066\u30c6\u30b9\u30c8</li> <li>\u5206\u96e2: \u5177\u4f53\u7684\u306a\u5b9f\u88c5\u304b\u3089\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u5206\u96e2</li> </ol>"},{"location":"rust/13-abstract-factory-pattern/#7-rust","title":"7. Rust \u3067\u306e\u7279\u5fb4","text":""},{"location":"rust/13-abstract-factory-pattern/#_4","title":"\u30c8\u30ec\u30a4\u30c8\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u3088\u308b\u62bd\u8c61\u5316","text":"<pre><code>// \u30d5\u30a1\u30af\u30c8\u30ea\u3068\u30d7\u30ed\u30c0\u30af\u30c8\u306e\u4e21\u65b9\u3092\u30c8\u30ec\u30a4\u30c8\u3067\u62bd\u8c61\u5316\nfn use_factory(factory: &amp;dyn GUIFactory) {\n    let button = factory.create_button(\"OK\");\n    println!(\"{}\", button.render());\n}\n</code></pre>"},{"location":"rust/13-abstract-factory-pattern/#_5","title":"\u30b8\u30a7\u30cd\u30ea\u30af\u30b9\u306b\u3088\u308b\u9759\u7684\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1","text":"<pre><code>fn use_factory_generic&lt;F: GUIFactory&gt;(factory: &amp;F) {\n    let button = factory.create_button(\"OK\");\n    // \u9759\u7684\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u3067\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u306a\u3057\n}\n</code></pre>"},{"location":"rust/13-abstract-factory-pattern/#scala","title":"Scala \u3068\u306e\u6bd4\u8f03","text":"\u6982\u5ff5 Scala Rust \u62bd\u8c61\u30d5\u30a1\u30af\u30c8\u30ea trait trait \u30d7\u30ed\u30c0\u30af\u30c8 trait trait \u52d5\u7684\u751f\u6210 new Box::new \u578b\u30d1\u30e9\u30e1\u30fc\u30bf [A]"},{"location":"rust/13-abstract-factory-pattern/#_6","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>UI \u30d5\u30a1\u30af\u30c8\u30ea: \u7570\u306a\u308b\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u306e UI \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8</li> <li>\u95a2\u6570\u578b\u30d5\u30a1\u30af\u30c8\u30ea: \u30af\u30ed\u30fc\u30b8\u30e3\u3092\u4f7f\u3063\u305f\u30d5\u30a1\u30af\u30c8\u30ea</li> <li>\u30b2\u30fc\u30e0\u30d5\u30a1\u30af\u30c8\u30ea: \u30c6\u30fc\u30de\u306b\u5fdc\u3058\u305f\u30b2\u30fc\u30e0\u30aa\u30d6\u30b8\u30a7\u30af\u30c8</li> <li>\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30d5\u30a1\u30af\u30c8\u30ea: \u7570\u306a\u308b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u306e\u63a5\u7d9a</li> </ol> <p>Rust \u306e\u30c8\u30ec\u30a4\u30c8\u3068\u30c8\u30ec\u30a4\u30c8\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u4f7f\u3046\u3053\u3068\u3067\u3001\u67d4\u8edf\u3067\u578b\u5b89\u5168\u306a Abstract Factory \u3092\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"rust/13-abstract-factory-pattern/#_7","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/rust/part5/src/chapter13.rs</code></li> </ul>"},{"location":"rust/13-abstract-factory-pattern/#_8","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Abstract Server \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u30b5\u30fc\u30d0\u30fc\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u62bd\u8c61\u5316\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"rust/14-abstract-server-pattern/","title":"\u7b2c14\u7ae0: Abstract Server \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"rust/14-abstract-server-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Abstract Server \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30b5\u30fc\u30d0\u30fc\uff08\u30b5\u30fc\u30d3\u30b9\u63d0\u4f9b\u8005\uff09\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u62bd\u8c61\u5316\u3057\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3092\u5177\u4f53\u7684\u306a\u5b9f\u88c5\u304b\u3089\u5206\u96e2\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u4f9d\u5b58\u6027\u6ce8\u5165\uff08DI\uff09\u3068\u7d44\u307f\u5408\u308f\u305b\u3066\u4f7f\u7528\u3055\u308c\u308b\u3053\u3068\u304c\u591a\u304f\u3001\u30c6\u30b9\u30c8\u5bb9\u6613\u6027\u3068\u30e2\u30b8\u30e5\u30fc\u30eb\u6027\u3092\u5411\u4e0a\u3055\u305b\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u30b5\u30fc\u30d3\u30b9\u3001\u901a\u77e5\u30b5\u30fc\u30d3\u30b9\u3001\u8a8d\u8a3c\u30b5\u30fc\u30d3\u30b9\u306a\u3069\u3001\u69d8\u3005\u306a\u4f8b\u3092\u901a\u3058\u3066 Abstract Server \u30d1\u30bf\u30fc\u30f3\u306e Rust \u3067\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"rust/14-abstract-server-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":""},{"location":"rust/14-abstract-server-pattern/#2","title":"2. \u30b9\u30c8\u30ec\u30fc\u30b8\u30b5\u30fc\u30d3\u30b9","text":""},{"location":"rust/14-abstract-server-pattern/#_2","title":"\u30c8\u30ec\u30a4\u30c8\u5b9a\u7fa9","text":"<pre><code>/// \u30b9\u30c8\u30ec\u30fc\u30b8\u30c8\u30ec\u30a4\u30c8\npub trait Storage {\n    fn read(&amp;self, key: &amp;str) -&gt; Option&lt;String&gt;;\n    fn write(&amp;mut self, key: &amp;str, value: &amp;str) -&gt; Result&lt;(), String&gt;;\n    fn delete(&amp;mut self, key: &amp;str) -&gt; Result&lt;(), String&gt;;\n    fn exists(&amp;self, key: &amp;str) -&gt; bool;\n    fn list_keys(&amp;self) -&gt; Vec&lt;String&gt;;\n}\n</code></pre>"},{"location":"rust/14-abstract-server-pattern/#_3","title":"\u30a4\u30f3\u30e1\u30e2\u30ea\u5b9f\u88c5","text":"<pre><code>/// \u30a4\u30f3\u30e1\u30e2\u30ea\u30b9\u30c8\u30ec\u30fc\u30b8\npub struct MemoryStorage {\n    data: HashMap&lt;String, String&gt;,\n}\n\nimpl MemoryStorage {\n    pub fn new() -&gt; MemoryStorage {\n        MemoryStorage {\n            data: HashMap::new(),\n        }\n    }\n}\n\nimpl Storage for MemoryStorage {\n    fn read(&amp;self, key: &amp;str) -&gt; Option&lt;String&gt; {\n        self.data.get(key).cloned()\n    }\n\n    fn write(&amp;mut self, key: &amp;str, value: &amp;str) -&gt; Result&lt;(), String&gt; {\n        self.data.insert(key.to_string(), value.to_string());\n        Ok(())\n    }\n\n    fn delete(&amp;mut self, key: &amp;str) -&gt; Result&lt;(), String&gt; {\n        self.data.remove(key);\n        Ok(())\n    }\n\n    fn exists(&amp;self, key: &amp;str) -&gt; bool {\n        self.data.contains_key(key)\n    }\n\n    fn list_keys(&amp;self) -&gt; Vec&lt;String&gt; {\n        self.data.keys().cloned().collect()\n    }\n}\n</code></pre>"},{"location":"rust/14-abstract-server-pattern/#_4","title":"\u30d5\u30a1\u30a4\u30eb\u30b9\u30c8\u30ec\u30fc\u30b8\u5b9f\u88c5","text":"<pre><code>/// \u30d5\u30a1\u30a4\u30eb\u30b9\u30c8\u30ec\u30fc\u30b8\npub struct FileStorage {\n    base_path: PathBuf,\n}\n\nimpl FileStorage {\n    pub fn new(base_path: &amp;str) -&gt; FileStorage {\n        FileStorage {\n            base_path: PathBuf::from(base_path),\n        }\n    }\n\n    fn file_path(&amp;self, key: &amp;str) -&gt; PathBuf {\n        self.base_path.join(key)\n    }\n}\n\nimpl Storage for FileStorage {\n    fn read(&amp;self, key: &amp;str) -&gt; Option&lt;String&gt; {\n        std::fs::read_to_string(self.file_path(key)).ok()\n    }\n\n    fn write(&amp;mut self, key: &amp;str, value: &amp;str) -&gt; Result&lt;(), String&gt; {\n        std::fs::write(self.file_path(key), value)\n            .map_err(|e| e.to_string())\n    }\n\n    fn delete(&amp;mut self, key: &amp;str) -&gt; Result&lt;(), String&gt; {\n        std::fs::remove_file(self.file_path(key))\n            .map_err(|e| e.to_string())\n    }\n\n    fn exists(&amp;self, key: &amp;str) -&gt; bool {\n        self.file_path(key).exists()\n    }\n\n    fn list_keys(&amp;self) -&gt; Vec&lt;String&gt; {\n        std::fs::read_dir(&amp;self.base_path)\n            .map(|entries| {\n                entries\n                    .filter_map(|e| e.ok())\n                    .filter_map(|e| e.file_name().into_string().ok())\n                    .collect()\n            })\n            .unwrap_or_default()\n    }\n}\n</code></pre>"},{"location":"rust/14-abstract-server-pattern/#3","title":"3. \u901a\u77e5\u30b5\u30fc\u30d3\u30b9","text":"<pre><code>/// \u901a\u77e5\u30c8\u30ec\u30a4\u30c8\npub trait NotificationService {\n    fn send(&amp;self, recipient: &amp;str, message: &amp;str) -&gt; Result&lt;(), String&gt;;\n    fn send_bulk(&amp;self, recipients: &amp;[&amp;str], message: &amp;str) -&gt; Vec&lt;Result&lt;(), String&gt;&gt;;\n}\n\n/// \u30e1\u30fc\u30eb\u901a\u77e5\npub struct EmailNotification {\n    smtp_server: String,\n}\n\nimpl NotificationService for EmailNotification {\n    fn send(&amp;self, recipient: &amp;str, message: &amp;str) -&gt; Result&lt;(), String&gt; {\n        // \u5b9f\u969b\u306b\u306fSMTP\u30b5\u30fc\u30d0\u30fc\u306b\u63a5\u7d9a\n        println!(\"Sending email to {} via {}: {}\", recipient, self.smtp_server, message);\n        Ok(())\n    }\n\n    fn send_bulk(&amp;self, recipients: &amp;[&amp;str], message: &amp;str) -&gt; Vec&lt;Result&lt;(), String&gt;&gt; {\n        recipients.iter().map(|r| self.send(r, message)).collect()\n    }\n}\n\n/// SMS \u901a\u77e5\npub struct SmsNotification {\n    api_key: String,\n}\n\nimpl NotificationService for SmsNotification {\n    fn send(&amp;self, recipient: &amp;str, message: &amp;str) -&gt; Result&lt;(), String&gt; {\n        println!(\"Sending SMS to {}: {}\", recipient, message);\n        Ok(())\n    }\n\n    fn send_bulk(&amp;self, recipients: &amp;[&amp;str], message: &amp;str) -&gt; Vec&lt;Result&lt;(), String&gt;&gt; {\n        recipients.iter().map(|r| self.send(r, message)).collect()\n    }\n}\n\n/// \u30e2\u30c3\u30af\u901a\u77e5\uff08\u30c6\u30b9\u30c8\u7528\uff09\npub struct MockNotification {\n    pub sent: RefCell&lt;Vec&lt;(String, String)&gt;&gt;,\n}\n\nimpl NotificationService for MockNotification {\n    fn send(&amp;self, recipient: &amp;str, message: &amp;str) -&gt; Result&lt;(), String&gt; {\n        self.sent.borrow_mut().push((recipient.to_string(), message.to_string()));\n        Ok(())\n    }\n\n    fn send_bulk(&amp;self, recipients: &amp;[&amp;str], message: &amp;str) -&gt; Vec&lt;Result&lt;(), String&gt;&gt; {\n        recipients.iter().map(|r| self.send(r, message)).collect()\n    }\n}\n</code></pre>"},{"location":"rust/14-abstract-server-pattern/#4","title":"4. \u8a8d\u8a3c\u30b5\u30fc\u30d3\u30b9","text":"<pre><code>/// \u30e6\u30fc\u30b6\u30fc\u60c5\u5831\n#[derive(Debug, Clone)]\npub struct User {\n    pub id: String,\n    pub username: String,\n    pub email: String,\n}\n\n/// \u8a8d\u8a3c\u7d50\u679c\npub enum AuthResult {\n    Success(User),\n    InvalidCredentials,\n    AccountLocked,\n    Error(String),\n}\n\n/// \u8a8d\u8a3c\u30c8\u30ec\u30a4\u30c8\npub trait AuthService {\n    fn authenticate(&amp;self, username: &amp;str, password: &amp;str) -&gt; AuthResult;\n    fn validate_token(&amp;self, token: &amp;str) -&gt; Option&lt;User&gt;;\n    fn logout(&amp;mut self, token: &amp;str) -&gt; Result&lt;(), String&gt;;\n}\n\n/// \u57fa\u672c\u8a8d\u8a3c\npub struct BasicAuthService {\n    users: HashMap&lt;String, (String, User)&gt;,  // username -&gt; (password_hash, user)\n    sessions: HashMap&lt;String, User&gt;,          // token -&gt; user\n}\n\nimpl AuthService for BasicAuthService {\n    fn authenticate(&amp;self, username: &amp;str, password: &amp;str) -&gt; AuthResult {\n        match self.users.get(username) {\n            Some((stored_hash, user)) if self.verify_password(password, stored_hash) =&gt; {\n                AuthResult::Success(user.clone())\n            }\n            Some(_) =&gt; AuthResult::InvalidCredentials,\n            None =&gt; AuthResult::InvalidCredentials,\n        }\n    }\n\n    fn validate_token(&amp;self, token: &amp;str) -&gt; Option&lt;User&gt; {\n        self.sessions.get(token).cloned()\n    }\n\n    fn logout(&amp;mut self, token: &amp;str) -&gt; Result&lt;(), String&gt; {\n        self.sessions.remove(token);\n        Ok(())\n    }\n}\n</code></pre>"},{"location":"rust/14-abstract-server-pattern/#5","title":"5. \u4f9d\u5b58\u6027\u6ce8\u5165","text":"<pre><code>/// \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u30b5\u30fc\u30d3\u30b9\npub struct Application {\n    storage: Box&lt;dyn Storage&gt;,\n    notifications: Box&lt;dyn NotificationService&gt;,\n    auth: Box&lt;dyn AuthService&gt;,\n}\n\nimpl Application {\n    pub fn new(\n        storage: Box&lt;dyn Storage&gt;,\n        notifications: Box&lt;dyn NotificationService&gt;,\n        auth: Box&lt;dyn AuthService&gt;,\n    ) -&gt; Application {\n        Application {\n            storage,\n            notifications,\n            auth,\n        }\n    }\n\n    pub fn save_and_notify(&amp;mut self, key: &amp;str, value: &amp;str, recipient: &amp;str) -&gt; Result&lt;(), String&gt; {\n        self.storage.write(key, value)?;\n        self.notifications.send(recipient, &amp;format!(\"Data saved: {}\", key))\n    }\n}\n\n// \u672c\u756a\u74b0\u5883\nlet app = Application::new(\n    Box::new(FileStorage::new(\"/data\")),\n    Box::new(EmailNotification { smtp_server: \"smtp.example.com\".to_string() }),\n    Box::new(BasicAuthService::new()),\n);\n\n// \u30c6\u30b9\u30c8\u74b0\u5883\nlet test_app = Application::new(\n    Box::new(MemoryStorage::new()),\n    Box::new(MockNotification { sent: RefCell::new(Vec::new()) }),\n    Box::new(MockAuthService::new()),\n);\n</code></pre>"},{"location":"rust/14-abstract-server-pattern/#6","title":"6. \u30b5\u30fc\u30d3\u30b9\u30ec\u30b8\u30b9\u30c8\u30ea","text":"<pre><code>/// \u30b5\u30fc\u30d3\u30b9\u30ec\u30b8\u30b9\u30c8\u30ea\npub struct ServiceRegistry {\n    storage: Option&lt;Box&lt;dyn Storage&gt;&gt;,\n    notifications: Option&lt;Box&lt;dyn NotificationService&gt;&gt;,\n    auth: Option&lt;Box&lt;dyn AuthService&gt;&gt;,\n}\n\nimpl ServiceRegistry {\n    pub fn new() -&gt; ServiceRegistry {\n        ServiceRegistry {\n            storage: None,\n            notifications: None,\n            auth: None,\n        }\n    }\n\n    pub fn with_storage(mut self, storage: Box&lt;dyn Storage&gt;) -&gt; Self {\n        self.storage = Some(storage);\n        self\n    }\n\n    pub fn with_notifications(mut self, notifications: Box&lt;dyn NotificationService&gt;) -&gt; Self {\n        self.notifications = Some(notifications);\n        self\n    }\n\n    pub fn with_auth(mut self, auth: Box&lt;dyn AuthService&gt;) -&gt; Self {\n        self.auth = Some(auth);\n        self\n    }\n\n    pub fn build(self) -&gt; Result&lt;Application, String&gt; {\n        Ok(Application::new(\n            self.storage.ok_or(\"Storage not configured\")?,\n            self.notifications.ok_or(\"Notifications not configured\")?,\n            self.auth.ok_or(\"Auth not configured\")?,\n        ))\n    }\n}\n</code></pre>"},{"location":"rust/14-abstract-server-pattern/#7","title":"7. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u30c6\u30b9\u30c8\u5bb9\u6613\u6027: \u30e2\u30c3\u30af\u5b9f\u88c5\u3067\u5358\u4f53\u30c6\u30b9\u30c8\u53ef\u80fd</li> <li>\u67d4\u8edf\u6027: \u5b9f\u88c5\u3092\u5207\u308a\u66ff\u3048\u53ef\u80fd</li> <li>\u5206\u96e2: \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u3068\u5b9f\u88c5\u306e\u758e\u7d50\u5408</li> <li>\u62e1\u5f35\u6027: \u65b0\u3057\u3044\u5b9f\u88c5\u3092\u8ffd\u52a0\u3057\u3084\u3059\u3044</li> </ol>"},{"location":"rust/14-abstract-server-pattern/#rust","title":"Rust \u3067\u306e\u7279\u5fb4","text":""},{"location":"rust/14-abstract-server-pattern/#_5","title":"\u30c8\u30ec\u30a4\u30c8\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u6240\u6709\u6a29","text":"<pre><code>// Box&lt;dyn Trait&gt; \u3067\u52d5\u7684\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\npub struct Application {\n    storage: Box&lt;dyn Storage&gt;,\n}\n</code></pre>"},{"location":"rust/14-abstract-server-pattern/#_6","title":"\u5185\u90e8\u53ef\u5909\u6027","text":"<pre><code>// RefCell \u3067\u5185\u90e8\u72b6\u614b\u3092\u5909\u66f4\npub struct MockNotification {\n    pub sent: RefCell&lt;Vec&lt;(String, String)&gt;&gt;,\n}\n</code></pre>"},{"location":"rust/14-abstract-server-pattern/#_7","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Abstract Server \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30b9\u30c8\u30ec\u30fc\u30b8\u30b5\u30fc\u30d3\u30b9: \u30d5\u30a1\u30a4\u30eb\u3001\u30e1\u30e2\u30ea\u3001\u30af\u30e9\u30a6\u30c9\u30b9\u30c8\u30ec\u30fc\u30b8</li> <li>\u901a\u77e5\u30b5\u30fc\u30d3\u30b9: \u30e1\u30fc\u30eb\u3001SMS\u3001\u30e2\u30c3\u30af</li> <li>\u8a8d\u8a3c\u30b5\u30fc\u30d3\u30b9: \u57fa\u672c\u8a8d\u8a3c\u3001OAuth\u3001\u30e2\u30c3\u30af</li> <li>\u4f9d\u5b58\u6027\u6ce8\u5165: \u30b5\u30fc\u30d3\u30b9\u306e\u7d44\u307f\u7acb\u3066</li> <li>\u30b5\u30fc\u30d3\u30b9\u30ec\u30b8\u30b9\u30c8\u30ea: \u30d3\u30eb\u30c0\u30fc\u30d1\u30bf\u30fc\u30f3\u3068\u306e\u7d44\u307f\u5408\u308f\u305b</li> </ol> <p>Rust \u306e\u30c8\u30ec\u30a4\u30c8\u30b7\u30b9\u30c6\u30e0\u3092\u6d3b\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u30c6\u30b9\u30c8\u53ef\u80fd\u3067\u4fdd\u5b88\u6027\u306e\u9ad8\u3044\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3092\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"rust/14-abstract-server-pattern/#_8","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/rust/part5/src/chapter14.rs</code></li> </ul>"},{"location":"rust/14-abstract-server-pattern/#_9","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001\u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b\u554f\u984c\u3092\u901a\u3058\u3066\u3001\u3053\u308c\u307e\u3067\u5b66\u3093\u3060\u30d1\u30bf\u30fc\u30f3\u3092\u5b9f\u8df5\u7684\u306b\u9069\u7528\u3057\u307e\u3059\u3002</p>"},{"location":"rust/15-gossiping-bus-drivers/","title":"\u7b2c15\u7ae0: \u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b","text":""},{"location":"rust/15-gossiping-bus-drivers/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u300c\u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b\u300d\u554f\u984c\u3092\u901a\u3058\u3066\u3001\u3053\u308c\u307e\u3067\u5b66\u3093\u3060\u95a2\u6570\u578b\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u3092\u5b9f\u8df5\u7684\u306b\u9069\u7528\u3057\u307e\u3059\u3002\u3053\u306e\u554f\u984c\u306f\u3001\u8907\u6570\u306e\u30d0\u30b9\u904b\u8ee2\u624b\u304c\u30eb\u30fc\u30c8\u3092\u8d70\u308a\u306a\u304c\u3089\u60c5\u5831\u3092\u4ea4\u63db\u3057\u3001\u5168\u54e1\u304c\u5168\u3066\u306e\u5642\u3092\u77e5\u308b\u307e\u3067\u306b\u4f55\u65e5\u304b\u304b\u308b\u304b\u3092\u8a08\u7b97\u3059\u308b\u3082\u306e\u3067\u3059\u3002</p>"},{"location":"rust/15-gossiping-bus-drivers/#1","title":"1. \u554f\u984c\u306e\u6982\u8981","text":"<ul> <li>\u8907\u6570\u306e\u30d0\u30b9\u904b\u8ee2\u624b\u304c\u3044\u308b</li> <li>\u5404\u904b\u8ee2\u624b\u306f\u56fa\u5b9a\u306e\u30eb\u30fc\u30c8\u3092\u6bce\u65e5\u8d70\u308b</li> <li>\u904b\u8ee2\u624b\u306f\u540c\u3058\u505c\u7559\u6240\u306b\u505c\u307e\u308b\u3068\u3001\u304a\u4e92\u3044\u306e\u5642\u3092\u4ea4\u63db\u3059\u308b</li> <li>\u5168\u54e1\u304c\u5168\u3066\u306e\u5642\u3092\u77e5\u308b\u307e\u3067\u306b\u4f55\u65e5\u304b\u304b\u308b\u304b\uff1f</li> </ul>"},{"location":"rust/15-gossiping-bus-drivers/#2","title":"2. \u30c7\u30fc\u30bf\u69cb\u9020","text":"<pre><code>/// \u505c\u7559\u6240\npub type Stop = usize;\n\n/// \u30eb\u30fc\u30c8\uff08\u505c\u7559\u6240\u306e\u5faa\u74b0\u30ea\u30b9\u30c8\uff09\n#[derive(Debug, Clone)]\npub struct Route {\n    stops: Vec&lt;Stop&gt;,\n    current_index: usize,\n}\n\nimpl Route {\n    pub fn new(stops: Vec&lt;Stop&gt;) -&gt; Route {\n        Route {\n            stops,\n            current_index: 0,\n        }\n    }\n\n    pub fn current_stop(&amp;self) -&gt; Stop {\n        self.stops[self.current_index]\n    }\n\n    pub fn advance(&amp;self) -&gt; Route {\n        Route {\n            stops: self.stops.clone(),\n            current_index: (self.current_index + 1) % self.stops.len(),\n        }\n    }\n}\n\n/// \u904b\u8ee2\u624b\n#[derive(Debug, Clone)]\npub struct Driver {\n    pub id: usize,\n    pub route: Route,\n    pub gossips: HashSet&lt;usize&gt;,  // \u77e5\u3063\u3066\u3044\u308b\u5642\u306eID\n}\n\nimpl Driver {\n    pub fn new(id: usize, route: Route) -&gt; Driver {\n        let mut gossips = HashSet::new();\n        gossips.insert(id);  // \u6700\u521d\u306f\u81ea\u5206\u306e\u5642\u3060\u3051\u77e5\u3063\u3066\u3044\u308b\n        Driver { id, route, gossips }\n    }\n\n    pub fn current_stop(&amp;self) -&gt; Stop {\n        self.route.current_stop()\n    }\n\n    pub fn advance(&amp;self) -&gt; Driver {\n        Driver {\n            id: self.id,\n            route: self.route.advance(),\n            gossips: self.gossips.clone(),\n        }\n    }\n\n    pub fn share_gossips(&amp;self, other_gossips: &amp;HashSet&lt;usize&gt;) -&gt; Driver {\n        Driver {\n            id: self.id,\n            route: self.route.clone(),\n            gossips: self.gossips.union(other_gossips).cloned().collect(),\n        }\n    }\n\n    pub fn knows_all(&amp;self, total_drivers: usize) -&gt; bool {\n        self.gossips.len() == total_drivers\n    }\n}\n</code></pre>"},{"location":"rust/15-gossiping-bus-drivers/#3","title":"3. \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3","text":"<pre><code>/// \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u72b6\u614b\n#[derive(Debug, Clone)]\npub struct Simulation {\n    pub drivers: Vec&lt;Driver&gt;,\n    pub day: usize,\n    pub stop: usize,  // 1\u65e5\u3042\u305f\u308a\u306e\u505c\u7559\u6240\u6570\n}\n\nimpl Simulation {\n    pub fn new(routes: Vec&lt;Vec&lt;Stop&gt;&gt;) -&gt; Simulation {\n        let drivers = routes\n            .into_iter()\n            .enumerate()\n            .map(|(id, stops)| Driver::new(id, Route::new(stops)))\n            .collect();\n\n        Simulation {\n            drivers,\n            day: 1,\n            stop: 0,\n        }\n    }\n\n    /// \u540c\u3058\u505c\u7559\u6240\u306b\u3044\u308b\u904b\u8ee2\u624b\u9593\u3067\u5642\u3092\u4ea4\u63db\n    fn exchange_gossips(&amp;self) -&gt; Vec&lt;Driver&gt; {\n        let mut drivers_by_stop: HashMap&lt;Stop, Vec&lt;usize&gt;&gt; = HashMap::new();\n\n        // \u505c\u7559\u6240\u3054\u3068\u306b\u904b\u8ee2\u624b\u3092\u30b0\u30eb\u30fc\u30d7\u5316\n        for (i, driver) in self.drivers.iter().enumerate() {\n            drivers_by_stop\n                .entry(driver.current_stop())\n                .or_default()\n                .push(i);\n        }\n\n        // \u540c\u3058\u505c\u7559\u6240\u306e\u904b\u8ee2\u624b\u9593\u3067\u5642\u3092\u4ea4\u63db\n        let mut new_drivers = self.drivers.clone();\n        for driver_indices in drivers_by_stop.values() {\n            if driver_indices.len() &gt; 1 {\n                // \u5168\u3066\u306e\u5642\u3092\u53ce\u96c6\n                let combined_gossips: HashSet&lt;usize&gt; = driver_indices\n                    .iter()\n                    .flat_map(|&amp;i| self.drivers[i].gossips.iter().cloned())\n                    .collect();\n\n                // \u5404\u904b\u8ee2\u624b\u306b\u5642\u3092\u5171\u6709\n                for &amp;i in driver_indices {\n                    new_drivers[i] = new_drivers[i].share_gossips(&amp;combined_gossips);\n                }\n            }\n        }\n\n        new_drivers\n    }\n\n    /// 1\u505c\u7559\u6240\u9032\u3081\u308b\n    pub fn step(&amp;self) -&gt; Simulation {\n        let drivers_after_exchange = self.exchange_gossips();\n        let drivers_advanced: Vec&lt;Driver&gt; = drivers_after_exchange\n            .into_iter()\n            .map(|d| d.advance())\n            .collect();\n\n        let new_stop = self.stop + 1;\n        let (day, stop) = if new_stop &gt;= 480 {  // 8\u6642\u9593 = 480\u5206\uff081\u52061\u505c\u7559\u6240\uff09\n            (self.day + 1, 0)\n        } else {\n            (self.day, new_stop)\n        };\n\n        Simulation {\n            drivers: drivers_advanced,\n            day,\n            stop,\n        }\n    }\n\n    /// \u5168\u54e1\u304c\u5168\u3066\u306e\u5642\u3092\u77e5\u3063\u3066\u3044\u308b\u304b\n    pub fn all_know_everything(&amp;self) -&gt; bool {\n        let total = self.drivers.len();\n        self.drivers.iter().all(|d| d.knows_all(total))\n    }\n}\n\n/// \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u5b9f\u884c\npub fn run_simulation(routes: Vec&lt;Vec&lt;Stop&gt;&gt;, max_days: usize) -&gt; Option&lt;usize&gt; {\n    let stops_per_day = 480;\n    let max_stops = max_days * stops_per_day;\n    let mut sim = Simulation::new(routes);\n\n    for _ in 0..max_stops {\n        if sim.all_know_everything() {\n            return Some(sim.day);\n        }\n        sim = sim.step();\n    }\n\n    None  // max_days \u4ee5\u5185\u306b\u5b8c\u4e86\u3057\u306a\u3044\n}\n</code></pre>"},{"location":"rust/15-gossiping-bus-drivers/#4-dsl","title":"4. DSL \u306b\u3088\u308b\u30eb\u30fc\u30c8\u5b9a\u7fa9","text":"<pre><code>/// \u30eb\u30fc\u30c8\u30d3\u30eb\u30c0\u30fc\npub struct RouteBuilder {\n    routes: Vec&lt;Vec&lt;Stop&gt;&gt;,\n}\n\nimpl RouteBuilder {\n    pub fn new() -&gt; RouteBuilder {\n        RouteBuilder { routes: Vec::new() }\n    }\n\n    pub fn driver(mut self, stops: Vec&lt;Stop&gt;) -&gt; RouteBuilder {\n        self.routes.push(stops);\n        self\n    }\n\n    pub fn build(self) -&gt; Vec&lt;Vec&lt;Stop&gt;&gt; {\n        self.routes\n    }\n}\n\n/// DSL \u30de\u30af\u30ed\nmacro_rules! routes {\n    ($($stops:expr),* $(,)?) =&gt; {\n        RouteBuilder::new()\n            $(.driver($stops))*\n            .build()\n    };\n}\n\n// \u4f7f\u7528\u4f8b\nlet routes = routes![\n    vec![1, 2, 3],\n    vec![2, 3, 4],\n    vec![3, 4, 5],\n];\n</code></pre>"},{"location":"rust/15-gossiping-bus-drivers/#5","title":"5. \u30c6\u30b9\u30c8\u4f8b","text":"<pre><code>#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_simple_exchange() {\n        // 2\u4eba\u306e\u904b\u8ee2\u624b\u304c\u540c\u3058\u505c\u7559\u6240\u3092\u5171\u6709\n        let routes = vec![\n            vec![1, 2, 3],\n            vec![2, 3, 4],\n        ];\n        let result = run_simulation(routes, 10);\n        assert!(result.is_some());\n    }\n\n    #[test]\n    fn test_no_common_stop() {\n        // \u5171\u901a\u306e\u505c\u7559\u6240\u304c\u306a\u3044\n        let routes = vec![\n            vec![1, 2, 3],\n            vec![4, 5, 6],\n        ];\n        let result = run_simulation(routes, 10);\n        assert!(result.is_none());\n    }\n\n    #[test]\n    fn test_three_drivers() {\n        let routes = vec![\n            vec![3, 1, 2, 3],\n            vec![3, 2, 3, 1],\n            vec![4, 2, 3, 4, 5],\n        ];\n        let result = run_simulation(routes, 10);\n        assert_eq!(result, Some(2));\n    }\n}\n</code></pre>"},{"location":"rust/15-gossiping-bus-drivers/#6","title":"6. \u30d1\u30bf\u30fc\u30f3\u306e\u9069\u7528","text":"<p>\u3053\u306e\u554f\u984c\u3067\u306f\u4ee5\u4e0b\u306e\u30d1\u30bf\u30fc\u30f3\u304c\u9069\u7528\u3055\u308c\u3066\u3044\u307e\u3059\uff1a</p> <ol> <li>\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020: Driver, Route, Simulation \u306f\u5168\u3066\u4e0d\u5909</li> <li>\u95a2\u6570\u5408\u6210: step() \u3092\u7e70\u308a\u8fd4\u3057\u9069\u7528</li> <li>DSL: routes! \u30de\u30af\u30ed\u306b\u3088\u308b\u5ba3\u8a00\u7684\u306a\u5b9a\u7fa9</li> <li>\u30a4\u30c6\u30ec\u30fc\u30bf: \u52b9\u7387\u7684\u306a\u30c7\u30fc\u30bf\u51e6\u7406</li> </ol>"},{"location":"rust/15-gossiping-bus-drivers/#_2","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u300c\u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b\u300d\u554f\u984c\u3092\u901a\u3058\u3066\uff1a</p> <ol> <li>\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u306b\u3088\u308b\u72b6\u614b\u7ba1\u7406</li> <li>\u7d14\u7c8b\u95a2\u6570\u306b\u3088\u308b\u72b6\u614b\u9077\u79fb</li> <li>DSL \u306b\u3088\u308b\u5ba3\u8a00\u7684\u306a\u554f\u984c\u5b9a\u7fa9</li> <li>\u30a4\u30c6\u30ec\u30fc\u30bf\u3092\u4f7f\u3063\u305f\u52b9\u7387\u7684\u306a\u51e6\u7406</li> </ol> <p>\u3092\u5b66\u3073\u307e\u3057\u305f\u3002\u95a2\u6570\u578b\u306e\u30a2\u30d7\u30ed\u30fc\u30c1\u306b\u3088\u308a\u3001\u30c6\u30b9\u30c8\u3057\u3084\u3059\u304f\u3001\u7406\u89e3\u3057\u3084\u3059\u3044\u30b3\u30fc\u30c9\u304c\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"rust/15-gossiping-bus-drivers/#_3","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/rust/part6/src/chapter15.rs</code></li> </ul>"},{"location":"rust/15-gossiping-bus-drivers/#_4","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0\u3092\u901a\u3058\u3066\u3001\u3088\u308a\u8907\u96d1\u306a\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"rust/16-payroll-system/","title":"\u7b2c16\u7ae0: \u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0","text":""},{"location":"rust/16-payroll-system/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0\u3092\u901a\u3058\u3066\u3001\u95a2\u6570\u578b\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u3092\u5b9f\u8df5\u7684\u306b\u9069\u7528\u3057\u307e\u3059\u3002\u5f93\u696d\u54e1\u306e\u7a2e\u985e\u3001\u652f\u6255\u3044\u65b9\u6cd5\u3001\u63a7\u9664\u306a\u3069\u3001\u8907\u96d1\u306a\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u3092\u7d14\u7c8b\u95a2\u6570\u3068\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u3067\u8868\u73fe\u3057\u307e\u3059\u3002</p>"},{"location":"rust/16-payroll-system/#1","title":"1. \u30c7\u30fc\u30bf\u69cb\u9020","text":""},{"location":"rust/16-payroll-system/#_2","title":"\u5f93\u696d\u54e1\u30bf\u30a4\u30d7","text":"<pre><code>use rust_decimal::Decimal;\n\n/// \u652f\u6255\u3044\u533a\u5206\n#[derive(Debug, Clone, PartialEq)]\npub enum PayClassification {\n    Hourly { hourly_rate: Decimal },\n    Salaried { monthly_salary: Decimal },\n    Commissioned { base_salary: Decimal, commission_rate: Decimal },\n}\n\n/// \u652f\u6255\u3044\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\n#[derive(Debug, Clone, PartialEq)]\npub enum PaySchedule {\n    Weekly,\n    BiWeekly,\n    Monthly,\n}\n\n/// \u652f\u6255\u3044\u65b9\u6cd5\n#[derive(Debug, Clone, PartialEq)]\npub enum PaymentMethod {\n    Hold,\n    Direct { bank: String, account: String },\n    Mail { address: String },\n}\n\n/// \u5f93\u696d\u54e1\n#[derive(Debug, Clone)]\npub struct Employee {\n    pub id: String,\n    pub name: String,\n    pub classification: PayClassification,\n    pub schedule: PaySchedule,\n    pub payment_method: PaymentMethod,\n}\n</code></pre>"},{"location":"rust/16-payroll-system/#_3","title":"\u30bf\u30a4\u30e0\u30ab\u30fc\u30c9\u3068\u58f2\u4e0a","text":"<pre><code>/// \u30bf\u30a4\u30e0\u30ab\u30fc\u30c9\n#[derive(Debug, Clone)]\npub struct TimeCard {\n    pub employee_id: String,\n    pub date: NaiveDate,\n    pub hours: Decimal,\n}\n\n/// \u58f2\u4e0a\u30ec\u30b3\u30fc\u30c9\n#[derive(Debug, Clone)]\npub struct SalesReceipt {\n    pub employee_id: String,\n    pub date: NaiveDate,\n    pub amount: Decimal,\n}\n</code></pre>"},{"location":"rust/16-payroll-system/#2","title":"2. \u7d66\u4e0e\u8a08\u7b97\u30ed\u30b8\u30c3\u30af","text":"<pre><code>/// \u7dcf\u652f\u7d66\u984d\u3092\u8a08\u7b97\npub fn calculate_gross_pay(\n    employee: &amp;Employee,\n    period_start: NaiveDate,\n    period_end: NaiveDate,\n    time_cards: &amp;[TimeCard],\n    sales_receipts: &amp;[SalesReceipt],\n) -&gt; Decimal {\n    match &amp;employee.classification {\n        PayClassification::Hourly { hourly_rate } =&gt; {\n            let total_hours: Decimal = time_cards\n                .iter()\n                .filter(|tc| {\n                    tc.employee_id == employee.id\n                        &amp;&amp; tc.date &gt;= period_start\n                        &amp;&amp; tc.date &lt;= period_end\n                })\n                .map(|tc| tc.hours)\n                .sum();\n\n            // \u6b8b\u696d\u8a08\u7b97\uff0840\u6642\u9593\u8d85\u904e\u5206\u306f1.5\u500d\uff09\n            let regular_hours = total_hours.min(Decimal::from(40));\n            let overtime_hours = (total_hours - Decimal::from(40)).max(Decimal::ZERO);\n\n            regular_hours * hourly_rate + overtime_hours * hourly_rate * Decimal::from_str(\"1.5\").unwrap()\n        }\n        PayClassification::Salaried { monthly_salary } =&gt; {\n            *monthly_salary\n        }\n        PayClassification::Commissioned { base_salary, commission_rate } =&gt; {\n            let total_sales: Decimal = sales_receipts\n                .iter()\n                .filter(|sr| {\n                    sr.employee_id == employee.id\n                        &amp;&amp; sr.date &gt;= period_start\n                        &amp;&amp; sr.date &lt;= period_end\n                })\n                .map(|sr| sr.amount)\n                .sum();\n\n            *base_salary + total_sales * commission_rate\n        }\n    }\n}\n</code></pre>"},{"location":"rust/16-payroll-system/#3","title":"3. \u63a7\u9664\u8a08\u7b97","text":"<pre><code>/// \u63a7\u9664\u30bf\u30a4\u30d7\n#[derive(Debug, Clone)]\npub enum Deduction {\n    Tax { rate: Decimal },\n    Insurance { amount: Decimal },\n    Union { amount: Decimal },\n    ServiceCharge { amount: Decimal },\n}\n\n/// \u63a7\u9664\u3092\u9069\u7528\npub fn apply_deductions(gross_pay: Decimal, deductions: &amp;[Deduction]) -&gt; (Decimal, Vec&lt;(String, Decimal)&gt;) {\n    let mut details = Vec::new();\n    let mut net_pay = gross_pay;\n\n    for deduction in deductions {\n        let (name, amount) = match deduction {\n            Deduction::Tax { rate } =&gt; {\n                let tax = gross_pay * rate;\n                (\"Tax\".to_string(), tax)\n            }\n            Deduction::Insurance { amount } =&gt; {\n                (\"Insurance\".to_string(), *amount)\n            }\n            Deduction::Union { amount } =&gt; {\n                (\"Union\".to_string(), *amount)\n            }\n            Deduction::ServiceCharge { amount } =&gt; {\n                (\"Service Charge\".to_string(), *amount)\n            }\n        };\n\n        net_pay -= amount;\n        details.push((name, amount));\n    }\n\n    (net_pay, details)\n}\n</code></pre>"},{"location":"rust/16-payroll-system/#4","title":"4. \u7d66\u4e0e\u660e\u7d30","text":"<pre><code>/// \u7d66\u4e0e\u660e\u7d30\n#[derive(Debug, Clone)]\npub struct Payslip {\n    pub employee_id: String,\n    pub employee_name: String,\n    pub period_start: NaiveDate,\n    pub period_end: NaiveDate,\n    pub gross_pay: Decimal,\n    pub deductions: Vec&lt;(String, Decimal)&gt;,\n    pub net_pay: Decimal,\n}\n\n/// \u7d66\u4e0e\u660e\u7d30\u3092\u751f\u6210\npub fn generate_payslip(\n    employee: &amp;Employee,\n    period_start: NaiveDate,\n    period_end: NaiveDate,\n    time_cards: &amp;[TimeCard],\n    sales_receipts: &amp;[SalesReceipt],\n    deductions: &amp;[Deduction],\n) -&gt; Payslip {\n    let gross_pay = calculate_gross_pay(\n        employee, period_start, period_end, time_cards, sales_receipts\n    );\n\n    let (net_pay, deduction_details) = apply_deductions(gross_pay, deductions);\n\n    Payslip {\n        employee_id: employee.id.clone(),\n        employee_name: employee.name.clone(),\n        period_start,\n        period_end,\n        gross_pay,\n        deductions: deduction_details,\n        net_pay,\n    }\n}\n</code></pre>"},{"location":"rust/16-payroll-system/#5","title":"5. \u652f\u6255\u3044\u65e5\u5224\u5b9a","text":"<pre><code>/// \u652f\u6255\u3044\u65e5\u304b\u3069\u3046\u304b\u3092\u5224\u5b9a\npub fn is_pay_day(employee: &amp;Employee, date: NaiveDate) -&gt; bool {\n    match employee.schedule {\n        PaySchedule::Weekly =&gt; date.weekday() == Weekday::Fri,\n        PaySchedule::BiWeekly =&gt; {\n            date.weekday() == Weekday::Fri &amp;&amp; date.iso_week().week() % 2 == 0\n        }\n        PaySchedule::Monthly =&gt; {\n            let next_day = date + chrono::Duration::days(1);\n            next_day.month() != date.month()\n        }\n    }\n}\n\n/// \u652f\u6255\u3044\u671f\u9593\u3092\u8a08\u7b97\npub fn calculate_pay_period(employee: &amp;Employee, pay_date: NaiveDate) -&gt; (NaiveDate, NaiveDate) {\n    match employee.schedule {\n        PaySchedule::Weekly =&gt; {\n            let start = pay_date - chrono::Duration::days(6);\n            (start, pay_date)\n        }\n        PaySchedule::BiWeekly =&gt; {\n            let start = pay_date - chrono::Duration::days(13);\n            (start, pay_date)\n        }\n        PaySchedule::Monthly =&gt; {\n            let start = NaiveDate::from_ymd_opt(pay_date.year(), pay_date.month(), 1).unwrap();\n            (start, pay_date)\n        }\n    }\n}\n</code></pre>"},{"location":"rust/16-payroll-system/#6","title":"6. \u30da\u30a4\u30ed\u30fc\u30eb\u5b9f\u884c","text":"<pre><code>/// \u30da\u30a4\u30ed\u30fc\u30eb\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\npub struct PayrollContext {\n    pub employees: Vec&lt;Employee&gt;,\n    pub time_cards: Vec&lt;TimeCard&gt;,\n    pub sales_receipts: Vec&lt;SalesReceipt&gt;,\n    pub deductions: HashMap&lt;String, Vec&lt;Deduction&gt;&gt;,\n}\n\n/// \u30da\u30a4\u30ed\u30fc\u30eb\u3092\u5b9f\u884c\npub fn run_payroll(context: &amp;PayrollContext, date: NaiveDate) -&gt; Vec&lt;Payslip&gt; {\n    context.employees\n        .iter()\n        .filter(|emp| is_pay_day(emp, date))\n        .map(|emp| {\n            let (start, end) = calculate_pay_period(emp, date);\n            let emp_deductions = context.deductions.get(&amp;emp.id).cloned().unwrap_or_default();\n\n            generate_payslip(\n                emp,\n                start,\n                end,\n                &amp;context.time_cards,\n                &amp;context.sales_receipts,\n                &amp;emp_deductions,\n            )\n        })\n        .collect()\n}\n</code></pre>"},{"location":"rust/16-payroll-system/#7","title":"7. \u30d1\u30bf\u30fc\u30f3\u306e\u9069\u7528","text":"<p>\u3053\u306e\u554f\u984c\u3067\u306f\u4ee5\u4e0b\u306e\u30d1\u30bf\u30fc\u30f3\u304c\u9069\u7528\u3055\u308c\u3066\u3044\u307e\u3059\uff1a</p> <ol> <li>ADT (enum): PayClassification, PaySchedule, PaymentMethod</li> <li>\u4e0d\u5909\u30c7\u30fc\u30bf: Employee, TimeCard, Payslip</li> <li>\u7d14\u7c8b\u95a2\u6570: calculate_gross_pay, apply_deductions</li> <li>Strategy: \u652f\u6255\u3044\u533a\u5206\u3054\u3068\u306e\u8a08\u7b97\u30ed\u30b8\u30c3\u30af</li> </ol>"},{"location":"rust/16-payroll-system/#_4","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0\u3092\u901a\u3058\u3066\uff1a</p> <ol> <li>enum \u306b\u3088\u308b\u591a\u69d8\u306a\u652f\u6255\u3044\u30bf\u30a4\u30d7\u306e\u8868\u73fe</li> <li>\u7d14\u7c8b\u95a2\u6570\u306b\u3088\u308b\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af</li> <li>\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u306b\u3088\u308b\u5b89\u5168\u306a\u72b6\u614b\u7ba1\u7406</li> <li>\u9ad8\u968e\u95a2\u6570\u306b\u3088\u308b\u30c7\u30fc\u30bf\u51e6\u7406</li> </ol> <p>\u3092\u5b66\u3073\u307e\u3057\u305f\u3002</p>"},{"location":"rust/16-payroll-system/#_5","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/rust/part6/src/chapter16.rs</code></li> </ul>"},{"location":"rust/16-payroll-system/#_6","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001\u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0\u3092\u901a\u3058\u3066\u3001\u3055\u3089\u306b\u8907\u96d1\u306a\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30ea\u30f3\u30b0\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"rust/17-video-rental-system/","title":"\u7b2c17\u7ae0: \u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0","text":""},{"location":"rust/17-video-rental-system/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0\u3092\u901a\u3058\u3066\u3001\u4fa1\u683c\u8a08\u7b97\u3001\u660e\u7d30\u66f8\u751f\u6210\u3001\u30dd\u30a4\u30f3\u30c8\u8a08\u7b97\u306a\u3069\u3001\u8907\u96d1\u306a\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u3092\u95a2\u6570\u578b\u3067\u5b9f\u88c5\u3057\u307e\u3059\u3002Strategy \u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u3063\u3066\u3001\u6620\u753b\u306e\u7a2e\u985e\u3054\u3068\u306b\u7570\u306a\u308b\u4fa1\u683c\u8a08\u7b97\u3092\u884c\u3044\u307e\u3059\u3002</p>"},{"location":"rust/17-video-rental-system/#1","title":"1. \u30c7\u30fc\u30bf\u69cb\u9020","text":""},{"location":"rust/17-video-rental-system/#_2","title":"\u6620\u753b\u3068\u30ec\u30f3\u30bf\u30eb","text":"<pre><code>use rust_decimal::Decimal;\n\n/// \u6620\u753b\u306e\u4fa1\u683c\u30b3\u30fc\u30c9\n#[derive(Debug, Clone, PartialEq)]\npub enum PriceCode {\n    Regular,\n    NewRelease,\n    Children,\n}\n\n/// \u6620\u753b\n#[derive(Debug, Clone)]\npub struct Movie {\n    pub title: String,\n    pub price_code: PriceCode,\n}\n\n/// \u30ec\u30f3\u30bf\u30eb\n#[derive(Debug, Clone)]\npub struct Rental {\n    pub movie: Movie,\n    pub days_rented: i32,\n}\n\n/// \u9867\u5ba2\n#[derive(Debug, Clone)]\npub struct Customer {\n    pub name: String,\n    pub rentals: Vec&lt;Rental&gt;,\n}\n</code></pre>"},{"location":"rust/17-video-rental-system/#2-strategy","title":"2. \u4fa1\u683c\u8a08\u7b97 Strategy","text":"<pre><code>/// \u4fa1\u683c\u8a08\u7b97\u30c8\u30ec\u30a4\u30c8\npub trait PricingStrategy {\n    fn calculate_price(&amp;self, days_rented: i32) -&gt; Decimal;\n    fn calculate_points(&amp;self, days_rented: i32) -&gt; i32;\n}\n\n/// \u901a\u5e38\u6599\u91d1\npub struct RegularPricing;\n\nimpl PricingStrategy for RegularPricing {\n    fn calculate_price(&amp;self, days_rented: i32) -&gt; Decimal {\n        let mut amount = Decimal::from(2);\n        if days_rented &gt; 2 {\n            amount += Decimal::from(days_rented - 2) * Decimal::from_str(\"1.5\").unwrap();\n        }\n        amount\n    }\n\n    fn calculate_points(&amp;self, _days_rented: i32) -&gt; i32 {\n        1\n    }\n}\n\n/// \u65b0\u4f5c\u6599\u91d1\npub struct NewReleasePricing;\n\nimpl PricingStrategy for NewReleasePricing {\n    fn calculate_price(&amp;self, days_rented: i32) -&gt; Decimal {\n        Decimal::from(days_rented) * Decimal::from(3)\n    }\n\n    fn calculate_points(&amp;self, days_rented: i32) -&gt; i32 {\n        if days_rented &gt; 1 { 2 } else { 1 }\n    }\n}\n\n/// \u5b50\u4f9b\u5411\u3051\u6599\u91d1\npub struct ChildrenPricing;\n\nimpl PricingStrategy for ChildrenPricing {\n    fn calculate_price(&amp;self, days_rented: i32) -&gt; Decimal {\n        let mut amount = Decimal::from_str(\"1.5\").unwrap();\n        if days_rented &gt; 3 {\n            amount += Decimal::from(days_rented - 3) * Decimal::from_str(\"1.5\").unwrap();\n        }\n        amount\n    }\n\n    fn calculate_points(&amp;self, _days_rented: i32) -&gt; i32 {\n        1\n    }\n}\n\n/// \u4fa1\u683c\u30b3\u30fc\u30c9\u304b\u3089 Strategy \u3092\u53d6\u5f97\npub fn get_pricing_strategy(price_code: &amp;PriceCode) -&gt; Box&lt;dyn PricingStrategy&gt; {\n    match price_code {\n        PriceCode::Regular =&gt; Box::new(RegularPricing),\n        PriceCode::NewRelease =&gt; Box::new(NewReleasePricing),\n        PriceCode::Children =&gt; Box::new(ChildrenPricing),\n    }\n}\n</code></pre>"},{"location":"rust/17-video-rental-system/#3","title":"3. \u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1","text":"<pre><code>/// \u30ec\u30f3\u30bf\u30eb\u6599\u91d1\u3092\u8a08\u7b97\npub fn calculate_rental_amount(rental: &amp;Rental) -&gt; Decimal {\n    match rental.movie.price_code {\n        PriceCode::Regular =&gt; {\n            let mut amount = Decimal::from(2);\n            if rental.days_rented &gt; 2 {\n                amount += Decimal::from(rental.days_rented - 2) * Decimal::from_str(\"1.5\").unwrap();\n            }\n            amount\n        }\n        PriceCode::NewRelease =&gt; {\n            Decimal::from(rental.days_rented) * Decimal::from(3)\n        }\n        PriceCode::Children =&gt; {\n            let mut amount = Decimal::from_str(\"1.5\").unwrap();\n            if rental.days_rented &gt; 3 {\n                amount += Decimal::from(rental.days_rented - 3) * Decimal::from_str(\"1.5\").unwrap();\n            }\n            amount\n        }\n    }\n}\n\n/// \u30dd\u30a4\u30f3\u30c8\u3092\u8a08\u7b97\npub fn calculate_rental_points(rental: &amp;Rental) -&gt; i32 {\n    let mut points = 1;\n    if rental.movie.price_code == PriceCode::NewRelease &amp;&amp; rental.days_rented &gt; 1 {\n        points += 1;\n    }\n    points\n}\n\n/// \u9867\u5ba2\u306e\u5408\u8a08\u91d1\u984d\u3092\u8a08\u7b97\npub fn calculate_total_amount(customer: &amp;Customer) -&gt; Decimal {\n    customer.rentals.iter().map(calculate_rental_amount).sum()\n}\n\n/// \u9867\u5ba2\u306e\u5408\u8a08\u30dd\u30a4\u30f3\u30c8\u3092\u8a08\u7b97\npub fn calculate_total_points(customer: &amp;Customer) -&gt; i32 {\n    customer.rentals.iter().map(calculate_rental_points).sum()\n}\n</code></pre>"},{"location":"rust/17-video-rental-system/#4","title":"4. \u660e\u7d30\u66f8\u751f\u6210","text":""},{"location":"rust/17-video-rental-system/#_3","title":"\u30c6\u30ad\u30b9\u30c8\u5f62\u5f0f","text":"<pre><code>/// \u660e\u7d30\u66f8\u3092\u751f\u6210\uff08\u30c6\u30ad\u30b9\u30c8\u5f62\u5f0f\uff09\npub fn statement(customer: &amp;Customer) -&gt; String {\n    let mut result = format!(\"Rental Record for {}\\n\", customer.name);\n\n    for rental in &amp;customer.rentals {\n        let amount = calculate_rental_amount(rental);\n        result.push_str(&amp;format!(\n            \"\\t{}\\t{}\\n\",\n            rental.movie.title,\n            amount\n        ));\n    }\n\n    let total_amount = calculate_total_amount(customer);\n    let total_points = calculate_total_points(customer);\n\n    result.push_str(&amp;format!(\"Amount owed is {}\\n\", total_amount));\n    result.push_str(&amp;format!(\"You earned {} frequent renter points\", total_points));\n\n    result\n}\n</code></pre>"},{"location":"rust/17-video-rental-system/#html","title":"HTML \u5f62\u5f0f","text":"<pre><code>/// \u660e\u7d30\u66f8\u3092\u751f\u6210\uff08HTML\u5f62\u5f0f\uff09\npub fn html_statement(customer: &amp;Customer) -&gt; String {\n    let mut result = format!(\"&lt;h1&gt;Rental Record for &lt;em&gt;{}&lt;/em&gt;&lt;/h1&gt;\\n\", customer.name);\n    result.push_str(\"&lt;ul&gt;\\n\");\n\n    for rental in &amp;customer.rentals {\n        let amount = calculate_rental_amount(rental);\n        result.push_str(&amp;format!(\n            \"&lt;li&gt;{} - {}&lt;/li&gt;\\n\",\n            rental.movie.title,\n            amount\n        ));\n    }\n\n    result.push_str(\"&lt;/ul&gt;\\n\");\n\n    let total_amount = calculate_total_amount(customer);\n    let total_points = calculate_total_points(customer);\n\n    result.push_str(&amp;format!(\"&lt;p&gt;Amount owed is &lt;strong&gt;{}&lt;/strong&gt;&lt;/p&gt;\\n\", total_amount));\n    result.push_str(&amp;format!(\"&lt;p&gt;You earned &lt;strong&gt;{}&lt;/strong&gt; frequent renter points&lt;/p&gt;\", total_points));\n\n    result\n}\n</code></pre>"},{"location":"rust/17-video-rental-system/#5-strategy","title":"5. \u30d5\u30a9\u30fc\u30de\u30c3\u30bf\u30fc Strategy","text":"<pre><code>/// \u660e\u7d30\u66f8\u30d5\u30a9\u30fc\u30de\u30c3\u30bf\u30fc\npub trait StatementFormatter {\n    fn format_header(&amp;self, customer_name: &amp;str) -&gt; String;\n    fn format_rental(&amp;self, movie_title: &amp;str, amount: Decimal) -&gt; String;\n    fn format_footer(&amp;self, total_amount: Decimal, total_points: i32) -&gt; String;\n}\n\n/// \u30c6\u30ad\u30b9\u30c8\u30d5\u30a9\u30fc\u30de\u30c3\u30bf\u30fc\npub struct TextFormatter;\n\nimpl StatementFormatter for TextFormatter {\n    fn format_header(&amp;self, customer_name: &amp;str) -&gt; String {\n        format!(\"Rental Record for {}\\n\", customer_name)\n    }\n\n    fn format_rental(&amp;self, movie_title: &amp;str, amount: Decimal) -&gt; String {\n        format!(\"\\t{}\\t{}\\n\", movie_title, amount)\n    }\n\n    fn format_footer(&amp;self, total_amount: Decimal, total_points: i32) -&gt; String {\n        format!(\n            \"Amount owed is {}\\nYou earned {} frequent renter points\",\n            total_amount, total_points\n        )\n    }\n}\n\n/// HTML \u30d5\u30a9\u30fc\u30de\u30c3\u30bf\u30fc\npub struct HtmlFormatter;\n\nimpl StatementFormatter for HtmlFormatter {\n    fn format_header(&amp;self, customer_name: &amp;str) -&gt; String {\n        format!(\"&lt;h1&gt;Rental Record for &lt;em&gt;{}&lt;/em&gt;&lt;/h1&gt;\\n&lt;ul&gt;\\n\", customer_name)\n    }\n\n    fn format_rental(&amp;self, movie_title: &amp;str, amount: Decimal) -&gt; String {\n        format!(\"&lt;li&gt;{} - {}&lt;/li&gt;\\n\", movie_title, amount)\n    }\n\n    fn format_footer(&amp;self, total_amount: Decimal, total_points: i32) -&gt; String {\n        format!(\n            \"&lt;/ul&gt;\\n&lt;p&gt;Amount owed is &lt;strong&gt;{}&lt;/strong&gt;&lt;/p&gt;\\n&lt;p&gt;You earned &lt;strong&gt;{}&lt;/strong&gt; frequent renter points&lt;/p&gt;\",\n            total_amount, total_points\n        )\n    }\n}\n\n/// \u30d5\u30a9\u30fc\u30de\u30c3\u30bf\u30fc\u3092\u4f7f\u3063\u3066\u660e\u7d30\u66f8\u3092\u751f\u6210\npub fn statement_with_formatter(customer: &amp;Customer, formatter: &amp;dyn StatementFormatter) -&gt; String {\n    let mut result = formatter.format_header(&amp;customer.name);\n\n    for rental in &amp;customer.rentals {\n        let amount = calculate_rental_amount(rental);\n        result.push_str(&amp;formatter.format_rental(&amp;rental.movie.title, amount));\n    }\n\n    let total_amount = calculate_total_amount(customer);\n    let total_points = calculate_total_points(customer);\n    result.push_str(&amp;formatter.format_footer(total_amount, total_points));\n\n    result\n}\n</code></pre>"},{"location":"rust/17-video-rental-system/#6","title":"6. \u30d1\u30bf\u30fc\u30f3\u306e\u9069\u7528","text":"<ol> <li>Strategy: \u4fa1\u683c\u8a08\u7b97\u3001\u660e\u7d30\u66f8\u30d5\u30a9\u30fc\u30de\u30c3\u30c8</li> <li>ADT: PriceCode \u306b\u3088\u308b\u6620\u753b\u7a2e\u5225\u306e\u8868\u73fe</li> <li>\u4e0d\u5909\u30c7\u30fc\u30bf: Movie, Rental, Customer</li> <li>\u9ad8\u968e\u95a2\u6570: map, sum \u306b\u3088\u308b\u96c6\u8a08</li> </ol>"},{"location":"rust/17-video-rental-system/#_4","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0\u3092\u901a\u3058\u3066\uff1a</p> <ol> <li>Strategy \u30d1\u30bf\u30fc\u30f3\u306b\u3088\u308b\u4fa1\u683c\u8a08\u7b97\u306e\u5207\u308a\u66ff\u3048</li> <li>ADT \u306b\u3088\u308b\u6620\u753b\u7a2e\u5225\u306e\u578b\u5b89\u5168\u306a\u8868\u73fe</li> <li>\u30d5\u30a9\u30fc\u30de\u30c3\u30bf\u30fc Strategy \u306b\u3088\u308b\u51fa\u529b\u5f62\u5f0f\u306e\u5207\u308a\u66ff\u3048</li> <li>\u7d14\u7c8b\u95a2\u6570\u306b\u3088\u308b\u8a08\u7b97\u30ed\u30b8\u30c3\u30af</li> </ol> <p>\u3092\u5b66\u3073\u307e\u3057\u305f\u3002</p>"},{"location":"rust/17-video-rental-system/#_5","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/rust/part6/src/chapter17.rs</code></li> </ul>"},{"location":"rust/17-video-rental-system/#_6","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001\u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0\u3092\u901a\u3058\u3066\u3001\u95a2\u6570\u578b\u3067\u306e\u4e26\u884c\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"rust/18-concurrency-system/","title":"\u7b2c18\u7ae0: \u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0","text":""},{"location":"rust/18-concurrency-system/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Rust \u306e\u4e26\u884c\u51e6\u7406\u6a5f\u80fd\u3092\u4f7f\u3063\u3066\u3001\u72b6\u614b\u6a5f\u68b0\u3001\u30a4\u30d9\u30f3\u30c8\u30d0\u30b9\u3001\u30bf\u30b9\u30af\u30ad\u30e5\u30fc\u306a\u3069\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002Rust \u306e\u6240\u6709\u6a29\u30b7\u30b9\u30c6\u30e0\u3068 Arc/Mutex \u3092\u6d3b\u7528\u3057\u305f\u5b89\u5168\u306a\u4e26\u884c\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"rust/18-concurrency-system/#1","title":"1. \u72b6\u614b\u6a5f\u68b0\uff08\u96fb\u8a71\u306e\u4f8b\uff09","text":"<pre><code>use std::sync::{Arc, Mutex};\n\n/// \u96fb\u8a71\u306e\u72b6\u614b\n#[derive(Debug, Clone, PartialEq)]\npub enum PhoneState {\n    Idle,\n    Ringing,\n    Connected,\n    OnHold,\n}\n\n/// \u96fb\u8a71\u30a4\u30d9\u30f3\u30c8\n#[derive(Debug, Clone)]\npub enum PhoneEvent {\n    IncomingCall { caller: String },\n    Answer,\n    HangUp,\n    Hold,\n    Resume,\n}\n\n/// \u96fb\u8a71\n#[derive(Debug, Clone)]\npub struct Phone {\n    pub state: PhoneState,\n    pub caller: Option&lt;String&gt;,\n}\n\nimpl Phone {\n    pub fn new() -&gt; Phone {\n        Phone {\n            state: PhoneState::Idle,\n            caller: None,\n        }\n    }\n\n    pub fn handle_event(&amp;self, event: PhoneEvent) -&gt; Result&lt;Phone, String&gt; {\n        match (&amp;self.state, event) {\n            (PhoneState::Idle, PhoneEvent::IncomingCall { caller }) =&gt; {\n                Ok(Phone {\n                    state: PhoneState::Ringing,\n                    caller: Some(caller),\n                })\n            }\n            (PhoneState::Ringing, PhoneEvent::Answer) =&gt; {\n                Ok(Phone {\n                    state: PhoneState::Connected,\n                    caller: self.caller.clone(),\n                })\n            }\n            (PhoneState::Ringing, PhoneEvent::HangUp) =&gt; {\n                Ok(Phone::new())\n            }\n            (PhoneState::Connected, PhoneEvent::Hold) =&gt; {\n                Ok(Phone {\n                    state: PhoneState::OnHold,\n                    caller: self.caller.clone(),\n                })\n            }\n            (PhoneState::Connected, PhoneEvent::HangUp) =&gt; {\n                Ok(Phone::new())\n            }\n            (PhoneState::OnHold, PhoneEvent::Resume) =&gt; {\n                Ok(Phone {\n                    state: PhoneState::Connected,\n                    caller: self.caller.clone(),\n                })\n            }\n            (PhoneState::OnHold, PhoneEvent::HangUp) =&gt; {\n                Ok(Phone::new())\n            }\n            (state, event) =&gt; {\n                Err(format!(\"Invalid event {:?} in state {:?}\", event, state))\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"rust/18-concurrency-system/#2","title":"2. \u30a4\u30d9\u30f3\u30c8\u30d0\u30b9","text":"<pre><code>use std::collections::HashMap;\n\n/// \u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\u30fc\u578b\npub type EventHandler = Box&lt;dyn Fn(&amp;str) + Send + Sync&gt;;\n\n/// \u30a4\u30d9\u30f3\u30c8\u30d0\u30b9\npub struct EventBus {\n    handlers: Arc&lt;Mutex&lt;HashMap&lt;String, Vec&lt;EventHandler&gt;&gt;&gt;&gt;,\n}\n\nimpl EventBus {\n    pub fn new() -&gt; EventBus {\n        EventBus {\n            handlers: Arc::new(Mutex::new(HashMap::new())),\n        }\n    }\n\n    pub fn subscribe(&amp;self, event_type: &amp;str, handler: EventHandler) {\n        let mut handlers = self.handlers.lock().unwrap();\n        handlers\n            .entry(event_type.to_string())\n            .or_insert_with(Vec::new)\n            .push(handler);\n    }\n\n    pub fn publish(&amp;self, event_type: &amp;str, data: &amp;str) {\n        let handlers = self.handlers.lock().unwrap();\n        if let Some(event_handlers) = handlers.get(event_type) {\n            for handler in event_handlers {\n                handler(data);\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"rust/18-concurrency-system/#3","title":"3. \u975e\u540c\u671f\u30bf\u30b9\u30af\u30ad\u30e5\u30fc","text":"<pre><code>use tokio::sync::mpsc;\nuse tokio::task::JoinHandle;\n\n/// \u30bf\u30b9\u30af\npub type Task = Box&lt;dyn FnOnce() + Send + 'static&gt;;\n\n/// \u30bf\u30b9\u30af\u30ad\u30e5\u30fc\npub struct TaskQueue {\n    sender: mpsc::Sender&lt;Task&gt;,\n    #[allow(dead_code)]\n    handles: Vec&lt;JoinHandle&lt;()&gt;&gt;,\n}\n\nimpl TaskQueue {\n    pub fn new(num_workers: usize) -&gt; TaskQueue {\n        let (sender, receiver) = mpsc::channel::&lt;Task&gt;(100);\n        let receiver = Arc::new(Mutex::new(receiver));\n        let mut handles = Vec::new();\n\n        for _ in 0..num_workers {\n            let receiver = Arc::clone(&amp;receiver);\n            let handle = tokio::spawn(async move {\n                loop {\n                    let task = {\n                        let mut rx = receiver.lock().unwrap();\n                        rx.try_recv().ok()\n                    };\n\n                    if let Some(task) = task {\n                        task();\n                    } else {\n                        tokio::time::sleep(tokio::time::Duration::from_millis(10)).await;\n                    }\n                }\n            });\n            handles.push(handle);\n        }\n\n        TaskQueue { sender, handles }\n    }\n\n    pub async fn submit(&amp;self, task: Task) -&gt; Result&lt;(), String&gt; {\n        self.sender\n            .send(task)\n            .await\n            .map_err(|e| e.to_string())\n    }\n}\n</code></pre>"},{"location":"rust/18-concurrency-system/#4","title":"4. \u30a2\u30c8\u30df\u30c3\u30af\u30ab\u30a6\u30f3\u30bf\u30fc","text":"<pre><code>use std::sync::atomic::{AtomicI64, Ordering};\n\n/// \u30b9\u30ec\u30c3\u30c9\u30bb\u30fc\u30d5\u306a\u30ab\u30a6\u30f3\u30bf\u30fc\npub struct AtomicCounter {\n    value: AtomicI64,\n}\n\nimpl AtomicCounter {\n    pub fn new(initial: i64) -&gt; AtomicCounter {\n        AtomicCounter {\n            value: AtomicI64::new(initial),\n        }\n    }\n\n    pub fn increment(&amp;self) -&gt; i64 {\n        self.value.fetch_add(1, Ordering::SeqCst) + 1\n    }\n\n    pub fn decrement(&amp;self) -&gt; i64 {\n        self.value.fetch_sub(1, Ordering::SeqCst) - 1\n    }\n\n    pub fn get(&amp;self) -&gt; i64 {\n        self.value.load(Ordering::SeqCst)\n    }\n\n    pub fn add(&amp;self, delta: i64) -&gt; i64 {\n        self.value.fetch_add(delta, Ordering::SeqCst) + delta\n    }\n}\n</code></pre>"},{"location":"rust/18-concurrency-system/#5","title":"5. \u30a2\u30af\u30b7\u30e7\u30f3\u51e6\u7406\u30b7\u30b9\u30c6\u30e0","text":"<pre><code>/// \u30a2\u30af\u30b7\u30e7\u30f3\u306e\u7a2e\u985e\n#[derive(Debug, Clone)]\npub enum Action {\n    Start,\n    Stop,\n    Process { data: String },\n    Shutdown,\n}\n\n/// \u30a2\u30af\u30b7\u30e7\u30f3\u30cf\u30f3\u30c9\u30e9\u30fc\npub trait ActionHandler: Send + Sync {\n    fn handle(&amp;self, action: &amp;Action) -&gt; Result&lt;String, String&gt;;\n}\n\n/// \u30ed\u30ae\u30f3\u30b0\u30cf\u30f3\u30c9\u30e9\u30fc\npub struct LoggingHandler {\n    logs: Arc&lt;Mutex&lt;Vec&lt;String&gt;&gt;&gt;,\n}\n\nimpl ActionHandler for LoggingHandler {\n    fn handle(&amp;self, action: &amp;Action) -&gt; Result&lt;String, String&gt; {\n        let log = format!(\"Handled action: {:?}\", action);\n        self.logs.lock().unwrap().push(log.clone());\n        Ok(log)\n    }\n}\n\n/// \u30a2\u30af\u30b7\u30e7\u30f3\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u30e3\u30fc\npub struct ActionDispatcher {\n    handlers: Vec&lt;Arc&lt;dyn ActionHandler&gt;&gt;,\n}\n\nimpl ActionDispatcher {\n    pub fn new() -&gt; ActionDispatcher {\n        ActionDispatcher {\n            handlers: Vec::new(),\n        }\n    }\n\n    pub fn register(&amp;mut self, handler: Arc&lt;dyn ActionHandler&gt;) {\n        self.handlers.push(handler);\n    }\n\n    pub fn dispatch(&amp;self, action: &amp;Action) -&gt; Vec&lt;Result&lt;String, String&gt;&gt; {\n        self.handlers\n            .iter()\n            .map(|h| h.handle(action))\n            .collect()\n    }\n}\n</code></pre>"},{"location":"rust/18-concurrency-system/#6","title":"6. \u30d1\u30bf\u30fc\u30f3\u306e\u9069\u7528","text":"<ol> <li>\u72b6\u614b\u6a5f\u68b0: ADT \u306b\u3088\u308b\u72b6\u614b\u3068\u30a4\u30d9\u30f3\u30c8\u306e\u8868\u73fe</li> <li>\u30a4\u30d9\u30f3\u30c8\u30d0\u30b9: Observer \u30d1\u30bf\u30fc\u30f3\u306e\u4e26\u884c\u7248</li> <li>\u30bf\u30b9\u30af\u30ad\u30e5\u30fc: Command \u30d1\u30bf\u30fc\u30f3\u306e\u975e\u540c\u671f\u7248</li> <li>Arc/Mutex: \u30b9\u30ec\u30c3\u30c9\u30bb\u30fc\u30d5\u306a\u5171\u6709\u72b6\u614b</li> </ol>"},{"location":"rust/18-concurrency-system/#7-rust","title":"7. Rust \u3067\u306e\u7279\u5fb4","text":""},{"location":"rust/18-concurrency-system/#_2","title":"\u6240\u6709\u6a29\u306b\u3088\u308b\u5b89\u5168\u6027","text":"<pre><code>// Arc \u3067\u6240\u6709\u6a29\u3092\u5171\u6709\u3001Mutex \u3067\u6392\u4ed6\u5236\u5fa1\nlet handlers: Arc&lt;Mutex&lt;HashMap&lt;String, Vec&lt;EventHandler&gt;&gt;&gt;&gt; = \n    Arc::new(Mutex::new(HashMap::new()));\n</code></pre>"},{"location":"rust/18-concurrency-system/#sendsync","title":"Send/Sync \u30c8\u30ec\u30a4\u30c8","text":"<pre><code>// Send: \u4ed6\u306e\u30b9\u30ec\u30c3\u30c9\u306b\u9001\u4fe1\u53ef\u80fd\n// Sync: \u8907\u6570\u30b9\u30ec\u30c3\u30c9\u304b\u3089\u53c2\u7167\u53ef\u80fd\npub trait ActionHandler: Send + Sync {\n    fn handle(&amp;self, action: &amp;Action) -&gt; Result&lt;String, String&gt;;\n}\n</code></pre>"},{"location":"rust/18-concurrency-system/#_3","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0\u3092\u901a\u3058\u3066\uff1a</p> <ol> <li>\u72b6\u614b\u6a5f\u68b0\u306b\u3088\u308b\u4e26\u884c\u72b6\u614b\u7ba1\u7406</li> <li>\u30a4\u30d9\u30f3\u30c8\u30d0\u30b9\u306b\u3088\u308b\u975e\u540c\u671f\u30e1\u30c3\u30bb\u30fc\u30b8\u30f3\u30b0</li> <li>\u30bf\u30b9\u30af\u30ad\u30e5\u30fc\u306b\u3088\u308b\u4e26\u884c\u51e6\u7406</li> <li>Arc/Mutex \u306b\u3088\u308b\u5b89\u5168\u306a\u5171\u6709\u72b6\u614b</li> </ol> <p>\u3092\u5b66\u3073\u307e\u3057\u305f\u3002Rust \u306e\u6240\u6709\u6a29\u30b7\u30b9\u30c6\u30e0\u306b\u3088\u308a\u3001\u30c7\u30fc\u30bf\u7af6\u5408\u3092\u9632\u304e\u306a\u304c\u3089\u4e26\u884c\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u304c\u53ef\u80fd\u3067\u3059\u3002</p>"},{"location":"rust/18-concurrency-system/#_4","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/rust/part6/src/chapter18.rs</code></li> </ul>"},{"location":"rust/18-concurrency-system/#_5","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Wa-Tor \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u901a\u3058\u3066\u3001\u30bb\u30eb\u30e9\u30fc\u30aa\u30fc\u30c8\u30de\u30c8\u30f3\u3092\u95a2\u6570\u578b\u3067\u5b9f\u88c5\u3057\u307e\u3059\u3002</p>"},{"location":"rust/19-wator-simulation/","title":"\u7b2c19\u7ae0: Wa-Tor \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3","text":""},{"location":"rust/19-wator-simulation/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Wa-Tor\uff08Water Torus\uff09\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\u3053\u308c\u306f\u9b5a\u3068\u30b5\u30e1\u306e\u6355\u98df-\u88ab\u98df\u95a2\u4fc2\u3092\u30b7\u30df\u30e5\u30ec\u30fc\u30c8\u3059\u308b\u30bb\u30eb\u30e9\u30fc\u30aa\u30fc\u30c8\u30de\u30c8\u30f3\u3067\u3059\u3002\u95a2\u6570\u578b\u306e\u30a2\u30d7\u30ed\u30fc\u30c1\u3067\u3001\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u3068\u7d14\u7c8b\u95a2\u6570\u3092\u4f7f\u3063\u3066\u5b9f\u88c5\u3057\u307e\u3059\u3002</p>"},{"location":"rust/19-wator-simulation/#1","title":"1. \u30c7\u30fc\u30bf\u69cb\u9020","text":"<pre><code>/// \u5ea7\u6a19\n#[derive(Debug, Clone, Copy, PartialEq, Eq, Hash)]\npub struct Position {\n    pub x: i32,\n    pub y: i32,\n}\n\nimpl Position {\n    pub fn new(x: i32, y: i32) -&gt; Position {\n        Position { x, y }\n    }\n\n    pub fn wrap(&amp;self, width: i32, height: i32) -&gt; Position {\n        Position {\n            x: ((self.x % width) + width) % width,\n            y: ((self.y % height) + height) % height,\n        }\n    }\n}\n\n/// \u751f\u7269\u306e\u7a2e\u985e\n#[derive(Debug, Clone, PartialEq)]\npub enum CreatureType {\n    Fish,\n    Shark,\n}\n\n/// \u751f\u7269\n#[derive(Debug, Clone)]\npub struct Creature {\n    pub creature_type: CreatureType,\n    pub position: Position,\n    pub energy: i32,           // \u30b5\u30e1\u306e\u30a8\u30cd\u30eb\u30ae\u30fc\n    pub breed_time: i32,       // \u7e41\u6b96\u307e\u3067\u306e\u6642\u9593\n}\n\nimpl Creature {\n    pub fn fish(position: Position, breed_time: i32) -&gt; Creature {\n        Creature {\n            creature_type: CreatureType::Fish,\n            position,\n            energy: 0,\n            breed_time,\n        }\n    }\n\n    pub fn shark(position: Position, energy: i32, breed_time: i32) -&gt; Creature {\n        Creature {\n            creature_type: CreatureType::Shark,\n            position,\n            energy,\n            breed_time,\n        }\n    }\n}\n\n/// \u30ef\u30fc\u30eb\u30c9\n#[derive(Debug, Clone)]\npub struct World {\n    pub width: i32,\n    pub height: i32,\n    pub creatures: Vec&lt;Creature&gt;,\n    pub fish_breed_time: i32,\n    pub shark_breed_time: i32,\n    pub shark_energy_gain: i32,\n    pub shark_initial_energy: i32,\n}\n</code></pre>"},{"location":"rust/19-wator-simulation/#2","title":"2. \u79fb\u52d5\u30ed\u30b8\u30c3\u30af","text":"<pre><code>impl World {\n    /// \u96a3\u63a5\u30bb\u30eb\u3092\u53d6\u5f97\n    pub fn neighbors(&amp;self, pos: Position) -&gt; Vec&lt;Position&gt; {\n        let directions = vec![\n            Position::new(0, -1),  // \u4e0a\n            Position::new(0, 1),   // \u4e0b\n            Position::new(-1, 0),  // \u5de6\n            Position::new(1, 0),   // \u53f3\n        ];\n\n        directions\n            .into_iter()\n            .map(|d| Position::new(pos.x + d.x, pos.y + d.y).wrap(self.width, self.height))\n            .collect()\n    }\n\n    /// \u7a7a\u306e\u30bb\u30eb\u3092\u63a2\u3059\n    pub fn find_empty_neighbors(&amp;self, pos: Position) -&gt; Vec&lt;Position&gt; {\n        self.neighbors(pos)\n            .into_iter()\n            .filter(|p| !self.creatures.iter().any(|c| c.position == *p))\n            .collect()\n    }\n\n    /// \u9b5a\u304c\u3044\u308b\u30bb\u30eb\u3092\u63a2\u3059\n    pub fn find_fish_neighbors(&amp;self, pos: Position) -&gt; Vec&lt;Position&gt; {\n        self.neighbors(pos)\n            .into_iter()\n            .filter(|p| {\n                self.creatures\n                    .iter()\n                    .any(|c| c.position == *p &amp;&amp; c.creature_type == CreatureType::Fish)\n            })\n            .collect()\n    }\n}\n</code></pre>"},{"location":"rust/19-wator-simulation/#3","title":"3. \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u30b9\u30c6\u30c3\u30d7","text":"<pre><code>impl World {\n    /// \u9b5a\u3092\u79fb\u52d5\n    fn move_fish(&amp;self, fish: &amp;Creature, rng: &amp;mut impl Rng) -&gt; (Option&lt;Creature&gt;, Option&lt;Creature&gt;) {\n        let empty = self.find_empty_neighbors(fish.position);\n\n        if empty.is_empty() {\n            // \u79fb\u52d5\u3067\u304d\u306a\u3044\n            let new_fish = Creature {\n                breed_time: fish.breed_time - 1,\n                ..fish.clone()\n            };\n            (Some(new_fish), None)\n        } else {\n            // \u30e9\u30f3\u30c0\u30e0\u306b\u79fb\u52d5\n            let new_pos = empty[rng.gen_range(0..empty.len())];\n\n            if fish.breed_time &lt;= 1 {\n                // \u7e41\u6b96\n                let parent = Creature::fish(new_pos, self.fish_breed_time);\n                let child = Creature::fish(fish.position, self.fish_breed_time);\n                (Some(parent), Some(child))\n            } else {\n                let new_fish = Creature {\n                    position: new_pos,\n                    breed_time: fish.breed_time - 1,\n                    ..fish.clone()\n                };\n                (Some(new_fish), None)\n            }\n        }\n    }\n\n    /// \u30b5\u30e1\u3092\u79fb\u52d5\n    fn move_shark(&amp;self, shark: &amp;Creature, rng: &amp;mut impl Rng) -&gt; (Option&lt;Creature&gt;, Option&lt;Creature&gt;, Option&lt;Position&gt;) {\n        let fish_neighbors = self.find_fish_neighbors(shark.position);\n        let empty_neighbors = self.find_empty_neighbors(shark.position);\n\n        // \u30a8\u30cd\u30eb\u30ae\u30fc\u304c\u306a\u304f\u306a\u3063\u305f\u3089\u6b7b\u4ea1\n        if shark.energy &lt;= 0 {\n            return (None, None, None);\n        }\n\n        if !fish_neighbors.is_empty() {\n            // \u9b5a\u3092\u98df\u3079\u308b\n            let target = fish_neighbors[rng.gen_range(0..fish_neighbors.len())];\n            let new_energy = shark.energy + self.shark_energy_gain;\n\n            if shark.breed_time &lt;= 1 {\n                // \u7e41\u6b96\n                let parent = Creature::shark(target, new_energy - 1, self.shark_breed_time);\n                let child = Creature::shark(shark.position, self.shark_initial_energy, self.shark_breed_time);\n                (Some(parent), Some(child), Some(target))\n            } else {\n                let new_shark = Creature {\n                    position: target,\n                    energy: new_energy - 1,\n                    breed_time: shark.breed_time - 1,\n                    ..shark.clone()\n                };\n                (Some(new_shark), None, Some(target))\n            }\n        } else if !empty_neighbors.is_empty() {\n            // \u7a7a\u306e\u30bb\u30eb\u306b\u79fb\u52d5\n            let new_pos = empty_neighbors[rng.gen_range(0..empty_neighbors.len())];\n\n            if shark.breed_time &lt;= 1 {\n                let parent = Creature::shark(new_pos, shark.energy - 1, self.shark_breed_time);\n                let child = Creature::shark(shark.position, self.shark_initial_energy, self.shark_breed_time);\n                (Some(parent), Some(child), None)\n            } else {\n                let new_shark = Creature {\n                    position: new_pos,\n                    energy: shark.energy - 1,\n                    breed_time: shark.breed_time - 1,\n                    ..shark.clone()\n                };\n                (Some(new_shark), None, None)\n            }\n        } else {\n            // \u79fb\u52d5\u3067\u304d\u306a\u3044\n            let new_shark = Creature {\n                energy: shark.energy - 1,\n                breed_time: shark.breed_time - 1,\n                ..shark.clone()\n            };\n            (Some(new_shark), None, None)\n        }\n    }\n\n    /// 1\u30b9\u30c6\u30c3\u30d7\u5b9f\u884c\n    pub fn step(&amp;self, rng: &amp;mut impl Rng) -&gt; World {\n        // \u5b9f\u88c5\u7701\u7565\uff08\u5168\u751f\u7269\u3092\u9806\u756a\u306b\u51e6\u7406\uff09\n        self.clone()\n    }\n}\n</code></pre>"},{"location":"rust/19-wator-simulation/#4","title":"4. \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u5b9f\u884c","text":"<pre><code>/// \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u7d50\u679c\n#[derive(Debug, Clone)]\npub struct SimulationStats {\n    pub step: usize,\n    pub fish_count: usize,\n    pub shark_count: usize,\n}\n\n/// \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u5b9f\u884c\npub fn run_simulation(\n    initial_world: World,\n    steps: usize,\n    mut rng: impl Rng,\n) -&gt; Vec&lt;SimulationStats&gt; {\n    let mut world = initial_world;\n    let mut stats = Vec::new();\n\n    for step in 0..steps {\n        let fish_count = world.creatures\n            .iter()\n            .filter(|c| c.creature_type == CreatureType::Fish)\n            .count();\n        let shark_count = world.creatures\n            .iter()\n            .filter(|c| c.creature_type == CreatureType::Shark)\n            .count();\n\n        stats.push(SimulationStats {\n            step,\n            fish_count,\n            shark_count,\n        });\n\n        world = world.step(&amp;mut rng);\n    }\n\n    stats\n}\n</code></pre>"},{"location":"rust/19-wator-simulation/#5","title":"5. \u53ef\u8996\u5316","text":"<pre><code>impl World {\n    /// ASCII \u30a2\u30fc\u30c8\u3067\u8868\u793a\n    pub fn to_ascii(&amp;self) -&gt; String {\n        let mut grid = vec![vec!['.'; self.width as usize]; self.height as usize];\n\n        for creature in &amp;self.creatures {\n            let ch = match creature.creature_type {\n                CreatureType::Fish =&gt; 'f',\n                CreatureType::Shark =&gt; 'S',\n            };\n            grid[creature.position.y as usize][creature.position.x as usize] = ch;\n        }\n\n        grid.into_iter()\n            .map(|row| row.into_iter().collect::&lt;String&gt;())\n            .collect::&lt;Vec&lt;_&gt;&gt;()\n            .join(\"\\n\")\n    }\n}\n</code></pre>"},{"location":"rust/19-wator-simulation/#6","title":"6. \u30d1\u30bf\u30fc\u30f3\u306e\u9069\u7528","text":"<ol> <li>\u4e0d\u5909\u30c7\u30fc\u30bf: World, Creature \u306f\u4e0d\u5909</li> <li>\u7d14\u7c8b\u95a2\u6570: step() \u306f\u65b0\u3057\u3044 World \u3092\u8fd4\u3059</li> <li>ADT: CreatureType \u306b\u3088\u308b\u751f\u7269\u7a2e\u5225</li> <li>\u30a4\u30c6\u30ec\u30fc\u30bf: \u52b9\u7387\u7684\u306a\u96c6\u8a08\u51e6\u7406</li> </ol>"},{"location":"rust/19-wator-simulation/#_2","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Wa-Tor \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u901a\u3058\u3066\uff1a</p> <ol> <li>\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u306b\u3088\u308b\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u72b6\u614b\u7ba1\u7406</li> <li>\u7d14\u7c8b\u95a2\u6570\u306b\u3088\u308b\u72b6\u614b\u9077\u79fb</li> <li>ADT \u306b\u3088\u308b\u751f\u7269\u7a2e\u5225\u306e\u8868\u73fe</li> <li>\u30a4\u30c6\u30ec\u30fc\u30bf\u306b\u3088\u308b\u52b9\u7387\u7684\u306a\u30c7\u30fc\u30bf\u51e6\u7406</li> </ol> <p>\u3092\u5b66\u3073\u307e\u3057\u305f\u3002\u95a2\u6570\u578b\u306e\u30a2\u30d7\u30ed\u30fc\u30c1\u306b\u3088\u308a\u3001\u518d\u73fe\u6027\u304c\u3042\u308a\u3001\u30c6\u30b9\u30c8\u3057\u3084\u3059\u3044\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u304c\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"rust/19-wator-simulation/#_3","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/rust/part6/src/chapter19.rs</code></li> </ul>"},{"location":"rust/19-wator-simulation/#_4","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001\u30d1\u30bf\u30fc\u30f3\u9593\u306e\u76f8\u4e92\u4f5c\u7528\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u8907\u6570\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u7d44\u307f\u5408\u308f\u305b\u305f\u8a2d\u8a08\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"rust/20-pattern-interactions/","title":"\u7b2c20\u7ae0: \u30d1\u30bf\u30fc\u30f3\u9593\u306e\u76f8\u4e92\u4f5c\u7528","text":""},{"location":"rust/20-pattern-interactions/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u3053\u308c\u307e\u3067\u5b66\u3093\u3060\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u3001\u3088\u308a\u8907\u96d1\u306a\u30b7\u30b9\u30c6\u30e0\u3092\u69cb\u7bc9\u3059\u308b\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002\u30d1\u30bf\u30fc\u30f3\u306e\u7d44\u307f\u5408\u308f\u305b\u306b\u3088\u308a\u3001\u67d4\u8edf\u3067\u62e1\u5f35\u6027\u306e\u9ad8\u3044\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p>"},{"location":"rust/20-pattern-interactions/#1-composite-decorator","title":"1. Composite + Decorator","text":"<p>\u56f3\u5f62\u306b\u88c5\u98fe\u3092\u8ffd\u52a0\u3057\u306a\u304c\u3089\u3001\u968e\u5c64\u69cb\u9020\u3092\u7dad\u6301\u3057\u307e\u3059\u3002</p> <pre><code>/// \u56f3\u5f62\u30c8\u30ec\u30a4\u30c8\npub trait Shape: CloneShape {\n    fn draw(&amp;self) -&gt; String;\n    fn area(&amp;self) -&gt; f64;\n    fn translate(&amp;self, dx: f64, dy: f64) -&gt; Box&lt;dyn Shape&gt;;\n    fn scale(&amp;self, factor: f64) -&gt; Box&lt;dyn Shape&gt;;\n}\n\n/// \u5186\n#[derive(Clone)]\npub struct Circle {\n    pub x: f64,\n    pub y: f64,\n    pub radius: f64,\n}\n\nimpl Shape for Circle {\n    fn draw(&amp;self) -&gt; String {\n        format!(\"Circle at ({}, {}) with radius {}\", self.x, self.y, self.radius)\n    }\n\n    fn area(&amp;self) -&gt; f64 {\n        std::f64::consts::PI * self.radius * self.radius\n    }\n    // ...\n}\n\n/// \u8272\u4ed8\u304d\u30c7\u30b3\u30ec\u30fc\u30bf\npub struct ColoredShape {\n    pub shape: Box&lt;dyn Shape&gt;,\n    pub color: String,\n}\n\nimpl Shape for ColoredShape {\n    fn draw(&amp;self) -&gt; String {\n        format!(\"[Color: {}] {}\", self.color, self.shape.draw())\n    }\n\n    fn area(&amp;self) -&gt; f64 {\n        self.shape.area()\n    }\n    // ...\n}\n\n/// \u5883\u754c\u7dda\u30c7\u30b3\u30ec\u30fc\u30bf\npub struct BorderedShape {\n    pub shape: Box&lt;dyn Shape&gt;,\n    pub border_width: f64,\n}\n\nimpl Shape for BorderedShape {\n    fn draw(&amp;self) -&gt; String {\n        format!(\"[Border: {}px] {}\", self.border_width, self.shape.draw())\n    }\n    // ...\n}\n\n/// \u8907\u5408\u56f3\u5f62\uff08Composite\uff09\npub struct CompositeShape {\n    pub shapes: Vec&lt;Box&lt;dyn Shape&gt;&gt;,\n}\n\nimpl Shape for CompositeShape {\n    fn draw(&amp;self) -&gt; String {\n        let drawings: Vec&lt;String&gt; = self.shapes.iter().map(|s| s.draw()).collect();\n        format!(\"Composite [{}]\", drawings.join(\", \"))\n    }\n\n    fn area(&amp;self) -&gt; f64 {\n        self.shapes.iter().map(|s| s.area()).sum()\n    }\n    // ...\n}\n</code></pre>"},{"location":"rust/20-pattern-interactions/#_2","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// \u8272\u4ed8\u304d\u306e\u5186\nlet colored_circle = ColoredShape {\n    shape: Box::new(Circle { x: 0.0, y: 0.0, radius: 5.0 }),\n    color: \"red\".to_string(),\n};\n\n// \u5883\u754c\u7dda\u4ed8\u304d\u306e\u56db\u89d2\u5f62\nlet bordered_rect = BorderedShape {\n    shape: Box::new(Rectangle { x: 10.0, y: 10.0, width: 20.0, height: 15.0 }),\n    border_width: 2.0,\n};\n\n// \u8907\u5408\u56f3\u5f62\nlet composite = CompositeShape {\n    shapes: vec![\n        Box::new(colored_circle),\n        Box::new(bordered_rect),\n    ],\n};\n</code></pre>"},{"location":"rust/20-pattern-interactions/#2-command-observer","title":"2. Command + Observer","text":"<p>\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u884c\u3092\u76e3\u8996\u3057\u3001\u5c65\u6b74\u3092\u7ba1\u7406\u3057\u307e\u3059\u3002</p> <pre><code>/// \u30b3\u30de\u30f3\u30c9\u30c8\u30ec\u30a4\u30c8\npub trait Command: CloneCommand {\n    fn execute(&amp;self, canvas: &amp;Canvas) -&gt; Canvas;\n    fn undo(&amp;self, canvas: &amp;Canvas) -&gt; Canvas;\n}\n\n/// \u30ad\u30e3\u30f3\u30d0\u30b9\u30a4\u30d9\u30f3\u30c8\n#[derive(Debug, Clone)]\npub enum CanvasEvent {\n    CommandExecuted { command_name: String },\n    CommandUndone { command_name: String },\n    CommandRedone { command_name: String },\n}\n\n/// \u30aa\u30d6\u30b6\u30fc\u30d0\u30fc\u30c8\u30ec\u30a4\u30c8\npub trait CanvasObserver {\n    fn on_event(&amp;mut self, event: &amp;CanvasEvent);\n}\n\n/// Observable \u30ad\u30e3\u30f3\u30d0\u30b9\npub struct ObservableCanvas {\n    pub canvas: Canvas,\n    pub observers: Vec&lt;Box&lt;dyn CanvasObserver&gt;&gt;,\n    pub history: Vec&lt;Box&lt;dyn Command&gt;&gt;,\n    pub history_index: usize,\n}\n\nimpl ObservableCanvas {\n    pub fn execute(&amp;mut self, command: Box&lt;dyn Command&gt;) {\n        self.canvas = command.execute(&amp;self.canvas);\n\n        // \u5c65\u6b74\u3092\u66f4\u65b0\n        self.history.truncate(self.history_index);\n        self.history.push(command.clone_box());\n        self.history_index += 1;\n\n        // \u30aa\u30d6\u30b6\u30fc\u30d0\u30fc\u306b\u901a\u77e5\n        let event = CanvasEvent::CommandExecuted {\n            command_name: \"Command\".to_string(),\n        };\n        self.notify(&amp;event);\n    }\n\n    pub fn undo(&amp;mut self) -&gt; bool {\n        if self.history_index &gt; 0 {\n            self.history_index -= 1;\n            let command = &amp;self.history[self.history_index];\n            self.canvas = command.undo(&amp;self.canvas);\n\n            let event = CanvasEvent::CommandUndone {\n                command_name: \"Command\".to_string(),\n            };\n            self.notify(&amp;event);\n            true\n        } else {\n            false\n        }\n    }\n\n    fn notify(&amp;mut self, event: &amp;CanvasEvent) {\n        for observer in &amp;mut self.observers {\n            observer.on_event(event);\n        }\n    }\n}\n</code></pre>"},{"location":"rust/20-pattern-interactions/#3-strategy-factory","title":"3. Strategy + Factory","text":"<p>\u30d5\u30a1\u30af\u30c8\u30ea\u304c\u6226\u7565\u306b\u57fa\u3065\u3044\u3066\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u751f\u6210\u3057\u307e\u3059\u3002</p> <pre><code>/// \u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u6226\u7565\npub trait RenderStrategy {\n    fn render(&amp;self, shape: &amp;dyn Shape) -&gt; String;\n}\n\npub struct TextRenderer;\npub struct JsonRenderer;\npub struct SvgRenderer;\n\nimpl RenderStrategy for TextRenderer {\n    fn render(&amp;self, shape: &amp;dyn Shape) -&gt; String {\n        shape.draw()\n    }\n}\n\nimpl RenderStrategy for JsonRenderer {\n    fn render(&amp;self, shape: &amp;dyn Shape) -&gt; String {\n        format!(r#\"{{\"type\":\"shape\",\"area\":{}}}\"#, shape.area())\n    }\n}\n\n/// \u56f3\u5f62\u30d5\u30a1\u30af\u30c8\u30ea\u30c8\u30ec\u30a4\u30c8\npub trait ShapeFactory {\n    fn create_circle(&amp;self, x: f64, y: f64, radius: f64) -&gt; Box&lt;dyn Shape&gt;;\n    fn create_rectangle(&amp;self, x: f64, y: f64, width: f64, height: f64) -&gt; Box&lt;dyn Shape&gt;;\n}\n\n/// \u6a19\u6e96\u30d5\u30a1\u30af\u30c8\u30ea\npub struct SimpleShapeFactory;\n\nimpl ShapeFactory for SimpleShapeFactory {\n    fn create_circle(&amp;self, x: f64, y: f64, radius: f64) -&gt; Box&lt;dyn Shape&gt; {\n        Box::new(Circle { x, y, radius })\n    }\n    // ...\n}\n\n/// \u8272\u4ed8\u304d\u30d5\u30a1\u30af\u30c8\u30ea\npub struct ColoredShapeFactory {\n    pub color: String,\n}\n\nimpl ShapeFactory for ColoredShapeFactory {\n    fn create_circle(&amp;self, x: f64, y: f64, radius: f64) -&gt; Box&lt;dyn Shape&gt; {\n        Box::new(ColoredShape {\n            shape: Box::new(Circle { x, y, radius }),\n            color: self.color.clone(),\n        })\n    }\n    // ...\n}\n</code></pre>"},{"location":"rust/20-pattern-interactions/#4-dsl","title":"4. DSL \u306b\u3088\u308b\u5ba3\u8a00\u7684\u306a\u69cb\u7bc9","text":"<pre><code>/// \u56f3\u5f62\u30d3\u30eb\u30c0\u30fc DSL\npub mod dsl {\n    use super::*;\n\n    pub fn circle(x: f64, y: f64, radius: f64) -&gt; Box&lt;dyn Shape&gt; {\n        Box::new(Circle { x, y, radius })\n    }\n\n    pub fn rectangle(x: f64, y: f64, width: f64, height: f64) -&gt; Box&lt;dyn Shape&gt; {\n        Box::new(Rectangle { x, y, width, height })\n    }\n\n    pub fn colored(shape: Box&lt;dyn Shape&gt;, color: &amp;str) -&gt; Box&lt;dyn Shape&gt; {\n        Box::new(ColoredShape {\n            shape,\n            color: color.to_string(),\n        })\n    }\n\n    pub fn bordered(shape: Box&lt;dyn Shape&gt;, width: f64) -&gt; Box&lt;dyn Shape&gt; {\n        Box::new(BorderedShape {\n            shape,\n            border_width: width,\n        })\n    }\n\n    pub fn composite(shapes: Vec&lt;Box&lt;dyn Shape&gt;&gt;) -&gt; Box&lt;dyn Shape&gt; {\n        Box::new(CompositeShape { shapes })\n    }\n}\n\n// \u4f7f\u7528\u4f8b\nlet scene = composite(vec![\n    colored(circle(0.0, 0.0, 10.0), \"red\"),\n    bordered(rectangle(20.0, 20.0, 30.0, 20.0), 2.0),\n]);\n</code></pre>"},{"location":"rust/20-pattern-interactions/#5","title":"5. \u30d1\u30bf\u30fc\u30f3\u306e\u7d44\u307f\u5408\u308f\u305b\u306e\u5229\u70b9","text":"<ol> <li>\u67d4\u8edf\u6027: \u5404\u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9\u3092\u7d44\u307f\u5408\u308f\u305b</li> <li>\u62e1\u5f35\u6027: \u65b0\u3057\u3044\u6a5f\u80fd\u3092\u8ffd\u52a0\u3057\u3084\u3059\u3044</li> <li>\u30c6\u30b9\u30c8\u5bb9\u6613\u6027: \u5404\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u72ec\u7acb\u3057\u3066\u30c6\u30b9\u30c8</li> <li>\u5206\u96e2: \u95a2\u5fc3\u4e8b\u306e\u5206\u96e2\u304c\u660e\u78ba</li> </ol>"},{"location":"rust/20-pattern-interactions/#_3","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u30d1\u30bf\u30fc\u30f3\u9593\u306e\u76f8\u4e92\u4f5c\u7528\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>Composite + Decorator: \u968e\u5c64\u69cb\u9020\u3068\u88c5\u98fe\u306e\u7d44\u307f\u5408\u308f\u305b</li> <li>Command + Observer: \u64cd\u4f5c\u306e\u76e3\u8996\u3068\u5c65\u6b74\u7ba1\u7406</li> <li>Strategy + Factory: \u6226\u7565\u306b\u57fa\u3065\u304f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u751f\u6210</li> <li>DSL: \u5ba3\u8a00\u7684\u306a\u69cb\u7bc9</li> </ol>"},{"location":"rust/20-pattern-interactions/#_4","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/rust/part7/src/chapter20.rs</code></li> </ul>"},{"location":"rust/20-pattern-interactions/#_5","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u95a2\u6570\u578b\u30c7\u30b6\u30a4\u30f3\u306e\u5b9f\u8df5\u7684\u306a\u30ac\u30a4\u30c9\u30e9\u30a4\u30f3\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"rust/21-best-practices/","title":"\u7b2c21\u7ae0: \u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9","text":""},{"location":"rust/21-best-practices/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Rust \u306b\u304a\u3051\u308b\u95a2\u6570\u578b\u30c7\u30b6\u30a4\u30f3\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3092\u307e\u3068\u3081\u307e\u3059\u3002\u30c7\u30fc\u30bf\u4e2d\u5fc3\u8a2d\u8a08\u3001\u7d14\u7c8b\u95a2\u6570\u3001\u30c6\u30b9\u30c8\u53ef\u80fd\u306a\u8a2d\u8a08\u306a\u3069\u3001\u5b9f\u8df5\u7684\u306a\u30ac\u30a4\u30c9\u30e9\u30a4\u30f3\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002</p>"},{"location":"rust/21-best-practices/#1","title":"1. \u30c7\u30fc\u30bf\u4e2d\u5fc3\u8a2d\u8a08","text":""},{"location":"rust/21-best-practices/#_2","title":"\u30b7\u30f3\u30d7\u30eb\u306a\u30c7\u30fc\u30bf\u69cb\u9020","text":"<pre><code>use rust_decimal::Decimal;\n\n/// \u30e6\u30fc\u30b6\u30fc\uff08\u30b7\u30f3\u30d7\u30eb\u306a\u30c7\u30fc\u30bf\u69cb\u9020\uff09\n#[derive(Debug, Clone, PartialEq)]\npub struct User {\n    pub id: String,\n    pub name: String,\n    pub email: String,\n    pub created_at: i64,\n}\n\n/// \u6ce8\u6587\u30a2\u30a4\u30c6\u30e0\n#[derive(Debug, Clone, PartialEq)]\npub struct OrderItem {\n    pub product_id: String,\n    pub quantity: i32,\n    pub price: Decimal,\n}\n\n/// \u6ce8\u6587\n#[derive(Debug, Clone, PartialEq)]\npub struct Order {\n    pub id: String,\n    pub user_id: String,\n    pub items: Vec&lt;OrderItem&gt;,\n    pub status: OrderStatus,\n}\n\n#[derive(Debug, Clone, PartialEq, Default)]\npub enum OrderStatus {\n    #[default]\n    Pending,\n    Processing,\n    Completed,\n    Cancelled,\n}\n</code></pre>"},{"location":"rust/21-best-practices/#2","title":"2. \u5c0f\u3055\u306a\u7d14\u7c8b\u95a2\u6570","text":"<pre><code>pub mod order_calculations {\n    use super::*;\n\n    /// \u30a2\u30a4\u30c6\u30e0\u306e\u5408\u8a08\u3092\u8a08\u7b97\n    pub fn calculate_item_total(item: &amp;OrderItem) -&gt; Decimal {\n        item.price * Decimal::from(item.quantity)\n    }\n\n    /// \u6ce8\u6587\u306e\u5408\u8a08\u3092\u8a08\u7b97\n    pub fn calculate_order_total(order: &amp;Order) -&gt; Decimal {\n        order.items.iter().map(calculate_item_total).sum()\n    }\n\n    /// \u5272\u5f15\u3092\u9069\u7528\n    pub fn apply_discount(total: Decimal, discount_rate: Decimal) -&gt; Decimal {\n        total * (Decimal::ONE - discount_rate)\n    }\n\n    /// \u7a0e\u91d1\u3092\u9069\u7528\n    pub fn apply_tax(total: Decimal, tax_rate: Decimal) -&gt; Decimal {\n        total * (Decimal::ONE + tax_rate)\n    }\n}\n</code></pre>"},{"location":"rust/21-best-practices/#3","title":"3. \u30c7\u30fc\u30bf\u691c\u8a3c","text":"<pre><code>/// \u691c\u8a3c\u7d50\u679c\npub enum ValidationResult&lt;T&gt; {\n    Valid(T),\n    Invalid(Vec&lt;String&gt;),\n}\n\nimpl&lt;T&gt; ValidationResult&lt;T&gt; {\n    pub fn is_valid(&amp;self) -&gt; bool {\n        matches!(self, ValidationResult::Valid(_))\n    }\n\n    pub fn map&lt;U, F: FnOnce(T) -&gt; U&gt;(self, f: F) -&gt; ValidationResult&lt;U&gt; {\n        match self {\n            ValidationResult::Valid(v) =&gt; ValidationResult::Valid(f(v)),\n            ValidationResult::Invalid(errs) =&gt; ValidationResult::Invalid(errs),\n        }\n    }\n}\n\npub mod validation {\n    use super::*;\n    use regex::Regex;\n\n    pub fn valid_email(email: &amp;str) -&gt; bool {\n        let re = Regex::new(r\"^[^@]+@[^@]+\\.[^@]+$\").unwrap();\n        re.is_match(email)\n    }\n\n    pub fn validate_user(user: User) -&gt; ValidationResult&lt;User&gt; {\n        let mut errors = Vec::new();\n\n        if user.name.trim().is_empty() {\n            errors.push(\"Name is required\".to_string());\n        }\n        if !valid_email(&amp;user.email) {\n            errors.push(\"Invalid email format\".to_string());\n        }\n\n        if errors.is_empty() {\n            ValidationResult::Valid(user)\n        } else {\n            ValidationResult::Invalid(errors)\n        }\n    }\n}\n</code></pre>"},{"location":"rust/21-best-practices/#4","title":"4. \u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u306a\u66f4\u65b0","text":"<pre><code>pub mod immutable_updates {\n    use super::*;\n\n    pub fn update_user_email(user: User, new_email: &amp;str) -&gt; Result&lt;User, String&gt; {\n        if validation::valid_email(new_email) {\n            Ok(User {\n                email: new_email.to_string(),\n                ..user\n            })\n        } else {\n            Err(\"Invalid email format\".to_string())\n        }\n    }\n\n    pub fn cancel_order(order: Order) -&gt; Result&lt;Order, String&gt; {\n        if order.status == OrderStatus::Pending {\n            Ok(Order {\n                status: OrderStatus::Cancelled,\n                ..order\n            })\n        } else {\n            Err(\"Only pending orders can be cancelled\".to_string())\n        }\n    }\n}\n</code></pre>"},{"location":"rust/21-best-practices/#5","title":"5. \u9ad8\u968e\u95a2\u6570\u306b\u3088\u308b\u30c7\u30b3\u30ec\u30fc\u30b7\u30e7\u30f3","text":"<pre><code>pub mod function_decorators {\n    use std::collections::HashMap;\n    use std::sync::{Arc, Mutex};\n    use std::time::Instant;\n\n    /// \u30ed\u30ae\u30f3\u30b0\u30c7\u30b3\u30ec\u30fc\u30bf\n    pub fn with_logging&lt;A: Clone + std::fmt::Debug, B: std::fmt::Debug&gt;(\n        f: impl Fn(A) -&gt; B,\n        mut logger: impl FnMut(String),\n    ) -&gt; impl FnMut(A) -&gt; B {\n        move |a: A| {\n            logger(format!(\"Input: {:?}\", a));\n            let result = f(a);\n            logger(format!(\"Output: {:?}\", result));\n            result\n        }\n    }\n\n    /// \u30ad\u30e3\u30c3\u30b7\u30e5\u30c7\u30b3\u30ec\u30fc\u30bf\n    pub fn with_cache&lt;A: Clone + Eq + std::hash::Hash + 'static, B: Clone + 'static&gt;(\n        f: impl Fn(A) -&gt; B + 'static,\n    ) -&gt; impl FnMut(A) -&gt; B {\n        let cache: Arc&lt;Mutex&lt;HashMap&lt;A, B&gt;&gt;&gt; = Arc::new(Mutex::new(HashMap::new()));\n        move |a: A| {\n            let mut cache = cache.lock().unwrap();\n            if let Some(v) = cache.get(&amp;a) {\n                v.clone()\n            } else {\n                let result = f(a.clone());\n                cache.insert(a, result.clone());\n                result\n            }\n        }\n    }\n}\n</code></pre>"},{"location":"rust/21-best-practices/#6","title":"6. \u4f9d\u5b58\u6027\u6ce8\u5165","text":"<pre><code>/// \u30ea\u30dd\u30b8\u30c8\u30ea\u30c8\u30ec\u30a4\u30c8\npub trait Repository&lt;T: Clone, ID&gt; {\n    fn find_by_id(&amp;self, id: &amp;ID) -&gt; Option&lt;T&gt;;\n    fn find_all(&amp;self) -&gt; Vec&lt;T&gt;;\n    fn save(&amp;mut self, entity: T) -&gt; T;\n    fn delete(&amp;mut self, id: &amp;ID) -&gt; bool;\n}\n\n/// \u6642\u9593\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\npub trait Clock {\n    fn now(&amp;self) -&gt; i64;\n}\n\n/// ID\u751f\u6210\u5668\npub trait IdGenerator {\n    fn generate(&amp;mut self) -&gt; String;\n}\n\n/// \u30c6\u30b9\u30c8\u7528\u306e\u5b9f\u88c5\npub struct FixedClock {\n    time: i64,\n}\n\nimpl Clock for FixedClock {\n    fn now(&amp;self) -&gt; i64 {\n        self.time\n    }\n}\n\npub struct SequentialIdGenerator {\n    prefix: String,\n    counter: usize,\n}\n\nimpl IdGenerator for SequentialIdGenerator {\n    fn generate(&amp;mut self) -&gt; String {\n        self.counter += 1;\n        format!(\"{}-{}\", self.prefix, self.counter)\n    }\n}\n</code></pre>"},{"location":"rust/21-best-practices/#7","title":"7. \u30b5\u30fc\u30d3\u30b9\u5c64","text":"<pre><code>/// \u30e6\u30fc\u30b6\u30fc\u30b5\u30fc\u30d3\u30b9\npub struct UserService&lt;R, C, I&gt;\nwhere\n    R: Repository&lt;User, String&gt;,\n    C: Clock,\n    I: IdGenerator,\n{\n    repository: R,\n    clock: C,\n    id_generator: I,\n}\n\nimpl&lt;R, C, I&gt; UserService&lt;R, C, I&gt;\nwhere\n    R: Repository&lt;User, String&gt;,\n    C: Clock,\n    I: IdGenerator,\n{\n    pub fn new(repository: R, clock: C, id_generator: I) -&gt; Self {\n        Self { repository, clock, id_generator }\n    }\n\n    pub fn create_user(&amp;mut self, name: &amp;str, email: &amp;str) -&gt; Result&lt;User, Vec&lt;String&gt;&gt; {\n        let user = User {\n            id: self.id_generator.generate(),\n            name: name.to_string(),\n            email: email.to_string(),\n            created_at: self.clock.now(),\n        };\n\n        match validation::validate_user(user) {\n            ValidationResult::Valid(u) =&gt; Ok(self.repository.save(u)),\n            ValidationResult::Invalid(errors) =&gt; Err(errors),\n        }\n    }\n}\n</code></pre>"},{"location":"rust/21-best-practices/#8","title":"8. \u7d50\u679c\u578b","text":"<pre><code>/// \u30ab\u30b9\u30bf\u30e0 Result \u578b\n#[derive(Debug, Clone)]\npub enum Result2&lt;E, A&gt; {\n    Success(A),\n    Failure(E),\n}\n\nimpl&lt;E, A&gt; Result2&lt;E, A&gt; {\n    pub fn map&lt;B, F: FnOnce(A) -&gt; B&gt;(self, f: F) -&gt; Result2&lt;E, B&gt; {\n        match self {\n            Result2::Success(a) =&gt; Result2::Success(f(a)),\n            Result2::Failure(e) =&gt; Result2::Failure(e),\n        }\n    }\n\n    pub fn flat_map&lt;B, F: FnOnce(A) -&gt; Result2&lt;E, B&gt;&gt;(self, f: F) -&gt; Result2&lt;E, B&gt; {\n        match self {\n            Result2::Success(a) =&gt; f(a),\n            Result2::Failure(e) =&gt; Result2::Failure(e),\n        }\n    }\n}\n</code></pre>"},{"location":"rust/21-best-practices/#9","title":"9. \u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u307e\u3068\u3081","text":"<ol> <li>\u30c7\u30fc\u30bf\u4e2d\u5fc3: \u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u3092\u30c7\u30fc\u30bf\u69cb\u9020\u3067\u8868\u73fe</li> <li>\u7d14\u7c8b\u95a2\u6570: \u526f\u4f5c\u7528\u3092\u5206\u96e2\u3057\u3001\u30c6\u30b9\u30c8\u5bb9\u6613\u6027\u3092\u5411\u4e0a</li> <li>\u4e0d\u5909\u30c7\u30fc\u30bf: \u72b6\u614b\u5909\u66f4\u306f\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u3092\u4f5c\u6210</li> <li>\u578b\u3067\u8868\u73fe: enum \u3067\u72b6\u614b\u3001\u30c8\u30ec\u30a4\u30c8\u3067\u632f\u308b\u821e\u3044\u3092\u8868\u73fe</li> <li>\u4f9d\u5b58\u6027\u6ce8\u5165: \u30c6\u30b9\u30c8\u53ef\u80fd\u306a\u8a2d\u8a08</li> <li>\u5c0f\u3055\u306a\u95a2\u6570: \u5358\u4e00\u8cac\u4efb\u3001\u5408\u6210\u53ef\u80fd</li> </ol>"},{"location":"rust/21-best-practices/#_3","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Rust \u306b\u304a\u3051\u308b\u95a2\u6570\u578b\u30c7\u30b6\u30a4\u30f3\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3092\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30c7\u30fc\u30bf\u4e2d\u5fc3\u8a2d\u8a08</li> <li>\u7d14\u7c8b\u95a2\u6570\u306b\u3088\u308b\u8a08\u7b97</li> <li>\u691c\u8a3c\u3068\u4e0d\u5909\u66f4\u65b0</li> <li>\u9ad8\u968e\u95a2\u6570\u306b\u3088\u308b\u30c7\u30b3\u30ec\u30fc\u30b7\u30e7\u30f3</li> <li>\u4f9d\u5b58\u6027\u6ce8\u5165\u306b\u3088\u308b\u30c6\u30b9\u30c8\u53ef\u80fd\u6027</li> </ol>"},{"location":"rust/21-best-practices/#_4","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/rust/part7/src/chapter21.rs</code></li> </ul>"},{"location":"rust/21-best-practices/#_5","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001OO \u304b\u3089 FP \u3078\u306e\u79fb\u884c\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u65e2\u5b58\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u30b3\u30fc\u30c9\u3092\u95a2\u6570\u578b\u306b\u79fb\u884c\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"rust/22-oo-to-fp-migration/","title":"\u7b2c22\u7ae0: OO \u304b\u3089 FP \u3078\u306e\u79fb\u884c","text":""},{"location":"rust/22-oo-to-fp-migration/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\uff08OO\uff09\u30b9\u30bf\u30a4\u30eb\u306e\u30b3\u30fc\u30c9\u3092\u95a2\u6570\u578b\uff08FP\uff09\u30b9\u30bf\u30a4\u30eb\u306b\u79fb\u884c\u3059\u308b\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002Rust \u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u4e0d\u5909\u306a\u305f\u3081\u3001FP \u30b9\u30bf\u30a4\u30eb\u306b\u81ea\u7136\u306b\u9069\u5408\u3057\u307e\u3059\u304c\u3001OO \u304b\u3089\u6765\u305f\u958b\u767a\u8005\u306e\u305f\u3081\u306b\u79fb\u884c\u306e\u30ac\u30a4\u30c9\u30e9\u30a4\u30f3\u3092\u793a\u3057\u307e\u3059\u3002</p>"},{"location":"rust/22-oo-to-fp-migration/#1-oo-vs-fp","title":"1. OO \u30b9\u30bf\u30a4\u30eb vs FP \u30b9\u30bf\u30a4\u30eb","text":""},{"location":"rust/22-oo-to-fp-migration/#oo","title":"OO \u30b9\u30bf\u30a4\u30eb\uff08\u53ef\u5909\uff09","text":"<pre><code>/// OO \u30b9\u30bf\u30a4\u30eb: \u5185\u90e8\u72b6\u614b\u3092\u6301\u3064\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\npub mod oo_style {\n    pub struct Account {\n        id: String,\n        balance: f64,\n        transactions: Vec&lt;Transaction&gt;,\n    }\n\n    pub struct Transaction {\n        pub transaction_type: TransactionType,\n        pub amount: f64,\n    }\n\n    pub enum TransactionType {\n        Deposit,\n        Withdrawal,\n    }\n\n    impl Account {\n        pub fn new(id: &amp;str, initial_balance: f64) -&gt; Account {\n            Account {\n                id: id.to_string(),\n                balance: initial_balance,\n                transactions: Vec::new(),\n            }\n        }\n\n        // \u53ef\u5909\u30e1\u30bd\u30c3\u30c9 - \u5185\u90e8\u72b6\u614b\u3092\u5909\u66f4\n        pub fn deposit(&amp;mut self, amount: f64) -&gt; f64 {\n            if amount &gt; 0.0 {\n                self.balance += amount;\n                self.transactions.push(Transaction {\n                    transaction_type: TransactionType::Deposit,\n                    amount,\n                });\n            }\n            self.balance\n        }\n\n        pub fn withdraw(&amp;mut self, amount: f64) -&gt; f64 {\n            if amount &gt; 0.0 &amp;&amp; self.balance &gt;= amount {\n                self.balance -= amount;\n                self.transactions.push(Transaction {\n                    transaction_type: TransactionType::Withdrawal,\n                    amount,\n                });\n            }\n            self.balance\n        }\n    }\n}\n</code></pre>"},{"location":"rust/22-oo-to-fp-migration/#fp","title":"FP \u30b9\u30bf\u30a4\u30eb\uff08\u4e0d\u5909\uff09","text":"<pre><code>/// FP \u30b9\u30bf\u30a4\u30eb: \u4e0d\u5909\u30c7\u30fc\u30bf\u3068\u7d14\u7c8b\u95a2\u6570\npub mod fp_style {\n    #[derive(Debug, Clone)]\n    pub struct Account {\n        pub id: String,\n        pub balance: f64,\n        pub transactions: Vec&lt;Transaction&gt;,\n    }\n\n    #[derive(Debug, Clone)]\n    pub struct Transaction {\n        pub transaction_type: TransactionType,\n        pub amount: f64,\n    }\n\n    #[derive(Debug, Clone)]\n    pub enum TransactionType {\n        Deposit,\n        Withdrawal,\n    }\n\n    /// \u53e3\u5ea7\u3092\u4f5c\u6210\uff08\u7d14\u7c8b\u95a2\u6570\uff09\n    pub fn make_account(id: &amp;str, initial_balance: f64) -&gt; Account {\n        Account {\n            id: id.to_string(),\n            balance: initial_balance,\n            transactions: Vec::new(),\n        }\n    }\n\n    /// \u5165\u91d1\uff08\u65b0\u3057\u3044\u53e3\u5ea7\u3092\u8fd4\u3059 - \u5143\u306f\u4e0d\u5909\uff09\n    pub fn deposit(account: Account, amount: f64) -&gt; Account {\n        if amount &gt; 0.0 {\n            Account {\n                balance: account.balance + amount,\n                transactions: {\n                    let mut txns = account.transactions;\n                    txns.push(Transaction {\n                        transaction_type: TransactionType::Deposit,\n                        amount,\n                    });\n                    txns\n                },\n                ..account\n            }\n        } else {\n            account\n        }\n    }\n\n    /// \u51fa\u91d1\uff08\u65b0\u3057\u3044\u53e3\u5ea7\u3092\u8fd4\u3059 - \u5143\u306f\u4e0d\u5909\uff09\n    pub fn withdraw(account: Account, amount: f64) -&gt; Account {\n        if amount &gt; 0.0 &amp;&amp; account.balance &gt;= amount {\n            Account {\n                balance: account.balance - amount,\n                transactions: {\n                    let mut txns = account.transactions;\n                    txns.push(Transaction {\n                        transaction_type: TransactionType::Withdrawal,\n                        amount,\n                    });\n                    txns\n                },\n                ..account\n            }\n        } else {\n            account\n        }\n    }\n}\n</code></pre>"},{"location":"rust/22-oo-to-fp-migration/#2","title":"2. \u79fb\u884c\u6226\u7565","text":""},{"location":"rust/22-oo-to-fp-migration/#strangler-fig","title":"Strangler Fig \u30d1\u30bf\u30fc\u30f3","text":"<p>\u65e2\u5b58\u306e\u30b3\u30fc\u30c9\u3092\u5f90\u3005\u306b\u65b0\u3057\u3044\u30b9\u30bf\u30a4\u30eb\u306b\u7f6e\u304d\u63db\u3048\u307e\u3059\u3002</p> <pre><code>pub mod migration {\n    use super::fp_style::*;\n\n    pub enum Style {\n        FP,\n        OO,\n    }\n\n    pub struct StranglerAccount {\n        pub style: Style,\n        pub data: Account,\n    }\n\n    /// \u30d5\u30a3\u30fc\u30c1\u30e3\u30fc\u30d5\u30e9\u30b0\u306b\u3088\u308b\u5207\u308a\u66ff\u3048\n    pub fn create_account(id: &amp;str, balance: f64, use_fp: bool) -&gt; StranglerAccount {\n        let style = if use_fp { Style::FP } else { Style::OO };\n        StranglerAccount {\n            style,\n            data: make_account(id, balance),\n        }\n    }\n\n    /// \u7d71\u4e00\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\n    pub fn account_deposit(account: StranglerAccount, amount: f64) -&gt; StranglerAccount {\n        StranglerAccount {\n            data: deposit(account.data, amount),\n            ..account\n        }\n    }\n}\n</code></pre>"},{"location":"rust/22-oo-to-fp-migration/#_2","title":"\u30a2\u30c0\u30d7\u30bf\u30fc\u30d1\u30bf\u30fc\u30f3","text":"<p>\u65e2\u5b58\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u7dad\u6301\u3057\u306a\u304c\u3089\u3001\u5185\u90e8\u3092FP\u306b\u79fb\u884c\u3057\u307e\u3059\u3002</p> <pre><code>pub mod adapter {\n    use super::fp_style::*;\n\n    /// \u65e2\u5b58\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u7dad\u6301\u3059\u308b\u30a2\u30c0\u30d7\u30bf\u30fc\n    pub struct FPAccountAdapter {\n        account: Account,\n    }\n\n    impl FPAccountAdapter {\n        pub fn new(id: &amp;str, initial_balance: f64) -&gt; FPAccountAdapter {\n            FPAccountAdapter {\n                account: make_account(id, initial_balance),\n            }\n        }\n\n        pub fn get_balance(&amp;self) -&gt; f64 {\n            self.account.balance\n        }\n\n        // \u65e2\u5b58\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u7dad\u6301\n        pub fn deposit_to_account(&amp;mut self, amount: f64) -&gt; f64 {\n            self.account = deposit(self.account.clone(), amount);\n            self.account.balance\n        }\n\n        pub fn withdraw_from_account(&amp;mut self, amount: f64) -&gt; f64 {\n            self.account = withdraw(self.account.clone(), amount);\n            self.account.balance\n        }\n    }\n}\n</code></pre>"},{"location":"rust/22-oo-to-fp-migration/#3","title":"3. \u591a\u614b\u6027\u306e\u5b9f\u73fe","text":""},{"location":"rust/22-oo-to-fp-migration/#oo_1","title":"OO: \u30c8\u30ec\u30a4\u30c8\u30aa\u30d6\u30b8\u30a7\u30af\u30c8","text":"<pre><code>pub trait Shape {\n    fn area(&amp;self) -&gt; f64;\n}\n\nstruct Circle { radius: f64 }\nstruct Rectangle { width: f64, height: f64 }\n\nimpl Shape for Circle {\n    fn area(&amp;self) -&gt; f64 { std::f64::consts::PI * self.radius * self.radius }\n}\n\nimpl Shape for Rectangle {\n    fn area(&amp;self) -&gt; f64 { self.width * self.height }\n}\n</code></pre>"},{"location":"rust/22-oo-to-fp-migration/#fp-enum","title":"FP: enum \u3068\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1","text":"<pre><code>pub enum Shape {\n    Circle { radius: f64 },\n    Rectangle { width: f64, height: f64 },\n    Triangle { base: f64, height: f64 },\n}\n\npub fn area(shape: &amp;Shape) -&gt; f64 {\n    match shape {\n        Shape::Circle { radius } =&gt; std::f64::consts::PI * radius * radius,\n        Shape::Rectangle { width, height } =&gt; width * height,\n        Shape::Triangle { base, height } =&gt; base * height / 2.0,\n    }\n}\n\npub fn scale(shape: &amp;Shape, factor: f64) -&gt; Shape {\n    match shape {\n        Shape::Circle { radius } =&gt; Shape::Circle { radius: radius * factor },\n        Shape::Rectangle { width, height } =&gt; Shape::Rectangle {\n            width: width * factor,\n            height: height * factor,\n        },\n        Shape::Triangle { base, height } =&gt; Shape::Triangle {\n            base: base * factor,\n            height: height * factor,\n        },\n    }\n}\n</code></pre>"},{"location":"rust/22-oo-to-fp-migration/#4","title":"4. \u6bb5\u968e\u7684\u306a\u95a2\u6570\u62bd\u51fa","text":"<pre><code>/// \u7d14\u7c8b\u95a2\u6570\u3092\u62bd\u51fa\npub fn calculate_interest(balance: f64, rate: f64, days: i32) -&gt; f64 {\n    balance * rate * (days as f64 / 365.0)\n}\n\n/// \u624b\u6570\u6599\u8a08\u7b97\uff08\u7d14\u7c8b\u95a2\u6570\uff09\npub struct FeeStructure {\n    pub minimum_balance: f64,\n    pub low_balance_fee: f64,\n    pub premium_threshold: f64,\n    pub standard_fee: f64,\n}\n\npub fn calculate_fee(balance: f64, fee_structure: &amp;FeeStructure) -&gt; f64 {\n    if balance &lt; fee_structure.minimum_balance {\n        fee_structure.low_balance_fee\n    } else if balance &gt; fee_structure.premium_threshold {\n        0.0\n    } else {\n        fee_structure.standard_fee\n    }\n}\n</code></pre>"},{"location":"rust/22-oo-to-fp-migration/#5-oo-vs-fp","title":"5. OO vs FP \u6bd4\u8f03\u8868","text":"\u5074\u9762 OO FP \u57fa\u672c\u5358\u4f4d \u30aa\u30d6\u30b8\u30a7\u30af\u30c8 \u30c7\u30fc\u30bf + \u95a2\u6570 \u72b6\u614b\u7ba1\u7406 \u53ef\u5909\uff08mutable\uff09 \u4e0d\u5909\uff08immutable\uff09 \u591a\u614b\u6027 \u7d99\u627f\u30fb\u30c8\u30ec\u30a4\u30c8 ADT\u30fb\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1 \u30b3\u30fc\u30c9\u518d\u5229\u7528 \u7d99\u627f \u95a2\u6570\u5408\u6210 \u526f\u4f5c\u7528 \u3069\u3053\u3067\u3082\u53ef\u80fd \u5883\u754c\u306b\u5206\u96e2 \u30c6\u30b9\u30c8 \u30e2\u30c3\u30af\u304c\u5fc5\u8981 \u5165\u529b\u2192\u51fa\u529b\u306e\u307f \u30c7\u30d0\u30c3\u30b0 \u72b6\u614b\u8ffd\u8de1\u304c\u56f0\u96e3 \u5024\u304c\u4e0d\u5909\u3067\u8ffd\u8de1\u5bb9\u6613 \u4e26\u884c\u51e6\u7406 \u30ed\u30c3\u30af\u304c\u5fc5\u8981 \u4e0d\u5909\u30c7\u30fc\u30bf\u3067\u5b89\u5168"},{"location":"rust/22-oo-to-fp-migration/#6","title":"6. \u79fb\u884c\u30c1\u30a7\u30c3\u30af\u30ea\u30b9\u30c8","text":""},{"location":"rust/22-oo-to-fp-migration/#_3","title":"\u6e96\u5099","text":"<ul> <li> \u73fe\u5728\u306e\u30b3\u30fc\u30c9\u306e\u72b6\u614b\u3092\u628a\u63e1</li> <li> \u30c6\u30b9\u30c8\u30ab\u30d0\u30ec\u30c3\u30b8\u3092\u78ba\u8a8d</li> <li> \u79fb\u884c\u306e\u512a\u5148\u9806\u4f4d\u3092\u6c7a\u5b9a</li> </ul>"},{"location":"rust/22-oo-to-fp-migration/#_4","title":"\u5b9f\u884c","text":"<ul> <li> \u7d14\u7c8b\u95a2\u6570\u3092\u62bd\u51fa</li> <li> \u526f\u4f5c\u7528\u3092\u5206\u96e2</li> <li> ADT \u306b\u79fb\u884c</li> <li> \u30c6\u30b9\u30c8\u3092\u8ffd\u52a0</li> </ul>"},{"location":"rust/22-oo-to-fp-migration/#_5","title":"\u5b8c\u4e86","text":"<ul> <li> \u53e4\u3044\u30b3\u30fc\u30c9\u3092\u524a\u9664</li> <li> \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u66f4\u65b0</li> <li> \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3092\u78ba\u8a8d</li> </ul>"},{"location":"rust/22-oo-to-fp-migration/#_6","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001OO \u304b\u3089 FP \u3078\u306e\u79fb\u884c\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>OO vs FP: \u53ef\u5909 vs \u4e0d\u5909\u306e\u9055\u3044</li> <li>Strangler Fig \u30d1\u30bf\u30fc\u30f3: \u6bb5\u968e\u7684\u306a\u79fb\u884c</li> <li>\u30a2\u30c0\u30d7\u30bf\u30fc\u30d1\u30bf\u30fc\u30f3: \u65e2\u5b58\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306e\u7dad\u6301</li> <li>ADT \u3078\u306e\u79fb\u884c: enum \u3068\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1</li> <li>\u7d14\u7c8b\u95a2\u6570\u306e\u62bd\u51fa: \u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u306e\u5206\u96e2</li> </ol> <p>Rust \u306f\u4e0d\u5909\u6027\u304c\u30c7\u30d5\u30a9\u30eb\u30c8\u306a\u306e\u3067\u3001FP \u30b9\u30bf\u30a4\u30eb\u3078\u306e\u79fb\u884c\u306f\u81ea\u7136\u306b\u884c\u3048\u307e\u3059\u3002</p>"},{"location":"rust/22-oo-to-fp-migration/#_7","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/rust/part7/src/chapter22.rs</code></li> </ul> <p>Simple made easy.</p>"},{"location":"scala/","title":"Scala \u3067\u5b66\u3076\u95a2\u6570\u578b\u30c7\u30b6\u30a4\u30f3","text":""},{"location":"scala/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u8a18\u4e8b\u30b7\u30ea\u30fc\u30ba\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u304a\u3051\u308b\u8a2d\u8a08\u539f\u5247\u3068\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u3092 Scala \u3092\u4f7f\u3063\u3066\u5b9f\u8df5\u7684\u306b\u5b66\u3076\u305f\u3081\u306e\u30ac\u30a4\u30c9\u3067\u3059\u3002Scala \u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u3068\u95a2\u6570\u578b\u306e\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u306a\u7279\u6027\u3092\u6d3b\u304b\u3057\u3001\u5f93\u6765\u306e\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u3092\u95a2\u6570\u578b\u30d1\u30e9\u30c0\u30a4\u30e0\u3067\u3069\u306e\u3088\u3046\u306b\u8868\u73fe\u3057\u3001\u6d3b\u7528\u3067\u304d\u308b\u304b\u3092\u63a2\u6c42\u3057\u307e\u3059\u3002</p>"},{"location":"scala/#_2","title":"\u8a18\u4e8b\u69cb\u6210","text":""},{"location":"scala/#1","title":"\u7b2c1\u90e8: \u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u57fa\u790e\u539f\u5247","text":"<ol> <li>\u4e0d\u5909\u6027\u3068\u30c7\u30fc\u30bf\u5909\u63db</li> <li>case class \u3068\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020</li> <li>\u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3</li> <li> <p>\u526f\u4f5c\u7528\u306e\u5206\u96e2</p> </li> <li> <p>\u95a2\u6570\u5408\u6210\u3068\u9ad8\u968e\u95a2\u6570</p> </li> <li>andThen \u3068 compose \u306b\u3088\u308b\u95a2\u6570\u5408\u6210</li> <li>\u30ab\u30ea\u30fc\u5316\u3068\u90e8\u5206\u9069\u7528</li> <li> <p>\u9ad8\u968e\u95a2\u6570\u306e\u6d3b\u7528</p> </li> <li> <p>\u591a\u614b\u6027\u306e\u5b9f\u73fe\u65b9\u6cd5</p> </li> <li>sealed trait \u3068\u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b</li> <li>\u30c8\u30ec\u30a4\u30c8\u3068\u30df\u30c3\u30af\u30b9\u30a4\u30f3</li> <li>\u578b\u30af\u30e9\u30b9\u306b\u3088\u308b\u65e2\u5b58\u578b\u306e\u62e1\u5f35</li> </ol>"},{"location":"scala/#2","title":"\u7b2c2\u90e8: \u4ed5\u69d8\u3068\u30c6\u30b9\u30c8","text":"<ol> <li>\u30c7\u30fc\u30bf\u691c\u8a3c</li> <li>\u578b\u306b\u3088\u308b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3</li> <li>Either \u306b\u3088\u308b\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0</li> <li> <p>\u30ab\u30b9\u30bf\u30e0\u30d0\u30ea\u30c7\u30fc\u30bf\u306e\u4f5c\u6210</p> </li> <li> <p>\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8</p> </li> <li>ScalaCheck \u306e\u57fa\u672c</li> <li>\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u306e\u4f5c\u6210</li> <li> <p>\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u5b9a\u7fa9\u3068\u691c\u8a3c</p> </li> <li> <p>TDD \u3068\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0</p> </li> <li>ScalaTest \u306b\u3088\u308b\u30c6\u30b9\u30c8</li> <li>Red-Green-Refactor \u30b5\u30a4\u30af\u30eb</li> <li>\u30c6\u30b9\u30c8\u30d5\u30a1\u30fc\u30b9\u30c8\u306e\u95a2\u6570\u8a2d\u8a08</li> </ol>"},{"location":"scala/#3","title":"\u7b2c3\u90e8: \u69cb\u9020\u30d1\u30bf\u30fc\u30f3","text":"<ol> <li>Composite \u30d1\u30bf\u30fc\u30f3</li> <li>\u518d\u5e30\u7684\u306a\u30c7\u30fc\u30bf\u69cb\u9020</li> <li>ADT \u306b\u3088\u308b\u30c4\u30ea\u30fc\u69cb\u9020</li> <li> <p>fold \u306b\u3088\u308b\u8d70\u67fb</p> </li> <li> <p>Decorator \u30d1\u30bf\u30fc\u30f3</p> </li> <li>\u95a2\u6570\u5408\u6210\u306b\u3088\u308b\u30c7\u30b3\u30ec\u30fc\u30b7\u30e7\u30f3</li> <li>\u9ad8\u968e\u95a2\u6570\u3067\u306e\u30e9\u30c3\u30d4\u30f3\u30b0</li> <li> <p>\u632f\u308b\u821e\u3044\u306e\u52d5\u7684\u8ffd\u52a0</p> </li> <li> <p>Adapter \u30d1\u30bf\u30fc\u30f3</p> </li> <li>\u95a2\u6570\u30a2\u30c0\u30d7\u30bf\u30fc</li> <li>\u30d7\u30ed\u30c8\u30b3\u30eb\u5909\u63db</li> <li>\u30ec\u30ac\u30b7\u30fc\u30b3\u30fc\u30c9\u3068\u306e\u7d71\u5408</li> </ol>"},{"location":"scala/#4","title":"\u7b2c4\u90e8: \u632f\u308b\u821e\u3044\u30d1\u30bf\u30fc\u30f3","text":"<ol> <li> <p>Strategy \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>\u7b2c\u4e00\u7d1a\u95a2\u6570\u3068\u3057\u3066\u306e\u6226\u7565</li> <li>\u52d5\u7684\u306a\u6226\u7565\u5207\u308a\u66ff\u3048</li> <li>\u6226\u7565\u306e\u5408\u6210</li> </ul> </li> <li> <p>Command \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>\u4e0d\u5909\u30b3\u30de\u30f3\u30c9\u30aa\u30d6\u30b8\u30a7\u30af\u30c8</li> <li>\u30b3\u30de\u30f3\u30c9\u306e\u5c65\u6b74\u3068 Undo</li> <li>\u30de\u30af\u30ed\u30b3\u30de\u30f3\u30c9</li> </ul> </li> <li> <p>Visitor \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u306b\u3088\u308b\u8a2a\u554f</li> <li>fold \u30d9\u30fc\u30b9\u306e\u30d3\u30b8\u30bf\u30fc</li> <li>\u62e1\u5f35\u53ef\u80fd\u306a\u30d3\u30b8\u30bf\u30fc</li> </ul> </li> </ol>"},{"location":"scala/#5","title":"\u7b2c5\u90e8: \u751f\u6210\u30d1\u30bf\u30fc\u30f3","text":"<ol> <li> <p>Abstract Factory \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>\u95a2\u6570\u30d5\u30a1\u30af\u30c8\u30ea\u30fc</li> <li>\u578b\u30af\u30e9\u30b9\u30d9\u30fc\u30b9\u306e\u751f\u6210</li> <li>\u4f9d\u5b58\u6027\u6ce8\u5165</li> </ul> </li> <li> <p>Abstract Server \u30d1\u30bf\u30fc\u30f3</p> <ul> <li>\u30c8\u30ec\u30a4\u30c8\u306b\u3088\u308b\u62bd\u8c61\u5316</li> <li>\u5b9f\u88c5\u306e\u5dee\u3057\u66ff\u3048</li> <li>\u30c6\u30b9\u30bf\u30d6\u30eb\u306a\u8a2d\u8a08</li> </ul> </li> </ol>"},{"location":"scala/#6","title":"\u7b2c6\u90e8: \u30b1\u30fc\u30b9\u30b9\u30bf\u30c7\u30a3","text":"<ol> <li> <p>\u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b</p> <ul> <li>\u4e0d\u5909\u72b6\u614b\u306e\u7ba1\u7406</li> <li>\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u306e\u5b9f\u88c5</li> <li>\u518d\u5e30\u7684\u306a\u51e6\u7406</li> </ul> </li> <li> <p>\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0</p> <ul> <li>\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30ea\u30f3\u30b0</li> <li>\u591a\u614b\u7684\u306a\u8a08\u7b97</li> <li>\u30ec\u30dd\u30fc\u30c8\u751f\u6210</li> </ul> </li> <li> <p>\u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0</p> <ul> <li>\u72b6\u614b\u9077\u79fb\u306e\u7ba1\u7406</li> <li>\u30a4\u30d9\u30f3\u30c8\u30bd\u30fc\u30b7\u30f3\u30b0</li> <li>\u30d3\u30b8\u30cd\u30b9\u30eb\u30fc\u30eb\u306e\u5b9f\u88c5</li> </ul> </li> <li> <p>\u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0</p> <ul> <li>\u72b6\u614b\u30de\u30b7\u30f3</li> <li>\u30a4\u30d9\u30f3\u30c8\u30d0\u30b9</li> <li>AtomicReference \u306b\u3088\u308b\u540c\u671f</li> </ul> </li> <li> <p>Wa-Tor \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3</p> <ul> <li>\u30bb\u30eb\u30aa\u30fc\u30c8\u30de\u30c8\u30f3</li> <li>\u4e0d\u5909\u30b0\u30ea\u30c3\u30c9\u306e\u66f4\u65b0</li> <li>\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30d7</li> </ul> </li> </ol>"},{"location":"scala/#7","title":"\u7b2c7\u90e8: \u307e\u3068\u3081\u3068\u5fdc\u7528","text":"<ol> <li> <p>\u30d1\u30bf\u30fc\u30f3\u9593\u306e\u76f8\u4e92\u4f5c\u7528</p> <ul> <li>Composite + Decorator</li> <li>Command + Observer</li> <li>\u30d1\u30bf\u30fc\u30f3\u306e\u7d44\u307f\u5408\u308f\u305b</li> </ul> </li> <li> <p>\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9</p> <ul> <li>\u30c7\u30fc\u30bf\u4e2d\u5fc3\u8a2d\u8a08</li> <li>IO \u30e2\u30ca\u30c9</li> <li>\u95a2\u6570\u30c7\u30b3\u30ec\u30fc\u30bf\u30fc</li> <li>\u30c6\u30b9\u30bf\u30d6\u30eb\u306a\u8a2d\u8a08</li> </ul> </li> <li> <p>OO \u304b\u3089 FP \u3078\u306e\u79fb\u884c</p> <ul> <li>\u79fb\u884c\u6226\u7565\uff08Strangler Fig\u3001\u30a2\u30c0\u30d7\u30bf\u30fc\uff09</li> <li>\u30a4\u30d9\u30f3\u30c8\u30bd\u30fc\u30b7\u30f3\u30b0</li> <li>\u6bb5\u968e\u7684\u306a\u95a2\u6570\u62bd\u51fa</li> <li>ADT \u306b\u3088\u308b\u591a\u614b\u6027</li> </ul> </li> </ol>"},{"location":"scala/#_3","title":"\u672c\u30b7\u30ea\u30fc\u30ba\u306e\u7279\u5fb4","text":""},{"location":"scala/#scala_1","title":"Scala \u306e\u7279\u6027\u3092\u6d3b\u304b\u3057\u305f\u5b9f\u88c5","text":"<p>Scala 3 \u306e\u65b0\u6a5f\u80fd\uff08enum\u3001given/using\u3001\u62e1\u5f35\u30e1\u30bd\u30c3\u30c9\u306a\u3069\uff09\u3092\u6d3b\u7528\u3057\u3001\u30e2\u30c0\u30f3\u306a\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"scala/#_4","title":"\u5b9f\u8df5\u91cd\u8996","text":"<p>\u3059\u3079\u3066\u306e\u30d1\u30bf\u30fc\u30f3\u306f ScalaTest \u306b\u3088\u308b\u5b9f\u969b\u306b\u52d5\u4f5c\u3059\u308b\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9\u3092\u542b\u307f\u307e\u3059\u3002\u7406\u8ad6\u3060\u3051\u3067\u306a\u304f\u3001\u5b9f\u88c5\u3092\u901a\u3058\u3066\u7406\u89e3\u3092\u6df1\u3081\u308b\u3053\u3068\u3092\u91cd\u8996\u3057\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"scala/#_5","title":"\u6bb5\u968e\u7684\u306a\u5b66\u7fd2","text":"<p>\u57fa\u790e\u304b\u3089\u5fdc\u7528\u3078\u3068\u6bb5\u968e\u7684\u306b\u5185\u5bb9\u304c\u9032\u884c\u3057\u307e\u3059\u3002\u5404\u7ae0\u306f\u72ec\u7acb\u3057\u3066\u8aad\u3080\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u304c\u3001\u9806\u756a\u306b\u8aad\u3080\u3053\u3068\u3067\u3088\u308a\u6df1\u3044\u7406\u89e3\u304c\u5f97\u3089\u308c\u307e\u3059\u3002</p>"},{"location":"scala/#_6","title":"\u5bfe\u8c61\u8aad\u8005","text":"<ul> <li>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u8208\u5473\u304c\u3042\u308b Scala \u958b\u767a\u8005</li> <li>Scala \u3092\u5b66\u7fd2\u4e2d\u306e\u958b\u767a\u8005</li> <li>\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u306e\u77e5\u8b58\u304c\u3042\u308a\u3001\u95a2\u6570\u578b\u3067\u306e\u8868\u73fe\u3092\u5b66\u3073\u305f\u3044\u958b\u767a\u8005</li> <li>Clojure \u7248\u3068\u6bd4\u8f03\u3057\u3066\u5b66\u7fd2\u3057\u305f\u3044\u958b\u767a\u8005</li> </ul>"},{"location":"scala/#_7","title":"\u524d\u63d0\u77e5\u8b58","text":"<ul> <li>\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u57fa\u790e\u77e5\u8b58</li> <li>Scala \u306e\u57fa\u672c\u7684\u306a\u6587\u6cd5\uff08case class\u3001trait\u3001\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u306a\u3069\uff09</li> <li>\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u306e\u57fa\u672c\u6982\u5ff5\uff08\u63a8\u5968\uff09</li> </ul>"},{"location":"scala/#_8","title":"\u958b\u767a\u74b0\u5883","text":"<p>\u672c\u30b7\u30ea\u30fc\u30ba\u306e\u30b3\u30fc\u30c9\u306f\u4ee5\u4e0b\u306e\u74b0\u5883\u3067\u52d5\u4f5c\u78ba\u8a8d\u3057\u3066\u3044\u307e\u3059\uff1a</p> <ul> <li>Scala 3.3.1</li> <li>sbt 1.9.7</li> <li>ScalaTest 3.2.17</li> <li>Nix \u306b\u3088\u308b\u74b0\u5883\u7ba1\u7406</li> </ul>"},{"location":"scala/#_9","title":"\u74b0\u5883\u69cb\u7bc9","text":"<pre><code># Nix \u3092\u4f7f\u7528\u3057\u305f\u958b\u767a\u74b0\u5883\u306e\u8d77\u52d5\nnix develop .#scala\n\n# \u30c6\u30b9\u30c8\u306e\u5b9f\u884c\ncd app/scala/part1\nsbt test\n</code></pre>"},{"location":"scala/#_10","title":"\u53c2\u8003\u66f8\u7c4d","text":"<p>\u672c\u30b7\u30ea\u30fc\u30ba\u306f\u4ee5\u4e0b\u306e\u66f8\u7c4d\u306e\u5185\u5bb9\u3092\u53c2\u8003\u306b\u3057\u3066\u3044\u307e\u3059\uff1a</p> <ul> <li>\u300cFunctional Design: Principles, Patterns, and Practices\u300dRobert C. Martin</li> <li>\u300cFunctional Programming in Scala\u300dPaul Chiusano, R\u00fanar Bjarnason</li> <li>\u300cProgramming in Scala\u300dMartin Odersky, Lex Spoon, Bill Venners</li> <li>\u300cScala with Cats\u300dNoel Welsh, Dave Gurnell</li> </ul>"},{"location":"scala/01-immutability-and-data-transformation/","title":"\u7b2c1\u7ae0: \u4e0d\u5909\u6027\u3068\u30c7\u30fc\u30bf\u5909\u63db","text":""},{"location":"scala/01-immutability-and-data-transformation/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u6700\u3082\u91cd\u8981\u306a\u6982\u5ff5\u306e\u4e00\u3064\u304c\u4e0d\u5909\u6027\uff08Immutability\uff09\u3067\u3059\u3002\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u4e88\u6e2c\u53ef\u80fd\u6027\u304c\u5411\u4e0a\u3057\u3001\u4e26\u884c\u51e6\u7406\u3067\u306e\u30d0\u30b0\u3092\u9632\u304e\u3001\u30b3\u30fc\u30c9\u306e\u7406\u89e3\u3068\u4fdd\u5b88\u304c\u5bb9\u6613\u306b\u306a\u308a\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001Scala \u306b\u304a\u3051\u308b\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u57fa\u672c\u304b\u3089\u3001\u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3001\u526f\u4f5c\u7528\u306e\u5206\u96e2\u307e\u3067\u3001\u5b9f\u8df5\u7684\u306a\u4f8b\u3092\u901a\u3058\u3066\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"scala/01-immutability-and-data-transformation/#1_1","title":"1. \u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u57fa\u672c","text":""},{"location":"scala/01-immutability-and-data-transformation/#_2","title":"\u306a\u305c\u4e0d\u5909\u6027\u304c\u91cd\u8981\u306a\u306e\u304b","text":"<p>\u5f93\u6765\u306e\u547d\u4ee4\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u5909\u6570\u3084\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u72b6\u614b\u3092\u76f4\u63a5\u5909\u66f4\u3057\u307e\u3059\uff1a</p> <pre><code>// Java\uff08\u53ef\u5909\uff09\nperson.setAge(31);  // \u5143\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u5909\u66f4\u3055\u308c\u308b\n</code></pre> <p>\u3053\u308c\u306b\u5bfe\u3057\u3001Scala \u306e case class \u306f\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u4e0d\u5909\u3067\u3059\u3002\u30c7\u30fc\u30bf\u3092\u300c\u5909\u66f4\u300d\u3059\u308b\u3068\u3001\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u69cb\u9020\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\uff1a</p> <pre><code>case class Person(name: String, age: Int)\n\ndef updateAge(person: Person, newAge: Int): Person =\n  person.copy(age = newAge)\n\n// \u4f7f\u7528\u4f8b\nval originalPerson = Person(\"\u7530\u4e2d\", 30)\nval updatedPerson = updateAge(originalPerson, 31)\n\noriginalPerson   // =&gt; Person(\"\u7530\u4e2d\", 30)  \u2190 \u5143\u306e\u30c7\u30fc\u30bf\u306f\u5909\u308f\u3089\u306a\u3044\nupdatedPerson    // =&gt; Person(\"\u7530\u4e2d\", 31)  \u2190 \u65b0\u3057\u3044\u30c7\u30fc\u30bf\n</code></pre>"},{"location":"scala/01-immutability-and-data-transformation/#_3","title":"\u4e0d\u5909\u6027\u306e\u5229\u70b9","text":"<ol> <li>\u4e88\u6e2c\u53ef\u80fd\u6027: \u30c7\u30fc\u30bf\u304c\u5909\u66f4\u3055\u308c\u306a\u3044\u305f\u3081\u3001\u95a2\u6570\u306e\u52d5\u4f5c\u3092\u4e88\u6e2c\u3057\u3084\u3059\u3044</li> <li>\u30b9\u30ec\u30c3\u30c9\u30bb\u30fc\u30d5: \u8907\u6570\u306e\u30b9\u30ec\u30c3\u30c9\u304b\u3089\u5b89\u5168\u306b\u30a2\u30af\u30bb\u30b9\u3067\u304d\u308b</li> <li>\u5c65\u6b74\u306e\u4fdd\u6301: \u5909\u66f4\u524d\u306e\u30c7\u30fc\u30bf\u3092\u4fdd\u6301\u3067\u304d\u308b\uff08Undo/Redo \u306e\u5b9f\u88c5\u304c\u5bb9\u6613\uff09</li> <li>\u30c7\u30d0\u30c3\u30b0\u306e\u5bb9\u6613\u3055: \u30c7\u30fc\u30bf\u306e\u5909\u66f4\u5c65\u6b74\u3092\u8ffd\u8de1\u3057\u3084\u3059\u3044</li> </ol>"},{"location":"scala/01-immutability-and-data-transformation/#2-structural-sharing","title":"2. \u69cb\u9020\u5171\u6709\uff08Structural Sharing\uff09","text":"<p>\u300c\u6bce\u56de\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u4f5c\u6210\u3059\u308b\u3068\u975e\u52b9\u7387\u3067\u306f\uff1f\u300d\u3068\u601d\u3046\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002Scala \u306e\u6c38\u7d9a\u7684\u30c7\u30fc\u30bf\u69cb\u9020\u306f\u69cb\u9020\u5171\u6709\u306b\u3088\u308a\u3001\u52b9\u7387\u7684\u306b\u30e1\u30e2\u30ea\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002</p> <pre><code>case class Member(name: String, role: String)\ncase class Team(name: String, members: List[Member])\n\ndef addMember(team: Team, member: Member): Team =\n  team.copy(members = team.members :+ member)\n\nval team = Team(\"\u958b\u767a\u30c1\u30fc\u30e0\", List(\n  Member(\"\u7530\u4e2d\", \"developer\"),\n  Member(\"\u9234\u6728\", \"designer\"),\n  Member(\"\u4f50\u85e4\", \"manager\")\n))\n\nval newTeam = addMember(team, Member(\"\u5c71\u7530\", \"developer\"))\n</code></pre> <p><code>newTeam</code> \u306f\u65b0\u3057\u3044 Team \u3067\u3059\u304c\u3001<code>name</code> \u306e\u5024\u3084\u65e2\u5b58\u306e\u30e1\u30f3\u30d0\u30fc\u30c7\u30fc\u30bf\u306f <code>team</code> \u3068\u5171\u6709\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u5909\u66f4\u3055\u308c\u3066\u3044\u306a\u3044\u90e8\u5206\u306f\u30b3\u30d4\u30fc\u3055\u308c\u305a\u3001\u53c2\u7167\u304c\u5171\u6709\u3055\u308c\u307e\u3059\u3002</p> <p></p>"},{"location":"scala/01-immutability-and-data-transformation/#3","title":"3. \u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u30c7\u30fc\u30bf\u3092\u5909\u63db\u3059\u308b\u4e00\u9023\u306e\u51e6\u7406\u3092\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3068\u3057\u3066\u8868\u73fe\u3057\u307e\u3059\u3002Scala \u3067\u306f\u30e1\u30bd\u30c3\u30c9\u30c1\u30a7\u30fc\u30f3\u3092\u4f7f\u7528\u3057\u3066\u3001\u8aad\u307f\u3084\u3059\u3044\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u69cb\u7bc9\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"scala/01-immutability-and-data-transformation/#_4","title":"\u5b9f\u8df5\u4f8b\uff1a\u6ce8\u6587\u51e6\u7406\u30b7\u30b9\u30c6\u30e0","text":"<pre><code>case class Item(name: String, price: Int, quantity: Int)\ncase class Customer(name: String, membership: String)\ncase class Order(items: List[Item], customer: Customer)\n\n// \u5404\u30a2\u30a4\u30c6\u30e0\u306e\u5c0f\u8a08\u3092\u8a08\u7b97\ndef calculateSubtotal(item: Item): Int =\n  item.price * item.quantity\n\n// \u4f1a\u54e1\u7a2e\u5225\u306b\u5fdc\u3058\u305f\u5272\u5f15\u7387\u3092\u53d6\u5f97\ndef membershipDiscount(membership: String): Double =\n  membership match\n    case \"gold\"   =&gt; 0.1\n    case \"silver\" =&gt; 0.05\n    case \"bronze\" =&gt; 0.02\n    case _        =&gt; 0.0\n\n// \u6ce8\u6587\u306e\u5408\u8a08\u91d1\u984d\u3092\u8a08\u7b97\ndef calculateTotal(order: Order): Int =\n  order.items.map(calculateSubtotal).sum\n\n// \u5272\u5f15\u5f8c\u306e\u91d1\u984d\u3092\u8a08\u7b97\ndef applyDiscount(order: Order, total: Int): Double =\n  val discountRate = membershipDiscount(order.customer.membership)\n  total * (1 - discountRate)\n\n// \u6ce8\u6587\u3092\u51e6\u7406\u3057\u3001\u5272\u5f15\u5f8c\u306e\u5408\u8a08\u91d1\u984d\u3092\u8fd4\u3059\ndef processOrder(order: Order): Double =\n  val total = calculateTotal(order)\n  applyDiscount(order, total)\n</code></pre>"},{"location":"scala/01-immutability-and-data-transformation/#scala","title":"Scala \u306e\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u8a18\u6cd5","text":"<p>Scala \u3067\u306f\u8907\u6570\u306e\u65b9\u6cd5\u3067\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u8868\u73fe\u3067\u304d\u307e\u3059\uff1a</p> <pre><code>// \u30e1\u30bd\u30c3\u30c9\u30c1\u30a7\u30fc\u30f3\norder.items.map(calculateSubtotal).sum\n\n// \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3068\u7d44\u307f\u5408\u308f\u305b\norder.customer.membership match\n  case \"gold\"   =&gt; 0.1\n  case \"silver\" =&gt; 0.05\n  case _        =&gt; 0.0\n\n// for \u5f0f\uff08\u30e2\u30ca\u30c7\u30a3\u30c3\u30af\u306a\u5408\u6210\uff09\nfor\n  item &lt;- order.items\n  subtotal = calculateSubtotal(item)\nyield subtotal\n</code></pre>"},{"location":"scala/01-immutability-and-data-transformation/#4","title":"4. \u526f\u4f5c\u7528\u306e\u5206\u96e2","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u7d14\u7c8b\u95a2\u6570\u3068\u526f\u4f5c\u7528\u3092\u6301\u3064\u95a2\u6570\u3092\u660e\u78ba\u306b\u5206\u96e2\u3059\u308b\u3053\u3068\u304c\u91cd\u8981\u3067\u3059\u3002</p>"},{"location":"scala/01-immutability-and-data-transformation/#_5","title":"\u7d14\u7c8b\u95a2\u6570\u3068\u306f","text":"<ul> <li>\u540c\u3058\u5165\u529b\u306b\u5bfe\u3057\u3066\u5e38\u306b\u540c\u3058\u51fa\u529b\u3092\u8fd4\u3059</li> <li>\u5916\u90e8\u306e\u72b6\u614b\u3092\u5909\u66f4\u3057\u306a\u3044\uff08\u526f\u4f5c\u7528\u304c\u306a\u3044\uff09</li> </ul> <pre><code>// \u7d14\u7c8b\u95a2\u6570\ndef pureCalculateTax(amount: Int, taxRate: Double): Double =\n  amount * taxRate\n\n// \u4f55\u5ea6\u547c\u3093\u3067\u3082\u540c\u3058\u7d50\u679c\npureCalculateTax(1000, 0.1)  // =&gt; 100.0\npureCalculateTax(1000, 0.1)  // =&gt; 100.0\n</code></pre>"},{"location":"scala/01-immutability-and-data-transformation/#_6","title":"\u526f\u4f5c\u7528\u306e\u5206\u96e2\u30d1\u30bf\u30fc\u30f3","text":"<p>\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\uff08\u7d14\u7c8b\u95a2\u6570\uff09\u3068\u526f\u4f5c\u7528\uff08I/O\uff09\u3092\u5206\u96e2\u3057\u307e\u3059\uff1a</p> <pre><code>case class Invoice(subtotal: Int, tax: Double, total: Double)\n\n// \u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\uff08\u7d14\u7c8b\u95a2\u6570\uff09\ndef calculateInvoice(items: List[Item], taxRate: Double): Invoice =\n  val subtotal = items.map(calculateSubtotal).sum\n  val tax = pureCalculateTax(subtotal, taxRate)\n  val total = subtotal + tax\n  Invoice(subtotal, tax, total)\n\n// \u526f\u4f5c\u7528\u3092\u542b\u3080\u51e6\u7406\uff08\u5206\u96e2\uff09\ndef saveInvoice(invoice: Invoice): Invoice =\n  // \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3078\u306e\u4fdd\u5b58\uff08\u526f\u4f5c\u7528\uff09\n  println(s\"Saving invoice: $invoice\")\n  invoice\n\ndef sendNotification(invoice: Invoice, customerEmail: String): Invoice =\n  // \u30e1\u30fc\u30eb\u9001\u4fe1\uff08\u526f\u4f5c\u7528\uff09\n  println(s\"Sending notification to: $customerEmail\")\n  invoice\n\n// \u51e6\u7406\u5168\u4f53\u306e\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\ndef processAndSaveInvoice(items: List[Item], taxRate: Double, customerEmail: String): Invoice =\n  val invoice = calculateInvoice(items, taxRate)\n  val saved = saveInvoice(invoice)\n  sendNotification(saved, customerEmail)\n</code></pre> <p>Scala \u3067\u306f\u526f\u4f5c\u7528\u3092\u6301\u3064\u95a2\u6570\u306b\u7279\u5225\u306a\u30b5\u30d5\u30a3\u30c3\u30af\u30b9\u3092\u4ed8\u3051\u308b\u6163\u4f8b\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u30b3\u30e1\u30f3\u30c8\u3084\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u660e\u793a\u3059\u308b\u3053\u3068\u304c\u63a8\u5968\u3055\u308c\u307e\u3059\u3002\u307e\u305f\u3001Cats Effect \u3084 ZIO \u306a\u3069\u306e\u95a2\u6570\u578b\u30a8\u30d5\u30a7\u30af\u30c8\u30b7\u30b9\u30c6\u30e0\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u526f\u4f5c\u7528\u3092\u578b\u30ec\u30d9\u30eb\u3067\u8ffd\u8de1\u3059\u308b\u3053\u3068\u3082\u53ef\u80fd\u3067\u3059\u3002</p>"},{"location":"scala/01-immutability-and-data-transformation/#5-undoredo","title":"5. \u6c38\u7d9a\u7684\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u6d3b\u7528\uff1aUndo/Redo \u306e\u5b9f\u88c5","text":"<p>\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u6d3b\u7528\u3059\u308b\u3068\u3001\u5c65\u6b74\u7ba1\u7406\u304c\u975e\u5e38\u306b\u7c21\u5358\u306b\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p> <pre><code>case class History[A](current: Option[A], past: List[A], future: List[A])\n\n// \u5c65\u6b74\u3092\u4fdd\u6301\u3059\u308b\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u4f5c\u6210\u3059\u308b\ndef createHistory[A](): History[A] =\n  History(current = None, past = List.empty, future = List.empty)\n\n// \u65b0\u3057\u3044\u72b6\u614b\u3092\u5c65\u6b74\u306b\u30d7\u30c3\u30b7\u30e5\u3059\u308b\ndef pushState[A](history: History[A], newState: A): History[A] =\n  History(\n    current = Some(newState),\n    past = history.current.toList ++ history.past,\n    future = List.empty\n  )\n\n// \u76f4\u524d\u306e\u72b6\u614b\u306b\u623b\u3059\ndef undo[A](history: History[A]): History[A] =\n  history.past match\n    case Nil =&gt; history\n    case previous :: rest =&gt;\n      History(\n        current = Some(previous),\n        past = rest,\n        future = history.current.toList ++ history.future\n      )\n\n// \u3084\u308a\u76f4\u3057\u64cd\u4f5c\ndef redo[A](history: History[A]): History[A] =\n  history.future match\n    case Nil =&gt; history\n    case nextState :: rest =&gt;\n      History(\n        current = Some(nextState),\n        past = history.current.toList ++ history.past,\n        future = rest\n      )\n</code></pre>"},{"location":"scala/01-immutability-and-data-transformation/#_7","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>val history = pushState(\n  pushState(\n    pushState(createHistory[Map[String, String]](), Map(\"text\" -&gt; \"Hello\")),\n    Map(\"text\" -&gt; \"Hello World\")\n  ),\n  Map(\"text\" -&gt; \"Hello World!\")\n)\n\nhistory.current  // =&gt; Some(Map(\"text\" -&gt; \"Hello World!\"))\n\nval afterUndo = undo(history)\nafterUndo.current  // =&gt; Some(Map(\"text\" -&gt; \"Hello World\"))\n\nval afterRedo = redo(afterUndo)\nafterRedo.current  // =&gt; Some(Map(\"text\" -&gt; \"Hello World!\"))\n</code></pre>"},{"location":"scala/01-immutability-and-data-transformation/#6-iterator","title":"6. Iterator \u306b\u3088\u308b\u52b9\u7387\u7684\u306a\u5909\u63db","text":"<p>\u8907\u6570\u306e\u5909\u63db\u3092\u884c\u3046\u5834\u5408\u3001\u901a\u5e38\u306f\u4e2d\u9593\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002Scala \u3067\u306f Iterator \u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u8907\u6570\u306e\u5909\u63db\u30921\u56de\u306e\u30d1\u30b9\u3067\u51e6\u7406\u3067\u304d\u307e\u3059\u3002</p> <pre><code>case class ProcessedItem(name: String, price: Int, quantity: Int, subtotal: Int)\n\n// \u901a\u5e38\u306e\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u51e6\u7406\uff08\u4e2d\u9593\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u304c\u4f5c\u6210\u3055\u308c\u308b\uff09\ndef processItemsEfficiently(items: List[Item]): List[ProcessedItem] =\n  items\n    .filter(_.quantity &gt; 0)\n    .map(item =&gt; ProcessedItem(item.name, item.price, item.quantity, calculateSubtotal(item)))\n    .filter(_.subtotal &gt; 100)\n\n// Iterator \u3092\u4f7f\u7528\u3057\u305f\u52b9\u7387\u7684\u306a\u51e6\u7406\uff08\u4e2d\u9593\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3057\u306a\u3044\uff09\ndef processItemsWithIterator(items: List[Item]): List[ProcessedItem] =\n  items.iterator\n    .filter(_.quantity &gt; 0)\n    .map(item =&gt; ProcessedItem(item.name, item.price, item.quantity, calculateSubtotal(item)))\n    .filter(_.subtotal &gt; 100)\n    .toList\n</code></pre> <p>Iterator \u306e\u5229\u70b9\uff1a - \u4e2d\u9593\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3092\u4f5c\u6210\u3057\u306a\u3044 - \u9045\u5ef6\u8a55\u4fa1\u306b\u3088\u308a\u5fc5\u8981\u306a\u8981\u7d20\u306e\u307f\u51e6\u7406 - \u30e1\u30e2\u30ea\u52b9\u7387\u304c\u826f\u3044</p>"},{"location":"scala/01-immutability-and-data-transformation/#lazylist","title":"LazyList \u306b\u3088\u308b\u9045\u5ef6\u8a55\u4fa1","text":"<p>Scala 2.13 \u4ee5\u964d\u3067\u306f LazyList \u3092\u4f7f\u7528\u3057\u305f\u9045\u5ef6\u8a55\u4fa1\u3082\u53ef\u80fd\u3067\u3059\uff1a</p> <pre><code>val lazyNumbers = LazyList.from(1)\n  .filter(_ % 2 == 0)\n  .take(10)\n  .toList  // =&gt; List(2, 4, 6, 8, 10, 12, 14, 16, 18, 20)\n</code></pre>"},{"location":"scala/01-immutability-and-data-transformation/#_8","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u57fa\u790e\u3067\u3042\u308b\u4e0d\u5909\u6027\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020: case class \u3068 copy \u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u4e0d\u5909\u6027\u306e\u5b9f\u73fe</li> <li>\u69cb\u9020\u5171\u6709: \u52b9\u7387\u7684\u306a\u30e1\u30e2\u30ea\u4f7f\u7528\u3092\u5b9f\u73fe\u3059\u308b\u6c38\u7d9a\u7684\u30c7\u30fc\u30bf\u69cb\u9020</li> <li>\u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3: \u30e1\u30bd\u30c3\u30c9\u30c1\u30a7\u30fc\u30f3\u306b\u3088\u308b\u8aad\u307f\u3084\u3059\u3044\u5909\u63db\u51e6\u7406</li> <li>\u526f\u4f5c\u7528\u306e\u5206\u96e2: \u7d14\u7c8b\u95a2\u6570\u3068 I/O \u51e6\u7406\u306e\u660e\u78ba\u306a\u5206\u96e2</li> <li>\u5c65\u6b74\u7ba1\u7406: \u4e0d\u5909\u6027\u3092\u6d3b\u7528\u3057\u305f Undo/Redo \u306e\u7c21\u6f54\u306a\u5b9f\u88c5</li> <li>Iterator: \u52b9\u7387\u7684\u306a\u9045\u5ef6\u8a55\u4fa1\u306b\u3088\u308b\u8907\u5408\u5909\u63db</li> </ol> <p>\u3053\u308c\u3089\u306e\u6982\u5ff5\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u4ed6\u306e\u3059\u3079\u3066\u306e\u30d1\u30bf\u30fc\u30f3\u306e\u57fa\u76e4\u3068\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"scala/01-immutability-and-data-transformation/#_9","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/scala/part1/src/main/scala/Immutability.scala</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/scala/part1/src/test/scala/ImmutabilitySpec.scala</code></li> </ul>"},{"location":"scala/01-immutability-and-data-transformation/#_10","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001\u95a2\u6570\u5408\u6210\u3068\u9ad8\u968e\u95a2\u6570\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u5c0f\u3055\u306a\u95a2\u6570\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u8907\u96d1\u306a\u51e6\u7406\u3092\u69cb\u7bc9\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"scala/02-function-composition/","title":"\u7b2c2\u7ae0: \u95a2\u6570\u5408\u6210\u3068\u9ad8\u968e\u95a2\u6570","text":""},{"location":"scala/02-function-composition/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u771f\u9ac4\u306f\u3001\u5c0f\u3055\u306a\u95a2\u6570\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u8907\u96d1\u306a\u51e6\u7406\u3092\u69cb\u7bc9\u3059\u308b\u3053\u3068\u306b\u3042\u308a\u307e\u3059\u3002\u672c\u7ae0\u3067\u306f\u3001Scala \u306b\u304a\u3051\u308b\u95a2\u6570\u5408\u6210\u306e\u30c6\u30af\u30cb\u30c3\u30af\u3068\u9ad8\u968e\u95a2\u6570\u306e\u6d3b\u7528\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"scala/02-function-composition/#1-andthen-compose","title":"1. \u95a2\u6570\u5408\u6210\u306e\u57fa\u672c (andThen, compose)","text":""},{"location":"scala/02-function-composition/#andthen-compose","title":"andThen \u3068 compose \u306b\u3088\u308b\u95a2\u6570\u306e\u9023\u7d50","text":"<p>Scala \u3067\u306f <code>andThen</code> \u3068 <code>compose</code> \u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u95a2\u6570\u3092\u5408\u6210\u3067\u304d\u307e\u3059\u3002</p> <ul> <li><code>andThen</code>: \u5de6\u304b\u3089\u53f3\u3078\u9806\u756a\u306b\u9069\u7528\uff08\u76f4\u611f\u7684\uff09</li> <li><code>compose</code>: \u53f3\u304b\u3089\u5de6\u3078\u9806\u756a\u306b\u9069\u7528\uff08\u6570\u5b66\u7684\u306a\u95a2\u6570\u5408\u6210\uff09</li> </ul> <pre><code>def addTax(rate: Double)(amount: Double): Double =\n  amount * (1 + rate)\n\ndef applyDiscountRate(rate: Double)(amount: Double): Double =\n  amount * (1 - rate)\n\ndef roundToYen(amount: Double): Long =\n  Math.round(amount)\n\n// andThen \u306b\u3088\u308b\u95a2\u6570\u5408\u6210\uff08\u5de6\u304b\u3089\u53f3\uff09\nval calculateFinalPrice: Double =&gt; Long =\n  applyDiscountRate(0.2) andThen addTax(0.1) andThen roundToYen\n\n// compose \u306b\u3088\u308b\u95a2\u6570\u5408\u6210\uff08\u53f3\u304b\u3089\u5de6\uff09\nval calculateFinalPriceCompose: Double =&gt; Long =\n  (roundToYen _) compose addTax(0.1) compose applyDiscountRate(0.2)\n\n// \u4f7f\u7528\u4f8b\ncalculateFinalPrice(1000)\n// =&gt; 880\n// \u51e6\u7406\u9806\u5e8f: 1000 \u2192 20%\u5272\u5f15(800) \u2192 10%\u7a0e\u8fbc(880) \u2192 \u4e38\u3081(880)\n</code></pre>"},{"location":"scala/02-function-composition/#_2","title":"\u95a2\u6570\u5408\u6210\u306e\u5229\u70b9","text":"<ol> <li>\u5ba3\u8a00\u7684\u306a\u8a18\u8ff0: \u51e6\u7406\u306e\u6d41\u308c\u3092\u95a2\u6570\u306e\u30c1\u30a7\u30fc\u30f3\u3068\u3057\u3066\u8868\u73fe</li> <li>\u518d\u5229\u7528\u6027: \u5408\u6210\u3057\u305f\u95a2\u6570\u3092\u5225\u306e\u5834\u6240\u3067\u518d\u5229\u7528\u53ef\u80fd</li> <li>\u30c6\u30b9\u30c8\u5bb9\u6613\u6027: \u5404\u95a2\u6570\u3092\u500b\u5225\u306b\u30c6\u30b9\u30c8\u53ef\u80fd</li> </ol>"},{"location":"scala/02-function-composition/#2_1","title":"2. \u30ab\u30ea\u30fc\u5316\u3068\u90e8\u5206\u9069\u7528","text":""},{"location":"scala/02-function-composition/#_3","title":"\u30ab\u30ea\u30fc\u5316\u306b\u3088\u308b\u5f15\u6570\u306e\u56fa\u5b9a","text":"<p>Scala \u3067\u306f\u95a2\u6570\u3092\u30ab\u30ea\u30fc\u5316\u5f62\u5f0f\u3067\u5b9a\u7fa9\u3059\u308b\u3053\u3068\u3067\u3001\u90e8\u5206\u9069\u7528\u304c\u81ea\u7136\u306b\u884c\u3048\u307e\u3059\u3002</p> <pre><code>// \u30ab\u30ea\u30fc\u5316\u3055\u308c\u305f\u95a2\u6570\ndef greetCurried(greeting: String)(name: String): String =\n  s\"$greeting, $name!\"\n\nval sayHello: String =&gt; String = greetCurried(\"Hello\")\nval sayGoodbye: String =&gt; String = greetCurried(\"Goodbye\")\n\nsayHello(\"\u7530\u4e2d\")    // =&gt; \"Hello, \u7530\u4e2d!\"\nsayGoodbye(\"\u9234\u6728\")  // =&gt; \"Goodbye, \u9234\u6728!\"\n</code></pre>"},{"location":"scala/02-function-composition/#_4","title":"\u8907\u6570\u5f15\u6570\u306e\u90e8\u5206\u9069\u7528","text":"<pre><code>case class Email(from: String, to: String, subject: String, body: String)\n\ndef sendEmail(from: String)(to: String)(subject: String)(body: String): Email =\n  Email(from, to, subject, body)\n\nval sendFromSystem = sendEmail(\"system@example.com\")\nval sendNotification = sendFromSystem(\"user@example.com\")(\"\u901a\u77e5\")\n\nsendNotification(\"\u30e1\u30c3\u30bb\u30fc\u30b8\u672c\u6587\")\n// =&gt; Email(from = \"system@example.com\",\n//          to = \"user@example.com\",\n//          subject = \"\u901a\u77e5\",\n//          body = \"\u30e1\u30c3\u30bb\u30fc\u30b8\u672c\u6587\")\n</code></pre>"},{"location":"scala/02-function-composition/#3","title":"3. \u8907\u6570\u306e\u95a2\u6570\u3092\u4e26\u5217\u9069\u7528","text":"<p>Clojure \u306e <code>juxt</code> \u306b\u76f8\u5f53\u3059\u308b\u6a5f\u80fd\u306f\u3001Scala \u3067\u306f\u30bf\u30d7\u30eb\u3084\u30b1\u30fc\u30b9\u30af\u30e9\u30b9\u3092\u4f7f\u3063\u3066\u8868\u73fe\u3057\u307e\u3059\u3002</p> <pre><code>// \u6570\u5024\u30ea\u30b9\u30c8\u306e\u7d71\u8a08\u60c5\u5831\u3092\u53d6\u5f97\u3059\u308b\ndef getStats(numbers: List[Int]): (Int, Int, Int, Int, Int) =\n  (numbers.head, numbers.last, numbers.length, numbers.min, numbers.max)\n\ngetStats(List(3, 1, 4, 1, 5, 9, 2, 6))\n// =&gt; (3, 6, 8, 1, 9)\n// (\u6700\u521d\u306e\u5024, \u6700\u5f8c\u306e\u5024, \u8981\u7d20\u6570, \u6700\u5c0f\u5024, \u6700\u5927\u5024)\n</code></pre>"},{"location":"scala/02-function-composition/#_5","title":"\u5b9f\u7528\u4f8b\uff1a\u30c7\u30fc\u30bf\u5206\u6790","text":"<pre><code>case class PersonAnalysis(name: String, age: Int, category: String)\n\ndef analyzePerson(person: Map[String, Any]): PersonAnalysis =\n  val name = person(\"name\").asInstanceOf[String]\n  val age = person(\"age\").asInstanceOf[Int]\n  val category = if age &gt;= 18 then \"adult\" else \"minor\"\n  PersonAnalysis(name, age, category)\n\nanalyzePerson(Map(\"name\" -&gt; \"\u7530\u4e2d\", \"age\" -&gt; 25))\n// =&gt; PersonAnalysis(\"\u7530\u4e2d\", 25, \"adult\")\n\nanalyzePerson(Map(\"name\" -&gt; \"\u9234\u6728\", \"age\" -&gt; 15))\n// =&gt; PersonAnalysis(\"\u9234\u6728\", 15, \"minor\")\n</code></pre>"},{"location":"scala/02-function-composition/#4","title":"4. \u9ad8\u968e\u95a2\u6570\u306b\u3088\u308b\u30c7\u30fc\u30bf\u51e6\u7406","text":"<p>\u9ad8\u968e\u95a2\u6570\u3068\u306f\u3001\u95a2\u6570\u3092\u5f15\u6570\u3068\u3057\u3066\u53d7\u3051\u53d6\u308b\u304b\u3001\u95a2\u6570\u3092\u8fd4\u3059\u95a2\u6570\u306e\u3053\u3068\u3067\u3059\u3002</p>"},{"location":"scala/02-function-composition/#_6","title":"\u30ed\u30b0\u51fa\u529b\u306e\u30e9\u30c3\u30d1\u30fc","text":"<pre><code>def processWithLogging[A, B](f: A =&gt; B): A =&gt; B =\n  (input: A) =&gt;\n    println(s\"\u5165\u529b: $input\")\n    val result = f(input)\n    println(s\"\u51fa\u529b: $result\")\n    result\n\nval doubleWithLog = processWithLogging[Int, Int](_ * 2)\ndoubleWithLog(5)\n// \u5165\u529b: 5\n// \u51fa\u529b: 10\n// =&gt; 10\n</code></pre>"},{"location":"scala/02-function-composition/#_7","title":"\u30ea\u30c8\u30e9\u30a4\u6a5f\u80fd\u306e\u8ffd\u52a0","text":"<pre><code>def retry[A, B](f: A =&gt; B, maxRetries: Int): A =&gt; B =\n  (input: A) =&gt;\n    def attempt(attempts: Int): B =\n      try\n        f(input)\n      catch\n        case e: Exception =&gt;\n          if attempts &lt; maxRetries then attempt(attempts + 1)\n          else throw e\n    attempt(0)\n\n// \u4e0d\u5b89\u5b9a\u306aAPI\u547c\u3073\u51fa\u3057\u3092\u30ea\u30c8\u30e9\u30a4\u4ed8\u304d\u3067\u30e9\u30c3\u30d7\nval fetchWithRetry = retry(fetchData, 3)\n</code></pre>"},{"location":"scala/02-function-composition/#ttl","title":"TTL \u4ed8\u304d\u30e1\u30e2\u5316","text":"<pre><code>def memoizeWithTtl[A, B](f: A =&gt; B, ttlMs: Long): A =&gt; B =\n  var cache: Map[A, (B, Long)] = Map.empty\n\n  (input: A) =&gt;\n    val now = System.currentTimeMillis()\n    cache.get(input) match\n      case Some((value, time)) if now - time &lt; ttlMs =&gt; value\n      case _ =&gt;\n        val result = f(input)\n        cache = cache + (input -&gt; (result, now))\n        result\n</code></pre>"},{"location":"scala/02-function-composition/#5","title":"5. \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u51e6\u7406","text":"<p>\u8907\u6570\u306e\u95a2\u6570\u3092\u9806\u6b21\u9069\u7528\u3059\u308b\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002</p> <pre><code>def pipeline[A](fns: (A =&gt; A)*): A =&gt; A =\n  (input: A) =&gt; fns.foldLeft(input)((acc, f) =&gt; f(acc))\n</code></pre>"},{"location":"scala/02-function-composition/#_8","title":"\u6ce8\u6587\u51e6\u7406\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u5b9f\u88c5","text":"<pre><code>case class OrderItem(price: Int, quantity: Int)\ncase class Customer(membership: String)\ncase class Order(items: List[OrderItem], customer: Customer, total: Double = 0, shipping: Int = 0)\n\ndef validateOrder(order: Order): Order =\n  if order.items.isEmpty then\n    throw new IllegalArgumentException(\"\u6ce8\u6587\u306b\u30a2\u30a4\u30c6\u30e0\u304c\u3042\u308a\u307e\u305b\u3093\")\n  else\n    order\n\ndef calculateOrderTotal(order: Order): Order =\n  val total = order.items.map(item =&gt; item.price * item.quantity).sum\n  order.copy(total = total)\n\ndef applyOrderDiscount(order: Order): Order =\n  val discountRates = Map(\"gold\" -&gt; 0.1, \"silver\" -&gt; 0.05, \"bronze\" -&gt; 0.02)\n  val discountRate = discountRates.getOrElse(order.customer.membership, 0.0)\n  order.copy(total = order.total * (1 - discountRate))\n\ndef addShipping(order: Order): Order =\n  val shipping = if order.total &gt;= 5000 then 0 else 500\n  order.copy(shipping = shipping, total = order.total + shipping)\n\nval processOrderPipeline: Order =&gt; Order =\n  pipeline(validateOrder, calculateOrderTotal, applyOrderDiscount, addShipping)\n\n// \u4f7f\u7528\u4f8b\nprocessOrderPipeline(Order(\n  items = List(OrderItem(1000, 2), OrderItem(500, 3)),\n  customer = Customer(\"gold\")\n))\n// =&gt; Order(items = [...], customer = Customer(\"gold\"), total = 3650.0, shipping = 500)\n</code></pre>"},{"location":"scala/02-function-composition/#6","title":"6. \u95a2\u6570\u5408\u6210\u306b\u3088\u308b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3","text":"<p>\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30ed\u30b8\u30c3\u30af\u3092\u95a2\u6570\u5408\u6210\u3067\u8868\u73fe\u3057\u307e\u3059\u3002</p> <pre><code>case class ValidationResult[A](valid: Boolean, value: A, error: Option[String] = None)\n\ndef validator[A](pred: A =&gt; Boolean, errorMsg: String): A =&gt; ValidationResult[A] =\n  (value: A) =&gt;\n    if pred(value) then ValidationResult(valid = true, value = value)\n    else ValidationResult(valid = false, value = value, error = Some(errorMsg))\n\ndef combineValidators[A](validators: (A =&gt; ValidationResult[A])*): A =&gt; ValidationResult[A] =\n  (value: A) =&gt;\n    validators.foldLeft(ValidationResult(valid = true, value = value)) { (result, v) =&gt;\n      if result.valid then v(result.value)\n      else result\n    }\n\n// \u500b\u5225\u306e\u30d0\u30ea\u30c7\u30fc\u30bf\nval validatePositive = validator[Int](_ &gt; 0, \"\u5024\u306f\u6b63\u306e\u6570\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\")\nval validateUnder100 = validator[Int](_ &lt; 100, \"\u5024\u306f100\u672a\u6e80\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\")\n\n// \u30d0\u30ea\u30c7\u30fc\u30bf\u306e\u5408\u6210\ndef validateQuantity(value: Int): ValidationResult[Int] =\n  combineValidators(validatePositive, validateUnder100)(value)\n\n// \u4f7f\u7528\u4f8b\nvalidateQuantity(50)   // =&gt; ValidationResult(true, 50, None)\nvalidateQuantity(-1)   // =&gt; ValidationResult(false, -1, Some(\"\u5024\u306f\u6b63\u306e\u6570\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"))\nvalidateQuantity(100)  // =&gt; ValidationResult(false, 100, Some(\"\u5024\u306f100\u672a\u6e80\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"))\n</code></pre>"},{"location":"scala/02-function-composition/#7","title":"7. \u95a2\u6570\u306e\u5909\u63db","text":"<p>\u95a2\u6570\u81ea\u4f53\u3092\u5909\u63db\u3059\u308b\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3\u95a2\u6570\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002</p>"},{"location":"scala/02-function-composition/#_9","title":"\u5f15\u6570\u306e\u9806\u5e8f\u3092\u53cd\u8ee2","text":"<pre><code>def flip[A, B, C](f: (A, B) =&gt; C): (B, A) =&gt; C =\n  (b: B, a: A) =&gt; f(a, b)\n\nval subtract = (a: Int, b: Int) =&gt; a - b\nflip(subtract)(3, 5)  // =&gt; 2  (5 - 3)\n</code></pre>"},{"location":"scala/02-function-composition/#_10","title":"\u30ab\u30ea\u30fc\u5316\u3068\u975e\u30ab\u30ea\u30fc\u5316","text":"<pre><code>def curry[A, B, C](f: (A, B) =&gt; C): A =&gt; B =&gt; C =\n  (a: A) =&gt; (b: B) =&gt; f(a, b)\n\ndef uncurry[A, B, C](f: A =&gt; B =&gt; C): (A, B) =&gt; C =\n  (a: A, b: B) =&gt; f(a)(b)\n\nval add = (a: Int, b: Int) =&gt; a + b\nval curriedAdd = curry(add)\nval add5 = curriedAdd(5)\nadd5(3)  // =&gt; 8\n</code></pre>"},{"location":"scala/02-function-composition/#complement","title":"\u88dc\u95a2\u6570\uff08complement\uff09","text":"<pre><code>def complementFn[A](pred: A =&gt; Boolean): A =&gt; Boolean =\n  (a: A) =&gt; !pred(a)\n\nval isEven = (x: Int) =&gt; x % 2 == 0\nval isOdd = complementFn(isEven)\nisOdd(3)  // =&gt; true\n</code></pre>"},{"location":"scala/02-function-composition/#8","title":"8. \u95a2\u6570\u5408\u6210\u306e\u30d1\u30bf\u30fc\u30f3","text":""},{"location":"scala/02-function-composition/#_11","title":"\u8ff0\u8a9e\u306e\u5408\u6210","text":"<pre><code>def composePredicates[A](preds: (A =&gt; Boolean)*): A =&gt; Boolean =\n  (x: A) =&gt; preds.forall(_(x))\n\ndef composePredicatesOr[A](preds: (A =&gt; Boolean)*): A =&gt; Boolean =\n  (x: A) =&gt; preds.exists(_(x))\n\n// \u6709\u52b9\u306a\u5e74\u9f62\u30c1\u30a7\u30c3\u30af\nval validAge: Int =&gt; Boolean =\n  composePredicates[Int](\n    _ &gt; 0,\n    _ &lt;= 150\n  )\n\nvalidAge(25)   // =&gt; true\nvalidAge(-1)   // =&gt; false\nvalidAge(200)  // =&gt; false\n\n// \u30d7\u30ec\u30df\u30a2\u30e0\u9867\u5ba2\u30c1\u30a7\u30c3\u30af\ncase class CustomerInfo(membership: String, purchaseCount: Int, totalSpent: Int)\n\nval premiumCustomer: CustomerInfo =&gt; Boolean =\n  composePredicatesOr[CustomerInfo](\n    _.membership == \"gold\",\n    _.purchaseCount &gt;= 100,\n    _.totalSpent &gt;= 100000\n  )\n\npremiumCustomer(CustomerInfo(\"gold\", 0, 0))           // =&gt; true\npremiumCustomer(CustomerInfo(\"bronze\", 100, 0))       // =&gt; true\npremiumCustomer(CustomerInfo(\"bronze\", 10, 1000))     // =&gt; false\n</code></pre>"},{"location":"scala/02-function-composition/#_12","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u95a2\u6570\u5408\u6210\u3068\u9ad8\u968e\u95a2\u6570\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>andThen/compose: \u95a2\u6570\u3092\u5408\u6210\u3057\u3066\u65b0\u3057\u3044\u95a2\u6570\u3092\u4f5c\u6210</li> <li>\u30ab\u30ea\u30fc\u5316: \u5f15\u6570\u3092\u90e8\u5206\u9069\u7528\u3057\u3066\u7279\u5316\u3057\u305f\u95a2\u6570\u3092\u4f5c\u6210</li> <li>\u30bf\u30d7\u30eb/\u30b1\u30fc\u30b9\u30af\u30e9\u30b9: \u8907\u6570\u306e\u95a2\u6570\u3092\u4e26\u5217\u9069\u7528\u3057\u3066\u7d50\u679c\u3092\u53d6\u5f97</li> <li>\u9ad8\u968e\u95a2\u6570: \u30ed\u30b0\u3001\u30ea\u30c8\u30e9\u30a4\u3001\u30e1\u30e2\u5316\u306a\u3069\u306e\u6a2a\u65ad\u7684\u95a2\u5fc3\u4e8b\u3092\u62bd\u8c61\u5316</li> <li>\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3: \u51e6\u7406\u306e\u6d41\u308c\u3092\u95a2\u6570\u306e\u30c1\u30a7\u30fc\u30f3\u3068\u3057\u3066\u8868\u73fe</li> <li>\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3: \u95a2\u6570\u5408\u6210\u306b\u3088\u308b\u67d4\u8edf\u306a\u691c\u8a3c\u30ed\u30b8\u30c3\u30af</li> <li>\u8ff0\u8a9e\u5408\u6210: AND/OR \u3067\u8907\u6570\u306e\u6761\u4ef6\u3092\u7d44\u307f\u5408\u308f\u305b</li> </ol> <p>\u3053\u308c\u3089\u306e\u30c6\u30af\u30cb\u30c3\u30af\u306b\u3088\u308a\u3001\u5c0f\u3055\u304f\u518d\u5229\u7528\u53ef\u80fd\u306a\u95a2\u6570\u304b\u3089\u8907\u96d1\u306a\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u3092\u69cb\u7bc9\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"scala/02-function-composition/#_13","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/scala/part1/src/main/scala/Composition.scala</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/scala/part1/src/test/scala/CompositionSpec.scala</code></li> </ul>"},{"location":"scala/02-function-composition/#_14","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001\u591a\u614b\u6027\u3068\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u30c8\u30ec\u30a4\u30c8\u3001\u578b\u30af\u30e9\u30b9\u3001\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3092\u6d3b\u7528\u3057\u305f\u67d4\u8edf\u306a\u8a2d\u8a08\u30d1\u30bf\u30fc\u30f3\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"scala/03-polymorphism/","title":"\u7b2c3\u7ae0: \u591a\u614b\u6027\u3068\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1","text":""},{"location":"scala/03-polymorphism/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u591a\u614b\u6027\uff08\u30dd\u30ea\u30e2\u30fc\u30d5\u30a3\u30ba\u30e0\uff09\u306f\u3001\u540c\u3058\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u7570\u306a\u308b\u632f\u308b\u821e\u3044\u3092\u5b9f\u73fe\u3059\u308b\u5f37\u529b\u306a\u6982\u5ff5\u3067\u3059\u3002Scala \u3067\u306f\u3001sealed trait\u3001\u30c8\u30ec\u30a4\u30c8\u3001\u578b\u30af\u30e9\u30b9\u3001\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3068\u3044\u3046\u8907\u6570\u306e\u30e1\u30ab\u30cb\u30ba\u30e0\u3067\u591a\u614b\u6027\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u3053\u308c\u3089\u306e\u30e1\u30ab\u30cb\u30ba\u30e0\u3092\u4f7f\u3044\u5206\u3051\u3066\u3001\u67d4\u8edf\u3067\u62e1\u5f35\u6027\u306e\u9ad8\u3044\u30b3\u30fc\u30c9\u3092\u66f8\u304f\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"scala/03-polymorphism/#1-sealed-trait","title":"1. Sealed Trait \u306b\u3088\u308b\u591a\u614b\u6027\uff08\u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b\uff09","text":"<p>Scala \u306e <code>sealed trait</code> \u306f\u3001\u6709\u9650\u306e\u578b\u306e\u30d0\u30ea\u30a8\u30fc\u30b7\u30e7\u30f3\u3092\u5b9a\u7fa9\u3059\u308b\u306e\u306b\u6700\u9069\u3067\u3059\u3002\u30b3\u30f3\u30d1\u30a4\u30e9\u304c\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u306e\u7db2\u7f85\u6027\u3092\u30c1\u30a7\u30c3\u30af\u3057\u3066\u304f\u308c\u307e\u3059\u3002</p>"},{"location":"scala/03-polymorphism/#_2","title":"\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9","text":"<pre><code>// \u56f3\u5f62\u3092\u8868\u3059 sealed trait\nsealed trait Shape\ncase class Rectangle(width: Double, height: Double) extends Shape\ncase class Circle(radius: Double) extends Shape\ncase class Triangle(base: Double, height: Double) extends Shape\n\n// \u56f3\u5f62\u306e\u9762\u7a4d\u3092\u8a08\u7b97\u3059\u308b\ndef calculateArea(shape: Shape): Double = shape match\n  case Rectangle(w, h) =&gt; w * h\n  case Circle(r)       =&gt; Math.PI * r * r\n  case Triangle(b, h)  =&gt; b * h / 2\n\n// \u4f7f\u7528\u4f8b\ncalculateArea(Rectangle(4, 5))  // =&gt; 20.0\ncalculateArea(Circle(3))        // =&gt; 28.27...\ncalculateArea(Triangle(6, 5))   // =&gt; 15.0\n</code></pre>"},{"location":"scala/03-polymorphism/#sealed-trait","title":"Sealed Trait \u306e\u5229\u70b9","text":"<ol> <li>\u7db2\u7f85\u6027\u30c1\u30a7\u30c3\u30af: \u30b3\u30f3\u30d1\u30a4\u30e9\u304c\u3059\u3079\u3066\u306e\u30b1\u30fc\u30b9\u304c\u30ab\u30d0\u30fc\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d</li> <li>\u578b\u5b89\u5168\u6027: \u4e0d\u6b63\u306a\u578b\u306e\u5024\u3092\u6e21\u305b\u306a\u3044</li> <li>\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0: \u5206\u5c90\u3092\u7c21\u6f54\u306b\u8a18\u8ff0\u53ef\u80fd</li> </ol>"},{"location":"scala/03-polymorphism/#2","title":"2. \u8907\u5408\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1","text":"<p>\u30bf\u30d7\u30eb\u3092\u4f7f\u3063\u305f\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3067\u3001\u8907\u6570\u306e\u5024\u306b\u57fa\u3065\u304f\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\u3092\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002</p> <pre><code>enum PaymentMethod:\n  case CreditCard, BankTransfer, Cash\n\nenum Currency:\n  case JPY, USD, EUR\n\ncase class Payment(method: PaymentMethod, currency: Currency, amount: Int)\ncase class PaymentResult(status: String, message: String, amount: Int, converted: Option[Int] = None)\n\ndef processPayment(payment: Payment): PaymentResult =\n  import PaymentMethod.*, Currency.*\n  (payment.method, payment.currency) match\n    case (CreditCard, JPY) =&gt;\n      PaymentResult(\"processed\", \"\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\uff08\u5186\uff09\u3067\u51e6\u7406\u3057\u307e\u3057\u305f\", payment.amount)\n    case (CreditCard, USD) =&gt;\n      PaymentResult(\"processed\", \"Credit card (USD) processed\", payment.amount, Some(payment.amount * 150))\n    case (BankTransfer, JPY) =&gt;\n      PaymentResult(\"pending\", \"\u9280\u884c\u632f\u8fbc\u3092\u53d7\u3051\u4ed8\u3051\u307e\u3057\u305f\", payment.amount)\n    case _ =&gt;\n      PaymentResult(\"error\", \"\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u652f\u6255\u3044\u65b9\u6cd5\u3067\u3059\", payment.amount)\n\n// \u4f7f\u7528\u4f8b\nprocessPayment(Payment(PaymentMethod.CreditCard, Currency.JPY, 1000))\n// =&gt; PaymentResult(\"processed\", \"\u30af\u30ec\u30b8\u30c3\u30c8\u30ab\u30fc\u30c9\uff08\u5186\uff09\u3067\u51e6\u7406\u3057\u307e\u3057\u305f\", 1000)\n</code></pre>"},{"location":"scala/03-polymorphism/#3_1","title":"3. \u968e\u5c64\u7684\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1\uff08\u7d99\u627f\u306b\u3088\u308b\uff09","text":"<p>Scala \u3067\u306f\u7d99\u627f\u3092\u4f7f\u3063\u3066\u578b\u306e\u968e\u5c64\u3092\u5b9a\u7fa9\u3057\u3001\u5404\u578b\u306b\u56fa\u6709\u306e\u632f\u308b\u821e\u3044\u3092\u6301\u305f\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</p> <pre><code>sealed trait Account:\n  def balance: Int\n  def interestRate: Double\n\ncase class SavingsAccount(balance: Int) extends Account:\n  val interestRate = 0.02\n\ncase class PremiumSavingsAccount(balance: Int) extends Account:\n  val interestRate = 0.05\n\ncase class CheckingAccount(balance: Int) extends Account:\n  val interestRate = 0.001\n\ndef calculateInterest(account: Account): Double =\n  account.balance * account.interestRate\n\n// \u4f7f\u7528\u4f8b\ncalculateInterest(SavingsAccount(10000))        // =&gt; 200.0\ncalculateInterest(PremiumSavingsAccount(10000)) // =&gt; 500.0\ncalculateInterest(CheckingAccount(10000))       // =&gt; 10.0\n</code></pre>"},{"location":"scala/03-polymorphism/#4-protocols","title":"4. \u30c8\u30ec\u30a4\u30c8\uff08Protocols \u306b\u76f8\u5f53\uff09","text":"<p>\u30c8\u30ec\u30a4\u30c8\u306f\u3001\u7279\u5b9a\u306e\u64cd\u4f5c\u30bb\u30c3\u30c8\u3092\u5b9a\u7fa9\u3059\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u3059\u3002Java \u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306b\u4f3c\u3066\u3044\u307e\u3059\u304c\u3001\u30c7\u30d5\u30a9\u30eb\u30c8\u5b9f\u88c5\u3092\u6301\u3066\u307e\u3059\u3002</p>"},{"location":"scala/03-polymorphism/#_3","title":"\u30c8\u30ec\u30a4\u30c8\u306e\u5b9a\u7fa9","text":"<pre><code>trait Drawable:\n  def draw: String\n  def boundingBox: BoundingBox\n\ncase class BoundingBox(x: Double, y: Double, width: Double, height: Double)\n\ntrait Transformable[T]:\n  def translate(dx: Double, dy: Double): T\n  def scale(factor: Double): T\n  def rotate(angle: Double): T\n</code></pre>"},{"location":"scala/03-polymorphism/#_4","title":"\u30c8\u30ec\u30a4\u30c8\u306e\u5229\u70b9","text":"<ol> <li>\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9: \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3088\u308a\u9ad8\u901f\u306a\u578b\u30d9\u30fc\u30b9\u306e\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1</li> <li>\u660e\u78ba\u306a\u30b3\u30f3\u30c8\u30e9\u30af\u30c8: \u5b9f\u88c5\u3059\u3079\u304d\u30e1\u30bd\u30c3\u30c9\u304c\u660e\u793a\u7684</li> <li>\u30df\u30c3\u30af\u30b9\u30a4\u30f3: \u8907\u6570\u306e\u30c8\u30ec\u30a4\u30c8\u3092\u7d44\u307f\u5408\u308f\u305b\u53ef\u80fd</li> </ol>"},{"location":"scala/03-polymorphism/#5","title":"5. \u30c8\u30ec\u30a4\u30c8\u3092\u5b9f\u88c5\u3059\u308b\u30b1\u30fc\u30b9\u30af\u30e9\u30b9","text":"<pre><code>case class DrawableRectangle(x: Double, y: Double, width: Double, height: Double)\n    extends Drawable with Transformable[DrawableRectangle]:\n\n  def draw: String = s\"Rectangle at ($x,$y) with size ${width}x$height\"\n\n  def boundingBox: BoundingBox = BoundingBox(x, y, width, height)\n\n  def translate(dx: Double, dy: Double): DrawableRectangle =\n    copy(x = x + dx, y = y + dy)\n\n  def scale(factor: Double): DrawableRectangle =\n    copy(width = width * factor, height = height * factor)\n\n  def rotate(angle: Double): DrawableRectangle = this\n\ncase class DrawableCircle(x: Double, y: Double, radius: Double)\n    extends Drawable with Transformable[DrawableCircle]:\n\n  def draw: String = s\"Circle at ($x,$y) with radius $radius\"\n\n  def boundingBox: BoundingBox =\n    BoundingBox(x - radius, y - radius, radius * 2, radius * 2)\n\n  def translate(dx: Double, dy: Double): DrawableCircle =\n    copy(x = x + dx, y = y + dy)\n\n  def scale(factor: Double): DrawableCircle =\n    copy(radius = radius * factor)\n\n  def rotate(angle: Double): DrawableCircle = this\n\n// \u4f7f\u7528\u4f8b\nval rect = DrawableRectangle(10, 20, 100, 50)\nrect.draw           // =&gt; \"Rectangle at (10.0,20.0) with size 100.0x50.0\"\nrect.translate(5, 10) // =&gt; DrawableRectangle(15.0, 30.0, 100.0, 50.0)\n\nval circle = DrawableCircle(50, 50, 25)\ncircle.boundingBox  // =&gt; BoundingBox(25.0, 25.0, 50.0, 50.0)\n</code></pre>"},{"location":"scala/03-polymorphism/#6","title":"6. \u578b\u30af\u30e9\u30b9\uff08\u65e2\u5b58\u578b\u3078\u306e\u62e1\u5f35\uff09","text":"<p>\u578b\u30af\u30e9\u30b9\u306f\u3001\u65e2\u5b58\u306e\u578b\u306b\u5f8c\u304b\u3089\u632f\u308b\u821e\u3044\u3092\u8ffd\u52a0\u3067\u304d\u308b\u5f37\u529b\u306a\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002Clojure \u306e <code>extend-protocol</code> \u306b\u76f8\u5f53\u3057\u307e\u3059\u3002</p> <pre><code>// \u578b\u30af\u30e9\u30b9\u306e\u5b9a\u7fa9\ntrait Stringable[A]:\n  def stringify(a: A): String\n\nobject Stringable:\n  def apply[A](using s: Stringable[A]): Stringable[A] = s\n\n  given Stringable[Map[String, Any]] with\n    def stringify(m: Map[String, Any]): String =\n      \"{\" + m.map((k, v) =&gt; s\"$k: $v\").mkString(\", \") + \"}\"\n\n  given Stringable[List[Any]] with\n    def stringify(l: List[Any]): String =\n      \"[\" + l.mkString(\", \") + \"]\"\n\n  given Stringable[String] with\n    def stringify(s: String): String = s\n\n  given Stringable[Int] with\n    def stringify(i: Int): String = i.toString\n\n  given optionStringable[A](using s: Stringable[A]): Stringable[Option[A]] with\n    def stringify(opt: Option[A]): String = opt match\n      case Some(a) =&gt; s.stringify(a)\n      case None    =&gt; \"nil\"\n\n// \u62e1\u5f35\u30e1\u30bd\u30c3\u30c9\nextension [A](a: A)\n  def toCustomString(using s: Stringable[A]): String = s.stringify(a)\n\n// \u4f7f\u7528\u4f8b\nval map: Map[String, Any] = Map(\"name\" -&gt; \"\u7530\u4e2d\", \"age\" -&gt; 30)\nmap.toCustomString  // =&gt; \"{name: \u7530\u4e2d, age: 30}\"\n\nval list: List[Any] = List(1, 2, 3)\nlist.toCustomString // =&gt; \"[1, 2, 3]\"\n\n(Some(42): Option[Int]).toCustomString // =&gt; \"42\"\n(None: Option[Int]).toCustomString     // =&gt; \"nil\"\n</code></pre>"},{"location":"scala/03-polymorphism/#7","title":"7. \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u30d1\u30bf\u30fc\u30f3","text":"<p>\u30c8\u30ec\u30a4\u30c8\u3092\u4f7f\u3063\u3066\u3001\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u7ba1\u7406\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p> <pre><code>trait Lifecycle[T]:\n  def start: T\n  def stop: T\n\ncase class DatabaseConnection(host: String, port: Int, connected: Boolean = false)\n    extends Lifecycle[DatabaseConnection]:\n\n  def start: DatabaseConnection =\n    println(s\"\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u63a5\u7d9a\u4e2d: $host : $port\")\n    copy(connected = true)\n\n  def stop: DatabaseConnection =\n    println(\"\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\u3092\u5207\u65ad\u4e2d\")\n    copy(connected = false)\n\ncase class WebServer(port: Int, db: DatabaseConnection, running: Boolean = false)\n    extends Lifecycle[WebServer]:\n\n  def start: WebServer =\n    println(s\"Web\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u4e2d \u30dd\u30fc\u30c8: $port\")\n    val startedDb = db.start\n    copy(db = startedDb, running = true)\n\n  def stop: WebServer =\n    println(\"Web\u30b5\u30fc\u30d0\u30fc\u3092\u505c\u6b62\u4e2d\")\n    val stoppedDb = db.stop\n    copy(db = stoppedDb, running = false)\n\n// \u4f7f\u7528\u4f8b\nval db = DatabaseConnection(\"localhost\", 5432)\nval server = WebServer(8080, db)\n\nval startedServer = server.start\n// \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u63a5\u7d9a\u4e2d: localhost : 5432\n// Web\u30b5\u30fc\u30d0\u30fc\u3092\u8d77\u52d5\u4e2d \u30dd\u30fc\u30c8: 8080\n\nval stoppedServer = startedServer.stop\n// Web\u30b5\u30fc\u30d0\u30fc\u3092\u505c\u6b62\u4e2d\n// \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u63a5\u7d9a\u3092\u5207\u65ad\u4e2d\n</code></pre>"},{"location":"scala/03-polymorphism/#8-strategy","title":"8. \u6761\u4ef6\u5206\u5c90\u306e\u7f6e\u304d\u63db\u3048\uff08Strategy \u30d1\u30bf\u30fc\u30f3\uff09","text":"<p>\u591a\u614b\u6027\u3092\u4f7f\u3063\u3066\u3001switch/case \u6587\u306b\u3088\u308b\u578b\u5224\u5b9a\u3092\u6392\u9664\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"scala/03-polymorphism/#before","title":"Before\uff08\u6761\u4ef6\u5206\u5c90\uff09","text":"<pre><code>// \u60aa\u3044\u4f8b\uff1a\u578b\u306b\u3088\u308b\u6761\u4ef6\u5206\u5c90\ndef sendNotificationBad(notificationType: String, message: String, opts: Map[String, String]) =\n  notificationType match\n    case \"email\" =&gt; Map(\"type\" -&gt; \"email\", \"to\" -&gt; opts(\"to\"), \"body\" -&gt; message)\n    case \"sms\"   =&gt; Map(\"type\" -&gt; \"sms\", \"to\" -&gt; opts(\"phone\"), \"body\" -&gt; message.take(160))\n    case \"push\"  =&gt; Map(\"type\" -&gt; \"push\", \"device\" -&gt; opts(\"device\"), \"body\" -&gt; message)\n    case _       =&gt; throw new IllegalArgumentException(\"\u672a\u77e5\u306e\u901a\u77e5\u30bf\u30a4\u30d7\")\n</code></pre>"},{"location":"scala/03-polymorphism/#after","title":"After\uff08\u591a\u614b\u6027\uff09","text":"<pre><code>trait NotificationSender:\n  def sendNotification(message: String): NotificationResult\n  def deliveryTime: String\n\ncase class NotificationResult(\n  notificationType: String,\n  to: String,\n  body: String,\n  status: String,\n  subject: Option[String] = None\n)\n\ncase class EmailNotification(to: String, subject: String = \"\u901a\u77e5\") extends NotificationSender:\n  def sendNotification(message: String): NotificationResult =\n    NotificationResult(\"email\", to, message, \"sent\", Some(subject))\n  def deliveryTime: String = \"1-2\u5206\"\n\ncase class SMSNotification(phoneNumber: String) extends NotificationSender:\n  def sendNotification(message: String): NotificationResult =\n    val truncated = if message.length &gt; 160 then message.take(157) else message\n    NotificationResult(\"sms\", phoneNumber, truncated, \"sent\")\n  def deliveryTime: String = \"\u6570\u79d2\"\n\ncase class PushNotification(deviceToken: String) extends NotificationSender:\n  def sendNotification(message: String): NotificationResult =\n    NotificationResult(\"push\", deviceToken, message, \"sent\")\n  def deliveryTime: String = \"\u5373\u6642\"\n\n// \u30d5\u30a1\u30af\u30c8\u30ea\u95a2\u6570\ndef createNotification(notificationType: String, opts: Map[String, String]): NotificationSender =\n  notificationType match\n    case \"email\" =&gt; EmailNotification(opts.getOrElse(\"to\", \"\"), opts.getOrElse(\"subject\", \"\u901a\u77e5\"))\n    case \"sms\"   =&gt; SMSNotification(opts.getOrElse(\"phone\", \"\"))\n    case \"push\"  =&gt; PushNotification(opts.getOrElse(\"device\", \"\"))\n    case _       =&gt; throw new IllegalArgumentException(s\"\u672a\u77e5\u306e\u901a\u77e5\u30bf\u30a4\u30d7: $notificationType\")\n\n// \u4f7f\u7528\u4f8b\nval email = createNotification(\"email\", Map(\"to\" -&gt; \"user@example.com\"))\nemail.sendNotification(\"\u91cd\u8981\u306a\u304a\u77e5\u3089\u305b\")\n// =&gt; NotificationResult(\"email\", \"user@example.com\", \"\u91cd\u8981\u306a\u304a\u77e5\u3089\u305b\", \"sent\", Some(\"\u901a\u77e5\"))\n</code></pre>"},{"location":"scala/03-polymorphism/#9","title":"9. \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3068\u30c8\u30ec\u30a4\u30c8\u306e\u4f7f\u3044\u5206\u3051","text":"\u7279\u5fb4 \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0 \u30c8\u30ec\u30a4\u30c8 \u578b\u30af\u30e9\u30b9 \u30c7\u30a3\u30b9\u30d1\u30c3\u30c1 \u5024\u306b\u57fa\u3065\u304f \u578b\u306b\u57fa\u3065\u304f \u578b\u306b\u57fa\u3065\u304f \u62e1\u5f35\u6027 \u30af\u30ed\u30fc\u30ba\u30c9 \u30aa\u30fc\u30d7\u30f3 \u975e\u5e38\u306b\u30aa\u30fc\u30d7\u30f3 \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9 \u826f\u3044 \u6700\u826f \u826f\u3044 \u7528\u9014 ADT\u3001\u6709\u9650\u306e\u578b \u5171\u901a\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9 \u65e2\u5b58\u578b\u3078\u306e\u62e1\u5f35"},{"location":"scala/03-polymorphism/#_5","title":"\u4f7f\u3044\u5206\u3051\u306e\u6307\u91dd","text":"<ul> <li>Sealed Trait + \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0: \u6709\u9650\u3067\u56fa\u5b9a\u3055\u308c\u305f\u578b\u306e\u30d0\u30ea\u30a8\u30fc\u30b7\u30e7\u30f3</li> <li>\u30c8\u30ec\u30a4\u30c8: \u65b0\u3057\u3044\u578b\u304c\u8ffd\u52a0\u3055\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u5834\u5408</li> <li>\u578b\u30af\u30e9\u30b9: \u65e2\u5b58\u306e\u578b\uff08\u6a19\u6e96\u30e9\u30a4\u30d6\u30e9\u30ea\u306a\u3069\uff09\u306b\u632f\u308b\u821e\u3044\u3092\u8ffd\u52a0\u3057\u305f\u3044\u5834\u5408</li> </ul>"},{"location":"scala/03-polymorphism/#_6","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Scala \u306b\u304a\u3051\u308b\u591a\u614b\u6027\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>Sealed Trait: \u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b\u306b\u3088\u308b\u6709\u9650\u306e\u578b\u30d0\u30ea\u30a8\u30fc\u30b7\u30e7\u30f3</li> <li>\u8907\u5408\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1: \u30bf\u30d7\u30eb\u306b\u3088\u308b\u8907\u6570\u306e\u5024\u306b\u57fa\u3065\u304f\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0</li> <li>\u968e\u5c64\u7684\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1: \u7d99\u627f\u3092\u4f7f\u3063\u305f\u578b\u968e\u5c64</li> <li>\u30c8\u30ec\u30a4\u30c8: \u5171\u901a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306e\u5b9a\u7fa9\u3068\u30df\u30c3\u30af\u30b9\u30a4\u30f3</li> <li>\u578b\u30af\u30e9\u30b9: \u65e2\u5b58\u578b\u3078\u306e\u632f\u308b\u821e\u3044\u306e\u8ffd\u52a0</li> <li>\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u30d1\u30bf\u30fc\u30f3: \u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u7ba1\u7406</li> <li>\u6761\u4ef6\u5206\u5c90\u306e\u7f6e\u304d\u63db\u3048: Strategy \u30d1\u30bf\u30fc\u30f3</li> </ol> <p>\u3053\u308c\u3089\u306e\u30e1\u30ab\u30cb\u30ba\u30e0\u3092\u9069\u5207\u306b\u4f7f\u3044\u5206\u3051\u308b\u3053\u3068\u3067\u3001\u62e1\u5f35\u6027\u304c\u9ad8\u304f\u4fdd\u5b88\u3057\u3084\u3059\u3044\u30b3\u30fc\u30c9\u3092\u5b9f\u73fe\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"scala/03-polymorphism/#_7","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/scala/part1/src/main/scala/Polymorphism.scala</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/scala/part1/src/test/scala/PolymorphismSpec.scala</code></li> </ul>"},{"location":"scala/03-polymorphism/#_8","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u304b\u3089\u7b2c2\u90e8\u300c\u4ed5\u69d8\u3068\u30c6\u30b9\u30c8\u300d\u306b\u5165\u308a\u307e\u3059\u3002Scala \u306e\u30c7\u30fc\u30bf\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3068\u4ed5\u69d8\u5b9a\u7fa9\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"scala/04-data-validation/","title":"\u7b2c4\u7ae0: \u30c7\u30fc\u30bf\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3","text":""},{"location":"scala/04-data-validation/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Scala \u3067\u306f\u3001\u578b\u30b7\u30b9\u30c6\u30e0\u3068\u30b9\u30de\u30fc\u30c8\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u3053\u3068\u3067\u3001\u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u3068\u5b9f\u884c\u6642\u306e\u4e21\u65b9\u3067\u30c7\u30fc\u30bf\u306e\u6574\u5408\u6027\u3092\u4fdd\u8a3c\u3067\u304d\u307e\u3059\u3002\u672c\u7ae0\u3067\u306f\u3001Either\u3001Validated \u30d1\u30bf\u30fc\u30f3\u3001Opaque Type \u3092\u4f7f\u3063\u305f\u30c7\u30fc\u30bf\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u306e\u5b9f\u73fe\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"scala/04-data-validation/#1-either","title":"1. \u57fa\u672c\u7684\u306a\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\uff08Either \u3092\u4f7f\u7528\uff09","text":""},{"location":"scala/04-data-validation/#either","title":"Either \u306b\u3088\u308b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3","text":"<p><code>Either[L, R]</code> \u306f\u3001\u6210\u529f\u6642\u306b <code>Right</code>\u3001\u5931\u6557\u6642\u306b <code>Left</code> \u3092\u8fd4\u3059\u578b\u3067\u3059\u3002\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u306b\u6700\u9069\u3067\u3059\u3002</p> <pre><code>type ValidationResult[A] = Either[List[String], A]\n\ndef validateName(name: String): ValidationResult[String] =\n  if name.isEmpty then Left(List(\"\u540d\u524d\u306f\u7a7a\u306b\u3067\u304d\u307e\u305b\u3093\"))\n  else if name.length &gt; 100 then Left(List(\"\u540d\u524d\u306f100\u6587\u5b57\u4ee5\u5185\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"))\n  else Right(name)\n\ndef validateAge(age: Int): ValidationResult[Int] =\n  if age &lt; 0 then Left(List(\"\u5e74\u9f62\u306f0\u4ee5\u4e0a\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"))\n  else if age &gt; 150 then Left(List(\"\u5e74\u9f62\u306f150\u4ee5\u4e0b\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"))\n  else Right(age)\n\ndef validateEmail(email: String): ValidationResult[String] =\n  val emailRegex = \".+@.+\\\\..+\".r\n  if emailRegex.matches(email) then Right(email)\n  else Left(List(\"\u7121\u52b9\u306a\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u5f62\u5f0f\u3067\u3059\"))\n\n// \u4f7f\u7528\u4f8b\nvalidateName(\"\u7530\u4e2d\u592a\u90ce\")  // =&gt; Right(\"\u7530\u4e2d\u592a\u90ce\")\nvalidateName(\"\")          // =&gt; Left(List(\"\u540d\u524d\u306f\u7a7a\u306b\u3067\u304d\u307e\u305b\u3093\"))\nvalidateAge(25)           // =&gt; Right(25)\nvalidateAge(-1)           // =&gt; Left(List(\"\u5e74\u9f62\u306f0\u4ee5\u4e0a\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"))\n</code></pre>"},{"location":"scala/04-data-validation/#2","title":"2. \u5217\u6319\u578b\u3068\u30b9\u30de\u30fc\u30c8\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf","text":""},{"location":"scala/04-data-validation/#enum","title":"Enum \u306b\u3088\u308b\u5217\u6319\u578b","text":"<pre><code>enum Membership:\n  case Bronze, Silver, Gold, Platinum\n\nobject Membership:\n  def fromString(s: String): ValidationResult[Membership] =\n    s.toLowerCase match\n      case \"bronze\"   =&gt; Right(Bronze)\n      case \"silver\"   =&gt; Right(Silver)\n      case \"gold\"     =&gt; Right(Gold)\n      case \"platinum\" =&gt; Right(Platinum)\n      case _          =&gt; Left(List(s\"\u7121\u52b9\u306a\u4f1a\u54e1\u7a2e\u5225: $s\"))\n\nenum Status:\n  case Active, Inactive, Suspended\n</code></pre>"},{"location":"scala/04-data-validation/#3-validated","title":"3. Validated \u30d1\u30bf\u30fc\u30f3\uff08\u30a8\u30e9\u30fc\u84c4\u7a4d\uff09","text":"<p>Either \u306f\u6700\u521d\u306e\u30a8\u30e9\u30fc\u3067\u505c\u6b62\u3057\u307e\u3059\u304c\u3001\u3059\u3079\u3066\u306e\u30a8\u30e9\u30fc\u3092\u53ce\u96c6\u3057\u305f\u3044\u5834\u5408\u306f Validated \u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002</p> <pre><code>enum Validated[+E, +A]:\n  case Valid(value: A)\n  case Invalid(errors: List[E])\n\n  def map[B](f: A =&gt; B): Validated[E, B] = this match\n    case Valid(a)      =&gt; Valid(f(a))\n    case Invalid(errs) =&gt; Invalid(errs)\n\n  def flatMap[EE &gt;: E, B](f: A =&gt; Validated[EE, B]): Validated[EE, B] = this match\n    case Valid(a)      =&gt; f(a)\n    case Invalid(errs) =&gt; Invalid(errs)\n\n  def isValid: Boolean = this match\n    case Valid(_)   =&gt; true\n    case Invalid(_) =&gt; false\n\n  def toEither: Either[List[E], A] = this match\n    case Valid(a)      =&gt; Right(a)\n    case Invalid(errs) =&gt; Left(errs)\n\nobject Validated:\n  def valid[E, A](a: A): Validated[E, A] = Valid(a)\n  def invalid[E, A](errors: List[E]): Validated[E, A] = Invalid(errors)\n\n  // 2\u3064\u306e Validated \u3092\u7d50\u5408\uff08\u30a8\u30e9\u30fc\u84c4\u7a4d\uff09\n  def combine[E, A, B, C](va: Validated[E, A], vb: Validated[E, B])(f: (A, B) =&gt; C): Validated[E, C] =\n    (va, vb) match\n      case (Valid(a), Valid(b))       =&gt; Valid(f(a, b))\n      case (Invalid(e1), Invalid(e2)) =&gt; Invalid(e1 ++ e2)  // \u30a8\u30e9\u30fc\u3092\u84c4\u7a4d\uff01\n      case (Invalid(e), _)            =&gt; Invalid(e)\n      case (_, Invalid(e))            =&gt; Invalid(e)\n</code></pre>"},{"location":"scala/04-data-validation/#_2","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>val result = Validated.combine(\n  Validated.invalid[String, Int](List(\"error1\")),\n  Validated.invalid[String, Int](List(\"error2\"))\n)(_ + _)\n// =&gt; Invalid(List(\"error1\", \"error2\"))  // \u4e21\u65b9\u306e\u30a8\u30e9\u30fc\u304c\u53ce\u96c6\u3055\u308c\u308b\n</code></pre>"},{"location":"scala/04-data-validation/#4-opaque-type","title":"4. Opaque Type \u306b\u3088\u308b\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30eb","text":"<p>Opaque Type \u3092\u4f7f\u3046\u3068\u3001\u5b9f\u884c\u6642\u306e\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u306a\u3057\u306b\u578b\u5b89\u5168\u306a\u30c9\u30e1\u30a4\u30f3\u30d7\u30ea\u30df\u30c6\u30a3\u30d6\u3092\u4f5c\u6210\u3067\u304d\u307e\u3059\u3002</p> <pre><code>// \u5546\u54c1ID\uff08\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u6e08\u307f\uff09\nopaque type ProductId = String\n\nobject ProductId:\n  private val pattern = \"PROD-\\\\d{5}\".r\n\n  def apply(id: String): Validated[String, ProductId] =\n    if pattern.matches(id) then Validated.valid(id)\n    else Validated.invalid(List(s\"\u7121\u52b9\u306a\u5546\u54c1ID\u5f62\u5f0f: $id (PROD-XXXXX\u306e\u5f62\u5f0f\u304c\u5fc5\u8981)\"))\n\n  def unsafe(id: String): ProductId = id  // \u30c6\u30b9\u30c8\u7528\n\n  extension (id: ProductId)\n    def value: String = id\n\n// \u4fa1\u683c\uff08\u6b63\u306e\u6570\uff09\nopaque type Price = BigDecimal\n\nobject Price:\n  def apply(amount: BigDecimal): Validated[String, Price] =\n    if amount &lt;= 0 then Validated.invalid(List(\"\u4fa1\u683c\u306f\u6b63\u306e\u6570\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"))\n    else Validated.valid(amount)\n\n  def unsafe(amount: BigDecimal): Price = amount\n\n  extension (price: Price)\n    def value: BigDecimal = price\n\n// \u6570\u91cf\uff08\u6b63\u306e\u6574\u6570\uff09\nopaque type Quantity = Int\n\nobject Quantity:\n  def apply(qty: Int): Validated[String, Quantity] =\n    if qty &lt;= 0 then Validated.invalid(List(\"\u6570\u91cf\u306f\u6b63\u306e\u6574\u6570\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"))\n    else Validated.valid(qty)\n\n  def unsafe(qty: Int): Quantity = qty\n\n  extension (qty: Quantity)\n    def value: Int = qty\n</code></pre>"},{"location":"scala/04-data-validation/#_3","title":"\u5546\u54c1\u30e2\u30c7\u30eb","text":"<pre><code>case class Product(\n  id: ProductId,\n  name: ProductName,\n  price: Price,\n  description: Option[String] = None,\n  category: Option[String] = None\n)\n\nobject Product:\n  def create(\n    id: String,\n    name: String,\n    price: BigDecimal,\n    description: Option[String] = None,\n    category: Option[String] = None\n  ): Validated[String, Product] =\n    Validated.combine3(\n      ProductId(id),\n      ProductName(name),\n      Price(price)\n    )((pid, pname, pprice) =&gt; Product(pid, pname, pprice, description, category))\n\n// \u4f7f\u7528\u4f8b\nProduct.create(\"PROD-00001\", \"\u30c6\u30b9\u30c8\u5546\u54c1\", BigDecimal(1000))\n// =&gt; Valid(Product(...))\n\nProduct.create(\"INVALID\", \"\", BigDecimal(-100))\n// =&gt; Invalid(List(\"\u7121\u52b9\u306a\u5546\u54c1ID\u5f62\u5f0f...\", \"\u5546\u54c1\u540d\u306f\u7a7a\u306b\u3067\u304d\u307e\u305b\u3093\", \"\u4fa1\u683c\u306f\u6b63\u306e\u6570\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"))\n</code></pre>"},{"location":"scala/04-data-validation/#5","title":"5. \u6ce8\u6587\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30eb","text":"<pre><code>opaque type OrderId = String\n\nobject OrderId:\n  private val pattern = \"ORD-\\\\d{8}\".r\n\n  def apply(id: String): Validated[String, OrderId] =\n    if pattern.matches(id) then Validated.valid(id)\n    else Validated.invalid(List(s\"\u7121\u52b9\u306a\u6ce8\u6587ID\u5f62\u5f0f: $id\"))\n\nopaque type CustomerId = String\n\nobject CustomerId:\n  private val pattern = \"CUST-\\\\d{6}\".r\n\n  def apply(id: String): Validated[String, CustomerId] =\n    if pattern.matches(id) then Validated.valid(id)\n    else Validated.invalid(List(s\"\u7121\u52b9\u306a\u9867\u5ba2ID\u5f62\u5f0f: $id\"))\n\ncase class OrderItem(\n  productId: ProductId,\n  quantity: Quantity,\n  price: Price\n):\n  def total: BigDecimal = Price.value(price) * Quantity.value(quantity)\n\nobject OrderItem:\n  def create(productId: String, quantity: Int, price: BigDecimal): Validated[String, OrderItem] =\n    Validated.combine3(\n      ProductId(productId),\n      Quantity(quantity),\n      Price(price)\n    )(OrderItem.apply)\n\ncase class Order(\n  orderId: OrderId,\n  customerId: CustomerId,\n  items: List[OrderItem],\n  orderDate: java.time.LocalDate,\n  total: Option[BigDecimal] = None,\n  status: Option[Status] = None\n):\n  def calculateTotal: BigDecimal = items.map(_.total).sum\n</code></pre>"},{"location":"scala/04-data-validation/#6-adt","title":"6. \u6761\u4ef6\u4ed8\u304d\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\uff08ADT\uff09","text":"<p>\u30c7\u30fc\u30bf\u306e\u7a2e\u985e\u306b\u5fdc\u3058\u3066\u7570\u306a\u308b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30eb\u3092\u9069\u7528\u3059\u308b\u5834\u5408\u306f\u3001ADT\uff08\u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b\uff09\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002</p> <pre><code>enum NotificationType:\n  case Email, SMS, Push\n\nsealed trait Notification:\n  def body: String\n\ncase class EmailNotification(to: String, subject: String, body: String) extends Notification\ncase class SMSNotification(phoneNumber: String, body: String) extends Notification\ncase class PushNotification(deviceToken: String, body: String) extends Notification\n\nobject Notification:\n  private val emailPattern = \".+@.+\\\\..+\".r\n  private val phonePattern = \"\\\\d{2,4}-\\\\d{2,4}-\\\\d{4}\".r\n\n  def createEmail(to: String, subject: String, body: String): Validated[String, EmailNotification] =\n    if !emailPattern.matches(to) then Validated.invalid(List(\"\u7121\u52b9\u306a\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u5f62\u5f0f\u3067\u3059\"))\n    else if subject.isEmpty then Validated.invalid(List(\"\u4ef6\u540d\u306f\u7a7a\u306b\u3067\u304d\u307e\u305b\u3093\"))\n    else if body.isEmpty then Validated.invalid(List(\"\u672c\u6587\u306f\u7a7a\u306b\u3067\u304d\u307e\u305b\u3093\"))\n    else Validated.valid(EmailNotification(to, subject, body))\n\n  def createSMS(phoneNumber: String, body: String): Validated[String, SMSNotification] =\n    if !phonePattern.matches(phoneNumber) then Validated.invalid(List(\"\u7121\u52b9\u306a\u96fb\u8a71\u756a\u53f7\u5f62\u5f0f\u3067\u3059\"))\n    else if body.isEmpty then Validated.invalid(List(\"\u672c\u6587\u306f\u7a7a\u306b\u3067\u304d\u307e\u305b\u3093\"))\n    else Validated.valid(SMSNotification(phoneNumber, body))\n\n  def createPush(deviceToken: String, body: String): Validated[String, PushNotification] =\n    if deviceToken.isEmpty then Validated.invalid(List(\"\u30c7\u30d0\u30a4\u30b9\u30c8\u30fc\u30af\u30f3\u306f\u7a7a\u306b\u3067\u304d\u307e\u305b\u3093\"))\n    else if body.isEmpty then Validated.invalid(List(\"\u672c\u6587\u306f\u7a7a\u306b\u3067\u304d\u307e\u305b\u3093\"))\n    else Validated.valid(PushNotification(deviceToken, body))\n\n// \u4f7f\u7528\u4f8b\nNotification.createEmail(\"test@example.com\", \"\u30c6\u30b9\u30c8\", \"\u672c\u6587\")\n// =&gt; Valid(EmailNotification(...))\n\nNotification.createSMS(\"090-1234-5678\", \"\u672c\u6587\")\n// =&gt; Valid(SMSNotification(...))\n</code></pre>"},{"location":"scala/04-data-validation/#7","title":"7. \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30e6\u30fc\u30c6\u30a3\u30ea\u30c6\u30a3","text":""},{"location":"scala/04-data-validation/#_4","title":"\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u7d50\u679c\u306e\u69cb\u9020\u5316","text":"<pre><code>case class ValidationResponse[A](valid: Boolean, data: Option[A], errors: List[String])\n\ndef validatePerson(name: String, age: Int): ValidationResponse[Person] =\n  val nameV = if name.isEmpty then Validated.invalid[String, String](List(\"\u540d\u524d\u306f\u7a7a\u306b\u3067\u304d\u307e\u305b\u3093\"))\n    else Validated.valid[String, String](name)\n  val ageV = if age &lt; 0 then Validated.invalid[String, Int](List(\"\u5e74\u9f62\u306f0\u4ee5\u4e0a\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"))\n    else Validated.valid[String, Int](age)\n\n  val validated = Validated.combine(nameV, ageV)((n, a) =&gt; Person(n, a))\n\n  validated match\n    case Validated.Valid(p)   =&gt; ValidationResponse(true, Some(p), List.empty)\n    case Validated.Invalid(e) =&gt; ValidationResponse(false, None, e)\n\n// \u4f7f\u7528\u4f8b\nvalidatePerson(\"\u7530\u4e2d\", 30)\n// =&gt; ValidationResponse(true, Some(Person(\"\u7530\u4e2d\", 30)), List())\n\nvalidatePerson(\"\", -1)\n// =&gt; ValidationResponse(false, None, List(\"\u540d\u524d\u306f\u7a7a\u306b\u3067\u304d\u307e\u305b\u3093\", \"\u5e74\u9f62\u306f0\u4ee5\u4e0a\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\"))\n</code></pre>"},{"location":"scala/04-data-validation/#_5","title":"\u4f8b\u5916\u3092\u30b9\u30ed\u30fc\u3059\u308b\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3","text":"<pre><code>def conformOrThrow[A](validated: Validated[String, A]): A =\n  validated match\n    case Validated.Valid(a)      =&gt; a\n    case Validated.Invalid(errs) =&gt; throw new IllegalArgumentException(s\"Validation failed: ${errs.mkString(\", \")}\")\n</code></pre>"},{"location":"scala/04-data-validation/#8","title":"8. \u8a08\u7b97\u95a2\u6570","text":"<pre><code>def calculateItemTotal(item: OrderItem): BigDecimal =\n  Price.value(item.price) * Quantity.value(item.quantity)\n\ndef calculateOrderTotal(order: Order): BigDecimal =\n  order.items.map(calculateItemTotal).sum\n\ndef applyDiscount(total: BigDecimal, discountRate: Double): Either[String, BigDecimal] =\n  if discountRate &lt; 0 || discountRate &gt; 1 then\n    Left(\"\u5272\u5f15\u7387\u306f0\u304b\u30891\u306e\u9593\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\")\n  else\n    Right(total * (1 - discountRate))\n\ndef sumPrices(prices: BigDecimal*): BigDecimal =\n  prices.sum\n</code></pre>"},{"location":"scala/04-data-validation/#clojure-spec","title":"Clojure Spec \u3068\u306e\u6bd4\u8f03","text":"\u7279\u5fb4 Clojure Spec Scala \u691c\u8a3c\u30bf\u30a4\u30df\u30f3\u30b0 \u5b9f\u884c\u6642 \u30b3\u30f3\u30d1\u30a4\u30eb\u6642 + \u5b9f\u884c\u6642 \u30a8\u30e9\u30fc\u84c4\u7a4d explain-data Validated \u30d1\u30bf\u30fc\u30f3 \u578b\u5b89\u5168\u6027 \u52d5\u7684 \u9759\u7684\uff08Opaque Type\uff09 \u30b8\u30a7\u30cd\u30ec\u30fc\u30bf \u7d44\u307f\u8fbc\u307f ScalaCheck\uff08\u5225\u30e9\u30a4\u30d6\u30e9\u30ea\uff09 \u95a2\u6570\u4ed5\u69d8 fdef \u578b\u30b7\u30b0\u30cd\u30c1\u30e3 + \u4e8b\u524d\u6761\u4ef6"},{"location":"scala/04-data-validation/#_6","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Scala \u306b\u304a\u3051\u308b\u30c7\u30fc\u30bf\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>Either: \u57fa\u672c\u7684\u306a\u6210\u529f/\u5931\u6557\u306e\u8868\u73fe</li> <li>Validated \u30d1\u30bf\u30fc\u30f3: \u30a8\u30e9\u30fc\u306e\u84c4\u7a4d</li> <li>Opaque Type: \u578b\u5b89\u5168\u306a\u30c9\u30e1\u30a4\u30f3\u30d7\u30ea\u30df\u30c6\u30a3\u30d6</li> <li>\u30b9\u30de\u30fc\u30c8\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf: \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u4ed8\u304d\u306e\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u751f\u6210</li> <li>ADT: \u6761\u4ef6\u4ed8\u304d\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3</li> <li>ValidationResponse: \u69cb\u9020\u5316\u3055\u308c\u305f\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u7d50\u679c</li> </ol> <p>Scala \u306e\u578b\u30b7\u30b9\u30c6\u30e0\u3092\u6d3b\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u306b\u591a\u304f\u306e\u30a8\u30e9\u30fc\u3092\u691c\u51fa\u3057\u3001\u5b9f\u884c\u6642\u306b\u306f Validated \u30d1\u30bf\u30fc\u30f3\u3067\u8a73\u7d30\u306a\u30a8\u30e9\u30fc\u60c5\u5831\u3092\u63d0\u4f9b\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"scala/04-data-validation/#_7","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/scala/part2/src/main/scala/DataValidation.scala</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/scala/part2/src/test/scala/DataValidationSpec.scala</code></li> </ul>"},{"location":"scala/04-data-validation/#_8","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002ScalaCheck \u3092\u4f7f\u3063\u305f\u751f\u6210\u7684\u30c6\u30b9\u30c8\u306e\u624b\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"scala/05-property-based-testing/","title":"\u7b2c5\u7ae0: \u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8","text":""},{"location":"scala/05-property-based-testing/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u5f93\u6765\u306e\u5358\u4f53\u30c6\u30b9\u30c8\u3067\u306f\u3001\u7279\u5b9a\u306e\u5165\u529b\u306b\u5bfe\u3059\u308b\u671f\u5f85\u3055\u308c\u308b\u51fa\u529b\u3092\u691c\u8a3c\u3057\u307e\u3059\u3002\u4e00\u65b9\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u3067\u306f\u3001\u3059\u3079\u3066\u306e\u5165\u529b\u306b\u5bfe\u3057\u3066\u6210\u308a\u7acb\u3064\u3079\u304d\u300c\u6027\u8cea\uff08\u30d7\u30ed\u30d1\u30c6\u30a3\uff09\u300d\u3092\u5b9a\u7fa9\u3057\u3001\u30e9\u30f3\u30c0\u30e0\u306b\u751f\u6210\u3055\u308c\u305f\u591a\u6570\u306e\u30c6\u30b9\u30c8\u30b1\u30fc\u30b9\u3067\u691c\u8a3c\u3057\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001Scala \u306e ScalaCheck \u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u3063\u305f\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u306e\u624b\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"scala/05-property-based-testing/#1","title":"1. \u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u3068\u306f","text":""},{"location":"scala/05-property-based-testing/#_2","title":"\u5f93\u6765\u306e\u30c6\u30b9\u30c8\u3068\u306e\u9055\u3044","text":"<pre><code>// \u5f93\u6765\u306e\u30c6\u30b9\u30c8\uff1a\u7279\u5b9a\u306e\u5165\u529b\u306b\u5bfe\u3059\u308b\u51fa\u529b\u3092\u691c\u8a3c\ntest(\"reverseString should reverse a specific string\") {\n  StringOperations.reverseString(\"hello\") shouldBe \"olleh\"\n  StringOperations.reverseString(\"\") shouldBe \"\"\n  StringOperations.reverseString(\"a\") shouldBe \"a\"\n}\n\n// \u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\uff1a\u6027\u8cea\u3092\u691c\u8a3c\ntest(\"\u6587\u5b57\u5217\u53cd\u8ee2\u306f\u5bfe\u5408\uff08involutory\uff09: 2\u56de\u53cd\u8ee2\u3059\u308b\u3068\u5143\u306b\u623b\u308b\") {\n  forAll { (s: String) =&gt;\n    StringOperations.reverseString(StringOperations.reverseString(s)) shouldBe s\n  }\n}\n</code></pre>"},{"location":"scala/05-property-based-testing/#_3","title":"\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u306e\u5229\u70b9","text":"<ol> <li>\u7db2\u7f85\u6027: \u624b\u52d5\u3067\u306f\u601d\u3044\u3064\u304b\u306a\u3044\u30a8\u30c3\u30b8\u30b1\u30fc\u30b9\u3092\u767a\u898b</li> <li>\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u6027: \u30b3\u30fc\u30c9\u306e\u6027\u8cea\u3092\u660e\u78ba\u306b\u8868\u73fe</li> <li>\u56de\u5e30\u9632\u6b62: \u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u6642\u306e\u5b89\u5168\u7db2</li> <li>\u30b7\u30e5\u30ea\u30f3\u30ad\u30f3\u30b0: \u5931\u6557\u6642\u306b\u6700\u5c0f\u306e\u53cd\u4f8b\u3092\u63d0\u793a</li> </ol>"},{"location":"scala/05-property-based-testing/#2-scalacheck","title":"2. ScalaCheck \u306e\u57fa\u672c","text":""},{"location":"scala/05-property-based-testing/#_4","title":"\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7","text":"<pre><code>// build.sbt \u306b\u8ffd\u52a0\nlibraryDependencies ++= Seq(\n  \"org.scalatest\" %% \"scalatest\" % \"3.2.17\" % Test,\n  \"org.scalatestplus\" %% \"scalacheck-1-17\" % \"3.2.17.0\" % Test,\n  \"org.scalacheck\" %% \"scalacheck\" % \"1.17.0\" % Test\n)\n</code></pre>"},{"location":"scala/05-property-based-testing/#_5","title":"\u57fa\u672c\u7684\u306a\u4f7f\u3044\u65b9","text":"<pre><code>import org.scalatest.funsuite.AnyFunSuite\nimport org.scalatest.matchers.should.Matchers\nimport org.scalatestplus.scalacheck.ScalaCheckPropertyChecks\nimport org.scalacheck.Gen\n\nclass MySpec extends AnyFunSuite with Matchers with ScalaCheckPropertyChecks:\n\n  test(\"\u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u4f8b\") {\n    forAll { (s: String) =&gt;\n      s.reverse.reverse shouldBe s\n    }\n  }\n</code></pre>"},{"location":"scala/05-property-based-testing/#3","title":"3. \u57fa\u672c\u7684\u306a\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf","text":""},{"location":"scala/05-property-based-testing/#_6","title":"\u30d7\u30ea\u30df\u30c6\u30a3\u30d6\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf","text":"<pre><code>import org.scalacheck.Gen\n\n// \u6574\u6570\nGen.posNum[Int]       // \u6b63\u306e\u6574\u6570\nGen.negNum[Int]       // \u8ca0\u306e\u6574\u6570\nGen.chooseNum(0, 100) // \u7bc4\u56f2\u6307\u5b9a\n\n// \u6587\u5b57\u5217\nGen.alphaStr          // \u82f1\u5b57\u306e\u307f\nGen.alphaNumStr       // \u82f1\u6570\u5b57\u306e\u307f\nGen.numStr            // \u6570\u5b57\u306e\u307f\n\n// \u305d\u306e\u4ed6\nGen.oneOf(true, false)              // \u5217\u6319\nGen.oneOf(\"a\", \"b\", \"c\")            // \u9078\u629e\nGen.option(Gen.posNum[Int])         // Option\u578b\nGen.uuid                            // UUID\n</code></pre>"},{"location":"scala/05-property-based-testing/#_7","title":"\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf","text":"<pre><code>// \u30ea\u30b9\u30c8\nGen.listOf(Gen.posNum[Int])           // \u4efb\u610f\u9577\nGen.listOfN(5, Gen.posNum[Int])       // \u56fa\u5b9a\u9577\nGen.nonEmptyListOf(Gen.posNum[Int])   // \u975e\u7a7a\n\n// \u30de\u30c3\u30d7\nGen.mapOf(Gen.alphaStr -&gt; Gen.posNum[Int])\n\n// \u30bb\u30c3\u30c8\nGen.containerOf[Set, Int](Gen.posNum[Int])\n</code></pre>"},{"location":"scala/05-property-based-testing/#4","title":"4. \u30ab\u30b9\u30bf\u30e0\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf","text":""},{"location":"scala/05-property-based-testing/#_8","title":"\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30eb\u306e\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf","text":"<pre><code>// \u4f1a\u54e1\u30e9\u30f3\u30af\nenum Membership:\n  case Bronze, Silver, Gold, Platinum\n\nval membershipGen: Gen[Membership] = Gen.oneOf(\n  Membership.Bronze, Membership.Silver, \n  Membership.Gold, Membership.Platinum\n)\n\n// \u4eba\u7269\u30c7\u30fc\u30bf\ncase class Person(name: String, age: Int, membership: Membership)\n\nval personGen: Gen[Person] = for\n  name &lt;- Gen.alphaNumStr.suchThat(_.nonEmpty)\n  age &lt;- Gen.chooseNum(0, 150)\n  membership &lt;- membershipGen\nyield Person(name, age, membership)\n\n// \u5546\u54c1\u30c7\u30fc\u30bf\ncase class Product(productId: String, name: String, price: BigDecimal, quantity: Int)\n\nval productGen: Gen[Product] = for\n  id &lt;- Gen.posNum[Int].map(n =&gt; f\"PROD-${n % 100000}%05d\")\n  name &lt;- Gen.alphaNumStr.suchThat(_.nonEmpty)\n  price &lt;- Gen.posNum[Int].map(n =&gt; BigDecimal(1 + n % 10000))\n  quantity &lt;- Gen.posNum[Int].map(n =&gt; 1 + n % 100)\nyield Product(id, name, price, quantity)\n</code></pre>"},{"location":"scala/05-property-based-testing/#_9","title":"\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u306e\u5909\u63db","text":"<pre><code>// map: \u5024\u306e\u5909\u63db\nval upperCaseGen = Gen.alphaStr.map(_.toUpperCase)\n\n// flatMap / for-comprehension: \u4f9d\u5b58\u95a2\u4fc2\u306e\u3042\u308b\u751f\u6210\nval subsetGen = for\n  list &lt;- Gen.nonEmptyListOf(Gen.posNum[Int])\n  size &lt;- Gen.chooseNum(1, list.length)\nyield list.take(size)\n\n// suchThat: \u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\uff08\u6ce8\u610f\uff1a\u52b9\u7387\u304c\u60aa\u304f\u306a\u308b\u53ef\u80fd\u6027\uff09\nval positiveEvenGen = Gen.posNum[Int].suchThat(_ % 2 == 0)\n\n// filter: suchThat\u306e\u30a8\u30a4\u30ea\u30a2\u30b9\nval nonEmptyStringGen = Gen.alphaStr.filter(_.nonEmpty)\n</code></pre>"},{"location":"scala/05-property-based-testing/#5_1","title":"5. \u30d7\u30ed\u30d1\u30c6\u30a3\u306e\u5b9a\u7fa9\u30d1\u30bf\u30fc\u30f3","text":""},{"location":"scala/05-property-based-testing/#idempotency","title":"\u51aa\u7b49\u6027\uff08Idempotency\uff09","text":"<p>\u540c\u3058\u64cd\u4f5c\u3092\u8907\u6570\u56de\u9069\u7528\u3057\u3066\u3082\u7d50\u679c\u304c\u5909\u308f\u3089\u306a\u3044\u6027\u8cea\u3002</p> <pre><code>test(\"\u30bd\u30fc\u30c8\u306f\u51aa\u7b49: 2\u56de\u30bd\u30fc\u30c8\u3057\u3066\u3082\u7d50\u679c\u306f\u540c\u3058\") {\n  forAll { (nums: List[Int]) =&gt;\n    NumberOperations.sortNumbers(NumberOperations.sortNumbers(nums)) shouldBe \n      NumberOperations.sortNumbers(nums)\n  }\n}\n\ntest(\"\u5927\u6587\u5b57\u5909\u63db\u306f\u51aa\u7b49\") {\n  forAll { (s: String) =&gt;\n    StringOperations.toUpperCase(StringOperations.toUpperCase(s)) shouldBe \n      StringOperations.toUpperCase(s)\n  }\n}\n</code></pre>"},{"location":"scala/05-property-based-testing/#involution","title":"\u5bfe\u5408\u6027\uff08Involution\uff09","text":"<p>2\u56de\u9069\u7528\u3059\u308b\u3068\u5143\u306b\u623b\u308b\u6027\u8cea\u3002</p> <pre><code>test(\"\u6587\u5b57\u5217\u53cd\u8ee2\u306f\u5bfe\u5408: 2\u56de\u53cd\u8ee2\u3059\u308b\u3068\u5143\u306b\u623b\u308b\") {\n  forAll { (s: String) =&gt;\n    StringOperations.reverseString(StringOperations.reverseString(s)) shouldBe s\n  }\n}\n\ntest(\"\u30ea\u30b9\u30c8\u53cd\u8ee2\u306f\u5bfe\u5408\") {\n  forAll { (list: List[Int]) =&gt;\n    CollectionOps.reverse(CollectionOps.reverse(list)) shouldBe list\n  }\n}\n</code></pre>"},{"location":"scala/05-property-based-testing/#invariant","title":"\u4e0d\u5909\u91cf\uff08Invariant\uff09","text":"<p>\u64cd\u4f5c\u306e\u524d\u5f8c\u3067\u4fdd\u5b58\u3055\u308c\u308b\u6027\u8cea\u3002</p> <pre><code>test(\"\u30bd\u30fc\u30c8\u306f\u8981\u7d20\u3092\u4fdd\u5b58\u3059\u308b\") {\n  forAll { (nums: List[Int]) =&gt;\n    NumberOperations.sortNumbers(nums).groupBy(identity).view.mapValues(_.size).toMap shouldBe\n      nums.groupBy(identity).view.mapValues(_.size).toMap\n  }\n}\n\ntest(\"\u30bd\u30fc\u30c8\u306f\u9577\u3055\u3092\u4fdd\u5b58\u3059\u308b\") {\n  forAll { (nums: List[Int]) =&gt;\n    NumberOperations.sortNumbers(nums).length shouldBe nums.length\n  }\n}\n</code></pre>"},{"location":"scala/05-property-based-testing/#boundary-conditions","title":"\u5883\u754c\u6761\u4ef6\uff08Boundary Conditions\uff09","text":"<pre><code>test(\"\u5272\u5f15\u5f8c\u306e\u4fa1\u683c\u306f0\u4ee5\u4e0a\u3001\u5143\u306e\u4fa1\u683c\u4ee5\u4e0b\") {\n  forAll(\n    Gen.chooseNum(0, 10000).map(BigDecimal(_)),\n    Gen.chooseNum(0.0, 1.0)\n  ) { (price, rate) =&gt;\n    val discounted = PricingLogic.calculateDiscount(price, rate)\n    discounted should be &gt;= BigDecimal(0)\n    discounted should be &lt;= price\n  }\n}\n</code></pre>"},{"location":"scala/05-property-based-testing/#6","title":"6. \u30e9\u30a6\u30f3\u30c9\u30c8\u30ea\u30c3\u30d7\u30d7\u30ed\u30d1\u30c6\u30a3","text":"<p>\u30a8\u30f3\u30b3\u30fc\u30c9/\u30c7\u30b3\u30fc\u30c9\u306e\u53ef\u9006\u6027\u306f\u5178\u578b\u7684\u306a\u30d7\u30ed\u30d1\u30c6\u30a3\u3067\u3059\u3002</p> <pre><code>object RunLengthEncoding:\n  /** \u30e9\u30f3\u30ec\u30f3\u30b0\u30b9\u7b26\u53f7\u5316 */\n  def encode(s: String): List[(Char, Int)] =\n    if s.isEmpty then List.empty\n    else\n      s.foldLeft(List.empty[(Char, Int)]) { (acc, char) =&gt;\n        acc match\n          case Nil =&gt; List((char, 1))\n          case (lastChar, count) :: rest if lastChar == char =&gt;\n            (lastChar, count + 1) :: rest\n          case _ =&gt; (char, 1) :: acc\n      }.reverse\n\n  /** \u30e9\u30f3\u30ec\u30f3\u30b0\u30b9\u5fa9\u53f7\u5316 */\n  def decode(encoded: List[(Char, Int)]): String =\n    encoded.map { case (char, count) =&gt; char.toString * count }.mkString\n\ntest(\"\u30e9\u30f3\u30ec\u30f3\u30b0\u30b9\u7b26\u53f7\u5316\u306f\u53ef\u9006\") {\n  forAll(Gen.alphaStr) { s =&gt;\n    RunLengthEncoding.decode(RunLengthEncoding.encode(s)) shouldBe s\n  }\n}\n\ntest(\"Base64\u30a8\u30f3\u30b3\u30fc\u30c9/\u30c7\u30b3\u30fc\u30c9\u306f\u53ef\u9006\") {\n  forAll { (s: String) =&gt;\n    Base64Codec.decode(Base64Codec.encode(s)) shouldBe s\n  }\n}\n</code></pre>"},{"location":"scala/05-property-based-testing/#7","title":"7. \u4ee3\u6570\u7684\u6027\u8cea","text":""},{"location":"scala/05-property-based-testing/#_10","title":"\u30e2\u30ce\u30a4\u30c9\u306e\u6cd5\u5247","text":"<pre><code>trait Monoid[A]:\n  def empty: A\n  def combine(x: A, y: A): A\n\nobject Monoid:\n  given intAddition: Monoid[Int] with\n    def empty: Int = 0\n    def combine(x: Int, y: Int): Int = x + y\n\n  given stringConcat: Monoid[String] with\n    def empty: String = \"\"\n    def combine(x: String, y: String): String = x + y\n\n  given listConcat[A]: Monoid[List[A]] with\n    def empty: List[A] = List.empty\n    def combine(x: List[A], y: List[A]): List[A] = x ++ y\n\n// \u7d50\u5408\u5f8b\u306e\u30c6\u30b9\u30c8\ntest(\"Int\u52a0\u7b97\u30e2\u30ce\u30a4\u30c9\u306e\u7d50\u5408\u5f8b\") {\n  import Monoid.given\n  forAll { (a: Int, b: Int, c: Int) =&gt;\n    val m = summon[Monoid[Int]]\n    m.combine(m.combine(a, b), c) shouldBe m.combine(a, m.combine(b, c))\n  }\n}\n\n// \u5358\u4f4d\u5143\u306e\u30c6\u30b9\u30c8\ntest(\"Int\u52a0\u7b97\u30e2\u30ce\u30a4\u30c9\u306e\u5358\u4f4d\u5143\") {\n  import Monoid.given\n  forAll { (a: Int) =&gt;\n    val m = summon[Monoid[Int]]\n    m.combine(a, m.empty) shouldBe a\n    m.combine(m.empty, a) shouldBe a\n  }\n}\n</code></pre>"},{"location":"scala/05-property-based-testing/#_11","title":"\u7b97\u8853\u6f14\u7b97\u306e\u6027\u8cea","text":"<pre><code>test(\"\u52a0\u7b97\u306e\u7d50\u5408\u5f8b\") {\n  forAll(Gen.chooseNum(-1000, 1000), Gen.chooseNum(-1000, 1000), Gen.chooseNum(-1000, 1000)) { \n    (a, b, c) =&gt;\n    ((a + b) + c) shouldBe (a + (b + c))\n  }\n}\n\ntest(\"\u52a0\u7b97\u306e\u4ea4\u63db\u5f8b\") {\n  forAll { (a: Int, b: Int) =&gt;\n    (a + b) shouldBe (b + a)\n  }\n}\n\ntest(\"\u52a0\u7b97\u306e\u5358\u4f4d\u5143\") {\n  forAll { (a: Int) =&gt;\n    (a + 0) shouldBe a\n  }\n}\n</code></pre>"},{"location":"scala/05-property-based-testing/#8","title":"8. \u30aa\u30e9\u30af\u30eb\u30c6\u30b9\u30c8","text":"<p>\u65e2\u77e5\u306e\u6b63\u3057\u3044\u5b9f\u88c5\uff08\u6a19\u6e96\u30e9\u30a4\u30d6\u30e9\u30ea\u306a\u3069\uff09\u3068\u6bd4\u8f03\u3057\u307e\u3059\u3002</p> <pre><code>test(\"sortNumbers\u306f\u6a19\u6e96\u30e9\u30a4\u30d6\u30e9\u30ea\u306esort\u3068\u540c\u3058\u7d50\u679c\") {\n  forAll { (nums: List[Int]) =&gt;\n    NumberOperations.sortNumbers(nums) shouldBe nums.sorted\n  }\n}\n\ntest(\"distinct\u306f\u6a19\u6e96\u30e9\u30a4\u30d6\u30e9\u30ea\u306edistinct\u3068\u540c\u3058\u7d50\u679c\") {\n  forAll { (list: List[Int]) =&gt;\n    CollectionOps.distinct(list) shouldBe list.distinct\n  }\n}\n\ntest(\"reverse\u306f\u6a19\u6e96\u30e9\u30a4\u30d6\u30e9\u30ea\u306ereverse\u3068\u540c\u3058\u7d50\u679c\") {\n  forAll { (list: List[Int]) =&gt;\n    CollectionOps.reverse(list) shouldBe list.reverse\n  }\n}\n</code></pre>"},{"location":"scala/05-property-based-testing/#9","title":"9. \u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u64cd\u4f5c\u306e\u30d7\u30ed\u30d1\u30c6\u30a3","text":""},{"location":"scala/05-property-based-testing/#filter","title":"filter \u306e\u6027\u8cea","text":"<pre><code>test(\"filter\u306f\u9577\u3055\u3092\u6e1b\u3089\u3059\u304b\u7dad\u6301\u3059\u308b\") {\n  forAll { (list: List[Int]) =&gt;\n    CollectionOps.filter(list)(_ &gt; 0).length should be &lt;= list.length\n  }\n}\n\ntest(\"filter(\u5e38\u306btrue)\u306f\u5143\u306e\u30ea\u30b9\u30c8\u3068\u540c\u3058\") {\n  forAll { (list: List[Int]) =&gt;\n    CollectionOps.filter(list)(_ =&gt; true) shouldBe list\n  }\n}\n\ntest(\"filter(\u5e38\u306bfalse)\u306f\u7a7a\u30ea\u30b9\u30c8\") {\n  forAll { (list: List[Int]) =&gt;\n    CollectionOps.filter(list)(_ =&gt; false) shouldBe List.empty\n  }\n}\n</code></pre>"},{"location":"scala/05-property-based-testing/#map","title":"map \u306e\u6027\u8cea","text":"<pre><code>test(\"map\u306f\u9577\u3055\u3092\u4fdd\u5b58\u3059\u308b\") {\n  forAll { (list: List[Int]) =&gt;\n    CollectionOps.map(list)(_ * 2).length shouldBe list.length\n  }\n}\n\ntest(\"map(identity)\u306f\u5143\u306e\u30ea\u30b9\u30c8\u3068\u540c\u3058\") {\n  forAll { (list: List[Int]) =&gt;\n    CollectionOps.map(list)(identity) shouldBe list\n  }\n}\n\n// \u30d5\u30a1\u30f3\u30af\u30bf\u30fc\u5247\uff1amap(f).map(g) == map(f andThen g)\ntest(\"map(f).map(g) == map(f andThen g)\") {\n  val f: Int =&gt; Int = _ + 1\n  val g: Int =&gt; Int = _ * 2\n  forAll { (list: List[Int]) =&gt;\n    CollectionOps.map(CollectionOps.map(list)(f))(g) shouldBe \n      CollectionOps.map(list)(f andThen g)\n  }\n}\n</code></pre>"},{"location":"scala/05-property-based-testing/#concat","title":"concat \u306e\u6027\u8cea","text":"<pre><code>test(\"concat\u306e\u7d50\u5408\u5f8b\") {\n  forAll { (a: List[Int], b: List[Int], c: List[Int]) =&gt;\n    CollectionOps.concat(CollectionOps.concat(a, b), c) shouldBe \n      CollectionOps.concat(a, CollectionOps.concat(b, c))\n  }\n}\n\ntest(\"concat\u306e\u9577\u3055\u306f\u5165\u529b\u306e\u9577\u3055\u306e\u5408\u8a08\") {\n  forAll { (a: List[Int], b: List[Int]) =&gt;\n    CollectionOps.concat(a, b).length shouldBe (a.length + b.length)\n  }\n}\n</code></pre>"},{"location":"scala/05-property-based-testing/#10","title":"10. \u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u306e\u30d7\u30ed\u30d1\u30c6\u30a3","text":"<pre><code>test(\"\u6ce8\u6587\u5408\u8a08\u306f\u5e38\u306b\u975e\u8ca0\") {\n  forAll(orderGen) { order =&gt;\n    PricingLogic.calculateOrderTotal(order) should be &gt;= BigDecimal(0)\n  }\n}\n\ntest(\"\u6700\u7d42\u4fa1\u683c\u306f\u6ce8\u6587\u5408\u8a08\u4ee5\u4e0b\uff08\u4f1a\u54e1\u5272\u5f15\u9069\u7528\u5f8c\uff09\") {\n  forAll(orderGen, membershipGen) { (order, membership) =&gt;\n    val total = PricingLogic.calculateOrderTotal(order)\n    val finalPrice = PricingLogic.calculateFinalPrice(order, membership)\n    finalPrice should be &lt;= total\n  }\n}\n\ntest(\"Platinum\u306f\u6700\u5927\u306e\u5272\u5f15\u3092\u53d7\u3051\u308b\") {\n  forAll(orderGen) { order =&gt;\n    val platinumPrice = PricingLogic.calculateFinalPrice(order, Membership.Platinum)\n    val bronzePrice = PricingLogic.calculateFinalPrice(order, Membership.Bronze)\n    platinumPrice should be &lt;= bronzePrice\n  }\n}\n</code></pre>"},{"location":"scala/05-property-based-testing/#11","title":"11. \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u306e\u30d7\u30ed\u30d1\u30c6\u30a3","text":"<p>\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u3067\u6709\u52b9\u306a\u5165\u529b\u3092\u751f\u6210\u3057\u3001\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u901a\u904e\u3059\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002</p> <pre><code>val validEmailGen: Gen[String] = for\n  local &lt;- Gen.alphaNumStr.suchThat(_.nonEmpty)\n  domain &lt;- Gen.alphaNumStr.suchThat(_.nonEmpty)\n  tld &lt;- Gen.oneOf(\"com\", \"org\", \"net\", \"io\", \"jp\")\nyield s\"$local@$domain.$tld\"\n\ntest(\"\u751f\u6210\u3055\u308c\u305f\u6709\u52b9\u306a\u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\u306f\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u901a\u904e\u3059\u308b\") {\n  forAll(validEmailGen) { email =&gt;\n    Validation.isValidEmail(email) shouldBe true\n  }\n}\n\nval validPhoneGen: Gen[String] = for\n  length &lt;- Gen.chooseNum(10, 15)\n  digits &lt;- Gen.listOfN(length, Gen.numChar)\nyield digits.mkString\n\ntest(\"\u751f\u6210\u3055\u308c\u305f\u6709\u52b9\u306a\u96fb\u8a71\u756a\u53f7\u306f\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u3092\u901a\u904e\u3059\u308b\") {\n  forAll(validPhoneGen) { phone =&gt;\n    Validation.isValidPhoneNumber(phone) shouldBe true\n  }\n}\n</code></pre>"},{"location":"scala/05-property-based-testing/#clojure","title":"Clojure \u3068\u306e\u6bd4\u8f03","text":"\u6982\u5ff5 Clojure (test.check) Scala (ScalaCheck) \u30b8\u30a7\u30cd\u30ec\u30fc\u30bf <code>gen/string</code>, <code>gen/int</code> <code>Gen.alphaStr</code>, <code>Gen.posNum[Int]</code> \u7bc4\u56f2\u6307\u5b9a <code>gen/choose</code> <code>Gen.chooseNum</code> \u5217\u6319 <code>gen/elements</code> <code>Gen.oneOf</code> \u30b3\u30ec\u30af\u30b7\u30e7\u30f3 <code>gen/vector</code>, <code>gen/list</code> <code>Gen.listOf</code>, <code>Gen.containerOf</code> \u5909\u63db <code>gen/fmap</code> <code>Gen.map</code> / for-comprehension \u4f9d\u5b58\u95a2\u4fc2 <code>gen/bind</code> <code>Gen.flatMap</code> / for-comprehension \u30d5\u30a3\u30eb\u30bf <code>gen/such-that</code> <code>Gen.suchThat</code> \u30d7\u30ed\u30d1\u30c6\u30a3\u5b9a\u7fa9 <code>prop/for-all</code> <code>forAll</code> \u5b9f\u884c <code>tc/quick-check</code> ScalaTest\u7d71\u5408"},{"location":"scala/05-property-based-testing/#_12","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30b8\u30a7\u30cd\u30ec\u30fc\u30bf: \u30c6\u30b9\u30c8\u30c7\u30fc\u30bf\u306e\u81ea\u52d5\u751f\u6210</li> <li>\u30d7\u30ea\u30df\u30c6\u30a3\u30d6: \u6574\u6570\u3001\u6587\u5b57\u5217\u3001\u30d6\u30fc\u30eb\u5024\u306a\u3069</li> <li>\u30b3\u30ec\u30af\u30b7\u30e7\u30f3: \u30ea\u30b9\u30c8\u3001\u30de\u30c3\u30d7\u3001\u30bb\u30c3\u30c8</li> <li>\u5909\u63db: map, flatMap, suchThat \u306b\u3088\u308b\u52a0\u5de5</li> <li>\u30d7\u30ed\u30d1\u30c6\u30a3: \u3059\u3079\u3066\u306e\u5165\u529b\u3067\u6210\u308a\u7acb\u3064\u3079\u304d\u6027\u8cea</li> <li>\u30d1\u30bf\u30fc\u30f3: \u51aa\u7b49\u6027\u3001\u5bfe\u5408\u6027\u3001\u4e0d\u5909\u91cf\u3001\u30e9\u30a6\u30f3\u30c9\u30c8\u30ea\u30c3\u30d7</li> <li>\u4ee3\u6570\u7684\u6027\u8cea: \u30e2\u30ce\u30a4\u30c9\u5247\u3001\u30d5\u30a1\u30f3\u30af\u30bf\u30fc\u5247</li> </ol> <p>\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u306f\u3001\u5f93\u6765\u306e\u30c6\u30b9\u30c8\u3092\u88dc\u5b8c\u3057\u3001\u3088\u308a\u5805\u7262\u306a\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p>"},{"location":"scala/05-property-based-testing/#_13","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/scala/part2/src/main/scala/PropertyBasedTesting.scala</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/scala/part2/src/test/scala/PropertyBasedTestingSpec.scala</code></li> </ul>"},{"location":"scala/05-property-based-testing/#_14","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001\u30c6\u30b9\u30c8\u99c6\u52d5\u958b\u767a\u3068\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002Red-Green-Refactor \u30b5\u30a4\u30af\u30eb\u3092\u95a2\u6570\u578b\u30b9\u30bf\u30a4\u30eb\u3067\u5b9f\u8df5\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"scala/06-tdd-functional/","title":"\u7b2c6\u7ae0: \u30c6\u30b9\u30c8\u99c6\u52d5\u958b\u767a\u3068\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0","text":""},{"location":"scala/06-tdd-functional/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u30c6\u30b9\u30c8\u99c6\u52d5\u958b\u767a\uff08TDD\uff09\u306f\u3001\u30c6\u30b9\u30c8\u3092\u5148\u306b\u66f8\u3044\u3066\u304b\u3089\u5b9f\u88c5\u3092\u884c\u3046\u958b\u767a\u624b\u6cd5\u3067\u3059\u3002\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3068 TDD \u306f\u76f8\u6027\u304c\u826f\u304f\u3001\u7d14\u7c8b\u95a2\u6570\u306f\u30c6\u30b9\u30c8\u304c\u5bb9\u6613\u3067\u3001\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020\u306f\u4e88\u6e2c\u53ef\u80fd\u306a\u52d5\u4f5c\u3092\u4fdd\u8a3c\u3057\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001Red-Green-Refactor \u30b5\u30a4\u30af\u30eb\u3092\u95a2\u6570\u578b\u30b9\u30bf\u30a4\u30eb\u3067\u5b9f\u8df5\u3059\u308b\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"scala/06-tdd-functional/#1-tdd","title":"1. TDD \u306e\u57fa\u672c\u30b5\u30a4\u30af\u30eb","text":""},{"location":"scala/06-tdd-functional/#red-green-refactor","title":"Red-Green-Refactor","text":"<ol> <li>Red\uff08\u8d64\uff09: \u5931\u6557\u3059\u308b\u30c6\u30b9\u30c8\u3092\u66f8\u304f</li> <li>Green\uff08\u7dd1\uff09: \u30c6\u30b9\u30c8\u3092\u901a\u3059\u6700\u5c0f\u9650\u306e\u30b3\u30fc\u30c9\u3092\u66f8\u304f</li> <li>Refactor\uff08\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\uff09: \u30b3\u30fc\u30c9\u3092\u6539\u5584\u3059\u308b\uff08\u30c6\u30b9\u30c8\u306f\u901a\u3063\u305f\u307e\u307e\uff09</li> </ol>"},{"location":"scala/06-tdd-functional/#2-fizzbuzz-tdd","title":"2. FizzBuzz - TDD \u306e\u5178\u578b\u4f8b","text":""},{"location":"scala/06-tdd-functional/#step-1-red","title":"Step 1: Red\uff08\u6700\u521d\u306e\u30c6\u30b9\u30c8\uff09","text":"<pre><code>test(\"FizzBuzz: 1\u306f\\\"1\\\"\u3092\u8fd4\u3059\") {\n  FizzBuzz.fizzbuzz(1) shouldBe \"1\"\n}\n</code></pre>"},{"location":"scala/06-tdd-functional/#step-2-green","title":"Step 2: Green\uff08\u6700\u5c0f\u9650\u306e\u5b9f\u88c5\uff09","text":"<pre><code>def fizzbuzz(n: Int): String = \"1\"\n</code></pre>"},{"location":"scala/06-tdd-functional/#step-3","title":"Step 3: \u6b21\u306e\u30c6\u30b9\u30c8\u3092\u8ffd\u52a0\u3057\u3066\u6bb5\u968e\u7684\u306b\u5b9f\u88c5\u3092\u767a\u5c55","text":"<pre><code>// \u30c6\u30b9\u30c8\u3092\u8ffd\u52a0\ntest(\"FizzBuzz: 2\u306f\\\"2\\\"\u3092\u8fd4\u3059\") {\n  FizzBuzz.fizzbuzz(2) shouldBe \"2\"\n}\n\ntest(\"FizzBuzz: 3\u306f\\\"Fizz\\\"\u3092\u8fd4\u3059\") {\n  FizzBuzz.fizzbuzz(3) shouldBe \"Fizz\"\n}\n\ntest(\"FizzBuzz: 5\u306f\\\"Buzz\\\"\u3092\u8fd4\u3059\") {\n  FizzBuzz.fizzbuzz(5) shouldBe \"Buzz\"\n}\n\ntest(\"FizzBuzz: 15\u306f\\\"FizzBuzz\\\"\u3092\u8fd4\u3059\") {\n  FizzBuzz.fizzbuzz(15) shouldBe \"FizzBuzz\"\n}\n</code></pre>"},{"location":"scala/06-tdd-functional/#_2","title":"\u6700\u7d42\u5b9f\u88c5\uff08\u5c0f\u3055\u306a\u30d8\u30eb\u30d1\u30fc\u95a2\u6570\u306b\u5206\u5272\uff09","text":"<pre><code>object FizzBuzz:\n  /** 3\u3067\u5272\u308a\u5207\u308c\u308b\u304b\u3069\u3046\u304b */\n  def isFizz(n: Int): Boolean = n % 3 == 0\n\n  /** 5\u3067\u5272\u308a\u5207\u308c\u308b\u304b\u3069\u3046\u304b */\n  def isBuzz(n: Int): Boolean = n % 5 == 0\n\n  /** 15\u3067\u5272\u308a\u5207\u308c\u308b\u304b\u3069\u3046\u304b\uff08FizzBuzz\uff09 */\n  def isFizzBuzz(n: Int): Boolean = isFizz(n) &amp;&amp; isBuzz(n)\n\n  /** FizzBuzz\u5909\u63db */\n  def fizzbuzz(n: Int): String =\n    if isFizzBuzz(n) then \"FizzBuzz\"\n    else if isFizz(n) then \"Fizz\"\n    else if isBuzz(n) then \"Buzz\"\n    else n.toString\n\n  /** 1\u304b\u3089n\u307e\u3067\u306eFizzBuzz\u5217\u3092\u751f\u6210 */\n  def fizzbuzzSequence(n: Int): List[String] =\n    (1 to n).map(fizzbuzz).toList\n</code></pre>"},{"location":"scala/06-tdd-functional/#3","title":"3. \u30ed\u30fc\u30de\u6570\u5b57\u5909\u63db","text":""},{"location":"scala/06-tdd-functional/#_3","title":"\u30c6\u30b9\u30c8\u304b\u3089\u59cb\u3081\u308b","text":"<pre><code>test(\"\u30ed\u30fc\u30de\u6570\u5b57: 1\u306fI\u3092\u8fd4\u3059\") {\n  RomanNumerals.toRoman(1) shouldBe \"I\"\n}\n\ntest(\"\u30ed\u30fc\u30de\u6570\u5b57: 4\u306fIV\u3092\u8fd4\u3059\") {\n  RomanNumerals.toRoman(4) shouldBe \"IV\"\n}\n\ntest(\"\u30ed\u30fc\u30de\u6570\u5b57: 1994\u306fMCMXCIV\u3092\u8fd4\u3059\") {\n  RomanNumerals.toRoman(1994) shouldBe \"MCMXCIV\"\n}\n\ntest(\"\u30ed\u30fc\u30de\u6570\u5b57: toRoman\u3068fromRoman\u306f\u9006\u95a2\u6570\") {\n  for n &lt;- 1 to 3999 do\n    RomanNumerals.fromRoman(RomanNumerals.toRoman(n)) shouldBe n\n}\n</code></pre>"},{"location":"scala/06-tdd-functional/#_4","title":"\u30c7\u30fc\u30bf\u99c6\u52d5\u306e\u5b9f\u88c5","text":"<pre><code>object RomanNumerals:\n  /** \u30ed\u30fc\u30de\u6570\u5b57\u306e\u5bfe\u5fdc\u8868\uff08\u5927\u304d\u3044\u9806\uff09 */\n  private val romanNumerals: List[(Int, String)] = List(\n    1000 -&gt; \"M\",  900 -&gt; \"CM\", 500 -&gt; \"D\", 400 -&gt; \"CD\",\n    100 -&gt; \"C\",   90 -&gt; \"XC\",  50 -&gt; \"L\",  40 -&gt; \"XL\",\n    10 -&gt; \"X\",    9 -&gt; \"IX\",   5 -&gt; \"V\",   4 -&gt; \"IV\",\n    1 -&gt; \"I\"\n  )\n\n  /** \u6574\u6570\u3092\u30ed\u30fc\u30de\u6570\u5b57\u306b\u5909\u63db */\n  def toRoman(n: Int): String =\n    require(n &gt; 0 &amp;&amp; n &lt;= 3999, s\"n must be between 1 and 3999\")\n\n    @annotation.tailrec\n    def loop(remaining: Int, result: StringBuilder): String =\n      if remaining == 0 then result.toString\n      else\n        val (value, numeral) = romanNumerals.find(_._1 &lt;= remaining).get\n        loop(remaining - value, result.append(numeral))\n\n    loop(n, new StringBuilder)\n</code></pre>"},{"location":"scala/06-tdd-functional/#4","title":"4. \u30dc\u30a6\u30ea\u30f3\u30b0\u30b9\u30b3\u30a2\u8a08\u7b97","text":""},{"location":"scala/06-tdd-functional/#tdd","title":"\u8907\u96d1\u306a\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af\u306e TDD","text":"<pre><code>test(\"\u30dc\u30a6\u30ea\u30f3\u30b0: \u30ac\u30bf\u30fc\u30b9\u30b3\u30a2\u306f0\") {\n  Bowling.score(List.fill(20)(0)) shouldBe 0\n}\n\ntest(\"\u30dc\u30a6\u30ea\u30f3\u30b0: \u3059\u3079\u30661\u30d4\u30f3\u306f20\u70b9\") {\n  Bowling.score(List.fill(20)(1)) shouldBe 20\n}\n\ntest(\"\u30dc\u30a6\u30ea\u30f3\u30b0: \u30b9\u30da\u30a2\u306e\u5f8c\u306e\u6295\u7403\u306f\u30dc\u30fc\u30ca\u30b9\") {\n  Bowling.score(List(5, 5, 3, 0) ++ List.fill(16)(0)) shouldBe 16\n}\n\ntest(\"\u30dc\u30a6\u30ea\u30f3\u30b0: \u30b9\u30c8\u30e9\u30a4\u30af\u306e\u5f8c\u306e2\u6295\u306f\u30dc\u30fc\u30ca\u30b9\") {\n  Bowling.score(List(10, 3, 4) ++ List.fill(16)(0)) shouldBe 24\n}\n\ntest(\"\u30dc\u30a6\u30ea\u30f3\u30b0: \u30d1\u30fc\u30d5\u30a7\u30af\u30c8\u30b2\u30fc\u30e0\u306f300\u70b9\") {\n  Bowling.score(List.fill(12)(10)) shouldBe 300\n}\n</code></pre>"},{"location":"scala/06-tdd-functional/#_5","title":"\u5c0f\u3055\u306a\u95a2\u6570\u306b\u5206\u5272","text":"<pre><code>object Bowling:\n  def isStrike(rolls: List[Int]): Boolean = \n    rolls.headOption.contains(10)\n\n  def isSpare(rolls: List[Int]): Boolean = \n    rolls.length &gt;= 2 &amp;&amp; rolls.take(2).sum == 10 &amp;&amp; !isStrike(rolls)\n\n  def strikeBonus(remaining: List[Int]): Int = \n    remaining.take(2).sum\n\n  def spareBonus(remaining: List[Int]): Int = \n    remaining.headOption.getOrElse(0)\n\n  def score(rolls: List[Int]): Int =\n    @annotation.tailrec\n    def loop(remainingRolls: List[Int], frame: Int, total: Int): Int =\n      if frame &gt; 10 || remainingRolls.isEmpty then total\n      else if isStrike(remainingRolls) then\n        loop(remainingRolls.tail, frame + 1, total + 10 + strikeBonus(remainingRolls.tail))\n      else if isSpare(remainingRolls) then\n        loop(remainingRolls.drop(2), frame + 1, total + 10 + spareBonus(remainingRolls.drop(2)))\n      else\n        loop(remainingRolls.drop(2), frame + 1, total + remainingRolls.take(2).sum)\n\n    loop(rolls, 1, 0)\n</code></pre>"},{"location":"scala/06-tdd-functional/#5-tdd","title":"5. \u7d20\u6570 - \u30b7\u30f3\u30d7\u30eb\u306a\u95a2\u6570\u306e TDD","text":""},{"location":"scala/06-tdd-functional/#_6","title":"\u30c6\u30b9\u30c8\u304b\u3089\u8a2d\u8a08\u3092\u5c0e\u304f","text":"<pre><code>test(\"\u7d20\u6570: isPrime\u306f\u7d20\u6570\u3092\u6b63\u3057\u304f\u5224\u5b9a\u3059\u308b\") {\n  Primes.isPrime(0) shouldBe false\n  Primes.isPrime(1) shouldBe false\n  Primes.isPrime(2) shouldBe true\n  Primes.isPrime(3) shouldBe true\n  Primes.isPrime(4) shouldBe false\n  Primes.isPrime(97) shouldBe true\n}\n\ntest(\"\u7d20\u6570: primesUpTo\u306f\u6b63\u3057\u3044\u7d20\u6570\u30ea\u30b9\u30c8\u3092\u8fd4\u3059\") {\n  Primes.primesUpTo(20) shouldBe List(2, 3, 5, 7, 11, 13, 17, 19)\n}\n\ntest(\"\u7d20\u6570: primeFactors\u306f\u7d20\u56e0\u6570\u5206\u89e3\u3092\u8fd4\u3059\") {\n  Primes.primeFactors(24) shouldBe List(2, 2, 2, 3)\n}\n\ntest(\"\u7d20\u6570: primeFactors\u306e\u7a4d\u306f\u5143\u306e\u6570\u306b\u7b49\u3057\u3044\") {\n  for n &lt;- 2 to 100 do\n    Primes.primeFactors(n).product shouldBe n\n}\n</code></pre>"},{"location":"scala/06-tdd-functional/#_7","title":"\u5b9f\u88c5","text":"<pre><code>object Primes:\n  def isPrime(n: Int): Boolean =\n    if n &lt; 2 then false\n    else if n == 2 then true\n    else if n % 2 == 0 then false\n    else\n      val sqrtN = math.sqrt(n.toDouble).toInt\n      !(3 to sqrtN by 2).exists(n % _ == 0)\n\n  def primesUpTo(n: Int): List[Int] =\n    (2 to n).filter(isPrime).toList\n\n  def primeFactors(n: Int): List[Int] =\n    @annotation.tailrec\n    def loop(remaining: Int, factor: Int, factors: List[Int]): List[Int] =\n      if remaining == 1 then factors.reverse\n      else if remaining % factor == 0 then loop(remaining / factor, factor, factor :: factors)\n      else loop(remaining, factor + 1, factors)\n\n    loop(n, 2, Nil)\n</code></pre>"},{"location":"scala/06-tdd-functional/#6-","title":"6. \u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020 - \u30b9\u30bf\u30c3\u30af\u3068\u30ad\u30e5\u30fc","text":""},{"location":"scala/06-tdd-functional/#_8","title":"\u4e0d\u5909\u30b9\u30bf\u30c3\u30af","text":"<pre><code>case class Stack[A] private (items: List[A]):\n  def isEmpty: Boolean = items.isEmpty\n  def size: Int = items.length\n  def push(item: A): Stack[A] = Stack(item :: items)\n\n  def pop: Option[(A, Stack[A])] =\n    items match\n      case head :: tail =&gt; Some((head, Stack(tail)))\n      case Nil =&gt; None\n\n  def peek: Option[A] = items.headOption\n\nobject Stack:\n  def empty[A]: Stack[A] = Stack(Nil)\n</code></pre>"},{"location":"scala/06-tdd-functional/#_9","title":"\u30c6\u30b9\u30c8","text":"<pre><code>test(\"\u30b9\u30bf\u30c3\u30af: LIFO\u9806\u5e8f\u3067\u52d5\u4f5c\u3059\u308b\") {\n  val stack = Stack.empty[String]\n    .push(\"a\")\n    .push(\"b\")\n    .push(\"c\")\n\n  val Some((v1, s1)) = stack.pop: @unchecked\n  val Some((v2, s2)) = s1.pop: @unchecked\n  val Some((v3, s3)) = s2.pop: @unchecked\n\n  v1 shouldBe \"c\"\n  v2 shouldBe \"b\"\n  v3 shouldBe \"a\"\n  s3.isEmpty shouldBe true\n}\n</code></pre>"},{"location":"scala/06-tdd-functional/#2","title":"\u4e0d\u5909\u30ad\u30e5\u30fc\uff082\u3064\u306e\u30ea\u30b9\u30c8\u3067\u5b9f\u88c5\uff09","text":"<pre><code>case class Queue[A] private (front: List[A], back: List[A]):\n  def isEmpty: Boolean = front.isEmpty &amp;&amp; back.isEmpty\n  def enqueue(item: A): Queue[A] = Queue(front, item :: back)\n\n  def dequeue: Option[(A, Queue[A])] =\n    front match\n      case head :: tail =&gt; Some((head, Queue(tail, back)))\n      case Nil =&gt;\n        back.reverse match\n          case head :: tail =&gt; Some((head, Queue(tail, Nil)))\n          case Nil =&gt; None\n\nobject Queue:\n  def empty[A]: Queue[A] = Queue(Nil, Nil)\n</code></pre>"},{"location":"scala/06-tdd-functional/#7-","title":"7. \u6587\u5b57\u5217\u96fb\u5353 - \u6bb5\u968e\u7684\u306a\u8981\u4ef6\u8ffd\u52a0","text":""},{"location":"scala/06-tdd-functional/#_10","title":"\u30c6\u30b9\u30c8","text":"<pre><code>test(\"\u6587\u5b57\u5217\u96fb\u5353: \u7a7a\u6587\u5b57\u5217\u306f0\u3092\u8fd4\u3059\") {\n  StringCalculator.add(\"\") shouldBe 0\n}\n\ntest(\"\u6587\u5b57\u5217\u96fb\u5353: \u5358\u4e00\u306e\u6570\u5024\u306f\u305d\u306e\u5024\u3092\u8fd4\u3059\") {\n  StringCalculator.add(\"5\") shouldBe 5\n}\n\ntest(\"\u6587\u5b57\u5217\u96fb\u5353: \u30ab\u30f3\u30de\u533a\u5207\u308a\u306e\u6570\u5024\u3092\u5408\u8a08\u3059\u308b\") {\n  StringCalculator.add(\"1,2,3\") shouldBe 6\n}\n\ntest(\"\u6587\u5b57\u5217\u96fb\u5353: \u6539\u884c\u533a\u5207\u308a\u3082\u51e6\u7406\u3059\u308b\") {\n  StringCalculator.add(\"1\\n2,3\") shouldBe 6\n}\n\ntest(\"\u6587\u5b57\u5217\u96fb\u5353: \u30ab\u30b9\u30bf\u30e0\u533a\u5207\u308a\u6587\u5b57\u3092\u4f7f\u7528\u3067\u304d\u308b\") {\n  StringCalculator.add(\"//;\\n1;2\") shouldBe 3\n}\n\ntest(\"\u6587\u5b57\u5217\u96fb\u5353: \u8ca0\u306e\u6570\u306f\u4f8b\u5916\u3092\u30b9\u30ed\u30fc\u3059\u308b\") {\n  val exception = intercept[IllegalArgumentException] {\n    StringCalculator.add(\"1,-2,3\")\n  }\n  exception.getMessage should include(\"-2\")\n}\n\ntest(\"\u6587\u5b57\u5217\u96fb\u5353: 1000\u3088\u308a\u5927\u304d\u3044\u6570\u306f\u7121\u8996\u3059\u308b\") {\n  StringCalculator.add(\"2,1001\") shouldBe 2\n}\n</code></pre>"},{"location":"scala/06-tdd-functional/#_11","title":"\u5b9f\u88c5","text":"<pre><code>object StringCalculator:\n  def add(input: String): Int =\n    if input.isEmpty then 0\n    else\n      val (delimiter, numbers) = parseInput(input)\n      val nums = parseNumbers(numbers, delimiter)\n      validateNumbers(nums)\n      nums.filter(_ &lt;= 1000).sum\n\n  private def parseInput(input: String): (String, String) =\n    if input.startsWith(\"//\") then\n      val delimiterEnd = input.indexOf(\"\\n\")\n      (input.substring(2, delimiterEnd), input.substring(delimiterEnd + 1))\n    else\n      (\",|\\n\", input)\n\n  private def parseNumbers(numbers: String, delimiter: String): List[Int] =\n    numbers.split(delimiter).filter(_.nonEmpty).map(_.toInt).toList\n\n  private def validateNumbers(nums: List[Int]): Unit =\n    val negatives = nums.filter(_ &lt; 0)\n    if negatives.nonEmpty then\n      throw new IllegalArgumentException(s\"negatives not allowed: ${negatives.mkString(\", \")}\")\n</code></pre>"},{"location":"scala/06-tdd-functional/#8","title":"8. \u7d14\u7c8b\u95a2\u6570\u3068\u30c6\u30b9\u30c8\u5bb9\u6613\u6027","text":""},{"location":"scala/06-tdd-functional/#_12","title":"\u7d14\u7c8b\u95a2\u6570\u306e\u5229\u70b9","text":"<pre><code>case class Item(name: String, price: BigDecimal)\ncase class TaxCalculation(subtotal: BigDecimal, tax: BigDecimal, total: BigDecimal)\n\nobject TaxCalculator:\n  /** \u7d14\u7c8b\u95a2\u6570\uff1a\u30c6\u30b9\u30c8\u304c\u5bb9\u6613 */\n  def calculateTax(amount: BigDecimal, rate: BigDecimal): BigDecimal =\n    amount * rate\n\n  def calculateTotalWithTax(items: List[Item], taxRate: BigDecimal): TaxCalculation =\n    val subtotal = items.map(_.price).sum\n    val tax = calculateTax(subtotal, taxRate)\n    TaxCalculation(subtotal, tax, subtotal + tax)\n</code></pre>"},{"location":"scala/06-tdd-functional/#_13","title":"\u30c6\u30b9\u30c8","text":"<pre><code>test(\"\u7a0e\u8a08\u7b97: calculateTotalWithTax\u306f\u7a0e\u8fbc\u307f\u7dcf\u984d\u3092\u8a08\u7b97\u3059\u308b\") {\n  val items = List(\n    Item(\"\u5546\u54c1A\", BigDecimal(1000)),\n    Item(\"\u5546\u54c1B\", BigDecimal(2000))\n  )\n  val result = TaxCalculator.calculateTotalWithTax(items, BigDecimal(0.1))\n\n  result.subtotal shouldBe BigDecimal(3000)\n  result.tax shouldBe BigDecimal(300)\n  result.total shouldBe BigDecimal(3300)\n}\n</code></pre>"},{"location":"scala/06-tdd-functional/#9-","title":"9. \u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u30d1\u30bf\u30fc\u30f3 - \u30c7\u30fc\u30bf\u99c6\u52d5\u306e\u5b9f\u88c5","text":""},{"location":"scala/06-tdd-functional/#before","title":"Before: \u8907\u96d1\u306a\u6761\u4ef6\u5206\u5c90","text":"<pre><code>def calculateShippingBefore(total: BigDecimal, weight: Double, region: Region): Int =\n  if total &gt;= 10000 then 0\n  else region match\n    case Region.Local if weight &lt; 5 =&gt; 300\n    case Region.Local =&gt; 500\n    case Region.Domestic if weight &lt; 5 =&gt; 500\n    case Region.Domestic =&gt; 800\n    case Region.International if weight &lt; 5 =&gt; 2000\n    case Region.International =&gt; 3000\n</code></pre>"},{"location":"scala/06-tdd-functional/#after","title":"After: \u30c7\u30fc\u30bf\u99c6\u52d5\u306e\u5b9f\u88c5","text":"<pre><code>object ShippingCalculator:\n  def isFreeShipping(total: BigDecimal): Boolean = total &gt;= 10000\n\n  private val shippingRates: Map[Region, Map[Boolean, Int]] = Map(\n    Region.Local -&gt; Map(true -&gt; 300, false -&gt; 500),\n    Region.Domestic -&gt; Map(true -&gt; 500, false -&gt; 800),\n    Region.International -&gt; Map(true -&gt; 2000, false -&gt; 3000)\n  )\n\n  def calculateShipping(order: ShippingOrder): Int =\n    if isFreeShipping(order.total) then 0\n    else\n      val isLight = order.weight &lt; 5.0\n      shippingRates.get(order.region)\n        .flatMap(_.get(isLight))\n        .getOrElse(500)\n</code></pre>"},{"location":"scala/06-tdd-functional/#10-","title":"10. \u30d1\u30b9\u30ef\u30fc\u30c9\u30d0\u30ea\u30c7\u30fc\u30bf\u30fc - \u30eb\u30fc\u30eb\u306e\u5408\u6210","text":"<pre><code>object PasswordValidator:\n  type Rule = String =&gt; Option[String]\n\n  def minLength(min: Int): Rule = password =&gt;\n    if password.length &gt;= min then None\n    else Some(s\"Password must be at least $min characters\")\n\n  val hasUppercase: Rule = password =&gt;\n    if password.exists(_.isUpper) then None\n    else Some(\"Password must contain at least one uppercase letter\")\n\n  val hasLowercase: Rule = password =&gt;\n    if password.exists(_.isLower) then None\n    else Some(\"Password must contain at least one lowercase letter\")\n\n  val hasDigit: Rule = password =&gt;\n    if password.exists(_.isDigit) then None\n    else Some(\"Password must contain at least one digit\")\n\n  val defaultRules: List[Rule] = List(\n    minLength(8), hasUppercase, hasLowercase, hasDigit\n  )\n\n  def validate(password: String, rules: List[Rule] = defaultRules): Either[List[String], String] =\n    val errors = rules.flatMap(_(password))\n    if errors.isEmpty then Right(password)\n    else Left(errors)\n</code></pre>"},{"location":"scala/06-tdd-functional/#tdd_1","title":"TDD \u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9","text":""},{"location":"scala/06-tdd-functional/#1","title":"1. \u5c0f\u3055\u306a\u30b9\u30c6\u30c3\u30d7\u3067\u9032\u3080","text":"<ul> <li>\u4e00\u5ea6\u306b1\u3064\u306e\u30c6\u30b9\u30c8\u3060\u3051\u3092\u8ffd\u52a0</li> <li>\u30c6\u30b9\u30c8\u304c\u901a\u3063\u305f\u3089\u6b21\u306e\u30c6\u30b9\u30c8\u3078</li> </ul>"},{"location":"scala/06-tdd-functional/#2_1","title":"2. \u30c6\u30b9\u30c8\u540d\u306f\u4ed5\u69d8\u3068\u3057\u3066\u8aad\u3081\u308b","text":"<pre><code>test(\"10000\u5186\u4ee5\u4e0a\u306f\u9001\u6599\u7121\u6599\")\ntest(\"\u8ca0\u306e\u6570\u306f\u4f8b\u5916\u3092\u30b9\u30ed\u30fc\u3059\u308b\")\ntest(\"\u30d1\u30fc\u30d5\u30a7\u30af\u30c8\u30b2\u30fc\u30e0\u306f300\u70b9\")\n</code></pre>"},{"location":"scala/06-tdd-functional/#3_1","title":"3. \u7d14\u7c8b\u95a2\u6570\u3092\u512a\u5148","text":"<ul> <li>\u526f\u4f5c\u7528\u3092\u6301\u3064\u95a2\u6570\u306f\u6700\u5c0f\u9650\u306b</li> <li>\u526f\u4f5c\u7528\u306f\u5883\u754c\u306b\u8ffd\u3044\u51fa\u3059</li> </ul>"},{"location":"scala/06-tdd-functional/#4_1","title":"4. \u30a8\u30c3\u30b8\u30b1\u30fc\u30b9\u3092\u30c6\u30b9\u30c8","text":"<pre><code>test(\"\u7a7a\u6587\u5b57\u5217\u306f0\u3092\u8fd4\u3059\")\ntest(\"\u7a7a\u306e\u30ea\u30b9\u30c8\u306f\u7a7a\u306e\u30ea\u30b9\u30c8\u3092\u8fd4\u3059\")\ntest(\"\u7bc4\u56f2\u5916\u306e\u5024\u306f\u4f8b\u5916\u3092\u30b9\u30ed\u30fc\u3059\u308b\")\n</code></pre>"},{"location":"scala/06-tdd-functional/#clojure","title":"Clojure \u3068\u306e\u6bd4\u8f03","text":"\u6982\u5ff5 Clojure Scala \u30c6\u30b9\u30c8\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af speclj, clojure.test ScalaTest \u30c6\u30b9\u30c8\u69cb\u6587 <code>(it \"...\" (should= ...))</code> <code>test(\"...\") { ... shouldBe ... }</code> \u4f8b\u5916\u30c6\u30b9\u30c8 <code>(should-throw ...)</code> <code>intercept[...] { ... }</code> \u30c7\u30fc\u30bf\u69cb\u9020 \u6c38\u7d9a\u5316\u30c7\u30fc\u30bf\u69cb\u9020\uff08\u30c7\u30d5\u30a9\u30eb\u30c8\uff09 <code>case class</code> + <code>copy</code> \u30eb\u30fc\u30d7 <code>loop/recur</code> <code>@annotation.tailrec</code> \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1 <code>cond</code>, <code>case</code> <code>match</code>"},{"location":"scala/06-tdd-functional/#_14","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001TDD \u3068\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>Red-Green-Refactor: \u57fa\u672c\u30b5\u30a4\u30af\u30eb</li> <li>FizzBuzz: \u5178\u578b\u7684\u306a TDD \u4f8b</li> <li>\u30ed\u30fc\u30de\u6570\u5b57: \u30c7\u30fc\u30bf\u99c6\u52d5\u306e\u5b9f\u88c5</li> <li>\u30dc\u30a6\u30ea\u30f3\u30b0: \u8907\u96d1\u306a\u30d3\u30b8\u30cd\u30b9\u30ed\u30b8\u30c3\u30af</li> <li>\u7d20\u6570: \u30b7\u30f3\u30d7\u30eb\u306a\u95a2\u6570\u8a2d\u8a08</li> <li>\u30b9\u30bf\u30c3\u30af/\u30ad\u30e5\u30fc: \u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020</li> <li>\u6587\u5b57\u5217\u96fb\u5353: \u6bb5\u968e\u7684\u306a\u8981\u4ef6\u8ffd\u52a0</li> <li>\u7d14\u7c8b\u95a2\u6570: \u30c6\u30b9\u30c8\u5bb9\u6613\u6027</li> <li>\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0: \u6761\u4ef6\u5206\u5c90\u306e\u6574\u7406</li> <li>\u30d1\u30b9\u30ef\u30fc\u30c9\u30d0\u30ea\u30c7\u30fc\u30bf\u30fc: \u30eb\u30fc\u30eb\u306e\u5408\u6210</li> </ol> <p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3068 TDD \u306e\u7d44\u307f\u5408\u308f\u305b\u306b\u3088\u308a\u3001\u4fe1\u983c\u6027\u306e\u9ad8\u3044\u30b3\u30fc\u30c9\u3092\u52b9\u7387\u7684\u306b\u958b\u767a\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"scala/06-tdd-functional/#_15","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/scala/part2/src/main/scala/TddFunctional.scala</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/scala/part2/src/test/scala/TddFunctionalSpec.scala</code></li> </ul>"},{"location":"scala/06-tdd-functional/#_16","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u304b\u3089\u7b2c3\u90e8\u300c\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3 - \u69cb\u9020\u30d1\u30bf\u30fc\u30f3\u300d\u306b\u5165\u308a\u307e\u3059\u3002Composite \u30d1\u30bf\u30fc\u30f3\u3092\u95a2\u6570\u578b\u30b9\u30bf\u30a4\u30eb\u3067\u5b9f\u88c5\u3059\u308b\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"scala/07-composite-pattern/","title":"\u7b2c7\u7ae0: Composite \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"scala/07-composite-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Composite \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u30c4\u30ea\u30fc\u69cb\u9020\u3067\u69cb\u6210\u3057\u3001\u500b\u3005\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u96c6\u5408\u3092\u540c\u3058\u3088\u3046\u306b\u6271\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u3053\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306f\u500b\u3005\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u305d\u306e\u7d44\u307f\u5408\u308f\u305b\u3092\u533a\u5225\u305b\u305a\u306b\u64cd\u4f5c\u3067\u304d\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u56f3\u5f62\uff08Shape\uff09\u3001\u30b9\u30a4\u30c3\u30c1\uff08Switchable\uff09\u3001\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3001\u30e1\u30cb\u30e5\u30fc\u3001\u6570\u5f0f\u306a\u3069\u3001\u69d8\u3005\u306a\u4f8b\u3092\u901a\u3058\u3066 Composite \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"scala/07-composite-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Composite \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Component: \u5168\u3066\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u5171\u901a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>Leaf: \u5b50\u8981\u7d20\u3092\u6301\u305f\u306a\u3044\u672b\u7aef\u30aa\u30d6\u30b8\u30a7\u30af\u30c8</li> <li>Composite: \u5b50\u8981\u7d20\u3092\u6301\u3064\u30b3\u30f3\u30c6\u30ca\u30aa\u30d6\u30b8\u30a7\u30af\u30c8</li> </ul> <p></p>"},{"location":"scala/07-composite-pattern/#2-shape-composite","title":"2. Shape \u306e\u4f8b - \u56f3\u5f62\u306e Composite \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"scala/07-composite-pattern/#sealed-trait","title":"sealed trait \u306b\u3088\u308b\u5171\u901a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9","text":"<pre><code>/** 2D\u5ea7\u6a19 */\ncase class Point(x: Double, y: Double):\n  def +(other: Point): Point = Point(x + other.x, y + other.y)\n  def *(factor: Double): Point = Point(x * factor, y * factor)\n\n/** \u56f3\u5f62\u306e\u5171\u901a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\uff08sealed trait\uff09 */\nsealed trait Shape:\n  def translate(dx: Double, dy: Double): Shape\n  def scale(factor: Double): Shape\n  def area: Double\n  def boundingBox: BoundingBox\n</code></pre>"},{"location":"scala/07-composite-pattern/#leaf","title":"Leaf \u306e\u5b9f\u88c5","text":"<pre><code>/** \u5186\uff08Leaf\uff09 */\ncase class Circle(center: Point, radius: Double) extends Shape:\n  def translate(dx: Double, dy: Double): Circle =\n    copy(center = Point(center.x + dx, center.y + dy))\n\n  def scale(factor: Double): Circle =\n    copy(radius = radius * factor)\n\n  def area: Double = math.Pi * radius * radius\n\n  def boundingBox: BoundingBox =\n    BoundingBox(\n      Point(center.x - radius, center.y - radius),\n      Point(center.x + radius, center.y + radius)\n    )\n\n/** \u6b63\u65b9\u5f62\uff08Leaf\uff09 */\ncase class Square(topLeft: Point, side: Double) extends Shape:\n  def translate(dx: Double, dy: Double): Square =\n    copy(topLeft = Point(topLeft.x + dx, topLeft.y + dy))\n\n  def scale(factor: Double): Square =\n    copy(side = side * factor)\n\n  def area: Double = side * side\n\n  def boundingBox: BoundingBox =\n    BoundingBox(topLeft, Point(topLeft.x + side, topLeft.y + side))\n</code></pre>"},{"location":"scala/07-composite-pattern/#composite","title":"Composite \u306e\u5b9f\u88c5","text":"<pre><code>/** \u8907\u5408\u56f3\u5f62\uff08Composite\uff09 */\ncase class CompositeShape(shapes: List[Shape] = Nil) extends Shape:\n  def add(shape: Shape): CompositeShape = copy(shapes = shapes :+ shape)\n  def remove(shape: Shape): CompositeShape = copy(shapes = shapes.filterNot(_ == shape))\n\n  def translate(dx: Double, dy: Double): CompositeShape =\n    copy(shapes = shapes.map(_.translate(dx, dy)))\n\n  def scale(factor: Double): CompositeShape =\n    copy(shapes = shapes.map(_.scale(factor)))\n\n  def area: Double = shapes.map(_.area).sum\n\n  def boundingBox: BoundingBox =\n    shapes match\n      case Nil =&gt; BoundingBox(Point(0, 0), Point(0, 0))\n      case head :: tail =&gt; tail.foldLeft(head.boundingBox)((acc, s) =&gt; acc.union(s.boundingBox))\n\n  def flatten: List[Shape] =\n    shapes.flatMap {\n      case cs: CompositeShape =&gt; cs.flatten\n      case s =&gt; List(s)\n    }\n</code></pre>"},{"location":"scala/07-composite-pattern/#_2","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// \u500b\u3005\u306e\u56f3\u5f62\u3092\u4f5c\u6210\nval circle = Circle(Point(10, 10), 5)\nval square = Square(Point(0, 0), 10)\n\n// \u8907\u5408\u56f3\u5f62\u3092\u4f5c\u6210\nval group = CompositeShape()\n  .add(circle)\n  .add(square)\n\n// \u8907\u5408\u56f3\u5f62\u3092\u79fb\u52d5\uff08\u5168\u3066\u306e\u5b50\u8981\u7d20\u304c\u79fb\u52d5\u3059\u308b\uff09\nval moved = group.translate(5, 5)\n\n// \u8907\u5408\u56f3\u5f62\u3092\u62e1\u5927\uff08\u5168\u3066\u306e\u5b50\u8981\u7d20\u304c\u62e1\u5927\u3059\u308b\uff09\nval scaled = group.scale(2)\n\n// \u9762\u7a4d\u306f\u5168\u3066\u306e\u5b50\u8981\u7d20\u306e\u5408\u8a08\nval totalArea = group.area\n</code></pre>"},{"location":"scala/07-composite-pattern/#3-switchable-composite","title":"3. Switchable \u306e\u4f8b - \u30b9\u30a4\u30c3\u30c1\u306e Composite \u30d1\u30bf\u30fc\u30f3","text":"<pre><code>/** \u30b9\u30a4\u30c3\u30c1\u306e\u5171\u901a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9 */\nsealed trait Switchable:\n  def turnOn: Switchable\n  def turnOff: Switchable\n  def isOn: Boolean\n\n/** \u7167\u660e\uff08Leaf\uff09 */\ncase class Light(on: Boolean = false, name: String = \"Light\") extends Switchable:\n  def turnOn: Light = copy(on = true)\n  def turnOff: Light = copy(on = false)\n  def isOn: Boolean = on\n\n/** \u8abf\u5149\u53ef\u80fd\u306a\u7167\u660e\uff08Leaf\uff09 */\ncase class DimmableLight(intensity: Int = 0, name: String = \"DimmableLight\") extends Switchable:\n  def turnOn: DimmableLight = copy(intensity = 100)\n  def turnOff: DimmableLight = copy(intensity = 0)\n  def isOn: Boolean = intensity &gt; 0\n  def setIntensity(value: Int): DimmableLight =\n    copy(intensity = math.max(0, math.min(100, value)))\n\n/** \u8907\u5408\u30b9\u30a4\u30c3\u30c1\uff08Composite\uff09 */\ncase class CompositeSwitchable(\n  switchables: List[Switchable] = Nil,\n  name: String = \"Group\"\n) extends Switchable:\n\n  def add(switchable: Switchable): CompositeSwitchable =\n    copy(switchables = switchables :+ switchable)\n\n  def turnOn: CompositeSwitchable =\n    copy(switchables = switchables.map(_.turnOn))\n\n  def turnOff: CompositeSwitchable =\n    copy(switchables = switchables.map(_.turnOff))\n\n  def isOn: Boolean = switchables.exists(_.isOn)\n  def allOn: Boolean = switchables.nonEmpty &amp;&amp; switchables.forall(_.isOn)\n</code></pre>"},{"location":"scala/07-composite-pattern/#_3","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>val bedroom = CompositeSwitchable(name = \"Bedroom\")\n  .add(Light(name = \"Ceiling\"))\n  .add(DimmableLight(name = \"Bedside\"))\n\nval livingRoom = CompositeSwitchable(name = \"LivingRoom\")\n  .add(Light(name = \"Main\"))\n  .add(Fan(name = \"Ceiling Fan\"))\n\nval house = CompositeSwitchable(name = \"House\")\n  .add(bedroom)\n  .add(livingRoom)\n\n// \u5bb6\u4e2d\u306e\u5168\u3066\u306e\u30b9\u30a4\u30c3\u30c1\u3092\u30aa\u30f3\nval allOn = house.turnOn\n</code></pre>"},{"location":"scala/07-composite-pattern/#4-filesystem","title":"4. FileSystem \u306e\u4f8b","text":"<pre><code>/** \u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u30a8\u30f3\u30c8\u30ea\u306e\u5171\u901a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9 */\nsealed trait FileSystemEntry:\n  def name: String\n  def size: Long\n  def path: String\n  def find(predicate: FileSystemEntry =&gt; Boolean): List[FileSystemEntry]\n\n/** \u30d5\u30a1\u30a4\u30eb\uff08Leaf\uff09 */\ncase class File(name: String, size: Long, parentPath: String = \"\") extends FileSystemEntry:\n  def path: String = if parentPath.isEmpty then name else s\"$parentPath/$name\"\n  def find(predicate: FileSystemEntry =&gt; Boolean): List[FileSystemEntry] =\n    if predicate(this) then List(this) else Nil\n\n/** \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\uff08Composite\uff09 */\ncase class Directory(\n  name: String,\n  children: List[FileSystemEntry] = Nil,\n  parentPath: String = \"\"\n) extends FileSystemEntry:\n\n  def add(entry: FileSystemEntry): Directory = ...\n  def size: Long = children.map(_.size).sum\n  def fileCount: Int = ...\n  def directoryCount: Int = ...\n</code></pre>"},{"location":"scala/07-composite-pattern/#5-expression-composite","title":"5. Expression \u306e\u4f8b - \u6570\u5f0f\u306e Composite \u30d1\u30bf\u30fc\u30f3","text":"<pre><code>/** \u6570\u5f0f\u306e\u5171\u901a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9 */\nsealed trait Expression:\n  def evaluate: Double\n  def simplify: Expression\n  def variables: Set[String]\n\n/** \u6570\u5024\uff08Leaf\uff09 */\ncase class Number(value: Double) extends Expression:\n  def evaluate: Double = value\n  def simplify: Expression = this\n  def variables: Set[String] = Set.empty\n\n/** \u5909\u6570\uff08Leaf\uff09 */\ncase class Variable(name: String, value: Option[Double] = None) extends Expression:\n  def evaluate: Double = value.getOrElse(\n    throw new IllegalStateException(s\"Variable $name has no value\")\n  )\n  def simplify: Expression = value.map(Number(_)).getOrElse(this)\n  def variables: Set[String] = if value.isEmpty then Set(name) else Set.empty\n\n/** \u52a0\u7b97\uff08Composite\uff09 */\ncase class Add(left: Expression, right: Expression) extends Expression:\n  def evaluate: Double = left.evaluate + right.evaluate\n\n  def simplify: Expression =\n    (left.simplify, right.simplify) match\n      case (Number(0), r) =&gt; r\n      case (l, Number(0)) =&gt; l\n      case (Number(a), Number(b)) =&gt; Number(a + b)\n      case (l, r) =&gt; Add(l, r)\n\n  def variables: Set[String] = left.variables ++ right.variables\n</code></pre>"},{"location":"scala/07-composite-pattern/#_4","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// (2 + 3) * 4 = 20\nval expr = Multiply(Add(Number(2), Number(3)), Number(4))\nexpr.evaluate // 20.0\n\n// \u5909\u6570\u3092\u542b\u3080\u5f0f\nval exprWithVars = Add(Variable(\"x\"), Variable(\"y\"))\nval bound = Expression.bind(exprWithVars, Map(\"x\" -&gt; 10.0, \"y\" -&gt; 20.0))\nbound.evaluate // 30.0\n\n// \u5f0f\u306e\u7c21\u7565\u5316\nAdd(Variable(\"x\"), Number(0)).simplify // Variable(\"x\")\nMultiply(Variable(\"x\"), Number(1)).simplify // Variable(\"x\")\n</code></pre>"},{"location":"scala/07-composite-pattern/#6","title":"6. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u7d71\u4e00\u7684\u306a\u64cd\u4f5c: \u500b\u3005\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u30b0\u30eb\u30fc\u30d7\u3092\u540c\u3058\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u64cd\u4f5c\u53ef\u80fd</li> <li>\u968e\u5c64\u69cb\u9020: \u30cd\u30b9\u30c8\u3057\u305f\u69cb\u9020\u3092\u81ea\u7136\u306b\u8868\u73fe\u53ef\u80fd</li> <li>\u62e1\u5f35\u6027: \u65b0\u3057\u3044 Leaf \u3084 Composite \u3092\u8ffd\u52a0\u3057\u3084\u3059\u3044</li> <li>\u518d\u5e30\u7684\u306a\u69cb\u9020: Composite \u306f\u4ed6\u306e Composite \u3092\u542b\u3080\u3053\u3068\u3082\u53ef\u80fd</li> </ol>"},{"location":"scala/07-composite-pattern/#7-scala","title":"7. Scala \u3067\u306e\u7279\u5fb4","text":""},{"location":"scala/07-composite-pattern/#sealed-trait_1","title":"sealed trait \u306b\u3088\u308b\u7db2\u7f85\u6027\u30c1\u30a7\u30c3\u30af","text":"<pre><code>sealed trait Shape\ncase class Circle(...) extends Shape\ncase class Square(...) extends Shape\ncase class CompositeShape(...) extends Shape\n\n// \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u3067\u5168\u30b1\u30fc\u30b9\u3092\u30ab\u30d0\u30fc\u3057\u306a\u3044\u3068\u8b66\u544a\ndef process(shape: Shape): Unit = shape match\n  case Circle(...) =&gt; ...\n  case Square(...) =&gt; ...\n  // CompositeShape \u3092\u5fd8\u308c\u308b\u3068\u8b66\u544a\n</code></pre>"},{"location":"scala/07-composite-pattern/#case-class","title":"case class \u306b\u3088\u308b\u4e0d\u5909\u6027","text":"<pre><code>// \u5168\u3066\u306e\u64cd\u4f5c\u304c\u65b0\u3057\u3044\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u8fd4\u3059\uff08\u5143\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306f\u5909\u66f4\u3055\u308c\u306a\u3044\uff09\nval original = CompositeShape().add(Circle(Point(0, 0), 5))\nval moved = original.translate(10, 10)\n\n// original \u306f\u5909\u66f4\u3055\u308c\u3066\u3044\u306a\u3044\noriginal.shapes(0).asInstanceOf[Circle].center // Point(0, 0)\nmoved.shapes(0).asInstanceOf[Circle].center    // Point(10, 10)\n</code></pre>"},{"location":"scala/07-composite-pattern/#copy","title":"copy \u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u7c21\u6f54\u306a\u66f4\u65b0","text":"<pre><code>case class Circle(center: Point, radius: Double):\n  def translate(dx: Double, dy: Double): Circle =\n    copy(center = Point(center.x + dx, center.y + dy))\n</code></pre>"},{"location":"scala/07-composite-pattern/#clojure","title":"Clojure \u3068\u306e\u6bd4\u8f03","text":"\u6982\u5ff5 Clojure Scala \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9 \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9 sealed trait Leaf defmethod case class extends trait Composite defmethod + mapv case class extends trait \u30c7\u30fc\u30bf\u69cb\u9020 \u30de\u30c3\u30d7 case class \u64cd\u4f5c\u306e\u59d4\u8b72 mapv shapes.map(...) \u4e0d\u5909\u6027 \u30c7\u30d5\u30a9\u30eb\u30c8 case class + copy"},{"location":"scala/07-composite-pattern/#_5","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Composite \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>Shape \u306e\u4f8b: \u56f3\u5f62\u306e\u79fb\u52d5\u3068\u62e1\u5927\u3092\u7d71\u4e00\u7684\u306b\u64cd\u4f5c</li> <li>Switchable \u306e\u4f8b: \u8907\u6570\u306e\u30b9\u30a4\u30c3\u30c1\u3092\u30b0\u30eb\u30fc\u30d7\u5316\u3057\u3066\u64cd\u4f5c</li> <li>FileSystem \u306e\u4f8b: \u30d5\u30a1\u30a4\u30eb\u3068\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306e\u968e\u5c64\u69cb\u9020</li> <li>Menu \u306e\u4f8b: \u5358\u54c1\u3068\u30bb\u30c3\u30c8\u30e1\u30cb\u30e5\u30fc\u306e\u4fa1\u683c\u8a08\u7b97</li> <li>Expression \u306e\u4f8b: \u6570\u5f0f\u306e\u8a55\u4fa1\u3068\u7c21\u7565\u5316</li> </ol> <p>Composite \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30c4\u30ea\u30fc\u69cb\u9020\u306e\u30c7\u30fc\u30bf\u3092\u6271\u3046\u969b\u306b\u975e\u5e38\u306b\u6709\u52b9\u306a\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002Scala \u306e sealed trait \u3068 case class \u3092\u4f7f\u3046\u3053\u3068\u3067\u3001\u578b\u5b89\u5168\u3067\u4e0d\u5909\u306a\u30c4\u30ea\u30fc\u69cb\u9020\u3092\u7c21\u6f54\u306b\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"scala/07-composite-pattern/#_6","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/scala/part3/src/main/scala/CompositePattern.scala</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/scala/part3/src/test/scala/CompositePatternSpec.scala</code></li> </ul>"},{"location":"scala/07-composite-pattern/#_7","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Decorator \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u65e2\u5b58\u306e\u6a5f\u80fd\u306b\u65b0\u3057\u3044\u6a5f\u80fd\u3092\u52d5\u7684\u306b\u8ffd\u52a0\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"scala/08-decorator-pattern/","title":"\u7b2c8\u7ae0: Decorator \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"scala/08-decorator-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Decorator \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u65e2\u5b58\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u65b0\u3057\u3044\u6a5f\u80fd\u3092\u52d5\u7684\u306b\u8ffd\u52a0\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u3053\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u30b5\u30d6\u30af\u30e9\u30b9\u5316\u306b\u3088\u308b\u7d99\u627f\u3088\u308a\u3082\u67d4\u8edf\u306a\u65b9\u6cd5\u3067\u6a5f\u80fd\u3092\u62e1\u5f35\u3067\u304d\u307e\u3059\u3002</p> <p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u9ad8\u968e\u95a2\u6570\u3092\u4f7f\u3063\u3066\u95a2\u6570\u3092\u30e9\u30c3\u30d7\u3057\u3001\u6a2a\u65ad\u7684\u95a2\u5fc3\u4e8b\uff08\u30ed\u30b0\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u3001\u8a8d\u8a3c\u306a\u3069\uff09\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\u672c\u7ae0\u3067\u306f\u3001\u5f62\u72b6\u306e\u30b8\u30e3\u30fc\u30ca\u30ea\u30f3\u30b0\u3068\u95a2\u6570\u30c7\u30b3\u30ec\u30fc\u30bf\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"scala/08-decorator-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":""},{"location":"scala/08-decorator-pattern/#2-journaledshape-","title":"2. JournaledShape - \u5f62\u72b6\u30c7\u30b3\u30ec\u30fc\u30bf","text":""},{"location":"scala/08-decorator-pattern/#_2","title":"\u57fa\u672c\u5f62\u72b6\u306e\u5b9a\u7fa9","text":"<pre><code>trait Shape:\n  def translate(dx: Double, dy: Double): Shape\n  def scale(factor: Double): Shape\n  def area: Double\n\ncase class Circle(centerX: Double, centerY: Double, radius: Double) extends Shape:\n  def translate(dx: Double, dy: Double): Circle =\n    copy(centerX = centerX + dx, centerY = centerY + dy)\n  def scale(factor: Double): Circle = copy(radius = radius * factor)\n  def area: Double = math.Pi * radius * radius\n</code></pre>"},{"location":"scala/08-decorator-pattern/#_3","title":"\u30b8\u30e3\u30fc\u30ca\u30eb\u4ed8\u304d\u5f62\u72b6\uff08\u30c7\u30b3\u30ec\u30fc\u30bf\uff09","text":"<pre><code>enum JournalEntry:\n  case Translate(dx: Double, dy: Double)\n  case Scale(factor: Double)\n  case Rotate(angle: Double)\n\ncase class JournaledShape(\n  shape: Shape,\n  journal: List[JournalEntry] = Nil\n) extends Shape:\n\n  def translate(dx: Double, dy: Double): JournaledShape =\n    copy(\n      shape = shape.translate(dx, dy),\n      journal = journal :+ JournalEntry.Translate(dx, dy)\n    )\n\n  def scale(factor: Double): JournaledShape =\n    copy(\n      shape = shape.scale(factor),\n      journal = journal :+ JournalEntry.Scale(factor)\n    )\n\n  def area: Double = shape.area\n\n  def clearJournal: JournaledShape = copy(journal = Nil)\n\n  def replay(entries: List[JournalEntry]): JournaledShape =\n    entries.foldLeft(this) { (js, entry) =&gt;\n      entry match\n        case JournalEntry.Translate(dx, dy) =&gt; js.translate(dx, dy)\n        case JournalEntry.Scale(factor) =&gt; js.scale(factor)\n        case JournalEntry.Rotate(_) =&gt; js\n    }\n</code></pre>"},{"location":"scala/08-decorator-pattern/#_4","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>val circle = Circle(0, 0, 5)\nval journaled = JournaledShape(circle)\n  .translate(2, 3)\n  .scale(5)\n\njournaled.journal // List(Translate(2, 3), Scale(5))\njournaled.shape   // Circle(2, 3, 25)\n</code></pre>"},{"location":"scala/08-decorator-pattern/#3","title":"3. \u95a2\u6570\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u9ad8\u968e\u95a2\u6570\u3092\u4f7f\u3063\u3066\u95a2\u6570\u3092\u30c7\u30b3\u30ec\u30fc\u30c8\u3057\u307e\u3059\u3002</p>"},{"location":"scala/08-decorator-pattern/#_5","title":"\u30ed\u30b0\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>def withLogging[A, B](f: A =&gt; B, name: String)(implicit log: LogCollector): A =&gt; B =\n  (a: A) =&gt;\n    log.add(s\"[$name] called with: $a\")\n    val result = f(a)\n    log.add(s\"[$name] returned: $result\")\n    result\n\n// \u4f7f\u7528\u4f8b\nimplicit val log = new LogCollector\nval add: Int =&gt; Int = _ + 10\nval logged = withLogging(add, \"add\")\nlogged(5) // 15 (\u30ed\u30b0\u3082\u8a18\u9332\u3055\u308c\u308b)\n</code></pre>"},{"location":"scala/08-decorator-pattern/#_6","title":"\u30ea\u30c8\u30e9\u30a4\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>def withRetry[A, B](f: A =&gt; B, maxRetries: Int, delay: Long = 0): A =&gt; B =\n  (a: A) =&gt;\n    def attempt(remaining: Int): B =\n      Try(f(a)) match\n        case Success(result) =&gt; result\n        case Failure(e) if remaining &gt; 0 =&gt;\n          if delay &gt; 0 then Thread.sleep(delay)\n          attempt(remaining - 1)\n        case Failure(e) =&gt; throw e\n    attempt(maxRetries)\n\n// \u4f7f\u7528\u4f8b\nval unreliableFn = withRetry(callExternalService, maxRetries = 3)\n</code></pre>"},{"location":"scala/08-decorator-pattern/#_7","title":"\u30ad\u30e3\u30c3\u30b7\u30e5\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>def withCache[A, B](f: A =&gt; B): A =&gt; B =\n  val cache = mutable.Map.empty[A, B]\n  (a: A) =&gt; cache.getOrElseUpdate(a, f(a))\n\n// TTL\u4ed8\u304d\u30ad\u30e3\u30c3\u30b7\u30e5\ndef withTTLCache[A, B](f: A =&gt; B, ttlMs: Long): A =&gt; B =\n  val cache = mutable.Map.empty[A, (B, Long)]\n  (a: A) =&gt;\n    val now = System.currentTimeMillis()\n    cache.get(a) match\n      case Some((value, timestamp)) if now - timestamp &lt; ttlMs =&gt; value\n      case _ =&gt;\n        val result = f(a)\n        cache(a) = (result, now)\n        result\n</code></pre>"},{"location":"scala/08-decorator-pattern/#_8","title":"\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>def withValidation[A, B](f: A =&gt; B)(validator: A =&gt; Boolean, errorMsg: String): A =&gt; B =\n  (a: A) =&gt;\n    if validator(a) then f(a)\n    else throw new IllegalArgumentException(s\"$errorMsg: $a\")\n\n// \u4f7f\u7528\u4f8b\nval positiveOnly = withValidation[Int, Int](_ * 2)(_ &gt; 0, \"Must be positive\")\npositiveOnly(5)   // 10\npositiveOnly(-5)  // Exception!\n</code></pre>"},{"location":"scala/08-decorator-pattern/#_9","title":"\u30a8\u30e9\u30fc\u30cf\u30f3\u30c9\u30ea\u30f3\u30b0\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>// Option \u306b\u5909\u63db\ndef withOptionResult[A, B](f: A =&gt; B): A =&gt; Option[B] =\n  (a: A) =&gt; Try(f(a)).toOption\n\n// Either \u306b\u5909\u63db\ndef withEitherResult[A, B](f: A =&gt; B): A =&gt; Either[Throwable, B] =\n  (a: A) =&gt; Try(f(a)).toEither\n\n// \u30c7\u30d5\u30a9\u30eb\u30c8\u5024\u3092\u8fd4\u3059\ndef withDefault[A, B](f: A =&gt; B, default: B): A =&gt; B =\n  (a: A) =&gt; Try(f(a)).getOrElse(default)\n</code></pre>"},{"location":"scala/08-decorator-pattern/#4","title":"4. \u30c7\u30b3\u30ec\u30fc\u30bf\u306e\u5408\u6210","text":"<pre><code>object DecoratorComposition:\n  def compose[A, B](f: A =&gt; B, decorators: List[(A =&gt; B) =&gt; (A =&gt; B)]): A =&gt; B =\n    decorators.foldLeft(f) { (decorated, decorator) =&gt;\n      decorator(decorated)\n    }\n\n// \u4f7f\u7528\u4f8b\nval fn: Int =&gt; Int = _ * 2\nval decorators: List[(Int =&gt; Int) =&gt; (Int =&gt; Int)] = List(\n  f =&gt; withCache(f),\n  f =&gt; withLogging(f, \"fn\")\n)\nval composed = DecoratorComposition.compose(fn, decorators)\n</code></pre>"},{"location":"scala/08-decorator-pattern/#5-auditedlist-","title":"5. AuditedList - \u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>case class AuditedList[A](\n  items: List[A],\n  operations: List[String] = Nil\n):\n  def add(item: A): AuditedList[A] =\n    copy(items = items :+ item, operations = operations :+ s\"add($item)\")\n\n  def remove(item: A): AuditedList[A] =\n    copy(items = items.filterNot(_ == item), operations = operations :+ s\"remove($item)\")\n\n  def map[B](f: A =&gt; B): AuditedList[B] =\n    AuditedList(items.map(f), operations :+ \"map\")\n\n  def filter(p: A =&gt; Boolean): AuditedList[A] =\n    copy(items = items.filter(p), operations :+ \"filter\")\n\n// \u4f7f\u7528\u4f8b\nval list = AuditedList.empty[Int].add(1).add(2).add(3)\nlist.operations // List(\"add(1)\", \"add(2)\", \"add(3)\")\n</code></pre>"},{"location":"scala/08-decorator-pattern/#6-http","title":"6. HTTP\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u30c7\u30b3\u30ec\u30fc\u30bf","text":"<pre><code>trait HttpClient:\n  def get(url: String): HttpResponse\n\nclass SimpleHttpClient extends HttpClient:\n  def get(url: String): HttpResponse = HttpResponse(200, s\"Response from $url\")\n\n// \u30ed\u30b0\u4ed8\u304d\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\nclass LoggingHttpClient(client: HttpClient)(implicit log: LogCollector) extends HttpClient:\n  def get(url: String): HttpResponse =\n    log.add(s\"[HTTP] GET $url\")\n    val response = client.get(url)\n    log.add(s\"[HTTP] Response: ${response.status}\")\n    response\n\n// \u30ad\u30e3\u30c3\u30b7\u30e5\u4ed8\u304d\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\nclass CachingHttpClient(client: HttpClient) extends HttpClient:\n  private val cache = mutable.Map.empty[String, HttpResponse]\n  def get(url: String): HttpResponse = cache.getOrElseUpdate(url, client.get(url))\n\n// \u30c7\u30b3\u30ec\u30fc\u30bf\u306e\u7d44\u307f\u5408\u308f\u305b\nval client = new LoggingHttpClient(\n  new CachingHttpClient(\n    new SimpleHttpClient\n  )\n)\n</code></pre>"},{"location":"scala/08-decorator-pattern/#7-functionbuilder-","title":"7. FunctionBuilder - \u30d3\u30eb\u30c0\u30fc\u30b9\u30bf\u30a4\u30eb","text":"<pre><code>class FunctionBuilder[A, B](f: A =&gt; B):\n  private var current: A =&gt; B = f\n\n  def withLogging(name: String)(implicit log: LogCollector): FunctionBuilder[A, B] =\n    current = FunctionDecorators.withLogging(current, name)\n    this\n\n  def withCache(): FunctionBuilder[A, B] =\n    current = FunctionDecorators.withCache(current)\n    this\n\n  def withValidation(validator: A =&gt; Boolean, errorMsg: String): FunctionBuilder[A, B] =\n    current = FunctionDecorators.withValidation(current)(validator, errorMsg)\n    this\n\n  def build: A =&gt; B = current\n\n// \u4f7f\u7528\u4f8b\nval fn = FunctionBuilder[Int, Int](_ * 2)\n  .withLogging(\"double\")\n  .withCache()\n  .withValidation(_ &gt; 0, \"Must be positive\")\n  .build\n</code></pre>"},{"location":"scala/08-decorator-pattern/#8","title":"8. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u5358\u4e00\u8cac\u4efb\u306e\u539f\u5247: \u5404\u30c7\u30b3\u30ec\u30fc\u30bf\u306f\u4e00\u3064\u306e\u6a5f\u80fd\u306e\u307f\u3092\u8ffd\u52a0</li> <li>\u958b\u653e/\u9589\u9396\u306e\u539f\u5247: \u65e2\u5b58\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u305b\u305a\u306b\u6a5f\u80fd\u3092\u8ffd\u52a0</li> <li>\u67d4\u8edf\u306a\u7d44\u307f\u5408\u308f\u305b: \u5fc5\u8981\u306a\u6a5f\u80fd\u3060\u3051\u3092\u9078\u629e\u3057\u3066\u7d44\u307f\u5408\u308f\u305b\u53ef\u80fd</li> <li>\u5b9f\u884c\u6642\u306e\u6c7a\u5b9a: \u3069\u306e\u30c7\u30b3\u30ec\u30fc\u30bf\u3092\u9069\u7528\u3059\u308b\u304b\u5b9f\u884c\u6642\u306b\u6c7a\u5b9a\u53ef\u80fd</li> </ol>"},{"location":"scala/08-decorator-pattern/#clojure","title":"Clojure \u3068\u306e\u6bd4\u8f03","text":"\u6982\u5ff5 Clojure Scala \u9ad8\u968e\u95a2\u6570 <code>(defn with-logging [f] ...)</code> <code>def withLogging[A,B](f: A =&gt; B): A =&gt; B</code> \u30af\u30ed\u30fc\u30b8\u30e3 <code>(let [cache (atom {})] ...)</code> <code>val cache = mutable.Map.empty</code> \u5408\u6210 <code>(comp decorator1 decorator2)</code> <code>compose(f, decorators)</code> \u72b6\u614b <code>atom</code> <code>var</code> or mutable collection"},{"location":"scala/08-decorator-pattern/#_10","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Decorator \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>JournaledShape: \u5f62\u72b6\u64cd\u4f5c\u306e\u5c65\u6b74\u3092\u8a18\u9332\u3059\u308b\u30c7\u30b3\u30ec\u30fc\u30bf</li> <li>\u95a2\u6570\u30c7\u30b3\u30ec\u30fc\u30bf: \u30ed\u30b0\u3001\u30ea\u30c8\u30e9\u30a4\u3001\u30ad\u30e3\u30c3\u30b7\u30e5\u306a\u3069\u306e\u6a2a\u65ad\u7684\u95a2\u5fc3\u4e8b</li> <li>AuditedList: \u64cd\u4f5c\u5c65\u6b74\u4ed8\u304d\u30b3\u30ec\u30af\u30b7\u30e7\u30f3</li> <li>HTTP\u30af\u30e9\u30a4\u30a2\u30f3\u30c8: \u30af\u30e9\u30b9\u30d9\u30fc\u30b9\u306e\u30c7\u30b3\u30ec\u30fc\u30bf</li> <li>FunctionBuilder: \u30d3\u30eb\u30c0\u30fc\u30b9\u30bf\u30a4\u30eb\u306e\u30c7\u30b3\u30ec\u30fc\u30bf\u9069\u7528</li> </ol> <p>Decorator \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u65e2\u5b58\u306e\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u305b\u305a\u306b\u6a5f\u80fd\u3092\u62e1\u5f35\u3059\u308b\u5f37\u529b\u306a\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002</p>"},{"location":"scala/08-decorator-pattern/#_11","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/scala/part3/src/main/scala/DecoratorPattern.scala</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/scala/part3/src/test/scala/DecoratorPatternSpec.scala</code></li> </ul>"},{"location":"scala/08-decorator-pattern/#_12","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Adapter \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u7570\u306a\u308b\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u9593\u306e\u5909\u63db\u3068\u30ec\u30ac\u30b7\u30fc\u30b7\u30b9\u30c6\u30e0\u3068\u306e\u7d71\u5408\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"scala/09-adapter-pattern/","title":"\u7b2c9\u7ae0: Adapter \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"scala/09-adapter-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Adapter \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u65e2\u5b58\u306e\u30af\u30e9\u30b9\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u3001\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304c\u671f\u5f85\u3059\u308b\u5225\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306b\u5909\u63db\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u3053\u306e\u30d1\u30bf\u30fc\u30f3\u306b\u3088\u308a\u3001\u4e92\u63db\u6027\u306e\u306a\u3044\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u6301\u3064\u30af\u30e9\u30b9\u540c\u58eb\u304c\u5354\u8abf\u52d5\u4f5c\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002</p> <p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u95a2\u6570\u5909\u63db\u3084\u30c7\u30fc\u30bf\u5909\u63db\u3092\u901a\u3058\u3066\u7570\u306a\u308b\u30b7\u30b9\u30c6\u30e0\u9593\u306e\u300c\u7ffb\u8a33\u300d\u3092\u884c\u3044\u307e\u3059\u3002\u672c\u7ae0\u3067\u306f\u3001\u69d8\u3005\u306a\u30a2\u30c0\u30d7\u30bf\u30fc\u306e\u5b9f\u88c5\u30d1\u30bf\u30fc\u30f3\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"scala/09-adapter-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":""},{"location":"scala/09-adapter-pattern/#2-variablelightadapter-","title":"2. VariableLightAdapter - \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u30a2\u30c0\u30d7\u30bf\u30fc","text":""},{"location":"scala/09-adapter-pattern/#_2","title":"\u30bf\u30fc\u30b2\u30c3\u30c8\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9","text":"<pre><code>/** \u30b9\u30a4\u30c3\u30c1\u306e\u5171\u901a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9 */\ntrait Switchable:\n  def turnOn(): Switchable\n  def turnOff(): Switchable\n  def isOn: Boolean\n</code></pre>"},{"location":"scala/09-adapter-pattern/#_3","title":"\u30a2\u30c0\u30d7\u30c6\u30a3\u30fc\uff08\u65e2\u5b58\u30af\u30e9\u30b9\uff09","text":"<pre><code>/** \u53ef\u5909\u5f37\u5ea6\u30e9\u30a4\u30c8 - \u5f37\u5ea6\u30920-100\u3067\u8a2d\u5b9a\u3059\u308b\u65e2\u5b58\u30af\u30e9\u30b9 */\ncase class VariableLight(intensity: Int = 0):\n  require(intensity &gt;= 0 &amp;&amp; intensity &lt;= 100, \"Intensity must be 0-100\")\n\n  def setIntensity(value: Int): VariableLight =\n    copy(intensity = math.max(0, math.min(100, value)))\n\n  def brighten(amount: Int): VariableLight =\n    setIntensity(intensity + amount)\n\n  def dim(amount: Int): VariableLight =\n    setIntensity(intensity - amount)\n</code></pre>"},{"location":"scala/09-adapter-pattern/#_4","title":"\u30a2\u30c0\u30d7\u30bf\u30fc","text":"<pre><code>/** VariableLight \u3092 Switchable \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306b\u9069\u5fdc\u3055\u305b\u308b\u30a2\u30c0\u30d7\u30bf\u30fc */\ncase class VariableLightAdapter(\n  light: VariableLight,\n  minIntensity: Int = 0,\n  maxIntensity: Int = 100\n) extends Switchable:\n\n  def turnOn(): VariableLightAdapter =\n    copy(light = light.setIntensity(maxIntensity))\n\n  def turnOff(): VariableLightAdapter =\n    copy(light = light.setIntensity(minIntensity))\n\n  def isOn: Boolean = light.intensity &gt; minIntensity\n\n  /** \u30a2\u30c0\u30d7\u30bf\u30fc\u56fa\u6709\uff1a\u5f37\u5ea6\u3092\u53d6\u5f97 */\n  def getIntensity: Int = light.intensity\n</code></pre>"},{"location":"scala/09-adapter-pattern/#_5","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>val adapter = VariableLightAdapter(VariableLight(0))\nval onAdapter = adapter.turnOn()\nonAdapter.isOn        // true\nonAdapter.getIntensity // 100\n\nval offAdapter = onAdapter.turnOff()\noffAdapter.isOn        // false\noffAdapter.getIntensity // 0\n</code></pre>"},{"location":"scala/09-adapter-pattern/#3-userformatadapter-","title":"3. UserFormatAdapter - \u30c7\u30fc\u30bf\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u5909\u63db","text":""},{"location":"scala/09-adapter-pattern/#_6","title":"\u30c7\u30fc\u30bf\u5f62\u5f0f\u306e\u5b9a\u7fa9","text":"<pre><code>/** \u65e7\u30e6\u30fc\u30b6\u30fc\u30d5\u30a9\u30fc\u30de\u30c3\u30c8 */\ncase class OldUserFormat(\n  firstName: String,\n  lastName: String,\n  emailAddress: String,\n  phoneNumber: String\n)\n\n/** \u65b0\u30e6\u30fc\u30b6\u30fc\u30d5\u30a9\u30fc\u30de\u30c3\u30c8 */\ncase class NewUserFormat(\n  name: String,\n  email: String,\n  phone: String,\n  metadata: Map[String, Any] = Map.empty\n)\n</code></pre>"},{"location":"scala/09-adapter-pattern/#_7","title":"\u53cc\u65b9\u5411\u30a2\u30c0\u30d7\u30bf\u30fc","text":"<pre><code>object UserFormatAdapter:\n  /** \u65e7\u30d5\u30a9\u30fc\u30de\u30c3\u30c8 \u2192 \u65b0\u30d5\u30a9\u30fc\u30de\u30c3\u30c8 */\n  def adaptOldToNew(old: OldUserFormat): NewUserFormat =\n    NewUserFormat(\n      name = s\"${old.lastName} ${old.firstName}\",\n      email = old.emailAddress,\n      phone = old.phoneNumber,\n      metadata = Map(\n        \"migrated\" -&gt; true,\n        \"originalFormat\" -&gt; \"old\"\n      )\n    )\n\n  /** \u65b0\u30d5\u30a9\u30fc\u30de\u30c3\u30c8 \u2192 \u65e7\u30d5\u30a9\u30fc\u30de\u30c3\u30c8 */\n  def adaptNewToOld(newUser: NewUserFormat): OldUserFormat =\n    val nameParts = newUser.name.split(\" \", 2)\n    val lastName = nameParts.headOption.getOrElse(\"\")\n    val firstName = if nameParts.length &gt; 1 then nameParts(1) else \"\"\n    OldUserFormat(\n      firstName = firstName,\n      lastName = lastName,\n      emailAddress = newUser.email,\n      phoneNumber = newUser.phone\n    )\n</code></pre>"},{"location":"scala/09-adapter-pattern/#_8","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>val oldUser = OldUserFormat(\"\u592a\u90ce\", \"\u5c71\u7530\", \"taro@example.com\", \"090-1234-5678\")\nval newUser = UserFormatAdapter.adaptOldToNew(oldUser)\n// NewUserFormat(\"\u5c71\u7530 \u592a\u90ce\", \"taro@example.com\", \"090-1234-5678\", Map(\"migrated\" -&gt; true, ...))\n\nval restored = UserFormatAdapter.adaptNewToOld(newUser)\n// OldUserFormat(\"\u592a\u90ce\", \"\u5c71\u7530\", \"taro@example.com\", \"090-1234-5678\")\n</code></pre>"},{"location":"scala/09-adapter-pattern/#4-apiresponseadapter-api","title":"4. ApiResponseAdapter - \u5916\u90e8API\u7d71\u5408","text":""},{"location":"scala/09-adapter-pattern/#_9","title":"\u30c7\u30fc\u30bf\u69cb\u9020","text":"<pre><code>/** \u5916\u90e8 API \u306e\u30ec\u30b9\u30dd\u30f3\u30b9\u5f62\u5f0f */\ncase class ExternalApiResponse(\n  data: Map[String, Any]\n)\n\n/** \u5185\u90e8\u30c7\u30fc\u30bf\u5f62\u5f0f */\ncase class InternalData(\n  id: String,\n  name: String,\n  createdAt: LocalDateTime,\n  metadata: Map[String, Any] = Map.empty\n)\n</code></pre>"},{"location":"scala/09-adapter-pattern/#_10","title":"\u30a2\u30c0\u30d7\u30bf\u30fc","text":"<pre><code>object ApiResponseAdapter:\n  /** \u5916\u90e8\u30ec\u30b9\u30dd\u30f3\u30b9 \u2192 \u5185\u90e8\u5f62\u5f0f */\n  def adaptExternalToInternal(external: ExternalApiResponse): Option[InternalData] =\n    for\n      dataObj &lt;- external.data.get(\"data\").collect { case m: Map[_, _] =&gt; m }\n      id &lt;- dataObj.get(\"identifier\").collect { case s: String =&gt; s }\n      attributes &lt;- dataObj.get(\"attributes\").collect { case m: Map[_, _] =&gt; m }\n      name &lt;- attributes.get(\"name\").collect { case s: String =&gt; s }\n      createdAtStr &lt;- attributes.get(\"createdAt\").collect { case s: String =&gt; s }\n      createdAt &lt;- Try(LocalDateTime.parse(createdAtStr)).toOption\n    yield InternalData(\n      id = id,\n      name = name,\n      createdAt = createdAt,\n      metadata = Map(\"source\" -&gt; \"external-api\")\n    )\n</code></pre>"},{"location":"scala/09-adapter-pattern/#5-temperatureadapter-","title":"5. TemperatureAdapter - \u5358\u4f4d\u5909\u63db","text":"<pre><code>case class Celsius(value: Double)\ncase class Fahrenheit(value: Double)\ncase class Kelvin(value: Double)\n\nobject TemperatureAdapter:\n  def celsiusToFahrenheit(c: Celsius): Fahrenheit =\n    Fahrenheit(c.value * 9.0 / 5.0 + 32)\n\n  def fahrenheitToCelsius(f: Fahrenheit): Celsius =\n    Celsius((f.value - 32) * 5.0 / 9.0)\n\n  def celsiusToKelvin(c: Celsius): Kelvin =\n    Kelvin(c.value + 273.15)\n\n  def kelvinToCelsius(k: Kelvin): Celsius =\n    Celsius(k.value - 273.15)\n\n  // \u5408\u6210\u306b\u3088\u308b\u5909\u63db\n  def fahrenheitToKelvin(f: Fahrenheit): Kelvin =\n    celsiusToKelvin(fahrenheitToCelsius(f))\n\n  def kelvinToFahrenheit(k: Kelvin): Fahrenheit =\n    celsiusToFahrenheit(kelvinToCelsius(k))\n</code></pre>"},{"location":"scala/09-adapter-pattern/#_11","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>val celsius = Celsius(100)\nval fahrenheit = TemperatureAdapter.celsiusToFahrenheit(celsius)\n// Fahrenheit(212.0)\n\nval kelvin = TemperatureAdapter.celsiusToKelvin(Celsius(0))\n// Kelvin(273.15)\n</code></pre>"},{"location":"scala/09-adapter-pattern/#6-datetimeadapter-","title":"6. DateTimeAdapter - \u65e5\u6642\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u5909\u63db","text":"<pre><code>object DateTimeAdapter:\n  /** Unix \u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7 \u2192 LocalDateTime */\n  def fromUnixTimestamp(timestamp: Long): LocalDateTime =\n    LocalDateTime.ofInstant(Instant.ofEpochSecond(timestamp), ZoneId.systemDefault())\n\n  /** LocalDateTime \u2192 Unix \u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7 */\n  def toUnixTimestamp(dateTime: LocalDateTime): Long =\n    dateTime.atZone(ZoneId.systemDefault()).toEpochSecond\n\n  /** ISO 8601 \u6587\u5b57\u5217 \u2192 LocalDateTime */\n  def fromIso8601(str: String): Option[LocalDateTime] =\n    Try(LocalDateTime.parse(str, DateTimeFormatter.ISO_DATE_TIME)).toOption\n\n  /** LocalDateTime \u2192 ISO 8601 \u6587\u5b57\u5217 */\n  def toIso8601(dateTime: LocalDateTime): String =\n    dateTime.format(DateTimeFormatter.ISO_DATE_TIME)\n\n  /** \u65e5\u672c\u8a9e\u5f62\u5f0f \u2192 LocalDateTime */\n  def fromJapanese(str: String): Option[LocalDateTime] =\n    val formatter = DateTimeFormatter.ofPattern(\"yyyy\u5e74MM\u6708dd\u65e5 HH\u6642mm\u5206ss\u79d2\")\n    Try(LocalDateTime.parse(str, formatter)).toOption\n\n  /** LocalDateTime \u2192 \u65e5\u672c\u8a9e\u5f62\u5f0f */\n  def toJapanese(dateTime: LocalDateTime): String =\n    val formatter = DateTimeFormatter.ofPattern(\"yyyy\u5e74MM\u6708dd\u65e5 HH\u6642mm\u5206ss\u79d2\")\n    dateTime.format(formatter)\n</code></pre>"},{"location":"scala/09-adapter-pattern/#_12","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>val now = LocalDateTime.of(2024, 1, 15, 10, 30, 0)\n\nDateTimeAdapter.toIso8601(now)      // \"2024-01-15T10:30:00\"\nDateTimeAdapter.toJapanese(now)     // \"2024\u5e7401\u670815\u65e5 10\u664230\u520600\u79d2\"\nDateTimeAdapter.toUnixTimestamp(now) // 1705307400 (\u30bf\u30a4\u30e0\u30be\u30fc\u30f3\u4f9d\u5b58)\n</code></pre>"},{"location":"scala/09-adapter-pattern/#7-cloudstorageadapter-","title":"7. CloudStorageAdapter - \u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u30a2\u30c0\u30d7\u30bf\u30fc","text":""},{"location":"scala/09-adapter-pattern/#_13","title":"\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u5b9a\u7fa9","text":"<pre><code>/** \u30ed\u30fc\u30ab\u30eb\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\uff08\u30bf\u30fc\u30b2\u30c3\u30c8\uff09 */\ntrait LocalFileSystem:\n  def readFile(path: String): String\n  def writeFile(path: String, content: String): Unit\n  def deleteFile(path: String): Unit\n  def exists(path: String): Boolean\n\n/** \u30af\u30e9\u30a6\u30c9\u30b9\u30c8\u30ec\u30fc\u30b8\uff08\u30a2\u30c0\u30d7\u30c6\u30a3\u30fc\uff09 */\ntrait CloudStorage:\n  def getObject(bucket: String, key: String): Array[Byte]\n  def putObject(bucket: String, key: String, data: Array[Byte]): Unit\n  def deleteObject(bucket: String, key: String): Unit\n  def objectExists(bucket: String, key: String): Boolean\n</code></pre>"},{"location":"scala/09-adapter-pattern/#_14","title":"\u30a2\u30c0\u30d7\u30bf\u30fc\u5b9f\u88c5","text":"<pre><code>class CloudStorageAdapter(\n  cloudStorage: CloudStorage,\n  bucket: String\n) extends LocalFileSystem:\n\n  def readFile(path: String): String =\n    new String(cloudStorage.getObject(bucket, path), \"UTF-8\")\n\n  def writeFile(path: String, content: String): Unit =\n    cloudStorage.putObject(bucket, path, content.getBytes(\"UTF-8\"))\n\n  def deleteFile(path: String): Unit =\n    cloudStorage.deleteObject(bucket, path)\n\n  def exists(path: String): Boolean =\n    cloudStorage.objectExists(bucket, path)\n</code></pre>"},{"location":"scala/09-adapter-pattern/#_15","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>val cloudStorage = new InMemoryCloudStorage\nval fileSystem: LocalFileSystem = CloudStorageAdapter(cloudStorage, \"my-bucket\")\n\nfileSystem.writeFile(\"test.txt\", \"Hello, World!\")\nfileSystem.readFile(\"test.txt\")  // \"Hello, World!\"\nfileSystem.exists(\"test.txt\")    // true\nfileSystem.deleteFile(\"test.txt\")\nfileSystem.exists(\"test.txt\")    // false\n</code></pre>"},{"location":"scala/09-adapter-pattern/#8-legacyloggeradapter-","title":"8. LegacyLoggerAdapter - \u30ec\u30ac\u30b7\u30fc\u30b7\u30b9\u30c6\u30e0\u7d71\u5408","text":"<pre><code>/** \u6a19\u6e96\u30ed\u30ac\u30fc\uff08\u30bf\u30fc\u30b2\u30c3\u30c8\uff09 */\ntrait StandardLogger:\n  def debug(message: String): Unit\n  def info(message: String): Unit\n  def warn(message: String): Unit\n  def error(message: String): Unit\n\n/** \u30ec\u30ac\u30b7\u30fc\u30ed\u30ac\u30fc\uff08\u30a2\u30c0\u30d7\u30c6\u30a3\u30fc\uff09 */\ntrait LegacyLogger:\n  def log(level: Int, message: String): Unit\n\nobject LegacyLogger:\n  val DEBUG = 0\n  val INFO = 1\n  val WARN = 2\n  val ERROR = 3\n\n/** \u30a2\u30c0\u30d7\u30bf\u30fc */\nclass LegacyLoggerAdapter(legacyLogger: LegacyLogger) extends StandardLogger:\n  def debug(message: String): Unit = legacyLogger.log(LegacyLogger.DEBUG, message)\n  def info(message: String): Unit = legacyLogger.log(LegacyLogger.INFO, message)\n  def warn(message: String): Unit = legacyLogger.log(LegacyLogger.WARN, message)\n  def error(message: String): Unit = legacyLogger.log(LegacyLogger.ERROR, message)\n</code></pre>"},{"location":"scala/09-adapter-pattern/#9-currencyadapter-","title":"9. CurrencyAdapter - \u901a\u8ca8\u5909\u63db","text":"<pre><code>case class Money(amount: BigDecimal, currency: String)\n\ntrait ExchangeRateProvider:\n  def getRate(from: String, to: String): BigDecimal\n\nclass CurrencyAdapter(rateProvider: ExchangeRateProvider):\n  def convert(money: Money, toCurrency: String): Money =\n    if money.currency == toCurrency then money\n    else\n      val rate = rateProvider.getRate(money.currency, toCurrency)\n      Money(money.amount * rate, toCurrency)\n</code></pre>"},{"location":"scala/09-adapter-pattern/#_16","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>val rates = Map((\"USD\", \"JPY\") -&gt; BigDecimal(150))\nval adapter = CurrencyAdapter(FixedRateProvider(rates))\n\nval usd = Money(BigDecimal(100), \"USD\")\nval jpy = adapter.convert(usd, \"JPY\")\n// Money(15000, \"JPY\")\n</code></pre>"},{"location":"scala/09-adapter-pattern/#10-javaiteratoradapter-","title":"10. JavaIteratorAdapter - \u30a4\u30c6\u30ec\u30fc\u30bf\u30fc\u5909\u63db","text":"<pre><code>/** Java \u98a8\u30a4\u30c6\u30ec\u30fc\u30bf\u30fc */\ntrait JavaStyleIterator[A]:\n  def hasNext: Boolean\n  def next(): A\n\n/** Scala Iterator \u3078\u306e\u30a2\u30c0\u30d7\u30bf\u30fc */\nclass JavaIteratorAdapter[A](javaIter: JavaStyleIterator[A]) extends Iterator[A]:\n  def hasNext: Boolean = javaIter.hasNext\n  def next(): A = javaIter.next()\n</code></pre>"},{"location":"scala/09-adapter-pattern/#_17","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>val javaIter = new ArrayJavaIterator(Array(1, 2, 3, 4, 5))\nval scalaIter: Iterator[Int] = JavaIteratorAdapter(javaIter)\n\nscalaIter.toList           // List(1, 2, 3, 4, 5)\nscalaIter.filter(_ % 2 == 0).toList // List(2, 4)\n</code></pre>"},{"location":"scala/09-adapter-pattern/#11-functionadapter-","title":"11. FunctionAdapter - \u95a2\u6570\u5909\u63db","text":"<pre><code>object FunctionAdapter:\n  /** (A, B) =&gt; C \u3092 A =&gt; B =&gt; C \u306b\u30ab\u30ea\u30fc\u5316 */\n  def curry[A, B, C](f: (A, B) =&gt; C): A =&gt; B =&gt; C =\n    a =&gt; b =&gt; f(a, b)\n\n  /** A =&gt; B =&gt; C \u3092 (A, B) =&gt; C \u306b\u30a2\u30f3\u30ab\u30ea\u30fc\u5316 */\n  def uncurry[A, B, C](f: A =&gt; B =&gt; C): (A, B) =&gt; C =\n    (a, b) =&gt; f(a)(b)\n\n  /** \u5f15\u6570\u306e\u9806\u5e8f\u3092\u5165\u308c\u66ff\u3048 */\n  def flip[A, B, C](f: (A, B) =&gt; C): (B, A) =&gt; C =\n    (b, a) =&gt; f(a, b)\n\n  /** Option \u3092 Either \u306b\u5909\u63db */\n  def optionToEither[A, E](option: Option[A], error: =&gt; E): Either[E, A] =\n    option.toRight(error)\n\n  /** Either \u3092 Option \u306b\u5909\u63db */\n  def eitherToOption[E, A](either: Either[E, A]): Option[A] =\n    either.toOption\n\n  /** Try \u3092 Either \u306b\u5909\u63db */\n  def tryToEither[A](t: Try[A]): Either[Throwable, A] =\n    t.toEither\n\n  /** Scala \u95a2\u6570 \u2192 Java \u95a2\u6570 */\n  def toJavaFunction[A, B](f: A =&gt; B): java.util.function.Function[A, B] =\n    new java.util.function.Function[A, B]:\n      def apply(a: A): B = f(a)\n\n  /** Java \u95a2\u6570 \u2192 Scala \u95a2\u6570 */\n  def fromJavaFunction[A, B](f: java.util.function.Function[A, B]): A =&gt; B =\n    a =&gt; f.apply(a)\n</code></pre>"},{"location":"scala/09-adapter-pattern/#_18","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// \u30ab\u30ea\u30fc\u5316\nval add = (a: Int, b: Int) =&gt; a + b\nval curriedAdd = FunctionAdapter.curry(add)\ncurriedAdd(1)(2)  // 3\n\n// \u5f15\u6570\u306e\u5165\u308c\u66ff\u3048\nval subtract = (a: Int, b: Int) =&gt; a - b\nval flipped = FunctionAdapter.flip(subtract)\nflipped(1, 10)  // 9 (10 - 1)\n\n// \u30a8\u30e9\u30fc\u578b\u306e\u5909\u63db\nval maybeValue: Option[Int] = Some(42)\nval eitherValue = FunctionAdapter.optionToEither(maybeValue, \"Not found\")\n// Right(42)\n</code></pre>"},{"location":"scala/09-adapter-pattern/#12","title":"12. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u5358\u4e00\u8cac\u4efb: \u30a2\u30c0\u30d7\u30bf\u30fc\u306f\u5909\u63db\u306e\u307f\u3092\u62c5\u5f53</li> <li>\u958b\u653e/\u9589\u9396: \u65e2\u5b58\u30b3\u30fc\u30c9\u3092\u5909\u66f4\u305b\u305a\u306b\u65b0\u3057\u3044\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306b\u5bfe\u5fdc</li> <li>\u518d\u5229\u7528\u6027: \u30ec\u30ac\u30b7\u30fc\u30b3\u30fc\u30c9\u3092\u65b0\u3057\u3044\u30b7\u30b9\u30c6\u30e0\u3067\u6d3b\u7528</li> <li>\u30c6\u30b9\u30c8\u5bb9\u6613\u6027: \u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u4ecb\u3057\u3066\u30e2\u30c3\u30af\u306b\u7f6e\u63db\u53ef\u80fd</li> <li>\u6bb5\u968e\u7684\u79fb\u884c: \u65b0\u65e7\u30b7\u30b9\u30c6\u30e0\u3092\u5171\u5b58\u3055\u305b\u306a\u304c\u3089\u79fb\u884c</li> </ol>"},{"location":"scala/09-adapter-pattern/#clojure","title":"Clojure \u3068\u306e\u6bd4\u8f03","text":"\u6982\u5ff5 Clojure Scala \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9 Protocol trait \u30a2\u30c0\u30d7\u30bf\u30fc\u5b9f\u88c5 <code>extend-protocol</code> class extends trait \u30c7\u30fc\u30bf\u5909\u63db \u7d14\u7c8b\u95a2\u6570 \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u30e1\u30bd\u30c3\u30c9 or \u95a2\u6570 \u578b\u5b89\u5168\u6027 \u52d5\u7684\u578b\u4ed8\u3051 \u9759\u7684\u578b\u4ed8\u3051 \u30ab\u30ea\u30fc\u5316 \u30c7\u30d5\u30a9\u30eb\u30c8\u5bfe\u5fdc <code>curry</code> \u660e\u793a\u7684\u5909\u63db"},{"location":"scala/09-adapter-pattern/#_19","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Adapter \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>VariableLightAdapter: \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306e\u9069\u5fdc</li> <li>UserFormatAdapter: \u53cc\u65b9\u5411\u30c7\u30fc\u30bf\u5909\u63db</li> <li>ApiResponseAdapter: \u5916\u90e8API\u7d71\u5408</li> <li>TemperatureAdapter: \u5358\u4f4d\u5909\u63db</li> <li>DateTimeAdapter: \u65e5\u6642\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u5909\u63db</li> <li>CloudStorageAdapter: \u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u62bd\u8c61\u5316</li> <li>LegacyLoggerAdapter: \u30ec\u30ac\u30b7\u30fc\u30b7\u30b9\u30c6\u30e0\u7d71\u5408</li> <li>CurrencyAdapter: \u901a\u8ca8\u5909\u63db</li> <li>JavaIteratorAdapter: \u30a4\u30c6\u30ec\u30fc\u30bf\u30fc\u5909\u63db</li> <li>FunctionAdapter: \u95a2\u6570\u578b\u5909\u63db\uff08\u30ab\u30ea\u30fc\u5316\u3001\u578b\u5909\u63db\uff09</li> </ol> <p>Adapter \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u7570\u306a\u308b\u30b7\u30b9\u30c6\u30e0\u9593\u306e\u300c\u7ffb\u8a33\u5c64\u300d\u3068\u3057\u3066\u6a5f\u80fd\u3057\u3001\u30ec\u30ac\u30b7\u30fc\u30b3\u30fc\u30c9\u306e\u518d\u5229\u7528\u3068\u6bb5\u968e\u7684\u306a\u30b7\u30b9\u30c6\u30e0\u79fb\u884c\u3092\u53ef\u80fd\u306b\u3057\u307e\u3059\u3002</p>"},{"location":"scala/09-adapter-pattern/#_20","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/scala/part3/src/main/scala/AdapterPattern.scala</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/scala/part3/src/test/scala/AdapterPatternSpec.scala</code></li> </ul>"},{"location":"scala/09-adapter-pattern/#_21","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Strategy \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u30ab\u30d7\u30bb\u30eb\u5316\u3057\u3001\u5b9f\u884c\u6642\u306b\u5207\u308a\u66ff\u3048\u53ef\u80fd\u306b\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"scala/10-strategy-pattern/","title":"\u7b2c10\u7ae0: Strategy \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"scala/10-strategy-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Strategy \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u30ab\u30d7\u30bb\u30eb\u5316\u3057\u3001\u305d\u308c\u3089\u3092\u4ea4\u63db\u53ef\u80fd\u306b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u3053\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u304b\u3089\u72ec\u7acb\u3057\u3066\u5909\u66f4\u3067\u304d\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u6599\u91d1\u8a08\u7b97\u3001\u914d\u9001\u6599\u91d1\u3001\u652f\u6255\u3044\u65b9\u6cd5\u306a\u3069\u306e\u4f8b\u3092\u901a\u3058\u3066\u3001\u30c8\u30ec\u30a4\u30c8\u3068\u9ad8\u968e\u95a2\u6570\u306b\u3088\u308b Strategy \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"scala/10-strategy-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":""},{"location":"scala/10-strategy-pattern/#2","title":"2. \u6599\u91d1\u8a08\u7b97\u6226\u7565\uff08\u30c8\u30ec\u30a4\u30c8\u30d9\u30fc\u30b9\uff09","text":""},{"location":"scala/10-strategy-pattern/#strategy","title":"Strategy \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9","text":"<pre><code>trait PricingStrategy:\n  def calculatePrice(amount: BigDecimal): BigDecimal\n</code></pre>"},{"location":"scala/10-strategy-pattern/#concretestrategy","title":"ConcreteStrategy: \u901a\u5e38\u6599\u91d1","text":"<pre><code>case object RegularPricing extends PricingStrategy:\n  def calculatePrice(amount: BigDecimal): BigDecimal = amount\n</code></pre>"},{"location":"scala/10-strategy-pattern/#concretestrategy_1","title":"ConcreteStrategy: \u5272\u5f15\u6599\u91d1","text":"<pre><code>case class DiscountPricing(discountRate: BigDecimal) extends PricingStrategy:\n  require(discountRate &gt;= 0 &amp;&amp; discountRate &lt;= 1, \"Discount rate must be 0-1\")\n\n  def calculatePrice(amount: BigDecimal): BigDecimal =\n    amount * (BigDecimal(1) - discountRate)\n</code></pre>"},{"location":"scala/10-strategy-pattern/#concretestrategy_2","title":"ConcreteStrategy: \u4f1a\u54e1\u6599\u91d1","text":"<pre><code>enum MemberLevel(val discountRate: BigDecimal):\n  case Gold extends MemberLevel(BigDecimal(\"0.20\"))\n  case Silver extends MemberLevel(BigDecimal(\"0.15\"))\n  case Bronze extends MemberLevel(BigDecimal(\"0.10\"))\n\ncase class MemberPricing(level: MemberLevel) extends PricingStrategy:\n  def calculatePrice(amount: BigDecimal): BigDecimal =\n    amount * (BigDecimal(1) - level.discountRate)\n</code></pre>"},{"location":"scala/10-strategy-pattern/#_2","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// \u901a\u5e38\u6599\u91d1\nRegularPricing.calculatePrice(BigDecimal(1000))  // 1000\n\n// 10%\u5272\u5f15\nDiscountPricing(BigDecimal(\"0.10\")).calculatePrice(BigDecimal(1000))  // 900\n\n// \u30b4\u30fc\u30eb\u30c9\u4f1a\u54e1\u6599\u91d1\nMemberPricing(MemberLevel.Gold).calculatePrice(BigDecimal(1000))  // 800\n</code></pre>"},{"location":"scala/10-strategy-pattern/#3-context","title":"3. Context: \u30b7\u30e7\u30c3\u30d4\u30f3\u30b0\u30ab\u30fc\u30c8","text":"<pre><code>case class CartItem(name: String, price: BigDecimal, quantity: Int = 1)\n\ncase class ShoppingCart(\n  items: List[CartItem] = Nil,\n  strategy: PricingStrategy = RegularPricing\n):\n  def addItem(item: CartItem): ShoppingCart =\n    copy(items = items :+ item)\n\n  def removeItem(name: String): ShoppingCart =\n    copy(items = items.filterNot(_.name == name))\n\n  def changeStrategy(newStrategy: PricingStrategy): ShoppingCart =\n    copy(strategy = newStrategy)\n\n  def subtotal: BigDecimal =\n    items.map(item =&gt; item.price * item.quantity).sum\n\n  def total: BigDecimal =\n    strategy.calculatePrice(subtotal)\n</code></pre>"},{"location":"scala/10-strategy-pattern/#_3","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>val cart = ShoppingCart(\n  CartItem(\"Item A\", BigDecimal(500)),\n  CartItem(\"Item B\", BigDecimal(300), quantity = 2)\n)\n\ncart.subtotal  // 1100\ncart.total     // 1100 (\u901a\u5e38\u6599\u91d1)\n\nval discountedCart = cart.changeStrategy(MemberPricing(MemberLevel.Gold))\ndiscountedCart.total  // 880 (20%\u5272\u5f15)\n</code></pre>"},{"location":"scala/10-strategy-pattern/#4","title":"4. \u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1","text":"<p>\u95a2\u6570\u3092\u7b2c\u4e00\u7d1a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u6271\u3044\u3001\u3088\u308a\u7c21\u6f54\u306b Strategy \u30d1\u30bf\u30fc\u30f3\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002</p>"},{"location":"scala/10-strategy-pattern/#strategy_1","title":"\u95a2\u6570\u306b\u3088\u308b Strategy","text":"<pre><code>object FunctionalStrategy:\n  type PriceFn = BigDecimal =&gt; BigDecimal\n\n  val regular: PriceFn = identity\n\n  def discount(rate: BigDecimal): PriceFn =\n    amount =&gt; amount * (BigDecimal(1) - rate)\n\n  def member(level: MemberLevel): PriceFn =\n    discount(level.discountRate)\n\n  def tax(rate: BigDecimal): PriceFn =\n    amount =&gt; amount * (BigDecimal(1) + rate)\n\n  def fixedDiscount(discountAmount: BigDecimal): PriceFn =\n    amount =&gt; (amount - discountAmount).max(BigDecimal(0))\n</code></pre>"},{"location":"scala/10-strategy-pattern/#_4","title":"\u6226\u7565\u306e\u5408\u6210","text":"<p>\u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1\u306e\u5927\u304d\u306a\u5229\u70b9\u306f\u3001\u6226\u7565\u3092\u7c21\u5358\u306b\u5408\u6210\u3067\u304d\u308b\u3053\u3068\u3067\u3059\u3002</p> <pre><code>def compose(strategies: PriceFn*): PriceFn =\n  amount =&gt; strategies.foldLeft(amount)((a, f) =&gt; f(a))\n\n// \u4f7f\u7528\u4f8b\uff1a\u5272\u5f15\u5f8c\u306b\u7a0e\u91d1\u3092\u9069\u7528\nval finalPrice = compose(\n  discount(BigDecimal(\"0.10\")),\n  tax(BigDecimal(\"0.08\"))\n)\n\nfinalPrice(BigDecimal(1000))  // 972 (1000 * 0.9 * 1.08)\n</code></pre>"},{"location":"scala/10-strategy-pattern/#_5","title":"\u6761\u4ef6\u4ed8\u304d\u6226\u7565","text":"<pre><code>def conditional(\n  predicate: BigDecimal =&gt; Boolean,\n  thenStrategy: PriceFn,\n  elseStrategy: PriceFn = regular\n): PriceFn =\n  amount =&gt;\n    if predicate(amount) then thenStrategy(amount)\n    else elseStrategy(amount)\n\n// 5000\u5186\u4ee5\u4e0a\u306720%\u5272\u5f15\nval highValueDiscount = conditional(\n  _ &gt;= BigDecimal(5000),\n  discount(BigDecimal(\"0.20\")),\n  regular\n)\n\nhighValueDiscount(BigDecimal(6000))  // 4800\nhighValueDiscount(BigDecimal(3000))  // 3000\n</code></pre>"},{"location":"scala/10-strategy-pattern/#_6","title":"\u6bb5\u968e\u5225\u6226\u7565","text":"<pre><code>def tiered(tiers: List[(BigDecimal, PriceFn)]): PriceFn =\n  amount =&gt;\n    tiers\n      .sortBy(-_._1)\n      .find(_._1 &lt;= amount)\n      .map(_._2(amount))\n      .getOrElse(amount)\n\nval tierStrategy = tiered(List(\n  BigDecimal(10000) -&gt; discount(BigDecimal(\"0.20\")),\n  BigDecimal(5000) -&gt; discount(BigDecimal(\"0.10\")),\n  BigDecimal(0) -&gt; regular\n))\n\ntierStrategy(BigDecimal(10000))  // 8000 (20%\u5272\u5f15)\ntierStrategy(BigDecimal(6000))   // 5400 (10%\u5272\u5f15)\ntierStrategy(BigDecimal(3000))   // 3000 (\u5272\u5f15\u306a\u3057)\n</code></pre>"},{"location":"scala/10-strategy-pattern/#5","title":"5. \u914d\u9001\u6599\u91d1\u6226\u7565","text":"<pre><code>trait ShippingStrategy:\n  def calculate(weight: Double, distance: Double): BigDecimal\n\ncase object StandardShipping extends ShippingStrategy:\n  def calculate(weight: Double, distance: Double): BigDecimal =\n    BigDecimal(weight * 10 + distance * 5)\n\ncase object ExpressShipping extends ShippingStrategy:\n  def calculate(weight: Double, distance: Double): BigDecimal =\n    BigDecimal(weight * 20 + distance * 15)\n\ncase class FreeShipping(minOrderAmount: BigDecimal) extends ShippingStrategy:\n  def calculate(weight: Double, distance: Double): BigDecimal =\n    BigDecimal(0)\n\ncase class WeightBasedShipping(\n  baseRate: BigDecimal,\n  perKgRate: BigDecimal,\n  freeThreshold: Double = Double.MaxValue\n) extends ShippingStrategy:\n  def calculate(weight: Double, distance: Double): BigDecimal =\n    if weight &gt;= freeThreshold then BigDecimal(0)\n    else baseRate + BigDecimal(weight) * perKgRate\n</code></pre>"},{"location":"scala/10-strategy-pattern/#_7","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>StandardShipping.calculate(2.0, 100.0)  // 520\nExpressShipping.calculate(2.0, 100.0)   // 1540\nFreeShipping(BigDecimal(5000)).calculate(10.0, 1000.0)  // 0\n</code></pre>"},{"location":"scala/10-strategy-pattern/#6","title":"6. \u6ce8\u6587\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8","text":"<pre><code>case class Order(\n  cart: ShoppingCart,\n  shippingStrategy: ShippingStrategy = StandardShipping,\n  weight: Double = 1.0,\n  distance: Double = 10.0\n):\n  def itemsTotal: BigDecimal = cart.total\n  def shippingCost: BigDecimal = shippingStrategy.calculate(weight, distance)\n  def grandTotal: BigDecimal = itemsTotal + shippingCost\n\n  def changeShipping(strategy: ShippingStrategy): Order =\n    copy(shippingStrategy = strategy)\n</code></pre>"},{"location":"scala/10-strategy-pattern/#7","title":"7. \u652f\u6255\u3044\u6226\u7565","text":"<pre><code>case class PaymentResult(\n  success: Boolean,\n  transactionId: Option[String] = None,\n  fee: BigDecimal = BigDecimal(0),\n  message: String = \"\"\n)\n\ntrait PaymentStrategy:\n  def pay(amount: BigDecimal): PaymentResult\n  def fee(amount: BigDecimal): BigDecimal\n\ncase class CreditCardPayment(\n  cardNumber: String,\n  feeRate: BigDecimal = BigDecimal(\"0.03\")\n) extends PaymentStrategy:\n  def pay(amount: BigDecimal): PaymentResult =\n    PaymentResult(\n      success = true,\n      transactionId = Some(s\"CC-${System.currentTimeMillis()}\"),\n      fee = fee(amount),\n      message = s\"Charged ${amount + fee(amount)} to card\"\n    )\n  def fee(amount: BigDecimal): BigDecimal = amount * feeRate\n\ncase class BankTransferPayment(\n  bankCode: String,\n  fixedFee: BigDecimal = BigDecimal(300)\n) extends PaymentStrategy:\n  def pay(amount: BigDecimal): PaymentResult =\n    PaymentResult(\n      success = true,\n      transactionId = Some(s\"BT-${System.currentTimeMillis()}\"),\n      fee = fixedFee,\n      message = s\"Transfer ${amount + fixedFee} to bank\"\n    )\n  def fee(amount: BigDecimal): BigDecimal = fixedFee\n\ncase class PointsPayment(\n  availablePoints: Int,\n  pointValue: BigDecimal = BigDecimal(\"0.01\")\n) extends PaymentStrategy:\n  def pay(amount: BigDecimal): PaymentResult =\n    val pointsNeeded = (amount / pointValue).toInt\n    if pointsNeeded &lt;= availablePoints then\n      PaymentResult(success = true, fee = BigDecimal(0))\n    else\n      PaymentResult(success = false, message = \"Insufficient points\")\n  def fee(amount: BigDecimal): BigDecimal = BigDecimal(0)\n</code></pre>"},{"location":"scala/10-strategy-pattern/#8","title":"8. \u30bd\u30fc\u30c8\u6226\u7565","text":"<pre><code>object SortStrategy:\n  type SortFn[A] = List[A] =&gt; List[A]\n\n  def ascending[A](using ord: Ordering[A]): SortFn[A] = _.sorted\n  def descending[A](using ord: Ordering[A]): SortFn[A] = _.sorted(ord.reverse)\n  def byKey[A, B](key: A =&gt; B)(using ord: Ordering[B]): SortFn[A] = _.sortBy(key)\n</code></pre>"},{"location":"scala/10-strategy-pattern/#_8","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>import SortStrategy._\n\nval numbers = List(3, 1, 4, 1, 5, 9, 2, 6)\nascending[Int].apply(numbers)   // List(1, 1, 2, 3, 4, 5, 6, 9)\ndescending[Int].apply(numbers)  // List(9, 6, 5, 4, 3, 2, 1, 1)\n\ncase class Person(name: String, age: Int)\nval people = List(Person(\"Bob\", 30), Person(\"Alice\", 25))\nbyKey[Person, String](_.name).apply(people)  // List(Alice, Bob)\n</code></pre>"},{"location":"scala/10-strategy-pattern/#9","title":"9. \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u6226\u7565","text":"<pre><code>sealed trait ValidationResult[+A]:\n  def isValid: Boolean\n\ncase class Valid[A](value: A) extends ValidationResult[A]:\n  def isValid: Boolean = true\n\ncase class Invalid(errors: List[String]) extends ValidationResult[Nothing]:\n  def isValid: Boolean = false\n\nobject ValidationStrategy:\n  type Validator[A] = A =&gt; ValidationResult[A]\n\n  def always[A]: Validator[A] = a =&gt; Valid(a)\n  def never[A](error: String): Validator[A] = _ =&gt; Invalid(List(error))\n\n  def predicate[A](pred: A =&gt; Boolean, error: String): Validator[A] =\n    a =&gt; if pred(a) then Valid(a) else Invalid(List(error))\n\n  def min[A: Ordering](minValue: A, error: String): Validator[A] =\n    predicate(a =&gt; Ordering[A].gteq(a, minValue), error)\n\n  def max[A: Ordering](maxValue: A, error: String): Validator[A] =\n    predicate(a =&gt; Ordering[A].lteq(a, maxValue), error)\n\n  def all[A](validators: Validator[A]*): Validator[A] =\n    a =&gt;\n      val results = validators.map(_(a))\n      val errors = results.collect { case Invalid(errs) =&gt; errs }.flatten.toList\n      if errors.isEmpty then Valid(a) else Invalid(errors)\n</code></pre>"},{"location":"scala/10-strategy-pattern/#_9","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>import ValidationStrategy._\n\nval validator = all(\n  min(0, \"Must be non-negative\"),\n  max(100, \"Must be at most 100\")\n)\n\nvalidator(50).isValid   // true\nvalidator(-1).isValid   // false\nvalidator(101).isValid  // false\n</code></pre>"},{"location":"scala/10-strategy-pattern/#10","title":"10. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u4ea4\u63db: \u5b9f\u884c\u6642\u306b\u6226\u7565\u3092\u5909\u66f4\u53ef\u80fd</li> <li>\u958b\u653e/\u9589\u9396\u306e\u539f\u5247: \u65b0\u3057\u3044\u6226\u7565\u3092\u8ffd\u52a0\u3057\u3066\u3082\u65e2\u5b58\u30b3\u30fc\u30c9\u306f\u5909\u66f4\u4e0d\u8981</li> <li>\u6761\u4ef6\u5206\u5c90\u306e\u6392\u9664: if/switch \u6587\u306e\u4ee3\u308f\u308a\u306b\u30dd\u30ea\u30e2\u30fc\u30d5\u30a3\u30ba\u30e0\u3092\u4f7f\u7528</li> <li>\u30c6\u30b9\u30c8\u306e\u5bb9\u6613\u3055: \u5404\u6226\u7565\u3092\u72ec\u7acb\u3057\u3066\u30c6\u30b9\u30c8\u53ef\u80fd</li> <li>\u6226\u7565\u306e\u5408\u6210: \u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1\u3067\u8907\u6570\u306e\u6226\u7565\u3092\u7d44\u307f\u5408\u308f\u305b\u53ef\u80fd</li> </ol>"},{"location":"scala/10-strategy-pattern/#clojure","title":"Clojure \u3068\u306e\u6bd4\u8f03","text":"\u6982\u5ff5 Clojure Scala Strategy \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9 trait + case class/object Context \u30de\u30c3\u30d7 + \u95a2\u6570 case class \u95a2\u6570\u578b\u6226\u7565 <code>(fn [amount] ...)</code> <code>BigDecimal =&gt; BigDecimal</code> \u6226\u7565\u5408\u6210 <code>(comp f g)</code> <code>compose(f, g)</code> or <code>f andThen g</code> \u6761\u4ef6\u4ed8\u304d <code>(if (pred x) ...)</code> <code>conditional(pred, then, else)</code>"},{"location":"scala/10-strategy-pattern/#_10","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Strategy \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30c8\u30ec\u30a4\u30c8\u30d9\u30fc\u30b9: \u578b\u5b89\u5168\u306a\u6226\u7565\u306e\u5b9a\u7fa9\u3068\u5207\u308a\u66ff\u3048</li> <li>\u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1: \u9ad8\u968e\u95a2\u6570\u306b\u3088\u308b\u7c21\u6f54\u306a\u5b9f\u88c5</li> <li>\u6226\u7565\u306e\u5408\u6210: \u8907\u6570\u306e\u6226\u7565\u3092\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3068\u3057\u3066\u7d44\u307f\u5408\u308f\u305b</li> <li>\u6761\u4ef6\u4ed8\u304d\u30fb\u6bb5\u968e\u5225\u6226\u7565: \u6761\u4ef6\u306b\u5fdc\u3058\u305f\u52d5\u7684\u306a\u6226\u7565\u9078\u629e</li> <li>\u591a\u69d8\u306a\u30e6\u30fc\u30b9\u30b1\u30fc\u30b9: \u6599\u91d1\u8a08\u7b97\u3001\u914d\u9001\u3001\u652f\u6255\u3044\u3001\u30bd\u30fc\u30c8\u3001\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3</li> </ol> <p>Strategy \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u67d4\u8edf\u306b\u4ea4\u63db\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u5834\u9762\u3067\u975e\u5e38\u306b\u6709\u52b9\u3067\u3059\u3002</p>"},{"location":"scala/10-strategy-pattern/#_11","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/scala/part3/src/main/scala/StrategyPattern.scala</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/scala/part3/src/test/scala/StrategyPatternSpec.scala</code></li> </ul>"},{"location":"scala/10-strategy-pattern/#_12","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Command \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u30b3\u30de\u30f3\u30c9\u3092\u30c7\u30fc\u30bf\u3068\u3057\u3066\u8868\u73fe\u3057\u3001\u30d0\u30c3\u30c1\u51e6\u7406\u3084 Undo \u6a5f\u80fd\u3092\u5b9f\u88c5\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"scala/11-command-pattern/","title":"\u7b2c11\u7ae0: Command \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"scala/11-command-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Command \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30ea\u30af\u30a8\u30b9\u30c8\u3092\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u30ab\u30d7\u30bb\u30eb\u5316\u3057\u3001\u64cd\u4f5c\u306e\u5c65\u6b74\u7ba1\u7406\u3001Undo/Redo\u3001\u30d0\u30c3\u30c1\u51e6\u7406\u3092\u53ef\u80fd\u306b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u30c6\u30ad\u30b9\u30c8\u7de8\u96c6\u3001\u30ad\u30e3\u30f3\u30d0\u30b9\u64cd\u4f5c\u3001\u8a08\u7b97\u6a5f\u3001\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u3001\u30bf\u30b9\u30af\u7ba1\u7406\u306a\u3069\u306e\u4f8b\u3092\u901a\u3058\u3066\u3001Command \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"scala/11-command-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":""},{"location":"scala/11-command-pattern/#2-command","title":"2. Command \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9","text":"<pre><code>trait Command[S]:\n  def execute(state: S): S\n  def undo(state: S): S\n</code></pre> <p>\u30b7\u30f3\u30d7\u30eb\u306a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u3001\u72b6\u614b <code>S</code> \u3092\u53d7\u3051\u53d6\u308a\u3001\u65b0\u3057\u3044\u72b6\u614b\u3092\u8fd4\u3057\u307e\u3059\u3002</p>"},{"location":"scala/11-command-pattern/#3","title":"3. \u30c6\u30ad\u30b9\u30c8\u64cd\u4f5c\u30b3\u30de\u30f3\u30c9","text":""},{"location":"scala/11-command-pattern/#document","title":"Document\uff08\u72b6\u614b\uff09","text":"<pre><code>case class Document(content: String):\n  def insert(position: Int, text: String): Document =\n    val (before, after) = content.splitAt(position)\n    Document(before + text + after)\n\n  def delete(start: Int, end: Int): Document =\n    val before = content.take(start)\n    val after = content.drop(end)\n    Document(before + after)\n\n  def replace(start: Int, end: Int, text: String): Document =\n    delete(start, end).insert(start, text)\n</code></pre>"},{"location":"scala/11-command-pattern/#insertcommand","title":"InsertCommand","text":"<pre><code>case class InsertCommand(position: Int, text: String) extends Command[Document]:\n  def execute(doc: Document): Document =\n    doc.insert(position, text)\n\n  def undo(doc: Document): Document =\n    doc.delete(position, position + text.length)\n</code></pre>"},{"location":"scala/11-command-pattern/#deletecommand","title":"DeleteCommand","text":"<pre><code>case class DeleteCommand(start: Int, end: Int, deletedText: String) extends Command[Document]:\n  def execute(doc: Document): Document =\n    doc.delete(start, end)\n\n  def undo(doc: Document): Document =\n    doc.insert(start, deletedText)\n</code></pre>"},{"location":"scala/11-command-pattern/#replacecommand","title":"ReplaceCommand","text":"<pre><code>case class ReplaceCommand(start: Int, oldText: String, newText: String) extends Command[Document]:\n  def execute(doc: Document): Document =\n    doc.replace(start, start + oldText.length, newText)\n\n  def undo(doc: Document): Document =\n    doc.replace(start, start + newText.length, oldText)\n</code></pre>"},{"location":"scala/11-command-pattern/#_2","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>val doc = Document(\"Hello\")\nval cmd = InsertCommand(5, \" World\")\ncmd.execute(doc).content  // \"Hello World\"\ncmd.undo(Document(\"Hello World\")).content  // \"Hello\"\n</code></pre>"},{"location":"scala/11-command-pattern/#4","title":"4. \u30ad\u30e3\u30f3\u30d0\u30b9\u64cd\u4f5c\u30b3\u30de\u30f3\u30c9","text":""},{"location":"scala/11-command-pattern/#canvas-shape","title":"Canvas \u3068 Shape","text":"<pre><code>sealed trait Shape:\n  def id: String\n  def x: Double\n  def y: Double\n  def move(dx: Double, dy: Double): Shape\n\ncase class Circle(id: String, x: Double, y: Double, radius: Double) extends Shape:\n  def move(dx: Double, dy: Double): Circle = copy(x = x + dx, y = y + dy)\n\ncase class Canvas(shapes: List[Shape] = Nil):\n  def addShape(shape: Shape): Canvas = copy(shapes = shapes :+ shape)\n  def removeShape(id: String): Canvas = copy(shapes = shapes.filterNot(_.id == id))\n  def moveShape(id: String, dx: Double, dy: Double): Canvas = ...\n</code></pre>"},{"location":"scala/11-command-pattern/#canvas","title":"Canvas \u30b3\u30de\u30f3\u30c9","text":"<pre><code>case class AddShapeCommand(shape: Shape) extends Command[Canvas]:\n  def execute(canvas: Canvas): Canvas = canvas.addShape(shape)\n  def undo(canvas: Canvas): Canvas = canvas.removeShape(shape.id)\n\ncase class MoveShapeCommand(shapeId: String, dx: Double, dy: Double) extends Command[Canvas]:\n  def execute(canvas: Canvas): Canvas = canvas.moveShape(shapeId, dx, dy)\n  def undo(canvas: Canvas): Canvas = canvas.moveShape(shapeId, -dx, -dy)\n</code></pre>"},{"location":"scala/11-command-pattern/#5-invoker","title":"5. \u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u5668\uff08Invoker\uff09","text":"<pre><code>case class CommandExecutor[S](\n  state: S,\n  undoStack: List[Command[S]] = Nil,\n  redoStack: List[Command[S]] = Nil\n):\n  def execute(command: Command[S]): CommandExecutor[S] =\n    copy(\n      state = command.execute(state),\n      undoStack = command :: undoStack,\n      redoStack = Nil  // \u65b0\u3057\u3044\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u3067 Redo \u5c65\u6b74\u30af\u30ea\u30a2\n    )\n\n  def undo: CommandExecutor[S] =\n    undoStack match\n      case head :: tail =&gt;\n        copy(\n          state = head.undo(state),\n          undoStack = tail,\n          redoStack = head :: redoStack\n        )\n      case Nil =&gt; this\n\n  def redo: CommandExecutor[S] =\n    redoStack match\n      case head :: tail =&gt;\n        copy(\n          state = head.execute(state),\n          undoStack = head :: undoStack,\n          redoStack = tail\n        )\n      case Nil =&gt; this\n\n  def canUndo: Boolean = undoStack.nonEmpty\n  def canRedo: Boolean = redoStack.nonEmpty\n\n  def executeBatch(commands: List[Command[S]]): CommandExecutor[S] =\n    commands.foldLeft(this)((exec, cmd) =&gt; exec.execute(cmd))\n\n  def undoAll: CommandExecutor[S] =\n    if canUndo then undo.undoAll else this\n</code></pre>"},{"location":"scala/11-command-pattern/#_3","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>val exec = CommandExecutor(Document(\"Hello\"))\n  .execute(InsertCommand(5, \" World\"))\n  .execute(InsertCommand(11, \"!\"))\n\nexec.state.content  // \"Hello World!\"\nexec.undo.state.content  // \"Hello World\"\nexec.undo.undo.state.content  // \"Hello\"\nexec.undo.undo.redo.state.content  // \"Hello World\"\n</code></pre>"},{"location":"scala/11-command-pattern/#6","title":"6. \u30de\u30af\u30ed\u30b3\u30de\u30f3\u30c9\uff08\u8907\u5408\u30b3\u30de\u30f3\u30c9\uff09","text":"<pre><code>case class MacroCommand[S](commands: List[Command[S]]) extends Command[S]:\n  def execute(state: S): S =\n    commands.foldLeft(state)((s, cmd) =&gt; cmd.execute(s))\n\n  def undo(state: S): S =\n    commands.reverse.foldLeft(state)((s, cmd) =&gt; cmd.undo(s))\n\n  def add(command: Command[S]): MacroCommand[S] =\n    copy(commands = commands :+ command)\n\nobject MacroCommand:\n  def apply[S](commands: Command[S]*): MacroCommand[S] = \n    MacroCommand(commands.toList)\n</code></pre>"},{"location":"scala/11-command-pattern/#_4","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>val macroCmd = MacroCommand(\n  InsertCommand(5, \" World\"),\n  InsertCommand(11, \"!\")\n)\n\nval exec = CommandExecutor(Document(\"Hello\"))\n  .execute(macroCmd)\n\nexec.state.content  // \"Hello World!\"\nexec.undoCount  // 1\uff08\u30de\u30af\u30ed\u5168\u4f53\u30671\u30b3\u30de\u30f3\u30c9\uff09\nexec.undo.state.content  // \"Hello\"\uff08\u4e00\u5ea6\u306b\u5168\u3066\u53d6\u308a\u6d88\u3057\uff09\n</code></pre>"},{"location":"scala/11-command-pattern/#7","title":"7. \u8a08\u7b97\u6a5f\u30b3\u30de\u30f3\u30c9","text":"<pre><code>case class Calculator(value: Double = 0)\n\ncase class AddCommand(operand: Double) extends Command[Calculator]:\n  def execute(calc: Calculator): Calculator = \n    calc.copy(value = calc.value + operand)\n  def undo(calc: Calculator): Calculator = \n    calc.copy(value = calc.value - operand)\n\ncase class MultiplyCommand(operand: Double) extends Command[Calculator]:\n  def execute(calc: Calculator): Calculator = \n    calc.copy(value = calc.value * operand)\n  def undo(calc: Calculator): Calculator = \n    calc.copy(value = calc.value / operand)\n</code></pre>"},{"location":"scala/11-command-pattern/#_5","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>val exec = CommandExecutor(Calculator())\n  .execute(AddCommand(100))\n  .execute(MultiplyCommand(2))\n  .execute(SubtractCommand(50))\n  .execute(DivideCommand(3))\n\nexec.state.value  // 50.0 ((100 * 2 - 50) / 3)\nexec.undo.state.value  // 150.0\n</code></pre>"},{"location":"scala/11-command-pattern/#8","title":"8. \u30d5\u30a1\u30a4\u30eb\u64cd\u4f5c\u30b3\u30de\u30f3\u30c9","text":"<pre><code>case class FileSystem(files: Map[String, String] = Map.empty)\n\ncase class CreateFileCommand(path: String, content: String) extends Command[FileSystem]:\n  def execute(fs: FileSystem): FileSystem = \n    fs.copy(files = fs.files + (path -&gt; content))\n  def undo(fs: FileSystem): FileSystem = \n    fs.copy(files = fs.files - path)\n\ncase class UpdateFileCommand(path: String, oldContent: String, newContent: String) \n    extends Command[FileSystem]:\n  def execute(fs: FileSystem): FileSystem = \n    fs.copy(files = fs.files + (path -&gt; newContent))\n  def undo(fs: FileSystem): FileSystem = \n    fs.copy(files = fs.files + (path -&gt; oldContent))\n</code></pre>"},{"location":"scala/11-command-pattern/#9","title":"9. \u30bf\u30b9\u30af\u7ba1\u7406\u30b3\u30de\u30f3\u30c9","text":"<pre><code>enum TaskStatus:\n  case Todo, InProgress, Done\n\ncase class Task(id: String, title: String, status: TaskStatus = TaskStatus.Todo)\n\ncase class TaskList(tasks: Map[String, Task] = Map.empty)\n\ncase class AddTaskCommand(task: Task) extends Command[TaskList]:\n  def execute(list: TaskList): TaskList = list.addTask(task)\n  def undo(list: TaskList): TaskList = list.removeTask(task.id)\n\ncase class ChangeTaskStatusCommand(\n  taskId: String,\n  oldStatus: TaskStatus,\n  newStatus: TaskStatus\n) extends Command[TaskList]:\n  def execute(list: TaskList): TaskList = \n    list.updateTask(taskId, _.copy(status = newStatus))\n  def undo(list: TaskList): TaskList = \n    list.updateTask(taskId, _.copy(status = oldStatus))\n</code></pre>"},{"location":"scala/11-command-pattern/#10","title":"10. \u30b3\u30de\u30f3\u30c9\u30ad\u30e5\u30fc\uff08\u9045\u5ef6\u5b9f\u884c\uff09","text":"<pre><code>case class CommandQueue[S](commands: List[Command[S]] = Nil):\n  def enqueue(command: Command[S]): CommandQueue[S] =\n    copy(commands = commands :+ command)\n\n  def executeAll(initialState: S): S =\n    commands.foldLeft(initialState)((s, cmd) =&gt; cmd.execute(s))\n\n  def executeNext(state: S): (S, CommandQueue[S]) =\n    commands match\n      case head :: tail =&gt; (head.execute(state), CommandQueue(tail))\n      case Nil =&gt; (state, this)\n</code></pre>"},{"location":"scala/11-command-pattern/#11","title":"11. \u95a2\u6570\u578b\u30b3\u30de\u30f3\u30c9","text":"<pre><code>case class FunctionalCommand[S](\n  executeFn: S =&gt; S,\n  undoFn: S =&gt; S,\n  description: String = \"\"\n) extends Command[S]:\n  def execute(state: S): S = executeFn(state)\n  def undo(state: S): S = undoFn(state)\n\nobject FunctionalCommand:\n  def reversible[S](forward: S =&gt; S, backward: S =&gt; S): FunctionalCommand[S] =\n    FunctionalCommand(forward, backward)\n\n  def symmetric[S](transform: S =&gt; S): FunctionalCommand[S] =\n    FunctionalCommand(transform, transform)\n</code></pre>"},{"location":"scala/11-command-pattern/#_6","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// \u53ef\u9006\u306a\u64cd\u4f5c\nval cmd = FunctionalCommand.reversible[Int](_ + 10, _ - 10)\ncmd.execute(5)  // 15\ncmd.undo(15)    // 5\n\n// \u5bfe\u79f0\u306a\u64cd\u4f5c\uff08toggle\u306a\u3069\uff09\nval toggle = FunctionalCommand.symmetric[Boolean](!_)\ntoggle.execute(true)  // false\ntoggle.undo(false)    // true\n</code></pre>"},{"location":"scala/11-command-pattern/#12","title":"12. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u64cd\u4f5c\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u5316: \u64cd\u4f5c\u3092\u30c7\u30fc\u30bf\u3068\u3057\u3066\u8868\u73fe\u3067\u304d\u308b</li> <li>Undo/Redo: \u64cd\u4f5c\u5c65\u6b74\u306e\u7ba1\u7406\u304c\u5bb9\u6613</li> <li>\u30d0\u30c3\u30c1\u51e6\u7406: \u8907\u6570\u306e\u64cd\u4f5c\u3092\u307e\u3068\u3081\u3066\u51e6\u7406</li> <li>\u9045\u5ef6\u5b9f\u884c: \u30b3\u30de\u30f3\u30c9\u3092\u30ad\u30e5\u30fc\u306b\u5165\u308c\u3066\u5f8c\u3067\u5b9f\u884c</li> <li>\u30ed\u30b0\u8a18\u9332: \u64cd\u4f5c\u306e\u5c65\u6b74\u3092\u30ed\u30b0\u3068\u3057\u3066\u4fdd\u5b58</li> <li>\u30de\u30af\u30ed: \u8907\u6570\u306e\u64cd\u4f5c\u3092\u4e00\u3064\u306b\u307e\u3068\u3081\u308b</li> </ol>"},{"location":"scala/11-command-pattern/#clojure","title":"Clojure \u3068\u306e\u6bd4\u8f03","text":"\u6982\u5ff5 Clojure Scala Command \u30de\u30c3\u30d7 + \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9 trait + case class execute/undo <code>(defmethod execute ...)</code> <code>def execute(s: S): S</code> \u72b6\u614b\u5909\u66f4 \u95a2\u6570\u3092\u8fd4\u3059 <code>(fn [state] ...)</code> \u76f4\u63a5\u65b0\u3057\u3044\u72b6\u614b\u3092\u8fd4\u3059 MacroCommand \u30d9\u30af\u30bf + reduce <code>case class MacroCommand</code> \u5c65\u6b74\u7ba1\u7406 \u30a2\u30c8\u30e0 + \u30d9\u30af\u30bf \u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u30ea\u30b9\u30c8"},{"location":"scala/11-command-pattern/#_7","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Command \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>Command \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9: execute \u3068 undo \u3092\u6301\u3064\u30b7\u30f3\u30d7\u30eb\u306a\u8a2d\u8a08</li> <li>\u5177\u4f53\u30b3\u30de\u30f3\u30c9: \u30c6\u30ad\u30b9\u30c8\u3001\u30ad\u30e3\u30f3\u30d0\u30b9\u3001\u8a08\u7b97\u6a5f\u3001\u30d5\u30a1\u30a4\u30eb\u3001\u30bf\u30b9\u30af</li> <li>CommandExecutor: Undo/Redo \u30b9\u30bf\u30c3\u30af\u306b\u3088\u308b\u5c65\u6b74\u7ba1\u7406</li> <li>MacroCommand: \u8907\u6570\u306e\u30b3\u30de\u30f3\u30c9\u3092\u4e00\u3064\u3068\u3057\u3066\u6271\u3046</li> <li>CommandQueue: \u9045\u5ef6\u5b9f\u884c\u306e\u305f\u3081\u306e\u30ad\u30e5\u30fc</li> <li>FunctionalCommand: \u95a2\u6570\u304b\u3089\u30b3\u30de\u30f3\u30c9\u3092\u751f\u6210</li> </ol> <p>Command \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u64cd\u4f5c\u306e\u5c65\u6b74\u7ba1\u7406\u3084\u53d6\u308a\u6d88\u3057\u6a5f\u80fd\u304c\u5fc5\u8981\u306a\u5834\u9762\u3067\u975e\u5e38\u306b\u6709\u52b9\u3067\u3059\u3002</p>"},{"location":"scala/11-command-pattern/#_8","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/scala/part3/src/main/scala/CommandPattern.scala</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/scala/part3/src/test/scala/CommandPatternSpec.scala</code></li> </ul>"},{"location":"scala/11-command-pattern/#_9","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Visitor \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u30c7\u30fc\u30bf\u69cb\u9020\u3068\u64cd\u4f5c\u3092\u5206\u96e2\u3057\u3001\u65b0\u3057\u3044\u64cd\u4f5c\u3092\u8ffd\u52a0\u3057\u3084\u3059\u304f\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"scala/12-visitor-pattern/","title":"\u7b2c12\u7ae0: Visitor \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"scala/12-visitor-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Visitor \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30c7\u30fc\u30bf\u69cb\u9020\u3068\u64cd\u4f5c\u3092\u5206\u96e2\u3057\u3001\u65e2\u5b58\u306e\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u5909\u66f4\u3059\u308b\u3053\u3068\u306a\u304f\u65b0\u3057\u3044\u64cd\u4f5c\u3092\u8ffd\u52a0\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u56f3\u5f62\uff08Shape\uff09\u3084\u5f0f\u6728\uff08Expression Tree\uff09\u306b\u5bfe\u3059\u308b\u69d8\u3005\u306a\u64cd\u4f5c\u3092\u901a\u3058\u3066\u3001Visitor \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"scala/12-visitor-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":""},{"location":"scala/12-visitor-pattern/#2-element","title":"2. Element: \u56f3\u5f62\u306e\u5b9a\u7fa9","text":"<pre><code>case class Point(x: Double, y: Double)\n\nsealed trait Shape:\n  def translate(dx: Double, dy: Double): Shape\n  def scale(factor: Double): Shape\n\ncase class Circle(center: Point, radius: Double) extends Shape\ncase class Square(topLeft: Point, side: Double) extends Shape\ncase class Rectangle(topLeft: Point, width: Double, height: Double) extends Shape\ncase class Triangle(p1: Point, p2: Point, p3: Point) extends Shape\ncase class CompositeShape(shapes: List[Shape]) extends Shape\n</code></pre>"},{"location":"scala/12-visitor-pattern/#3-visitor","title":"3. Visitor \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9","text":"<pre><code>trait ShapeVisitor[A]:\n  def visitCircle(circle: Circle): A\n  def visitSquare(square: Square): A\n  def visitRectangle(rectangle: Rectangle): A\n  def visitTriangle(triangle: Triangle): A\n  def visitComposite(composite: CompositeShape): A\n</code></pre>"},{"location":"scala/12-visitor-pattern/#accept","title":"accept \u62e1\u5f35\u30e1\u30bd\u30c3\u30c9","text":"<pre><code>extension (shape: Shape)\n  def accept[A](visitor: ShapeVisitor[A]): A = shape match\n    case c: Circle =&gt; visitor.visitCircle(c)\n    case s: Square =&gt; visitor.visitSquare(s)\n    case r: Rectangle =&gt; visitor.visitRectangle(r)\n    case t: Triangle =&gt; visitor.visitTriangle(t)\n    case cs: CompositeShape =&gt; visitor.visitComposite(cs)\n</code></pre>"},{"location":"scala/12-visitor-pattern/#4-visitor","title":"4. \u5177\u4f53 Visitor: \u9762\u7a4d\u8a08\u7b97","text":"<pre><code>object AreaVisitor extends ShapeVisitor[Double]:\n  def visitCircle(circle: Circle): Double =\n    math.Pi * circle.radius * circle.radius\n\n  def visitSquare(square: Square): Double =\n    square.side * square.side\n\n  def visitRectangle(rectangle: Rectangle): Double =\n    rectangle.width * rectangle.height\n\n  def visitTriangle(triangle: Triangle): Double =\n    val Triangle(p1, p2, p3) = triangle\n    math.abs((p2.x - p1.x) * (p3.y - p1.y) - (p3.x - p1.x) * (p2.y - p1.y)) / 2\n\n  def visitComposite(composite: CompositeShape): Double =\n    composite.shapes.map(_.accept(this)).sum\n</code></pre>"},{"location":"scala/12-visitor-pattern/#_2","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>val circle = Circle(Point(0, 0), 5)\ncircle.accept(AreaVisitor)  // 78.53981...\n\nval composite = CompositeShape(List(\n  Square(Point(0, 0), 10),\n  Rectangle(Point(0, 0), 5, 10)\n))\ncomposite.accept(AreaVisitor)  // 150.0\n</code></pre>"},{"location":"scala/12-visitor-pattern/#5-visitor-json","title":"5. \u5177\u4f53 Visitor: JSON \u5909\u63db","text":"<pre><code>object JsonVisitor extends ShapeVisitor[String]:\n  def visitCircle(circle: Circle): String =\n    s\"\"\"{\"type\":\"circle\",\"center\":{\"x\":${circle.center.x},\"y\":${circle.center.y}},\"radius\":${circle.radius}}\"\"\"\n\n  def visitSquare(square: Square): String =\n    s\"\"\"{\"type\":\"square\",\"topLeft\":{\"x\":${square.topLeft.x},\"y\":${square.topLeft.y}},\"side\":${square.side}}\"\"\"\n\n  def visitRectangle(rectangle: Rectangle): String =\n    s\"\"\"{\"type\":\"rectangle\",\"topLeft\":{\"x\":${rectangle.topLeft.x},\"y\":${rectangle.topLeft.y}},\"width\":${rectangle.width},\"height\":${rectangle.height}}\"\"\"\n\n  def visitComposite(composite: CompositeShape): String =\n    val shapesJson = composite.shapes.map(_.accept(this)).mkString(\",\")\n    s\"\"\"{\"type\":\"composite\",\"shapes\":[$shapesJson]}\"\"\"\n</code></pre>"},{"location":"scala/12-visitor-pattern/#6-visitor","title":"6. \u5177\u4f53 Visitor: \u30d0\u30a6\u30f3\u30c7\u30a3\u30f3\u30b0\u30dc\u30c3\u30af\u30b9","text":"<pre><code>case class BoundingBox(minX: Double, minY: Double, maxX: Double, maxY: Double):\n  def union(other: BoundingBox): BoundingBox =\n    BoundingBox(\n      math.min(minX, other.minX), math.min(minY, other.minY),\n      math.max(maxX, other.maxX), math.max(maxY, other.maxY)\n    )\n\nobject BoundingBoxVisitor extends ShapeVisitor[BoundingBox]:\n  def visitCircle(circle: Circle): BoundingBox =\n    val r = circle.radius\n    BoundingBox(\n      circle.center.x - r, circle.center.y - r,\n      circle.center.x + r, circle.center.y + r\n    )\n\n  def visitComposite(composite: CompositeShape): BoundingBox =\n    composite.shapes.map(_.accept(this)).reduce(_ union _)\n  // ...\n</code></pre>"},{"location":"scala/12-visitor-pattern/#7-visitor","title":"7. \u5177\u4f53 Visitor: \u63cf\u753b\u30b3\u30de\u30f3\u30c9\u751f\u6210","text":"<pre><code>sealed trait DrawCommand\ncase class DrawCircle(center: Point, radius: Double) extends DrawCommand\ncase class DrawRect(topLeft: Point, width: Double, height: Double) extends DrawCommand\ncase class DrawPolygon(points: List[Point]) extends DrawCommand\ncase class DrawGroup(commands: List[DrawCommand]) extends DrawCommand\n\nobject DrawVisitor extends ShapeVisitor[DrawCommand]:\n  def visitCircle(circle: Circle): DrawCommand =\n    DrawCircle(circle.center, circle.radius)\n\n  def visitSquare(square: Square): DrawCommand =\n    DrawRect(square.topLeft, square.side, square.side)\n\n  def visitTriangle(triangle: Triangle): DrawCommand =\n    DrawPolygon(List(triangle.p1, triangle.p2, triangle.p3))\n\n  def visitComposite(composite: CompositeShape): DrawCommand =\n    DrawGroup(composite.shapes.map(_.accept(this)))\n</code></pre>"},{"location":"scala/12-visitor-pattern/#8-visitor","title":"8. \u578b\u30af\u30e9\u30b9\u30d9\u30fc\u30b9\u306e Visitor","text":"<p>Scala 3 \u3067\u306f\u578b\u30af\u30e9\u30b9\u3092\u4f7f\u3063\u3066\u3088\u308a\u67d4\u8edf\u306a Visitor \u3092\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p> <pre><code>trait HasArea[A]:\n  def area(a: A): Double\n\nobject HasArea:\n  given HasArea[Circle] with\n    def area(c: Circle): Double = math.Pi * c.radius * c.radius\n\n  given HasArea[Square] with\n    def area(s: Square): Double = s.side * s.side\n\n  given HasArea[Rectangle] with\n    def area(r: Rectangle): Double = r.width * r.height\n\n// \u62e1\u5f35\u30e1\u30bd\u30c3\u30c9\nextension [A](a: A)\n  def area(using ha: HasArea[A]): Double = ha.area(a)\n</code></pre>"},{"location":"scala/12-visitor-pattern/#_3","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>import HasArea.given\n\nval circle = Circle(Point(0, 0), 5)\ncircle.area  // 78.53981...\n\nval rect = Rectangle(Point(0, 0), 10, 20)\nrect.area  // 200.0\n</code></pre>"},{"location":"scala/12-visitor-pattern/#9-visitor","title":"9. \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30d9\u30fc\u30b9\u306e Visitor","text":"<p>\u30b7\u30f3\u30d7\u30eb\u306a\u30b1\u30fc\u30b9\u3067\u306f\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u3067\u5b9f\u88c5\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u3059\u3002</p> <pre><code>object PatternMatchVisitor:\n  def calculateArea(shape: Shape): Double = shape match\n    case Circle(_, radius) =&gt; math.Pi * radius * radius\n    case Square(_, side) =&gt; side * side\n    case Rectangle(_, width, height) =&gt; width * height\n    case Triangle(p1, p2, p3) =&gt;\n      math.abs((p2.x - p1.x) * (p3.y - p1.y) - (p3.x - p1.x) * (p2.y - p1.y)) / 2\n    case CompositeShape(shapes) =&gt; shapes.map(calculateArea).sum\n\n  def toJson(shape: Shape): String = shape match\n    case Circle(center, radius) =&gt;\n      s\"\"\"{\"type\":\"circle\",\"center\":{\"x\":${center.x},\"y\":${center.y}},\"radius\":$radius}\"\"\"\n    case Square(topLeft, side) =&gt;\n      s\"\"\"{\"type\":\"square\",\"topLeft\":{\"x\":${topLeft.x},\"y\":${topLeft.y}},\"side\":$side}\"\"\"\n    // ...\n</code></pre>"},{"location":"scala/12-visitor-pattern/#10-visitor","title":"10. \u5f0f\u6728\u306e Visitor","text":"<p>Visitor \u30d1\u30bf\u30fc\u30f3\u306f\u5f0f\u6728\u306e\u51e6\u7406\u306b\u3082\u9069\u3057\u3066\u3044\u307e\u3059\u3002</p> <pre><code>sealed trait Expr\ncase class Num(value: Double) extends Expr\ncase class Var(name: String) extends Expr\ncase class Add(left: Expr, right: Expr) extends Expr\ncase class Mul(left: Expr, right: Expr) extends Expr\n\ntrait ExprVisitor[A]:\n  def visitNum(num: Num): A\n  def visitVar(v: Var): A\n  def visitAdd(add: Add): A\n  def visitMul(mul: Mul): A\n</code></pre>"},{"location":"scala/12-visitor-pattern/#visitor","title":"\u5f0f\u8a55\u4fa1 Visitor","text":"<pre><code>class EvalVisitor(env: Map[String, Double]) extends ExprVisitor[Double]:\n  def visitNum(num: Num): Double = num.value\n  def visitVar(v: Var): Double = env.getOrElse(v.name, 0.0)\n  def visitAdd(add: Add): Double = \n    add.left.accept(this) + add.right.accept(this)\n  def visitMul(mul: Mul): Double = \n    mul.left.accept(this) * mul.right.accept(this)\n</code></pre>"},{"location":"scala/12-visitor-pattern/#visitor_1","title":"\u5f0f\u7c21\u7d04 Visitor","text":"<pre><code>object SimplifyVisitor extends ExprVisitor[Expr]:\n  def visitAdd(add: Add): Expr =\n    (add.left.accept(this), add.right.accept(this)) match\n      case (Num(0), r) =&gt; r           // 0 + x = x\n      case (l, Num(0)) =&gt; l           // x + 0 = x\n      case (Num(a), Num(b)) =&gt; Num(a + b)  // \u5b9a\u6570\u7573\u307f\u8fbc\u307f\n      case (l, r) =&gt; Add(l, r)\n\n  def visitMul(mul: Mul): Expr =\n    (mul.left.accept(this), mul.right.accept(this)) match\n      case (Num(0), _) =&gt; Num(0)      // 0 * x = 0\n      case (_, Num(0)) =&gt; Num(0)      // x * 0 = 0\n      case (Num(1), r) =&gt; r           // 1 * x = x\n      case (l, Num(1)) =&gt; l           // x * 1 = x\n      case (l, r) =&gt; Mul(l, r)\n</code></pre>"},{"location":"scala/12-visitor-pattern/#11-visitor","title":"11. \u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0 Visitor","text":"<pre><code>sealed trait FileEntry:\n  def name: String\n\ncase class File(name: String, size: Long) extends FileEntry\ncase class Directory(name: String, entries: List[FileEntry]) extends FileEntry\n\ntrait FileVisitor[A]:\n  def visitFile(file: File): A\n  def visitDirectory(dir: Directory): A\n\nobject SizeVisitor extends FileVisitor[Long]:\n  def visitFile(file: File): Long = file.size\n  def visitDirectory(dir: Directory): Long =\n    dir.entries.map(_.accept(this)).sum\n\nobject FileCountVisitor extends FileVisitor[Int]:\n  def visitFile(file: File): Int = 1\n  def visitDirectory(dir: Directory): Int =\n    dir.entries.map(_.accept(this)).sum\n</code></pre>"},{"location":"scala/12-visitor-pattern/#12","title":"12. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9\u3068\u6b20\u70b9","text":""},{"location":"scala/12-visitor-pattern/#_4","title":"\u5229\u70b9","text":"<ol> <li>\u64cd\u4f5c\u306e\u8ffd\u52a0\u304c\u5bb9\u6613: \u65b0\u3057\u3044 Visitor \u3092\u8ffd\u52a0\u3059\u308b\u3060\u3051\u3067\u65b0\u3057\u3044\u64cd\u4f5c\u3092\u5b9f\u88c5\u53ef\u80fd</li> <li>\u95a2\u9023\u64cd\u4f5c\u306e\u96c6\u7d04: \u540c\u3058\u64cd\u4f5c\u306b\u95a2\u3059\u308b\u30b3\u30fc\u30c9\u304c\u4e00\u7b87\u6240\u306b\u307e\u3068\u307e\u308b</li> <li>\u578b\u5b89\u5168: \u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u306b\u5168\u3066\u306e\u30b1\u30fc\u30b9\u304c\u30ab\u30d0\u30fc\u3055\u308c\u3066\u3044\u308b\u304b\u78ba\u8a8d</li> </ol>"},{"location":"scala/12-visitor-pattern/#_5","title":"\u6b20\u70b9","text":"<ol> <li>\u8981\u7d20\u306e\u8ffd\u52a0\u304c\u56f0\u96e3: \u65b0\u3057\u3044\u8981\u7d20\u30bf\u30a4\u30d7\u3092\u8ffd\u52a0\u3059\u308b\u3068\u3001\u3059\u3079\u3066\u306e Visitor \u3092\u66f4\u65b0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b</li> <li>\u30ab\u30d7\u30bb\u30eb\u5316\u306e\u7834\u58ca: Visitor \u306f\u8981\u7d20\u306e\u5185\u90e8\u72b6\u614b\u306b\u30a2\u30af\u30bb\u30b9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b</li> </ol>"},{"location":"scala/12-visitor-pattern/#clojure","title":"Clojure \u3068\u306e\u6bd4\u8f03","text":"\u6982\u5ff5 Clojure Scala Visitor \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9 trait + object Element \u30de\u30c3\u30d7 + ::type sealed trait + case class \u30c7\u30a3\u30b9\u30d1\u30c3\u30c1 \u578b\u30ad\u30fc\u3067\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1 \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1 or accept \u62e1\u5f35\u6027 \u30aa\u30fc\u30d7\u30f3\uff08\u5f8c\u304b\u3089\u8ffd\u52a0\u53ef\u80fd\uff09 sealed\uff08\u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u78ba\u8a8d\uff09"},{"location":"scala/12-visitor-pattern/#_6","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Visitor \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>OOP \u30b9\u30bf\u30a4\u30eb: ShapeVisitor \u30c8\u30ec\u30a4\u30c8\u3068 accept \u62e1\u5f35\u30e1\u30bd\u30c3\u30c9</li> <li>\u5177\u4f53 Visitor: AreaVisitor, JsonVisitor, BoundingBoxVisitor, DrawVisitor</li> <li>\u578b\u30af\u30e9\u30b9\u30d9\u30fc\u30b9: HasArea, HasPerimeter, Serializable</li> <li>\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30d9\u30fc\u30b9: \u30b7\u30f3\u30d7\u30eb\u306a\u30b1\u30fc\u30b9\u3067\u306e\u5b9f\u88c5</li> <li>\u5f0f\u6728 Visitor: \u8a55\u4fa1\u3001\u6587\u5b57\u5217\u5316\u3001\u5909\u6570\u53ce\u96c6\u3001\u7c21\u7d04</li> <li>\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0 Visitor: \u30b5\u30a4\u30ba\u8a08\u7b97\u3001\u30d5\u30a1\u30a4\u30eb\u6570\u30ab\u30a6\u30f3\u30c8\u3001\u691c\u7d22</li> </ol> <p>Visitor \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30c7\u30fc\u30bf\u69cb\u9020\u304c\u5b89\u5b9a\u3057\u3066\u3044\u3066\u3001\u64cd\u4f5c\u3092\u983b\u7e41\u306b\u8ffd\u52a0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u5834\u9762\u3067\u6709\u52b9\u3067\u3059\u3002</p>"},{"location":"scala/12-visitor-pattern/#_7","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/scala/part3/src/main/scala/VisitorPattern.scala</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/scala/part3/src/test/scala/VisitorPatternSpec.scala</code></li> </ul>"},{"location":"scala/12-visitor-pattern/#4","title":"\u7b2c4\u90e8\u306e\u307e\u3068\u3081","text":"<p>\u7b2c4\u90e8\u3067\u306f\u3001\u632f\u308b\u821e\u3044\u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ul> <li>Strategy \u30d1\u30bf\u30fc\u30f3: \u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u30ab\u30d7\u30bb\u30eb\u5316\u3057\u4ea4\u63db\u53ef\u80fd\u306b\u3059\u308b</li> <li>Command \u30d1\u30bf\u30fc\u30f3: \u64cd\u4f5c\u3092\u30c7\u30fc\u30bf\u5316\u3057\u3001Undo/Redo \u3092\u5b9f\u73fe</li> <li>Visitor \u30d1\u30bf\u30fc\u30f3: \u30c7\u30fc\u30bf\u69cb\u9020\u3068\u64cd\u4f5c\u3092\u5206\u96e2\u3057\u3001\u65b0\u3057\u3044\u64cd\u4f5c\u3092\u8ffd\u52a0\u3057\u3084\u3059\u304f\u3059\u308b</li> </ul> <p>\u3053\u308c\u3089\u306e\u30d1\u30bf\u30fc\u30f3\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u7279\u6027\u3092\u6d3b\u304b\u3057\u3066\u7c21\u6f54\u306b\u5b9f\u88c5\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"scala/13-abstract-factory-pattern/","title":"\u7b2c13\u7ae0: Abstract Factory \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"scala/13-abstract-factory-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u95a2\u9023\u3059\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30d5\u30a1\u30df\u30ea\u30fc\u3092\u3001\u305d\u306e\u5177\u4f53\u7684\u306a\u30af\u30e9\u30b9\u3092\u6307\u5b9a\u3059\u308b\u3053\u3068\u306a\u304f\u751f\u6210\u3059\u308b\u305f\u3081\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u63d0\u4f9b\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u56f3\u5f62\u30d5\u30a1\u30af\u30c8\u30ea\u3001UI \u30d5\u30a1\u30af\u30c8\u30ea\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30d5\u30a1\u30af\u30c8\u30ea\u306e\u4f8b\u3092\u901a\u3058\u3066\u3001Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"scala/13-abstract-factory-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":""},{"location":"scala/13-abstract-factory-pattern/#2-product","title":"2. \u56f3\u5f62\u3068\u30b9\u30bf\u30a4\u30eb - Product","text":"<pre><code>case class Color(r: Int, g: Int, b: Int)\n\ncase class ShapeStyle(\n  strokeColor: Color = Color.Black,\n  strokeWidth: Double = 1.0,\n  fillColor: Color = Color.Transparent\n)\n\nsealed trait Shape:\n  def style: ShapeStyle\n  def translate(dx: Double, dy: Double): Shape\n  def scale(factor: Double): Shape\n  def withStyle(newStyle: ShapeStyle): Shape\n\ncase class Circle(center: Point, radius: Double, style: ShapeStyle = ShapeStyle()) extends Shape\ncase class Square(topLeft: Point, side: Double, style: ShapeStyle = ShapeStyle()) extends Shape\ncase class Rectangle(topLeft: Point, width: Double, height: Double, style: ShapeStyle = ShapeStyle()) extends Shape\n</code></pre>"},{"location":"scala/13-abstract-factory-pattern/#3-shapefactory-abstract-factory","title":"3. ShapeFactory - Abstract Factory","text":"<pre><code>trait ShapeFactory:\n  def createCircle(center: Point, radius: Double): Circle\n  def createSquare(topLeft: Point, side: Double): Square\n  def createRectangle(topLeft: Point, width: Double, height: Double): Rectangle\n  def createTriangle(p1: Point, p2: Point, p3: Point): Triangle\n</code></pre>"},{"location":"scala/13-abstract-factory-pattern/#4-concrete-factories","title":"4. Concrete Factories","text":""},{"location":"scala/13-abstract-factory-pattern/#standardshapefactory","title":"StandardShapeFactory","text":"<pre><code>object StandardShapeFactory extends ShapeFactory:\n  def createCircle(center: Point, radius: Double): Circle =\n    Circle(center, radius)\n\n  def createSquare(topLeft: Point, side: Double): Square =\n    Square(topLeft, side)\n\n  def createRectangle(topLeft: Point, width: Double, height: Double): Rectangle =\n    Rectangle(topLeft, width, height)\n\n  def createTriangle(p1: Point, p2: Point, p3: Point): Triangle =\n    Triangle(p1, p2, p3)\n</code></pre>"},{"location":"scala/13-abstract-factory-pattern/#outlinedshapefactory","title":"OutlinedShapeFactory","text":"<pre><code>class OutlinedShapeFactory(\n  strokeColor: Color,\n  strokeWidth: Double\n) extends ShapeFactory:\n  private val style = ShapeStyle(strokeColor = strokeColor, strokeWidth = strokeWidth)\n\n  def createCircle(center: Point, radius: Double): Circle =\n    Circle(center, radius, style)\n\n  def createSquare(topLeft: Point, side: Double): Square =\n    Square(topLeft, side, style)\n  // ...\n</code></pre>"},{"location":"scala/13-abstract-factory-pattern/#filledshapefactory","title":"FilledShapeFactory","text":"<pre><code>class FilledShapeFactory(\n  fillColor: Color,\n  strokeColor: Color = Color.Black,\n  strokeWidth: Double = 1.0\n) extends ShapeFactory:\n  private val style = ShapeStyle(strokeColor, strokeWidth, fillColor)\n\n  def createCircle(center: Point, radius: Double): Circle =\n    Circle(center, radius, style)\n  // ...\n</code></pre>"},{"location":"scala/13-abstract-factory-pattern/#_2","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>def createShapes(factory: ShapeFactory): List[Shape] =\n  List(\n    factory.createCircle(Point(0, 0), 5),\n    factory.createSquare(Point(10, 10), 10),\n    factory.createRectangle(Point(20, 20), 10, 5)\n  )\n\n// \u30d5\u30a1\u30af\u30c8\u30ea\u3092\u5207\u308a\u66ff\u3048\u308b\u3060\u3051\u3067\u7570\u306a\u308b\u30b9\u30bf\u30a4\u30eb\u306e\u56f3\u5f62\u3092\u751f\u6210\nval standardShapes = createShapes(StandardShapeFactory)\nval outlinedShapes = createShapes(OutlinedShapeFactory(Color.Red, 3.0))\nval filledShapes = createShapes(FilledShapeFactory(Color.Blue))\n</code></pre>"},{"location":"scala/13-abstract-factory-pattern/#5-uifactory-ui","title":"5. UIFactory - \u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u5225 UI","text":""},{"location":"scala/13-abstract-factory-pattern/#ui","title":"UI \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8","text":"<pre><code>trait Button:\n  def label: String\n  def theme: Theme\n  def render: String\n\ntrait TextField:\n  def placeholder: String\n  def value: String\n  def setValue(newValue: String): TextField\n\ntrait Checkbox:\n  def label: String\n  def checked: Boolean\n  def toggle: Checkbox\n</code></pre>"},{"location":"scala/13-abstract-factory-pattern/#uifactory","title":"UIFactory \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9","text":"<pre><code>trait UIFactory:\n  def theme: Theme\n  def createButton(label: String): Button\n  def createTextField(placeholder: String): TextField\n  def createCheckbox(label: String, checked: Boolean = false): Checkbox\n</code></pre>"},{"location":"scala/13-abstract-factory-pattern/#_3","title":"\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u5225\u5b9f\u88c5","text":"<pre><code>// Windows\nclass WindowsUIFactory(val theme: Theme = Theme.Light) extends UIFactory:\n  def createButton(label: String): WindowsButton = WindowsButton(label, theme)\n  def createTextField(placeholder: String): WindowsTextField = WindowsTextField(placeholder, theme)\n  def createCheckbox(label: String, checked: Boolean = false): WindowsCheckbox = WindowsCheckbox(label, checked, theme)\n\n// MacOS\nclass MacOSUIFactory(val theme: Theme = Theme.Light) extends UIFactory:\n  def createButton(label: String): MacOSButton = MacOSButton(label, theme)\n  // ...\n\n// Web\nclass WebUIFactory(val theme: Theme = Theme.Light) extends UIFactory:\n  def createButton(label: String): WebButton = WebButton(label, theme)\n  // ...\n</code></pre>"},{"location":"scala/13-abstract-factory-pattern/#_4","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>def createForm(factory: UIFactory): Map[String, String] =\n  Map(\n    \"button\" -&gt; factory.createButton(\"Submit\").render,\n    \"field\" -&gt; factory.createTextField(\"Email\").render,\n    \"checkbox\" -&gt; factory.createCheckbox(\"Accept\").render\n  )\n\nval windowsForm = createForm(WindowsUIFactory())  // [\u2591 Submit]\nval macForm = createForm(MacOSUIFactory())        // (\u25cb Submit)\nval webForm = createForm(WebUIFactory())          // &lt;button&gt;Submit&lt;/button&gt;\n</code></pre>"},{"location":"scala/13-abstract-factory-pattern/#6-databasefactory-","title":"6. DatabaseFactory - \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u62bd\u8c61\u5316","text":""},{"location":"scala/13-abstract-factory-pattern/#_5","title":"\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8","text":"<pre><code>trait Connection:\n  def database: String\n  def isConnected: Boolean\n  def connect(): Connection\n  def disconnect(): Connection\n  def execute(sql: String): QueryResult\n\ntrait QueryBuilder:\n  def select(columns: String*): QueryBuilder\n  def from(table: String): QueryBuilder\n  def where(condition: String): QueryBuilder\n  def orderBy(column: String, ascending: Boolean = true): QueryBuilder\n  def limit(n: Int): QueryBuilder\n  def build: String\n</code></pre>"},{"location":"scala/13-abstract-factory-pattern/#databasefactory","title":"DatabaseFactory \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9","text":"<pre><code>trait DatabaseFactory:\n  def createConnection(database: String): Connection\n  def createQueryBuilder(): QueryBuilder\n  def databaseType: String\n</code></pre>"},{"location":"scala/13-abstract-factory-pattern/#_6","title":"\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u5225\u5b9f\u88c5","text":"<pre><code>object PostgreSQLFactory extends DatabaseFactory:\n  def createConnection(database: String): PostgreSQLConnection = PostgreSQLConnection(database)\n  def createQueryBuilder(): PostgreSQLQueryBuilder = new PostgreSQLQueryBuilder\n  def databaseType: String = \"PostgreSQL\"\n\nobject MySQLFactory extends DatabaseFactory:\n  def createConnection(database: String): MySQLConnection = MySQLConnection(database)\n  def createQueryBuilder(): MySQLQueryBuilder = new MySQLQueryBuilder\n  def databaseType: String = \"MySQL\"\n\nobject SQLiteFactory extends DatabaseFactory:\n  def createConnection(database: String): SQLiteConnection = SQLiteConnection(database)\n  def createQueryBuilder(): SQLiteQueryBuilder = new SQLiteQueryBuilder\n  def databaseType: String = \"SQLite\"\n</code></pre>"},{"location":"scala/13-abstract-factory-pattern/#_7","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>def executeQuery(factory: DatabaseFactory, db: String): QueryResult =\n  val conn = factory.createConnection(db).connect()\n  val query = factory.createQueryBuilder()\n    .select(\"id\", \"name\")\n    .from(\"users\")\n    .where(\"active = true\")\n    .limit(10)\n    .build\n  conn.execute(query)\n\n// \u30d5\u30a1\u30af\u30c8\u30ea\u3092\u5207\u308a\u66ff\u3048\u308b\u3060\u3051\u3067\u7570\u306a\u308b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u5bfe\u5fdc\nval pgResult = executeQuery(PostgreSQLFactory, \"pg_db\")\nval mysqlResult = executeQuery(MySQLFactory, \"mysql_db\")\nval sqliteResult = executeQuery(SQLiteFactory, \"sqlite.db\")\n</code></pre>"},{"location":"scala/13-abstract-factory-pattern/#7","title":"7. \u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1","text":"<pre><code>object FunctionalFactory:\n  case class FactoryConfig(\n    strokeColor: Color = Color.Black,\n    strokeWidth: Double = 1.0,\n    fillColor: Color = Color.Transparent\n  ):\n    def style: ShapeStyle = ShapeStyle(strokeColor, strokeWidth, fillColor)\n\n  def circleCreator(config: FactoryConfig)(center: Point, radius: Double): Circle =\n    Circle(center, radius, config.style)\n\n  def squareCreator(config: FactoryConfig)(topLeft: Point, side: Double): Square =\n    Square(topLeft, side, config.style)\n\n  // \u30d5\u30a1\u30af\u30c8\u30ea\u3092\u5408\u6210\n  def composeFactory(\n    baseConfig: FactoryConfig,\n    modifiers: (FactoryConfig =&gt; FactoryConfig)*\n  ): FactoryConfig =\n    modifiers.foldLeft(baseConfig)((config, modifier) =&gt; modifier(config))\n\n  // \u4fee\u98fe\u5b50\n  def withStroke(color: Color, width: Double): FactoryConfig =&gt; FactoryConfig =\n    config =&gt; config.copy(strokeColor = color, strokeWidth = width)\n\n  def withFill(color: Color): FactoryConfig =&gt; FactoryConfig =\n    config =&gt; config.copy(fillColor = color)\n</code></pre>"},{"location":"scala/13-abstract-factory-pattern/#_8","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>import FunctionalFactory._\n\nval config = composeFactory(\n  FactoryConfig(),\n  withStroke(Color.Red, 2.0),\n  withFill(Color.Blue)\n)\n\nval createCircle = circleCreator(config) _\nval circle = createCircle(Point(10, 20), 5)\n// Circle with red stroke and blue fill\n</code></pre>"},{"location":"scala/13-abstract-factory-pattern/#8","title":"8. \u30d5\u30a1\u30af\u30c8\u30ea\u30ec\u30b8\u30b9\u30c8\u30ea","text":"<pre><code>object FactoryRegistry:\n  private var shapeFactories: Map[String, ShapeFactory] = Map(\n    \"standard\" -&gt; StandardShapeFactory,\n    \"outlined\" -&gt; OutlinedShapeFactory(Color.Black, 2.0),\n    \"filled\" -&gt; FilledShapeFactory(Color.Blue)\n  )\n\n  def registerShapeFactory(name: String, factory: ShapeFactory): Unit =\n    shapeFactories = shapeFactories + (name -&gt; factory)\n\n  def getShapeFactory(name: String): Option[ShapeFactory] =\n    shapeFactories.get(name)\n</code></pre>"},{"location":"scala/13-abstract-factory-pattern/#_9","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>val factory = FactoryRegistry.getShapeFactory(\"filled\")\nfactory.foreach { f =&gt;\n  val circle = f.createCircle(Point(0, 0), 10)\n  // Blue filled circle\n}\n</code></pre>"},{"location":"scala/13-abstract-factory-pattern/#9","title":"9. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u88fd\u54c1\u30d5\u30a1\u30df\u30ea\u30fc\u306e\u4e00\u8cab\u6027: \u95a2\u9023\u3059\u308b\u88fd\u54c1\u304c\u4e00\u8cab\u3057\u3066\u751f\u6210\u3055\u308c\u308b</li> <li>\u5177\u4f53\u30af\u30e9\u30b9\u306e\u5206\u96e2: \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306f\u5177\u4f53\u7684\u306a\u88fd\u54c1\u30af\u30e9\u30b9\u3092\u77e5\u3089\u306a\u3044</li> <li>\u88fd\u54c1\u30d5\u30a1\u30df\u30ea\u30fc\u306e\u4ea4\u63db: \u30d5\u30a1\u30af\u30c8\u30ea\u3092\u4ea4\u63db\u3059\u308b\u3060\u3051\u3067\u88fd\u54c1\u7fa4\u5168\u4f53\u3092\u5909\u66f4\u53ef\u80fd</li> <li>\u65b0\u3057\u3044\u88fd\u54c1\u30d5\u30a1\u30df\u30ea\u30fc\u306e\u8ffd\u52a0\u304c\u5bb9\u6613: \u65b0\u3057\u3044 ConcreteFactory \u3092\u8ffd\u52a0\u3059\u308b\u3060\u3051</li> </ol>"},{"location":"scala/13-abstract-factory-pattern/#clojure","title":"Clojure \u3068\u306e\u6bd4\u8f03","text":"\u6982\u5ff5 Clojure Scala AbstractFactory \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9 trait ConcreteFactory defmethod object/class extends trait Product \u30de\u30c3\u30d7 case class \u30d5\u30a1\u30af\u30c8\u30ea\u8a2d\u5b9a \u30de\u30c3\u30d7\u306e\u30ad\u30fc \u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u5f15\u6570 \u30d5\u30a1\u30af\u30c8\u30ea\u9078\u629e \u578b\u30ad\u30fc\u3067\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1 \u591a\u614b\u6027 or \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1"},{"location":"scala/13-abstract-factory-pattern/#_10","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>ShapeFactory: Standard, Outlined, Filled \u306e\u5404\u30d5\u30a1\u30af\u30c8\u30ea</li> <li>UIFactory: Windows, MacOS, Web \u306e\u5404\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0</li> <li>DatabaseFactory: PostgreSQL, MySQL, SQLite \u306e\u5404\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9</li> <li>\u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1: \u8a2d\u5b9a\u3068\u4fee\u98fe\u5b50\u306b\u3088\u308b\u5408\u6210</li> <li>\u30d5\u30a1\u30af\u30c8\u30ea\u30ec\u30b8\u30b9\u30c8\u30ea: \u30d5\u30a1\u30af\u30c8\u30ea\u306e\u52d5\u7684\u306a\u767b\u9332\u3068\u53d6\u5f97</li> </ol> <p>Abstract Factory \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u95a2\u9023\u3059\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30d5\u30a1\u30df\u30ea\u30fc\u3092\u4e00\u8cab\u3057\u3066\u751f\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u5834\u9762\u3067\u6709\u52b9\u3067\u3059\u3002</p>"},{"location":"scala/13-abstract-factory-pattern/#_11","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/scala/part3/src/main/scala/AbstractFactoryPattern.scala</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/scala/part3/src/test/scala/AbstractFactoryPatternSpec.scala</code></li> </ul>"},{"location":"scala/13-abstract-factory-pattern/#_12","title":"\u6b21\u7ae0\u4e88\u544a","text":"<p>\u6b21\u7ae0\u3067\u306f\u3001Abstract Server \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u4f9d\u5b58\u95a2\u4fc2\u306e\u9006\u8ee2\u3092\u5b9f\u73fe\u3057\u3001\u30e2\u30b8\u30e5\u30fc\u30eb\u9593\u306e\u758e\u7d50\u5408\u3092\u9054\u6210\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p>"},{"location":"scala/14-abstract-server-pattern/","title":"\u7b2c14\u7ae0: Abstract Server \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"scala/14-abstract-server-pattern/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>Abstract Server \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u4f9d\u5b58\u95a2\u4fc2\u9006\u8ee2\u306e\u539f\u5247\uff08DIP\uff09\u3092\u5b9f\u73fe\u3059\u308b\u30d1\u30bf\u30fc\u30f3\u3067\u3059\u3002\u9ad8\u30ec\u30d9\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u4f4e\u30ec\u30d9\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u8a73\u7d30\u306b\u4f9d\u5b58\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u4e21\u8005\u304c\u62bd\u8c61\u306b\u4f9d\u5b58\u3059\u308b\u3053\u3068\u3067\u758e\u7d50\u5408\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p> <p>\u672c\u7ae0\u3067\u306f\u3001\u30b9\u30a4\u30c3\u30c1\u3068\u30c7\u30d0\u30a4\u30b9\u3001\u30ea\u30dd\u30b8\u30c8\u30ea\u3068\u30b5\u30fc\u30d3\u30b9\u306e\u4f8b\u3092\u901a\u3058\u3066\u3001Scala \u306e trait \u3068\u578b\u30af\u30e9\u30b9\u306b\u3088\u308b Abstract Server \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p>"},{"location":"scala/14-abstract-server-pattern/#1","title":"1. \u30d1\u30bf\u30fc\u30f3\u306e\u69cb\u9020","text":"<p>Abstract Server \u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u8981\u7d20\u3067\u69cb\u6210\u3055\u308c\u307e\u3059\uff1a</p> <ul> <li>Client: \u30b5\u30fc\u30d3\u30b9\u3092\u5229\u7528\u3059\u308b\u30e2\u30b8\u30e5\u30fc\u30eb</li> <li>Abstract Server: \u30b5\u30fc\u30d3\u30b9\u306e\u62bd\u8c61\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9</li> <li>Concrete Server: \u5177\u4f53\u7684\u306a\u30b5\u30fc\u30d3\u30b9\u306e\u5b9f\u88c5</li> </ul> <p></p>"},{"location":"scala/14-abstract-server-pattern/#2-switchable-","title":"2. Switchable \u30d1\u30bf\u30fc\u30f3 - \u578b\u30af\u30e9\u30b9\u30a2\u30d7\u30ed\u30fc\u30c1","text":""},{"location":"scala/14-abstract-server-pattern/#abstract-server","title":"Abstract Server \u306e\u5b9a\u7fa9","text":"<pre><code>/**\n * Abstract Server: \u30b9\u30a4\u30c3\u30c1\u53ef\u80fd\u306a\u30c7\u30d0\u30a4\u30b9\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\n */\ntrait Switchable[A]:\n  def turnOn(device: A): A\n  def turnOff(device: A): A\n  def isOn(device: A): Boolean\n\n/**\n * Switchable \u306e\u62e1\u5f35\u30e1\u30bd\u30c3\u30c9\n */\nextension [A](device: A)(using s: Switchable[A])\n  def on: A = s.turnOn(device)\n  def off: A = s.turnOff(device)\n  def isOn: Boolean = s.isOn(device)\n  def toggle: A = if device.isOn then device.off else device.on\n</code></pre> <p>Scala \u3067\u306f\u578b\u30af\u30e9\u30b9\u3092\u4f7f\u7528\u3057\u3066\u3001\u7570\u306a\u308b\u578b\u306b\u5171\u901a\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002<code>Switchable[A]</code> \u306f\u4efb\u610f\u306e\u578b <code>A</code> \u306b\u5bfe\u3057\u3066\u30b9\u30a4\u30c3\u30c1\u64cd\u4f5c\u3092\u5b9a\u7fa9\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"scala/14-abstract-server-pattern/#3-concrete-server-light","title":"3. Concrete Server: Light","text":"<pre><code>enum LightState:\n  case On, Off\n\ncase class Light(state: LightState = LightState.Off)\n\ngiven Switchable[Light] with\n  def turnOn(light: Light): Light = light.copy(state = LightState.On)\n  def turnOff(light: Light): Light = light.copy(state = LightState.Off)\n  def isOn(light: Light): Boolean = light.state == LightState.On\n</code></pre>"},{"location":"scala/14-abstract-server-pattern/#_2","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>val light = Light()\nlight.isOn        // false\n\nval lightOn = light.on\nlightOn.isOn      // true\n\nval toggled = light.toggle\ntoggled.isOn      // true\n</code></pre>"},{"location":"scala/14-abstract-server-pattern/#4-concrete-server-fan","title":"4. Concrete Server: Fan","text":"<pre><code>enum FanSpeed:\n  case Low, Medium, High\n\ncase class Fan(\n  state: LightState = LightState.Off,\n  speed: Option[FanSpeed] = None\n)\n\ngiven Switchable[Fan] with\n  def turnOn(fan: Fan): Fan =\n    fan.copy(state = LightState.On, speed = Some(fan.speed.getOrElse(FanSpeed.Low)))\n  def turnOff(fan: Fan): Fan =\n    fan.copy(state = LightState.Off, speed = None)\n  def isOn(fan: Fan): Boolean = fan.state == LightState.On\n\nobject Fan:\n  def setSpeed(fan: Fan, speed: FanSpeed): Fan =\n    if fan.isOn then fan.copy(speed = Some(speed)) else fan\n</code></pre> <p>Fan \u306f\u30aa\u30f3\u306b\u3059\u308b\u3068\u30c7\u30d5\u30a9\u30eb\u30c8\u3067 Low \u30b9\u30d4\u30fc\u30c9\u306b\u306a\u308a\u3001\u30aa\u30d5\u306b\u3059\u308b\u3068\u30b9\u30d4\u30fc\u30c9\u304c\u30ea\u30bb\u30c3\u30c8\u3055\u308c\u307e\u3059\u3002</p>"},{"location":"scala/14-abstract-server-pattern/#5-concrete-server-motor","title":"5. Concrete Server: Motor","text":"<pre><code>enum MotorDirection:\n  case Forward, Reverse\n\ncase class Motor(\n  state: LightState = LightState.Off,\n  direction: Option[MotorDirection] = None\n)\n\ngiven Switchable[Motor] with\n  def turnOn(motor: Motor): Motor =\n    motor.copy(\n      state = LightState.On,\n      direction = Some(motor.direction.getOrElse(MotorDirection.Forward))\n    )\n  def turnOff(motor: Motor): Motor =\n    motor.copy(state = LightState.Off)\n  def isOn(motor: Motor): Boolean = motor.state == LightState.On\n\nobject Motor:\n  def reverseDirection(motor: Motor): Motor =\n    if motor.isOn then\n      val newDirection = motor.direction match\n        case Some(MotorDirection.Forward) =&gt; MotorDirection.Reverse\n        case Some(MotorDirection.Reverse) =&gt; MotorDirection.Forward\n        case None =&gt; MotorDirection.Forward\n      motor.copy(direction = Some(newDirection))\n    else motor\n</code></pre>"},{"location":"scala/14-abstract-server-pattern/#6-client-switch","title":"6. Client: Switch","text":"<pre><code>/**\n * Switch \u30af\u30e9\u30a4\u30a2\u30f3\u30c8 - Switchable \u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u901a\u3058\u3066\u30c7\u30d0\u30a4\u30b9\u3092\u64cd\u4f5c\n */\nobject Switch:\n  def engage[A: Switchable](device: A): A = device.on\n  def disengage[A: Switchable](device: A): A = device.off\n  def toggle[A: Switchable](device: A): A = device.toggle\n  def status[A: Switchable](device: A): String = if device.isOn then \"on\" else \"off\"\n</code></pre> <p>Switch \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306f\u5177\u4f53\u7684\u306a\u30c7\u30d0\u30a4\u30b9\u578b\u3092\u77e5\u308a\u307e\u305b\u3093\u3002<code>Switchable</code> \u578b\u30af\u30e9\u30b9\u3092\u901a\u3058\u3066\u306e\u307f\u30c7\u30d0\u30a4\u30b9\u3068\u5bfe\u8a71\u3057\u307e\u3059\u3002</p>"},{"location":"scala/14-abstract-server-pattern/#_3","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// \u540c\u3058 Switch \u30b3\u30fc\u30c9\u3067\u7570\u306a\u308b\u30c7\u30d0\u30a4\u30b9\u3092\u64cd\u4f5c\nval light = Switch.engage(Light())\nSwitch.status(light)  // \"on\"\n\nval fan = Switch.engage(Fan())\nSwitch.status(fan)    // \"on\"\n\nval motor = Switch.engage(Motor())\nSwitch.status(motor)  // \"on\"\n</code></pre>"},{"location":"scala/14-abstract-server-pattern/#7-repository","title":"7. Repository \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"scala/14-abstract-server-pattern/#abstract-server-repository","title":"Abstract Server: Repository","text":"<pre><code>/**\n * Abstract Server: \u30ea\u30dd\u30b8\u30c8\u30ea\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\n */\ntrait Repository[F[_], E, ID]:\n  def findById(id: ID): F[Option[E]]\n  def findAll: F[Seq[E]]\n  def save(entity: E): F[E]\n  def delete(id: ID): F[Option[E]]\n\n/**\n * User \u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\n */\ncase class User(\n  id: Option[Id] = None,\n  name: String,\n  email: String,\n  createdAt: Long = System.currentTimeMillis()\n)\n</code></pre> <p><code>Repository</code> \u306f\u9ad8\u30ab\u30a4\u30f3\u30c9\u578b <code>F[_]</code> \u3092\u4f7f\u7528\u3057\u3066\u3001\u540c\u671f\uff08<code>Identity</code>\uff09\u3084\u975e\u540c\u671f\uff08<code>Future</code>\uff09\u306a\u3069\u7570\u306a\u308b\u52b9\u679c\u3092\u62bd\u8c61\u5316\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"scala/14-abstract-server-pattern/#concrete-server-memoryrepository","title":"Concrete Server: MemoryRepository","text":"<pre><code>type Identity[A] = A\n\nclass MemoryRepository[E, ID](\n  getId: E =&gt; Option[ID],\n  setId: (E, ID) =&gt; E,\n  generateId: () =&gt; ID\n) extends Repository[Identity, E, ID]:\n\n  private var data: Map[ID, E] = Map.empty\n\n  def findById(id: ID): Identity[Option[E]] = data.get(id)\n  def findAll: Identity[Seq[E]] = data.values.toSeq\n  def save(entity: E): Identity[E] =\n    val id = getId(entity).getOrElse(generateId())\n    val entityWithId = setId(entity, id)\n    data = data + (id -&gt; entityWithId)\n    entityWithId\n  def delete(id: ID): Identity[Option[E]] =\n    val entity = data.get(id)\n    data = data - id\n    entity\n</code></pre>"},{"location":"scala/14-abstract-server-pattern/#client-userservice","title":"Client: UserService","text":"<pre><code>object UserService:\n  def createUser[F[_]](\n    repository: Repository[F, User, Id],\n    name: String,\n    email: String\n  ): F[User] =\n    repository.save(User(name = name, email = email))\n\n  def getUser[F[_]](\n    repository: Repository[F, User, Id],\n    id: Id\n  ): F[Option[User]] =\n    repository.findById(id)\n\n  def getAllUsers[F[_]](\n    repository: Repository[F, User, Id]\n  ): F[Seq[User]] =\n    repository.findAll\n</code></pre> <p>UserService \u306f <code>Repository</code> \u30c8\u30ec\u30a4\u30c8\u306b\u306e\u307f\u4f9d\u5b58\u3057\u3001\u5177\u4f53\u7684\u306a\u5b9f\u88c5\uff08\u30e1\u30e2\u30ea\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\uff09\u3092\u77e5\u308a\u307e\u305b\u3093\u3002</p>"},{"location":"scala/14-abstract-server-pattern/#8-logger","title":"8. Logger \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"scala/14-abstract-server-pattern/#abstract-server_1","title":"Abstract Server \u3068\u5b9f\u88c5","text":"<pre><code>trait Logger:\n  def debug(message: String): Unit\n  def info(message: String): Unit\n  def warn(message: String): Unit\n  def error(message: String): Unit\n  def error(message: String, throwable: Throwable): Unit\n\n// \u30c6\u30b9\u30c8\u7528\u30ed\u30ac\u30fc\nclass TestLogger extends Logger:\n  private var logs: List[(String, String)] = List.empty\n  def debug(message: String): Unit = logs = logs :+ (\"DEBUG\", message)\n  def info(message: String): Unit = logs = logs :+ (\"INFO\", message)\n  def warn(message: String): Unit = logs = logs :+ (\"WARN\", message)\n  def error(message: String): Unit = logs = logs :+ (\"ERROR\", message)\n  def error(message: String, throwable: Throwable): Unit =\n    logs = logs :+ (\"ERROR\", s\"$message: ${throwable.getMessage}\")\n  def getLogs: List[(String, String)] = logs\n\n// \u30b5\u30a4\u30ec\u30f3\u30c8\u30ed\u30ac\u30fc\nobject SilentLogger extends Logger:\n  def debug(message: String): Unit = ()\n  def info(message: String): Unit = ()\n  def warn(message: String): Unit = ()\n  def error(message: String): Unit = ()\n  def error(message: String, throwable: Throwable): Unit = ()\n</code></pre> <p>\u30c6\u30b9\u30c8\u6642\u306f <code>TestLogger</code> \u3092\u4f7f\u7528\u3057\u3066\u30ed\u30b0\u3092\u691c\u8a3c\u3057\u3001\u672c\u756a\u3067\u306f <code>ConsoleLogger</code> \u3092\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"scala/14-abstract-server-pattern/#9-notification","title":"9. Notification \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"scala/14-abstract-server-pattern/#abstract-server_2","title":"Abstract Server \u3068\u5b9f\u88c5","text":"<pre><code>trait NotificationService:\n  def send(recipient: String, subject: String, message: String): Boolean\n\n// \u30e2\u30c3\u30af\u901a\u77e5\uff08\u30c6\u30b9\u30c8\u7528\uff09\nclass MockNotification extends NotificationService:\n  private var sentNotifications: List[(String, String, String)] = List.empty\n  def send(recipient: String, subject: String, message: String): Boolean =\n    sentNotifications = sentNotifications :+ (recipient, subject, message)\n    true\n  def getSentNotifications: List[(String, String, String)] = sentNotifications\n\n// \u8907\u5408\u901a\u77e5\uff08\u8907\u6570\u306e\u30c1\u30e3\u30cd\u30eb\u306b\u9001\u4fe1\uff09\nclass CompositeNotification(services: NotificationService*) extends NotificationService:\n  def send(recipient: String, subject: String, message: String): Boolean =\n    services.forall(_.send(recipient, subject, message))\n</code></pre>"},{"location":"scala/14-abstract-server-pattern/#10","title":"10. \u4f9d\u5b58\u6027\u6ce8\u5165","text":""},{"location":"scala/14-abstract-server-pattern/#constructor-injection","title":"Constructor Injection","text":"<pre><code>class UserManagementService(\n  repository: Repository[Identity, User, Id],\n  notification: NotificationService,\n  logger: Logger\n):\n  def registerUser(name: String, email: String): User =\n    logger.info(s\"Registering user: $name\")\n    val user = repository.save(User(name = name, email = email))\n    notification.send(\n      email,\n      \"Welcome!\",\n      s\"Hello $name, your account has been created.\"\n    )\n    logger.info(s\"User registered: ${user.id.getOrElse(\"unknown\")}\")\n    user\n</code></pre> <p>\u3059\u3079\u3066\u306e\u4f9d\u5b58\u6027\u304c\u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf\u3067\u6ce8\u5165\u3055\u308c\u3001\u30c6\u30b9\u30c8\u6642\u306b\u30e2\u30c3\u30af\u3092\u7c21\u5358\u306b\u5dee\u3057\u66ff\u3048\u3089\u308c\u307e\u3059\u3002</p>"},{"location":"scala/14-abstract-server-pattern/#reader","title":"Reader \u30b9\u30bf\u30a4\u30eb","text":"<pre><code>case class AppEnv(\n  repository: Repository[Identity, User, Id],\n  notification: NotificationService,\n  logger: Logger\n)\n\ntype Reader[A] = AppEnv =&gt; A\n\ndef createUserR(name: String, email: String): Reader[User] = env =&gt;\n  env.logger.info(s\"Creating user: $name\")\n  val user = env.repository.save(User(name = name, email = email))\n  env.notification.send(email, \"Welcome!\", s\"Hello $name!\")\n  user\n\ndef getUserR(id: Id): Reader[Option[User]] = env =&gt;\n  env.repository.findById(id)\n</code></pre> <p>Reader \u30d1\u30bf\u30fc\u30f3\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u74b0\u5883\u3092\u660e\u793a\u7684\u306b\u6e21\u3055\u305a\u306b\u4f9d\u5b58\u6027\u3092\u5229\u7528\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"scala/14-abstract-server-pattern/#11-payment-gateway","title":"11. Payment Gateway \u30d1\u30bf\u30fc\u30f3","text":"<pre><code>sealed trait PaymentResult\ncase class PaymentSuccess(transactionId: String, amount: Double) extends PaymentResult\ncase class PaymentFailure(reason: String) extends PaymentResult\n\ntrait PaymentGateway:\n  def charge(amount: Double, cardToken: String): PaymentResult\n  def refund(transactionId: String, amount: Double): PaymentResult\n\n// Stripe Gateway\nclass StripeGateway extends PaymentGateway:\n  def charge(amount: Double, cardToken: String): PaymentResult =\n    if cardToken.startsWith(\"valid_\") then\n      PaymentSuccess(s\"stripe_${System.currentTimeMillis()}\", amount)\n    else\n      PaymentFailure(\"Invalid card token\")\n  // ...\n\n// PayPal Gateway\nclass PayPalGateway extends PaymentGateway:\n  def charge(amount: Double, cardToken: String): PaymentResult =\n    if cardToken.startsWith(\"valid_\") then\n      PaymentSuccess(s\"paypal_${System.currentTimeMillis()}\", amount)\n    else\n      PaymentFailure(\"Invalid card token\")\n  // ...\n\n// Client\nclass CheckoutService(paymentGateway: PaymentGateway):\n  def processPayment(amount: Double, cardToken: String): Either[String, String] =\n    paymentGateway.charge(amount, cardToken) match\n      case PaymentSuccess(transactionId, _) =&gt; Right(transactionId)\n      case PaymentFailure(reason) =&gt; Left(reason)\n</code></pre> <p><code>CheckoutService</code> \u306f <code>PaymentGateway</code> \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u306b\u306e\u307f\u4f9d\u5b58\u3057\u3001Stripe \u3068 PayPal \u3092\u7c21\u5358\u306b\u5207\u308a\u66ff\u3048\u3089\u308c\u307e\u3059\u3002</p>"},{"location":"scala/14-abstract-server-pattern/#12","title":"12. \u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1","text":"<pre><code>object FunctionalAbstractServer:\n  /**\n   * \u95a2\u6570\u578b Switchable - \u72b6\u614b\u5909\u63db\u95a2\u6570\u306e\u30ec\u30b3\u30fc\u30c9\n   */\n  case class SwitchableFn[A](\n    turnOn: A =&gt; A,\n    turnOff: A =&gt; A,\n    isOn: A =&gt; Boolean\n  ):\n    def toggle(device: A): A =\n      if isOn(device) then turnOff(device) else turnOn(device)\n\n  case class SimpleDevice(on: Boolean = false)\n\n  val simpleDeviceSwitchable: SwitchableFn[SimpleDevice] = SwitchableFn(\n    turnOn = _.copy(on = true),\n    turnOff = _.copy(on = false),\n    isOn = _.on\n  )\n\n  trait FunctionalSwitch[A]:\n    def engage(device: A): A\n    def disengage(device: A): A\n    def toggle(device: A): A\n    def status(device: A): String\n\n  def createSwitch[A](switchable: SwitchableFn[A]): FunctionalSwitch[A] =\n    new FunctionalSwitch[A]:\n      def engage(device: A): A = switchable.turnOn(device)\n      def disengage(device: A): A = switchable.turnOff(device)\n      def toggle(device: A): A = switchable.toggle(device)\n      def status(device: A): String = if switchable.isOn(device) then \"on\" else \"off\"\n</code></pre> <p>\u95a2\u6570\u306e\u30ec\u30b3\u30fc\u30c9\u3068\u3057\u3066\u62bd\u8c61\u5316\u3092\u8868\u73fe\u3059\u308b\u3053\u3068\u3067\u3001\u3088\u308a\u67d4\u8edf\u306a\u5408\u6210\u304c\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"scala/14-abstract-server-pattern/#13","title":"13. \u30d1\u30bf\u30fc\u30f3\u306e\u5229\u70b9","text":"<ol> <li>\u758e\u7d50\u5408: \u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306f\u5177\u4f53\u7684\u306a\u5b9f\u88c5\u3092\u77e5\u3089\u306a\u3044</li> <li>\u30c6\u30b9\u30c8\u5bb9\u6613\u6027: \u30e2\u30c3\u30af/\u30b9\u30bf\u30d6\u3092\u7c21\u5358\u306b\u6ce8\u5165\u53ef\u80fd</li> <li>\u67d4\u8edf\u6027: \u5b9f\u88c5\u306e\u4ea4\u63db\u304c\u5bb9\u6613</li> <li>\u4f9d\u5b58\u95a2\u4fc2\u9006\u8ee2: \u9ad8\u30ec\u30d9\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u4f4e\u30ec\u30d9\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u4f9d\u5b58\u3057\u306a\u3044</li> </ol>"},{"location":"scala/14-abstract-server-pattern/#14-clojure","title":"14. Clojure \u3068\u306e\u6bd4\u8f03","text":"\u6982\u5ff5 Clojure Scala Abstract Server <code>defprotocol</code> <code>trait</code> / \u578b\u30af\u30e9\u30b9 Concrete Server <code>defrecord</code> + \u30d7\u30ed\u30c8\u30b3\u30eb\u5b9f\u88c5 <code>class</code> / <code>given</code> \u30a4\u30f3\u30b9\u30bf\u30f3\u30b9 \u72b6\u614b\u7ba1\u7406 \u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u30ec\u30b3\u30fc\u30c9 \u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb <code>case class</code> \u4f9d\u5b58\u6027\u6ce8\u5165 \u95a2\u6570\u306e\u5f15\u6570 \u30b3\u30f3\u30b9\u30c8\u30e9\u30af\u30bf / Reader \u30d1\u30bf\u30fc\u30f3 \u591a\u614b\u6027 \u30d7\u30ed\u30c8\u30b3\u30eb\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1 \u578b\u30af\u30e9\u30b9 / \u30b5\u30d6\u30bf\u30a4\u30d4\u30f3\u30b0 <p>Scala \u3067\u306f\u578b\u30af\u30e9\u30b9\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u3067\u3001Clojure \u306e\u30d7\u30ed\u30c8\u30b3\u30eb\u3068\u540c\u69d8\u306e\u591a\u614b\u6027\u3092\u5b9f\u73fe\u3057\u3064\u3064\u3001\u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u306e\u578b\u5b89\u5168\u6027\u3092\u5f97\u3089\u308c\u307e\u3059\u3002</p>"},{"location":"scala/14-abstract-server-pattern/#_4","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Abstract Server \u30d1\u30bf\u30fc\u30f3\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u578b\u30af\u30e9\u30b9\u306b\u3088\u308b\u62bd\u8c61\u5316: <code>Switchable</code>, <code>Repository</code></li> <li>trait \u306b\u3088\u308b\u5b9f\u88c5: <code>Light</code>, <code>Fan</code>, <code>Motor</code>, <code>MemoryRepository</code></li> <li>\u30af\u30e9\u30a4\u30a2\u30f3\u30c8\u306e\u72ec\u7acb\u6027: <code>Switch</code>, <code>UserService</code></li> <li>\u4f9d\u5b58\u95a2\u4fc2\u9006\u8ee2: \u9ad8\u30ec\u30d9\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u62bd\u8c61\u306b\u4f9d\u5b58</li> </ol> <p>Abstract Server \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30e2\u30b8\u30e5\u30fc\u30eb\u9593\u306e\u758e\u7d50\u5408\u3092\u5b9f\u73fe\u3057\u3001\u30c6\u30b9\u30c8\u5bb9\u6613\u6027\u3068\u67d4\u8edf\u6027\u3092\u5411\u4e0a\u3055\u305b\u307e\u3059\u3002</p>"},{"location":"scala/14-abstract-server-pattern/#_5","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/scala/part3/src/main/scala/AbstractServerPattern.scala</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/scala/part3/src/test/scala/AbstractServerPatternSpec.scala</code></li> </ul>"},{"location":"scala/15-gossiping-bus-drivers/","title":"\u7b2c15\u7ae0: \u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b","text":""},{"location":"scala/15-gossiping-bus-drivers/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u300c\u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b\u300d\u3068\u3044\u3046\u554f\u984c\u3092\u901a\u3058\u3066\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306e\u5b9f\u8df5\u7684\u306a\u30a2\u30d7\u30ed\u30fc\u30c1\u3092\u5b66\u3073\u307e\u3059\u3002\u3053\u306e\u554f\u984c\u306f\u3001\u30d0\u30b9\u904b\u8ee2\u624b\u304c\u505c\u7559\u6240\u3067\u51fa\u4f1a\u3063\u305f\u3068\u304d\u306b\u5642\u3092\u5171\u6709\u3059\u308b\u3068\u3044\u3046\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3067\u3059\u3002</p> <p>\u3053\u306e\u554f\u984c\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u306e\u6982\u5ff5\u3092\u5b66\u3073\u307e\u3059\uff1a</p> <ul> <li>\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u306a\u30c7\u30fc\u30bf\u30e2\u30c7\u30eb\u8a2d\u8a08</li> <li>\u5faa\u74b0\u30c7\u30fc\u30bf\uff08\u30eb\u30fc\u30c8\uff09\u306e\u8868\u73fe</li> <li>\u96c6\u5408\u6f14\u7b97\u306b\u3088\u308b\u72b6\u614b\u306e\u4f1d\u64ad</li> <li>\u518d\u5e30\u7684\u306a\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30d7</li> </ul>"},{"location":"scala/15-gossiping-bus-drivers/#1","title":"1. \u554f\u984c\u306e\u8aac\u660e","text":"<p>\u8907\u6570\u306e\u30d0\u30b9\u904b\u8ee2\u624b\u304c\u305d\u308c\u305e\u308c\u306e\u30eb\u30fc\u30c8\u3092\u5de1\u56de\u3057\u3066\u3044\u307e\u3059\u3002\u5404\u904b\u8ee2\u624b\u306f\u6700\u521d\u306b1\u3064\u4ee5\u4e0a\u306e\u5642\u3092\u77e5\u3063\u3066\u3044\u307e\u3059\u3002\u540c\u3058\u505c\u7559\u6240\u306b\u8907\u6570\u306e\u904b\u8ee2\u624b\u304c\u3044\u308b\u3068\u3001\u5f7c\u3089\u306f\u77e5\u3063\u3066\u3044\u308b\u5642\u3092\u3059\u3079\u3066\u5171\u6709\u3057\u307e\u3059\u3002</p> <p>\u30b4\u30fc\u30eb: \u5168\u3066\u306e\u904b\u8ee2\u624b\u304c\u5168\u3066\u306e\u5642\u3092\u77e5\u308b\u307e\u3067\u306b\u4f55\u5206\u304b\u304b\u308b\u304b\uff1f</p> <p></p>"},{"location":"scala/15-gossiping-bus-drivers/#2","title":"2. \u30c7\u30fc\u30bf\u30e2\u30c7\u30eb","text":""},{"location":"scala/15-gossiping-bus-drivers/#driver","title":"Driver \u30b1\u30fc\u30b9\u30af\u30e9\u30b9","text":"<pre><code>type Rumor = String\ntype Stop = Int\n\ncase class Driver(\n  name: String,\n  route: Vector[Stop],\n  position: Int,\n  rumors: Set[Rumor]\n):\n  /**\n   * \u73fe\u5728\u306e\u505c\u7559\u6240\u3092\u53d6\u5f97\uff08\u5faa\u74b0\uff09\n   */\n  def currentStop: Stop = route(position % route.length)\n\n  /**\n   * \u6b21\u306e\u505c\u7559\u6240\u306b\u79fb\u52d5\n   */\n  def move: Driver = copy(position = position + 1)\n\n  /**\n   * \u5642\u3092\u8ffd\u52a0\n   */\n  def addRumors(newRumors: Set[Rumor]): Driver = \n    copy(rumors = rumors ++ newRumors)\n\nobject Driver:\n  def apply(name: String, route: Seq[Stop], rumors: Set[Rumor]): Driver =\n    Driver(name, route.toVector, 0, rumors)\n\n  def withAutoRumor(name: String, route: Seq[Stop]): Driver =\n    Driver(name, route.toVector, 0, Set(s\"rumor-$name\"))\n</code></pre> <p>\u30dd\u30a4\u30f3\u30c8\uff1a - <code>position % route.length</code> \u3067\u5faa\u74b0\u30eb\u30fc\u30c8\u3092\u5b9f\u73fe - \u5642\u306f <code>Set</code> \u3067\u7ba1\u7406\u3057\u3001\u91cd\u8907\u3092\u81ea\u52d5\u6392\u9664 - \u3059\u3079\u3066\u306e\u72b6\u614b\u5909\u66f4\u306f\u65b0\u3057\u3044\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8fd4\u3059\uff08\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\uff09</p>"},{"location":"scala/15-gossiping-bus-drivers/#world","title":"World \u30b1\u30fc\u30b9\u30af\u30e9\u30b9","text":"<pre><code>case class World(drivers: Vector[Driver], time: Int = 0):\n\n  /**\n   * \u5168\u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u79fb\u52d5\n   */\n  def moveDrivers: World = copy(drivers = drivers.map(_.move))\n\n  /**\n   * \u5404\u505c\u7559\u6240\u306b\u3044\u308b\u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u30b0\u30eb\u30fc\u30d7\u5316\n   */\n  def driversByStop: Map[Stop, Vector[Driver]] =\n    drivers.groupBy(_.currentStop)\n\n  /**\n   * \u540c\u3058\u505c\u7559\u6240\u306b\u3044\u308b\u30c9\u30e9\u30a4\u30d0\u30fc\u9593\u3067\u5642\u3092\u5171\u6709\n   */\n  def spreadRumors: World =\n    val newDrivers = driversByStop.values.flatMap { driversAtStop =&gt;\n      val allRumors = driversAtStop.flatMap(_.rumors).toSet\n      driversAtStop.map(_.addRumors(allRumors))\n    }.toVector\n    copy(drivers = drivers.map(d =&gt; newDrivers.find(_.name == d.name).getOrElse(d)))\n\n  /**\n   * 1\u30b9\u30c6\u30c3\u30d7\u5b9f\u884c\uff08\u79fb\u52d5\u2192\u5642\u306e\u4f1d\u64ad\uff09\n   */\n  def step: World =\n    this.moveDrivers.spreadRumors.copy(time = time + 1)\n\n  /**\n   * \u5168\u30c9\u30e9\u30a4\u30d0\u30fc\u304c\u540c\u3058\u5642\u3092\u6301\u3063\u3066\u3044\u308b\u304b\u78ba\u8a8d\n   */\n  def allRumorsShared: Boolean =\n    if drivers.isEmpty then true\n    else drivers.map(_.rumors).distinct.length == 1\n</code></pre>"},{"location":"scala/15-gossiping-bus-drivers/#3","title":"3. \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3","text":""},{"location":"scala/15-gossiping-bus-drivers/#_2","title":"\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u7d50\u679c\u306e\u578b","text":"<pre><code>sealed trait SimulationResult\ncase class Completed(minutes: Int) extends SimulationResult\ncase object Never extends SimulationResult\n</code></pre>"},{"location":"scala/15-gossiping-bus-drivers/#_3","title":"\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u5b9f\u884c","text":"<pre><code>def simulate(world: World, maxMinutes: Int = 480): SimulationResult =\n  @annotation.tailrec\n  def loop(current: World): SimulationResult =\n    if current.time &gt; maxMinutes then Never\n    else if current.allRumorsShared then Completed(current.time)\n    else loop(current.step)\n\n  if world.drivers.length &lt;= 1 then Completed(0)\n  else if world.allRumorsShared then Completed(0)\n  else loop(world.step)\n</code></pre>"},{"location":"scala/15-gossiping-bus-drivers/#_4","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>// 3\u4eba\u306e\u30c9\u30e9\u30a4\u30d0\u30fc\u3092\u4f5c\u6210\nval world = World(\n  Driver(\"D1\", Seq(3, 1, 2, 3), Set(\"rumor-a\")),\n  Driver(\"D2\", Seq(3, 2, 3, 1), Set(\"rumor-b\")),\n  Driver(\"D3\", Seq(4, 2, 3, 4, 5), Set(\"rumor-c\"))\n)\n\n// \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u5b9f\u884c\nsimulate(world) // =&gt; Completed(n) - n\u5206\u3067\u5168\u5642\u304c\u5171\u6709\u3055\u308c\u308b\n\n// \u7d76\u5bfe\u306b\u51fa\u4f1a\u308f\u306a\u3044\u30eb\u30fc\u30c8\u306e\u5834\u5408\nval neverMeet = World(\n  Driver(\"D1\", Seq(1), Set(\"rumor-a\")),\n  Driver(\"D2\", Seq(2), Set(\"rumor-b\"))\n)\n\nsimulate(neverMeet, maxMinutes = 10) // =&gt; Never\n</code></pre>"},{"location":"scala/15-gossiping-bus-drivers/#4","title":"4. \u5c65\u6b74\u3068\u7d71\u8a08\u60c5\u5831","text":""},{"location":"scala/15-gossiping-bus-drivers/#_5","title":"\u5c65\u6b74\u4ed8\u304d\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3","text":"<pre><code>def simulateWithHistory(world: World, maxMinutes: Int = 480): (SimulationResult, List[World]) =\n  @annotation.tailrec\n  def loop(current: World, history: List[World]): (SimulationResult, List[World]) =\n    if current.time &gt; maxMinutes then (Never, history.reverse)\n    else if current.allRumorsShared then (Completed(current.time), (current :: history).reverse)\n    else loop(current.step, current :: history)\n\n  if world.drivers.length &lt;= 1 then (Completed(0), List(world))\n  else loop(world.step, List(world))\n</code></pre>"},{"location":"scala/15-gossiping-bus-drivers/#_6","title":"\u7d71\u8a08\u60c5\u5831","text":"<pre><code>case class SimulationStats(\n  totalMinutes: Int,\n  totalMeetings: Int,\n  meetingsByStop: Map[Stop, Int],\n  rumorSpreadTimeline: List[(Int, Int)]  // (\u6642\u9593, \u5642\u306e\u5171\u6709\u6570)\n)\n\ndef simulateWithStats(world: World, maxMinutes: Int = 480): (SimulationResult, SimulationStats)\n</code></pre>"},{"location":"scala/15-gossiping-bus-drivers/#5","title":"5. \u30d3\u30eb\u30c0\u30fc\u30d1\u30bf\u30fc\u30f3","text":"<pre><code>class SimulationBuilder:\n  private var drivers = Vector.empty[Driver]\n  private var maxMinutes = 480\n\n  def addDriver(name: String, route: Seq[Stop], rumors: Set[Rumor]): SimulationBuilder =\n    drivers = drivers :+ Driver(name, route, rumors)\n    this\n\n  def addDriverWithAutoRumor(name: String, route: Seq[Stop]): SimulationBuilder =\n    drivers = drivers :+ Driver.withAutoRumor(name, route)\n    this\n\n  def withMaxMinutes(minutes: Int): SimulationBuilder =\n    maxMinutes = minutes\n    this\n\n  def run: SimulationResult = simulate(World(drivers), maxMinutes)\n  def runWithHistory: (SimulationResult, List[World]) = simulateWithHistory(World(drivers), maxMinutes)\n  def runWithStats: (SimulationResult, SimulationStats) = simulateWithStats(World(drivers), maxMinutes)\n\n// \u4f7f\u7528\u4f8b\nval result = builder\n  .addDriverWithAutoRumor(\"D1\", Seq(1, 2, 3))\n  .addDriverWithAutoRumor(\"D2\", Seq(3, 2, 1))\n  .withMaxMinutes(100)\n  .run\n</code></pre>"},{"location":"scala/15-gossiping-bus-drivers/#6-dsl","title":"6. \u30eb\u30fc\u30c8\u5b9a\u7fa9 DSL","text":"<pre><code>object RouteDSL:\n  def range(start: Int, end: Int): Seq[Stop] = start to end\n  def reverse(route: Seq[Stop]): Seq[Stop] = route.reverse\n  def roundTrip(route: Seq[Stop]): Seq[Stop] =\n    if route.length &lt;= 1 then route\n    else route ++ route.reverse.tail\n  def concat(segments: Seq[Stop]*): Seq[Stop] = segments.flatten\n\n// \u4f7f\u7528\u4f8b\nimport RouteDSL.*\nrange(1, 5)           // Seq(1, 2, 3, 4, 5)\nroundTrip(Seq(1,2,3)) // Seq(1, 2, 3, 2, 1)\n</code></pre>"},{"location":"scala/15-gossiping-bus-drivers/#7","title":"7. \u95a2\u6570\u578b\u30b3\u30f3\u30d3\u30cd\u30fc\u30bf","text":"<pre><code>type WorldTransform = World =&gt; World\n\ndef compose(transforms: WorldTransform*): WorldTransform =\n  transforms.reduce(_ andThen _)\n\ndef when(condition: World =&gt; Boolean)(transform: WorldTransform): WorldTransform =\n  world =&gt; if condition(world) then transform(world) else world\n\ndef repeat(n: Int)(transform: WorldTransform): WorldTransform =\n  world =&gt; (1 to n).foldLeft(world)((w, _) =&gt; transform(w))\n\ndef until(condition: World =&gt; Boolean)(transform: WorldTransform): World =&gt; World =\n  world =&gt;\n    @annotation.tailrec\n    def loop(current: World): World =\n      if condition(current) then current\n      else loop(transform(current))\n    loop(world)\n\n// \u4f7f\u7528\u4f8b\nval doubleMove = compose(_.moveDrivers, _.moveDrivers)\nval moveIfAt1 = when(_.drivers.head.currentStop == 1)(_.moveDrivers)\nval moveThrice = repeat(3)(_.moveDrivers)\nval untilShared = until(_.allRumorsShared)(_.step)\n</code></pre>"},{"location":"scala/15-gossiping-bus-drivers/#8","title":"8. \u9045\u5ef6\u4ed8\u304d\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3","text":"<p>\u5b9f\u969b\u306e\u30d0\u30b9\u904b\u8ee2\u3067\u306f\u3001\u5404\u505c\u7559\u6240\u3067\u4e57\u5ba2\u306e\u4e57\u964d\u306b\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3059\u3002</p> <pre><code>case class DelayedDriver(\n  name: String,\n  route: Vector[Stop],\n  position: Int,\n  rumors: Set[Rumor],\n  delay: Int = 0,\n  delayPattern: Vector[Int] = Vector.empty\n):\n  def currentStop: Stop = route(position % route.length)\n\n  def move: DelayedDriver =\n    if delay &gt; 0 then\n      copy(delay = delay - 1)\n    else\n      val nextPos = position + 1\n      val nextDelay = if delayPattern.nonEmpty then\n        delayPattern(nextPos % delayPattern.length)\n      else 0\n      copy(position = nextPos, delay = nextDelay)\n</code></pre>"},{"location":"scala/15-gossiping-bus-drivers/#9","title":"9. \u30d8\u30eb\u30d1\u30fc\u95a2\u6570","text":"<pre><code>/**\n * \u30c9\u30e9\u30a4\u30d0\u30fc\u304c\u7279\u5b9a\u306e\u6642\u9593\u5f8c\u306b\u3069\u306e\u505c\u7559\u6240\u306b\u3044\u308b\u304b\u3092\u8a08\u7b97\n */\ndef stopAtTime(driver: Driver, time: Int): Stop =\n  driver.route((driver.position + time) % driver.route.length)\n\n/**\n * 2\u4eba\u306e\u30c9\u30e9\u30a4\u30d0\u30fc\u304c\u51fa\u4f1a\u3046\u6700\u521d\u306e\u6642\u9593\u3092\u8a08\u7b97\n */\ndef firstMeetingTime(d1: Driver, d2: Driver, maxTime: Int = 480): Option[Int] =\n  (0 to maxTime).find { t =&gt;\n    stopAtTime(d1, t) == stopAtTime(d2, t)\n  }\n\n/**\n * \u30eb\u30fc\u30c8\u306e\u6700\u5c0f\u516c\u500d\u6570\u3092\u8a08\u7b97\n */\ndef routeLcm(routes: Seq[Vector[Stop]]): Int =\n  def gcd(a: Int, b: Int): Int = if b == 0 then a else gcd(b, a % b)\n  def lcm(a: Int, b: Int): Int = a * b / gcd(a, b)\n  routes.map(_.length).reduce(lcm)\n</code></pre>"},{"location":"scala/15-gossiping-bus-drivers/#10","title":"10. \u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1\u306e\u7279\u5fb4","text":""},{"location":"scala/15-gossiping-bus-drivers/#_7","title":"\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020","text":"<p>\u3059\u3079\u3066\u306e\u72b6\u614b\u5909\u66f4\u306f\u65b0\u3057\u3044\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u8fd4\u3057\u307e\u3059\u3002</p> <pre><code>val original = Driver(\"Test\", Seq(1, 2, 3), Set(\"a\"))\nval moved = original.move\n\noriginal.currentStop // 1 (\u5909\u66f4\u306a\u3057)\nmoved.currentStop    // 2\n</code></pre>"},{"location":"scala/15-gossiping-bus-drivers/#_8","title":"\u7d14\u7c8b\u95a2\u6570","text":"<p>\u3059\u3079\u3066\u306e\u95a2\u6570\u306f\u526f\u4f5c\u7528\u304c\u306a\u304f\u3001\u540c\u3058\u5165\u529b\u306b\u5bfe\u3057\u3066\u5e38\u306b\u540c\u3058\u51fa\u529b\u3092\u8fd4\u3057\u307e\u3059\u3002</p>"},{"location":"scala/15-gossiping-bus-drivers/#_9","title":"\u96c6\u5408\u6f14\u7b97","text":"<p>\u5642\u306e\u4f1d\u64ad\u306f\u96c6\u5408\u306e\u548c\u96c6\u5408\u3068\u3057\u3066\u8868\u73fe\u3055\u308c\u307e\u3059\u3002</p> <pre><code>val rumors1 = Set(\"a\", \"b\")\nval rumors2 = Set(\"c\")\nval merged = rumors1 ++ rumors2  // Set(\"a\", \"b\", \"c\")\n</code></pre>"},{"location":"scala/15-gossiping-bus-drivers/#11-clojure","title":"11. Clojure \u3068\u306e\u6bd4\u8f03","text":"\u6982\u5ff5 Clojure Scala \u5faa\u74b0\u30c7\u30fc\u30bf <code>cycle</code> (\u9045\u5ef6\u30b7\u30fc\u30b1\u30f3\u30b9) <code>position % route.length</code> \u96c6\u5408\u6f14\u7b97 <code>set/union</code> <code>++</code> \u30b0\u30eb\u30fc\u30d7\u5316 <code>group-by</code> <code>groupBy</code> \u672b\u5c3e\u518d\u5e30 <code>recur</code> <code>@annotation.tailrec</code> \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3 <code>-&gt;</code> \u30de\u30af\u30ed \u30e1\u30bd\u30c3\u30c9\u30c1\u30a7\u30fc\u30f3"},{"location":"scala/15-gossiping-bus-drivers/#12","title":"12. \u30d1\u30bf\u30fc\u30f3\u306e\u5fdc\u7528","text":"<p>\u3053\u306e\u30d1\u30bf\u30fc\u30f3\u306f\u4ee5\u4e0b\u306e\u3088\u3046\u306a\u5834\u9762\u3067\u5fdc\u7528\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u4f1d\u64ad: \u30a6\u30a4\u30eb\u30b9\u3084\u60c5\u5831\u306e\u62e1\u6563\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3</li> <li>\u30b0\u30e9\u30d5\u63a2\u7d22: \u5de1\u56de\u30bb\u30fc\u30eb\u30b9\u30de\u30f3\u554f\u984c\u306e\u5909\u5f62</li> <li>\u72b6\u614b\u540c\u671f: \u5206\u6563\u30b7\u30b9\u30c6\u30e0\u3067\u306e\u72b6\u614b\u5171\u6709</li> <li>\u30b2\u30fc\u30e0AI: NPC\u306e\u79fb\u52d5\u3068\u76f8\u4e92\u4f5c\u7528</li> </ul>"},{"location":"scala/15-gossiping-bus-drivers/#_10","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u30b4\u30b7\u30c3\u30d7\u597d\u304d\u306a\u30d0\u30b9\u306e\u904b\u8ee2\u624b\u554f\u984c\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u3092\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u30c7\u30fc\u30bf\u30e2\u30c7\u30eb: <code>case class</code> \u306b\u3088\u308b\u30c9\u30e9\u30a4\u30d0\u30fc\u3068\u30ef\u30fc\u30eb\u30c9\u306e\u8868\u73fe</li> <li>\u5faa\u74b0\u30eb\u30fc\u30c8: \u5270\u4f59\u6f14\u7b97\u306b\u3088\u308b\u7121\u9650\u5faa\u74b0\u306e\u5b9f\u73fe</li> <li>\u96c6\u5408\u6f14\u7b97: \u5642\u306e\u4f1d\u64ad\u3092\u96c6\u5408\u306e\u548c\u96c6\u5408\u3067\u8868\u73fe</li> <li>\u672b\u5c3e\u518d\u5e30: \u30b9\u30bf\u30c3\u30af\u30aa\u30fc\u30d0\u30fc\u30d5\u30ed\u30fc\u3092\u9632\u3050\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u30eb\u30fc\u30d7</li> <li>\u95a2\u6570\u578b\u30b3\u30f3\u30d3\u30cd\u30fc\u30bf: \u5909\u63db\u306e\u5408\u6210\u3068\u6761\u4ef6\u4ed8\u304d\u9069\u7528</li> </ol>"},{"location":"scala/15-gossiping-bus-drivers/#_11","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/scala/part6/src/main/scala/GossipingBusDrivers.scala</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/scala/part6/src/test/scala/GossipingBusDriversSpec.scala</code></li> </ul>"},{"location":"scala/16-payroll-system/","title":"\u7b2c16\u7ae0: \u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0","text":""},{"location":"scala/16-payroll-system/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0\u3092\u984c\u6750\u306b\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u304a\u3051\u308b\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30ea\u30f3\u30b0\u3068\u591a\u614b\u6027\u306e\u5b9f\u73fe\u3092\u5b66\u3073\u307e\u3059\u3002</p> <p>\u3053\u306e\u554f\u984c\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u306e\u6982\u5ff5\u3092\u5b66\u3073\u307e\u3059\uff1a</p> <ul> <li>Sealed trait \u3068 case class \u306b\u3088\u308b\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30ea\u30f3\u30b0</li> <li>\u578b\u30af\u30e9\u30b9\u306b\u3088\u308b\u7d66\u4e0e\u30bf\u30a4\u30d7\u5225\u306e\u8a08\u7b97</li> <li>\u652f\u6255\u3044\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u306e\u30e2\u30c7\u30ea\u30f3\u30b0</li> <li>\u30a4\u30d9\u30f3\u30c8\u30bd\u30fc\u30b7\u30f3\u30b0\u98a8\u306e\u5c65\u6b74\u7ba1\u7406</li> </ul>"},{"location":"scala/16-payroll-system/#1","title":"1. \u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30eb","text":""},{"location":"scala/16-payroll-system/#_2","title":"\u7d66\u4e0e\u30bf\u30a4\u30d7","text":"<p>\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0\u3067\u306f\u3001\u4ee5\u4e0b\u306e3\u7a2e\u985e\u306e\u7d66\u4e0e\u30bf\u30a4\u30d7\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u307e\u3059\uff1a</p> <ul> <li>\u6708\u7d66\u5236\uff08Salaried\uff09: \u56fa\u5b9a\u6708\u7d66</li> <li>\u6642\u7d66\u5236\uff08Hourly\uff09: \u52b4\u50cd\u6642\u9593\u306b\u57fa\u3065\u304f\u7d66\u4e0e</li> <li>\u6b69\u5408\u5236\uff08Commissioned\uff09: \u57fa\u672c\u7d66 + \u58f2\u4e0a\u306b\u5fdc\u3058\u305f\u30b3\u30df\u30c3\u30b7\u30e7\u30f3</li> </ul> <pre><code>sealed trait PayClass:\n  def payType: String\n\ncase class Salaried(salary: Money) extends PayClass:\n  def payType: String = \"salaried\"\n\ncase class Hourly(hourlyRate: Money) extends PayClass:\n  def payType: String = \"hourly\"\n\ncase class Commissioned(basePay: Money, commissionRate: Rate) extends PayClass:\n  def payType: String = \"commissioned\"\n</code></pre>"},{"location":"scala/16-payroll-system/#_3","title":"\u652f\u6255\u3044\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb","text":"<pre><code>enum Schedule:\n  case Monthly   // \u6708\u6b21\uff08\u6708\u672b\uff09\n  case Weekly    // \u9031\u6b21\uff08\u6bce\u9031\u91d1\u66dc\u65e5\uff09\n  case Biweekly  // \u9694\u9031\uff08\u9694\u9031\u91d1\u66dc\u65e5\uff09\n</code></pre>"},{"location":"scala/16-payroll-system/#_4","title":"\u652f\u6255\u3044\u65b9\u6cd5","text":"<pre><code>enum PaymentMethod:\n  case Hold                                   // \u4fdd\u7559\n  case DirectDeposit(accountNumber: String)  // \u53e3\u5ea7\u632f\u8fbc\n  case Mail(address: String)                 // \u5c0f\u5207\u624b\u90f5\u9001\n</code></pre>"},{"location":"scala/16-payroll-system/#2","title":"2. \u5f93\u696d\u54e1\u30e2\u30c7\u30eb","text":"<pre><code>case class Employee(\n  id: EmployeeId,\n  name: String,\n  payClass: PayClass,\n  schedule: Schedule,\n  paymentMethod: PaymentMethod,\n  address: Option[String] = None\n)\n\nobject Employee:\n  def salaried(id: EmployeeId, name: String, salary: Money): Employee =\n    Employee(id, name, Salaried(salary), Schedule.Monthly, PaymentMethod.Hold)\n\n  def hourly(id: EmployeeId, name: String, hourlyRate: Money): Employee =\n    Employee(id, name, Hourly(hourlyRate), Schedule.Weekly, PaymentMethod.Hold)\n\n  def commissioned(id: EmployeeId, name: String, basePay: Money, commissionRate: Rate): Employee =\n    Employee(id, name, Commissioned(basePay, commissionRate), Schedule.Biweekly, PaymentMethod.Hold)\n</code></pre>"},{"location":"scala/16-payroll-system/#3","title":"3. \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\uff08\u30bf\u30a4\u30e0\u30ab\u30fc\u30c9\u3001\u58f2\u4e0a\uff09","text":"<pre><code>case class TimeCard(employeeId: EmployeeId, date: String, hours: Hours)\ncase class SalesReceipt(employeeId: EmployeeId, date: String, amount: Money)\n\ncase class PayrollContext(\n  timeCards: Map[EmployeeId, List[TimeCard]] = Map.empty.withDefaultValue(Nil),\n  salesReceipts: Map[EmployeeId, List[SalesReceipt]] = Map.empty.withDefaultValue(Nil)\n):\n  def addTimeCard(tc: TimeCard): PayrollContext = ...\n  def addSalesReceipt(sr: SalesReceipt): PayrollContext = ...\n</code></pre>"},{"location":"scala/16-payroll-system/#_5","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>val ctx = PayrollContext.empty\n  .addTimeCard(TimeCard(\"E002\", \"2024-01-15\", 8))\n  .addTimeCard(TimeCard(\"E002\", \"2024-01-16\", 10))\n  .addSalesReceipt(SalesReceipt(\"E003\", \"2024-01-15\", BigDecimal(100000)))\n</code></pre>"},{"location":"scala/16-payroll-system/#4","title":"4. \u7d66\u4e0e\u8a08\u7b97","text":""},{"location":"scala/16-payroll-system/#_6","title":"\u578b\u30af\u30e9\u30b9\u30a2\u30d7\u30ed\u30fc\u30c1","text":"<pre><code>trait PayCalculator[P &lt;: PayClass]:\n  def calculate(payClass: P, context: PayrollContext, employeeId: EmployeeId): Money\n\ngiven PayCalculator[Salaried] with\n  def calculate(payClass: Salaried, context: PayrollContext, employeeId: EmployeeId): Money =\n    payClass.salary\n\ngiven PayCalculator[Hourly] with\n  def calculate(payClass: Hourly, context: PayrollContext, employeeId: EmployeeId): Money =\n    val timeCards = context.getTimeCards(employeeId)\n    val totalHours = timeCards.map(_.hours).sum\n    val regularHours = math.min(totalHours, 40.0)\n    val overtimeHours = math.max(0.0, totalHours - 40.0)\n    payClass.hourlyRate * BigDecimal(regularHours) +\n      payClass.hourlyRate * BigDecimal(overtimeHours) * BigDecimal(1.5)\n\ngiven PayCalculator[Commissioned] with\n  def calculate(payClass: Commissioned, context: PayrollContext, employeeId: EmployeeId): Money =\n    val salesReceipts = context.getSalesReceipts(employeeId)\n    val totalSales = salesReceipts.map(_.amount).sum\n    payClass.basePay + totalSales * BigDecimal(payClass.commissionRate)\n</code></pre>"},{"location":"scala/16-payroll-system/#_7","title":"\u8a08\u7b97\u4f8b","text":"<pre><code>// \u6708\u7d66\u5236: \u56fa\u5b9a\u7d66\u4e0e\nval salaried = Employee.salaried(\"E001\", \"\u7530\u4e2d\", BigDecimal(500000))\ncalculatePay(salaried, ctx) // =&gt; 500000\n\n// \u6642\u7d66\u5236: 40\u6642\u9593 * 1500 + 5\u6642\u9593 * 1500 * 1.5 = 67500\nval hourly = Employee.hourly(\"E002\", \"\u4f50\u85e4\", BigDecimal(1500))\nval ctx = PayrollContext.empty.addTimeCard(TimeCard(\"E002\", \"2024-01-15\", 45))\ncalculatePay(hourly, ctx) // =&gt; 67500\n\n// \u6b69\u5408\u5236: 200000 + 150000 * 0.1 = 215000\nval commissioned = Employee.commissioned(\"E003\", \"\u9234\u6728\", BigDecimal(200000), 0.1)\nval ctx = PayrollContext.empty\n  .addSalesReceipt(SalesReceipt(\"E003\", \"2024-01-15\", BigDecimal(150000)))\ncalculatePay(commissioned, ctx) // =&gt; 215000\n</code></pre>"},{"location":"scala/16-payroll-system/#5","title":"5. \u652f\u6255\u3044\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u5224\u5b9a","text":"<pre><code>case class PayDate(\n  year: Int,\n  month: Int,\n  day: Int,\n  dayOfWeek: DayOfWeek,\n  isLastDayOfMonth: Boolean,\n  isPayWeek: Boolean = true\n)\n\ndef isPayDay(employee: Employee, date: PayDate): Boolean =\n  employee.schedule match\n    case Schedule.Monthly =&gt; date.isLastDayOfMonth\n    case Schedule.Weekly =&gt; date.dayOfWeek == DayOfWeek.Friday\n    case Schedule.Biweekly =&gt; date.dayOfWeek == DayOfWeek.Friday &amp;&amp; date.isPayWeek\n</code></pre>"},{"location":"scala/16-payroll-system/#6","title":"6. \u652f\u6255\u3044\u51e6\u7406","text":"<pre><code>sealed trait PaymentResult:\n  def employeeId: EmployeeId\n  def amount: Money\n\ncase class HeldPayment(employeeId: EmployeeId, amount: Money) extends PaymentResult\ncase class DirectDepositPayment(employeeId: EmployeeId, amount: Money, accountNumber: String) extends PaymentResult\ncase class MailedPayment(employeeId: EmployeeId, amount: Money, address: String) extends PaymentResult\n\ndef processPayment(employee: Employee, amount: Money): PaymentResult =\n  employee.paymentMethod match\n    case PaymentMethod.Hold =&gt;\n      HeldPayment(employee.id, amount)\n    case PaymentMethod.DirectDeposit(account) =&gt;\n      DirectDepositPayment(employee.id, amount, account)\n    case PaymentMethod.Mail(address) =&gt;\n      MailedPayment(employee.id, amount, address)\n</code></pre>"},{"location":"scala/16-payroll-system/#7","title":"7. \u7d66\u4e0e\u652f\u6255\u3044\u5b9f\u884c","text":"<pre><code>def runPayroll(employees: Seq[Employee], context: PayrollContext, date: PayDate): Seq[PaymentResult] =\n  employees\n    .filter(isPayDay(_, date))\n    .map { emp =&gt;\n      val pay = calculatePay(emp, context)\n      processPayment(emp, pay)\n    }\n</code></pre>"},{"location":"scala/16-payroll-system/#8","title":"8. \u7d66\u4e0e\u660e\u7d30\u3068\u63a7\u9664","text":""},{"location":"scala/16-payroll-system/#_8","title":"\u7d66\u4e0e\u660e\u7d30","text":"<pre><code>case class Payslip(\n  employeeId: EmployeeId,\n  employeeName: String,\n  payPeriod: String,\n  grossPay: Money,\n  deductions: Map[String, Money] = Map.empty,\n  netPay: Money\n):\n  def addDeduction(name: String, amount: Money): Payslip =\n    val newDeductions = deductions + (name -&gt; amount)\n    val newNetPay = grossPay - newDeductions.values.sum\n    copy(deductions = newDeductions, netPay = newNetPay)\n</code></pre>"},{"location":"scala/16-payroll-system/#_9","title":"\u63a7\u9664\u30bf\u30a4\u30d7","text":"<pre><code>sealed trait Deduction:\n  def name: String\n  def calculate(grossPay: Money): Money\n\ncase class FixedDeduction(name: String, amount: Money) extends Deduction:\n  def calculate(grossPay: Money): Money = amount\n\ncase class PercentageDeduction(name: String, rate: Rate) extends Deduction:\n  def calculate(grossPay: Money): Money = grossPay * BigDecimal(rate)\n</code></pre>"},{"location":"scala/16-payroll-system/#_10","title":"\u4f7f\u7528\u4f8b","text":"<pre><code>val deductions = Seq(\n  FixedDeduction(\"\u5065\u5eb7\u4fdd\u967a\", BigDecimal(10000)),\n  PercentageDeduction(\"\u6240\u5f97\u7a0e\", 0.1)\n)\nval payslip = Payslip.create(emp, \"2024-01\", BigDecimal(500000))\nval result = applyDeductions(payslip, deductions)\n// grossPay: 500000, deductions: {\u5065\u5eb7\u4fdd\u967a: 10000, \u6240\u5f97\u7a0e: 50000}, netPay: 440000\n</code></pre>"},{"location":"scala/16-payroll-system/#9","title":"9. \u7d66\u4e0e\u8a08\u7b97\u30b5\u30fc\u30d3\u30b9","text":"<pre><code>class PayrollService(\n  repository: EmployeeRepository,\n  deductions: Seq[Deduction] = Seq.empty\n):\n  def addEmployee(employee: Employee): Employee = ...\n  def removeEmployee(id: EmployeeId): Option[Employee] = ...\n  def getEmployee(id: EmployeeId): Option[Employee] = ...\n  def updateEmployee(id: EmployeeId, f: Employee =&gt; Employee): Option[Employee] = ...\n\n  def runPayroll(context: PayrollContext, date: PayDate, payPeriod: String): Seq[Payslip] =\n    val employees = repository.findAll\n    employees\n      .filter(isPayDay(_, date))\n      .map { emp =&gt;\n        val grossPay = calculatePay(emp, context)\n        val payslip = Payslip.create(emp, payPeriod, grossPay)\n        applyDeductions(payslip, deductions)\n      }\n</code></pre>"},{"location":"scala/16-payroll-system/#10","title":"10. \u30a4\u30d9\u30f3\u30c8\u30bd\u30fc\u30b7\u30f3\u30b0","text":"<pre><code>sealed trait PayrollEvent:\n  def timestamp: Long\n  def employeeId: EmployeeId\n\ncase class EmployeeAdded(timestamp: Long, employeeId: EmployeeId, employee: Employee) extends PayrollEvent\ncase class EmployeeRemoved(timestamp: Long, employeeId: EmployeeId) extends PayrollEvent\ncase class TimeCardAdded(timestamp: Long, employeeId: EmployeeId, timeCard: TimeCard) extends PayrollEvent\ncase class PayrollRun(timestamp: Long, employeeId: EmployeeId, amount: Money) extends PayrollEvent\n\nclass EventStore:\n  private var events: List[PayrollEvent] = Nil\n  def append(event: PayrollEvent): Unit = events = event :: events\n  def getEvents: List[PayrollEvent] = events.reverse\n  def getEventsByEmployee(employeeId: EmployeeId): List[PayrollEvent] = ...\n</code></pre>"},{"location":"scala/16-payroll-system/#11-dsl","title":"11. DSL","text":"<pre><code>object PayrollDSL:\n  def employee(id: EmployeeId)(name: String): EmployeeBuilder =\n    EmployeeBuilder(id, name)\n\n  case class EmployeeBuilder(...):\n    def salaried(salary: Money): EmployeeBuilder = ...\n    def hourly(rate: Money): EmployeeBuilder = ...\n    def commissioned(basePay: Money, commissionRate: Rate): EmployeeBuilder = ...\n    def withDirectDeposit(account: String): EmployeeBuilder = ...\n    def withMailPayment(address: String): EmployeeBuilder = ...\n    def build: Employee = ...\n\n// \u4f7f\u7528\u4f8b\nimport PayrollDSL.*\nval emp = employee(\"E001\")(\"\u7530\u4e2d\u592a\u90ce\")\n  .salaried(BigDecimal(500000))\n  .withDirectDeposit(\"1234567890\")\n  .build\n</code></pre>"},{"location":"scala/16-payroll-system/#12-clojure","title":"12. Clojure \u3068\u306e\u6bd4\u8f03","text":"\u6982\u5ff5 Clojure Scala \u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30eb \u30de\u30c3\u30d7 + Spec case class + sealed trait \u591a\u614b\u6027 \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9 \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1 / \u578b\u30af\u30e9\u30b9 \u7d66\u4e0e\u8a08\u7b97 <code>defmulti</code>/<code>defmethod</code> <code>given</code>/<code>summon</code> \u652f\u6255\u3044\u65b9\u6cd5 \u30ad\u30fc\u30ef\u30fc\u30c9 enum \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8 \u30de\u30c3\u30d7 case class"},{"location":"scala/16-payroll-system/#13","title":"13. \u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1\u306e\u5229\u70b9","text":"<ol> <li>\u30c6\u30b9\u30c8\u5bb9\u6613\u6027: \u7d14\u7c8b\u95a2\u6570\u306a\u306e\u3067\u30c6\u30b9\u30c8\u304c\u7c21\u5358</li> <li>\u62e1\u5f35\u5bb9\u6613\u6027: \u65b0\u3057\u3044\u7d66\u4e0e\u30bf\u30a4\u30d7\u306f\u65b0\u3057\u3044\u578b\u30af\u30e9\u30b9\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8ffd\u52a0\u3059\u308b\u3060\u3051</li> <li>\u95a2\u5fc3\u306e\u5206\u96e2: \u7d66\u4e0e\u8a08\u7b97\u3001\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u5224\u5b9a\u3001\u652f\u6255\u3044\u51e6\u7406\u304c\u5206\u96e2</li> <li>\u578b\u5b89\u5168\u6027: \u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u306b\u591a\u304f\u306e\u30a8\u30e9\u30fc\u3092\u691c\u51fa</li> </ol>"},{"location":"scala/16-payroll-system/#_11","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u7d66\u4e0e\u8a08\u7b97\u30b7\u30b9\u30c6\u30e0\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u3092\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30ea\u30f3\u30b0: sealed trait \u3068 case class \u306b\u3088\u308b\u8868\u73fe</li> <li>\u578b\u30af\u30e9\u30b9: \u7d66\u4e0e\u30bf\u30a4\u30d7\u306b\u3088\u308b\u591a\u614b\u7684\u306a\u8a08\u7b97</li> <li>\u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u8a2d\u8a08: \u3059\u3079\u3066\u306e\u64cd\u4f5c\u304c\u65b0\u3057\u3044\u30a4\u30f3\u30b9\u30bf\u30f3\u30b9\u3092\u8fd4\u3059</li> <li>DSL: \u6d41\u66a2\u306aAPI\u306b\u3088\u308b\u5f93\u696d\u54e1\u5b9a\u7fa9</li> </ol>"},{"location":"scala/16-payroll-system/#_12","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/scala/part6/src/main/scala/PayrollSystem.scala</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/scala/part6/src/test/scala/PayrollSystemSpec.scala</code></li> </ul>"},{"location":"scala/17-video-rental-system/","title":"\u7b2c17\u7ae0: \u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0","text":""},{"location":"scala/17-video-rental-system/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Martin Fowler \u306e\u300c\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u300d\u3067\u6709\u540d\u306a\u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0\u3092\u984c\u6750\u306b\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u3088\u308b\u6599\u91d1\u8a08\u7b97\u30ed\u30b8\u30c3\u30af\u306e\u8a2d\u8a08\u3092\u5b66\u3073\u307e\u3059\u3002</p> <p>\u3053\u306e\u554f\u984c\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u306e\u6982\u5ff5\u3092\u5b66\u3073\u307e\u3059\uff1a</p> <ul> <li>\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u306b\u3088\u308b\u6599\u91d1\u8a08\u7b97</li> <li>\u660e\u7d30\u66f8\u30d5\u30a9\u30fc\u30de\u30c3\u30bf\u30fc\u306e\u5b9f\u88c5</li> <li>\u30c7\u30fc\u30bf\u3068\u51e6\u7406\u306e\u5206\u96e2</li> <li>DSL \u306b\u3088\u308b\u6d41\u66a2\u306a API</li> </ul>"},{"location":"scala/17-video-rental-system/#1","title":"1. \u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30eb","text":""},{"location":"scala/17-video-rental-system/#_2","title":"\u6620\u753b\u30ab\u30c6\u30b4\u30ea","text":"<p>\u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0\u3067\u306f\u3001\u4ee5\u4e0b\u306e3\u7a2e\u985e\u306e\u6620\u753b\u30ab\u30c6\u30b4\u30ea\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u307e\u3059\uff1a</p> <ul> <li>\u901a\u5e38\uff08Regular\uff09: 2\u65e5\u307e\u30672.0\u3001\u4ee5\u964d1\u65e5\u3054\u3068\u306b1.5\u8ffd\u52a0</li> <li>\u65b0\u4f5c\uff08New Release\uff09: 1\u65e5\u3054\u3068\u306b3.0</li> <li>\u5b50\u4f9b\u5411\u3051\uff08Children's\uff09: 3\u65e5\u307e\u30671.5\u3001\u4ee5\u964d1\u65e5\u3054\u3068\u306b1.5\u8ffd\u52a0</li> </ul> <pre><code>enum MovieCategory:\n  case Regular     // \u901a\u5e38\n  case NewRelease  // \u65b0\u4f5c\n  case Childrens   // \u5b50\u4f9b\u5411\u3051\n</code></pre>"},{"location":"scala/17-video-rental-system/#_3","title":"\u6620\u753b","text":"<pre><code>case class Movie(title: String, category: MovieCategory)\n\nobject Movie:\n  def regular(title: String): Movie = Movie(title, MovieCategory.Regular)\n  def newRelease(title: String): Movie = Movie(title, MovieCategory.NewRelease)\n  def childrens(title: String): Movie = Movie(title, MovieCategory.Childrens)\n</code></pre>"},{"location":"scala/17-video-rental-system/#_4","title":"\u30ec\u30f3\u30bf\u30eb\u3068\u9867\u5ba2","text":"<pre><code>case class Rental(movie: Movie, days: Days)\n\ncase class Customer(name: String, rentals: List[Rental] = Nil):\n  def addRental(rental: Rental): Customer = copy(rentals = rentals :+ rental)\n</code></pre>"},{"location":"scala/17-video-rental-system/#2","title":"2. \u6599\u91d1\u8a08\u7b97","text":""},{"location":"scala/17-video-rental-system/#_5","title":"\u6599\u91d1\u8a08\u7b97\u5668","text":"<pre><code>trait PriceCalculator:\n  def calculateAmount(days: Days): Money\n  def calculatePoints(days: Days): Points\n\nobject RegularPricing extends PriceCalculator:\n  def calculateAmount(days: Days): Money =\n    if days &gt; 2 then BigDecimal(2.0) + BigDecimal((days - 2) * 1.5)\n    else BigDecimal(2.0)\n  def calculatePoints(days: Days): Points = 1\n\nobject NewReleasePricing extends PriceCalculator:\n  def calculateAmount(days: Days): Money = BigDecimal(days * 3.0)\n  def calculatePoints(days: Days): Points = if days &gt; 1 then 2 else 1\n\nobject ChildrensPricing extends PriceCalculator:\n  def calculateAmount(days: Days): Money =\n    if days &gt; 3 then BigDecimal(1.5) + BigDecimal((days - 3) * 1.5)\n    else BigDecimal(1.5)\n  def calculatePoints(days: Days): Points = 1\n</code></pre>"},{"location":"scala/17-video-rental-system/#_6","title":"\u8a08\u7b97\u4f8b","text":"\u30ab\u30c6\u30b4\u30ea \u65e5\u6570 \u6599\u91d1\u8a08\u7b97 \u7d50\u679c \u901a\u5e38 2\u65e5 2.0 2.0 \u901a\u5e38 5\u65e5 2.0 + 3 * 1.5 6.5 \u65b0\u4f5c 3\u65e5 3 * 3.0 9.0 \u5b50\u4f9b\u5411\u3051 3\u65e5 1.5 1.5 \u5b50\u4f9b\u5411\u3051 6\u65e5 1.5 + 3 * 1.5 6.0"},{"location":"scala/17-video-rental-system/#3","title":"3. \u660e\u7d30\u30c7\u30fc\u30bf","text":"<pre><code>case class RentalLine(\n  title: String,\n  days: Days,\n  amount: Money,\n  points: Points\n)\n\ncase class StatementData(\n  customerName: String,\n  rentalLines: List[RentalLine],\n  totalAmount: Money,\n  totalPoints: Points\n)\n\ndef generateStatementData(customer: Customer): StatementData =\n  val lines = customer.rentals.map { rental =&gt;\n    RentalLine(\n      title = rental.movie.title,\n      days = rental.days,\n      amount = calculateRentalAmount(rental),\n      points = calculateRentalPoints(rental)\n    )\n  }\n  StatementData(\n    customerName = customer.name,\n    rentalLines = lines,\n    totalAmount = totalAmount(customer.rentals),\n    totalPoints = totalPoints(customer.rentals)\n  )\n</code></pre>"},{"location":"scala/17-video-rental-system/#4","title":"4. \u660e\u7d30\u66f8\u30d5\u30a9\u30fc\u30de\u30c3\u30bf\u30fc","text":""},{"location":"scala/17-video-rental-system/#_7","title":"\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u5f62\u5f0f","text":"<pre><code>enum StatementFormat:\n  case Text\n  case Html\n  case Json\n</code></pre>"},{"location":"scala/17-video-rental-system/#_8","title":"\u30c6\u30ad\u30b9\u30c8\u5f62\u5f0f","text":"<pre><code>object TextFormatter extends StatementFormatter:\n  def format(data: StatementData): String =\n    val header = s\"Rental Record for ${data.customerName}\\n\"\n    val lines = data.rentalLines.map { line =&gt;\n      s\"\\t${line.title}\\t${line.amount}\\n\"\n    }.mkString\n    val footer = s\"Amount owed is ${data.totalAmount}\\n\" +\n      s\"You earned ${data.totalPoints} frequent renter points\"\n    header + lines + footer\n</code></pre>"},{"location":"scala/17-video-rental-system/#html","title":"HTML\u5f62\u5f0f","text":"<pre><code>object HtmlFormatter extends StatementFormatter:\n  def format(data: StatementData): String =\n    val header = s\"&lt;h1&gt;Rental Record for &lt;em&gt;${data.customerName}&lt;/em&gt;&lt;/h1&gt;\\n&lt;ul&gt;\\n\"\n    val lines = data.rentalLines.map { line =&gt;\n      s\"  &lt;li&gt;${line.title} - ${line.amount}&lt;/li&gt;\\n\"\n    }.mkString\n    val footer = s\"&lt;/ul&gt;\\n\" +\n      s\"&lt;p&gt;Amount owed is &lt;strong&gt;${data.totalAmount}&lt;/strong&gt;&lt;/p&gt;\\n\" +\n      s\"&lt;p&gt;You earned &lt;strong&gt;${data.totalPoints}&lt;/strong&gt; frequent renter points&lt;/p&gt;\"\n    header + lines + footer\n</code></pre>"},{"location":"scala/17-video-rental-system/#_9","title":"\u51fa\u529b\u4f8b","text":"<p>\u30c6\u30ad\u30b9\u30c8\u5f62\u5f0f: <pre><code>Rental Record for John\n  Inception  3.5\n  Frozen     3.0\n  New Movie  6.0\nAmount owed is 12.5\nYou earned 4 frequent renter points\n</code></pre></p> <p>HTML\u5f62\u5f0f: <pre><code>&lt;h1&gt;Rental Record for &lt;em&gt;John&lt;/em&gt;&lt;/h1&gt;\n&lt;ul&gt;\n  &lt;li&gt;Inception - 3.5&lt;/li&gt;\n  &lt;li&gt;Frozen - 3.0&lt;/li&gt;\n  &lt;li&gt;New Movie - 6.0&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;Amount owed is &lt;strong&gt;12.5&lt;/strong&gt;&lt;/p&gt;\n&lt;p&gt;You earned &lt;strong&gt;4&lt;/strong&gt; frequent renter points&lt;/p&gt;\n</code></pre></p>"},{"location":"scala/17-video-rental-system/#5","title":"5. \u30dd\u30ea\u30b7\u30fc\u30d9\u30fc\u30b9\u306e\u8a2d\u8a08","text":"<p>\u3088\u308a\u67d4\u8edf\u306a\u8a2d\u8a08\u3068\u3057\u3066\u3001\u6599\u91d1\u30dd\u30ea\u30b7\u30fc\u3092\u95a2\u6570\u3068\u3057\u3066\u8868\u73fe\u3067\u304d\u307e\u3059\u3002</p> <pre><code>case class PricingPolicy(\n  name: String,\n  calculateAmount: Days =&gt; Money,\n  calculatePoints: Days =&gt; Points\n)\n\nobject PricingPolicies:\n  val regular: PricingPolicy = PricingPolicy(\n    \"Regular\",\n    days =&gt; if days &gt; 2 then BigDecimal(2.0 + (days - 2) * 1.5) else BigDecimal(2.0),\n    _ =&gt; 1\n  )\n\n  val premium: PricingPolicy = PricingPolicy(\n    \"Premium\",\n    days =&gt; BigDecimal(days * 5.0),\n    days =&gt; days  // \u65e5\u6570\u5206\u306e\u30dd\u30a4\u30f3\u30c8\n  )\n</code></pre>"},{"location":"scala/17-video-rental-system/#6","title":"6. \u30ec\u30f3\u30bf\u30eb\u30b7\u30e7\u30c3\u30d7","text":"<pre><code>class RentalShop:\n  private var movies: Map[String, Movie] = Map.empty\n  private var customers: Map[String, Customer] = Map.empty\n\n  def addMovie(movie: Movie): Unit = ...\n  def registerCustomer(name: String): Customer = ...\n  def rentMovie(customerName: String, movieTitle: String, days: Days): Option[Rental] = ...\n  def generateCustomerStatement(customerName: String, format: StatementFormat): Option[String] = ...\n</code></pre>"},{"location":"scala/17-video-rental-system/#7","title":"7. \u5272\u5f15\u8a08\u7b97","text":"<pre><code>sealed trait Discount:\n  def apply(amount: Money): Money\n\ncase class PercentageDiscount(percent: Double) extends Discount:\n  def apply(amount: Money): Money = amount * BigDecimal(1 - percent)\n\ncase class FixedDiscount(value: Money) extends Discount:\n  def apply(amount: Money): Money = (amount - value) max BigDecimal(0)\n\ndef applyDiscounts(amount: Money, discounts: Seq[Discount]): Money =\n  discounts.foldLeft(amount)((acc, d) =&gt; d.apply(acc))\n</code></pre>"},{"location":"scala/17-video-rental-system/#8","title":"8. \u58f2\u4e0a\u30ec\u30dd\u30fc\u30c8","text":"<pre><code>case class SalesReport(\n  period: String,\n  totalRentals: Int,\n  totalRevenue: Money,\n  rentalsByCategory: Map[MovieCategory, Int],\n  revenueByCategory: Map[MovieCategory, Money]\n)\n\ndef generateSalesReport(rentals: Seq[Rental], period: String): SalesReport =\n  val rentalsByCategory = rentals.groupBy(_.movie.category).view.mapValues(_.size).toMap\n  val revenueByCategory = rentals.groupBy(_.movie.category).view.mapValues(rs =&gt; totalAmount(rs)).toMap\n  SalesReport(period, rentals.size, totalAmount(rentals), rentalsByCategory, revenueByCategory)\n</code></pre>"},{"location":"scala/17-video-rental-system/#9-dsl","title":"9. DSL","text":"<pre><code>object RentalDSL:\n  def customer(name: String): CustomerBuilder = CustomerBuilder(name)\n\n  case class CustomerBuilder(name: String, rentals: List[Rental] = Nil):\n    def rents(movie: Movie, days: Days): CustomerBuilder =\n      copy(rentals = rentals :+ Rental(movie, days))\n    def build: Customer = Customer(name, rentals)\n    def statement: String = generateStatement(build)\n    def statementAs(format: StatementFormat): String = generateStatement(build, format)\n\n  def regular(title: String): Movie = Movie.regular(title)\n  def newRelease(title: String): Movie = Movie.newRelease(title)\n  def childrens(title: String): Movie = Movie.childrens(title)\n\n// \u4f7f\u7528\u4f8b\nimport RentalDSL.*\nval statement = customer(\"John\")\n  .rents(regular(\"Inception\"), 3)\n  .rents(newRelease(\"New Movie\"), 2)\n  .statement\n</code></pre>"},{"location":"scala/17-video-rental-system/#10-clojure","title":"10. Clojure \u3068\u306e\u6bd4\u8f03","text":"\u6982\u5ff5 Clojure Scala \u6620\u753b\u30ab\u30c6\u30b4\u30ea \u30ad\u30fc\u30ef\u30fc\u30c9 (<code>:regular</code>) enum \u6599\u91d1\u8a08\u7b97 \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9 \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1 / object \u660e\u7d30\u30c7\u30fc\u30bf \u30de\u30c3\u30d7 case class \u30d5\u30a9\u30fc\u30de\u30c3\u30bf\u30fc \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9 trait + object"},{"location":"scala/17-video-rental-system/#11","title":"11. \u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u306e\u30dd\u30a4\u30f3\u30c8","text":""},{"location":"scala/17-video-rental-system/#oop-vs-fp","title":"OOP vs FP","text":"<p>OOP \u30a2\u30d7\u30ed\u30fc\u30c1: - <code>Movie</code> \u30af\u30e9\u30b9\u306b <code>getCharge()</code> \u30e1\u30bd\u30c3\u30c9 - \u30b5\u30d6\u30af\u30e9\u30b9\u3067\u30aa\u30fc\u30d0\u30fc\u30e9\u30a4\u30c9</p> <p>FP \u30a2\u30d7\u30ed\u30fc\u30c1: - \u6620\u753b\u306f\u30c7\u30fc\u30bf\u306e\u307f\uff08case class\uff09 - \u6599\u91d1\u8a08\u7b97\u306f\u5225\u306e\u95a2\u6570/object - \u30ab\u30c6\u30b4\u30ea\u306b\u5fdc\u3058\u305f\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1</p>"},{"location":"scala/17-video-rental-system/#_10","title":"\u5229\u70b9","text":"<ol> <li>\u30c7\u30fc\u30bf\u3068\u51e6\u7406\u306e\u5206\u96e2: \u30c6\u30b9\u30c8\u304c\u5bb9\u6613</li> <li>\u62e1\u5f35\u5bb9\u6613\u6027: \u65b0\u3057\u3044\u30ab\u30c6\u30b4\u30ea\u8ffd\u52a0\u304c\u5bb9\u6613</li> <li>\u30aa\u30fc\u30d7\u30f3\u30fb\u30af\u30ed\u30fc\u30ba\u30c9\u539f\u5247: \u65e2\u5b58\u30b3\u30fc\u30c9\u5909\u66f4\u4e0d\u8981</li> </ol>"},{"location":"scala/17-video-rental-system/#_11","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u30ec\u30f3\u30bf\u30eb\u30d3\u30c7\u30aa\u30b7\u30b9\u30c6\u30e0\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u3092\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1: \u30ab\u30c6\u30b4\u30ea\u306b\u3088\u308b\u6599\u91d1\u8a08\u7b97\u306e\u30c7\u30a3\u30b9\u30d1\u30c3\u30c1</li> <li>\u30c7\u30fc\u30bf\u3068\u51e6\u7406\u306e\u5206\u96e2: \u6620\u753b\u30c7\u30fc\u30bf\u3068\u8a08\u7b97\u30ed\u30b8\u30c3\u30af\u306e\u5206\u96e2</li> <li>\u30d5\u30a9\u30fc\u30de\u30c3\u30bf\u30fc\u30d1\u30bf\u30fc\u30f3: \u8907\u6570\u306e\u51fa\u529b\u5f62\u5f0f\u3078\u306e\u5bfe\u5fdc</li> <li>\u62e1\u5f35\u6027: \u65b0\u3057\u3044\u30ab\u30c6\u30b4\u30ea\u3084\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306e\u8ffd\u52a0\u304c\u5bb9\u6613</li> <li>DSL: \u6d41\u66a2\u306a API \u306b\u3088\u308b\u8aad\u307f\u3084\u3059\u3044\u30b3\u30fc\u30c9</li> </ol>"},{"location":"scala/17-video-rental-system/#_12","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/scala/part6/src/main/scala/VideoRentalSystem.scala</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/scala/part6/src/test/scala/VideoRentalSystemSpec.scala</code></li> </ul>"},{"location":"scala/18-concurrency-system/","title":"\u7b2c18\u7ae0: \u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0","text":""},{"location":"scala/18-concurrency-system/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Scala \u306e\u4e26\u884c\u51e6\u7406\u30d7\u30ea\u30df\u30c6\u30a3\u30d6\u3092\u4f7f\u3063\u305f\u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0\u3092\u5b66\u3073\u307e\u3059\u3002\u96fb\u8a71\u901a\u8a71\u30b7\u30b9\u30c6\u30e0\u3092\u72b6\u614b\u6a5f\u68b0\u30d1\u30bf\u30fc\u30f3\u3067\u5b9f\u88c5\u3057\u3001\u30a4\u30d9\u30f3\u30c8\u99c6\u52d5\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306e\u57fa\u790e\u3092\u7406\u89e3\u3057\u307e\u3059\u3002</p> <p>\u3053\u306e\u554f\u984c\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u306e\u6982\u5ff5\u3092\u5b66\u3073\u307e\u3059\uff1a</p> <ul> <li>Scala \u306e\u4e26\u884c\u51e6\u7406\u30d7\u30ea\u30df\u30c6\u30a3\u30d6\uff08AtomicReference\u3001TrieMap\uff09</li> <li>\u72b6\u614b\u6a5f\u68b0\u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5</li> <li>\u30a4\u30d9\u30f3\u30c8\u99c6\u52d5\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3</li> <li>Pub/Sub \u30d1\u30bf\u30fc\u30f3</li> </ul>"},{"location":"scala/18-concurrency-system/#1-scala","title":"1. Scala \u306e\u4e26\u884c\u51e6\u7406\u30e2\u30c7\u30eb","text":"<p>Scala/JVM \u306f\u8907\u6570\u306e\u4e26\u884c\u51e6\u7406\u30d7\u30ea\u30df\u30c6\u30a3\u30d6\u3092\u63d0\u4f9b\u3057\u307e\u3059\uff1a</p> \u30d7\u30ea\u30df\u30c6\u30a3\u30d6 \u7279\u5fb4 \u7528\u9014 AtomicReference CAS \u64cd\u4f5c\u3001\u30ed\u30c3\u30af\u30d5\u30ea\u30fc \u5358\u4e00\u5024\u306e\u5b89\u5168\u306a\u66f4\u65b0 TrieMap \u4e26\u884c\u5b89\u5168\u306a\u30de\u30c3\u30d7 \u5171\u6709\u72b6\u614b\u306e\u7ba1\u7406 Future/Promise \u975e\u540c\u671f\u8a08\u7b97 \u4e26\u884c\u30bf\u30b9\u30af\u306e\u5b9f\u884c <p></p>"},{"location":"scala/18-concurrency-system/#2","title":"2. \u72b6\u614b\u6a5f\u68b0\u30d1\u30bf\u30fc\u30f3","text":""},{"location":"scala/18-concurrency-system/#_2","title":"\u96fb\u8a71\u901a\u8a71\u306e\u72b6\u614b\u9077\u79fb","text":""},{"location":"scala/18-concurrency-system/#_3","title":"\u72b6\u614b\u6a5f\u68b0\u306e\u5b9a\u7fa9","text":"<pre><code>/**\n * \u96fb\u8a71\u306e\u72b6\u614b\n */\nenum PhoneState:\n  case Idle\n  case Calling\n  case Dialing\n  case WaitingForConnection\n  case Talking\n\n/**\n * \u96fb\u8a71\u30a4\u30d9\u30f3\u30c8\n */\nenum PhoneEvent:\n  case Call\n  case Ring\n  case Dialtone\n  case Ringback\n  case Connected\n  case Disconnect\n\n/**\n * \u30a2\u30af\u30b7\u30e7\u30f3\u30bf\u30a4\u30d7\n */\nenum ActionType:\n  case CallerOffHook\n  case CalleeOffHook\n  case Dial\n  case Talk\n  case None\n\n/**\n * \u72b6\u614b\u9077\u79fb\u7d50\u679c\n */\ncase class Transition(\n  nextState: PhoneState,\n  action: ActionType\n)\n\n/**\n * \u72b6\u614b\u6a5f\u68b0\u306e\u5b9a\u7fa9\n */\nobject PhoneStateMachine:\n  import PhoneState.*\n  import PhoneEvent.*\n  import ActionType.*\n\n  private val transitions: Map[(PhoneState, PhoneEvent), Transition] = Map(\n    (Idle, Call) -&gt; Transition(Calling, CallerOffHook),\n    (Idle, Ring) -&gt; Transition(WaitingForConnection, CalleeOffHook),\n    (Idle, Disconnect) -&gt; Transition(Idle, None),\n    (Calling, Dialtone) -&gt; Transition(Dialing, Dial),\n    (Dialing, Ringback) -&gt; Transition(WaitingForConnection, None),\n    (WaitingForConnection, Connected) -&gt; Transition(Talking, Talk),\n    (Talking, Disconnect) -&gt; Transition(Idle, None)\n  )\n\n  def transition(state: PhoneState, event: PhoneEvent): Option[Transition] =\n    transitions.get((state, event))\n\n  def isValidTransition(state: PhoneState, event: PhoneEvent): Boolean =\n    transitions.contains((state, event))\n</code></pre>"},{"location":"scala/18-concurrency-system/#3","title":"3. \u30a2\u30af\u30b7\u30e7\u30f3\u30cf\u30f3\u30c9\u30e9","text":"<pre><code>/**\n * \u30a2\u30af\u30b7\u30e7\u30f3\u30cf\u30f3\u30c9\u30e9\n */\ntrait ActionHandler:\n  def handle(fromUser: UserId, toUser: UserId, action: ActionType): Unit\n\n/**\n * \u30ed\u30b0\u51fa\u529b\u30a2\u30af\u30b7\u30e7\u30f3\u30cf\u30f3\u30c9\u30e9\n */\nclass LoggingActionHandler extends ActionHandler:\n  private var logs: List[String] = Nil\n\n  def handle(fromUser: UserId, toUser: UserId, action: ActionType): Unit =\n    val message = action match\n      case ActionType.CallerOffHook =&gt; s\"$fromUser picked up the phone to call $toUser\"\n      case ActionType.CalleeOffHook =&gt; s\"$fromUser answered the call from $toUser\"\n      case ActionType.Dial =&gt; s\"$fromUser is dialing $toUser\"\n      case ActionType.Talk =&gt; s\"$fromUser is now talking with $toUser\"\n      case ActionType.None =&gt; \"\"\n\n    if message.nonEmpty then\n      logs = logs :+ message\n      println(message)\n\n  def getLogs: List[String] = logs\n  def clear(): Unit = logs = Nil\n\n/**\n * \u30b5\u30a4\u30ec\u30f3\u30c8\u30a2\u30af\u30b7\u30e7\u30f3\u30cf\u30f3\u30c9\u30e9\uff08\u30c6\u30b9\u30c8\u7528\uff09\n */\nclass SilentActionHandler extends ActionHandler:\n  private var actions: List[(UserId, UserId, ActionType)] = Nil\n\n  def handle(fromUser: UserId, toUser: UserId, action: ActionType): Unit =\n    if action != ActionType.None then\n      actions = actions :+ (fromUser, toUser, action)\n\n  def getActions: List[(UserId, UserId, ActionType)] = actions\n  def clear(): Unit = actions = Nil\n</code></pre>"},{"location":"scala/18-concurrency-system/#4","title":"4. \u30e6\u30fc\u30b6\u30fc\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8","text":"<p>AtomicReference \u3092\u4f7f\u7528\u3057\u3066\u30b9\u30ec\u30c3\u30c9\u30bb\u30fc\u30d5\u306a\u72b6\u614b\u7ba1\u7406\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p> <pre><code>/**\n * \u30e6\u30fc\u30b6\u30fc\u72b6\u614b\n */\ncase class UserState(\n  userId: UserId,\n  state: PhoneState = PhoneState.Idle,\n  peer: Option[UserId] = None\n)\n\n/**\n * \u30e6\u30fc\u30b6\u30fc\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\n */\nclass UserAgent(val userId: UserId, actionHandler: ActionHandler):\n  private val stateRef = new AtomicReference(UserState(userId))\n\n  def getState: PhoneState = stateRef.get().state\n  def getPeer: Option[UserId] = stateRef.get().peer\n  def getUserState: UserState = stateRef.get()\n\n  /**\n   * \u30a4\u30d9\u30f3\u30c8\u3092\u9001\u4fe1\uff08CAS\u64cd\u4f5c\u3067\u5b89\u5168\u306b\u72b6\u614b\u9077\u79fb\uff09\n   */\n  def sendEvent(event: PhoneEvent, peer: Option[UserId] = None): Boolean =\n    var success = false\n    var done = false\n    while !done do\n      val current = stateRef.get()\n      PhoneStateMachine.transition(current.state, event) match\n        case Some(trans) =&gt;\n          val newPeer = peer.orElse(current.peer)\n          val newState = current.copy(state = trans.nextState, peer = newPeer)\n          if stateRef.compareAndSet(current, newState) then\n            if trans.action != ActionType.None then\n              actionHandler.handle(userId, newPeer.getOrElse(\"unknown\"), trans.action)\n            success = true\n            done = true\n        case None =&gt;\n          done = true\n    success\n\n  def reset(): Unit =\n    stateRef.set(UserState(userId))\n</code></pre> <p></p>"},{"location":"scala/18-concurrency-system/#5","title":"5. \u96fb\u8a71\u30b7\u30b9\u30c6\u30e0","text":"<pre><code>/**\n * \u96fb\u8a71\u30b7\u30b9\u30c6\u30e0\n */\nclass PhoneSystem(actionHandler: ActionHandler = new LoggingActionHandler):\n  private val users = TrieMap.empty[UserId, UserAgent]\n\n  def createUser(userId: UserId): UserAgent =\n    val agent = new UserAgent(userId, actionHandler)\n    users.put(userId, agent)\n    agent\n\n  def getUser(userId: UserId): Option[UserAgent] =\n    users.get(userId)\n\n  /**\n   * \u96fb\u8a71\u3092\u304b\u3051\u308b\n   */\n  def makeCall(callerId: UserId, calleeId: UserId): Boolean =\n    (for\n      caller &lt;- users.get(callerId)\n      callee &lt;- users.get(calleeId)\n    yield\n      val callerSuccess = caller.sendEvent(PhoneEvent.Call, Some(calleeId))\n      val calleeSuccess = callee.sendEvent(PhoneEvent.Ring, Some(callerId))\n      callerSuccess &amp;&amp; calleeSuccess\n    ).getOrElse(false)\n\n  /**\n   * \u96fb\u8a71\u306b\u51fa\u308b\n   */\n  def answerCall(callerId: UserId, calleeId: UserId): Boolean =\n    (for\n      caller &lt;- users.get(callerId)\n      callee &lt;- users.get(calleeId)\n    yield\n      caller.sendEvent(PhoneEvent.Dialtone) &amp;&amp;\n      caller.sendEvent(PhoneEvent.Ringback) &amp;&amp;\n      caller.sendEvent(PhoneEvent.Connected) &amp;&amp;\n      callee.sendEvent(PhoneEvent.Connected)\n    ).getOrElse(false)\n\n  /**\n   * \u96fb\u8a71\u3092\u5207\u308b\n   */\n  def hangUp(callerId: UserId, calleeId: UserId): Boolean =\n    (for\n      caller &lt;- users.get(callerId)\n      callee &lt;- users.get(calleeId)\n    yield\n      caller.sendEvent(PhoneEvent.Disconnect) &amp;&amp;\n      callee.sendEvent(PhoneEvent.Disconnect)\n    ).getOrElse(false)\n</code></pre>"},{"location":"scala/18-concurrency-system/#6","title":"6. \u30a4\u30d9\u30f3\u30c8\u30d0\u30b9","text":"<pre><code>/**\n * \u30a4\u30d9\u30f3\u30c8\n */\ncase class Event(\n  eventType: EventType,\n  data: Map[String, Any],\n  timestamp: Long = System.currentTimeMillis()\n)\n\n/**\n * \u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9\n */\ntype EventHandler = Event =&gt; Unit\n\n/**\n * \u30a4\u30d9\u30f3\u30c8\u30d0\u30b9\n */\nclass EventBus:\n  private val subscribers = TrieMap.empty[EventType, List[EventHandler]]\n  private var eventLog: List[Event] = Nil\n  private val logLock = new Object\n\n  /**\n   * \u30a4\u30d9\u30f3\u30c8\u3092\u8cfc\u8aad\n   */\n  def subscribe(eventType: EventType, handler: EventHandler): Unit =\n    subscribers.updateWith(eventType) {\n      case Some(handlers) =&gt; Some(handlers :+ handler)\n      case None =&gt; Some(List(handler))\n    }\n\n  /**\n   * \u30a4\u30d9\u30f3\u30c8\u3092\u767a\u884c\uff08\u540c\u671f\uff09\n   */\n  def publish(eventType: EventType, data: Map[String, Any] = Map.empty): Event =\n    val event = Event(eventType, data)\n    logLock.synchronized {\n      eventLog = eventLog :+ event\n    }\n    subscribers.get(eventType).foreach { handlers =&gt;\n      handlers.foreach { handler =&gt;\n        try handler(event)\n        catch case e: Exception =&gt; println(s\"Handler error: ${e.getMessage}\")\n      }\n    }\n    event\n\n  /**\n   * \u30a4\u30d9\u30f3\u30c8\u3092\u767a\u884c\uff08\u975e\u540c\u671f\uff09\n   */\n  def publishAsync(eventType: EventType, data: Map[String, Any] = Map.empty)\n                  (using ec: ExecutionContext): Future[Event] =\n    Future {\n      publish(eventType, data)\n    }\n\n  def getEventLog: List[Event] = logLock.synchronized { eventLog }\n</code></pre>"},{"location":"scala/18-concurrency-system/#7","title":"7. \u6c4e\u7528\u72b6\u614b\u6a5f\u68b0","text":"<pre><code>/**\n * \u6c4e\u7528\u72b6\u614b\u6a5f\u68b0\n */\nclass StateMachine[S, E](\n  initialState: S,\n  transitions: Map[(S, E), (S, Option[() =&gt; Unit])]\n):\n  private val stateRef = new AtomicReference(initialState)\n\n  def getState: S = stateRef.get()\n\n  def send(event: E): Boolean =\n    var success = false\n    var done = false\n    while !done do\n      val current = stateRef.get()\n      transitions.get((current, event)) match\n        case Some((nextState, action)) =&gt;\n          if stateRef.compareAndSet(current, nextState) then\n            action.foreach(_())\n            success = true\n            done = true\n        case None =&gt;\n          done = true\n    success\n\n  def reset(): Unit = stateRef.set(initialState)\n\nobject StateMachine:\n  def builder[S, E](initialState: S): StateMachineBuilder[S, E] =\n    StateMachineBuilder(initialState, Map.empty)\n\n  case class StateMachineBuilder[S, E](\n    initialState: S,\n    transitions: Map[(S, E), (S, Option[() =&gt; Unit])]\n  ):\n    def addTransition(from: S, event: E, to: S, action: Option[() =&gt; Unit] = None): StateMachineBuilder[S, E] =\n      copy(transitions = transitions + ((from, event) -&gt; (to, action)))\n\n    def build: StateMachine[S, E] =\n      new StateMachine(initialState, transitions)\n</code></pre>"},{"location":"scala/18-concurrency-system/#8-pubsub","title":"8. Pub/Sub \u30b7\u30b9\u30c6\u30e0","text":"<pre><code>/**\n * \u30c8\u30d4\u30c3\u30af\n */\nclass Topic[T](name: String):\n  private val subscribers = TrieMap.empty[String, T =&gt; Unit]\n\n  def subscribe(subscriberId: String, handler: T =&gt; Unit): Unit =\n    subscribers.put(subscriberId, handler)\n\n  def unsubscribe(subscriberId: String): Unit =\n    subscribers.remove(subscriberId)\n\n  def publish(message: T): Unit =\n    subscribers.values.foreach { handler =&gt;\n      try handler(message)\n      catch case e: Exception =&gt; println(s\"Handler error: ${e.getMessage}\")\n    }\n\n  def subscriberCount: Int = subscribers.size\n\n/**\n * \u30e1\u30c3\u30bb\u30fc\u30b8\u30d6\u30ed\u30fc\u30ab\u30fc\n */\nclass MessageBroker:\n  private val topics = TrieMap.empty[String, Topic[Any]]\n\n  def getTopic[T](name: String): Topic[T] =\n    topics.getOrElseUpdate(name, new Topic[Any](name)).asInstanceOf[Topic[T]]\n\n  def topicNames: Set[String] = topics.keySet.toSet\n</code></pre>"},{"location":"scala/18-concurrency-system/#9","title":"9. \u30bf\u30b9\u30af\u30ad\u30e5\u30fc","text":"<pre><code>/**\n * \u30bf\u30b9\u30af\u30ad\u30e5\u30fc\n */\nclass TaskQueue[T](workers: Int = 4)(using ec: ExecutionContext):\n  private val queue = new java.util.concurrent.LinkedBlockingQueue[Task[T]]()\n  @volatile private var running = false\n  private var workerThreads: List[Thread] = Nil\n\n  def submit(id: String, computation: () =&gt; T): Future[T] =\n    val task = Task(id, computation)\n    queue.put(task)\n    task.future\n\n  def start(): Unit =\n    if !running then\n      running = true\n      workerThreads = (1 to workers).map { i =&gt;\n        val t = new Thread(() =&gt; {\n          while running do\n            try\n              val task = queue.poll(100, java.util.concurrent.TimeUnit.MILLISECONDS)\n              if task != null then\n                try\n                  val result = task.computation()\n                  task.promise.success(result)\n                catch\n                  case e: Exception =&gt; task.promise.failure(e)\n            catch\n              case _: InterruptedException =&gt; ()\n        }, s\"TaskQueue-Worker-$i\")\n        t.start()\n        t\n      }.toList\n\n  def stop(): Unit =\n    running = false\n    workerThreads.foreach(_.interrupt())\n</code></pre>"},{"location":"scala/18-concurrency-system/#10","title":"10. \u4f7f\u7528\u4f8b","text":""},{"location":"scala/18-concurrency-system/#_4","title":"\u96fb\u8a71\u901a\u8a71\u306e\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3","text":"<pre><code>import ConcurrencySystem.*\n\n// \u96fb\u8a71\u30b7\u30b9\u30c6\u30e0\u3092\u4f5c\u6210\nval handler = new SilentActionHandler\nval system = new PhoneSystem(handler)\n\n// \u30e6\u30fc\u30b6\u30fc\u3092\u4f5c\u6210\nval alice = system.createUser(\"Alice\")\nval bob = system.createUser(\"Bob\")\n\n// \u521d\u671f\u72b6\u614b\u306e\u78ba\u8a8d\nalice.getState // =&gt; PhoneState.Idle\nbob.getState   // =&gt; PhoneState.Idle\n\n// Alice \u304c Bob \u306b\u96fb\u8a71\u3092\u304b\u3051\u308b\nsystem.makeCall(\"Alice\", \"Bob\")\nalice.getState // =&gt; PhoneState.Calling\nbob.getState   // =&gt; PhoneState.WaitingForConnection\n\n// Bob \u304c\u96fb\u8a71\u306b\u51fa\u308b\nsystem.answerCall(\"Alice\", \"Bob\")\nalice.getState // =&gt; PhoneState.Talking\nbob.getState   // =&gt; PhoneState.Talking\n\n// \u96fb\u8a71\u3092\u5207\u308b\nsystem.hangUp(\"Alice\", \"Bob\")\nalice.getState // =&gt; PhoneState.Idle\nbob.getState   // =&gt; PhoneState.Idle\n</code></pre>"},{"location":"scala/18-concurrency-system/#_5","title":"\u30a4\u30d9\u30f3\u30c8\u30b7\u30b9\u30c6\u30e0\u306e\u4f7f\u7528","text":"<pre><code>import ConcurrencySystem.*\nimport scala.collection.mutable.ListBuffer\n\n// \u30a4\u30d9\u30f3\u30c8\u30d0\u30b9\u3092\u4f5c\u6210\nval bus = new EventBus\n\n// \u30ed\u30b0\u3092\u53ce\u96c6\u3059\u308b\u30ea\u30b9\u30c8\nval logs = ListBuffer.empty[String]\n\n// \u30cf\u30f3\u30c9\u30e9\u3092\u767b\u9332\nbus.subscribe(\"user-logged-in\", event =&gt;\n  logs += s\"User logged in: ${event.data}\"\n)\n\nbus.subscribe(\"user-logged-in\", event =&gt;\n  logs += s\"Sending welcome email to: ${event.data}\"\n)\n\n// \u30a4\u30d9\u30f3\u30c8\u3092\u767a\u884c\nbus.publish(\"user-logged-in\", Map(\"userId\" -&gt; \"U001\", \"name\" -&gt; \"Alice\"))\n\n// \u30ed\u30b0\u306e\u78ba\u8a8d\nlogs.toList\n// =&gt; List(\n//      \"User logged in: Map(userId -&gt; U001, name -&gt; Alice)\",\n//      \"Sending welcome email to: Map(userId -&gt; U001, name -&gt; Alice)\"\n//    )\n\n// \u30a4\u30d9\u30f3\u30c8\u30ed\u30b0\u306e\u78ba\u8a8d\nbus.getEventLog\n// =&gt; List(Event(\"user-logged-in\", Map(...), timestamp))\n</code></pre>"},{"location":"scala/18-concurrency-system/#11-clojure","title":"11. Clojure \u3068\u306e\u6bd4\u8f03","text":"\u6a5f\u80fd Clojure Scala \u975e\u540c\u671f\u72b6\u614b Agent AtomicReference + CAS \u4e26\u884c\u30de\u30c3\u30d7 atom + {} TrieMap \u975e\u540c\u671f\u9001\u4fe1 send Future \u72b6\u614b\u5f85\u6a5f await compareAndSet \u30eb\u30fc\u30d7 \u30a8\u30e9\u30fc\u51e6\u7406 agent-error try/catch <p>Clojure \u306e Agent \u306f\u975e\u540c\u671f\u3067 <code>send</code> \u306b\u3088\u308a\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9\u3067\u72b6\u614b\u66f4\u65b0\u3055\u308c\u307e\u3059\u304c\u3001Scala \u3067\u306f <code>AtomicReference</code> \u306e CAS\uff08Compare-And-Set\uff09\u64cd\u4f5c\u3092\u4f7f\u7528\u3057\u3066\u540c\u671f\u7684\u306b\u30b9\u30ec\u30c3\u30c9\u30bb\u30fc\u30d5\u306a\u66f4\u65b0\u3092\u884c\u3044\u307e\u3059\u3002</p> <pre><code>// Scala: CAS\u64cd\u4f5c\u306b\u3088\u308b\u5b89\u5168\u306a\u66f4\u65b0\nwhile !done do\n  val current = stateRef.get()\n  transitions.get((current, event)) match\n    case Some((nextState, _)) =&gt;\n      if stateRef.compareAndSet(current, newState) then\n        done = true\n    case None =&gt;\n      done = true\n</code></pre> <pre><code>;; Clojure: Agent\u306b\u3088\u308b\u975e\u540c\u671f\u66f4\u65b0\n(send user-agent transition event event-data)\n(await user-agent)  ; \u5b8c\u4e86\u3092\u5f85\u3064\n</code></pre>"},{"location":"scala/18-concurrency-system/#12","title":"12. \u30b7\u30fc\u30b1\u30f3\u30b9\u56f3","text":""},{"location":"scala/18-concurrency-system/#_6","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u4e26\u884c\u51e6\u7406\u30b7\u30b9\u30c6\u30e0\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u3092\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>AtomicReference: CAS \u64cd\u4f5c\u306b\u3088\u308b\u5b89\u5168\u306a\u72b6\u614b\u66f4\u65b0</li> <li>\u72b6\u614b\u6a5f\u68b0\u30d1\u30bf\u30fc\u30f3: \u5ba3\u8a00\u7684\u306a\u72b6\u614b\u9077\u79fb\u5b9a\u7fa9</li> <li>\u30a4\u30d9\u30f3\u30c8\u99c6\u52d5\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3: \u758e\u7d50\u5408\u306a\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u9593\u901a\u4fe1</li> <li>Pub/Sub \u30d1\u30bf\u30fc\u30f3: \u30c8\u30d4\u30c3\u30af\u30d9\u30fc\u30b9\u306e\u30e1\u30c3\u30bb\u30fc\u30b8\u30f3\u30b0</li> <li>\u30bf\u30b9\u30af\u30ad\u30e5\u30fc: \u4e26\u884c\u30bf\u30b9\u30af\u306e\u7ba1\u7406</li> </ol> <p>Scala \u3067\u306f Clojure \u306e Agent \u3068\u7570\u306a\u308a\u3001<code>AtomicReference</code> \u3068 CAS \u64cd\u4f5c\u3092\u4f7f\u7528\u3057\u3066\u30b9\u30ec\u30c3\u30c9\u30bb\u30fc\u30d5\u306a\u72b6\u614b\u7ba1\u7406\u3092\u5b9f\u73fe\u3057\u307e\u3057\u305f\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u540c\u671f\u7684\u304b\u3064\u6c7a\u5b9a\u7684\u306a\u52d5\u4f5c\u304c\u4fdd\u8a3c\u3055\u308c\u3001\u30c6\u30b9\u30c8\u304c\u5bb9\u6613\u306b\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"scala/18-concurrency-system/#_7","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/scala/part6/src/main/scala/ConcurrencySystem.scala</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/scala/part6/src/test/scala/ConcurrencySystemSpec.scala</code></li> </ul>"},{"location":"scala/19-wator-simulation/","title":"\u7b2c19\u7ae0: Wa-Tor \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3","text":""},{"location":"scala/19-wator-simulation/#_1","title":"\u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Wa-Tor\uff08Water Torus\uff09\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u901a\u3058\u3066\u3001\u30bb\u30eb\u30aa\u30fc\u30c8\u30de\u30c8\u30f3\u3068 ADT\uff08\u4ee3\u6570\u7684\u30c7\u30fc\u30bf\u578b\uff09\u3092\u4f7f\u3063\u305f\u6355\u98df\u8005-\u88ab\u98df\u8005\u30e2\u30c7\u30eb\u306e\u5b9f\u88c5\u3092\u5b66\u3073\u307e\u3059\u3002</p> <p>Wa-Tor \u306f1984\u5e74\u306b A.K. Dewdney \u304c Scientific American \u3067\u7d39\u4ecb\u3057\u305f\u53e4\u5178\u7684\u306a\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3067\u3001\u9b5a\uff08\u88ab\u98df\u8005\uff09\u3068\u30b5\u30e1\uff08\u6355\u98df\u8005\uff09\u306e\u751f\u614b\u7cfb\u3092\u30e2\u30c7\u30eb\u5316\u3057\u307e\u3059\u3002</p> <p>\u3053\u306e\u554f\u984c\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u306e\u6982\u5ff5\u3092\u5b66\u3073\u307e\u3059\uff1a</p> <ul> <li>\u30bb\u30eb\u30aa\u30fc\u30c8\u30de\u30c8\u30f3\u306e\u5b9f\u88c5</li> <li>sealed trait \u3068 case class \u306b\u3088\u308b ADT</li> <li>\u30c8\u30fc\u30e9\u30b9\u578b\u30ef\u30fc\u30eb\u30c9\u306e\u5ea7\u6a19\u8a08\u7b97</li> <li>\u7e41\u6b96\u3068\u6355\u98df\u306e\u30eb\u30fc\u30eb\u5b9f\u88c5</li> </ul>"},{"location":"scala/19-wator-simulation/#1-wa-tor","title":"1. Wa-Tor \u306e\u4e16\u754c","text":""},{"location":"scala/19-wator-simulation/#_2","title":"\u30c8\u30fc\u30e9\u30b9\u578b\u30ef\u30fc\u30eb\u30c9","text":"<p>Wa-Tor \u306e\u4e16\u754c\u306f\u30c8\u30fc\u30e9\u30b9\uff08\u30c9\u30fc\u30ca\u30c4\u578b\uff09\u3067\u3059\u3002\u7aef\u306b\u5230\u9054\u3059\u308b\u3068\u53cd\u5bfe\u5074\u306b\u51fa\u73fe\u3057\u307e\u3059\u3002</p> <p></p>"},{"location":"scala/19-wator-simulation/#_3","title":"\u30bb\u30eb\u306e\u7a2e\u985e","text":"<ul> <li>\u6c34\uff08Water\uff09: \u7a7a\u306e\u30bb\u30eb</li> <li>\u9b5a\uff08Fish\uff09: \u88ab\u98df\u8005\u3001\u79fb\u52d5\u3068\u7e41\u6b96\u306e\u307f</li> <li>\u30b5\u30e1\uff08Shark\uff09: \u6355\u98df\u8005\u3001\u79fb\u52d5\u3001\u7e41\u6b96\u3001\u6355\u98df</li> </ul>"},{"location":"scala/19-wator-simulation/#2","title":"2. \u57fa\u672c\u578b\u5b9a\u7fa9","text":""},{"location":"scala/19-wator-simulation/#_4","title":"\u5ea7\u6a19\u3068\u65b9\u5411","text":"<pre><code>case class Position(x: Int, y: Int):\n  def +(other: Position): Position = Position(x + other.x, y + other.y)\n\nobject Direction:\n  val deltas: Seq[Position] = for\n    dx &lt;- Seq(-1, 0, 1)\n    dy &lt;- Seq(-1, 0, 1)\n    if !(dx == 0 &amp;&amp; dy == 0)\n  yield Position(dx, dy)\n</code></pre>"},{"location":"scala/19-wator-simulation/#adt","title":"\u30bb\u30eb\u306e\u5b9a\u7fa9\uff08ADT\uff09","text":"<pre><code>/**\n * \u30bb\u30eb\u306e\u57fa\u5e95trait\n */\nsealed trait Cell:\n  def display: Char\n\n/**\n * \u6c34\uff08\u7a7a\u306e\u30bb\u30eb\uff09\n */\ncase object Water extends Cell:\n  def display: Char = '.'\n\n/**\n * \u52d5\u7269\u306e\u5171\u901a\u5c5e\u6027\n */\nsealed trait Animal extends Cell:\n  def age: Int\n  def withAge(newAge: Int): Animal\n  def incrementAge: Animal = withAge(age + 1)\n  def reproductionAge: Int\n\n/**\n * \u9b5a\uff08\u88ab\u98df\u8005\uff09\n */\ncase class Fish(age: Int = 0) extends Animal:\n  def display: Char = 'f'\n  def withAge(newAge: Int): Fish = copy(age = newAge)\n  def reproductionAge: Int = Config.fishReproductionAge\n\n/**\n * \u30b5\u30e1\uff08\u6355\u98df\u8005\uff09\n */\ncase class Shark(age: Int = 0, health: Int = Config.sharkStartingHealth) extends Animal:\n  def display: Char = 'S'\n  def withAge(newAge: Int): Shark = copy(age = newAge)\n  def reproductionAge: Int = Config.sharkReproductionAge\n\n  def withHealth(newHealth: Int): Shark = copy(health = newHealth)\n  def decrementHealth: Shark = copy(health = health - 1)\n  def feed: Shark =\n    val newHealth = math.min(Config.sharkMaxHealth, health + Config.sharkEatingHealth)\n    copy(health = newHealth)\n</code></pre>"},{"location":"scala/19-wator-simulation/#3","title":"3. \u30ef\u30fc\u30eb\u30c9\u69cb\u9020","text":"<pre><code>case class World(\n  width: Int,\n  height: Int,\n  cells: Map[Position, Cell],\n  generation: Int = 0\n):\n  /**\n   * \u5ea7\u6a19\u3092\u30c8\u30fc\u30e9\u30b9\u4e0a\u3067\u30e9\u30c3\u30d7\n   */\n  def wrap(pos: Position): Position =\n    Position(\n      ((pos.x % width) + width) % width,\n      ((pos.y % height) + height) % height\n    )\n\n  /**\n   * \u96a3\u63a5\u30bb\u30eb\u306e\u5ea7\u6a19\u3092\u53d6\u5f97\uff088\u65b9\u5411\uff09\n   */\n  def neighbors(pos: Position): Seq[Position] =\n    Direction.deltas.map(d =&gt; wrap(pos + d))\n\n  /**\n   * \u96a3\u63a5\u3059\u308b\u7a7a\u306e\u30bb\u30eb\u3092\u53d6\u5f97\n   */\n  def emptyNeighbors(pos: Position): Seq[Position] =\n    neighbors(pos).filter(p =&gt; getCell(p) == Water)\n\n  /**\n   * \u96a3\u63a5\u3059\u308b\u9b5a\u306e\u30bb\u30eb\u3092\u53d6\u5f97\n   */\n  def fishNeighbors(pos: Position): Seq[Position] =\n    neighbors(pos).filter(p =&gt; getCell(p).isInstanceOf[Fish])\n\n  /**\n   * \u7d71\u8a08\u60c5\u5831\n   */\n  def statistics: Statistics =\n    val cellList = cells.values.toList\n    Statistics(\n      fish = cellList.count(_.isInstanceOf[Fish]),\n      sharks = cellList.count(_.isInstanceOf[Shark]),\n      water = cellList.count(_ == Water),\n      generation = generation\n    )\n</code></pre>"},{"location":"scala/19-wator-simulation/#4","title":"4. \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u30ed\u30b8\u30c3\u30af","text":""},{"location":"scala/19-wator-simulation/#_5","title":"\u30a2\u30af\u30b7\u30e7\u30f3\u7d50\u679c\u306e\u5b9a\u7fa9","text":"<pre><code>/**\n * \u30bb\u30eb\u306e\u66f4\u65b0\u7d50\u679c\n */\nsealed trait CellUpdate\ncase class Move(from: Position, to: Position, cell: Cell) extends CellUpdate\ncase class Reproduce(parent: Position, child: Position, parentCell: Cell, childCell: Cell) extends CellUpdate\ncase class Eat(from: Position, to: Position, cell: Cell) extends CellUpdate\ncase class Die(at: Position) extends CellUpdate\ncase object NoChange extends CellUpdate\n</code></pre>"},{"location":"scala/19-wator-simulation/#_6","title":"\u79fb\u52d5\u3068\u7e41\u6b96","text":"<pre><code>object Simulation:\n  /**\n   * \u52d5\u7269\u306e\u79fb\u52d5\u3092\u8a66\u307f\u308b\n   */\n  def tryMove(animal: Animal, pos: Position, world: World, random: Random): Option[Move] =\n    val empty = world.emptyNeighbors(pos)\n    if empty.isEmpty then None\n    else\n      val target = empty(random.nextInt(empty.length))\n      Some(Move(pos, target, animal))\n\n  /**\n   * \u52d5\u7269\u306e\u7e41\u6b96\u3092\u8a66\u307f\u308b\n   */\n  def tryReproduce(animal: Animal, pos: Position, world: World, random: Random): Option[Reproduce] =\n    if animal.age &lt; animal.reproductionAge then None\n    else\n      val empty = world.emptyNeighbors(pos)\n      if empty.isEmpty then None\n      else\n        val childPos = empty(random.nextInt(empty.length))\n        val child = animal match\n          case _: Fish =&gt; Fish()\n          case _: Shark =&gt; Shark()\n        Some(Reproduce(pos, childPos, animal.withAge(0), child))\n</code></pre>"},{"location":"scala/19-wator-simulation/#_7","title":"\u30b5\u30e1\u306e\u6355\u98df","text":"<pre><code>/**\n * \u30b5\u30e1\u306e\u6355\u98df\u3092\u8a66\u307f\u308b\n */\ndef tryEat(shark: Shark, pos: Position, world: World, random: Random): Option[Eat] =\n  val fishCells = world.fishNeighbors(pos)\n  if fishCells.isEmpty then None\n  else\n    val target = fishCells(random.nextInt(fishCells.length))\n    Some(Eat(pos, target, shark.feed))\n\n/**\n * \u30b5\u30e1\u306e\u30c6\u30a3\u30c3\u30af\u51e6\u7406\n */\ndef tickShark(shark: Shark, pos: Position, world: World, random: Random): CellUpdate =\n  // \u4f53\u529b\u304c\u5c3d\u304d\u305f\u3089\u6b7b\u4ea1\n  if shark.health &lt;= 1 then\n    return Die(pos)\n\n  val agedShark = shark.incrementAge.asInstanceOf[Shark].decrementHealth\n\n  // \u512a\u5148\u9806\u4f4d: \u7e41\u6b96 &gt; \u6355\u98df &gt; \u79fb\u52d5\n  tryReproduce(agedShark, pos, world, random)\n    .orElse(tryEat(agedShark, pos, world, random))\n    .orElse(tryMove(agedShark, pos, world, random))\n    .getOrElse(NoChange)\n</code></pre>"},{"location":"scala/19-wator-simulation/#_8","title":"\u30ef\u30fc\u30eb\u30c9\u306e\u66f4\u65b0","text":"<pre><code>/**\n * \u66f4\u65b0\u3092\u9069\u7528\n */\ndef applyUpdate(world: World, update: CellUpdate): World =\n  update match\n    case Move(from, to, cell) =&gt;\n      world.setCell(from, Water).setCell(to, cell)\n    case Reproduce(parent, child, parentCell, childCell) =&gt;\n      world.setCell(parent, parentCell).setCell(child, childCell)\n    case Eat(from, to, cell) =&gt;\n      world.setCell(from, Water).setCell(to, cell)\n    case Die(at) =&gt;\n      world.setCell(at, Water)\n    case NoChange =&gt;\n      world\n\n/**\n * \u30ef\u30fc\u30eb\u30c9\u306e1\u30b9\u30c6\u30c3\u30d7\u3092\u5b9f\u884c\n */\ndef tick(world: World, random: Random = new Random): World =\n  val positions = random.shuffle(world.allPositions.toList)\n  val processed = scala.collection.mutable.Set.empty[Position]\n\n  val newWorld = positions.foldLeft(world) { (w, pos) =&gt;\n    if processed.contains(pos) then w\n    else\n      val cell = w.getCell(pos)\n      val update = tickCell(cell, pos, w, random)\n      // \u51e6\u7406\u6e08\u307f\u306e\u4f4d\u7f6e\u3092\u8a18\u9332\n      update match\n        case Move(from, to, _) =&gt;\n          processed += from\n          processed += to\n        // ... \u4ed6\u306e\u30b1\u30fc\u30b9\n        case _ =&gt; ()\n      applyUpdate(w, update)\n  }\n\n  newWorld.copy(generation = newWorld.generation + 1)\n</code></pre>"},{"location":"scala/19-wator-simulation/#5","title":"5. \u8a2d\u5b9a\u30d1\u30e9\u30e1\u30fc\u30bf","text":"<pre><code>object Config:\n  // \u9b5a\u306e\u8a2d\u5b9a\n  val fishReproductionAge: Int = 6\n\n  // \u30b5\u30e1\u306e\u8a2d\u5b9a\n  val sharkReproductionAge: Int = 5\n  val sharkReproductionHealth: Int = 8\n  val sharkStartingHealth: Int = 5\n  val sharkEatingHealth: Int = 5\n  val sharkMaxHealth: Int = 10\n</code></pre> \u30d1\u30e9\u30e1\u30fc\u30bf \u8aac\u660e \u30c7\u30d5\u30a9\u30eb\u30c8\u5024 fishReproductionAge \u9b5a\u306e\u7e41\u6b96\u53ef\u80fd\u5e74\u9f62 6 sharkReproductionAge \u30b5\u30e1\u306e\u7e41\u6b96\u53ef\u80fd\u5e74\u9f62 5 sharkStartingHealth \u30b5\u30e1\u306e\u521d\u671f\u4f53\u529b 5 sharkEatingHealth \u6355\u98df\u6642\u306e\u4f53\u529b\u56de\u5fa9\u91cf 5 sharkMaxHealth \u30b5\u30e1\u306e\u6700\u5927\u4f53\u529b 10"},{"location":"scala/19-wator-simulation/#6-dsl","title":"6. DSL","text":"<pre><code>object DSL:\n  def world(width: Int, height: Int): World = World(width, height)\n\n  def fish: Fish = Fish()\n  def fish(age: Int): Fish = Fish(age)\n\n  def shark: Shark = Shark()\n  def shark(age: Int, health: Int): Shark = Shark(age, health)\n\n  def pos(x: Int, y: Int): Position = Position(x, y)\n\n  extension (w: World)\n    def place(cell: Cell, pos: Position): World = w.setCell(pos, cell)\n    def placeFish(pos: Position): World = w.setCell(pos, Fish())\n    def placeShark(pos: Position): World = w.setCell(pos, Shark())\n    def populate(fishCount: Int, sharkCount: Int): World =\n      World.populateRandom(w, fishCount, sharkCount)\n    def step: World = Simulation.tick(w)\n    def steps(n: Int): World = Simulation.run(w, n)\n    def history(n: Int): List[World] = Simulation.runWithHistory(w, n)\n</code></pre>"},{"location":"scala/19-wator-simulation/#7","title":"7. \u4f7f\u7528\u4f8b","text":"<pre><code>import WatorSimulation.*\nimport DSL.*\n\n// 10x10 \u306e\u30ef\u30fc\u30eb\u30c9\u3092\u4f5c\u6210\nval w = world(10, 10)\n\n// \u9b5a20\u5339\u3001\u30b5\u30e15\u5339\u3092\u30e9\u30f3\u30c0\u30e0\u914d\u7f6e\nval populated = w.populate(20, 5)\n\n// \u7d71\u8a08\u60c5\u5831\nval stats = populated.statistics\n// =&gt; Statistics(fish = 20, sharks = 5, water = 75, generation = 0)\n\n// \u30ef\u30fc\u30eb\u30c9\u3092\u8868\u793a\nprintln(populated.display)\n// ..f.......\n// .S....f...\n// ..f.......\n// ...f..f...\n// ....S.....\n// .f........\n// ......f...\n// ..f...S...\n// ....f.....\n// .......f..\n\n// 1\u30b9\u30c6\u30c3\u30d7\u5b9f\u884c\nval w1 = populated.step\n\n// 100\u30b9\u30c6\u30c3\u30d7\u5b9f\u884c\nval w100 = populated.steps(100)\n\n// \u5c65\u6b74\u4ed8\u304d\u5b9f\u884c\nval history = populated.history(50)\n</code></pre>"},{"location":"scala/19-wator-simulation/#8","title":"8. \u30b3\u30f3\u30d3\u30cd\u30fc\u30bf","text":"<pre><code>object Combinators:\n  /**\n   * \u6761\u4ef6\u304c\u6e80\u305f\u3055\u308c\u308b\u307e\u3067\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u5b9f\u884c\n   */\n  def runUntil(world: World, predicate: World =&gt; Boolean, maxSteps: Int = 1000): (World, Int) =\n    var current = world\n    var steps = 0\n    while steps &lt; maxSteps &amp;&amp; !predicate(current) do\n      current = Simulation.tick(current)\n      steps += 1\n    (current, steps)\n\n  /**\n   * \u7d76\u6ec5\u5224\u5b9a\n   */\n  def isExtinct(world: World): Boolean =\n    val stats = world.statistics\n    stats.fish == 0 || stats.sharks == 0\n\n  /**\n   * \u5b89\u5b9a\u5224\u5b9a\n   */\n  def isStable(world: World, minFish: Int, maxFish: Int, minSharks: Int, maxSharks: Int): Boolean =\n    val stats = world.statistics\n    stats.fish &gt;= minFish &amp;&amp; stats.fish &lt;= maxFish &amp;&amp;\n    stats.sharks &gt;= minSharks &amp;&amp; stats.sharks &lt;= maxSharks\n</code></pre>"},{"location":"scala/19-wator-simulation/#9","title":"9. \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u306e\u30c0\u30a4\u30ca\u30df\u30af\u30b9","text":""},{"location":"scala/19-wator-simulation/#10-clojure","title":"10. Clojure \u3068\u306e\u6bd4\u8f03","text":"\u6a5f\u80fd Clojure Scala \u30bb\u30eb\u5b9a\u7fa9 defmulti/defmethod sealed trait + case class \u591a\u614b\u7684\u30c6\u30a3\u30c3\u30af \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9 \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0 \u30ef\u30fc\u30eb\u30c9\u66f4\u65b0 assoc/update copy \u30e1\u30bd\u30c3\u30c9 \u30e9\u30f3\u30c0\u30e0\u9078\u629e rand-nth random.nextInt \u5ea7\u6a19\u30e9\u30c3\u30d7 mod ((x % w) + w) % w <p>Clojure \u3067\u306f\u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u7570\u306a\u308b\u30bb\u30eb\u30bf\u30a4\u30d7\u306e\u632f\u308b\u821e\u3044\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u304c\u3001Scala \u3067\u306f sealed trait \u3068 case class \u306b\u3088\u308b ADT \u3068\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u3067\u540c\u7b49\u306e\u591a\u614b\u6027\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p> <pre><code>// Scala: \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0\u306b\u3088\u308b\u591a\u614b\u6027\ndef tickCell(cell: Cell, pos: Position, world: World, random: Random): CellUpdate =\n  cell match\n    case Water =&gt; NoChange\n    case fish: Fish =&gt; tickFish(fish, pos, world, random)\n    case shark: Shark =&gt; tickShark(shark, pos, world, random)\n</code></pre> <pre><code>;; Clojure: \u30de\u30eb\u30c1\u30e1\u30bd\u30c3\u30c9\u306b\u3088\u308b\u591a\u614b\u6027\n(defmulti tick (fn [cell loc world] (::type cell)))\n\n(defmethod tick ::water [_water _loc _world] nil)\n(defmethod tick ::fish [fish loc world] ...)\n(defmethod tick ::shark [shark loc world] ...)\n</code></pre>"},{"location":"scala/19-wator-simulation/#11","title":"11. \u95a2\u6570\u578b\u30a2\u30d7\u30ed\u30fc\u30c1\u306e\u7279\u5fb4","text":""},{"location":"scala/19-wator-simulation/#_9","title":"\u4e0d\u5909\u6027","text":"<p>\u3059\u3079\u3066\u306e\u72b6\u614b\u66f4\u65b0\u306f\u65b0\u3057\u3044\u30ef\u30fc\u30eb\u30c9\u3092\u8fd4\u3057\u307e\u3059\u3002</p> <pre><code>// \u5143\u306e\u30ef\u30fc\u30eb\u30c9\u306f\u5909\u66f4\u3055\u308c\u306a\u3044\nval w1 = World(5, 5)\nval w2 = Simulation.tick(w1)\n\n// w1 \u3068 w2 \u306f\u72ec\u7acb\nw1.generation // =&gt; 0\nw2.generation // =&gt; 1\n</code></pre>"},{"location":"scala/19-wator-simulation/#adt_1","title":"ADT \u306b\u3088\u308b\u578b\u5b89\u5168\u6027","text":"<p>sealed trait \u306b\u3088\u308a\u3001\u3059\u3079\u3066\u306e\u30bb\u30eb\u30bf\u30a4\u30d7\u304c\u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u306b\u7db2\u7f85\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u4fdd\u8a3c\u3055\u308c\u307e\u3059\u3002</p> <pre><code>// \u30b3\u30f3\u30d1\u30a4\u30e9\u304c\u7db2\u7f85\u6027\u3092\u30c1\u30a7\u30c3\u30af\ncell match\n  case Water =&gt; ...\n  case fish: Fish =&gt; ...\n  case shark: Shark =&gt; ...\n  // \u3059\u3079\u3066\u306e\u30b1\u30fc\u30b9\u3092\u30ab\u30d0\u30fc\n</code></pre>"},{"location":"scala/19-wator-simulation/#_10","title":"\u30c6\u30b9\u30c8\u5bb9\u6613\u6027","text":"<p>\u7d14\u7c8b\u95a2\u6570\u3067\u3042\u308b\u305f\u3081\u3001\u6c7a\u5b9a\u7684\u306a\u30c6\u30b9\u30c8\u304c\u53ef\u80fd\u3067\u3059\u3002</p> <pre><code>// \u30b7\u30fc\u30c9\u4ed8\u304dRandom\u3067\u6c7a\u5b9a\u7684\u306a\u30c6\u30b9\u30c8\nval random = new Random(42)\nval world = World.populateRandom(World(10, 10), 20, 5, random)\nval result = Simulation.tick(world, new Random(42))\n// \u540c\u3058\u30b7\u30fc\u30c9\u306a\u3089\u540c\u3058\u7d50\u679c\n</code></pre>"},{"location":"scala/19-wator-simulation/#_11","title":"\u307e\u3068\u3081","text":"<p>\u672c\u7ae0\u3067\u306f\u3001Wa-Tor \u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u901a\u3058\u3066\u4ee5\u4e0b\u3092\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u30bb\u30eb\u30aa\u30fc\u30c8\u30de\u30c8\u30f3: \u30b0\u30ea\u30c3\u30c9\u30d9\u30fc\u30b9\u306e\u30b7\u30df\u30e5\u30ec\u30fc\u30b7\u30e7\u30f3</li> <li>ADT: sealed trait \u3068 case class \u306b\u3088\u308b\u578b\u5b89\u5168\u306a\u8a2d\u8a08</li> <li>\u30c8\u30fc\u30e9\u30b9\u578b\u30ef\u30fc\u30eb\u30c9: \u7aef\u306e\u30e9\u30c3\u30d7\u51e6\u7406</li> <li>\u6355\u98df\u8005-\u88ab\u98df\u8005\u30e2\u30c7\u30eb: \u7e41\u6b96\u3001\u6355\u98df\u3001\u9913\u6b7b\u306e\u30eb\u30fc\u30eb</li> <li>\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0: \u591a\u614b\u7684\u306a\u632f\u308b\u821e\u3044\u306e\u5b9f\u73fe</li> <li>\u4e0d\u5909\u30c7\u30fc\u30bf\u69cb\u9020: \u72b6\u614b\u66f4\u65b0\u306e\u660e\u793a\u7684\u306a\u7ba1\u7406</li> </ol>"},{"location":"scala/19-wator-simulation/#_12","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/scala/part6/src/main/scala/WatorSimulation.scala</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/scala/part6/src/test/scala/WatorSimulationSpec.scala</code></li> </ul>"},{"location":"scala/20-pattern-interactions/","title":"\u7b2c20\u7ae0: \u30d1\u30bf\u30fc\u30f3\u9593\u306e\u76f8\u4e92\u4f5c\u7528","text":""},{"location":"scala/20-pattern-interactions/#1","title":"1. \u306f\u3058\u3081\u306b","text":"<p>\u30c7\u30b6\u30a4\u30f3\u30d1\u30bf\u30fc\u30f3\u306f\u5358\u72ec\u3067\u4f7f\u7528\u3055\u308c\u308b\u3053\u3068\u3082\u3042\u308a\u307e\u3059\u304c\u3001\u5b9f\u969b\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3067\u306f\u8907\u6570\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u4e00\u822c\u7684\u3067\u3059\u3002\u672c\u7ae0\u3067\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u304a\u3051\u308b\u30d1\u30bf\u30fc\u30f3\u306e\u7d44\u307f\u5408\u308f\u305b\u65b9\u3068\u3001\u305d\u306e\u76f8\u4e57\u52b9\u679c\u306b\u3064\u3044\u3066\u89e3\u8aac\u3057\u307e\u3059\u3002</p>"},{"location":"scala/20-pattern-interactions/#_1","title":"\u5b66\u7fd2\u76ee\u6a19","text":"<ul> <li>Composite \u3068 Decorator \u30d1\u30bf\u30fc\u30f3\u306e\u7d44\u307f\u5408\u308f\u305b\u3092\u7406\u89e3\u3059\u308b</li> <li>Command \u3068 Observer \u30d1\u30bf\u30fc\u30f3\u306e\u9023\u643a\u3092\u5b9f\u88c5\u3059\u308b</li> <li>\u8907\u5408\u7684\u306a\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08\u306e\u30a2\u30d7\u30ed\u30fc\u30c1\u3092\u5b66\u3076</li> </ul>"},{"location":"scala/20-pattern-interactions/#2-composite-decorator","title":"2. Composite + Decorator \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"scala/20-pattern-interactions/#21","title":"2.1 \u57fa\u672c\u6982\u5ff5","text":"<p>Composite \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u6728\u69cb\u9020\u3067\u8868\u73fe\u3057\u3001\u500b\u5225\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u8907\u5408\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u540c\u4e00\u8996\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002</p> <p>Decorator \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u52d5\u7684\u306b\u6a5f\u80fd\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002</p> <p>\u3053\u308c\u3089\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u3053\u3068\u3067\u3001\u8907\u5408\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u5bfe\u3057\u3066\u3082\u88c5\u98fe\u3092\u9069\u7528\u3067\u304d\u307e\u3059\u3002</p> <p></p>"},{"location":"scala/20-pattern-interactions/#22","title":"2.2 \u57fa\u672c\u56f3\u5f62\u306e\u5b9f\u88c5","text":"<pre><code>/**\n * \u56f3\u5f62\u306e\u57fa\u5e95trait\n */\ntrait Shape:\n  def move(dx: Double, dy: Double): Shape\n  def scale(factor: Double): Shape\n  def area: Double\n  def draw: String\n\ncase class Circle(x: Double, y: Double, radius: Double) extends Shape:\n  def move(dx: Double, dy: Double): Circle = copy(x = x + dx, y = y + dy)\n  def scale(factor: Double): Circle = copy(radius = radius * factor)\n  def area: Double = Math.PI * radius * radius\n  def draw: String = s\"Circle(x=$x, y=$y, r=$radius)\"\n\ncase class Rectangle(x: Double, y: Double, width: Double, height: Double) extends Shape:\n  def move(dx: Double, dy: Double): Rectangle = copy(x = x + dx, y = y + dy)\n  def scale(factor: Double): Rectangle = copy(width = width * factor, height = height * factor)\n  def area: Double = width * height\n  def draw: String = s\"Rectangle(x=$x, y=$y, w=$width, h=$height)\"\n</code></pre>"},{"location":"scala/20-pattern-interactions/#23-composite","title":"2.3 Composite \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5","text":"<pre><code>case class CompositeShape(shapes: Vector[Shape] = Vector.empty) extends Shape:\n  def add(shape: Shape): CompositeShape = copy(shapes = shapes :+ shape)\n  def remove(shape: Shape): CompositeShape = copy(shapes = shapes.filterNot(_ == shape))\n\n  def move(dx: Double, dy: Double): CompositeShape =\n    copy(shapes = shapes.map(_.move(dx, dy)))\n\n  def scale(factor: Double): CompositeShape =\n    copy(shapes = shapes.map(_.scale(factor)))\n\n  def area: Double = shapes.map(_.area).sum\n\n  def draw: String =\n    s\"Composite[\\n  ${shapes.map(_.draw).mkString(\"\\n  \")}\\n]\"\n</code></pre>"},{"location":"scala/20-pattern-interactions/#24-decorator","title":"2.4 Decorator \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5","text":"<pre><code>case class JournalEntry(operation: String, timestamp: Long = System.currentTimeMillis())\n\ncase class JournaledShape(shape: Shape, journal: Vector[JournalEntry] = Vector.empty) extends Shape:\n  def move(dx: Double, dy: Double): JournaledShape =\n    copy(\n      shape = shape.move(dx, dy),\n      journal = journal :+ JournalEntry(s\"move($dx, $dy)\")\n    )\n\n  def scale(factor: Double): JournaledShape =\n    copy(\n      shape = shape.scale(factor),\n      journal = journal :+ JournalEntry(s\"scale($factor)\")\n    )\n\n  def area: Double = shape.area\n  def draw: String = s\"[Journaled: ${journal.size} ops] ${shape.draw}\"\n  def getJournal: Vector[JournalEntry] = journal\n\ncase class ColoredShape(shape: Shape, color: String) extends Shape:\n  def move(dx: Double, dy: Double): ColoredShape = copy(shape = shape.move(dx, dy))\n  def scale(factor: Double): ColoredShape = copy(shape = shape.scale(factor))\n  def area: Double = shape.area\n  def draw: String = s\"[$color] ${shape.draw}\"\n\ncase class BorderedShape(shape: Shape, borderWidth: Int) extends Shape:\n  def move(dx: Double, dy: Double): BorderedShape = copy(shape = shape.move(dx, dy))\n  def scale(factor: Double): BorderedShape = copy(shape = shape.scale(factor))\n  def area: Double = shape.area\n  def draw: String = s\"[Border: ${borderWidth}px] ${shape.draw}\"\n</code></pre>"},{"location":"scala/20-pattern-interactions/#25","title":"2.5 \u7d44\u307f\u5408\u308f\u305b\u306e\u4f8b","text":"<pre><code>// Composite \u306b Decorator \u3092\u9069\u7528\nval composite = CompositeShape(Circle(0, 0, 10), Rectangle(0, 0, 10, 20))\nval journaled = JournaledShape(composite)\nval afterMove = journaled.move(5, 3)\nafterMove.getJournal.length // =&gt; 1\n\n// Decorated \u306a\u56f3\u5f62\u3092 Composite \u306b\u542b\u3081\u308b\nval coloredCircle = ColoredShape(Circle(0, 0, 10), \"red\")\nval borderedRect = BorderedShape(Rectangle(0, 0, 10, 20), 2)\nval comp = CompositeShape(coloredCircle, borderedRect)\ncomp.draw\n// =&gt; Composite[\n//      [red] Circle...\n//      [Border: 2px] Rectangle...\n//    ]\n\n// \u591a\u91cd\u30c7\u30b3\u30ec\u30fc\u30bf\nval decorated = JournaledShape(\n  BorderedShape(\n    ColoredShape(Circle(0, 0, 10), \"blue\"),\n    3\n  )\n)\ndecorated.draw // =&gt; [Journaled: 0 ops] [Border: 3px] [blue] Circle...\n</code></pre>"},{"location":"scala/20-pattern-interactions/#3-command-observer","title":"3. Command + Observer \u30d1\u30bf\u30fc\u30f3","text":""},{"location":"scala/20-pattern-interactions/#31","title":"3.1 \u57fa\u672c\u6982\u5ff5","text":"<p>Command \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u64cd\u4f5c\u3092\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u3057\u3066\u30ab\u30d7\u30bb\u30eb\u5316\u3057\u3001Undo/Redo \u3092\u53ef\u80fd\u306b\u3057\u307e\u3059\u3002</p> <p>Observer \u30d1\u30bf\u30fc\u30f3\u306f\u3001\u72b6\u614b\u306e\u5909\u66f4\u3092\u76e3\u8996\u8005\u306b\u901a\u77e5\u3057\u307e\u3059\u3002</p> <p>\u3053\u308c\u3089\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u3053\u3068\u3067\u3001\u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u6642\u306b\u81ea\u52d5\u7684\u306b\u901a\u77e5\u3092\u884c\u3046\u30b7\u30b9\u30c6\u30e0\u3092\u69cb\u7bc9\u3067\u304d\u307e\u3059\u3002</p> <p></p>"},{"location":"scala/20-pattern-interactions/#32-observer","title":"3.2 Observer \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5","text":"<pre><code>sealed trait Event\ncase class CommandExecuted(command: Command, description: String) extends Event\ncase class CommandUndone(command: Command) extends Event\ncase class CommandRedone(command: Command) extends Event\n\ntype Observer = Event =&gt; Unit\n\nclass Subject:\n  private val observers = ListBuffer.empty[Observer]\n\n  def addObserver(observer: Observer): Unit =\n    observers += observer\n\n  def removeObserver(observer: Observer): Unit =\n    observers -= observer\n\n  def notifyObservers(event: Event): Unit =\n    observers.foreach(_(event))\n</code></pre>"},{"location":"scala/20-pattern-interactions/#33-command","title":"3.3 Command \u30d1\u30bf\u30fc\u30f3\u306e\u5b9f\u88c5","text":"<pre><code>trait Command:\n  def execute(canvas: Canvas): Canvas\n  def undo(canvas: Canvas): Canvas\n  def describe: String\n\ncase class AddShapeCommand(shape: Shape) extends Command:\n  def execute(canvas: Canvas): Canvas = canvas.addShape(shape)\n  def undo(canvas: Canvas): Canvas = canvas.removeShape(canvas.shapes.length - 1)\n  def describe: String = s\"Add shape: ${shape.draw}\"\n\ncase class MoveShapeCommand(index: Int, dx: Double, dy: Double) extends Command:\n  def execute(canvas: Canvas): Canvas =\n    canvas.getShape(index) match\n      case Some(shape) =&gt; canvas.updateShape(index, shape.move(dx, dy))\n      case None =&gt; canvas\n  def undo(canvas: Canvas): Canvas =\n    canvas.getShape(index) match\n      case Some(shape) =&gt; canvas.updateShape(index, shape.move(-dx, -dy))\n      case None =&gt; canvas\n  def describe: String = s\"Move shape[$index] by ($dx, $dy)\"\n\ncase class MacroCommand(commands: Vector[Command]) extends Command:\n  def execute(canvas: Canvas): Canvas =\n    commands.foldLeft(canvas)((c, cmd) =&gt; cmd.execute(c))\n  def undo(canvas: Canvas): Canvas =\n    commands.reverse.foldLeft(canvas)((c, cmd) =&gt; cmd.undo(c))\n  def describe: String = s\"Macro[${commands.map(_.describe).mkString(\", \")}]\"\n</code></pre>"},{"location":"scala/20-pattern-interactions/#34-command-observer","title":"3.4 Command + Observer \u306e\u7d71\u5408","text":"<pre><code>class ObservableCanvas:\n  private var canvas: Canvas = Canvas()\n  private var history: Vector[Command] = Vector.empty\n  private var redoStack: Vector[Command] = Vector.empty\n  val subject: Subject = new Subject\n\n  def executeCommand(command: Command): Unit =\n    canvas = command.execute(canvas)\n    history = history :+ command\n    redoStack = Vector.empty\n    subject.notifyObservers(CommandExecuted(command, command.describe))\n\n  def undoLast(): Boolean =\n    if history.isEmpty then false\n    else\n      val lastCommand = history.last\n      canvas = lastCommand.undo(canvas)\n      history = history.init\n      redoStack = redoStack :+ lastCommand\n      subject.notifyObservers(CommandUndone(lastCommand))\n      true\n\n  def redoLast(): Boolean =\n    if redoStack.isEmpty then false\n    else\n      val command = redoStack.last\n      canvas = command.execute(canvas)\n      redoStack = redoStack.init\n      history = history :+ command\n      subject.notifyObservers(CommandRedone(command))\n      true\n</code></pre>"},{"location":"scala/20-pattern-interactions/#35","title":"3.5 \u4f7f\u7528\u4f8b","text":"<pre><code>// \u30ad\u30e3\u30f3\u30d0\u30b9\u3092\u4f5c\u6210\nval obsCanvas = new ObservableCanvas\n\n// \u30ed\u30b0\u30aa\u30d6\u30b6\u30fc\u30d0\u30fc\u3092\u767b\u9332\nval logObserver = new LogObserver\nobsCanvas.subject.addObserver(logObserver.observer)\n\n// \u30b3\u30de\u30f3\u30c9\u3092\u5b9f\u884c\nobsCanvas.executeCommand(AddShapeCommand(Circle(0, 0, 10)))\nobsCanvas.executeCommand(MoveShapeCommand(0, 5, 3))\n\nlogObserver.getLogs\n// =&gt; List(\n//      \"Executed: Add shape: Circle...\",\n//      \"Executed: Move shape[0] by (5.0, 3.0)\"\n//    )\n\n// Undo\nobsCanvas.undoLast()\nlogObserver.getLogs\n// =&gt; List(..., \"Undone: Move shape[0] by (5.0, 3.0)\")\n\n// Redo\nobsCanvas.redoLast()\n</code></pre>"},{"location":"scala/20-pattern-interactions/#4-strategy","title":"4. Strategy \u30d1\u30bf\u30fc\u30f3\u3068\u306e\u7d44\u307f\u5408\u308f\u305b","text":"<pre><code>trait RenderStrategy:\n  def render(canvas: Canvas): String\n\nobject TextRenderStrategy extends RenderStrategy:\n  def render(canvas: Canvas): String =\n    canvas.shapes.zipWithIndex.map { case (shape, i) =&gt;\n      s\"[$i] ${shape.draw}\"\n    }.mkString(\"\\n\")\n\nobject JsonRenderStrategy extends RenderStrategy:\n  def render(canvas: Canvas): String =\n    val shapesJson = canvas.shapes.map(shapeToJson).mkString(\",\\n  \")\n    s\"{\\n  \\\"shapes\\\": [\\n  $shapesJson\\n  ]\\n}\"\n\nobject SvgRenderStrategy extends RenderStrategy:\n  def render(canvas: Canvas): String =\n    val shapeSvg = canvas.shapes.map(shapeToSvg).mkString(\"\\n  \")\n    s\"\"\"&lt;svg xmlns=\"http://www.w3.org/2000/svg\"&gt;\n  $shapeSvg\n&lt;/svg&gt;\"\"\"\n</code></pre>"},{"location":"scala/20-pattern-interactions/#5-factory","title":"5. Factory \u30d1\u30bf\u30fc\u30f3\u3068\u306e\u7d44\u307f\u5408\u308f\u305b","text":"<pre><code>trait ShapeFactory:\n  def createCircle(x: Double, y: Double, radius: Double): Shape\n  def createRectangle(x: Double, y: Double, width: Double, height: Double): Shape\n\nobject SimpleShapeFactory extends ShapeFactory:\n  def createCircle(x: Double, y: Double, radius: Double): Shape = Circle(x, y, radius)\n  def createRectangle(x: Double, y: Double, width: Double, height: Double): Shape = Rectangle(x, y, width, height)\n\nclass ColoredShapeFactory(color: String) extends ShapeFactory:\n  def createCircle(x: Double, y: Double, radius: Double): Shape =\n    ColoredShape(Circle(x, y, radius), color)\n  def createRectangle(x: Double, y: Double, width: Double, height: Double): Shape =\n    ColoredShape(Rectangle(x, y, width, height), color)\n</code></pre>"},{"location":"scala/20-pattern-interactions/#6-visitor","title":"6. Visitor \u30d1\u30bf\u30fc\u30f3\u3068\u306e\u7d44\u307f\u5408\u308f\u305b","text":"<pre><code>trait ShapeVisitor[T]:\n  def visitCircle(circle: Circle): T\n  def visitRectangle(rectangle: Rectangle): T\n  def visitComposite(composite: CompositeShape): T\n  def visitColored(colored: ColoredShape): T\n  def visitBordered(bordered: BorderedShape): T\n  def visitJournaled(journaled: JournaledShape): T\n\nobject AreaVisitor extends ShapeVisitor[Double]:\n  def visitCircle(c: Circle): Double = c.area\n  def visitRectangle(r: Rectangle): Double = r.area\n  def visitComposite(comp: CompositeShape): Double =\n    comp.shapes.map(s =&gt; ShapeVisitor.visit(s, this)).sum\n  def visitColored(col: ColoredShape): Double = ShapeVisitor.visit(col.shape, this)\n  // ...\n\ncase class BoundingBox(minX: Double, minY: Double, maxX: Double, maxY: Double):\n  def merge(other: BoundingBox): BoundingBox =\n    BoundingBox(\n      math.min(minX, other.minX),\n      math.min(minY, other.minY),\n      math.max(maxX, other.maxX),\n      math.max(maxY, other.maxY)\n    )\n</code></pre>"},{"location":"scala/20-pattern-interactions/#7","title":"7. \u30d1\u30bf\u30fc\u30f3\u9078\u629e\u306e\u30ac\u30a4\u30c9\u30e9\u30a4\u30f3","text":""},{"location":"scala/20-pattern-interactions/#8","title":"8. \u30d1\u30bf\u30fc\u30f3\u7d44\u307f\u5408\u308f\u305b\u306e\u30de\u30c8\u30ea\u30af\u30b9","text":"\u30d1\u30bf\u30fc\u30f3 A \u30d1\u30bf\u30fc\u30f3 B \u76f8\u4e57\u52b9\u679c Composite Decorator \u8907\u5408\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u5168\u4f53\u306b\u88c5\u98fe\u3092\u9069\u7528 Composite Visitor \u6728\u69cb\u9020\u3092\u8d70\u67fb\u3057\u3066\u5404\u8981\u7d20\u306b\u64cd\u4f5c\u3092\u9069\u7528 Command Observer \u30b3\u30de\u30f3\u30c9\u5b9f\u884c\u3092\u76e3\u8996\u30fb\u30ed\u30b0 Command Composite \u30de\u30af\u30ed\u30b3\u30de\u30f3\u30c9\u306e\u5b9f\u73fe Strategy Decorator \u6226\u7565\u306b\u30ad\u30e3\u30c3\u30b7\u30e5\u30fb\u30ed\u30b0\u3092\u8ffd\u52a0 Factory Strategy \u751f\u6210\u6226\u7565\u306e\u5207\u308a\u66ff\u3048"},{"location":"scala/20-pattern-interactions/#9-dsl","title":"9. DSL","text":"<pre><code>object DSL:\n  def circle(x: Double, y: Double, radius: Double): Circle = Circle(x, y, radius)\n  def rectangle(x: Double, y: Double, width: Double, height: Double): Rectangle = Rectangle(x, y, width, height)\n  def composite(shapes: Shape*): CompositeShape = CompositeShape(shapes.toVector)\n\n  extension (shape: Shape)\n    def withColor(color: String): ColoredShape = ColoredShape(shape, color)\n    def withBorder(width: Int): BorderedShape = BorderedShape(shape, width)\n    def withJournal: JournaledShape = JournaledShape(shape)\n\n// \u4f7f\u7528\u4f8b\nimport DSL.*\n\nval decorated = circle(0, 0, 10)\n  .withColor(\"red\")\n  .withBorder(3)\n  .withJournal\n</code></pre>"},{"location":"scala/20-pattern-interactions/#_2","title":"\u307e\u3068\u3081","text":""},{"location":"scala/20-pattern-interactions/#_3","title":"\u30d1\u30bf\u30fc\u30f3\u7d44\u307f\u5408\u308f\u305b\u306e\u539f\u5247","text":"<ol> <li>\u5358\u4e00\u8cac\u4efb\u3092\u7dad\u6301: \u5404\u30d1\u30bf\u30fc\u30f3\u306f\u72ec\u81ea\u306e\u8cac\u4efb\u3092\u6301\u3064</li> <li>\u758e\u7d50\u5408\u3092\u4fdd\u3064: \u30d1\u30bf\u30fc\u30f3\u9593\u306f\u660e\u78ba\u306a\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3067\u9023\u643a</li> <li>\u30c7\u30fc\u30bf\u4e2d\u5fc3: \u30d1\u30bf\u30fc\u30f3\u9593\u306e\u3084\u308a\u53d6\u308a\u306f\u30c7\u30fc\u30bf\u3067\u884c\u3046</li> <li>\u30c6\u30b9\u30c8\u53ef\u80fd\u6027: \u7d44\u307f\u5408\u308f\u305b\u3066\u3082\u500b\u5225\u306b\u30c6\u30b9\u30c8\u53ef\u80fd</li> </ol>"},{"location":"scala/20-pattern-interactions/#scala","title":"Scala \u3067\u306e\u5229\u70b9","text":"<ul> <li>case class \u306b\u3088\u308b\u4e0d\u5909\u6027: \u72b6\u614b\u306e\u8ffd\u8de1\u304c\u5bb9\u6613</li> <li>\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u30f3\u30b0: Visitor \u30d1\u30bf\u30fc\u30f3\u306e\u7c21\u6f54\u306a\u5b9f\u88c5</li> <li>extension methods: DSL \u306e\u69cb\u7bc9\u304c\u5bb9\u6613</li> <li>\u578b\u5b89\u5168\u6027: \u30b3\u30f3\u30d1\u30a4\u30eb\u6642\u306b\u30a8\u30e9\u30fc\u3092\u691c\u51fa</li> </ul>"},{"location":"scala/20-pattern-interactions/#_4","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/scala/part7/src/main/scala/PatternInteractions.scala</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/scala/part7/src/test/scala/PatternInteractionsSpec.scala</code></li> </ul>"},{"location":"scala/21-best-practices/","title":"\u7b2c21\u7ae0: \u95a2\u6570\u578b\u30c7\u30b6\u30a4\u30f3\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9","text":""},{"location":"scala/21-best-practices/#1","title":"1. \u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u304a\u3051\u308b\u8a2d\u8a08\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3092\u4f53\u7cfb\u7684\u306b\u89e3\u8aac\u3057\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u539f\u5247\u306f\u3001\u4fdd\u5b88\u6027\u304c\u9ad8\u304f\u3001\u30c6\u30b9\u30c8\u3057\u3084\u3059\u3044\u3001\u5805\u7262\u306a\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u69cb\u7bc9\u3059\u308b\u305f\u3081\u306e\u6307\u91dd\u3068\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"scala/21-best-practices/#_1","title":"\u5b66\u7fd2\u76ee\u6a19","text":"<ul> <li>\u30c7\u30fc\u30bf\u4e2d\u5fc3\u8a2d\u8a08\u306e\u539f\u5247\u3092\u7406\u89e3\u3059\u308b</li> <li>\u7d14\u7c8b\u95a2\u6570\u3068\u526f\u4f5c\u7528\u306e\u5206\u96e2\u65b9\u6cd5\u3092\u5b66\u3076</li> <li>\u30c6\u30b9\u30c8\u53ef\u80fd\u306a\u8a2d\u8a08\u30d1\u30bf\u30fc\u30f3\u3092\u7fd2\u5f97\u3059\u308b</li> </ul>"},{"location":"scala/21-best-practices/#2","title":"2. \u30c7\u30fc\u30bf\u4e2d\u5fc3\u8a2d\u8a08","text":""},{"location":"scala/21-best-practices/#21_1","title":"2.1 \u57fa\u672c\u539f\u5247","text":"<p>\u95a2\u6570\u578b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3067\u306f\u3001\u30c7\u30fc\u30bf\u304c\u4e3b\u5f79\u3067\u3059\u3002\u307e\u305a\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u8a2d\u8a08\u3057\u3001\u305d\u306e\u30c7\u30fc\u30bf\u3092\u5909\u63db\u3059\u308b\u95a2\u6570\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002</p> <p></p>"},{"location":"scala/21-best-practices/#22","title":"2.2 \u30c7\u30fc\u30bf\u69cb\u9020\u306e\u5b9a\u7fa9","text":"<pre><code>// \u30b7\u30f3\u30d7\u30eb\u306a case class \u3067\u30c7\u30fc\u30bf\u3092\u8868\u73fe\ncase class User(\n  id: String,\n  name: String,\n  email: String,\n  createdAt: Long = System.currentTimeMillis()\n)\n\ncase class OrderItem(\n  productId: String,\n  quantity: Int,\n  price: BigDecimal\n)\n\ncase class Order(\n  id: String,\n  userId: String,\n  items: Vector[OrderItem],\n  status: OrderStatus = OrderStatus.Pending,\n  createdAt: Long = System.currentTimeMillis()\n)\n\nenum OrderStatus:\n  case Pending, Processing, Completed, Cancelled\n</code></pre> <p>\u30dd\u30a4\u30f3\u30c8: - case class \u3092\u4f7f\u7528\uff08\u4e0d\u5909\u6027\u3092\u4fdd\u8a3c\uff09 - \u5fc5\u8981\u6700\u5c0f\u9650\u306e\u30d5\u30a3\u30fc\u30eb\u30c9 - \u660e\u78ba\u306a\u547d\u540d</p>"},{"location":"scala/21-best-practices/#23","title":"2.3 \u5c0f\u3055\u306a\u7d14\u7c8b\u95a2\u6570","text":"<pre><code>object OrderCalculations:\n  // \u5404\u95a2\u6570\u306f\u5358\u4e00\u306e\u8cac\u4efb\u3092\u6301\u3064\n  def calculateItemTotal(item: OrderItem): BigDecimal =\n    item.price * item.quantity\n\n  def calculateOrderTotal(order: Order): BigDecimal =\n    order.items.map(calculateItemTotal).sum\n\n  def applyDiscount(total: BigDecimal, discountRate: BigDecimal): BigDecimal =\n    total * (1 - discountRate)\n\n  def applyTax(total: BigDecimal, taxRate: BigDecimal): BigDecimal =\n    total * (1 + taxRate)\n</code></pre> <p>\u539f\u5247: - 1\u3064\u306e\u95a2\u6570\u306f1\u3064\u306e\u3053\u3068\u3092\u884c\u3046 - \u5165\u529b\u304b\u3089\u51fa\u529b\u3078\u306e\u7d14\u7c8b\u306a\u5909\u63db - \u526f\u4f5c\u7528\u306a\u3057</p>"},{"location":"scala/21-best-practices/#24","title":"2.4 \u30c7\u30fc\u30bf\u5909\u63db\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3","text":"<pre><code>def processOrder(\n  order: Order,\n  discountRate: BigDecimal,\n  taxRate: BigDecimal\n): ProcessedOrder =\n  val subtotal = calculateOrderTotal(order)\n  val discountedSubtotal = applyDiscount(subtotal, discountRate)\n  val discount = subtotal - discountedSubtotal\n  val tax = discountedSubtotal * taxRate\n  val total = discountedSubtotal + tax\n\n  ProcessedOrder(\n    order = order.copy(status = OrderStatus.Processing),\n    subtotal = subtotal,\n    discount = discount,\n    tax = tax,\n    total = total\n  )\n</code></pre>"},{"location":"scala/21-best-practices/#3","title":"3. \u30c7\u30fc\u30bf\u691c\u8a3c","text":""},{"location":"scala/21-best-practices/#31","title":"3.1 \u691c\u8a3c\u7d50\u679c\u306e\u578b","text":"<pre><code>sealed trait ValidationResult[+A]:\n  def isValid: Boolean\n  def map[B](f: A =&gt; B): ValidationResult[B]\n  def flatMap[B](f: A =&gt; ValidationResult[B]): ValidationResult[B]\n\ncase class Valid[A](value: A) extends ValidationResult[A]:\n  def isValid: Boolean = true\n  def map[B](f: A =&gt; B): ValidationResult[B] = Valid(f(value))\n  def flatMap[B](f: A =&gt; ValidationResult[B]): ValidationResult[B] = f(value)\n\ncase class Invalid(errors: Vector[String]) extends ValidationResult[Nothing]:\n  def isValid: Boolean = false\n  def map[B](f: Nothing =&gt; B): ValidationResult[B] = this\n  def flatMap[B](f: Nothing =&gt; ValidationResult[B]): ValidationResult[B] = this\n</code></pre>"},{"location":"scala/21-best-practices/#32","title":"3.2 \u691c\u8a3c\u95a2\u6570","text":"<pre><code>object Validation:\n  def validEmail(email: String): Boolean =\n    email.matches(\"^[^@]+@[^@]+\\\\.[^@]+$\")\n\n  def validateUser(user: User): ValidationResult[User] =\n    val errors = Vector.newBuilder[String]\n\n    if !nonEmpty(user.name) then\n      errors += \"Name is required\"\n    if !validEmail(user.email) then\n      errors += \"Invalid email format\"\n\n    val errs = errors.result()\n    if errs.isEmpty then Valid(user) else Invalid(errs)\n</code></pre>"},{"location":"scala/21-best-practices/#4","title":"4. \u30a4\u30df\u30e5\u30fc\u30bf\u30d6\u30eb\u306a\u66f4\u65b0","text":"<pre><code>object ImmutableUpdates:\n  def updateUserEmail(user: User, newEmail: String): Either[String, User] =\n    if Validation.validEmail(newEmail) then\n      Right(user.copy(email = newEmail))\n    else\n      Left(\"Invalid email format\")\n\n  def cancelOrder(order: Order): Either[String, Order] =\n    if order.status == OrderStatus.Pending then\n      Right(order.copy(status = OrderStatus.Cancelled))\n    else\n      Left(\"Only pending orders can be cancelled\")\n</code></pre> <p>\u30a4\u30df\u30e5\u30fc\u30bf\u30d3\u30ea\u30c6\u30a3\u306e\u5229\u70b9: - \u5143\u306e\u30c7\u30fc\u30bf\u306f\u5909\u66f4\u3055\u308c\u306a\u3044 - \u5c65\u6b74\u306e\u8ffd\u8de1\u304c\u5bb9\u6613 - \u4e26\u884c\u51e6\u7406\u304c\u5b89\u5168</p>"},{"location":"scala/21-best-practices/#5","title":"5. \u7d14\u7c8b\u95a2\u6570\u3068\u526f\u4f5c\u7528\u306e\u5206\u96e2","text":""},{"location":"scala/21-best-practices/#51-io","title":"5.1 IO \u30e2\u30ca\u30c9","text":"<pre><code>sealed trait IO[+A]:\n  def map[B](f: A =&gt; B): IO[B] = IO.Map(this, f)\n  def flatMap[B](f: A =&gt; IO[B]): IO[B] = IO.FlatMap(this, f)\n  def run(): A\n\nobject IO:\n  case class Pure[A](value: A) extends IO[A]:\n    def run(): A = value\n\n  case class Suspend[A](thunk: () =&gt; A) extends IO[A]:\n    def run(): A = thunk()\n\n  def pure[A](a: A): IO[A] = Pure(a)\n  def suspend[A](thunk: =&gt; A): IO[A] = Suspend(() =&gt; thunk)\n</code></pre>"},{"location":"scala/21-best-practices/#6","title":"6. \u9ad8\u968e\u95a2\u6570\u306b\u3088\u308b\u30c7\u30b3\u30ec\u30fc\u30b7\u30e7\u30f3","text":"<pre><code>object FunctionDecorators:\n  // \u30ed\u30ae\u30f3\u30b0\u30c7\u30b3\u30ec\u30fc\u30bf\n  def withLogging[A, B](f: A =&gt; B, logger: String =&gt; Unit): A =&gt; B =\n    (a: A) =&gt;\n      logger(s\"Input: $a\")\n      val result = f(a)\n      logger(s\"Output: $result\")\n      result\n\n  // \u30ea\u30c8\u30e9\u30a4\u30c7\u30b3\u30ec\u30fc\u30bf\n  def withRetry[A, B](f: A =&gt; B, maxRetries: Int): A =&gt; Try[B] =\n    (a: A) =&gt;\n      def attempt(remaining: Int): Try[B] =\n        Try(f(a)) match\n          case success @ Success(_) =&gt; success\n          case Failure(_) if remaining &gt; 0 =&gt; attempt(remaining - 1)\n          case failure =&gt; failure\n      attempt(maxRetries)\n\n  // \u30ad\u30e3\u30c3\u30b7\u30e5\u30c7\u30b3\u30ec\u30fc\u30bf\n  def withCache[A, B](f: A =&gt; B): A =&gt; B =\n    val cache = scala.collection.mutable.Map.empty[A, B]\n    (a: A) =&gt; cache.getOrElseUpdate(a, f(a))\n</code></pre>"},{"location":"scala/21-best-practices/#7","title":"7. \u95a2\u6570\u5408\u6210","text":"<pre><code>object FunctionComposition:\n  // \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u5f62\u5f0f\u306e\u95a2\u6570\u5408\u6210\n  def pipeline[A](fns: (A =&gt; A)*): A =&gt; A =\n    fns.reduce((f, g) =&gt; x =&gt; g(f(x)))\n\n  // \u6761\u4ef6\u4ed8\u304d\u95a2\u6570\u9069\u7528\n  def when[A](condition: Boolean)(f: A =&gt; A): A =&gt; A =\n    if condition then f else identity\n\n  // \u7e70\u308a\u8fd4\u3057\u9069\u7528\n  def repeat[A](n: Int)(f: A =&gt; A): A =&gt; A =\n    if n &lt;= 0 then identity\n    else pipeline((1 to n).map(_ =&gt; f): _*)\n\n// \u4f7f\u7528\u4f8b\nval process = pipeline[Int](_ + 1, _ * 2, _ - 3)\nprocess(5)  // =&gt; (5+1)*2-3 = 9\n</code></pre>"},{"location":"scala/21-best-practices/#8-","title":"8. \u30c6\u30b9\u30c8\u53ef\u80fd\u306a\u8a2d\u8a08 - \u4f9d\u5b58\u6027\u6ce8\u5165","text":"<pre><code>// \u30ea\u30dd\u30b8\u30c8\u30ea\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\ntrait Repository[T, ID]:\n  def findById(id: ID): Option[T]\n  def findAll(): Vector[T]\n  def save(entity: T): T\n  def delete(id: ID): Boolean\n\n// \u30a4\u30f3\u30e1\u30e2\u30ea\u30ea\u30dd\u30b8\u30c8\u30ea\uff08\u30c6\u30b9\u30c8\u7528\uff09\nclass InMemoryRepository[T, ID](idExtractor: T =&gt; ID) extends Repository[T, ID]:\n  private var data = Vector.empty[T]\n\n  def findById(id: ID): Option[T] =\n    data.find(e =&gt; idExtractor(e) == id)\n\n  def save(entity: T): T =\n    data = data.filterNot(e =&gt; idExtractor(e) == idExtractor(entity)) :+ entity\n    entity\n</code></pre>"},{"location":"scala/21-best-practices/#9-","title":"9. \u30c6\u30b9\u30c8\u53ef\u80fd\u306a\u8a2d\u8a08 - \u6642\u9593\u306e\u62bd\u8c61\u5316","text":"<pre><code>// \u6642\u9593\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\ntrait Clock:\n  def now(): Long\n\nobject SystemClock extends Clock:\n  def now(): Long = System.currentTimeMillis()\n\nclass FixedClock(time: Long) extends Clock:\n  def now(): Long = time\n\n// ID\u751f\u6210\u5668\ntrait IdGenerator:\n  def generate(): String\n\nclass SequentialIdGenerator(prefix: String = \"id\") extends IdGenerator:\n  private var counter = 0\n  def generate(): String =\n    counter += 1\n    s\"$prefix-$counter\"\n</code></pre>"},{"location":"scala/21-best-practices/#10-","title":"10. \u30c6\u30b9\u30c8\u53ef\u80fd\u306a\u8a2d\u8a08 - \u8a2d\u5b9a\u306e\u5206\u96e2","text":"<pre><code>case class PricingConfig(\n  taxRate: BigDecimal = BigDecimal(\"0.1\"),\n  discountRate: BigDecimal = BigDecimal(\"0.0\"),\n  currency: String = \"JPY\"\n)\n\nobject Pricing:\n  def calculatePrice(config: PricingConfig, basePrice: BigDecimal): PriceBreakdown =\n    val discounted = basePrice * (1 - config.discountRate)\n    val tax = discounted * config.taxRate\n    val total = discounted + tax\n\n    PriceBreakdown(\n      basePrice = basePrice,\n      discountedPrice = discounted,\n      tax = tax,\n      total = total,\n      currency = config.currency\n    )\n</code></pre>"},{"location":"scala/21-best-practices/#11","title":"11. \u30b5\u30fc\u30d3\u30b9\u5c64\u306e\u8a2d\u8a08","text":"<pre><code>class UserService(\n  repository: Repository[User, String],\n  clock: Clock,\n  idGenerator: IdGenerator\n):\n  def createUser(name: String, email: String): Either[Vector[String], User] =\n    val user = User(\n      id = idGenerator.generate(),\n      name = name,\n      email = email,\n      createdAt = clock.now()\n    )\n\n    Validation.validateUser(user) match\n      case Valid(u) =&gt; Right(repository.save(u))\n      case Invalid(errors) =&gt; Left(errors)\n</code></pre>"},{"location":"scala/21-best-practices/#12-dsl","title":"12. DSL","text":"<pre><code>object DSL:\n  def user(name: String, email: String)(using clock: Clock, idGen: IdGenerator): User =\n    User(idGen.generate(), name, email, clock.now())\n\n  def order(userId: String, items: OrderItem*)(using clock: Clock, idGen: IdGenerator): Order =\n    Order(idGen.generate(), userId, items.toVector, createdAt = clock.now())\n\n  extension (order: Order)\n    def withItem(item: OrderItem): Order = order.copy(items = order.items :+ item)\n    def process(discountRate: BigDecimal, taxRate: BigDecimal): ProcessedOrder =\n      OrderProcessing.processOrder(order, discountRate, taxRate)\n\n// \u4f7f\u7528\u4f8b\ngiven Clock = new FixedClock(1000)\ngiven IdGenerator = new SequentialIdGenerator(\"u\")\n\nimport DSL.*\nval u = user(\"John\", \"john@example.com\")\n</code></pre>"},{"location":"scala/21-best-practices/#13-result","title":"13. Result \u578b","text":"<pre><code>enum Result[+E, +A]:\n  case Success(value: A)\n  case Failure(error: E)\n\n  def map[B](f: A =&gt; B): Result[E, B] = this match\n    case Success(a) =&gt; Success(f(a))\n    case Failure(e) =&gt; Failure(e)\n\n  def flatMap[E2 &gt;: E, B](f: A =&gt; Result[E2, B]): Result[E2, B] = this match\n    case Success(a) =&gt; f(a)\n    case Failure(e) =&gt; Failure(e)\n\nobject Result:\n  def fromOption[A](opt: Option[A], ifNone: =&gt; String): Result[String, A] =\n    opt match\n      case Some(a) =&gt; Success(a)\n      case None =&gt; Failure(ifNone)\n\n  def fromEither[E, A](either: Either[E, A]): Result[E, A] =\n    either match\n      case Right(a) =&gt; Success(a)\n      case Left(e) =&gt; Failure(e)\n</code></pre>"},{"location":"scala/21-best-practices/#_2","title":"\u307e\u3068\u3081","text":""},{"location":"scala/21-best-practices/#_3","title":"\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u306e\u8981\u7d04","text":"\u30ab\u30c6\u30b4\u30ea \u30d7\u30e9\u30af\u30c6\u30a3\u30b9 \u52b9\u679c \u30c7\u30fc\u30bf\u8a2d\u8a08 case class \u3092\u4f7f\u7528 \u4e0d\u5909\u6027\u3001\u578b\u5b89\u5168\u6027 \u95a2\u6570\u8a2d\u8a08 \u5c0f\u3055\u306a\u7d14\u7c8b\u95a2\u6570 \u30c6\u30b9\u30c8\u5bb9\u6613\u6027\u3001\u518d\u5229\u7528\u6027 \u526f\u4f5c\u7528 \u5883\u754c\u306b\u62bc\u3057\u51fa\u3059 \u4e88\u6e2c\u53ef\u80fd\u6027\u3001\u4fdd\u5b88\u6027 \u4f9d\u5b58\u6027 \u6ce8\u5165\u30d1\u30bf\u30fc\u30f3 \u30c6\u30b9\u30c8\u5bb9\u6613\u6027\u3001\u758e\u7d50\u5408 \u691c\u8a3c \u578b\u5b89\u5168\u306a\u691c\u8a3c \u660e\u78ba\u6027\u3001\u62e1\u5f35\u6027"},{"location":"scala/21-best-practices/#_4","title":"\u5b9f\u8df5\u306e\u30dd\u30a4\u30f3\u30c8","text":"<ol> <li>\u30c7\u30fc\u30bf\u30d5\u30a1\u30fc\u30b9\u30c8: \u307e\u305a\u30c7\u30fc\u30bf\u69cb\u9020\u3092\u8a2d\u8a08</li> <li>\u5c0f\u3055\u306a\u95a2\u6570: 1\u95a2\u65701\u8cac\u4efb</li> <li>\u7d14\u7c8b\u6027\u3092\u512a\u5148: \u526f\u4f5c\u7528\u306f\u6700\u5f8c\u306b</li> <li>\u30c6\u30b9\u30c8\u3092\u8003\u616e: \u4f9d\u5b58\u6027\u306f\u6ce8\u5165\u53ef\u80fd\u306b</li> <li>\u578b\u3092\u6d3b\u7528: \u578b\u3067\u4e0d\u6b63\u72b6\u614b\u3092\u8868\u73fe\u4e0d\u80fd\u306b</li> </ol>"},{"location":"scala/21-best-practices/#_5","title":"\u53c2\u8003\u30b3\u30fc\u30c9","text":"<p>\u672c\u7ae0\u306e\u30b3\u30fc\u30c9\u4f8b\u306f\u4ee5\u4e0b\u306e\u30d5\u30a1\u30a4\u30eb\u3067\u78ba\u8a8d\u3067\u304d\u307e\u3059\uff1a</p> <ul> <li>\u30bd\u30fc\u30b9\u30b3\u30fc\u30c9: <code>app/scala/part7/src/main/scala/BestPractices.scala</code></li> <li>\u30c6\u30b9\u30c8\u30b3\u30fc\u30c9: <code>app/scala/part7/src/test/scala/BestPracticesSpec.scala</code></li> </ul>"},{"location":"scala/22-oo-to-fp-migration/","title":"\u7b2c22\u7ae0: \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\u304b\u3089\u95a2\u6570\u578b\u3078\u306e\u79fb\u884c","text":""},{"location":"scala/22-oo-to-fp-migration/#1","title":"1. \u306f\u3058\u3081\u306b","text":"<p>\u672c\u7ae0\u3067\u306f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411\uff08OO\uff09\u30b9\u30bf\u30a4\u30eb\u306e\u30b3\u30fc\u30c9\u3092\u95a2\u6570\u578b\uff08FP\uff09\u30b9\u30bf\u30a4\u30eb\u306b\u79fb\u884c\u3059\u308b\u305f\u3081\u306e\u6226\u7565\u3068\u30c6\u30af\u30cb\u30c3\u30af\u3092\u89e3\u8aac\u3057\u307e\u3059\u3002Scala \u306f OO \u3068 FP \u306e\u4e21\u65b9\u3092\u30b5\u30dd\u30fc\u30c8\u3059\u308b\u305f\u3081\u3001\u6bb5\u968e\u7684\u306a\u30a2\u30d7\u30ed\u30fc\u30c1\u306b\u3088\u308a\u65e2\u5b58\u306e\u30b3\u30fc\u30c9\u30d9\u30fc\u30b9\u3092\u5b89\u5168\u306b\u95a2\u6570\u578b\u306b\u79fb\u884c\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"scala/22-oo-to-fp-migration/#_1","title":"\u5b66\u7fd2\u76ee\u6a19","text":"<ul> <li>OO \u3068 FP \u306e\u6839\u672c\u7684\u306a\u9055\u3044\u3092\u7406\u89e3\u3059\u308b</li> <li>\u6bb5\u968e\u7684\u306a\u79fb\u884c\u6226\u7565\u3092\u5b66\u3076</li> <li>\u5b9f\u8df5\u7684\u306a\u30ea\u30d5\u30a1\u30af\u30bf\u30ea\u30f3\u30b0\u30d1\u30bf\u30fc\u30f3\u3092\u7fd2\u5f97\u3059\u308b</li> </ul>"},{"location":"scala/22-oo-to-fp-migration/#2-oo-fp","title":"2. OO \u3068 FP \u306e\u5bfe\u6bd4","text":""},{"location":"scala/22-oo-to-fp-migration/#21","title":"2.1 \u30d1\u30e9\u30c0\u30a4\u30e0\u306e\u9055\u3044","text":"\u6982\u5ff5 \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u6307\u5411 \u95a2\u6570\u578b \u57fa\u672c\u5358\u4f4d \u30aa\u30d6\u30b8\u30a7\u30af\u30c8 \u30c7\u30fc\u30bf + \u95a2\u6570 \u72b6\u614b\u7ba1\u7406 \u53ef\u5909\uff08mutable\uff09 \u4e0d\u5909\uff08immutable\uff09 \u591a\u614b\u6027 \u7d99\u627f\u30fb\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9 ADT\u30fb\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1 \u30b3\u30fc\u30c9\u518d\u5229\u7528 \u7d99\u627f \u95a2\u6570\u5408\u6210 \u526f\u4f5c\u7528 \u3069\u3053\u3067\u3082\u53ef\u80fd \u5883\u754c\u306b\u5206\u96e2"},{"location":"scala/22-oo-to-fp-migration/#22-oo","title":"2.2 OO \u30b9\u30bf\u30a4\u30eb\u306e\u4f8b","text":"<pre><code>object OOStyle:\n  /** OO\u30b9\u30bf\u30a4\u30eb: \u5185\u90e8\u72b6\u614b\u3092\u6301\u3064\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\uff08\u53ef\u5909\uff09 */\n  class Account(val id: String, initialBalance: Double):\n    private var _balance: Double = initialBalance\n    private var _transactions: List[Transaction] = List.empty\n\n    def balance: Double = _balance\n    def transactions: List[Transaction] = _transactions\n\n    def deposit(amount: Double): Double =\n      if amount &gt; 0 then\n        _balance += amount\n        _transactions = _transactions :+ Transaction(TransactionType.Deposit, amount)\n        _balance\n      else _balance\n\n    def withdraw(amount: Double): Double =\n      if amount &gt; 0 &amp;&amp; _balance &gt;= amount then\n        _balance -= amount\n        _transactions = _transactions :+ Transaction(TransactionType.Withdrawal, amount)\n        _balance\n      else _balance\n</code></pre> <p>\u554f\u984c\u70b9: - \u5185\u90e8\u72b6\u614b\u304c\u53ef\u5909 - \u30c6\u30b9\u30c8\u304c\u56f0\u96e3\uff08\u72b6\u614b\u306b\u4f9d\u5b58\uff09 - \u5c65\u6b74\u306e\u8ffd\u8de1\u304c\u96e3\u3057\u3044</p>"},{"location":"scala/22-oo-to-fp-migration/#23-fp","title":"2.3 FP \u30b9\u30bf\u30a4\u30eb\u3078\u306e\u5909\u63db","text":"<pre><code>object FPStyle:\n  /** \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u306e\u7a2e\u985e */\n  enum TransactionType:\n    case Deposit, Withdrawal\n\n  /** \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u8a18\u9332 */\n  case class Transaction(transactionType: TransactionType, amount: Double)\n\n  /** \u53e3\u5ea7\uff08\u4e0d\u5909\u30c7\u30fc\u30bf\uff09 */\n  case class Account(\n      id: String,\n      balance: Double,\n      transactions: List[Transaction] = List.empty\n  )\n\n  /** \u53e3\u5ea7\u3092\u4f5c\u6210 */\n  def makeAccount(id: String, initialBalance: Double): Account =\n    Account(id, initialBalance)\n\n  /** \u5165\u91d1\uff08\u65b0\u3057\u3044\u53e3\u5ea7\u3092\u8fd4\u3059\uff09 */\n  def deposit(account: Account, amount: Double): Account =\n    if amount &gt; 0 then\n      account.copy(\n        balance = account.balance + amount,\n        transactions = account.transactions :+ Transaction(TransactionType.Deposit, amount)\n      )\n    else account\n\n  /** \u51fa\u91d1\uff08\u65b0\u3057\u3044\u53e3\u5ea7\u3092\u8fd4\u3059\uff09 */\n  def withdraw(account: Account, amount: Double): Account =\n    if amount &gt; 0 &amp;&amp; account.balance &gt;= amount then\n      account.copy(\n        balance = account.balance - amount,\n        transactions = account.transactions :+ Transaction(TransactionType.Withdrawal, amount)\n      )\n    else account\n</code></pre> <p>\u5229\u70b9: - \u5143\u306e\u30c7\u30fc\u30bf\u306f\u4e0d\u5909 - \u30c6\u30b9\u30c8\u304c\u5bb9\u6613\uff08\u5165\u529b \u2192 \u51fa\u529b\uff09 - \u5b8c\u5168\u306a\u5c65\u6b74\u3092\u4fdd\u6301</p>"},{"location":"scala/22-oo-to-fp-migration/#24","title":"2.4 \u4f7f\u7528\u4f8b\u306e\u6bd4\u8f03","text":"<pre><code>// OO\u30b9\u30bf\u30a4\u30eb: \u526f\u4f5c\u7528\u3067\u72b6\u614b\u5909\u66f4\nval accOO = new OOStyle.Account(\"A001\", 1000)\naccOO.deposit(500)   // \u5185\u90e8\u72b6\u614b\u304c\u5909\u308f\u308b\naccOO.withdraw(200)  // \u5185\u90e8\u72b6\u614b\u304c\u5909\u308f\u308b\nprintln(accOO.balance)  // 1300\n\n// FP\u30b9\u30bf\u30a4\u30eb: \u65b0\u3057\u3044\u5024\u3092\u751f\u6210\nval acc1 = FPStyle.makeAccount(\"A001\", 1000)\nval acc2 = FPStyle.deposit(acc1, 500)   // acc1\u306f\u5909\u308f\u3089\u306a\u3044\nval acc3 = FPStyle.withdraw(acc2, 200)  // acc2\u3082\u5909\u308f\u3089\u306a\u3044\nprintln(FPStyle.getBalance(acc3))  // 1300\nprintln(FPStyle.getBalance(acc1))  // 1000\uff08\u5143\u306e\u307e\u307e\uff09\n</code></pre>"},{"location":"scala/22-oo-to-fp-migration/#3","title":"3. \u79fb\u884c\u6226\u7565","text":""},{"location":"scala/22-oo-to-fp-migration/#31-strangler-fig","title":"3.1 Strangler Fig \u30d1\u30bf\u30fc\u30f3","text":"<p>\u53e4\u3044\u30b3\u30fc\u30c9\u3092\u5f90\u3005\u306b\u65b0\u3057\u3044\u30b3\u30fc\u30c9\u3067\u300c\u7d5e\u3081\u6bba\u3059\u300d\u30d1\u30bf\u30fc\u30f3\u3002</p> <p></p> <pre><code>/** \u30b9\u30bf\u30a4\u30eb\u8b58\u5225\u5b50 */\nenum Style:\n  case FP, OO\n\n/** Strangler \u30d1\u30bf\u30fc\u30f3\u7528\u306e\u30e9\u30c3\u30d1\u30fc */\ncase class StranglerAccount(style: Style, data: Account)\n\n/** \u30d5\u30a3\u30fc\u30c1\u30e3\u30fc\u30d5\u30e9\u30b0\u306b\u3088\u308b\u30a2\u30ab\u30a6\u30f3\u30c8\u4f5c\u6210 */\ndef createAccountStrangler(id: String, initialBalance: Double, useFP: Boolean): StranglerAccount =\n  if useFP then StranglerAccount(Style.FP, makeAccount(id, initialBalance))\n  else StranglerAccount(Style.OO, makeAccount(id, initialBalance))\n\n/** Strangler \u30d1\u30bf\u30fc\u30f3\u3067\u306e\u5165\u91d1 */\ndef accountDeposit(account: StranglerAccount, amount: Double): StranglerAccount =\n  account.style match\n    case Style.FP =&gt; account.copy(data = deposit(account.data, amount))\n    case Style.OO =&gt; account.copy(data = deposit(account.data, amount))\n</code></pre>"},{"location":"scala/22-oo-to-fp-migration/#32","title":"3.2 \u30a2\u30c0\u30d7\u30bf\u30fc\u30d1\u30bf\u30fc\u30f3","text":"<p>\u53e4\u3044\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u7dad\u6301\u3057\u306a\u304c\u3089\u3001\u5185\u90e8\u5b9f\u88c5\u3092 FP \u306b\u79fb\u884c\u3002</p> <pre><code>/** \u65e2\u5b58\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u7dad\u6301\u3059\u308b\u305f\u3081\u306e\u30c8\u30ec\u30a4\u30c8 */\ntrait AccountOperations:\n  def getAccountBalance: Double\n  def depositToAccount(amount: Double): Double\n  def withdrawFromAccount(amount: Double): Double\n\n/** FP\u30b9\u30bf\u30a4\u30eb\u306e\u30a2\u30c0\u30d7\u30bf\u30fc\uff08\u72b6\u614b\u306f\u5916\u90e8\u3067\u7ba1\u7406\uff09 */\nclass FPAccountAdapter(private var account: Account) extends AccountOperations:\n  def getAccountBalance: Double = getBalance(account)\n\n  def depositToAccount(amount: Double): Double =\n    account = deposit(account, amount)\n    getBalance(account)\n\n  def withdrawFromAccount(amount: Double): Double =\n    account = withdraw(account, amount)\n    getBalance(account)\n\ndef makeFPAccountAdapter(id: String, initialBalance: Double): FPAccountAdapter =\n  new FPAccountAdapter(makeAccount(id, initialBalance))\n\n// \u4f7f\u7528\u4f8b\uff1a\u65e2\u5b58\u30b3\u30fc\u30c9\u3068\u306e\u4e92\u63db\u6027\u3092\u7dad\u6301\nval adapter = makeFPAccountAdapter(\"A001\", 1000)\nadapter.depositToAccount(500)\nprintln(adapter.getAccountBalance)  // 1500\n</code></pre>"},{"location":"scala/22-oo-to-fp-migration/#33","title":"3.3 \u30a4\u30d9\u30f3\u30c8\u30bd\u30fc\u30b7\u30f3\u30b0\u79fb\u884c","text":"<p>\u72b6\u614b\u3092\u30a4\u30d9\u30f3\u30c8\u306e\u5c65\u6b74\u3068\u3057\u3066\u8868\u73fe\u3002</p> <pre><code>/** \u30a4\u30d9\u30f3\u30c8\u306e\u7a2e\u985e */\nenum EventType:\n  case Created, Deposited, Withdrawn\n\n/** \u30a4\u30d9\u30f3\u30c8 */\ncase class AccountEvent(\n    eventType: EventType,\n    data: Map[String, Any],\n    timestamp: Long = System.currentTimeMillis()\n)\n\n/** \u30a4\u30d9\u30f3\u30c8\u3092\u9069\u7528\u3057\u3066\u72b6\u614b\u3092\u66f4\u65b0 */\ndef applyEvent(account: Account, event: AccountEvent): Account =\n  event.eventType match\n    case EventType.Created =&gt;\n      Account(\n        id = event.data(\"id\").toString,\n        balance = event.data.getOrElse(\"balance\", 0.0).asInstanceOf[Double],\n        transactions = List.empty\n      )\n    case EventType.Deposited =&gt;\n      deposit(account, event.data(\"amount\").asInstanceOf[Double])\n    case EventType.Withdrawn =&gt;\n      withdraw(account, event.data(\"amount\").asInstanceOf[Double])\n\n/** \u30a4\u30d9\u30f3\u30c8\u306e\u30ea\u30d7\u30ec\u30a4 */\ndef replayEvents(events: List[AccountEvent]): Account =\n  events.foldLeft(Account(\"\", 0.0))(applyEvent)\n\n// \u4f7f\u7528\u4f8b\nval events = List(\n  accountEvent(EventType.Created, Map(\"id\" -&gt; \"A001\", \"balance\" -&gt; 0.0)),\n  accountEvent(EventType.Deposited, Map(\"amount\" -&gt; 1000.0)),\n  accountEvent(EventType.Withdrawn, Map(\"amount\" -&gt; 300.0))\n)\nval account = replayEvents(events)  // balance: 700\n</code></pre> <p>\u5229\u70b9: - \u5b8c\u5168\u306a\u76e3\u67fb\u8a3c\u8de1 - \u4efb\u610f\u306e\u6642\u70b9\u306e\u72b6\u614b\u3092\u518d\u69cb\u7bc9\u53ef\u80fd - \u30c7\u30d0\u30c3\u30b0\u304c\u5bb9\u6613</p>"},{"location":"scala/22-oo-to-fp-migration/#34","title":"3.4 \u6bb5\u968e\u7684\u306a\u95a2\u6570\u62bd\u51fa","text":"<p>\u526f\u4f5c\u7528\u3092\u542b\u3080\u30b3\u30fc\u30c9\u304b\u3089\u7d14\u7c8b\u30ed\u30b8\u30c3\u30af\u3092\u6bb5\u968e\u7684\u306b\u62bd\u51fa\u3002</p> <p></p> <pre><code>// Step 1: \u8a08\u7b97\u30ed\u30b8\u30c3\u30af\u3092\u7d14\u7c8b\u95a2\u6570\u306b\u62bd\u51fa\ndef calculateInterest(balance: Double, rate: Double, days: Int): Double =\n  balance * rate * (days / 365.0)\n\ndef calculateFee(balance: Double, feeStructure: FeeStructure): Double =\n  if balance &lt; feeStructure.minimumBalance then feeStructure.lowBalanceFee\n  else if balance &gt; feeStructure.premiumThreshold then 0.0\n  else feeStructure.standardFee\n\n// Step 2: \u696d\u52d9\u30eb\u30fc\u30eb\u3092\u7d14\u7c8b\u95a2\u6570\u3068\u3057\u3066\u8868\u73fe\ndef canWithdraw(account: Account, amount: Double, overdraftLimit: Double): Boolean =\n  account.balance + overdraftLimit &gt;= amount\n\ndef calculateNewBalance(currentBalance: Double, operation: TransactionType, amount: Double): Double =\n  operation match\n    case TransactionType.Deposit    =&gt; currentBalance + amount\n    case TransactionType.Withdrawal =&gt; currentBalance - amount\n\n// Step 3: \u526f\u4f5c\u7528\u3092\u5883\u754c\u306b\u62bc\u3057\u51fa\u3059\ndef processTransaction(\n    account: Account,\n    operation: TransactionType,\n    amount: Double,\n    rules: TransactionRules\n): ProcessResult =\n  val canProcess = operation match\n    case TransactionType.Deposit    =&gt; true\n    case TransactionType.Withdrawal =&gt; canWithdraw(account, amount, rules.overdraftLimit)\n\n  if canProcess then\n    val newBalance = calculateNewBalance(account.balance, operation, amount)\n    val newAccount = account.copy(\n      balance = newBalance,\n      transactions = account.transactions :+ Transaction(operation, amount)\n    )\n    ProcessResult(true, newAccount)\n  else ProcessResult(false, account, Some(\"Insufficient funds\"))\n</code></pre>"},{"location":"scala/22-oo-to-fp-migration/#4-adt","title":"4. ADT \u306b\u3088\u308b\u591a\u614b\u6027","text":""},{"location":"scala/22-oo-to-fp-migration/#41-adt","title":"4.1 \u7d99\u627f\u304b\u3089 ADT + \u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u3078","text":"<pre><code>/** \u56f3\u5f62\uff08ADT\uff09 */\nsealed trait Shape:\n  def x: Double\n  def y: Double\n\ncase class Circle(x: Double, y: Double, radius: Double) extends Shape\ncase class Rectangle(x: Double, y: Double, width: Double, height: Double) extends Shape\ncase class Triangle(x: Double, y: Double, base: Double, height: Double) extends Shape\n\n/** \u56f3\u5f62\u306e\u9762\u7a4d\u3092\u8a08\u7b97\uff08\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u3067\u591a\u614b\u6027\uff09 */\ndef area(shape: Shape): Double = shape match\n  case Circle(_, _, r)         =&gt; Math.PI * r * r\n  case Rectangle(_, _, w, h)   =&gt; w * h\n  case Triangle(_, _, base, h) =&gt; base * h / 2\n\n/** \u56f3\u5f62\u3092\u62e1\u5927\uff08\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1\u3067\u591a\u614b\u6027\uff09 */\ndef scale(shape: Shape, factor: Double): Shape = shape match\n  case c: Circle    =&gt; c.copy(radius = c.radius * factor)\n  case r: Rectangle =&gt; r.copy(width = r.width * factor, height = r.height * factor)\n  case t: Triangle  =&gt; t.copy(base = t.base * factor, height = t.height * factor)\n\n/** \u5171\u901a\u64cd\u4f5c\uff08\u578b\u306b\u4f9d\u5b58\u3057\u306a\u3044\uff09 */\ndef move(shape: Shape, dx: Double, dy: Double): Shape = shape match\n  case c: Circle    =&gt; c.copy(x = c.x + dx, y = c.y + dy)\n  case r: Rectangle =&gt; r.copy(x = r.x + dx, y = r.y + dy)\n  case t: Triangle  =&gt; t.copy(x = t.x + dx, y = t.y + dy)\n</code></pre> <p>\u4f7f\u7528\u4f8b: <pre><code>val circle = Circle(0, 0, 10)\nval rect = Rectangle(0, 0, 10, 20)\n\nprintln(area(circle))        // 314.159...\nprintln(area(rect))          // 200.0\n\nval moved = move(circle, 5, 3)  // Circle(5, 3, 10)\nval scaled = scale(rect, 2)     // Rectangle(0, 0, 20, 40)\n</code></pre></p>"},{"location":"scala/22-oo-to-fp-migration/#5","title":"5. \u30a4\u30d9\u30f3\u30c8\u99c6\u52d5\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3","text":""},{"location":"scala/22-oo-to-fp-migration/#51-fp","title":"5.1 FP \u30b9\u30bf\u30a4\u30eb\u306e\u30a4\u30d9\u30f3\u30c8\u30b7\u30b9\u30c6\u30e0","text":"<pre><code>/** \u30a4\u30d9\u30f3\u30c8 */\ncase class Event[A](eventType: String, data: A)\n\n/** \u30a4\u30d9\u30f3\u30c8\u30cf\u30f3\u30c9\u30e9 */\ntype EventHandler[A, B] = Event[A] =&gt; B\n\n/** \u30a4\u30d9\u30f3\u30c8\u30b7\u30b9\u30c6\u30e0\uff08\u4e0d\u5909\uff09 */\ncase class EventSystem[A](\n    handlers: Map[String, List[EventHandler[A, Any]]] = Map.empty,\n    eventLog: List[Event[A]] = List.empty\n)\n\n/** \u30cf\u30f3\u30c9\u30e9\u3092\u767b\u9332 */\ndef subscribe[A, B](\n    system: EventSystem[A],\n    eventType: String,\n    handler: EventHandler[A, B]\n): EventSystem[A] =\n  val currentHandlers = system.handlers.getOrElse(eventType, List.empty)\n  system.copy(\n    handlers = system.handlers + (eventType -&gt; (currentHandlers :+ handler))\n  )\n\n/** \u30a4\u30d9\u30f3\u30c8\u3092\u767a\u884c */\ndef publish[A](system: EventSystem[A], eventType: String, data: A): PublishResult[A] =\n  val event = Event(eventType, data)\n  val handlers = system.handlers.getOrElse(eventType, List.empty)\n  val results = handlers.map(h =&gt; h(event))\n  val newSystem = system.copy(eventLog = system.eventLog :+ event)\n  PublishResult(newSystem, results)\n</code></pre> <p>\u4f7f\u7528\u4f8b: <pre><code>val system = subscribe(\n  makeEventSystem[Map[String, String]](),\n  \"user-created\",\n  (e: Event[Map[String, String]]) =&gt; s\"Welcome, ${e.data(\"name\")}\"\n)\n\nval result = publish(system, \"user-created\", Map(\"name\" -&gt; \"John\", \"email\" -&gt; \"john@example.com\"))\nprintln(result.results.head)  // \"Welcome, John\"\n</code></pre></p>"},{"location":"scala/22-oo-to-fp-migration/#6","title":"6. \u5b9f\u8df5\u7684\u306a\u79fb\u884c\u4f8b","text":""},{"location":"scala/22-oo-to-fp-migration/#61","title":"6.1 \u30c9\u30e1\u30a4\u30f3\u30e2\u30c7\u30ea\u30f3\u30b0","text":"<pre><code>/** \u30e6\u30fc\u30b6\u30fcID\uff08\u5024\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\uff09 */\nopaque type UserId = String\nobject UserId:\n  def apply(value: String): UserId = value\n  extension (id: UserId) def value: String = id\n\n/** \u30e1\u30fc\u30eb\u30a2\u30c9\u30ec\u30b9\uff08\u5024\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 + \u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\uff09 */\nopaque type Email = String\nobject Email:\n  def apply(value: String): Either[String, Email] =\n    if value.contains(\"@\") &amp;&amp; value.length &gt; 3 then Right(value)\n    else Left(\"Invalid email format\")\n\n  extension (email: Email) def value: String = email\n\n/** \u30e6\u30fc\u30b6\u30fc\uff08\u4e0d\u5909\u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\uff09 */\ncase class User(id: UserId, name: String, email: String, active: Boolean = true)\n\n/** \u30e6\u30fc\u30b6\u30fc\u4f5c\u6210\uff08\u30d0\u30ea\u30c7\u30fc\u30b7\u30e7\u30f3\u4ed8\u304d\uff09 */\ndef createUser(id: String, name: String, email: String): CreateUserResult =\n  val errors = List(\n    if name.isEmpty then Some(\"Name is required\") else None,\n    if !email.contains(\"@\") then Some(\"Invalid email\") else None,\n    if id.isEmpty then Some(\"ID is required\") else None\n  ).flatten\n\n  if errors.isEmpty then UserCreated(User(UserId(id), name, email))\n  else UserCreationFailed(errors)\n</code></pre>"},{"location":"scala/22-oo-to-fp-migration/#62-fp","title":"6.2 \u30ea\u30dd\u30b8\u30c8\u30ea\u30d1\u30bf\u30fc\u30f3\uff08FP\u7248\uff09","text":"<pre><code>/** \u30ea\u30dd\u30b8\u30c8\u30ea\u64cd\u4f5c\u306e\u7d50\u679c */\nsealed trait RepositoryResult[+A]\ncase class Found[A](value: A) extends RepositoryResult[A]\ncase object NotFound extends RepositoryResult[Nothing]\ncase class RepoError(message: String) extends RepositoryResult[Nothing]\n\n/** \u4e0d\u5909\u30ea\u30dd\u30b8\u30c8\u30ea */\ncase class UserRepository(users: Map[UserId, User] = Map.empty):\n  def save(user: User): UserRepository =\n    copy(users = users + (user.id -&gt; user))\n\n  def findById(id: UserId): RepositoryResult[User] =\n    users.get(id) match\n      case Some(user) =&gt; Found(user)\n      case None       =&gt; NotFound\n\n  def findAll: List[User] = users.values.toList\n\n  def delete(id: UserId): UserRepository =\n    copy(users = users - id)\n\n  def update(id: UserId, f: User =&gt; User): UserRepository =\n    users.get(id) match\n      case Some(user) =&gt; copy(users = users + (id -&gt; f(user)))\n      case None       =&gt; this\n</code></pre>"},{"location":"scala/22-oo-to-fp-migration/#63","title":"6.3 \u30b5\u30fc\u30d3\u30b9\u5c64\uff08\u7d14\u7c8b\u95a2\u6570\uff09","text":"<pre><code>/** \u30b5\u30fc\u30d3\u30b9\u64cd\u4f5c\u306e\u7d50\u679c */\ncase class ServiceResult[A](value: A, repository: UserRepository)\n\n/** \u30e6\u30fc\u30b6\u30fc\u30b5\u30fc\u30d3\u30b9\uff08\u7d14\u7c8b\u95a2\u6570\u3068\u3057\u3066\u5b9f\u88c5\uff09 */\nobject UserService:\n  def registerUser(\n      repo: UserRepository,\n      id: String,\n      name: String,\n      email: String\n  ): Either[List[String], ServiceResult[User]] =\n    createUser(id, name, email) match\n      case UserCreated(user) =&gt;\n        Right(ServiceResult(user, repo.save(user)))\n      case UserCreationFailed(errors) =&gt;\n        Left(errors)\n\n  def deactivateUser(\n      repo: UserRepository,\n      id: UserId\n  ): Either[String, ServiceResult[User]] =\n    repo.findById(id) match\n      case Found(user) =&gt;\n        val updated = user.copy(active = false)\n        Right(ServiceResult(updated, repo.update(id, _ =&gt; updated)))\n      case NotFound =&gt;\n        Left(\"User not found\")\n\n  def getAllActiveUsers(repo: UserRepository): List[User] =\n    repo.findAll.filter(_.active)\n</code></pre>"},{"location":"scala/22-oo-to-fp-migration/#64","title":"6.4 \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u51e6\u7406","text":"<pre><code>/** \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u6f14\u7b97\u5b50\uff08\u62e1\u5f35\u30e1\u30bd\u30c3\u30c9\uff09 */\nextension [A](a: A)\n  def |&gt;[B](f: A =&gt; B): B = f(a)\n\n// \u4f7f\u7528\u4f8b\nval result = 10 |&gt; (_ * 2) |&gt; (_ + 5)  // 25\n\n/** \u30c7\u30fc\u30bf\u5909\u63db\u306e\u4f8b */\ndef transformUserData(users: List[User]): Map[String, List[String]] =\n  users\n    .filter(_.active)\n    .groupBy(_.name.head.toString.toUpperCase)\n    .view\n    .mapValues(_.map(_.email))\n    .toMap\n</code></pre>"},{"location":"scala/22-oo-to-fp-migration/#7","title":"7. \u79fb\u884c\u30c1\u30a7\u30c3\u30af\u30ea\u30b9\u30c8","text":""},{"location":"scala/22-oo-to-fp-migration/#71","title":"7.1 \u6e96\u5099\u30d5\u30a7\u30fc\u30ba","text":"<ul> <li> \u73fe\u5728\u306e\u30b3\u30fc\u30c9\u306e\u72b6\u614b\u3092\u628a\u63e1</li> <li> \u30c6\u30b9\u30c8\u30ab\u30d0\u30ec\u30c3\u30b8\u3092\u78ba\u8a8d</li> <li> \u79fb\u884c\u306e\u512a\u5148\u9806\u4f4d\u3092\u6c7a\u5b9a</li> <li> \u30c1\u30fc\u30e0\u3078\u306e\u6559\u80b2</li> </ul>"},{"location":"scala/22-oo-to-fp-migration/#72","title":"7.2 \u5b9f\u884c\u30d5\u30a7\u30fc\u30ba","text":"<ul> <li> \u7d14\u7c8b\u95a2\u6570\u3092\u62bd\u51fa</li> <li> \u526f\u4f5c\u7528\u3092\u5206\u96e2</li> <li> ADT \u306b\u79fb\u884c</li> <li> \u30c6\u30b9\u30c8\u3092\u8ffd\u52a0</li> </ul>"},{"location":"scala/22-oo-to-fp-migration/#73","title":"7.3 \u5b8c\u4e86\u30d5\u30a7\u30fc\u30ba","text":"<ul> <li> \u53e4\u3044\u30b3\u30fc\u30c9\u3092\u524a\u9664</li> <li> \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u66f4\u65b0</li> <li> \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3092\u78ba\u8a8d</li> <li> \u30c1\u30fc\u30e0\u30ec\u30d3\u30e5\u30fc</li> </ul>"},{"location":"scala/22-oo-to-fp-migration/#8-oo-vs-fp","title":"8. OO vs FP \u6bd4\u8f03\u8868","text":"\u5074\u9762 OO FP \u512a\u4f4d\u6027 \u57fa\u672c\u5358\u4f4d \u30aa\u30d6\u30b8\u30a7\u30af\u30c8 \u30c7\u30fc\u30bf + \u95a2\u6570 FP: \u3088\u308a\u5358\u7d14\u306a\u69cb\u9020 \u72b6\u614b\u7ba1\u7406 \u53ef\u5909\uff08mutable\uff09 \u4e0d\u5909\uff08immutable\uff09 FP: \u4e88\u6e2c\u53ef\u80fd \u591a\u614b\u6027 \u7d99\u627f\u30fb\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9 ADT\u30fb\u30d1\u30bf\u30fc\u30f3\u30de\u30c3\u30c1 FP: \u3088\u308a\u67d4\u8edf \u30b3\u30fc\u30c9\u518d\u5229\u7528 \u7d99\u627f \u95a2\u6570\u5408\u6210 FP: \u3088\u308a\u758e\u7d50\u5408 \u526f\u4f5c\u7528 \u3069\u3053\u3067\u3082\u53ef\u80fd \u5883\u754c\u306b\u5206\u96e2 FP: \u30c6\u30b9\u30c8\u5bb9\u6613 \u30c6\u30b9\u30c8 \u30e2\u30c3\u30af\u304c\u5fc5\u8981 \u5165\u529b\u2192\u51fa\u529b\u306e\u307f FP: \u30b7\u30f3\u30d7\u30eb \u30c7\u30d0\u30c3\u30b0 \u72b6\u614b\u8ffd\u8de1\u304c\u56f0\u96e3 \u5024\u304c\u4e0d\u5909\u3067\u8ffd\u8de1\u5bb9\u6613 FP: \u5bb9\u6613 \u4e26\u884c\u51e6\u7406 \u30ed\u30c3\u30af\u304c\u5fc5\u8981 \u4e0d\u5909\u30c7\u30fc\u30bf\u3067\u5b89\u5168 FP: \u5b89\u5168"},{"location":"scala/22-oo-to-fp-migration/#9","title":"9. \u30c6\u30b9\u30c8\u30b3\u30fc\u30c9","text":"<pre><code>describe(\"OO\u30b9\u30bf\u30a4\u30eb vs FP\u30b9\u30bf\u30a4\u30eb\"):\n  it(\"FP\u30b9\u30bf\u30a4\u30eb\u306f\u5143\u306e\u5024\u3092\u5909\u66f4\u3057\u306a\u3044\"):\n    val acc = makeAccount(\"A001\", 1000)\n    val newAcc = deposit(acc, 500)\n    getBalance(acc) shouldBe 1000    // \u5143\u306f\u5909\u308f\u3089\u306a\u3044\n    getBalance(newAcc) shouldBe 1500\n\ndescribe(\"\u79fb\u884c\u6226\u7565\"):\n  it(\"\u30a2\u30c0\u30d7\u30bf\u30fc\u3067\u65e2\u5b58\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u7dad\u6301\"):\n    val adapter = makeFPAccountAdapter(\"A001\", 1000)\n    adapter.depositToAccount(500) shouldBe 1500\n    adapter.getAccountBalance shouldBe 1500\n\n  it(\"\u30a4\u30d9\u30f3\u30c8\u3092\u30ea\u30d7\u30ec\u30a4\u3067\u304d\u308b\"):\n    val events = List(\n      accountEvent(EventType.Created, Map(\"id\" -&gt; \"A001\", \"balance\" -&gt; 0.0)),\n      accountEvent(EventType.Deposited, Map(\"amount\" -&gt; 1000.0)),\n      accountEvent(EventType.Withdrawn, Map(\"amount\" -&gt; 300.0))\n    )\n    val account = replayEvents(events)\n    account.balance shouldBe 700\n\ndescribe(\"ADT\u306b\u3088\u308b\u591a\u614b\u6027\"):\n  it(\"\u7570\u306a\u308b\u56f3\u5f62\u306e\u9762\u7a4d\u3092\u8a08\u7b97\"):\n    val circle = Circle(0, 0, 10)\n    val rect = Rectangle(0, 0, 10, 20)\n    area(circle) shouldBe Math.PI * 100\n    area(rect) shouldBe 200\n</code></pre>"},{"location":"scala/22-oo-to-fp-migration/#10","title":"10. \u307e\u3068\u3081","text":""},{"location":"scala/22-oo-to-fp-migration/#_2","title":"\u79fb\u884c\u306e\u30dd\u30a4\u30f3\u30c8","text":"<ol> <li>\u6bb5\u968e\u7684\u306b\u9032\u3081\u308b: \u4e00\u5ea6\u306b\u3059\u3079\u3066\u3092\u5909\u66f4\u3057\u306a\u3044</li> <li>\u30c6\u30b9\u30c8\u3092\u66f8\u304f: \u79fb\u884c\u524d\u5f8c\u306e\u52d5\u4f5c\u3092\u4fdd\u8a3c</li> <li>\u30a2\u30c0\u30d7\u30bf\u30fc\u3092\u6d3b\u7528: \u65e2\u5b58\u306e\u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30fc\u30b9\u3092\u7dad\u6301</li> <li>\u7d14\u7c8b\u95a2\u6570\u304b\u3089\u59cb\u3081\u308b: \u8a08\u7b97\u30ed\u30b8\u30c3\u30af\u3092\u5148\u306b\u62bd\u51fa</li> </ol>"},{"location":"scala/22-oo-to-fp-migration/#_3","title":"\u95a2\u6570\u578b\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3","text":""},{"location":"scala/22-oo-to-fp-migration/#_4","title":"\u30b7\u30ea\u30fc\u30ba\u306e\u307e\u3068\u3081","text":"<p>\u672c\u30b7\u30ea\u30fc\u30ba\u3092\u901a\u3058\u3066\u3001\u4ee5\u4e0b\u3092\u5b66\u3073\u307e\u3057\u305f\uff1a</p> <ol> <li>\u57fa\u790e\u539f\u5247: \u4e0d\u5909\u6027\u3001\u95a2\u6570\u5408\u6210\u3001\u591a\u614b\u6027</li> <li>\u4ed5\u69d8\u3068\u30c6\u30b9\u30c8: \u30c7\u30fc\u30bf\u691c\u8a3c\u3001\u30d7\u30ed\u30d1\u30c6\u30a3\u30d9\u30fc\u30b9\u30c6\u30b9\u30c8\u3001TDD</li> <li>\u69cb\u9020\u30d1\u30bf\u30fc\u30f3: Composite\u3001Decorator\u3001Adapter</li> <li>\u632f\u308b\u821e\u3044\u30d1\u30bf\u30fc\u30f3: Strategy\u3001Command\u3001Visitor</li> <li>\u751f\u6210\u30d1\u30bf\u30fc\u30f3: Abstract Factory\u3001Abstract Server</li> <li>\u30b1\u30fc\u30b9\u30b9\u30bf\u30c7\u30a3: \u5b9f\u8df5\u7684\u306a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3</li> <li>\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9: \u30c7\u30fc\u30bf\u4e2d\u5fc3\u8a2d\u8a08\u3001\u30c6\u30b9\u30c8\u53ef\u80fd\u306a\u8a2d\u8a08</li> </ol> <p>\u95a2\u6570\u578b\u30c7\u30b6\u30a4\u30f3\u306f\u3001\u30b7\u30f3\u30d7\u30eb\u3067\u4fdd\u5b88\u3057\u3084\u3059\u304f\u3001\u30c6\u30b9\u30c8\u3057\u3084\u3059\u3044\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u69cb\u7bc9\u3059\u308b\u305f\u3081\u306e\u5f37\u529b\u306a\u30a2\u30d7\u30ed\u30fc\u30c1\u3067\u3059\u3002Scala \u306e\u8868\u73fe\u529b\u8c4a\u304b\u306a\u578b\u30b7\u30b9\u30c6\u30e0\u3068\u95a2\u6570\u578b\u6a5f\u80fd\u3092\u6d3b\u7528\u3057\u3066\u3001\u3088\u308a\u826f\u3044\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u3092\u4f5c\u6210\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p> <p>Simple made easy.</p>"}]}